(()=>{var e={};e.id=3001,e.ids=[3001],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},86624:e=>{"use strict";e.exports=require("querystring")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},57003:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>o}),t(85558),t(56367),t(12699),t(99985),t(96560);var r=t(23191),a=t(88716),l=t(37922),i=t.n(l),d=t(95231),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(s,n);let o=["",{children:["(dashboard)",{children:["app-updates",{children:["new-apk",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,85558)),"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\(dashboard)\\app-updates\\new-apk\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,56367)),"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\(dashboard)\\layout.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,12699)),"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\(dashboard)\\loading.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,99985)),"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\not-found.tsx"]}],c=["C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\(dashboard)\\app-updates\\new-apk\\page.tsx"],u="/(dashboard)/app-updates/new-apk/page",p={require:t,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(dashboard)/app-updates/new-apk/page",pathname:"/app-updates/new-apk",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63183:(e,s,t)=>{Promise.resolve().then(t.bind(t,15896)),Promise.resolve().then(t.bind(t,10827))},15896:(e,s,t)=>{"use strict";t.d(s,{ApkReleaseForm:()=>q});var r=t(10326),a=t(17577),l=t(35047),i=t(94464),d=t(90772),n=t(33071),o=t(54432),c=t(31048),u=t(96655),p=t(87673),h=t(34474),x=t(47463),m=t(63685),v=t(39572),f=t(2165),g=t(18048),j=t(77863),b=t(11870),y=t(96221),C=t(92009),A=t(71708);function k({type:e,children:s,inputProps:t,fileDetails:l,onUpload:i,...n}){let[o,{width:c}]=(0,f.Z)(),[u,p]=(0,a.useState)(!1),[h,k]=(0,a.useState)([]),[N,w]=(0,a.useState)(!1),{alert:P}=(0,y.s)(),_=(0,a.useCallback)(async()=>{let e=t?.multiple?h:[h[0]];try{for(let{file:s,metadata:t,fileId:r}of(w(!0),e)){let e=new FormData;e.append("file",s),e.append("fileId",r||(0,x.Z)()),e.append("filename",s.name),e.append("contentType",s.type),e.append("size",`${s.size}`),e.append("metadata",JSON.stringify({...t})),l&&Object.keys(l).forEach(s=>{let t=l[s];e.append(s,JSON.stringify(t))}),await i(e)}p(!1),k([]),P({title:"Success",message:`File${e.length>1?"s":""} uploaded successfully!`,variant:"success"})}catch(s){P({title:"Error",message:`Failed to upload file${e.length>1?"s":""}: ${s.message}`,variant:"error"})}finally{w(!1)}},[i,P,h,t?.multiple,l]),q=(0,a.useCallback)(async e=>{try{let s=[];if(e.target.files?.length)for(let t=0;t<e.target.files.length;t++)s.push(e.target.files[t]);let t=[];for(let e of s){let s,r;let a=URL.createObjectURL(e),l={};if(`${e.type}`.includes("image"))try{let e=await (0,C.p)(a);l={...l,...e},s=a}catch(e){}t.push({fileId:(0,x.Z)(),file:e,url:a,imageURL:s,videoURL:r,metadata:l})}k(t)}catch(e){P({title:"Error",message:e.message})}},[P]);return(0,r.jsxs)(r.Fragment,{children:[N&&r.jsx(b.a,{overlay:!0}),r.jsx(g.u,{open:u,onOpenChange:e=>{p(e),k([])},title:"Upload file",trigger:s,...n,actions:(0,r.jsxs)(r.Fragment,{children:[!h.length&&r.jsx("div",{className:"flex-1"}),r.jsx(d.z,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),!!h.length&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"flex-1"}),r.jsx(d.z,{variant:"destructive",onClick:()=>k([]),children:"Clear"}),(0,r.jsxs)(d.z,{disabled:!h.length,onClick:()=>_(),className:(0,j.cn)(!h.length&&"hidden"),children:[r.jsx(m.Z,{className:"h-4 w-4 mr-2"}),r.jsx("span",{children:"Upload"})]})]})]}),children:(0,r.jsxs)("div",{ref:o,children:[1===h.length&&h.map(e=>{let s=r.jsx(v.Z,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(s=r.jsx(A.E,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:c,src:e.imageURL||"/images/placeholder.png"})),(0,r.jsxs)("div",{className:(0,j.cn)(`
                                        flex
                                        flex-col
                                        gap-y-2
                                        w-full
                                        items-center
                                        justify-center
                                        text-xs
                                    `,!(e.imageURL||e.videoURL)&&""),children:[s,r.jsx("span",{children:e.file.name})]},e.fileId)}),!h.length&&(0,r.jsxs)("div",{className:(0,j.cn)(`
                                    relative
                                    w-full
                                    h-36
                                    bg-primary/20
                                    flex
                                    flex-col
                                    items-center
                                    justify-center
                                    text-primary
                                    uppercase
                                    font-bold
                                    rounded-md
                                    transition-colors
                                    hover:bg-primary/30
                                `,!!h.length&&"hidden"),children:[r.jsx("div",{children:t?.placeholder||"Choose file"}),r.jsx("input",{...t,type:"file",accept:e,value:"",className:(0,j.cn)(`
                                        absolute
                                        left-0
                                        top-0
                                        w-full
                                        h-full
                                        opacity-0
                                    `),onChange:q})]})]})})]})}var N=t(3529);let w=["uploaded","validated","approved","available","deprecated","revoked","rolled_back"],P=()=>({runtimeVersion:"",versionName:"",versionCode:null,status:"uploaded",isAvailable:!1,fileId:null,fileSize:null,checksumSha256:null,signatureSha256:null,validatedAt:null,approvedAt:null,releasedAt:null,releaseNotes:""}),_=e=>{if(""===e||null==e)return null;let s=Number(e);return Number.isFinite(s)?s:null};function q({apkReleases:e,apkReleaseDrafts:s,apkReleaseId:t,saveApkReleases:x}){let m=(0,l.useRouter)(),{alert:v}=(0,y.s)(),{viewOnly:f,mode:g}=(0,N.b)(),[C,A]=(0,a.useState)(!1),q=(0,a.useMemo)(()=>{let t=new Map;for(let e of s){let s=e.data||{},r=s.apkReleaseId||e.apkReleaseDraftId;r&&t.set(r,{...s,apkReleaseId:r,__draft:!0,__draftId:e.apkReleaseDraftId,__updatedAt:e.updatedAt||e.createdAt})}for(let s of e){let e=s.apkReleaseId;e&&(t.has(e)||t.set(e,{...s,__draft:!1}))}return Array.from(t.values()).sort((e,s)=>{let t=new Date(e.__updatedAt||e.updatedAt||e.createdAt||0).getTime();return new Date(s.__updatedAt||s.updatedAt||s.createdAt||0).getTime()-t})},[s,e]),R=(0,a.useMemo)(()=>q[0]||null,[q]);(0,a.useMemo)(()=>t&&q.find(e=>e.apkReleaseId===t)||null,[t,q]);let[S,I]=(0,a.useState)(()=>P()),U=(0,a.useCallback)(async()=>{try{if(f)return;if(A(!0),!S.runtimeVersion)throw Error("Runtime version is required");if(!S.versionName)throw Error("Version name is required");if(!S.versionCode)throw Error("Version code is required");let e={...S,versionCode:Number(S.versionCode||0),validatedAt:S.validatedAt?new Date(S.validatedAt):null,approvedAt:S.approvedAt?new Date(S.approvedAt):null,releasedAt:S.releasedAt?new Date(S.releasedAt):null},s=await x({data:[e]});if(s.errors?.length)throw Error(s.errors.join(", "));m.refresh(),v({title:"Success",message:"APK release saved to drafts.",variant:"success"})}catch(e){v({title:"Error",message:`Failed to save APK release: ${e.message}`,variant:"error"})}finally{A(!1)}},[v,S,f,m,x]),E=(0,a.useCallback)(async e=>{if(f)return;let s=(await i.Z.post("/api/files/upload",e)).data;if(s.errors?.length)throw Error(s.errors.join(", "));let t=s.data;if(!t?.fileId)throw Error("File upload failed");I(e=>({...e,fileId:t.fileId,fileSize:t.size||e.fileSize||null,checksumSha256:t.metadata?.apkChecksumSha256||e.checksumSha256||null,signatureSha256:t.metadata?.apkSignatureSha256||e.signatureSha256||null}))},[f]),F=(0,a.useCallback)(()=>{I(P())},[]);return(0,r.jsxs)(r.Fragment,{children:[C&&r.jsx(b.a,{overlay:!0}),r.jsx(n.Zb,{children:(0,r.jsxs)(n.aY,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm text-muted-foreground",children:"APK release draft"}),R?(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Latest APK: ",R.versionName," (",R.versionCode,")"]}):null,r.jsx("div",{className:"text-xs text-muted-foreground",children:f?"View mode: edits disabled":"development"===g?"Development mode: drafts enabled":`Mode: ${g}`})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(d.z,{variant:"ghost",onClick:()=>m.push("/app-updates"),children:"Cancel"}),r.jsx(d.z,{variant:"primary-outline",onClick:F,disabled:f,children:"Reset"}),r.jsx(d.z,{onClick:U,disabled:C||f,children:"Save Draft"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-6",children:[(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Runtime Version"}),r.jsx(o.I,{value:S.runtimeVersion,onChange:e=>I(s=>({...s,runtimeVersion:e.target.value})),disabled:f})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Version Name"}),r.jsx(o.I,{value:S.versionName,onChange:e=>I(s=>({...s,versionName:e.target.value})),disabled:f})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Version Code"}),r.jsx(o.I,{type:"number",value:S.versionCode??"",onChange:e=>I(s=>({...s,versionCode:_(e.target.value)})),disabled:f})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Status"}),(0,r.jsxs)(h.Ph,{value:S.status,onValueChange:e=>I(s=>({...s,status:e})),disabled:f,children:[r.jsx(h.i4,{children:r.jsx(h.ki,{placeholder:"Select status"})}),r.jsx(h.Bw,{children:w.map(e=>r.jsx(h.Ql,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(u.r,{checked:S.isAvailable,onCheckedChange:e=>I(s=>({...s,isAvailable:e})),disabled:f}),r.jsx(c._,{children:"Available to devices"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(k,{type:".apk,application/vnd.android.package-archive",inputProps:{multiple:!1,placeholder:"Choose APK"},onUpload:E,children:r.jsx(d.z,{variant:"primary-outline",disabled:f,children:"Upload APK"})}),r.jsx("span",{className:(0,j.cn)("text-xs",!S.fileId&&"text-muted-foreground"),children:S.fileId?`File: ${S.fileId}`:"No file uploaded"})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Checksum (SHA-256)"}),r.jsx(o.I,{value:S.checksumSha256||"",disabled:!0})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Signature (SHA-256)"}),r.jsx(o.I,{value:S.signatureSha256||"",disabled:!0})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Validated At"}),r.jsx(o.I,{type:"datetime-local",value:S.validatedAt||"",onChange:e=>I(s=>({...s,validatedAt:e.target.value||null})),disabled:f})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Approved At"}),r.jsx(o.I,{type:"datetime-local",value:S.approvedAt||"",onChange:e=>I(s=>({...s,approvedAt:e.target.value||null})),disabled:f})]}),(0,r.jsxs)("div",{children:[r.jsx(c._,{children:"Released At"}),r.jsx(o.I,{type:"datetime-local",value:S.releasedAt||"",onChange:e=>I(s=>({...s,releasedAt:e.target.value||null})),disabled:f})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx(c._,{children:"Release Notes"}),r.jsx(p.g,{value:S.releaseNotes||"",onChange:e=>I(s=>({...s,releaseNotes:e.target.value})),disabled:f})]})]})})]})}},18048:(e,s,t)=>{"use strict";t.d(s,{u:()=>d});var r=t(10326);t(17577);var a=t(62288),l=t(77863);let i=(0,t(60114).Ue)((e,s)=>({modals:{},open(s){e(e=>({modals:{...e.modals,[s]:!0}}))},toggle(t){let r=s().modals;e(e=>({modals:{...e.modals,[t]:!r[t]}}))},close(s){e(e=>({modals:{...e.modals,[s]:!1}}))},isOpen:e=>!!s().modals[e],set(s){e(e=>({modals:{...e.modals,...s}}))}}));function d({id:e,children:s,title:t,description:d,actions:n,trigger:o,contentProps:c,footerProps:u,...p}){let{close:h,isOpen:x,set:m}=i();return r.jsx(r.Fragment,{children:(0,r.jsxs)(a.Vq,{...p,open:(e?x(e):void 0)||p.open,onOpenChange:s=>{e&&m({[e]:s}),p?.onOpenChange?.(s)},children:[o,(0,r.jsxs)(a.cZ,{hideCloseButton:!0,className:(0,l.cn)("flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",c?.className),...c,children:[(0,r.jsxs)(a.fK,{className:(0,l.cn)(t||d?"":"hidden","border-b border-b-border px-4 py-4"),children:[r.jsx(a.$N,{className:(0,l.cn)(t?"":"hidden"),children:t}),r.jsx(a.Be,{className:(0,l.cn)(d?"":"hidden"),children:d})]}),r.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto px-4 py-2",children:s}),r.jsx(a.cN,{className:(0,l.cn)("border-t border-t-border px-4 py-2 items-center w-full",n?"":"hidden",u?.className),...u,children:n})]})]})})}},85558:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p,dynamic:()=>u});var r=t(19510),a=t(58585),l=t(85431),i=t(24569),d=t(46697),n=t(66267),o=t(64723);let c=(0,t(68570).createProxy)(String.raw`C:\Users\HomePC\Neotree Projects\neotree-editor\app\(dashboard)\app-updates\components\apk-release-form.tsx#ApkReleaseForm`),u="force-dynamic";async function p({searchParams:e}){let{user:s,yes:t}=await (0,n.canAccessPage)();if(s||(0,a.redirect)("/login"),!t)return r.jsx(i.V,{children:r.jsx(d.Zb,{children:r.jsx(d.aY,{className:"p-4 text-xl text-center text-danger bg-danger/10",children:"You don't have sufficient rights to access this page!"})})});let[u,p]=await Promise.all([o.getApkReleases(),o.getApkReleaseDrafts()]),h="string"==typeof e?.apkReleaseId?e?.apkReleaseId:void 0;return(0,r.jsxs)(r.Fragment,{children:[r.jsx(l.D,{children:"APK Release"}),r.jsx(i.V,{children:r.jsx(c,{apkReleases:u.data,apkReleaseDrafts:p.data,apkReleaseId:h,saveApkReleases:o.saveApkReleases})})]})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[9380,1744,1337,3788,2758,9092,4901,4263,1121,264,6360,1098,7157,413,6267,5002,6741,8781,1162,7939,5241,2418,8778,1271,9011,6746,9800],()=>t(57003));module.exports=r})();