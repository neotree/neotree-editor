(()=>{var e={};e.id=3001,e.ids=[3001],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},86624:e=>{"use strict";e.exports=require("querystring")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},51636:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>o}),s(85558),s(56367),s(12699),s(99985),s(96560);var a=s(23191),r=s(88716),l=s(37922),i=s.n(l),d=s(95231),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);s.d(t,n);let o=["",{children:["(dashboard)",{children:["app-updates",{children:["new-apk",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,85558)),"/home/watkay/ReactProjects/neotree-editor/app/(dashboard)/app-updates/new-apk/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,56367)),"/home/watkay/ReactProjects/neotree-editor/app/(dashboard)/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,12699)),"/home/watkay/ReactProjects/neotree-editor/app/(dashboard)/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,99985)),"/home/watkay/ReactProjects/neotree-editor/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/home/watkay/ReactProjects/neotree-editor/app/not-found.tsx"]}],c=["/home/watkay/ReactProjects/neotree-editor/app/(dashboard)/app-updates/new-apk/page.tsx"],u="/(dashboard)/app-updates/new-apk/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/app-updates/new-apk/page",pathname:"/app-updates/new-apk",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},27601:(e,t,s)=>{Promise.resolve().then(s.bind(s,15896)),Promise.resolve().then(s.bind(s,10827))},15896:(e,t,s)=>{"use strict";s.d(t,{ApkReleaseForm:()=>q});var a=s(10326),r=s(17577),l=s(35047),i=s(94464),d=s(90772),n=s(33071),o=s(54432),c=s(31048),u=s(96655),p=s(87673),h=s(34474),x=s(47463),m=s(63685),v=s(39572),f=s(2165),g=s(18048),j=s(77863),b=s(11870),y=s(96221),k=s(92009),A=s(71708);function w({type:e,children:t,inputProps:s,fileDetails:l,onUpload:i,...n}){let[o,{width:c}]=(0,f.Z)(),[u,p]=(0,r.useState)(!1),[h,w]=(0,r.useState)([]),[N,C]=(0,r.useState)(!1),{alert:_}=(0,y.s)(),R=(0,r.useCallback)(async()=>{let e=s?.multiple?h:[h[0]];try{for(let{file:t,metadata:s,fileId:a}of(C(!0),e)){let e=new FormData;e.append("file",t),e.append("fileId",a||(0,x.Z)()),e.append("filename",t.name),e.append("contentType",t.type),e.append("size",`${t.size}`),e.append("metadata",JSON.stringify({...s})),l&&Object.keys(l).forEach(t=>{let s=l[t];e.append(t,JSON.stringify(s))}),await i(e)}p(!1),w([]),_({title:"Success",message:`File${e.length>1?"s":""} uploaded successfully!`,variant:"success"})}catch(t){_({title:"Error",message:`Failed to upload file${e.length>1?"s":""}: ${t.message}`,variant:"error"})}finally{C(!1)}},[i,_,h,s?.multiple,l]),q=(0,r.useCallback)(async e=>{try{let t=[];if(e.target.files?.length)for(let s=0;s<e.target.files.length;s++)t.push(e.target.files[s]);let s=[];for(let e of t){let t,a;let r=URL.createObjectURL(e),l={};if(`${e.type}`.includes("image"))try{let e=await (0,k.p)(r);l={...l,...e},t=r}catch(e){}s.push({fileId:(0,x.Z)(),file:e,url:r,imageURL:t,videoURL:a,metadata:l})}w(s)}catch(e){_({title:"Error",message:e.message})}},[_]);return(0,a.jsxs)(a.Fragment,{children:[N&&a.jsx(b.a,{overlay:!0}),a.jsx(g.u,{open:u,onOpenChange:e=>{p(e),w([])},title:"Upload file",trigger:t,...n,actions:(0,a.jsxs)(a.Fragment,{children:[!h.length&&a.jsx("div",{className:"flex-1"}),a.jsx(d.z,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),!!h.length&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"flex-1"}),a.jsx(d.z,{variant:"destructive",onClick:()=>w([]),children:"Clear"}),(0,a.jsxs)(d.z,{disabled:!h.length,onClick:()=>R(),className:(0,j.cn)(!h.length&&"hidden"),children:[a.jsx(m.Z,{className:"h-4 w-4 mr-2"}),a.jsx("span",{children:"Upload"})]})]})]}),children:(0,a.jsxs)("div",{ref:o,children:[1===h.length&&h.map(e=>{let t=a.jsx(v.Z,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(t=a.jsx(A.E,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:c,src:e.imageURL||"/images/placeholder.png"})),(0,a.jsxs)("div",{className:(0,j.cn)(`
                                        flex
                                        flex-col
                                        gap-y-2
                                        w-full
                                        items-center
                                        justify-center
                                        text-xs
                                    `,!(e.imageURL||e.videoURL)&&""),children:[t,a.jsx("span",{children:e.file.name})]},e.fileId)}),!h.length&&(0,a.jsxs)("div",{className:(0,j.cn)(`
                                    relative
                                    w-full
                                    h-36
                                    bg-primary/20
                                    flex
                                    flex-col
                                    items-center
                                    justify-center
                                    text-primary
                                    uppercase
                                    font-bold
                                    rounded-md
                                    transition-colors
                                    hover:bg-primary/30
                                `,!!h.length&&"hidden"),children:[a.jsx("div",{children:s?.placeholder||"Choose file"}),a.jsx("input",{...s,type:"file",accept:e,value:"",className:(0,j.cn)(`
                                        absolute
                                        left-0
                                        top-0
                                        w-full
                                        h-full
                                        opacity-0
                                    `),onChange:q})]})]})})]})}var N=s(3529);let C=["uploaded","validated","approved","available","deprecated","revoked","rolled_back"],_=()=>({runtimeVersion:"",versionName:"",versionCode:null,status:"uploaded",isAvailable:!1,fileId:null,fileSize:null,checksumSha256:null,signatureSha256:null,validatedAt:null,approvedAt:null,releasedAt:null,releaseNotes:""}),R=e=>{if(""===e||null==e)return null;let t=Number(e);return Number.isFinite(t)?t:null};function q({apkReleases:e,apkReleaseDrafts:t,apkReleaseId:s,saveApkReleases:x}){let m=(0,l.useRouter)(),{alert:v}=(0,y.s)(),{viewOnly:f,mode:g}=(0,N.b)(),[k,A]=(0,r.useState)(!1),q=(0,r.useMemo)(()=>{let s=new Map;for(let e of t){let t=e.data||{},a=t.apkReleaseId||e.apkReleaseDraftId;a&&s.set(a,{...t,apkReleaseId:a,__draft:!0,__draftId:e.apkReleaseDraftId,__updatedAt:e.updatedAt||e.createdAt})}for(let t of e){let e=t.apkReleaseId;e&&(s.has(e)||s.set(e,{...t,__draft:!1}))}return Array.from(s.values()).sort((e,t)=>{let s=new Date(e.__updatedAt||e.updatedAt||e.createdAt||0).getTime();return new Date(t.__updatedAt||t.updatedAt||t.createdAt||0).getTime()-s})},[t,e]),P=(0,r.useMemo)(()=>q[0]||null,[q]);(0,r.useMemo)(()=>s&&q.find(e=>e.apkReleaseId===s)||null,[s,q]);let[S,I]=(0,r.useState)(()=>_()),E=(0,r.useCallback)(async()=>{try{if(f)return;if(A(!0),!S.runtimeVersion)throw Error("Runtime version is required");if(!S.versionName)throw Error("Version name is required");if(!S.versionCode)throw Error("Version code is required");let e={...S,versionCode:Number(S.versionCode||0),validatedAt:S.validatedAt?new Date(S.validatedAt):null,approvedAt:S.approvedAt?new Date(S.approvedAt):null,releasedAt:S.releasedAt?new Date(S.releasedAt):null},t=await x({data:[e]});if(t.errors?.length)throw Error(t.errors.join(", "));m.refresh(),v({title:"Success",message:"APK release saved to drafts.",variant:"success"})}catch(e){v({title:"Error",message:`Failed to save APK release: ${e.message}`,variant:"error"})}finally{A(!1)}},[v,S,f,m,x]),F=(0,r.useCallback)(async e=>{if(f)return;let t=(await i.Z.post("/api/files/upload",e)).data;if(t.errors?.length)throw Error(t.errors.join(", "));let s=t.data;if(!s?.fileId)throw Error("File upload failed");I(e=>({...e,fileId:s.fileId,fileSize:s.size||e.fileSize||null,checksumSha256:s.metadata?.apkChecksumSha256||e.checksumSha256||null,signatureSha256:s.metadata?.apkSignatureSha256||e.signatureSha256||null}))},[f]),V=(0,r.useCallback)(()=>{I(_())},[]);return(0,a.jsxs)(a.Fragment,{children:[k&&a.jsx(b.a,{overlay:!0}),a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"APK release draft"}),P?(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Latest APK: ",P.versionName," (",P.versionCode,")"]}):null,a.jsx("div",{className:"text-xs text-muted-foreground",children:f?"View mode: edits disabled":"development"===g?"Development mode: drafts enabled":`Mode: ${g}`})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(d.z,{variant:"ghost",onClick:()=>m.push("/app-updates"),children:"Cancel"}),a.jsx(d.z,{variant:"primary-outline",onClick:V,disabled:f,children:"Reset"}),a.jsx(d.z,{onClick:E,disabled:k||f,children:"Save Draft"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-6",children:[(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Runtime Version"}),a.jsx(o.I,{value:S.runtimeVersion,onChange:e=>I(t=>({...t,runtimeVersion:e.target.value})),disabled:f})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Version Name"}),a.jsx(o.I,{value:S.versionName,onChange:e=>I(t=>({...t,versionName:e.target.value})),disabled:f})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Version Code"}),a.jsx(o.I,{type:"number",value:S.versionCode??"",onChange:e=>I(t=>({...t,versionCode:R(e.target.value)})),disabled:f})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Status"}),(0,a.jsxs)(h.Ph,{value:S.status,onValueChange:e=>I(t=>({...t,status:e})),disabled:f,children:[a.jsx(h.i4,{children:a.jsx(h.ki,{placeholder:"Select status"})}),a.jsx(h.Bw,{children:C.map(e=>a.jsx(h.Ql,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(u.r,{checked:S.isAvailable,onCheckedChange:e=>I(t=>({...t,isAvailable:e})),disabled:f}),a.jsx(c._,{children:"Available to devices"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(w,{type:".apk,application/vnd.android.package-archive",inputProps:{multiple:!1,placeholder:"Choose APK"},onUpload:F,children:a.jsx(d.z,{variant:"primary-outline",disabled:f,children:"Upload APK"})}),a.jsx("span",{className:(0,j.cn)("text-xs",!S.fileId&&"text-muted-foreground"),children:S.fileId?`File: ${S.fileId}`:"No file uploaded"})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Checksum (SHA-256)"}),a.jsx(o.I,{value:S.checksumSha256||"",disabled:!0})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Signature (SHA-256)"}),a.jsx(o.I,{value:S.signatureSha256||"",disabled:!0})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Validated At"}),a.jsx(o.I,{type:"datetime-local",value:S.validatedAt||"",onChange:e=>I(t=>({...t,validatedAt:e.target.value||null})),disabled:f})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Approved At"}),a.jsx(o.I,{type:"datetime-local",value:S.approvedAt||"",onChange:e=>I(t=>({...t,approvedAt:e.target.value||null})),disabled:f})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Released At"}),a.jsx(o.I,{type:"datetime-local",value:S.releasedAt||"",onChange:e=>I(t=>({...t,releasedAt:e.target.value||null})),disabled:f})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[a.jsx(c._,{children:"Release Notes"}),a.jsx(p.g,{value:S.releaseNotes||"",onChange:e=>I(t=>({...t,releaseNotes:e.target.value})),disabled:f})]})]})})]})}},18048:(e,t,s)=>{"use strict";s.d(t,{u:()=>d});var a=s(10326);s(17577);var r=s(62288),l=s(77863);let i=(0,s(60114).Ue)((e,t)=>({modals:{},open(t){e(e=>({modals:{...e.modals,[t]:!0}}))},toggle(s){let a=t().modals;e(e=>({modals:{...e.modals,[s]:!a[s]}}))},close(t){e(e=>({modals:{...e.modals,[t]:!1}}))},isOpen:e=>!!t().modals[e],set(t){e(e=>({modals:{...e.modals,...t}}))}}));function d({id:e,children:t,title:s,description:d,actions:n,trigger:o,contentProps:c,footerProps:u,...p}){let{close:h,isOpen:x,set:m}=i();return a.jsx(a.Fragment,{children:(0,a.jsxs)(r.Vq,{...p,open:(e?x(e):void 0)||p.open,onOpenChange:t=>{e&&m({[e]:t}),p?.onOpenChange?.(t)},children:[o,(0,a.jsxs)(r.cZ,{hideCloseButton:!0,className:(0,l.cn)("flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",c?.className),...c,children:[(0,a.jsxs)(r.fK,{className:(0,l.cn)(s||d?"":"hidden","border-b border-b-border px-4 py-4"),children:[a.jsx(r.$N,{className:(0,l.cn)(s?"":"hidden"),children:s}),a.jsx(r.Be,{className:(0,l.cn)(d?"":"hidden"),children:d})]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto px-4 py-2",children:t}),a.jsx(r.cN,{className:(0,l.cn)("border-t border-t-border px-4 py-2 items-center w-full",n?"":"hidden",u?.className),...u,children:n})]})]})})}},85558:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p,dynamic:()=>u});var a=s(19510),r=s(58585),l=s(85431),i=s(24569),d=s(46697),n=s(66267),o=s(64723);let c=(0,s(68570).createProxy)(String.raw`/home/watkay/ReactProjects/neotree-editor/app/(dashboard)/app-updates/components/apk-release-form.tsx#ApkReleaseForm`),u="force-dynamic";async function p({searchParams:e}){let{user:t,yes:s}=await (0,n.canAccessPage)();if(t||(0,r.redirect)("/login"),!s)return a.jsx(i.V,{children:a.jsx(d.Zb,{children:a.jsx(d.aY,{className:"p-4 text-xl text-center text-danger bg-danger/10",children:"You don't have sufficient rights to access this page!"})})});let[u,p]=await Promise.all([o.getApkReleases(),o.getApkReleaseDrafts()]),h="string"==typeof e?.apkReleaseId?e?.apkReleaseId:void 0;return(0,a.jsxs)(a.Fragment,{children:[a.jsx(l.D,{children:"APK Release"}),a.jsx(i.V,{children:a.jsx(c,{apkReleases:u.data,apkReleaseDrafts:p.data,apkReleaseId:h,saveApkReleases:o.saveApkReleases})})]})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9380,1744,1337,3788,2758,9092,4901,4263,1121,3579,6360,1098,7157,413,6267,5002,6741,8781,1162,7939,5241,2418,2724,1271,3173,7645,5356],()=>s(51636));module.exports=a})();