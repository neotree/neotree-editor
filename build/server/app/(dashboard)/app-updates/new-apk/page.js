(()=>{var e={};e.id=3001,e.ids=[3001],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},86624:e=>{"use strict";e.exports=require("querystring")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},94437:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>o}),t(85558),t(56367),t(12699),t(99985),t(96560);var a=t(23191),r=t(88716),l=t(37922),i=t.n(l),d=t(95231),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(s,n);let o=["",{children:["(dashboard)",{children:["app-updates",{children:["new-apk",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,85558)),"/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/app-updates/new-apk/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,56367)),"/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/layout.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,12699)),"/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,99985)),"/home/farai/Workbench/Neotree/neotree-editor/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/home/farai/Workbench/Neotree/neotree-editor/app/not-found.tsx"]}],c=["/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/app-updates/new-apk/page.tsx"],u="/(dashboard)/app-updates/new-apk/page",p={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(dashboard)/app-updates/new-apk/page",pathname:"/app-updates/new-apk",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},65224:(e,s,t)=>{Promise.resolve().then(t.bind(t,15896)),Promise.resolve().then(t.bind(t,10827))},15896:(e,s,t)=>{"use strict";t.d(s,{ApkReleaseForm:()=>R});var a=t(10326),r=t(17577),l=t(35047),i=t(94464),d=t(90772),n=t(33071),o=t(54432),c=t(31048),u=t(96655),p=t(87673),h=t(34474),x=t(47463),m=t(63685),f=t(39572),v=t(2165),g=t(18048),j=t(77863),b=t(11870),k=t(96221),y=t(92009),A=t(71708);function N({type:e,children:s,inputProps:t,fileDetails:l,onUpload:i,...n}){let[o,{width:c}]=(0,v.Z)(),[u,p]=(0,r.useState)(!1),[h,N]=(0,r.useState)([]),[w,C]=(0,r.useState)(!1),{alert:_}=(0,k.s)(),q=(0,r.useCallback)(async()=>{let e=t?.multiple?h:[h[0]];try{for(let{file:s,metadata:t,fileId:a}of(C(!0),e)){let e=new FormData;e.append("file",s),e.append("fileId",a||(0,x.Z)()),e.append("filename",s.name),e.append("contentType",s.type),e.append("size",`${s.size}`),e.append("metadata",JSON.stringify({...t})),l&&Object.keys(l).forEach(s=>{let t=l[s];e.append(s,JSON.stringify(t))}),await i(e)}p(!1),N([]),_({title:"Success",message:`File${e.length>1?"s":""} uploaded successfully!`,variant:"success"})}catch(s){_({title:"Error",message:`Failed to upload file${e.length>1?"s":""}: ${s.message}`,variant:"error"})}finally{C(!1)}},[i,_,h,t?.multiple,l]),R=(0,r.useCallback)(async e=>{try{let s=[];if(e.target.files?.length)for(let t=0;t<e.target.files.length;t++)s.push(e.target.files[t]);let t=[];for(let e of s){let s,a;let r=URL.createObjectURL(e),l={};if(`${e.type}`.includes("image"))try{let e=await (0,y.p)(r);l={...l,...e},s=r}catch(e){}t.push({fileId:(0,x.Z)(),file:e,url:r,imageURL:s,videoURL:a,metadata:l})}N(t)}catch(e){_({title:"Error",message:e.message})}},[_]);return(0,a.jsxs)(a.Fragment,{children:[w&&a.jsx(b.a,{overlay:!0}),a.jsx(g.u,{open:u,onOpenChange:e=>{p(e),N([])},title:"Upload file",trigger:s,...n,actions:(0,a.jsxs)(a.Fragment,{children:[!h.length&&a.jsx("div",{className:"flex-1"}),a.jsx(d.z,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),!!h.length&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"flex-1"}),a.jsx(d.z,{variant:"destructive",onClick:()=>N([]),children:"Clear"}),(0,a.jsxs)(d.z,{disabled:!h.length,onClick:()=>q(),className:(0,j.cn)(!h.length&&"hidden"),children:[a.jsx(m.Z,{className:"h-4 w-4 mr-2"}),a.jsx("span",{children:"Upload"})]})]})]}),children:(0,a.jsxs)("div",{ref:o,children:[1===h.length&&h.map(e=>{let s=a.jsx(f.Z,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(s=a.jsx(A.E,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:c,src:e.imageURL||"/images/placeholder.png"})),(0,a.jsxs)("div",{className:(0,j.cn)(`
                                        flex
                                        flex-col
                                        gap-y-2
                                        w-full
                                        items-center
                                        justify-center
                                        text-xs
                                    `,!(e.imageURL||e.videoURL)&&""),children:[s,a.jsx("span",{children:e.file.name})]},e.fileId)}),!h.length&&(0,a.jsxs)("div",{className:(0,j.cn)(`
                                    relative
                                    w-full
                                    h-36
                                    bg-primary/20
                                    flex
                                    flex-col
                                    items-center
                                    justify-center
                                    text-primary
                                    uppercase
                                    font-bold
                                    rounded-md
                                    transition-colors
                                    hover:bg-primary/30
                                `,!!h.length&&"hidden"),children:[a.jsx("div",{children:t?.placeholder||"Choose file"}),a.jsx("input",{...t,type:"file",accept:e,value:"",className:(0,j.cn)(`
                                        absolute
                                        left-0
                                        top-0
                                        w-full
                                        h-full
                                        opacity-0
                                    `),onChange:R})]})]})})]})}var w=t(3529);let C=["uploaded","validated","approved","available","deprecated","revoked","rolled_back"],_=()=>({runtimeVersion:"",versionName:"",versionCode:null,status:"uploaded",isAvailable:!1,fileId:null,fileSize:null,checksumSha256:null,signatureSha256:null,validatedAt:null,approvedAt:null,releasedAt:null,releaseNotes:""}),q=e=>{if(""===e||null==e)return null;let s=Number(e);return Number.isFinite(s)?s:null};function R({apkReleases:e,apkReleaseDrafts:s,apkReleaseId:t,saveApkReleases:x}){let m=(0,l.useRouter)(),{alert:f}=(0,k.s)(),{viewOnly:v,mode:g}=(0,w.b)(),[y,A]=(0,r.useState)(!1),R=(0,r.useMemo)(()=>{let t=new Map;for(let e of s){let s=e.data||{},a=s.apkReleaseId||e.apkReleaseDraftId;a&&t.set(a,{...s,apkReleaseId:a,__draft:!0,__draftId:e.apkReleaseDraftId,__updatedAt:e.updatedAt||e.createdAt})}for(let s of e){let e=s.apkReleaseId;e&&(t.has(e)||t.set(e,{...s,__draft:!1}))}return Array.from(t.values()).sort((e,s)=>{let t=new Date(e.__updatedAt||e.updatedAt||e.createdAt||0).getTime();return new Date(s.__updatedAt||s.updatedAt||s.createdAt||0).getTime()-t})},[s,e]),S=(0,r.useMemo)(()=>R[0]||null,[R]);(0,r.useMemo)(()=>t&&R.find(e=>e.apkReleaseId===t)||null,[t,R]);let[P,I]=(0,r.useState)(()=>_()),E=(0,r.useCallback)(async()=>{try{if(v)return;if(A(!0),!P.runtimeVersion)throw Error("Runtime version is required");if(!P.versionName)throw Error("Version name is required");if(!P.versionCode)throw Error("Version code is required");let e={...P,versionCode:Number(P.versionCode||0),validatedAt:P.validatedAt?new Date(P.validatedAt):null,approvedAt:P.approvedAt?new Date(P.approvedAt):null,releasedAt:P.releasedAt?new Date(P.releasedAt):null},s=await x({data:[e]});if(s.errors?.length)throw Error(s.errors.join(", "));m.refresh(),f({title:"Success",message:"APK release saved to drafts.",variant:"success"})}catch(e){f({title:"Error",message:`Failed to save APK release: ${e.message}`,variant:"error"})}finally{A(!1)}},[f,P,v,m,x]),F=(0,r.useCallback)(async e=>{if(v)return;let s=(await i.Z.post("/api/files/upload",e)).data;if(s.errors?.length)throw Error(s.errors.join(", "));let t=s.data;if(!t?.fileId)throw Error("File upload failed");I(e=>({...e,fileId:t.fileId,fileSize:t.size||e.fileSize||null,checksumSha256:t.metadata?.apkChecksumSha256||e.checksumSha256||null,signatureSha256:t.metadata?.apkSignatureSha256||e.signatureSha256||null}))},[v]),V=(0,r.useCallback)(()=>{I(_())},[]);return(0,a.jsxs)(a.Fragment,{children:[y&&a.jsx(b.a,{overlay:!0}),a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"APK release draft"}),S?(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Latest APK: ",S.versionName," (",S.versionCode,")"]}):null,a.jsx("div",{className:"text-xs text-muted-foreground",children:v?"View mode: edits disabled":"development"===g?"Development mode: drafts enabled":`Mode: ${g}`})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(d.z,{variant:"ghost",onClick:()=>m.push("/app-updates"),children:"Cancel"}),a.jsx(d.z,{variant:"primary-outline",onClick:V,disabled:v,children:"Reset"}),a.jsx(d.z,{onClick:E,disabled:y||v,children:"Save Draft"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-6",children:[(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Runtime Version"}),a.jsx(o.I,{value:P.runtimeVersion,onChange:e=>I(s=>({...s,runtimeVersion:e.target.value})),disabled:v})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Version Name"}),a.jsx(o.I,{value:P.versionName,onChange:e=>I(s=>({...s,versionName:e.target.value})),disabled:v})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Version Code"}),a.jsx(o.I,{type:"number",value:P.versionCode??"",onChange:e=>I(s=>({...s,versionCode:q(e.target.value)})),disabled:v})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Status"}),(0,a.jsxs)(h.Ph,{value:P.status,onValueChange:e=>I(s=>({...s,status:e})),disabled:v,children:[a.jsx(h.i4,{children:a.jsx(h.ki,{placeholder:"Select status"})}),a.jsx(h.Bw,{children:C.map(e=>a.jsx(h.Ql,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(u.r,{checked:P.isAvailable,onCheckedChange:e=>I(s=>({...s,isAvailable:e})),disabled:v}),a.jsx(c._,{children:"Available to devices"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(N,{type:".apk,application/vnd.android.package-archive",inputProps:{multiple:!1,placeholder:"Choose APK"},onUpload:F,children:a.jsx(d.z,{variant:"primary-outline",disabled:v,children:"Upload APK"})}),a.jsx("span",{className:(0,j.cn)("text-xs",!P.fileId&&"text-muted-foreground"),children:P.fileId?`File: ${P.fileId}`:"No file uploaded"})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Checksum (SHA-256)"}),a.jsx(o.I,{value:P.checksumSha256||"",disabled:!0})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Signature (SHA-256)"}),a.jsx(o.I,{value:P.signatureSha256||"",disabled:!0})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Validated At"}),a.jsx(o.I,{type:"datetime-local",value:P.validatedAt||"",onChange:e=>I(s=>({...s,validatedAt:e.target.value||null})),disabled:v})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Approved At"}),a.jsx(o.I,{type:"datetime-local",value:P.approvedAt||"",onChange:e=>I(s=>({...s,approvedAt:e.target.value||null})),disabled:v})]}),(0,a.jsxs)("div",{children:[a.jsx(c._,{children:"Released At"}),a.jsx(o.I,{type:"datetime-local",value:P.releasedAt||"",onChange:e=>I(s=>({...s,releasedAt:e.target.value||null})),disabled:v})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[a.jsx(c._,{children:"Release Notes"}),a.jsx(p.g,{value:P.releaseNotes||"",onChange:e=>I(s=>({...s,releaseNotes:e.target.value})),disabled:v})]})]})})]})}},18048:(e,s,t)=>{"use strict";t.d(s,{u:()=>d});var a=t(10326);t(17577);var r=t(62288),l=t(77863);let i=(0,t(60114).Ue)((e,s)=>({modals:{},open(s){e(e=>({modals:{...e.modals,[s]:!0}}))},toggle(t){let a=s().modals;e(e=>({modals:{...e.modals,[t]:!a[t]}}))},close(s){e(e=>({modals:{...e.modals,[s]:!1}}))},isOpen:e=>!!s().modals[e],set(s){e(e=>({modals:{...e.modals,...s}}))}}));function d({id:e,children:s,title:t,description:d,actions:n,trigger:o,contentProps:c,footerProps:u,...p}){let{close:h,isOpen:x,set:m}=i();return a.jsx(a.Fragment,{children:(0,a.jsxs)(r.Vq,{...p,open:(e?x(e):void 0)||p.open,onOpenChange:s=>{e&&m({[e]:s}),p?.onOpenChange?.(s)},children:[o,(0,a.jsxs)(r.cZ,{hideCloseButton:!0,className:(0,l.cn)("flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",c?.className),...c,children:[(0,a.jsxs)(r.fK,{className:(0,l.cn)(t||d?"":"hidden","border-b border-b-border px-4 py-4"),children:[a.jsx(r.$N,{className:(0,l.cn)(t?"":"hidden"),children:t}),a.jsx(r.Be,{className:(0,l.cn)(d?"":"hidden"),children:d})]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto px-4 py-2",children:s}),a.jsx(r.cN,{className:(0,l.cn)("border-t border-t-border px-4 py-2 items-center w-full",n?"":"hidden",u?.className),...u,children:n})]})]})})}},85558:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p,dynamic:()=>u});var a=t(19510),r=t(58585),l=t(85431),i=t(24569),d=t(46697),n=t(66267),o=t(64723);let c=(0,t(68570).createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/app-updates/components/apk-release-form.tsx#ApkReleaseForm`),u="force-dynamic";async function p({searchParams:e}){let{user:s,yes:t}=await (0,n.canAccessPage)();if(s||(0,r.redirect)("/login"),!t)return a.jsx(i.V,{children:a.jsx(d.Zb,{children:a.jsx(d.aY,{className:"p-4 text-xl text-center text-danger bg-danger/10",children:"You don't have sufficient rights to access this page!"})})});let[u,p]=await Promise.all([o.getApkReleases(),o.getApkReleaseDrafts()]),h="string"==typeof e?.apkReleaseId?e?.apkReleaseId:void 0;return(0,a.jsxs)(a.Fragment,{children:[a.jsx(l.D,{children:"APK Release"}),a.jsx(i.V,{children:a.jsx(c,{apkReleases:u.data,apkReleaseDrafts:p.data,apkReleaseId:h,saveApkReleases:o.saveApkReleases})})]})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[9380,1744,1337,3788,2758,9092,4901,4263,1121,3579,6360,1098,7157,413,6267,5002,6741,8781,1162,7939,5241,2418,8778,1271,7857,9087,5179],()=>t(94437));module.exports=a})();