"use strict";(()=>{var e={};e.id=4832,e.ids=[4832],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},96119:e=>{e.exports=require("perf_hooks")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},18269:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>c});var a=t(49303),o=t(88716),n=t(60670),i=t(87070),u=t(73508);async function c(e){let r=await e.json(),t=await (0,u.setPassword)(r);return i.NextResponse.json(t)}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/users/set-password/route",pathname:"/api/users/set-password",filename:"route",bundlePath:"app/api/users/set-password/route"},resolvedPagePath:"/home/watkay/ReactProjects/neotree-editor/app/api/users/set-password/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:p}=d,w="/api/users/set-password/route";function h(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:f})}},73508:(e,r,t)=>{t.r(r),t.d(r,{$$ACTION_0:()=>A,$$ACTION_1:()=>_,$$ACTION_2:()=>P,$$ACTION_3:()=>T,$$ACTION_4:()=>C,createUsers:()=>E,deleteUsers:()=>O,getFullUser:()=>v,getUser:()=>R,getUserMini:()=>j,getUsers:()=>I,isEmailRegistered:()=>q,resetUsersPasswords:()=>x,searchUsers:()=>U,setPassword:()=>$,updateUsers:()=>Z});var s=t(24330);t(60166);var a=t(67096),o=t.n(a),n=t(57745),i=t(9576),u=t(8629),c=t(10413),d=t(93567),l=t(47625);async function f(e){for(let r of e)await c.Z.update(d.users).set({password:""}).where((0,n.eq)(d.users.userId,r));return!0}async function p(e){for(let r of e){let e=new Date;await c.Z.update(d.users).set({deletedAt:e,email:r,displayName:"Former user",firstName:null,lastName:null,avatar:null,avatar_md:null,avatar_sm:null}).where((0,n.eq)(d.users.userId,r))}return!0}async function w(e,r){let t=[];for(let r of e){let e=await o().genSalt(10),s=await o().hash(r.password||(0,i.Z)(),e);t.push({...r,password:s,userId:r.userId||(0,i.Z)()})}let s={inserted:[],success:!1};try{if(await c.Z.insert(d.users).values(t),r?.returnInserted){let e=await (0,l.yT)({userIds:t.map(e=>e.userId)});s.inserted=e.data}s.success=!0}catch(e){s.error=e.message}finally{return s}}async function h(e,r){let t=[];for(let{userId:s,data:{userId:a,deletedAt:o,id:i,createdAt:f,updatedAt:p,email:w,...h}}of e)try{let e=u.C.test(s)?(0,n.eq)(d.users.email,s):(0,n.eq)(d.users.userId,s);await c.Z.update(d.users).set(h).where(e);let a=r?.returnUpdated?await (0,l.IQ)(s):void 0;t.push({userId:s,user:a})}catch(e){t.push({userId:s,error:e.message})}return t}var y=t(57435),m=t(70733),b=t(66267),g=t(40618);let x=f;async function q(e){try{let r=await (0,l.IQ)(e);return{yes:!!r,isActive:!!r?.isActive}}catch(e){return y.Z.error("getUser ERROR:",e),{errors:[e.message],yes:!1}}}async function R(e){try{return await (0,b.isAllowed)("get_user"),await (0,l.IQ)(e)||null}catch(e){return y.Z.error("getUser ERROR:",e),null}}async function j(e){try{return await (0,b.isAllowed)("get_user"),await (0,l.$M)(e)||null}catch(e){return y.Z.error("getUserMini ERROR:",e),null}}async function v(e){try{return await (0,b.isAllowed)("get_user"),await (0,l.C)(e)||null}catch(e){return y.Z.error("getFullUser ERROR:",e),null}}let I=(0,s.j)("c5514b7679b6c600fb116e72f23fdd076bc97ac3",A);async function A(...e){try{return await (0,b.isAllowed)("get_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}let U=(0,s.j)("9696bfffca19346bf89c5ba78b70e7c7f30ddc5a",_);async function _(...e){try{return await (0,b.isAllowed)("search_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}async function O(e){if(await (0,b.isAllowed)("delete_users"),e.length){let{data:r}=await (0,l.yT)({userIds:e});await p(e)}return!0}let E=(0,s.j)("dcbdf5b4e56da69434c179de89b3624b2723b670",P);async function P(...e){try{await (0,b.isAllowed)("create_users");let r=await w(...e);for(let r of e[0])try{await (0,m.n)({userId:r.userId,hoursValid:1})}catch(e){}return r}catch(e){throw y.Z.error("createUsers ERROR",e),e}}let Z=(0,s.j)("7c059ad36ec696816e015d837e81d99f35302949",T);async function T(...e){try{return await (0,b.isAllowed)("update_users"),await h(...e)}catch(e){throw y.Z.error("updateUsers ERROR",e),e}}let $=(0,s.j)("1a344b698c820488aa3eeebdf84313d6c6c2fa06",C);async function C(e){try{if(!e.password)throw Error("Missing: password");if(!e.email)throw Error("Missing: email");if(e.password.length<6)throw Error("Password is too short: min 6 characters");if(e.password!==e.passwordConfirm)throw Error("Password confirmation does not match!");let r=await o().genSalt(10),t=await o().hash(e.password,r),s=await h([{userId:e.email,data:{password:t}}]);if(s.filter(e=>e.error).length)throw Error(s.filter(e=>e.error).map(e=>e.error).join(", "));return{success:!0}}catch(e){return y.Z.error("setPassword ERROR",e),{success:!1,errors:[e.message]}}}(0,g.h)([x,q,R,j,v,I,U,O,E,Z,$]),(0,s.j)("756f854d60219b5b63cf63ea9fddced48eb33662",x),(0,s.j)("4588c65b6fb85ba2650217826247ed78e49be95a",q),(0,s.j)("770a8e41849bda456313154fb660d8045d3089c1",R),(0,s.j)("56d1e39e5ef168c8a44e5b6533cac49737d0836f",j),(0,s.j)("ef593127d00e8e5d39c70094fa84754b13d96377",v),(0,s.j)("05e67aa00650fc8732ea884d2fa5edfffcd4f5dc",I),(0,s.j)("349fa565a9e7645859203619f67e35d103d96fc3",U),(0,s.j)("2a51d2b91ddb4ac57bffd72136b2a8e4811255a6",O),(0,s.j)("439bcc76f1d754796c6752dc79e8c109ae8f950c",E),(0,s.j)("1afe159261df7780f0ac2e2aba67daaf2ff555dc",Z),(0,s.j)("2dcc703dc0710c185b243f54d71a10a5e92689b9",$)},70733:(e,r,t)=>{t.d(r,{n:()=>i});var s=t(51744),a=t.n(s),o=t(10413),n=t(93567);async function i({userId:e,hoursValid:r}){return(await o.Z.insert(n.tokens).values({userId:e,validUntil:a()(new Date).add(r,"hour").toDate(),token:Math.floor(1e5+9e5*Math.random())}).returning())[0]}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9380,1744,1337,3788,2758,5059,413,6267],()=>t(18269));module.exports=s})();