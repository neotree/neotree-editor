(()=>{var e={};e.id=6688,e.ids=[6688],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},22037:e=>{"use strict";e.exports=require("os")},4074:e=>{"use strict";e.exports=require("perf_hooks")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},79324:(e,r,s)=>{"use strict";s.r(r),s.d(r,{originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var t={};s.r(t),s.d(t,{POST:()=>h});var a=s(49303),n=s(88716),i=s(60670),u=s(87070),o=s(41482),c=s.n(o),d=s(57435),l=s(72761),p=s(47625),f=s(73508);async function h(e){try{if(d.Z.log(`[POST]: ${e.url}`),!(await (0,l.$)()).yes)return u.NextResponse.json({errors:["Unauthorised"]});let{email:r,password:s,passwordConfirm:t}=await e.json(),{errors:a}=await (0,f.setPassword)({email:r,password:s,passwordConfirm:t});if(a?.length)return u.NextResponse.json({errors:a});let n=r?await (0,p.C)(r):null;if(!n)return u.NextResponse.json({errors:["Something went wrong, try again!"]});let i={id:n.id,displayName:n.displayName,userId:n.userId,email:n.email,role:n.role},o=await c().sign(i,process.env.JWT_SECRET);return u.NextResponse.json({data:{bearerToken:o,user:i}})}catch(e){return d.Z.error("[POST] /api/sign-up",e.message),u.NextResponse.json({errors:["Internal Error"]})}}let w=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/app/auth/sign-up/route",pathname:"/api/app/auth/sign-up",filename:"route",bundlePath:"app/api/app/auth/sign-up/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor-master/app/api/app/auth/sign-up/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:g}=w,b="/api/app/auth/sign-up/route";function x(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},73508:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$ACTION_0:()=>A,$$ACTION_1:()=>E,$$ACTION_2:()=>N,$$ACTION_3:()=>Z,$$ACTION_4:()=>T,createUsers:()=>_,deleteUsers:()=>O,getFullUser:()=>j,getUser:()=>R,getUserMini:()=>v,getUsers:()=>I,isEmailRegistered:()=>q,resetUsersPasswords:()=>x,searchUsers:()=>U,setPassword:()=>P,updateUsers:()=>M});var t=s(24330);s(60166);var a=s(67096),n=s.n(a),i=s(57745),u=s(9576),o=s(8629),c=s(10413),d=s(93567),l=s(47625);async function p(e){for(let r of e)await c.Z.update(d.users).set({password:""}).where((0,i.eq)(d.users.userId,r));return!0}async function f(e){for(let r of e){let e=new Date;await c.Z.update(d.users).set({deletedAt:e,email:r,displayName:"Former user",firstName:null,lastName:null,avatar:null,avatar_md:null,avatar_sm:null}).where((0,i.eq)(d.users.userId,r))}return!0}async function h(e,r){let s=[];for(let r of e){let e=await n().genSalt(10),t=await n().hash(r.password||(0,u.Z)(),e);s.push({...r,password:t,userId:r.userId||(0,u.Z)()})}let t={inserted:[],success:!1};try{if(await c.Z.insert(d.users).values(s),r?.returnInserted){let e=await (0,l.yT)({userIds:s.map(e=>e.userId)});t.inserted=e.data}t.success=!0}catch(e){t.error=e.message}finally{return t}}async function w(e,r){let s=[];for(let{userId:t,data:{userId:a,deletedAt:n,id:u,createdAt:p,updatedAt:f,email:h,...w}}of e)try{let e=o.C.test(t)?(0,i.eq)(d.users.email,t):(0,i.eq)(d.users.userId,t);await c.Z.update(d.users).set(w).where(e);let a=r?.returnUpdated?await (0,l.IQ)(t):void 0;s.push({userId:t,user:a})}catch(e){s.push({userId:t,error:e.message})}return s}var m=s(57435),y=s(70733),g=s(66267),b=s(40618);let x=p;async function q(e){try{let r=await (0,l.IQ)(e);return{yes:!!r,isActive:!!r?.isActive}}catch(e){return m.Z.error("getUser ERROR:",e),{errors:[e.message],yes:!1}}}async function R(e){try{return await (0,g.isAllowed)("get_user"),await (0,l.IQ)(e)||null}catch(e){return m.Z.error("getUser ERROR:",e),null}}async function v(e){try{return await (0,g.isAllowed)("get_user"),await (0,l.$M)(e)||null}catch(e){return m.Z.error("getUserMini ERROR:",e),null}}async function j(e){try{return await (0,g.isAllowed)("get_user"),await (0,l.C)(e)||null}catch(e){return m.Z.error("getFullUser ERROR:",e),null}}let I=(0,t.j)("7ed58da9bdd1fcaabea1b4a8c01155185ea42d50",A);async function A(...e){try{return await (0,g.isAllowed)("get_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}let U=(0,t.j)("30776f4c4a368e78980f8117cefaf77df1f67743",E);async function E(...e){try{return await (0,g.isAllowed)("search_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}async function O(e){if(await (0,g.isAllowed)("delete_users"),e.length){let{data:r}=await (0,l.yT)({userIds:e});await f(e)}return!0}let _=(0,t.j)("46092427241ea6fbfbd33cf01bdd70a14cf92f90",N);async function N(...e){try{await (0,g.isAllowed)("create_users");let r=await h(...e);for(let r of e[0])try{await (0,y.n)({userId:r.userId,hoursValid:1})}catch(e){}return r}catch(e){throw m.Z.error("createUsers ERROR",e),e}}let M=(0,t.j)("e643f22d4242e305446816ef0c71ada1ec53143f",Z);async function Z(...e){try{return await (0,g.isAllowed)("update_users"),await w(...e)}catch(e){throw m.Z.error("updateUsers ERROR",e),e}}let P=(0,t.j)("2c56cdafc83bcdd180a689448b216edb18936af9",T);async function T(e){try{if(!e.password)throw Error("Missing: password");if(!e.email)throw Error("Missing: email");if(e.password.length<6)throw Error("Password is too short: min 6 characters");if(e.password!==e.passwordConfirm)throw Error("Password confirmation does not match!");let r=await n().genSalt(10),s=await n().hash(e.password,r),t=await w([{userId:e.email,data:{password:s}}]);if(t.filter(e=>e.error).length)throw Error(t.filter(e=>e.error).map(e=>e.error).join(", "));return{success:!0}}catch(e){return m.Z.error("setPassword ERROR",e),{success:!1,errors:[e.message]}}}(0,b.h)([x,q,R,v,j,I,U,O,_,M,P]),(0,t.j)("3c8eb70807e489f76cd8c5cf36811aa1d695ca88",x),(0,t.j)("8002a85e229f7939cdcf277a95e859c8310681f6",q),(0,t.j)("15e9024c7a317568a0bfe153647ab40d4a782996",R),(0,t.j)("c9c04e16e9ed621d6680f86938bacfd7201cab16",v),(0,t.j)("67f588a162fcecb1a75791f69b6cff347ad9923a",j),(0,t.j)("38db96d8998f5107454ecf82118abd7af347d295",I),(0,t.j)("1977ec2d9d02f9d05c365f2b0c361b6bda56d4b9",U),(0,t.j)("cdb03413b17de7f459a06c1da6dcecd39449a521",O),(0,t.j)("1a887bafa5bdbb80006e55a4af6cb4a8b6c64b5d",_),(0,t.j)("86bb37e35f63659c1e7cf3ba878f97f6925e4521",M),(0,t.j)("1d50295030f25981c6202bf941a3b2576a09a317",P)},70733:(e,r,s)=>{"use strict";s.d(r,{n:()=>u});var t=s(51744),a=s.n(t),n=s(10413),i=s(93567);async function u({userId:e,hoursValid:r}){return(await n.Z.insert(i.tokens).values({userId:e,validUntil:a()(new Date).add(r,"hour").toDate(),token:Math.floor(1e5+9e5*Math.random())}).returning())[0]}},13974:e=>{function r(e,r,s,t){return Math.round(e/s)+" "+t+(r>=1.5*s?"s":"")}e.exports=function(e,s){s=s||{};var t,a,n=typeof e;if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(r){var s=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return 864e5*s;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*s;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*s;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===n&&isFinite(e))return s.long?(t=Math.abs(e))>=864e5?r(e,t,864e5,"day"):t>=36e5?r(e,t,36e5,"hour"):t>=6e4?r(e,t,6e4,"minute"):t>=1e3?r(e,t,1e3,"second"):e+" ms":(a=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":a>=36e5?Math.round(e/36e5)+"h":a>=6e4?Math.round(e/6e4)+"m":a>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1633,1744,1337,3788,2758,5059,1482,413,6267],()=>s(79324));module.exports=t})();