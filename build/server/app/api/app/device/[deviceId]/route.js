"use strict";(()=>{var e={};e.id=9666,e.ids=[9666],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},17242:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>h,routeModule:()=>D,serverHooks:()=>w,staticGenerationAsyncStorage:()=>q});var s={};t.r(s),t.d(s,{GET:()=>x});var a=t(49303),i=t(88716),o=t(60670),n=t(87070),c=t(57435),d=t(72761),u=t(24330);t(60166);var l=t(81339),p=t(25060),f=t(18496),g=t(55249);async function y(){let e=await (0,f.y)();if(e?.errors)throw Error(e.errors.join(", "));let r=Object.values((await (0,p.Nb)()).data).filter(e=>e).map(e=>new Date(e).getTime());return{version:e.data?.dataVersion,lastPublishDate:e.data?.lastPublishDate,lastUpdatedDate:r.length?new Date(Math.max(...r)):e.data?.lastPublishDate}}async function m(e){if(!e)throw Error("Device ID not provided!");let r=await (0,f.y)();if(r?.errors)throw Error(r.errors.join(", "));let t=e?await (0,l.$s)({deviceId:e}):{data:null};if(t?.errors)throw Error(t.errors.join(", "));let s=t.data;if(!s){let r=await (0,g.w)({data:[{deviceId:e,details:{scripts_count:0}}],returnSaved:!0});if(r?.errors)throw Error(r.errors.join(", "));s=r.inserted[0]}return s}async function x(e,{params:{deviceId:r}}){try{if(c.Z.log(`[GET]: ${e.url}`),!(await (0,d.$)()).yes)return n.NextResponse.json({errors:["Unauthorised"]});let t=y(),s=m(r);return n.NextResponse.json({device:s,data:t})}catch(r){return c.Z.error(`[ERROR]: ${e.url}`,r.message),n.NextResponse.json({errors:["Internal Error"]})}}(0,t(40618).h)([y,m]),(0,u.j)("28519f3d0d372a5427a0004fc83efcfccb3958ba",y),(0,u.j)("0ae62b4fa077c9a5c163628d664f454ab44d6337",m);let D=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/app/device/[deviceId]/route",pathname:"/api/app/device/[deviceId]",filename:"route",bundlePath:"app/api/app/device/[deviceId]/route"},resolvedPagePath:"/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/api/app/device/[deviceId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:q,serverHooks:w}=D,v="/api/app/device/[deviceId]/route";function A(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:q})}},18496:(e,r,t)=>{t.d(r,{y:()=>i});var s=t(10413),a=t(57435);async function i(){try{return{data:await s.Z.query.editorInfo.findFirst()||null}}catch(e){return a.Z.error("_getEditorInfo ERROR",e.message),{data:null,errors:[e.message]}}}},25060:(e,r,t)=>{t.d(r,{Yi:()=>p,Ur:()=>u,Nb:()=>d,Ic:()=>l});var s=t(60938),a=t(57435),i=t(57418),o=t(10413),n=t(81445);let c={configKeys:null,diagnoses:null,screens:null,scripts:null,configKeysDrafts:null,diagnosesDrafts:null,screensDrafts:null,scriptsDrafts:null,pendingDeletion:null,lastPublished:null};async function d(){try{let e=await o.Z.query.editorInfo.findFirst(),r=await o.Z.select({configKeysDrafts:i.configKeysDrafts.updatedAt}).from(i.configKeysDrafts).orderBy((0,n.C)(i.configKeysDrafts.updatedAt)).limit(1),t=await o.Z.select({diagnosesDrafts:i.diagnosesDrafts.updatedAt}).from(i.diagnosesDrafts).orderBy((0,n.C)(i.diagnosesDrafts.updatedAt)).limit(1),s=await o.Z.select({screensDrafts:i.screensDrafts.updatedAt}).from(i.screensDrafts).orderBy((0,n.C)(i.screensDrafts.updatedAt)).limit(1),a=await o.Z.select({scriptsDrafts:i.scriptsDrafts.updatedAt}).from(i.scriptsDrafts).orderBy((0,n.C)(i.scriptsDrafts.updatedAt)).limit(1),d=await o.Z.select({configKeys:i.configKeys.updatedAt}).from(i.configKeys).orderBy((0,n.C)(i.configKeys.updatedAt)).limit(1),u=await o.Z.select({diagnoses:i.diagnoses.updatedAt}).from(i.diagnoses).orderBy((0,n.C)(i.diagnoses.updatedAt)).limit(1),l=await o.Z.select({screens:i.screens.updatedAt}).from(i.screens).orderBy((0,n.C)(i.screens.updatedAt)).limit(1),p=await o.Z.select({scripts:i.scripts.updatedAt}).from(i.scripts).orderBy((0,n.C)(i.scripts.updatedAt)).limit(1),f=await o.Z.select({pendingDeletion:i.pendingDeletion.createdAt}).from(i.pendingDeletion).orderBy((0,n.C)(i.pendingDeletion.createdAt)).limit(1);return{data:{...c,...r[0],...t[0],...s[0],...a[0],...d[0],...u[0],...l[0],...p[0],...f[0],lastPublished:e?.lastPublishDate||null}}}catch(e){return a.Z.error("_getDatesWhenUpdatesWereMade ERROR",e.message),{data:c,errors:[e.message]}}}async function u(){try{let e=await o.Z.select({count:(0,s.QX)()}).from(i.pendingDeletion);return{total:e[0]?.count||0}}catch(e){return a.Z.error("_countPendingDeletion ERROR",e.message),{total:0,errors:[e.message]}}}let l={scripts:0,screens:0,diagnoses:0,configKeys:0,total:0};async function p(){let e={...l};try{let r=await o.Z.select({count:(0,s.QX)()}).from(i.scriptsDrafts);e.scripts=r[0]?.count||0;let t=await o.Z.select({count:(0,s.QX)()}).from(i.screensDrafts);e.screens=t[0]?.count||0;let a=await o.Z.select({count:(0,s.QX)()}).from(i.diagnosesDrafts);e.diagnoses=a[0]?.count||0;let n=await o.Z.select({count:(0,s.QX)()}).from(i.configKeysDrafts);return e.configKeys=n[0]?.count||0,e.total=e.configKeys+e.diagnoses+e.screens+e.scripts,{...e}}catch(r){return a.Z.error("_countDrafts ERROR",r.message),{...e,errors:[r.message]}}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5822,1744,3788,1490,5802,5059,413,6427],()=>t(17242));module.exports=s})();