"use strict";(()=>{var e={};e.id=7598,e.ids=[7598],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},98331:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>m,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{POST:()=>p});var a=t(49303),n=t(88716),o=t(60670),i=t(87070),u=t(57435),c=t(72761),d=t(47625),l=t(73508);async function p(e){try{if(u.Z.log(`[POST]: ${e.url}`),!(await (0,c.$)()).yes)return i.NextResponse.json({errors:["Unauthorised"]});let{username:r,password:t,password2:s}=await e.json(),{errors:a}=await (0,l.setPassword)({email:r,password:t,passwordConfirm:s});if(a?.length)return i.NextResponse.json({errors:a});let n=r?await (0,d.C)(r):null;if(!n)return i.NextResponse.json({errors:["Something went wrong, try again!"]});let o={id:n.id,displayName:n.displayName,userId:n.userId,email:n.email,role:n.role};return i.NextResponse.json({user:o})}catch(e){return u.Z.error("[POST] /api/sign-up",e.message),i.NextResponse.json({errors:["Internal Error"]})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/(old-api)/sign-up/route",pathname:"/api/sign-up",filename:"route",bundlePath:"app/api/(old-api)/sign-up/route"},resolvedPagePath:"C:\\Users\\HomePC\\Neotree Projects\\neotree-editor\\app\\api\\(old-api)\\sign-up\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:g}=f,y="/api/(old-api)/sign-up/route";function m(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},73508:(e,r,t)=>{t.r(r),t.d(r,{$$ACTION_0:()=>U,$$ACTION_1:()=>O,$$ACTION_2:()=>N,$$ACTION_3:()=>E,$$ACTION_4:()=>T,createUsers:()=>_,deleteUsers:()=>P,getFullUser:()=>v,getUser:()=>j,getUserMini:()=>R,getUsers:()=>I,isEmailRegistered:()=>q,resetUsersPasswords:()=>x,searchUsers:()=>A,setPassword:()=>C,updateUsers:()=>Z});var s=t(24330);t(60166);var a=t(67096),n=t.n(a),o=t(57745),i=t(9576),u=t(8629),c=t(10413),d=t(93567),l=t(47625);async function p(e){for(let r of e)await c.Z.update(d.users).set({password:""}).where((0,o.eq)(d.users.userId,r));return!0}async function f(e){for(let r of e){let e=new Date;await c.Z.update(d.users).set({deletedAt:e,email:r,displayName:"Former user",firstName:null,lastName:null,avatar:null,avatar_md:null,avatar_sm:null}).where((0,o.eq)(d.users.userId,r))}return!0}async function w(e,r){let t=[];for(let r of e){let e=await n().genSalt(10),s=await n().hash(r.password||(0,i.Z)(),e);t.push({...r,password:s,userId:r.userId||(0,i.Z)()})}let s={inserted:[],success:!1};try{if(await c.Z.insert(d.users).values(t),r?.returnInserted){let e=await (0,l.yT)({userIds:t.map(e=>e.userId)});s.inserted=e.data}s.success=!0}catch(e){s.error=e.message}finally{return s}}async function h(e,r){let t=[];for(let{userId:s,data:{userId:a,deletedAt:n,id:i,createdAt:p,updatedAt:f,email:w,...h}}of e)try{let e=u.C.test(s)?(0,o.eq)(d.users.email,s):(0,o.eq)(d.users.userId,s);await c.Z.update(d.users).set(h).where(e);let a=r?.returnUpdated?await (0,l.IQ)(s):void 0;t.push({userId:s,user:a})}catch(e){t.push({userId:s,error:e.message})}return t}var g=t(57435),y=t(70733),m=t(66267),b=t(40618);let x=p;async function q(e){try{let r=await (0,l.IQ)(e);return{yes:!!r,isActive:!!r?.isActive}}catch(e){return g.Z.error("getUser ERROR:",e),{errors:[e.message],yes:!1}}}async function j(e){try{return await (0,m.isAllowed)("get_user"),await (0,l.IQ)(e)||null}catch(e){return g.Z.error("getUser ERROR:",e),null}}async function R(e){try{return await (0,m.isAllowed)("get_user"),await (0,l.$M)(e)||null}catch(e){return g.Z.error("getUserMini ERROR:",e),null}}async function v(e){try{return await (0,m.isAllowed)("get_user"),await (0,l.C)(e)||null}catch(e){return g.Z.error("getFullUser ERROR:",e),null}}let I=(0,s.j)("44dbdd4936f662bcb9d04478e4fee3f8fd7dc644",U);async function U(...e){try{return await (0,m.isAllowed)("get_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}let A=(0,s.j)("7e2bdab7252da9dce7c55a544bfb70f6fee14237",O);async function O(...e){try{return await (0,m.isAllowed)("search_users"),await (0,l.yT)(...e)}catch(e){return{...l.Ko,error:e.message}}}async function P(e){if(await (0,m.isAllowed)("delete_users"),e.length){let{data:r}=await (0,l.yT)({userIds:e});await f(e)}return!0}let _=(0,s.j)("b4c3996d3fe6e0194a0af5bd47a27c458650ccfd",N);async function N(...e){try{await (0,m.isAllowed)("create_users");let r=await w(...e);for(let r of e[0])try{await (0,y.n)({userId:r.userId,hoursValid:1})}catch(e){}return r}catch(e){throw g.Z.error("createUsers ERROR",e),e}}let Z=(0,s.j)("370ec04644e1a6bbf83ec8aad8f4b7ff63deb113",E);async function E(...e){try{return await (0,m.isAllowed)("update_users"),await h(...e)}catch(e){throw g.Z.error("updateUsers ERROR",e),e}}let C=(0,s.j)("ed2bcce7f400c27a29b2f1c6162b25410bc13a22",T);async function T(e){try{if(!e.password)throw Error("Missing: password");if(!e.email)throw Error("Missing: email");if(e.password.length<6)throw Error("Password is too short: min 6 characters");if(e.password!==e.passwordConfirm)throw Error("Password confirmation does not match!");let r=await n().genSalt(10),t=await n().hash(e.password,r),s=await h([{userId:e.email,data:{password:t}}]);if(s.filter(e=>e.error).length)throw Error(s.filter(e=>e.error).map(e=>e.error).join(", "));return{success:!0}}catch(e){return g.Z.error("setPassword ERROR",e),{success:!1,errors:[e.message]}}}(0,b.h)([x,q,j,R,v,I,A,P,_,Z,C]),(0,s.j)("65472eea211269d84f99897d31f8096a3bf27279",x),(0,s.j)("2578fb45bb4ae066089a0a34b5ccfed5c9de841a",q),(0,s.j)("8604670a448bfba49ecbcc179adbe6d1bf6f58b7",j),(0,s.j)("3486f3fdda6e073f552765eaf84efec7892e1a0e",R),(0,s.j)("3d94988037acd9c3f6c096d33c963862d710c4cd",v),(0,s.j)("a2b244f4290f78ce6f5180390f6e0db3cc1ae908",I),(0,s.j)("537ab658cf680818ec0178452645829796c5a242",A),(0,s.j)("878e2a5db4bdd8a1d77757a999bf2bd0b4e56a9e",P),(0,s.j)("02b391a95bc7fea8e63ad500f4579806a257f8a6",_),(0,s.j)("22c573df992af9090bec67a3fa7c5e479d13d8cf",Z),(0,s.j)("a042810df84c982eaf970fbf12dce02d632debcf",C)},70733:(e,r,t)=>{t.d(r,{n:()=>i});var s=t(51744),a=t.n(s),n=t(10413),o=t(93567);async function i({userId:e,hoursValid:r}){return(await n.Z.insert(o.tokens).values({userId:e,validUntil:a()(new Date).add(r,"hour").toDate(),token:Math.floor(1e5+9e5*Math.random())}).returning())[0]}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1633,1744,1337,3788,2758,5059,413,6267],()=>t(98331));module.exports=s})();