"use strict";(()=>{var e={};e.id=5938,e.ids=[5938],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},92060:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l});var a=r(49303),i=r(88716),o=r(60670),n=r(87070),d=r(57435),c=r(72761),u=r(92570);async function l(e){try{if(d.Z.log(`[GET]: ${e.url}`),!(await (0,c.$)()).yes)return n.NextResponse.json({errors:["Unauthorised"]});let t=e.nextUrl.searchParams.get("deviceId"),r=await (0,u._)(t);if(r.errors?.length)return n.NextResponse.json({errors:r.errors});return n.NextResponse.json({...r})}catch(e){return d.Z.error("[GET] /api/get-device-registration",e.message),n.NextResponse.json({errors:["Internal Error"]})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/(old-api)/get-device-registration/route",pathname:"/api/get-device-registration",filename:"route",bundlePath:"app/api/(old-api)/get-device-registration/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor-master/app/api/(old-api)/get-device-registration/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:m}=p,y="/api/(old-api)/get-device-registration/route";function x(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},92570:(e,t,r)=>{r.d(t,{_:()=>d});var s=r(57435),a=r(81339),i=r(25060),o=r(18496),n=r(55249);async function d(e){try{if(!e)throw Error("Device ID not provided!");let t=await (0,o.y)();if(t?.errors)throw Error(t.errors.join(", "));let r=e?await (0,a.$s)({deviceId:e}):{data:null};if(r?.errors)throw Error(r.errors.join(", "));let s=r.data;if(!s){let t=await (0,n.w)({data:[{deviceId:e,details:{scripts_count:0}}],returnSaved:!0});if(t?.errors)throw Error(t.errors.join(", "));s=t.inserted[0]}let d=await (0,i.Nb)(),c=Object.values(d.data).filter(e=>e).map(e=>new Date(e).getTime()),u=t.data?.lastPublishDate;return c.length&&(u=new Date(Math.max(...c))),{device:{id:s?.id,details:s?.details,device_id:s?.deviceId,device_hash:s?.deviceHash,deletedAt:s?.deletedAt,createdAt:s?.createdAt,updatedAt:s?.updatedAt},info:{id:t.data?.id,version:t.data?.dataVersion,should_track_usage:!1,last_backup_date:u}}}catch(e){return s.Z.error("getDevice ERROR",e.message),{errors:[e.message]}}}},18496:(e,t,r)=>{r.d(t,{y:()=>i});var s=r(10413),a=r(57435);async function i(){try{return{data:await s.Z.query.editorInfo.findFirst()||null}}catch(e){return a.Z.error("_getEditorInfo ERROR",e.message),{data:null,errors:[e.message]}}}},25060:(e,t,r)=>{r.d(t,{Yi:()=>p,Ur:()=>u,Nb:()=>c,Ic:()=>l});var s=r(60938),a=r(57435),i=r(57418),o=r(10413),n=r(81445);let d={configKeys:null,diagnoses:null,screens:null,scripts:null,configKeysDrafts:null,diagnosesDrafts:null,screensDrafts:null,scriptsDrafts:null,pendingDeletion:null,lastPublished:null};async function c(){try{let e=await o.Z.query.editorInfo.findFirst(),t=await o.Z.select({configKeysDrafts:i.configKeysDrafts.updatedAt}).from(i.configKeysDrafts).orderBy((0,n.C)(i.configKeysDrafts.updatedAt)).limit(1),r=await o.Z.select({diagnosesDrafts:i.diagnosesDrafts.updatedAt}).from(i.diagnosesDrafts).orderBy((0,n.C)(i.diagnosesDrafts.updatedAt)).limit(1),s=await o.Z.select({screensDrafts:i.screensDrafts.updatedAt}).from(i.screensDrafts).orderBy((0,n.C)(i.screensDrafts.updatedAt)).limit(1),a=await o.Z.select({scriptsDrafts:i.scriptsDrafts.updatedAt}).from(i.scriptsDrafts).orderBy((0,n.C)(i.scriptsDrafts.updatedAt)).limit(1),c=await o.Z.select({configKeys:i.configKeys.updatedAt}).from(i.configKeys).orderBy((0,n.C)(i.configKeys.updatedAt)).limit(1),u=await o.Z.select({diagnoses:i.diagnoses.updatedAt}).from(i.diagnoses).orderBy((0,n.C)(i.diagnoses.updatedAt)).limit(1),l=await o.Z.select({screens:i.screens.updatedAt}).from(i.screens).orderBy((0,n.C)(i.screens.updatedAt)).limit(1),p=await o.Z.select({scripts:i.scripts.updatedAt}).from(i.scripts).orderBy((0,n.C)(i.scripts.updatedAt)).limit(1),f=await o.Z.select({pendingDeletion:i.pendingDeletion.createdAt}).from(i.pendingDeletion).orderBy((0,n.C)(i.pendingDeletion.createdAt)).limit(1);return{data:{...d,...t[0],...r[0],...s[0],...a[0],...c[0],...u[0],...l[0],...p[0],...f[0],lastPublished:e?.lastPublishDate||null}}}catch(e){return a.Z.error("_getDatesWhenUpdatesWereMade ERROR",e.message),{data:d,errors:[e.message]}}}async function u(){try{let e=await o.Z.select({count:(0,s.QX)()}).from(i.pendingDeletion);return{total:e[0]?.count||0}}catch(e){return a.Z.error("_countPendingDeletion ERROR",e.message),{total:0,errors:[e.message]}}}let l={scripts:0,screens:0,diagnoses:0,configKeys:0,total:0};async function p(){let e={...l};try{let t=await o.Z.select({count:(0,s.QX)()}).from(i.scriptsDrafts);e.scripts=t[0]?.count||0;let r=await o.Z.select({count:(0,s.QX)()}).from(i.screensDrafts);e.screens=r[0]?.count||0;let a=await o.Z.select({count:(0,s.QX)()}).from(i.diagnosesDrafts);e.diagnoses=a[0]?.count||0;let n=await o.Z.select({count:(0,s.QX)()}).from(i.configKeysDrafts);return e.configKeys=n[0]?.count||0,e.total=e.configKeys+e.diagnoses+e.screens+e.scripts,{...e}}catch(t){return a.Z.error("_countDrafts ERROR",t.message),{...e,errors:[t.message]}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1633,1381,1744,3788,1490,9092,5802,5059,413,6427],()=>r(92060));module.exports=s})();