"use strict";(()=>{var e={};e.id=4353,e.ids=[4353],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},96119:e=>{e.exports=require("perf_hooks")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},65311:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>I,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>K,staticGenerationAsyncStorage:()=>p});var i={};r.r(i),r.d(i,{DELETE:()=>y,GET:()=>g});var n=r(49303),s=r(88716),o=r(60670),a=r(87070),f=r(57435),c=r(72761),d=r(82984);async function g(e){try{if(!(await (0,c.$)()).yes)return a.NextResponse.json({errors:["Unauthorised"]});let t=JSON.parse(e.nextUrl.searchParams.get("data")||"{}"),r=await (0,d.getConfigKeys)(t);return a.NextResponse.json(r)}catch(e){return f.Z.error("[GET] /api/config-keys",e.message),a.NextResponse.json({errors:["Internal Error"]})}}async function y(e){try{if(!(await (0,c.$)()).yes)return a.NextResponse.json({errors:["Unauthorised"]});let t=JSON.parse(e.nextUrl.searchParams.get("data")||"{}"),r=await (0,d.deleteConfigKeys)(t);return a.NextResponse.json(r)}catch(e){return f.Z.error("[GET] /api/config-keys",e.message),a.NextResponse.json({errors:["Internal Error"]})}}let l=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/config-keys/route",pathname:"/api/config-keys",filename:"route",bundlePath:"app/api/config-keys/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor/app/api/config-keys/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:K}=l,h="/api/config-keys/route";function I(){return(0,o.patchFetch)({serverHooks:K,staticGenerationAsyncStorage:p})}},82984:(e,t,r)=>{r.r(t),r.d(t,{$$ACTION_0:()=>d,$$ACTION_1:()=>y,$$ACTION_2:()=>u,$$ACTION_3:()=>K,$$ACTION_4:()=>I,countConfigKeys:()=>g,deleteConfigKeys:()=>c,getConfigKey:()=>p,getConfigKeys:()=>l,saveConfigKeys:()=>h});var i=r(24330);r(60166);var n=r(92963),s=r(17137),o=r(57435),a=r(66267),f=r(40618);let c=(0,i.j)("fe497951e1112ca68d62894eefa1c51165cbb7c6",d);async function d(e){try{let t=await (0,a.isAllowed)();return await (0,n.LR)({...e,userId:t.user?.userId})}catch(e){return o.Z.error("deleteConfigKeys ERROR",e.message),{errors:[e.message],success:!1}}}let g=(0,i.j)("63ec7791c7ce0e740a8a8b54321f644ed390ac91",y);async function y(...e){try{return await (0,a.isAllowed)(),await (0,s.G$)(...e)}catch(e){return o.Z.error("countConfigKeys ERROR",e.message),{errors:[e.message],data:s.ZV}}}let l=(0,i.j)("b2da4c38e5d01f11debd1dd7c9eb4651bfbbf61f",u);async function u(...e){try{return await (0,a.isAllowed)(),await (0,s.aP)(...e)}catch(e){return o.Z.error("getConfigKeys ERROR",e.message),{errors:[e.message],data:[]}}}let p=(0,i.j)("30f44075bb43c162ae34a4506cbc82e9b1b93474",K);async function K(...e){return await (0,a.isAllowed)(),await (0,s.SL)(...e)}let h=(0,i.j)("16262094b81b056901134f4169f3d346f4ec013a",I);async function I(e){try{let t=await (0,a.isAllowed)();return await (0,n.UZ)({...e,userId:t.user?.userId})}catch(e){return o.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}(0,f.h)([c,g,l,p,h]),(0,i.j)("ea3a611cf241c4b0cc6585638ab2951fb0d1471b",c),(0,i.j)("92531094708e80bbacf90f44a414a77e0bd3ab28",g),(0,i.j)("3b0734b816628136609a5dd9c738d6801c9a52f6",l),(0,i.j)("bce0d6f8f079a0673655c744621c7cf137ef9e1d",p),(0,i.j)("627e92af8c0226b5e044a31db9cc4989fc3dc3ee",h)},92963:(e,t,r)=>{r.d(t,{sj:()=>g,LR:()=>y,h:()=>K,UZ:()=>d});var i=r(57745),n=r(81445),s=r(9576),o=r(57435),a=r(10413),f=r(93567),c=r(88317);async function d({data:e,broadcastAction:t,userId:r}){let d={success:!1};try{let t=[];for(let{configKeyId:o,...c}of e)try{let e=o||s.Z();if(!t.length){let t=o?await a.Z.query.configKeysDrafts.findFirst({where:(0,i.eq)(f.configKeysDrafts.configKeyDraftId,e)}):null,s=t||!o?null:await a.Z.query.configKeys.findFirst({where:(0,i.eq)(f.configKeys.configKeyId,e)});if(t){let r={...t.data,...c};await a.Z.update(f.configKeysDrafts).set({data:r,position:r.position}).where((0,i.eq)(f.configKeysDrafts.configKeyDraftId,e))}else{let t=c.position||s?.position;if(!t){let e=await a.Z.query.configKeys.findFirst({columns:{position:!0},orderBy:(0,n.C)(f.configKeys.position)}),r=await a.Z.query.configKeysDrafts.findFirst({columns:{position:!0},orderBy:(0,n.C)(f.configKeysDrafts.position)});t=Math.max(0,e?.position||0,r?.position||0)+1}let i={...s,...c,configKeyId:e,version:s?.version?s.version+1:1,position:t};await a.Z.insert(f.configKeysDrafts).values({data:i,configKeyDraftId:e,position:i.position,configKeyId:s?.configKeyId,createdByUserId:r})}}}catch(e){t.push(e.message)}t.length?d.errors=t:d.success=!0}catch(e){d.success=!1,d.errors=[e.message],o.Z.error("_saveConfigKeys ERROR",e.message)}finally{return!d?.errors?.length&&t&&c.Z.emit("data_changed","save_config_keys"),d}}async function g(e){try{return await a.Z.delete(f.configKeysDrafts).where(e?.userId?(0,i.eq)(f.configKeysDrafts.createdByUserId,e.userId):void 0),!0}catch(e){throw e}}async function y({configKeysIds:e,broadcastAction:t,userId:r}){let n={success:!1};try{if(e.length){await a.Z.delete(f.configKeysDrafts).where((0,i.d3)(f.configKeysDrafts.configKeyDraftId,e));let t=(await a.Z.select({configKeyId:f.configKeys.configKeyId,pendingDeletion:f.pendingDeletion.configKeyId}).from(f.configKeys).leftJoin(f.pendingDeletion,(0,i.eq)(f.pendingDeletion.configKeyId,f.configKeys.configKeyId)).where((0,i.d3)(f.configKeys.configKeyId,e))).filter(e=>!e.pendingDeletion).map(e=>({...e,createdByUserId:r}));t.length&&await a.Z.insert(f.pendingDeletion).values(t)}n.success=!0}catch(e){n.success=!1,n.errors=[e.message],o.Z.error("_deleteConfigKeys ERROR",e.message)}finally{return!n?.errors?.length&&t&&c.Z.emit("data_changed","delete_config_keys"),n}}async function l({previous:e,drafts:t,userId:r}){let i=[];try{let n=[];for(let s of t){let t=s?.data?.configKeyId;if(!t)continue;let o={version:s?.data?.version||1,configKeyId:t,changes:{}},a=1===(s?.data?.version||1);if(a)o.changes={action:"create_config_key",description:"Create config key",oldValues:[],newValues:[]};else{let r=e.find(e=>e.configKeyId===t),i=[],n=[];Object.keys({...s?.data}).filter(e=>!["version","draft"].includes(e)).forEach(e=>{let t=s.data[e],o={...r}[e];JSON.stringify(t)!==JSON.stringify(o)&&(i.push({[e]:o}),n.push({[e]:t}))}),o.changes={action:"update_config_key",description:"Update config key",oldValues:i,newValues:n}}if(n.push(o),r){let{...n}=s.data||{},f=JSON.parse(JSON.stringify(n)),c=a?{}:JSON.parse(JSON.stringify(e.find(e=>e.configKeyId===t)||{}));i.push({entityId:t,entityType:"config_key",action:a?"create":"update",version:o.version||1,changes:o.changes,fullSnapshot:f,previousSnapshot:c,baselineSnapshot:c,userId:r,configKeyId:t})}}n.length&&await a.Z.insert(f.configKeysHistory).values(n)}catch(e){o.Z.error(e.message)}return i}var u=r(34149),p=r(36864);async function K(e){let t={success:!1},r=[];try{let n=[],c=[],d=await a.Z.query.configKeysDrafts.findMany({where:e?.userId?(0,i.eq)(f.configKeysDrafts.createdByUserId,e?.userId):void 0});if(n=d.filter(e=>e.configKeyId),c=d.filter(e=>!e.configKeyId),n.length){let t=[];for(let{configKeyId:e,data:r}of(n.filter(e=>e.configKeyId).length&&(t=await a.Z.query.configKeys.findMany({where:(0,i.d3)(f.configKeys.configKeyId,n.filter(e=>e.configKeyId).map(e=>e.configKeyId))})),n)){let{configKeyId:t,id:n,oldConfigKeyId:s,createdAt:o,updatedAt:c,deletedAt:d,...g}=r,y={...g,publishDate:new Date};await a.Z.update(f.configKeys).set(y).where((0,i.eq)(f.configKeys.configKeyId,e)).returning()}let s=await l({drafts:n,previous:t,userId:e?.publisherUserId});r.push(...s.map(t=>({...t,dataVersion:e?.dataVersion})))}if(c.length){let t=[];for(let{id:e,data:r}of(c.filter(e=>e.configKeyId).length&&(t=await a.Z.query.configKeys.findMany({where:(0,i.d3)(f.configKeys.configKeyId,c.filter(e=>e.configKeyId).map(e=>e.configKeyId))})),c)){let t=r.configKeyId||(0,s.Z)(),i={...r,configKeyId:t};c=c.map(r=>(r.id===e&&(r.data.configKeyId=t),r)),await a.Z.insert(f.configKeys).values(i)}let n=await l({drafts:c,previous:t,userId:e?.publisherUserId});r.push(...n.map(t=>({...t,dataVersion:e?.dataVersion})))}await a.Z.delete(f.configKeysDrafts).where(e?.userId?(0,i.eq)(f.configKeysDrafts.createdByUserId,e.userId):void 0);let g=await a.Z.query.pendingDeletion.findMany({where:(0,i.xD)((0,i.K0)(f.pendingDeletion.configKeyId),e?.userId?(0,i.eq)(f.pendingDeletion.createdByUserId,e.userId):void 0),columns:{configKeyId:!0},with:{configKey:!0}});if((g=g.filter(e=>e.configKey)).length){let t=new Date;await a.Z.update(f.configKeys).set({deletedAt:t}).where((0,i.d3)(f.configKeys.configKeyId,g.map(e=>e.configKeyId)));let n=g.map(e=>({version:e.configKey.version,configKeyId:e.configKeyId,changes:{action:"delete_config_key",description:"Delete config key",oldValues:[{deletedAt:null}],newValues:[{deletedAt:t}]}}));if(await a.Z.insert(f.configKeysHistory).values(n),e?.publisherUserId)for(let i=0;i<g.length;i++){let s=g[i],o=n[i];if(!s?.configKeyId)continue;let a={...s.configKey??{},deletedAt:t};r.push({entityId:s.configKeyId,entityType:"config_key",action:"delete",version:o.version||1,dataVersion:e.dataVersion,changes:o.changes,fullSnapshot:JSON.parse(JSON.stringify(a)),previousSnapshot:JSON.parse(JSON.stringify(a)),baselineSnapshot:JSON.parse(JSON.stringify(a)),description:o.changes.description,userId:e.publisherUserId,configKeyId:s.configKeyId,isActive:!1})}}await a.Z.delete(f.pendingDeletion).where((0,i.xD)((0,i.or)((0,i.K0)(f.pendingDeletion.configKeyId),(0,i.K0)(f.pendingDeletion.configKeyDraftId)),e?.userId?(0,i.eq)(f.pendingDeletion.createdByUserId,e.userId):void 0));let y=[...n.map(e=>e.configKeyId),...g.map(e=>e.configKeyId)];if(y.length&&await a.Z.update(f.configKeys).set({version:(0,u.i6)`${f.configKeys.version} + 1`}).where((0,i.d3)(f.configKeys.configKeyId,y)),r.length){let e=await (0,p.F)({data:r,allowPartial:!0});e.errors?.length&&o.Z.error("_publishConfigKeys changelog warnings",e.errors.join(", "))}t.success=!0}catch(e){t.success=!1,t.errors=[e.message],o.Z.error("_publishConfigKeys ERROR",e)}finally{return t}}},17137:(e,t,r)=>{r.d(t,{G$:()=>l,ZV:()=>y,SL:()=>d,aP:()=>c});var i=r(57745),n=r(30900),s=r(9576),o=r(10413),a=r(93567),f=r(57435);async function c(e){try{let{configKeysIds:t,returnDraftsIfExist:r}={...e},f=t||[],c=f?.length?(0,i.d3)(a.configKeysDrafts.configKeyDraftId,f.map(e=>n.Z(e)?e:s.Z())):void 0,d=[...c?[c]:[]],g=r?await o.Z.query.configKeysDrafts.findMany({where:(0,i.xD)(...d)}):[];f=f.filter(e=>!g.map(e=>e.configKeyDraftId).includes(e));let y=g.length?(0,i.Nl)(a.configKeys.configKeyId,g.map(e=>e.configKeyDraftId)):void 0,l=f?.length?(0,i.d3)(a.configKeys.configKeyId,f.filter(e=>n.Z(e))):void 0,u=f?.length?(0,i.d3)(a.configKeys.oldConfigKeyId,f.filter(e=>!n.Z(e))):void 0,p=[(0,i.Ft)(a.configKeys.deletedAt),(0,i.Ft)(a.pendingDeletion),...l&&u?[(0,i.or)(l,u)]:[],y],K=(await o.Z.select({configKey:a.configKeys,pendingDeletion:a.pendingDeletion}).from(a.configKeys).leftJoin(a.pendingDeletion,(0,i.eq)(a.pendingDeletion.configKeyId,a.configKeys.configKeyId)).where(p.length?(0,i.xD)(...p):void 0)).map(e=>e.configKey),h=K.length?await o.Z.query.pendingDeletion.findMany({where:(0,i.d3)(a.pendingDeletion.configKeyId,K.map(e=>e.configKeyId)),columns:{configKeyId:!0}}):[];return{data:[...K.map(e=>({...e,isDraft:!1,isDeleted:!1})),...g.map(e=>({...e.data,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,t)=>e.position-t.position).filter(e=>!h.map(e=>e.configKeyId).includes(e.configKeyId))}}catch(e){return f.Z.error("_getConfigKeys ERROR",e.message),{data:[],errors:[e.message]}}}async function d(e){let{configKeyId:t,returnDraftIfExists:r}={...e};try{if(!t)throw Error("Missing configKeyId");let e=n.Z(t)?(0,i.eq)(a.configKeys.configKeyId,t):void 0,s=n.Z(t)?void 0:(0,i.eq)(a.configKeys.oldConfigKeyId,t),f=e?(0,i.eq)(a.configKeysDrafts.configKeyDraftId,t):void 0,c=r&&f?await o.Z.query.configKeysDrafts.findFirst({where:e}):void 0,d=c?{...c.data,draftCreatedByUserId:c.createdByUserId,isDraft:!0,isDeleted:!1}:null;if(d)return{data:d};let g=await o.Z.query.configKeys.findFirst({where:(0,i.xD)((0,i.Ft)(a.configKeys.deletedAt),e||s),with:{draft:!0}});c=r?g?.draft:void 0;let y=c?.data||g;if(!(d=y?{...y,draftCreatedByUserId:c?.createdByUserId,isDraft:!!c?.data,isDeleted:!1}:null))return{data:null};return{data:d}}catch(e){return f.Z.error("_getConfigKey ERROR",e.message),{errors:[e.message]}}}var g=r(60938);let y={allPublished:0,publishedWithDrafts:0,allDrafts:0,newDrafts:0,pendingDeletion:0};async function l(){try{let[{count:e}]=await o.Z.select({count:(0,g.QX)()}).from(a.configKeysDrafts),[{count:t}]=await o.Z.select({count:(0,g.QX)()}).from(a.configKeysDrafts).where((0,i.Ft)(a.configKeysDrafts.configKeyId)),[{count:r}]=await o.Z.select({count:(0,g.QX)()}).from(a.configKeysDrafts).where((0,i.K0)(a.configKeysDrafts.configKeyId)),[{count:n}]=await o.Z.select({count:(0,g.QX)()}).from(a.pendingDeletion).where((0,i.K0)(a.pendingDeletion.configKeyId)),[{count:s}]=await o.Z.select({count:(0,g.QX)()}).from(a.configKeys);return{data:{allPublished:s,publishedWithDrafts:r,allDrafts:e,newDrafts:t,pendingDeletion:n}}}catch(e){return f.Z.error("_getConfigKeys ERROR",e.message),{data:y,errors:[e.message]}}}},30900:(e,t,r)=>{r.d(t,{Z:()=>n});let i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,n=function(e){return"string"==typeof e&&i.test(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9380,1744,1337,3788,2758,9092,4901,5059,413,6267,5002],()=>r(65311));module.exports=i})();