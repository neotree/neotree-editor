"use strict";(()=>{var e={};e.id=4731,e.ids=[4731],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},96119:e=>{e.exports=require("perf_hooks")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},8468:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var n={};r.r(n),r.d(n,{GET:()=>u});var i=r(49303),s=r(88716),a=r(60670),o=r(87070),l=r(89114),d=r(57435);async function u(e,{params:{fileId:t}}){try{if(!t)return o.NextResponse.json({errors:["Missing fileId"]});let{data:e,errors:r}=await (0,l.KU)(t);if(r?.length)return o.NextResponse.json({errors:r});if(!e?.data)return o.NextResponse.json({errors:["Not found"]});return o.NextResponse.json({data:e})}catch(e){return d.Z.error("[GET] /api/files/"+t+"/download",e),new o.NextResponse("Internal Error",{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/files/[fileId]/download/route",pathname:"/api/files/[fileId]/download",filename:"route",bundlePath:"app/api/files/[fileId]/download/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor/app/api/files/[fileId]/download/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:g}=f,x="/api/files/[fileId]/download/route";function m(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}},89114:(e,t,r)=>{r.d(t,{_I:()=>d,Re:()=>g,KU:()=>l});var n=r(57745),i=r(10413),s=r(93567),a=r(57435),o=r(44380);async function l(e){try{let t=await i.Z.query.files.findFirst({where:(0,n.eq)(s.files.fileId,e)});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return a.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}async function d(e){try{let t=await i.Z.query.files.findFirst({where:(0,n.eq)(s.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return a.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}var u=r(34149),f=r(60938),p=r(81445),c=r(41502);async function g(e){try{let{filesIds:t,archived:r,searchValue:a,limit:l,page:d=1,uploadDateGTE:g,uploadDateLTE:x}={...e},m=Math.max(0,d),h=a?["%",a,"%"].join(""):"",y=[r?(0,n.K0)(s.files.deletedAt):(0,n.Ft)(s.files.deletedAt),...t?.length?[(0,n.d3)(s.files.fileId,t)]:[],...h?[(0,u.i6)`LOWER(screens.name) like LOWER(${h})`]:[],g?(0,n.eg)(s.files.createdAt,"string"==typeof g?new Date(g):g):void 0,x?(0,n.G)(s.files.createdAt,"string"==typeof x?new Date(x):x):void 0],w=i.Z.select({count:(0,f.QX)()}).from(s.files);y.length&&w.where((0,n.xD)(...y));let[{count:R}]=await w.execute(),I=1;R&&(I=(0,c.x)(l)?1:Math.ceil(R/l),m=Math.min(m,I));let v=(0,c.x)(l)?void 0:Math.max(0,(m-1)*l);return{data:(await i.Z.query.files.findMany({where:y.length?(0,n.xD)(...y):void 0,limit:l,offset:v,orderBy:(0,p.C)(s.files.createdAt),columns:{fileId:!0,contentType:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})).map(e=>({...e,url:(0,o.TI)(`/files/${e.fileId}`)})),searchValue:a,totalPages:I,totalRows:R,page:m,limit:l}}catch(e){return a.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:[],totalPages:0,totalRows:0,page:1}}}},41502:(e,t,r)=>{r.d(t,{x:()=>n});function n(e){return null==e||""===e}},57435:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(87561),i=r.n(n),s=r(49411),a=r.n(s),o=r(51744),l=r.n(o);function d(e,...t){let r=l()(new Date).format("YYYYMMDD"),n=a().resolve(`logs/${r}`);i().existsSync(n)||i().mkdirSync(n);let s=`${new Date().toUTCString()} ${JSON.stringify([...t])}
`,o=`${n}/${e}`;i().appendFileSync(o,s)}let u={log:(...e)=>{d("logs.txt",...e)},error:(...e)=>{d("errors.txt",...e)},appError:(...e)=>{d("app_errors.txt",...e)}}},44380:(e,t,r)=>{function n(e=""){let t=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===t.substring(t.length-1,t.length)&&(t=t.substring(0,t.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[t,e].filter(e=>e).join("/")}function i(e=""){try{return new URL(e),!0}catch(e){return!1}}r.d(t,{TI:()=>n,jv:()=>i})},60938:(e,t,r)=>{r.d(t,{QX:()=>i});var n=r(34149);function i(e){return(0,n.i6)`count(${e||n.i6.raw("*")})`.mapWith(Number)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9380,1744,1337,5059,413],()=>r(8468));module.exports=n})();