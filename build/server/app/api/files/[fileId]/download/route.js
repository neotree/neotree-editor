"use strict";(()=>{var e={};e.id=4731,e.ids=[4731],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},91639:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var n={};r.r(n),r.d(n,{GET:()=>u});var s=r(49303),a=r(88716),i=r(60670),o=r(87070),l=r(89114),d=r(57435);async function u(e,{params:{fileId:t}}){try{if(!t)return o.NextResponse.json({errors:["Missing fileId"]});let{data:e,errors:r}=await (0,l.KU)(t);if(r?.length)return o.NextResponse.json({errors:r});if(!e?.data)return o.NextResponse.json({errors:["Not found"]});return o.NextResponse.json({data:e})}catch(e){return d.Z.error("[GET] /api/files/"+t+"/download",e),new o.NextResponse("Internal Error",{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/files/[fileId]/download/route",pathname:"/api/files/[fileId]/download",filename:"route",bundlePath:"app/api/files/[fileId]/download/route"},resolvedPagePath:"/home/watkay/ReactProjects/neotree-editor/app/api/files/[fileId]/download/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:g}=f,x="/api/files/[fileId]/download/route";function m(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}},89114:(e,t,r)=>{r.d(t,{_I:()=>d,Re:()=>g,KU:()=>l});var n=r(57745),s=r(10413),a=r(93567),i=r(57435),o=r(44380);async function l(e){try{let t=await s.Z.query.files.findFirst({where:(0,n.eq)(a.files.fileId,e)});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}async function d(e){try{let t=await s.Z.query.files.findFirst({where:(0,n.eq)(a.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}var u=r(34149),f=r(60938),p=r(81445),c=r(41502);async function g(e){try{let{filesIds:t,archived:r,searchValue:i,limit:l,page:d=1,uploadDateGTE:g,uploadDateLTE:x}={...e},m=Math.max(0,d),h=i?["%",i,"%"].join(""):"",y=[r?(0,n.K0)(a.files.deletedAt):(0,n.Ft)(a.files.deletedAt),...t?.length?[(0,n.d3)(a.files.fileId,t)]:[],...h?[(0,u.i6)`LOWER(screens.name) like LOWER(${h})`]:[],g?(0,n.eg)(a.files.createdAt,"string"==typeof g?new Date(g):g):void 0,x?(0,n.G)(a.files.createdAt,"string"==typeof x?new Date(x):x):void 0],w=s.Z.select({count:(0,f.QX)()}).from(a.files);y.length&&w.where((0,n.xD)(...y));let[{count:R}]=await w.execute(),I=1;R&&(I=(0,c.x)(l)?1:Math.ceil(R/l),m=Math.min(m,I));let v=(0,c.x)(l)?void 0:Math.max(0,(m-1)*l);return{data:(await s.Z.query.files.findMany({where:y.length?(0,n.xD)(...y):void 0,limit:l,offset:v,orderBy:(0,p.C)(a.files.createdAt),columns:{fileId:!0,contentType:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})).map(e=>({...e,url:(0,o.TI)(`/files/${e.fileId}`)})),searchValue:i,totalPages:I,totalRows:R,page:m,limit:l}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:[],totalPages:0,totalRows:0,page:1}}}},41502:(e,t,r)=>{r.d(t,{x:()=>n});function n(e){return null==e||""===e}},57435:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(87561),s=r.n(n),a=r(49411),i=r.n(a),o=r(51744),l=r.n(o);function d(e,...t){let r=l()(new Date).format("YYYYMMDD"),n=i().resolve(`logs/${r}`);s().existsSync(n)||s().mkdirSync(n);let a=`${new Date().toUTCString()} ${JSON.stringify([...t])}
`,o=`${n}/${e}`;s().appendFileSync(o,a)}let u={log:(...e)=>{d("logs.txt",...e)},error:(...e)=>{d("errors.txt",...e)},appError:(...e)=>{d("app_errors.txt",...e)}}},44380:(e,t,r)=>{function n(e=""){let t=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===t.substring(t.length-1,t.length)&&(t=t.substring(0,t.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[t,e].filter(e=>e).join("/")}function s(e=""){try{return new URL(e),!0}catch(e){return!1}}r.d(t,{TI:()=>n,jv:()=>s})},60938:(e,t,r)=>{r.d(t,{QX:()=>s});var n=r(34149);function s(e){return(0,n.i6)`count(${e||n.i6.raw("*")})`.mapWith(Number)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1633,1744,1337,5059,413],()=>r(91639));module.exports=n})();