"use strict";(()=>{var e={};e.id=4731,e.ids=[4731],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},29543:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var n={};t.r(n),t.d(n,{GET:()=>d});var s=t(49303),a=t(88716),i=t(60670),o=t(87070),l=t(89114),u=t(57435);async function d(e,{params:{fileId:r}}){try{if(!r)return o.NextResponse.json({errors:["Missing fileId"]});let{data:e,errors:t}=await (0,l.KU)(r);if(t?.length)return o.NextResponse.json({errors:t});if(!e?.data)return o.NextResponse.json({errors:["Not found"]});return o.NextResponse.json({data:e})}catch(e){return u.Z.error("[GET] /api/files/"+r+"/download",e),new o.NextResponse("Internal Error",{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/files/[fileId]/download/route",pathname:"/api/files/[fileId]/download",filename:"route",bundlePath:"app/api/files/[fileId]/download/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor-master/app/api/files/[fileId]/download/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:c,serverHooks:g}=p,m="/api/files/[fileId]/download/route";function x(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}},89114:(e,r,t)=>{t.d(r,{_I:()=>u,Re:()=>c,KU:()=>l});var n=t(57745),s=t(10413),a=t(43509),i=t(57435),o=t(44380);async function l(e){try{let r=await s.Z.query.files.findFirst({where:(0,n.eq)(a.files.fileId,e)});return{data:r?{...r,url:(0,o.TI)(`/files/${r.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}async function u(e){try{let r=await s.Z.query.files.findFirst({where:(0,n.eq)(a.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}});return{data:r?{...r,url:(0,o.TI)(`/files/${r.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}var d=t(34149),p=t(60938),f=t(41502);async function c(e){try{let{filesIds:r,archived:t,searchValue:i,limit:l,page:u=1}={...e},c=Math.max(0,u),g=i?["%",i,"%"].join(""):"",m=[t?(0,n.K0)(a.files.deletedAt):(0,n.Ft)(a.files.deletedAt),...r?.length?[(0,n.d3)(a.files.fileId,r)]:[],...g?[(0,d.i6)`LOWER(screens.name) like LOWER(${g})`]:[]],x=s.Z.select({count:(0,p.QX)()}).from(a.files);m.length&&x.where((0,n.xD)(...m));let[{count:h}]=await x.execute(),w=1;h&&(w=(0,f.x)(l)?1:Math.ceil(h/l),c=Math.min(c,w));let y=(0,f.x)(l)?void 0:Math.max(0,(c-1)*l);return{data:(await s.Z.query.files.findMany({where:m.length?(0,n.xD)(...m):void 0,limit:l,offset:y,columns:{fileId:!0,contentType:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})).map(e=>({...e,url:(0,o.TI)(`/files/${e.fileId}`)})),searchValue:i,totalPages:w,totalRows:h,page:c,limit:l}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:[],totalPages:0,totalRows:0,page:1}}}},41502:(e,r,t)=>{t.d(r,{x:()=>n});function n(e){return null==e||""===e}},57435:(e,r,t)=>{t.d(r,{Z:()=>d});var n=t(87561),s=t.n(n),a=t(49411),i=t.n(a),o=t(51744),l=t.n(o);function u(e,...r){let t=l()(new Date).format("YYYYMMDD"),n=i().resolve(`logs/${t}`);s().existsSync(n)||s().mkdirSync(n);let a=`${new Date().toUTCString()} ${JSON.stringify([...r])}
`,o=`${n}/${e}`;s().appendFileSync(o,a)}let d={log:(...e)=>{u("logs.txt",...e)},error:(...e)=>{u("errors.txt",...e)},appError:(...e)=>{u("app_errors.txt",...e)}}},44380:(e,r,t)=>{function n(e=""){let r=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===r.substring(r.length-1,r.length)&&(r=r.substring(0,r.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[r,e].filter(e=>e).join("/")}function s(e=""){try{return new URL(e),!0}catch(e){return!1}}t.d(r,{TI:()=>n,jv:()=>s})},60938:(e,r,t)=>{t.d(r,{QX:()=>s});var n=t(34149);function s(e){return(0,n.i6)`count(${e||n.i6.raw("*")})`.mapWith(Number)}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[1633,1744,1381,5059,413],()=>t(29543));module.exports=n})();