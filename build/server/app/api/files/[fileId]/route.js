"use strict";(()=>{var e={};e.id=9479,e.ids=[9479],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},42993:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>p});var n=r(49303),a=r(88716),i=r(60670),o=r(87070),l=r(89114),u=r(57435);class d extends Response{constructor(e,t){super(e,{...t,status:200,headers:{...t?.headers}})}}async function p(e,{params:{fileId:t}}){try{if(!t)return new o.NextResponse(null,{status:400,statusText:"Bad Request"});let{data:e,errors:r}=await (0,l.KU)(t);if(r?.length)return new o.NextResponse(null,{status:400,statusText:r.join(", ")});if(!e?.data)return new o.NextResponse(null,{status:404,statusText:"Not found"});let s=new ReadableStream({async start(t){t.enqueue(e.data),t.close()}});return new d(s)}catch(e){return u.Z.error("[GET] /api/files/"+t,e),new o.NextResponse("Internal Error",{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/files/[fileId]/route",pathname:"/api/files/[fileId]",filename:"route",bundlePath:"app/api/files/[fileId]/route"},resolvedPagePath:"/home/morris/Documents/NEOTREE/REPOS/neotree-editor/app/api/files/[fileId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:x,serverHooks:g}=f,m="/api/files/[fileId]/route";function h(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},89114:(e,t,r)=>{r.d(t,{_I:()=>u,Re:()=>x,KU:()=>l});var s=r(57745),n=r(10413),a=r(88182),i=r(57435),o=r(44380);async function l(e){try{let t=await n.Z.query.files.findFirst({where:(0,s.eq)(a.files.fileId,e)});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}async function u(e){try{let t=await n.Z.query.files.findFirst({where:(0,s.eq)(a.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}});return{data:t?{...t,url:(0,o.TI)(`/files/${t.fileId}`)}:null}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}var d=r(34149),p=r(60938),f=r(81445),c=r(41502);async function x(e){try{let{filesIds:t,archived:r,searchValue:i,limit:l,page:u=1,uploadDateGTE:x,uploadDateLTE:g}={...e},m=Math.max(0,u),h=i?["%",i,"%"].join(""):"",y=[r?(0,s.K0)(a.files.deletedAt):(0,s.Ft)(a.files.deletedAt),...t?.length?[(0,s.d3)(a.files.fileId,t)]:[],...h?[(0,d.i6)`LOWER(screens.name) like LOWER(${h})`]:[],x?(0,s.eg)(a.files.createdAt,"string"==typeof x?new Date(x):x):void 0,g?(0,s.G)(a.files.createdAt,"string"==typeof g?new Date(g):g):void 0],R=n.Z.select({count:(0,p.QX)()}).from(a.files);y.length&&R.where((0,s.xD)(...y));let[{count:w}]=await R.execute(),q=1;w&&(q=(0,c.x)(l)?1:Math.ceil(w/l),m=Math.min(m,q));let v=(0,c.x)(l)?void 0:Math.max(0,(m-1)*l);return{data:(await n.Z.query.files.findMany({where:y.length?(0,s.xD)(...y):void 0,limit:l,offset:v,orderBy:(0,f.C)(a.files.createdAt),columns:{fileId:!0,contentType:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})).map(e=>({...e,url:(0,o.TI)(`/files/${e.fileId}`)})),searchValue:i,totalPages:q,totalRows:w,page:m,limit:l}}catch(e){return i.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:[],totalPages:0,totalRows:0,page:1}}}},41502:(e,t,r)=>{r.d(t,{x:()=>s});function s(e){return null==e||""===e}},57435:(e,t,r)=>{r.d(t,{Z:()=>d});var s=r(87561),n=r.n(s),a=r(49411),i=r.n(a),o=r(51744),l=r.n(o);function u(e,...t){let r=l()(new Date).format("YYYYMMDD"),s=i().resolve(`logs/${r}`);n().existsSync(s)||n().mkdirSync(s);let a=`${new Date().toUTCString()} ${JSON.stringify([...t])}
`,o=`${s}/${e}`;n().appendFileSync(o,a)}let d={log:(...e)=>{u("logs.txt",...e)},error:(...e)=>{u("errors.txt",...e)},appError:(...e)=>{u("app_errors.txt",...e)}}},44380:(e,t,r)=>{function s(e=""){let t=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===t.substring(t.length-1,t.length)&&(t=t.substring(0,t.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[t,e].filter(e=>e).join("/")}function n(e=""){try{return new URL(e),!0}catch(e){return!1}}r.d(t,{TI:()=>s,jv:()=>n})},60938:(e,t,r)=>{r.d(t,{QX:()=>n});var s=r(34149);function n(e){return(0,s.i6)`count(${e||s.i6.raw("*")})`.mapWith(Number)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1633,1744,9937,5059,413],()=>r(42993));module.exports=s})();