(()=>{var e={};e.id=8362,e.ids=[8362],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},22037:e=>{"use strict";e.exports=require("os")},4074:e=>{"use strict";e.exports=require("perf_hooks")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},65778:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>p});var i=t(49303),o=t(88716),a=t(60670),u=t(87070),n=t(72761),l=t(82006),c=t(57435);async function p(e){try{if(!(await (0,n.$)()).yes)return u.NextResponse.json({errors:["Unauthorised"]},{status:200});let r=await e.formData(),t=await (0,l.uploadFile)(r);return u.NextResponse.json(t)}catch(e){return c.Z.log("/api/files/upload",e),u.NextResponse.json({errors:[e.message]})}}let d=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/files/upload/route",pathname:"/api/files/upload",filename:"route",bundlePath:"app/api/files/upload/route"},resolvedPagePath:"/home/farai/Workbench/Neotree/neotree-editor-master/app/api/files/upload/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:g}=d,m="/api/files/upload/route";function h(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},82006:(e,r,t)=>{"use strict";t.r(r),t.d(r,{uploadFile:()=>f});var s=t(24330);t(60166);var i=t(9576),o=t(88317),a=t(57435),u=t(10413),n=t(57418),l=t(89114);async function c(e,r){let t={success:!1,file:null};try{if(!e.fileId)throw Error("Missing fileId");if(!e.data)throw Error("No file uploaded");await u.Z.insert(n.files).values(e);let s=await (0,l._I)(e.fileId);if(!s)throw Error("Failed to upload file");t.success=!0,t.file=s.file,r?.broadcastAction&&o.Z.emit("data_changed","upload_file")}catch(e){t.success=!1,t.errors=[e.message],a.Z.error("_uploadFile ERROR",e.message)}finally{return t}}var p=t(44652),d=t(66267);async function f(e,r){let t={success:!1,file:null};try{for(let s of(await (0,d.isAllowed)(["upload_files"]),Array.from(e.entries()))){let[o,a]=s;if("object"==typeof a){let s=Buffer.from(await a.arrayBuffer()),o=e.get("fileId")?.toString()||(0,i.Z)(),u={...(0,p.R)(e.get("metadata")?.toString()||"{}")},n=(e.get("size")?function(e,r){if("0"==`${e}`)return 0;let t=`${e||""}`.replaceAll(" ",""),[s,i]=(t=t.includes(".")?t.replaceAll(",",""):t.split(",").length>2?t.replaceAll(",",""):t.replaceAll(",",".")).split("."),o=!s||isNaN(Number(s))?"":s;return""==(o+=!i||isNaN(Number(i))?"":`.${i}`)||void 0===o||isNaN(Number(o))?r?.notNull?0:null:Number(o)}((0,p.R)(e.get("size")?.toString())):0)||a.size,l=e.get("filename")?.toString()||a.name,d=[o,l].filter(e=>e).join("__");(u.width||u.height)&&(d=`${d}?w=${u.width}&h=${u.height}`),t=await c({fileId:o,data:s,filename:d,size:n,contentType:e.get("contentType")?.toString()||a.type,metadata:u},r)}}}catch(e){t.success=!1,t.errors=[e.message],a.Z.error("uploadFile ERROR",e.message)}finally{return t}}(0,t(40618).h)([f]),(0,s.j)("c0510f4977b119cc8ad2ab30703dd3471188c2de",f)},89114:(e,r,t)=>{"use strict";t.d(r,{_I:()=>n,KU:()=>u});var s=t(57745),i=t(10413),o=t(57418),a=t(57435);async function u(e){try{return{file:await i.Z.query.files.findFirst({where:(0,s.eq)(o.files.fileId,e)})||null}}catch(e){return a.Z.error("_getFiles ERROR",e.message),{errors:[e.message],file:null}}}async function n(e){try{return{file:await i.Z.query.files.findFirst({where:(0,s.eq)(o.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})||null}}catch(e){return a.Z.error("_getFiles ERROR",e.message),{errors:[e.message],file:null}}}},44652:(e,r,t)=>{"use strict";function s(e){try{return JSON.parse(e)}catch(e){return null}}t.d(r,{R:()=>s})},88317:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(55802).io)(process.env.NEXT_PUBLIC_APP_URL)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1633,1381,1744,3788,1490,5802,5059,413,6267],()=>t(65778));module.exports=s})();