"use strict";(()=>{var e={};e.id=9865,e.ids=[9865],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},12132:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>x,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>l});var i=t(49303),o=t(88716),a=t(60670),n=t(87070),c=t(57435),u=t(72761),p=t(65376);async function l(e){try{if(!(await (0,u.$)()).yes)return n.NextResponse.json({errors:["Unauthorised"]});let r=JSON.parse(e.nextUrl.searchParams.get("data")||"{}"),t=await (0,p.getSites)(r);return n.NextResponse.json(t)}catch(e){return c.Z.error("[GET] /api/sites",e.message),n.NextResponse.json({errors:["Internal Error"]})}}let d=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/sites/route",pathname:"/api/sites",filename:"route",bundlePath:"app/api/sites/route"},resolvedPagePath:"/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/api/sites/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:f}=d,h="/api/sites/route";function m(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},65376:(e,r,t)=>{t.r(r),t.d(r,{$$ACTION_0:()=>y,getSites:()=>h,importRemoteScripts:()=>m});var s=t(24330);t(60166);var i=t(92237),o=t(57435),a=t(66267),n=t(29712),c=t(57745),u=t(88317),p=t(10413),l=t(57418),d=t(49530),x=t(20706);async function g({siteId:e,scriptsIds:r},t){let s={success:!1};try{if(!e)throw Error("Missing siteId");let i=await p.Z.query.sites.findFirst({where:(0,c.eq)(l.sites.siteId,e)});if(!i)throw Error("Site not found");let a=process.env.NEXT_PUBLIC_APP_URL,g=n.Z.create({baseURL:`${a}/api`});for(let{scriptId:e,overWriteExistingScriptWithId:t}of(g.interceptors.request.use(async e=>(e.headers&&(e.headers["x-api-key"]=i.apiKey),o.Z.error(e.method,[`${a}/api`,e.url].join("")),e)),g.interceptors.response.use(e=>e,e=>new Promise((r,t)=>t(e))),r)){let{data:r=[],errors:i}=(await g.get("/scripts/with-items?"+d.Z.stringify({scriptsIds:JSON.stringify([e])}))).data;if(i?.length)s.success=!1,s.errors=i;else{let e=await (0,x.gX)(r.map(e=>({...e,scriptId:t||e.scriptId})),{overWriteScriptId:!t});e.errors&&(s.success=!1,s.errors=[...s.errors||[],...e.errors])}}!s.errors?.length&&(s.success=!0,t?.broadcastAction&&u.Z.emit("data_changed","create_scripts_drafts"))}catch(r){let e=r.response?.data?.message||r.response?.data||r.message;s.success=!1,s.errors=[e],o.Z.error("importRemoteScripts ERROR",e)}finally{return s}}var f=t(40618);let h=i.Q,m=(0,s.j)("0c0d3a976a0d3670bfcd783a4eda74ef47d08486",y);async function y(...e){let r={success:!1};try{await (0,a.isAllowed)(["import_scripts"]),r=await g(...e)}catch(e){r.errors=[e.message],o.Z.error("importRemoteScripts ERROR",e.message)}finally{return r}}(0,f.h)([h,m]),(0,s.j)("fb88c3f5187f1ae67c65c11fdc8ca29dc4350c9d",h),(0,s.j)("eb767362e2857509ccd48c4eb7968f5169ef228f",m)},92237:(e,r,t)=>{t.d(r,{_:()=>p,Q:()=>u});var s=t(57745),i=t(10413),o=t(57418),a=t(57435),n=t(71615);let c=()=>{let e=function(){let e=(0,n.headers)(),r=e.get("x-url"),t=e.get("x-next-url-host"),s=e.get("x-next-url-href"),i=e.get("x-next-url-port"),o=e.get("x-next-url-hostname"),a=e.get("x-next-url-pathname"),c=e.get("x-next-url-search"),u=e.get("x-next-url-protocol"),p=e.get("x-next-url-username"),l=e.get("x-next-url-locale"),d=e.get("x-next-url-origin"),x=e.get("x-geo-city"),g=e.get("x-geo-country");return{url:r||"",host:t||"",href:s||"",port:i||"",hostname:o||"",pathname:a||"",search:c||"",protocol:u||"",username:p||"",locale:l||"",origin:d||"",city:x||"",country:g||"",region:e.get("x-geo-region")||"",latitude:e.get("x-geo-latitude")||"",longitude:e.get("x-geo-longitude")||""}}();return{webeditor:{name:"Local editor",siteId:"fb76af5a-bf86-4050-821e-44f1bf316bf4",link:e.origin,type:"webeditor",apiKey:"localhost"},nodeapi:{name:"Local editor",siteId:"5cb4aa54-2cfe-49e2-9cdd-392a9b8c124e",link:e.origin,type:"webeditor",apiKey:"localhost"}}};async function u(e){try{let{types:r=[]}={...e},t=[...r.length?[(0,s.d3)(o.sites.type,r)]:[]],a=await i.Z.query.sites.findMany({where:t.length?(0,s.xD)(...t):void 0,columns:{siteId:!0,type:!0,name:!0,link:!0}});return c(),{data:[...a]}}catch(e){return a.Z.error("_getSites ERROR",e.message),{data:[],errors:[e.message]}}}async function p(e){try{let r=await i.Z.query.sites.findFirst({where:(0,s.eq)(o.sites.siteId,e),columns:{apiKey:!0,link:!0}}),t=r||null;if(!r){let r=c();Object.values(r).forEach(r=>{r.siteId===e&&(t={link:r.link,apiKey:r.apiKey})})}return{data:t}}catch(e){return a.Z.error("_getSiteApiKey ERROR",e.message),{data:null,errors:[e.message]}}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5822,1744,3788,1490,5802,5059,4084,413,6267,8151],()=>t(12132));module.exports=s})();