/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ops/discard-drafts/route";
exports.ids = ["app/api/ops/discard-drafts/route"];
exports.modules = {

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("bcrypt");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "perf_hooks":
/*!*****************************!*\
  !*** external "perf_hooks" ***!
  \*****************************/
/***/ ((module) => {

"use strict";
module.exports = require("perf_hooks");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fops%2Fdiscard-drafts%2Froute&page=%2Fapi%2Fops%2Fdiscard-drafts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fops%2Fdiscard-drafts%2Froute.ts&appDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fops%2Fdiscard-drafts%2Froute&page=%2Fapi%2Fops%2Fdiscard-drafts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fops%2Fdiscard-drafts%2Froute.ts&appDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_lafarai_Werq_BWS_NeoTree_neotree_webeditor_app_api_ops_discard_drafts_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ops/discard-drafts/route.ts */ \"(rsc)/./app/api/ops/discard-drafts/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ops/discard-drafts/route\",\n        pathname: \"/api/ops/discard-drafts\",\n        filename: \"route\",\n        bundlePath: \"app/api/ops/discard-drafts/route\"\n    },\n    resolvedPagePath: \"/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/api/ops/discard-drafts/route.ts\",\n    nextConfigOutput,\n    userland: _Users_lafarai_Werq_BWS_NeoTree_neotree_webeditor_app_api_ops_discard_drafts_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/ops/discard-drafts/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZvcHMlMkZkaXNjYXJkLWRyYWZ0cyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGb3BzJTJGZGlzY2FyZC1kcmFmdHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZvcHMlMkZkaXNjYXJkLWRyYWZ0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmxhZmFyYWklMkZXZXJxJTJGQldTJTJGTmVvVHJlZSUyRm5lb3RyZWUtd2ViZWRpdG9yJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmxhZmFyYWklMkZXZXJxJTJGQldTJTJGTmVvVHJlZSUyRm5lb3RyZWUtd2ViZWRpdG9yJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNxQztBQUNsSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLz82NjEzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9sYWZhcmFpL1dlcnEvQldTL05lb1RyZWUvbmVvdHJlZS13ZWJlZGl0b3IvYXBwL2FwaS9vcHMvZGlzY2FyZC1kcmFmdHMvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL29wcy9kaXNjYXJkLWRyYWZ0cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL29wcy9kaXNjYXJkLWRyYWZ0c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvb3BzL2Rpc2NhcmQtZHJhZnRzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2xhZmFyYWkvV2VycS9CV1MvTmVvVHJlZS9uZW90cmVlLXdlYmVkaXRvci9hcHAvYXBpL29wcy9kaXNjYXJkLWRyYWZ0cy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvb3BzL2Rpc2NhcmQtZHJhZnRzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fops%2Fdiscard-drafts%2Froute&page=%2Fapi%2Fops%2Fdiscard-drafts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fops%2Fdiscard-drafts%2Froute.ts&appDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/actions/authenticate.ts":
/*!*************************************!*\
  !*** ./app/actions/authenticate.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   validateApiKey: () => (/* binding */ validateApiKey),\n/* harmony export */   validateAuthClient: () => (/* binding */ validateAuthClient),\n/* harmony export */   validateHeadersItem: () => (/* binding */ validateHeadersItem)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_queries_api_keys__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/databases/queries/api-keys */ \"(rsc)/./databases/queries/api-keys/index.ts\");\n/* harmony import */ var _databases_queries_auth_clients__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/databases/queries/auth-clients */ \"(rsc)/./databases/queries/auth-clients/index.ts\");\n\n\n\n\nasync function validateHeadersItem(key, cb) {\n    const headersList = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)();\n    const value = headersList.get(key);\n    if (!value) return false;\n    return cb(value);\n}\nasync function validateAuthClient(type, value) {\n    try {\n        if (!value) return false;\n        const { data } = await (0,_databases_queries_auth_clients__WEBPACK_IMPORTED_MODULE_3__._getAuthClients)(type === \"token\" ? {\n            clientTokens: [\n                value\n            ]\n        } : {\n            clientIds: [\n                value\n            ]\n        });\n        return !!data.length;\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"validateAuthClient ERROR:\", e.message);\n        return false;\n    }\n}\nasync function validateApiKey(apiKey) {\n    try {\n        if ( true && apiKey === \"localhost\") return true;\n        if (!apiKey) return false;\n        const { data } = await (0,_databases_queries_api_keys__WEBPACK_IMPORTED_MODULE_2__._getApiKeys)({\n            apiKeys: [\n                apiKey\n            ]\n        });\n        return !!data.length;\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"validateApiKey ERROR:\", e.message);\n        return false;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYWN0aW9ucy9hdXRoZW50aWNhdGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFzQztBQUVKO0FBQ3lCO0FBQ1E7QUFFNUQsZUFBZUksb0JBQW9CQyxHQUFXLEVBQUVDLEVBQXVDO0lBQzFGLE1BQU1DLGNBQWNQLHFEQUFPQTtJQUMzQixNQUFNUSxRQUFRRCxZQUFZRSxHQUFHLENBQUNKO0lBRTlCLElBQUksQ0FBQ0csT0FBTyxPQUFPO0lBRW5CLE9BQU9GLEdBQUdFO0FBQ2Q7QUFFTyxlQUFlRSxtQkFBbUJDLElBQW9CLEVBQUVILEtBQWE7SUFDM0UsSUFBSTtRQUNHLElBQUksQ0FBQ0EsT0FBTyxPQUFPO1FBRW5CLE1BQU0sRUFBRUksSUFBSSxFQUFFLEdBQUcsTUFBTVQsZ0ZBQWVBLENBQ2xDUSxTQUFTLFVBQ0w7WUFBRUUsY0FBYztnQkFBQ0w7YUFBTTtRQUFFLElBRXpCO1lBQUVNLFdBQVc7Z0JBQUNOO2FBQU07UUFBRTtRQUc5QixPQUFPLENBQUMsQ0FBQ0ksS0FBS0csTUFBTTtJQUMzQixFQUFFLE9BQU1DLEdBQVE7UUFDZmYsbURBQU1BLENBQUNnQixLQUFLLENBQUMsNkJBQTZCRCxFQUFFRSxPQUFPO1FBQ25ELE9BQU87SUFDUjtBQUNEO0FBRU8sZUFBZUMsZUFBZUMsTUFBYztJQUNsRCxJQUFJO1FBQ0csSUFBSSxLQUEwQixJQUFrQkEsV0FBVyxhQUFjLE9BQU87UUFFaEYsSUFBSSxDQUFDQSxRQUFRLE9BQU87UUFFcEIsTUFBTSxFQUFFUixJQUFJLEVBQUUsR0FBRyxNQUFNVix3RUFBV0EsQ0FBQztZQUFFbUIsU0FBUztnQkFBQ0Q7YUFBTztRQUFFO1FBRXhELE9BQU8sQ0FBQyxDQUFDUixLQUFLRyxNQUFNO0lBQzNCLEVBQUUsT0FBTUMsR0FBUTtRQUNmZixtREFBTUEsQ0FBQ2dCLEtBQUssQ0FBQyx5QkFBeUJELEVBQUVFLE9BQU87UUFDL0MsT0FBTztJQUNSO0FBQ0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2FwcC9hY3Rpb25zL2F1dGhlbnRpY2F0ZS50cz9iZjk4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhlYWRlcnMgfSBmcm9tICduZXh0L2hlYWRlcnMnXG5cbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuaW1wb3J0IHsgX2dldEFwaUtleXMgfSBmcm9tICdAL2RhdGFiYXNlcy9xdWVyaWVzL2FwaS1rZXlzJztcbmltcG9ydCB7IF9nZXRBdXRoQ2xpZW50cyB9IGZyb20gJ0AvZGF0YWJhc2VzL3F1ZXJpZXMvYXV0aC1jbGllbnRzJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlSGVhZGVyc0l0ZW0oa2V5OiBzdHJpbmcsIGNiOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTxib29sZWFuPikge1xuICAgIGNvbnN0IGhlYWRlcnNMaXN0ID0gaGVhZGVycygpO1xuICAgIGNvbnN0IHZhbHVlID0gaGVhZGVyc0xpc3QuZ2V0KGtleSk7XG4gICAgXG4gICAgaWYgKCF2YWx1ZSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgcmV0dXJuIGNiKHZhbHVlKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQXV0aENsaWVudCh0eXBlOiAndG9rZW4nIHwgJ2lkJywgdmFsdWU6IHN0cmluZykge1xuXHR0cnkge1xuICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBfZ2V0QXV0aENsaWVudHMoXG4gICAgICAgICAgICB0eXBlID09PSAndG9rZW4nID8gXG4gICAgICAgICAgICAgICAgeyBjbGllbnRUb2tlbnM6IFt2YWx1ZV0sIH1cbiAgICAgICAgICAgICAgICA6XG4gICAgICAgICAgICAgICAgeyBjbGllbnRJZHM6IFt2YWx1ZV0sIH1cbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gISFkYXRhLmxlbmd0aDtcblx0fSBjYXRjaChlOiBhbnkpIHtcblx0XHRsb2dnZXIuZXJyb3IoJ3ZhbGlkYXRlQXV0aENsaWVudCBFUlJPUjonLCBlLm1lc3NhZ2UpO1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVBcGlLZXkoYXBpS2V5OiBzdHJpbmcpIHtcblx0dHJ5IHtcbiAgICAgICAgaWYgKChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSAmJiAoYXBpS2V5ID09PSAnbG9jYWxob3N0JykpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmICghYXBpS2V5KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBfZ2V0QXBpS2V5cyh7IGFwaUtleXM6IFthcGlLZXldLCB9KTtcblxuICAgICAgICByZXR1cm4gISFkYXRhLmxlbmd0aDtcblx0fSBjYXRjaChlOiBhbnkpIHtcblx0XHRsb2dnZXIuZXJyb3IoJ3ZhbGlkYXRlQXBpS2V5IEVSUk9SOicsIGUubWVzc2FnZSk7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG4iXSwibmFtZXMiOlsiaGVhZGVycyIsImxvZ2dlciIsIl9nZXRBcGlLZXlzIiwiX2dldEF1dGhDbGllbnRzIiwidmFsaWRhdGVIZWFkZXJzSXRlbSIsImtleSIsImNiIiwiaGVhZGVyc0xpc3QiLCJ2YWx1ZSIsImdldCIsInZhbGlkYXRlQXV0aENsaWVudCIsInR5cGUiLCJkYXRhIiwiY2xpZW50VG9rZW5zIiwiY2xpZW50SWRzIiwibGVuZ3RoIiwiZSIsImVycm9yIiwibWVzc2FnZSIsInZhbGlkYXRlQXBpS2V5IiwiYXBpS2V5IiwiYXBpS2V5cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/actions/authenticate.ts\n");

/***/ }),

/***/ "(rsc)/./app/actions/get-authenticated-user.ts":
/*!***********************************************!*\
  !*** ./app/actions/get-authenticated-user.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAuthenticatedUser: () => (/* binding */ getAuthenticatedUser),\n/* harmony export */   getAuthenticatedUserWithRoles: () => (/* binding */ getAuthenticatedUserWithRoles),\n/* harmony export */   getSession: () => (/* binding */ getSession)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_auth_authOptions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth/authOptions */ \"(rsc)/./lib/auth/authOptions.ts\");\n/* harmony import */ var _databases_queries_users__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/databases/queries/users */ \"(rsc)/./databases/queries/users.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"0b2fbd1c3a054fb1b76c33cf025c25b5d80cbadf\":\"getAuthenticatedUserWithRoles\",\"25ea7ea3dd7527b3c13d4af3d456f9d5e4cff350\":\"getSession\",\"44218771357d06d79311b6d6641a20c018bafd37\":\"getAuthenticatedUser\"} */ \n\n\n\n\nasync function getSession() {\n    return await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth_authOptions__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n}\nasync function getAuthenticatedUser() {\n    try {\n        const session = await getSession();\n        if (!session?.user?.email) return null;\n        const currentUser = await _databases_queries_users__WEBPACK_IMPORTED_MODULE_4__._getUser(session.user.email);\n        return currentUser || null;\n    } catch (e) {\n        return null;\n    }\n}\nasync function getAuthenticatedUserWithRoles() {\n    try {\n        const user = await getAuthenticatedUser();\n        const isAdmin = user?.role === \"admin\";\n        const isSuperUser = user?.role === \"super_user\";\n        const isDefaultUser = !isAdmin && !isSuperUser;\n        return {\n            isAdmin,\n            isSuperUser,\n            isDefaultUser,\n            authenticatedUser: user\n        };\n    } catch (e) {\n        return {\n            isAdmin: false,\n            isSuperUser: false,\n            isDefaultUser: false,\n            user: null\n        };\n    }\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_5__.ensureServerEntryExports)([\n    getSession,\n    getAuthenticatedUser,\n    getAuthenticatedUserWithRoles\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"25ea7ea3dd7527b3c13d4af3d456f9d5e4cff350\", getSession);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"44218771357d06d79311b6d6641a20c018bafd37\", getAuthenticatedUser);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"0b2fbd1c3a054fb1b76c33cf025c25b5d80cbadf\", getAuthenticatedUserWithRoles);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYWN0aW9ucy9nZXQtYXV0aGVudGljYXRlZC11c2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFNkM7QUFDUTtBQUNBO0FBRTlDLGVBQWVHO0lBQ3BCLE9BQU8sTUFBTUgsMkRBQWdCQSxDQUFDQyw4REFBV0E7QUFDM0M7QUFFTyxlQUFlRztJQUNsQixJQUFJO1FBQ0EsTUFBTUMsVUFBVSxNQUFNRjtRQUV0QixJQUFJLENBQUNFLFNBQVNDLE1BQU1DLE9BQU8sT0FBTztRQUVsQyxNQUFNQyxjQUFjLE1BQU1OLDhEQUFnQixDQUFDRyxRQUFRQyxJQUFJLENBQUNDLEtBQUs7UUFFN0QsT0FBT0MsZUFBZTtJQUMxQixFQUFFLE9BQU1FLEdBQUc7UUFDUCxPQUFPO0lBQ1g7QUFDSjtBQUVPLGVBQWVDO0lBQ2xCLElBQUk7UUFDQSxNQUFNTCxPQUFPLE1BQU1GO1FBRW5CLE1BQU1RLFVBQVVOLE1BQU1PLFNBQVM7UUFDL0IsTUFBTUMsY0FBY1IsTUFBTU8sU0FBUztRQUNuQyxNQUFNRSxnQkFBZ0IsQ0FBQ0gsV0FBVyxDQUFDRTtRQUVuQyxPQUFPO1lBQ0hGO1lBQ0FFO1lBQ0FDO1lBQ0FDLG1CQUFtQlY7UUFDdkI7SUFDSixFQUFFLE9BQU1JLEdBQUc7UUFDUCxPQUFPO1lBQ0hFLFNBQVM7WUFDVEUsYUFBYTtZQUNiQyxlQUFlO1lBQ2ZULE1BQU07UUFDVjtJQUNKO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2FwcC9hY3Rpb25zL2dldC1hdXRoZW50aWNhdGVkLXVzZXIudHM/ZjdiOCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XG5cbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tIFwibmV4dC1hdXRoXCI7XG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gXCJAL2xpYi9hdXRoL2F1dGhPcHRpb25zXCI7XG5pbXBvcnQgKiBhcyBxdWVyaWVzIGZyb20gXCJAL2RhdGFiYXNlcy9xdWVyaWVzL3VzZXJzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXNzaW9uKCkge1xuICByZXR1cm4gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcigpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbigpO1xuXG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcj8uZW1haWwpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgcXVlcmllcy5fZ2V0VXNlcihzZXNzaW9uLnVzZXIuZW1haWwpO1xuXG4gICAgICAgIHJldHVybiBjdXJyZW50VXNlciB8fCBudWxsO1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlcldpdGhSb2xlcygpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0QXV0aGVudGljYXRlZFVzZXIoKTtcblxuICAgICAgICBjb25zdCBpc0FkbWluID0gdXNlcj8ucm9sZSA9PT0gJ2FkbWluJztcbiAgICAgICAgY29uc3QgaXNTdXBlclVzZXIgPSB1c2VyPy5yb2xlID09PSAnc3VwZXJfdXNlcic7XG4gICAgICAgIGNvbnN0IGlzRGVmYXVsdFVzZXIgPSAhaXNBZG1pbiAmJiAhaXNTdXBlclVzZXI7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzQWRtaW4sXG4gICAgICAgICAgICBpc1N1cGVyVXNlcixcbiAgICAgICAgICAgIGlzRGVmYXVsdFVzZXIsXG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkVXNlcjogdXNlcixcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzQWRtaW46IGZhbHNlLFxuICAgICAgICAgICAgaXNTdXBlclVzZXI6IGZhbHNlLFxuICAgICAgICAgICAgaXNEZWZhdWx0VXNlcjogZmFsc2UsXG4gICAgICAgICAgICB1c2VyOiBudWxsLFxuICAgICAgICB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJxdWVyaWVzIiwiZ2V0U2Vzc2lvbiIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwic2Vzc2lvbiIsInVzZXIiLCJlbWFpbCIsImN1cnJlbnRVc2VyIiwiX2dldFVzZXIiLCJlIiwiZ2V0QXV0aGVudGljYXRlZFVzZXJXaXRoUm9sZXMiLCJpc0FkbWluIiwicm9sZSIsImlzU3VwZXJVc2VyIiwiaXNEZWZhdWx0VXNlciIsImF1dGhlbnRpY2F0ZWRVc2VyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/actions/get-authenticated-user.ts\n");

/***/ }),

/***/ "(rsc)/./app/actions/is-allowed.ts":
/*!***********************************!*\
  !*** ./app/actions/is-allowed.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   canAccessPage: () => (/* binding */ canAccessPage),\n/* harmony export */   isAllowed: () => (/* binding */ isAllowed)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _is_authenticated__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./is-authenticated */ \"(rsc)/./app/actions/is-authenticated.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"1d060a829ac08f6adb4ed6f259c6c0d117feea4b\":\"canAccessPage\",\"c474998fd6b8a9785a09ad9fa5995661f28c6c5b\":\"isAllowed\"} */ \n\n\n\nasync function canAccessPage(perm) {\n    let response = {\n        yes: false,\n        user: null\n    };\n    try {\n        response = await isAllowed(perm);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"canAccessPage ERROR\", e.message);\n    } finally{\n        return response;\n    }\n}\nasync function isAllowed(action) {\n    const authenticated = await (0,_is_authenticated__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)();\n    if (!authenticated.yes) throw new Error(\"Unauthenticated\");\n    let isAllowed = true;\n    if (action) {\n        const actions = typeof action === \"string\" ? [\n            action\n        ] : action;\n        for (const action of actions){\n            switch(action){\n                //pages\n                //mailer\n                case \"users_page\":\n                    // case 'general_settings_page':\n                    // case 'emails_settings_page':\n                    // case 'logs_settings_page':\n                    // case 'system_settings_page':\n                    // case 'app_settings_page':\n                    isAllowed = authenticated.user?.role !== \"user\";\n                    break;\n                //mailer\n                case \"get_mailer_settings\":\n                    break;\n                case \"save_mailer_settings\":\n                    break;\n                case \"delete_mailer_settings\":\n                    break;\n                // permissions actions\n                case \"view_logs\":\n                    break;\n                // permissions actions\n                case \"create_permissions\":\n                    break;\n                case \"update_permissions\":\n                    break;\n                case \"delete_permissions\":\n                    break;\n                case \"get_permissions\":\n                    break;\n                case \"get_permission\":\n                    break;\n                case \"search_permissions\":\n                    break;\n                // users actions\n                case \"create_users\":\n                    break;\n                case \"update_users\":\n                    break;\n                case \"delete_users\":\n                    break;\n                case \"get_users\":\n                    break;\n                case \"get_user\":\n                    break;\n                case \"search_users\":\n                    break;\n                // hospitals actions\n                case \"create_hospitals\":\n                    break;\n                case \"update_hospitals\":\n                    break;\n                case \"delete_hospitals\":\n                    break;\n                case \"get_hospitals\":\n                    break;\n                case \"get_hospital\":\n                    break;\n                case \"search_hospitals\":\n                    break;\n                // configuration actions\n                case \"create_config_keys\":\n                    break;\n                case \"update_config_keys\":\n                    break;\n                case \"delete_config_keys\":\n                    break;\n                case \"get_config_keys\":\n                    break;\n                case \"get_config_key\":\n                    break;\n                case \"search_config_keys\":\n                    break;\n                // scripts actions\n                case \"import_scripts\":\n                    break;\n                case \"create_scripts\":\n                    break;\n                case \"update_scripts\":\n                    break;\n                case \"delete_scripts\":\n                    break;\n                case \"get_scripts\":\n                    break;\n                case \"get_script\":\n                    break;\n                case \"search_scripts\":\n                    break;\n                // screens actions\n                case \"create_screens\":\n                    break;\n                case \"update_screens\":\n                    break;\n                case \"delete_screens\":\n                    break;\n                case \"get_screens\":\n                    break;\n                case \"get_screen\":\n                    break;\n                case \"search_screens\":\n                    break;\n                // diagnoses actions\n                case \"create_diagnoses\":\n                    break;\n                case \"update_diagnoses\":\n                    break;\n                case \"delete_diagnoses\":\n                    break;\n                case \"get_diagnoses\":\n                    break;\n                case \"get_diagnosis\":\n                    break;\n                case \"search_diagnoses\":\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n    return {\n        ...authenticated,\n        yes: isAllowed\n    };\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_4__.ensureServerEntryExports)([\n    canAccessPage,\n    isAllowed\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"1d060a829ac08f6adb4ed6f259c6c0d117feea4b\", canAccessPage);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"c474998fd6b8a9785a09ad9fa5995661f28c6c5b\", isAllowed);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYWN0aW9ucy9pcy1hbGxvd2VkLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFHcUQ7QUFDbkI7QUFJM0IsZUFBZUUsY0FBY0MsSUFBc0I7SUFDdEQsSUFBSUMsV0FBa0Q7UUFBRUMsS0FBSztRQUFPQyxNQUFNO0lBQU07SUFDaEYsSUFBSTtRQUNBRixXQUFXLE1BQU1HLFVBQVVKO0lBQy9CLEVBQUUsT0FBTUssR0FBUTtRQUNaUCxtREFBTUEsQ0FBQ1EsS0FBSyxDQUFDLHVCQUF1QkQsRUFBRUUsT0FBTztJQUNqRCxTQUFVO1FBQ04sT0FBT047SUFDWDtBQUNKO0FBRU8sZUFBZUcsVUFBVUksTUFBd0I7SUFDcEQsTUFBTUMsZ0JBQWdCLE1BQU1aLGtFQUFlQTtJQUUzQyxJQUFJLENBQUNZLGNBQWNQLEdBQUcsRUFBRSxNQUFNLElBQUlRLE1BQU07SUFFeEMsSUFBSU4sWUFBWTtJQUVoQixJQUFJSSxRQUFRO1FBQ1IsTUFBTUcsVUFBVSxPQUFPSCxXQUFXLFdBQVc7WUFBQ0E7U0FBTyxHQUFHQTtRQUV4RCxLQUFLLE1BQU1BLFVBQVVHLFFBQVM7WUFDMUIsT0FBT0g7Z0JBQ0gsT0FBTztnQkFDUCxRQUFRO2dCQUNSLEtBQUs7b0JBQ0wsZ0NBQWdDO29CQUNoQywrQkFBK0I7b0JBQy9CLDZCQUE2QjtvQkFDN0IsK0JBQStCO29CQUMvQiw0QkFBNEI7b0JBQ3hCSixZQUFZSyxjQUFjTixJQUFJLEVBQUVTLFNBQVM7b0JBQ3pDO2dCQUVKLFFBQVE7Z0JBQ1IsS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBRUosc0JBQXNCO2dCQUN0QixLQUFLO29CQUNEO2dCQUVKLHNCQUFzQjtnQkFDdEIsS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBRUosZ0JBQWdCO2dCQUNoQixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFFSixvQkFBb0I7Z0JBQ3BCLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUVKLHdCQUF3QjtnQkFDeEIsS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBRUosa0JBQWtCO2dCQUNsQixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUVKLGtCQUFrQjtnQkFDbEIsS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBRUosb0JBQW9CO2dCQUNwQixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFDSixLQUFLO29CQUNEO2dCQUNKLEtBQUs7b0JBQ0Q7Z0JBQ0osS0FBSztvQkFDRDtnQkFFSjtvQkFDSTtZQUNSO1FBQ0o7SUFDSjtJQUVBLE9BQU87UUFBRSxHQUFHSCxhQUFhO1FBQUVQLEtBQUtFO0lBQVc7QUFDL0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2FwcC9hY3Rpb25zL2lzLWFsbG93ZWQudHM/MDE4NSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHNlcnZlcic7XG5cbmltcG9ydCB7IERhdGFBY3Rpb24sIFBhZ2VQZXJtaXNzaW9uIH0gZnJvbSBcIkAvdHlwZXNcIjtcbmltcG9ydCB7IGlzQXV0aGVudGljYXRlZCB9IGZyb20gXCIuL2lzLWF1dGhlbnRpY2F0ZWRcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuXG50eXBlIFBlcm1pc3Npb25QYXJhbSA9IFBhZ2VQZXJtaXNzaW9uIHwgUGFnZVBlcm1pc3Npb25bXSB8IERhdGFBY3Rpb24gfCBEYXRhQWN0aW9uW107XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5BY2Nlc3NQYWdlKHBlcm0/OiBQZXJtaXNzaW9uUGFyYW0pIHtcbiAgICBsZXQgcmVzcG9uc2U6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgaXNBbGxvd2VkPj4gPSB7IHllczogZmFsc2UsIHVzZXI6IG51bGwsIH07XG4gICAgdHJ5IHtcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBpc0FsbG93ZWQocGVybSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdjYW5BY2Nlc3NQYWdlIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNBbGxvd2VkKGFjdGlvbj86IFBlcm1pc3Npb25QYXJhbSkge1xuICAgIGNvbnN0IGF1dGhlbnRpY2F0ZWQgPSBhd2FpdCBpc0F1dGhlbnRpY2F0ZWQoKTtcblxuICAgIGlmICghYXV0aGVudGljYXRlZC55ZXMpIHRocm93IG5ldyBFcnJvcignVW5hdXRoZW50aWNhdGVkJyk7XG5cbiAgICBsZXQgaXNBbGxvd2VkID0gdHJ1ZTtcblxuICAgIGlmIChhY3Rpb24pIHtcbiAgICAgICAgY29uc3QgYWN0aW9ucyA9IHR5cGVvZiBhY3Rpb24gPT09ICdzdHJpbmcnID8gW2FjdGlvbl0gOiBhY3Rpb247XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKSB7XG4gICAgICAgICAgICBzd2l0Y2goYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy9wYWdlc1xuICAgICAgICAgICAgICAgIC8vbWFpbGVyXG4gICAgICAgICAgICAgICAgY2FzZSAndXNlcnNfcGFnZSc6XG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnZ2VuZXJhbF9zZXR0aW5nc19wYWdlJzpcbiAgICAgICAgICAgICAgICAvLyBjYXNlICdlbWFpbHNfc2V0dGluZ3NfcGFnZSc6XG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnbG9nc19zZXR0aW5nc19wYWdlJzpcbiAgICAgICAgICAgICAgICAvLyBjYXNlICdzeXN0ZW1fc2V0dGluZ3NfcGFnZSc6XG4gICAgICAgICAgICAgICAgLy8gY2FzZSAnYXBwX3NldHRpbmdzX3BhZ2UnOlxuICAgICAgICAgICAgICAgICAgICBpc0FsbG93ZWQgPSBhdXRoZW50aWNhdGVkLnVzZXI/LnJvbGUgIT09ICd1c2VyJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAvL21haWxlclxuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9tYWlsZXJfc2V0dGluZ3MnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzYXZlX21haWxlcl9zZXR0aW5ncyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZV9tYWlsZXJfc2V0dGluZ3MnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgICAgICAgICAvLyBwZXJtaXNzaW9ucyBhY3Rpb25zXG4gICAgICAgICAgICAgICAgY2FzZSAndmlld19sb2dzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgICAgICAgICAgLy8gcGVybWlzc2lvbnMgYWN0aW9uc1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZV9wZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZV9wZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZV9wZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9wZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9wZXJtaXNzaW9uJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2VhcmNoX3Blcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIHVzZXJzIGFjdGlvbnNcbiAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVfdXNlcnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlX3VzZXJzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IFxuICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZV91c2Vycyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyBcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfdXNlcnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfdXNlcic6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3NlYXJjaF91c2Vycyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBob3NwaXRhbHMgYWN0aW9uc1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZV9ob3NwaXRhbHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlX2hvc3BpdGFscyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyBcbiAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVfaG9zcGl0YWxzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IFxuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9ob3NwaXRhbHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfaG9zcGl0YWwnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzZWFyY2hfaG9zcGl0YWxzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIGNvbmZpZ3VyYXRpb24gYWN0aW9uc1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZV9jb25maWdfa2V5cyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyBcbiAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGVfY29uZmlnX2tleXMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlX2NvbmZpZ19rZXlzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IFxuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9jb25maWdfa2V5cyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2dldF9jb25maWdfa2V5JzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2VhcmNoX2NvbmZpZ19rZXlzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIHNjcmlwdHMgYWN0aW9uc1xuICAgICAgICAgICAgICAgIGNhc2UgJ2ltcG9ydF9zY3JpcHRzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlX3NjcmlwdHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlX3NjcmlwdHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlX3NjcmlwdHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZ2V0X3NjcmlwdHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfc2NyaXB0JzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2VhcmNoX3NjcmlwdHMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gc2NyZWVucyBhY3Rpb25zXG4gICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlX3NjcmVlbnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlX3NjcmVlbnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlX3NjcmVlbnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZ2V0X3NjcmVlbnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfc2NyZWVuJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2VhcmNoX3NjcmVlbnMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gZGlhZ25vc2VzIGFjdGlvbnNcbiAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVfZGlhZ25vc2VzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IFxuICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZV9kaWFnbm9zZXMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhazsgXG4gICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlX2RpYWdub3Nlcyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyBcbiAgICAgICAgICAgICAgICBjYXNlICdnZXRfZGlhZ25vc2VzJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZ2V0X2RpYWdub3Npcyc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3NlYXJjaF9kaWFnbm9zZXMnOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyAuLi5hdXRoZW50aWNhdGVkLCB5ZXM6IGlzQWxsb3dlZCwgfTtcbn1cbiJdLCJuYW1lcyI6WyJpc0F1dGhlbnRpY2F0ZWQiLCJsb2dnZXIiLCJjYW5BY2Nlc3NQYWdlIiwicGVybSIsInJlc3BvbnNlIiwieWVzIiwidXNlciIsImlzQWxsb3dlZCIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJhY3Rpb24iLCJhdXRoZW50aWNhdGVkIiwiRXJyb3IiLCJhY3Rpb25zIiwicm9sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/actions/is-allowed.ts\n");

/***/ }),

/***/ "(rsc)/./app/actions/is-authenticated.ts":
/*!*****************************************!*\
  !*** ./app/actions/is-authenticated.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isAuthenticated: () => (/* binding */ isAuthenticated)\n/* harmony export */ });\n/* harmony import */ var _app_actions_authenticate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/app/actions/authenticate */ \"(rsc)/./app/actions/authenticate.ts\");\n/* harmony import */ var _app_actions_get_authenticated_user__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/app/actions/get-authenticated-user */ \"(rsc)/./app/actions/get-authenticated-user.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\nasync function isAuthenticated() {\n    try {\n        let isAuthenticated = await (0,_app_actions_authenticate__WEBPACK_IMPORTED_MODULE_0__.validateHeadersItem)(\"x-api-key\", _app_actions_authenticate__WEBPACK_IMPORTED_MODULE_0__.validateApiKey);\n        if (!isAuthenticated) isAuthenticated = await (0,_app_actions_authenticate__WEBPACK_IMPORTED_MODULE_0__.validateHeadersItem)(\"x-auth-token\", (value)=>(0,_app_actions_authenticate__WEBPACK_IMPORTED_MODULE_0__.validateAuthClient)(\"token\", value));\n        let user = null;\n        if (!isAuthenticated) {\n            user = await (0,_app_actions_get_authenticated_user__WEBPACK_IMPORTED_MODULE_1__.getAuthenticatedUser)();\n            isAuthenticated = !!user;\n        }\n        return {\n            yes: isAuthenticated,\n            user\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"isAuthenticated ERROR\", e);\n        return {\n            yes: false,\n            user: null\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYWN0aW9ucy9pcy1hdXRoZW50aWNhdGVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBcUc7QUFDekI7QUFDMUM7QUFFM0IsZUFBZUs7SUFDckIsSUFBSTtRQUNHLElBQUlBLGtCQUFrQixNQUFNSCw4RUFBbUJBLENBQUMsYUFBYUYscUVBQWNBO1FBRTNFLElBQUksQ0FBQ0ssaUJBQWlCQSxrQkFBa0IsTUFBTUgsOEVBQW1CQSxDQUFDLGdCQUFnQkksQ0FBQUEsUUFBU0wsNkVBQWtCQSxDQUFDLFNBQVNLO1FBRXZILElBQUlDLE9BQXlEO1FBQzdELElBQUksQ0FBQ0YsaUJBQWlCO1lBQ2xCRSxPQUFPLE1BQU1KLHlGQUFvQkE7WUFDakNFLGtCQUFrQixDQUFDLENBQUNFO1FBQ3hCO1FBRUEsT0FBTztZQUFFQyxLQUFLSDtZQUFpQkU7UUFBTTtJQUM1QyxFQUFFLE9BQU1FLEdBQUc7UUFDVkwsbURBQU1BLENBQUNNLEtBQUssQ0FBQyx5QkFBeUJEO1FBQ3RDLE9BQU87WUFBRUQsS0FBSztZQUFPRCxNQUFNO1FBQU07SUFDbEM7QUFDRCIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vYXBwL2FjdGlvbnMvaXMtYXV0aGVudGljYXRlZC50cz81MzVkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHZhbGlkYXRlQXBpS2V5LCB2YWxpZGF0ZUF1dGhDbGllbnQsIHZhbGlkYXRlSGVhZGVyc0l0ZW0gfSBmcm9tIFwiQC9hcHAvYWN0aW9ucy9hdXRoZW50aWNhdGVcIjtcbmltcG9ydCB7IGdldEF1dGhlbnRpY2F0ZWRVc2VyIH0gZnJvbSBcIkAvYXBwL2FjdGlvbnMvZ2V0LWF1dGhlbnRpY2F0ZWQtdXNlclwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKSB7XG5cdHRyeSB7XG4gICAgICAgIGxldCBpc0F1dGhlbnRpY2F0ZWQgPSBhd2FpdCB2YWxpZGF0ZUhlYWRlcnNJdGVtKCd4LWFwaS1rZXknLCB2YWxpZGF0ZUFwaUtleSk7XG5cbiAgICAgICAgaWYgKCFpc0F1dGhlbnRpY2F0ZWQpIGlzQXV0aGVudGljYXRlZCA9IGF3YWl0IHZhbGlkYXRlSGVhZGVyc0l0ZW0oJ3gtYXV0aC10b2tlbicsIHZhbHVlID0+IHZhbGlkYXRlQXV0aENsaWVudCgndG9rZW4nLCB2YWx1ZSkpO1xuXG4gICAgICAgIGxldCB1c2VyOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIGdldEF1dGhlbnRpY2F0ZWRVc2VyPj4gPSBudWxsO1xuICAgICAgICBpZiAoIWlzQXV0aGVudGljYXRlZCkge1xuICAgICAgICAgICAgdXNlciA9IGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKCk7XG4gICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSAhIXVzZXI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyB5ZXM6IGlzQXV0aGVudGljYXRlZCwgdXNlciwgfTtcblx0fSBjYXRjaChlKSB7XG5cdFx0bG9nZ2VyLmVycm9yKCdpc0F1dGhlbnRpY2F0ZWQgRVJST1InLCBlKTtcblx0XHRyZXR1cm4geyB5ZXM6IGZhbHNlLCB1c2VyOiBudWxsLCB9O1xuXHR9XG59XG4iXSwibmFtZXMiOlsidmFsaWRhdGVBcGlLZXkiLCJ2YWxpZGF0ZUF1dGhDbGllbnQiLCJ2YWxpZGF0ZUhlYWRlcnNJdGVtIiwiZ2V0QXV0aGVudGljYXRlZFVzZXIiLCJsb2dnZXIiLCJpc0F1dGhlbnRpY2F0ZWQiLCJ2YWx1ZSIsInVzZXIiLCJ5ZXMiLCJlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/actions/is-authenticated.ts\n");

/***/ }),

/***/ "(rsc)/./app/actions/ops.ts":
/*!****************************!*\
  !*** ./app/actions/ops.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $$ACTION_0: () => (/* binding */ $$ACTION_0),\n/* harmony export */   $$ACTION_1: () => (/* binding */ $$ACTION_1),\n/* harmony export */   countAllDrafts: () => (/* binding */ countAllDrafts),\n/* harmony export */   discardDrafts: () => (/* binding */ discardDrafts),\n/* harmony export */   getEditorDetails: () => (/* binding */ getEditorDetails),\n/* harmony export */   publishData: () => (/* binding */ publishData),\n/* harmony export */   revalidatePath: () => (/* binding */ revalidatePath)\n/* harmony export */ });\n/* harmony import */ var private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! private-next-rsc-server-reference */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! private-next-rsc-action-encryption */ \"(rsc)/./node_modules/next/dist/server/app-render/encryption.js\");\n/* harmony import */ var private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(private_next_rsc_action_encryption__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_cache__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/cache */ \"(rsc)/./node_modules/next/cache.js\");\n/* harmony import */ var next_cache__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_cache__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_mutations_scripts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/databases/mutations/_scripts */ \"(rsc)/./databases/mutations/_scripts/index.ts\");\n/* harmony import */ var _databases_mutations_config_keys__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/databases/mutations/_config-keys */ \"(rsc)/./databases/mutations/_config-keys.ts\");\n/* harmony import */ var _is_allowed__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./is-allowed */ \"(rsc)/./app/actions/is-allowed.ts\");\n/* harmony import */ var _databases_mutations_screens__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @/databases/mutations/screens */ \"(rsc)/./databases/mutations/screens.ts\");\n/* harmony import */ var _databases_queries_config_keys_drafts__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @/databases/queries/_config-keys-drafts */ \"(rsc)/./databases/queries/_config-keys-drafts.ts\");\n/* harmony import */ var _databases_queries_screens_drafts__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @/databases/queries/screens-drafts */ \"(rsc)/./databases/queries/screens-drafts.ts\");\n/* harmony import */ var _databases_queries_scripts_drafts__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @/databases/queries/scripts-drafts */ \"(rsc)/./databases/queries/scripts-drafts.ts\");\n/* harmony import */ var _databases_mutations_config_keys_drafts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @/databases/mutations/_config-keys-drafts */ \"(rsc)/./databases/mutations/_config-keys-drafts.ts\");\n/* harmony import */ var _databases_mutations_screens_drafts__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @/databases/mutations/screens-drafts */ \"(rsc)/./databases/mutations/screens-drafts.ts\");\n/* harmony import */ var _databases_mutations_scripts_drafts__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @/databases/mutations/scripts-drafts */ \"(rsc)/./databases/mutations/scripts-drafts.ts\");\n/* harmony import */ var _databases_mutations_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @/databases/mutations/diagnoses-drafts */ \"(rsc)/./databases/mutations/diagnoses-drafts.ts\");\n/* harmony import */ var _databases_mutations_diagnoses__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @/databases/mutations/diagnoses */ \"(rsc)/./databases/mutations/diagnoses.ts\");\n/* harmony import */ var _databases_queries_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @/databases/queries/diagnoses-drafts */ \"(rsc)/./databases/queries/diagnoses-drafts.ts\");\n/* harmony import */ var _databases_mutations_ops__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @/databases/mutations/ops */ \"(rsc)/./databases/mutations/ops/index.ts\");\n/* harmony import */ var _databases_queries_ops__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @/databases/queries/ops */ \"(rsc)/./databases/queries/ops/index.ts\");\n/* harmony import */ var _databases_mutations_editor_info__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @/databases/mutations/editor-info */ \"(rsc)/./databases/mutations/editor-info/index.ts\");\n/* harmony import */ var _databases_queries_editor_info__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @/databases/queries/editor-info */ \"(rsc)/./databases/queries/editor-info/index.ts\");\n/* harmony import */ var private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! private-next-rsc-action-validate */ \"(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js\");\n/* __next_internal_action_entry_do_not_use__ {\"1deaec5322a5d4e3e3d426178bd61a39c0c28ae9\":\"publishData\",\"3b2ac91bc81489809370d893a7d7c83a162e1a96\":\"countAllDrafts\",\"64f3a633dace3ede963f725b16dc2b5f210bdd56\":\"$$ACTION_1\",\"6631df3cf85446a0818ac2dde947f63d2fad6c89\":\"$$ACTION_0\",\"7b75f487e334a946b63829017d9aa902b59378e0\":\"getEditorDetails\",\"893d510641fbd37b4cbe2a75916de7869dd43ca6\":\"revalidatePath\",\"e8515d84060942f8f3866c65cc44204f02ef54e2\":\"discardDrafts\"} */ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nasync function getEditorDetails() {\n    const errors = [];\n    let shouldPublishData = false;\n    try {\n        const editorInfo = await (0,_databases_queries_editor_info__WEBPACK_IMPORTED_MODULE_21__._getEditorInfo)();\n        editorInfo.errors?.forEach((e)=>errors.push(e));\n        const pendingDeletion = await _databases_queries_ops__WEBPACK_IMPORTED_MODULE_19__._countPendingDeletion();\n        pendingDeletion.errors?.forEach((e)=>errors.push(e));\n        const { errors: draftsErrors, ...drafts } = await _databases_queries_ops__WEBPACK_IMPORTED_MODULE_19__._countDrafts();\n        draftsErrors?.forEach((e)=>errors.push(e));\n        const mode = \"development\";\n        shouldPublishData = mode === \"development\" && (!!drafts.total || !!pendingDeletion.total);\n        return {\n            pendingDeletion: pendingDeletion.total,\n            drafts,\n            errors: errors.length ? errors : undefined,\n            shouldPublishData,\n            info: editorInfo.data\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_4__[\"default\"].error(\"getEditorDetails ERROR\", e.message);\n        return {\n            errors: [\n                e.message,\n                ...errors\n            ],\n            pendingDeletion: 0,\n            drafts: _databases_queries_ops__WEBPACK_IMPORTED_MODULE_19__.defaultCountDraftsData,\n            shouldPublishData,\n            info: null\n        };\n    }\n}\nconst revalidatePath = (0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"6631df3cf85446a0818ac2dde947f63d2fad6c89\", $$ACTION_0);\nasync function $$ACTION_0(path, type) {\n    return (0,next_cache__WEBPACK_IMPORTED_MODULE_2__.revalidatePath)(path, type);\n}\nconst countAllDrafts = (0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"64f3a633dace3ede963f725b16dc2b5f210bdd56\", $$ACTION_1);\nasync function $$ACTION_1() {\n    try {\n        const configKeys = await (0,_databases_queries_config_keys_drafts__WEBPACK_IMPORTED_MODULE_9__._countConfigKeysDrafts)();\n        const screens = await (0,_databases_queries_screens_drafts__WEBPACK_IMPORTED_MODULE_10__._countScreensDrafts)();\n        const scripts = await (0,_databases_queries_scripts_drafts__WEBPACK_IMPORTED_MODULE_11__._countScriptsDrafts)();\n        const diagnoses = await (0,_databases_queries_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_17__._countDiagnosesDrafts)();\n        return {\n            configKeys,\n            screens,\n            scripts,\n            diagnoses\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_4__[\"default\"].error(\"countAllDrafts ERROR\", e.message);\n        return {\n            screens: 0,\n            scripts: 0,\n            configKeys: 0,\n            diagnoses: 0\n        };\n    }\n}\nasync function publishData() {\n    const results = {\n        success: true\n    };\n    try {\n        await (0,_is_allowed__WEBPACK_IMPORTED_MODULE_7__.isAllowed)([\n            \"create_config_keys\",\n            \"update_config_keys\",\n            \"create_scripts\",\n            \"update_scripts\",\n            \"create_diagnoses\",\n            \"update_diagnoses\",\n            \"create_screens\",\n            \"update_screens\"\n        ]);\n        const publishConfigKeys = await (0,_databases_mutations_config_keys__WEBPACK_IMPORTED_MODULE_6__._publishConfigKeys)();\n        const publishScripts = await (0,_databases_mutations_scripts__WEBPACK_IMPORTED_MODULE_5__._publishScripts)();\n        const publishScreens = await (0,_databases_mutations_screens__WEBPACK_IMPORTED_MODULE_8__._publishScreens)();\n        const publishDiagnoses = await (0,_databases_mutations_diagnoses__WEBPACK_IMPORTED_MODULE_16__._publishDiagnoses)();\n        if (publishConfigKeys.errors) {\n            results.success = false;\n            results.errors = [\n                ...results.errors || [],\n                ...publishConfigKeys.errors\n            ];\n        }\n        if (publishScripts.errors) {\n            results.success = false;\n            results.errors = [\n                ...results.errors || [],\n                ...publishScripts.errors\n            ];\n        }\n        if (publishScreens.errors) {\n            results.success = false;\n            results.errors = [\n                ...results.errors || [],\n                ...publishScreens.errors\n            ];\n        }\n        if (publishDiagnoses.errors) {\n            results.success = false;\n            results.errors = [\n                ...results.errors || [],\n                ...publishDiagnoses.errors\n            ];\n        }\n        await (0,_databases_mutations_editor_info__WEBPACK_IMPORTED_MODULE_20__._saveEditorInfo)({\n            increaseVersion: results.success,\n            broadcastAction: true,\n            data: {\n                lastPublishDate: new Date()\n            }\n        });\n        _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"publish_data\");\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_4__[\"default\"].error(\"publishData ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function discardDrafts() {\n    const results = {\n        success: true\n    };\n    try {\n        await (0,_is_allowed__WEBPACK_IMPORTED_MODULE_7__.isAllowed)([\n            \"delete_config_keys\",\n            \"delete_scripts\",\n            \"delete_diagnoses\",\n            \"delete_screens\"\n        ]);\n        await (0,_databases_mutations_config_keys_drafts__WEBPACK_IMPORTED_MODULE_12__._deleteAllConfigKeysDrafts)();\n        await (0,_databases_mutations_scripts_drafts__WEBPACK_IMPORTED_MODULE_14__._deleteAllScriptsDrafts)();\n        await (0,_databases_mutations_screens_drafts__WEBPACK_IMPORTED_MODULE_13__._deleteAllScreensDrafts)();\n        await (0,_databases_mutations_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_15__._deleteAllDiagnosesDrafts)();\n        await (0,_databases_mutations_ops__WEBPACK_IMPORTED_MODULE_18__._clearPendingDeletion)();\n        _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"discard_drafts\");\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_4__[\"default\"].error(\"publishData ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\n\n(0,private_next_rsc_action_validate__WEBPACK_IMPORTED_MODULE_22__.ensureServerEntryExports)([\n    getEditorDetails,\n    revalidatePath,\n    countAllDrafts,\n    publishData,\n    discardDrafts\n]);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"7b75f487e334a946b63829017d9aa902b59378e0\", getEditorDetails);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"893d510641fbd37b4cbe2a75916de7869dd43ca6\", revalidatePath);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"3b2ac91bc81489809370d893a7d7c83a162e1a96\", countAllDrafts);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"1deaec5322a5d4e3e3d426178bd61a39c0c28ae9\", publishData);\n(0,private_next_rsc_server_reference__WEBPACK_IMPORTED_MODULE_0__.registerServerReference)(\"e8515d84060942f8f3866c65cc44204f02ef54e2\", discardDrafts);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NkZBQXVCQTtRQUM3QixNQUFNRSxpR0FBeUJBO1FBQy9CLE1BQU1HLGdGQUFxQkE7UUFFNUJmLG1EQUFNQSxDQUFDMEQsSUFBSSxDQUFDLGdCQUFnQjtJQUNoQyxFQUFFLE9BQU1sQyxHQUFRO1FBQ1p3QixRQUFRQyxPQUFPLEdBQUc7UUFDbEJELFFBQVE1QixNQUFNLEdBQUc7WUFBQ0ksRUFBRWMsT0FBTztTQUFDO1FBQzVCckMsbURBQU1BLENBQUNvQyxLQUFLLENBQUMscUJBQXFCYixFQUFFYyxPQUFPO0lBQy9DLFNBQVU7UUFDTixPQUFPVTtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2FwcC9hY3Rpb25zL29wcy50cz9mMjE5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc2VydmVyJztcblxuaW1wb3J0IHsgcmV2YWxpZGF0ZVBhdGggYXMgX3JldmFsaWRhdGVQYXRoIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcblxuaW1wb3J0IHNvY2tldCBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgX3B1Ymxpc2hTY3JpcHRzIH0gZnJvbSAnQC9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzJztcbmltcG9ydCB7IF9wdWJsaXNoQ29uZmlnS2V5cyB9IGZyb20gJ0AvZGF0YWJhc2VzL211dGF0aW9ucy9fY29uZmlnLWtleXMnO1xuaW1wb3J0IHsgaXNBbGxvd2VkIH0gZnJvbSAnLi9pcy1hbGxvd2VkJztcbmltcG9ydCB7IF9wdWJsaXNoU2NyZWVucyB9IGZyb20gJ0AvZGF0YWJhc2VzL211dGF0aW9ucy9zY3JlZW5zJztcbmltcG9ydCB7IE1vZGUgfSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB7IF9jb3VudENvbmZpZ0tleXNEcmFmdHMsICB9IGZyb20gJ0AvZGF0YWJhc2VzL3F1ZXJpZXMvX2NvbmZpZy1rZXlzLWRyYWZ0cyc7XG5pbXBvcnQgeyBfY291bnRTY3JlZW5zRHJhZnRzLCB9IGZyb20gJ0AvZGF0YWJhc2VzL3F1ZXJpZXMvc2NyZWVucy1kcmFmdHMnO1xuaW1wb3J0IHsgX2NvdW50U2NyaXB0c0RyYWZ0cywgfSBmcm9tICdAL2RhdGFiYXNlcy9xdWVyaWVzL3NjcmlwdHMtZHJhZnRzJztcbmltcG9ydCB7IF9kZWxldGVBbGxDb25maWdLZXlzRHJhZnRzLCAgfSBmcm9tICdAL2RhdGFiYXNlcy9tdXRhdGlvbnMvX2NvbmZpZy1rZXlzLWRyYWZ0cyc7XG5pbXBvcnQgeyBfZGVsZXRlQWxsU2NyZWVuc0RyYWZ0cywgfSBmcm9tICdAL2RhdGFiYXNlcy9tdXRhdGlvbnMvc2NyZWVucy1kcmFmdHMnO1xuaW1wb3J0IHsgX2RlbGV0ZUFsbFNjcmlwdHNEcmFmdHMsIH0gZnJvbSAnQC9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmlwdHMtZHJhZnRzJztcbmltcG9ydCB7IF9kZWxldGVBbGxEaWFnbm9zZXNEcmFmdHMgfSBmcm9tICdAL2RhdGFiYXNlcy9tdXRhdGlvbnMvZGlhZ25vc2VzLWRyYWZ0cyc7XG5pbXBvcnQgeyBfcHVibGlzaERpYWdub3NlcyB9IGZyb20gJ0AvZGF0YWJhc2VzL211dGF0aW9ucy9kaWFnbm9zZXMnO1xuaW1wb3J0IHsgX2NvdW50RGlhZ25vc2VzRHJhZnRzIH0gZnJvbSAnQC9kYXRhYmFzZXMvcXVlcmllcy9kaWFnbm9zZXMtZHJhZnRzJztcbmltcG9ydCB7IF9jbGVhclBlbmRpbmdEZWxldGlvbiB9IGZyb20gJ0AvZGF0YWJhc2VzL211dGF0aW9ucy9vcHMnO1xuaW1wb3J0ICogYXMgb3BzUXVlcmllcyBmcm9tICdAL2RhdGFiYXNlcy9xdWVyaWVzL29wcyc7XG5pbXBvcnQgeyBfc2F2ZUVkaXRvckluZm8gfSBmcm9tICdAL2RhdGFiYXNlcy9tdXRhdGlvbnMvZWRpdG9yLWluZm8nO1xuaW1wb3J0IHsgX2dldEVkaXRvckluZm8sIEdldEVkaXRvckluZm9SZXN1bHRzIH0gZnJvbSAnQC9kYXRhYmFzZXMvcXVlcmllcy9lZGl0b3ItaW5mbyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFZGl0b3JEZXRhaWxzKCk6IFByb21pc2U8e1xuICAgIGVycm9ycz86IHN0cmluZ1tdO1xuICAgIHNob3VsZFB1Ymxpc2hEYXRhOiBib29sZWFuO1xuICAgIHBlbmRpbmdEZWxldGlvbjogbnVtYmVyO1xuICAgIGRyYWZ0czogdHlwZW9mIG9wc1F1ZXJpZXMuZGVmYXVsdENvdW50RHJhZnRzRGF0YTtcbiAgICBpbmZvOiBHZXRFZGl0b3JJbmZvUmVzdWx0c1snZGF0YSddO1xufT4ge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgc2hvdWxkUHVibGlzaERhdGEgPSBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlZGl0b3JJbmZvID0gYXdhaXQgX2dldEVkaXRvckluZm8oKTtcbiAgICAgICAgZWRpdG9ySW5mby5lcnJvcnM/LmZvckVhY2goZSA9PiBlcnJvcnMucHVzaChlKSk7XG5cbiAgICAgICAgY29uc3QgcGVuZGluZ0RlbGV0aW9uID0gYXdhaXQgb3BzUXVlcmllcy5fY291bnRQZW5kaW5nRGVsZXRpb24oKTtcbiAgICAgICAgcGVuZGluZ0RlbGV0aW9uLmVycm9ycz8uZm9yRWFjaChlID0+IGVycm9ycy5wdXNoKGUpKTtcblxuICAgICAgICBjb25zdCB7IGVycm9yczogZHJhZnRzRXJyb3JzLCAuLi5kcmFmdHMgfSA9IGF3YWl0IG9wc1F1ZXJpZXMuX2NvdW50RHJhZnRzKCk7XG4gICAgICAgIGRyYWZ0c0Vycm9ycz8uZm9yRWFjaChlID0+IGVycm9ycy5wdXNoKGUpKTtcblxuICAgICAgICBjb25zdCBtb2RlID0gJ2RldmVsb3BtZW50JztcblxuICAgICAgICBzaG91bGRQdWJsaXNoRGF0YSA9IChtb2RlID09PSAnZGV2ZWxvcG1lbnQnKSAmJiAoISFkcmFmdHMudG90YWwgfHwgISFwZW5kaW5nRGVsZXRpb24udG90YWwpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwZW5kaW5nRGVsZXRpb246IHBlbmRpbmdEZWxldGlvbi50b3RhbCxcbiAgICAgICAgICAgIGRyYWZ0cyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3JzLmxlbmd0aCA/IGVycm9ycyA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNob3VsZFB1Ymxpc2hEYXRhLFxuICAgICAgICAgICAgaW5mbzogZWRpdG9ySW5mby5kYXRhLFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignZ2V0RWRpdG9yRGV0YWlscyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlcnJvcnM6IFtlLm1lc3NhZ2UsIC4uLmVycm9yc10sXG4gICAgICAgICAgICBwZW5kaW5nRGVsZXRpb246IDAsXG4gICAgICAgICAgICBkcmFmdHM6IG9wc1F1ZXJpZXMuZGVmYXVsdENvdW50RHJhZnRzRGF0YSxcbiAgICAgICAgICAgIHNob3VsZFB1Ymxpc2hEYXRhLFxuICAgICAgICAgICAgaW5mbzogbnVsbCxcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZXZhbGlkYXRlUGF0aCA9IGFzeW5jIChcbiAgICBwYXRoOiBQYXJhbWV0ZXJzPHR5cGVvZiBfcmV2YWxpZGF0ZVBhdGg+WzBdLCBcbiAgICB0eXBlPzogUGFyYW1ldGVyczx0eXBlb2YgX3JldmFsaWRhdGVQYXRoPlsxXVxuKSA9PiBfcmV2YWxpZGF0ZVBhdGgocGF0aCwgdHlwZSk7XG5cbmV4cG9ydCBjb25zdCBjb3VudEFsbERyYWZ0cyA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb25maWdLZXlzID0gYXdhaXQgX2NvdW50Q29uZmlnS2V5c0RyYWZ0cygpO1xuICAgICAgICBjb25zdCBzY3JlZW5zID0gYXdhaXQgX2NvdW50U2NyZWVuc0RyYWZ0cygpO1xuICAgICAgICBjb25zdCBzY3JpcHRzID0gYXdhaXQgX2NvdW50U2NyaXB0c0RyYWZ0cygpO1xuICAgICAgICBjb25zdCBkaWFnbm9zZXMgPSBhd2FpdCBfY291bnREaWFnbm9zZXNEcmFmdHMoKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29uZmlnS2V5cyxcbiAgICAgICAgICAgIHNjcmVlbnMsXG4gICAgICAgICAgICBzY3JpcHRzLFxuICAgICAgICAgICAgZGlhZ25vc2VzLFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignY291bnRBbGxEcmFmdHMgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2NyZWVuczogMCxcbiAgICAgICAgICAgIHNjcmlwdHM6IDAsXG4gICAgICAgICAgICBjb25maWdLZXlzOiAwLFxuICAgICAgICAgICAgZGlhZ25vc2VzOiAwLFxuICAgICAgICB9O1xuICAgIH1cbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwdWJsaXNoRGF0YSgpIHtcbiAgICBjb25zdCByZXN1bHRzOiB7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9ycz86IHN0cmluZ1tdOyB9ID0geyBzdWNjZXNzOiB0cnVlLCB9O1xuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGlzQWxsb3dlZChbXG4gICAgICAgICAgICAnY3JlYXRlX2NvbmZpZ19rZXlzJywgXG4gICAgICAgICAgICAndXBkYXRlX2NvbmZpZ19rZXlzJywgXG4gICAgICAgICAgICAnY3JlYXRlX3NjcmlwdHMnLCBcbiAgICAgICAgICAgICd1cGRhdGVfc2NyaXB0cycsXG4gICAgICAgICAgICAnY3JlYXRlX2RpYWdub3NlcycsXG4gICAgICAgICAgICAndXBkYXRlX2RpYWdub3NlcycsXG4gICAgICAgICAgICAnY3JlYXRlX3NjcmVlbnMnLFxuICAgICAgICAgICAgJ3VwZGF0ZV9zY3JlZW5zJyxcbiAgICAgICAgXSk7XG5cbiAgICAgICAgY29uc3QgcHVibGlzaENvbmZpZ0tleXMgPSBhd2FpdCBfcHVibGlzaENvbmZpZ0tleXMoKTtcbiAgICAgICAgY29uc3QgcHVibGlzaFNjcmlwdHMgPSBhd2FpdCBfcHVibGlzaFNjcmlwdHMoKTtcbiAgICAgICAgY29uc3QgcHVibGlzaFNjcmVlbnMgPSBhd2FpdCBfcHVibGlzaFNjcmVlbnMoKTtcbiAgICAgICAgY29uc3QgcHVibGlzaERpYWdub3NlcyA9IGF3YWl0IF9wdWJsaXNoRGlhZ25vc2VzKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAocHVibGlzaENvbmZpZ0tleXMuZXJyb3JzKSB7XG4gICAgICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIC4uLnB1Ymxpc2hDb25maWdLZXlzLmVycm9yc107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHVibGlzaFNjcmlwdHMuZXJyb3JzKSB7XG4gICAgICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIC4uLnB1Ymxpc2hTY3JpcHRzLmVycm9yc107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHVibGlzaFNjcmVlbnMuZXJyb3JzKSB7XG4gICAgICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIC4uLnB1Ymxpc2hTY3JlZW5zLmVycm9yc107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHVibGlzaERpYWdub3Nlcy5lcnJvcnMpIHtcbiAgICAgICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbLi4uKHJlc3VsdHMuZXJyb3JzIHx8IFtdKSwgLi4ucHVibGlzaERpYWdub3Nlcy5lcnJvcnNdO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgX3NhdmVFZGl0b3JJbmZvKHsgXG4gICAgICAgICAgICBpbmNyZWFzZVZlcnNpb246IHJlc3VsdHMuc3VjY2VzcywgXG4gICAgICAgICAgICBicm9hZGNhc3RBY3Rpb246IHRydWUsIFxuICAgICAgICAgICAgZGF0YTogeyBsYXN0UHVibGlzaERhdGU6IG5ldyBEYXRlKCksIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAncHVibGlzaF9kYXRhJyk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdHMuZXJyb3JzID0gW2UubWVzc2FnZV07XG4gICAgICAgIGxvZ2dlci5lcnJvcigncHVibGlzaERhdGEgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpc2NhcmREcmFmdHMoKSB7XG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogdHJ1ZSwgfTtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBpc0FsbG93ZWQoW1xuICAgICAgICAgICAgJ2RlbGV0ZV9jb25maWdfa2V5cycsIFxuICAgICAgICAgICAgJ2RlbGV0ZV9zY3JpcHRzJywgXG4gICAgICAgICAgICAnZGVsZXRlX2RpYWdub3NlcycsXG4gICAgICAgICAgICAnZGVsZXRlX3NjcmVlbnMnLFxuICAgICAgICBdKTtcblxuICAgICAgICAgYXdhaXQgX2RlbGV0ZUFsbENvbmZpZ0tleXNEcmFmdHMoKTtcbiAgICAgICAgIGF3YWl0IF9kZWxldGVBbGxTY3JpcHRzRHJhZnRzKCk7XG4gICAgICAgICBhd2FpdCBfZGVsZXRlQWxsU2NyZWVuc0RyYWZ0cygpO1xuICAgICAgICAgYXdhaXQgX2RlbGV0ZUFsbERpYWdub3Nlc0RyYWZ0cygpO1xuICAgICAgICAgYXdhaXQgX2NsZWFyUGVuZGluZ0RlbGV0aW9uKCk7XG5cbiAgICAgICAgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdkaXNjYXJkX2RyYWZ0cycpO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXN1bHRzLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ3B1Ymxpc2hEYXRhIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG4iXSwibmFtZXMiOlsicmV2YWxpZGF0ZVBhdGgiLCJfcmV2YWxpZGF0ZVBhdGgiLCJzb2NrZXQiLCJsb2dnZXIiLCJfcHVibGlzaFNjcmlwdHMiLCJfcHVibGlzaENvbmZpZ0tleXMiLCJpc0FsbG93ZWQiLCJfcHVibGlzaFNjcmVlbnMiLCJfY291bnRDb25maWdLZXlzRHJhZnRzIiwiX2NvdW50U2NyZWVuc0RyYWZ0cyIsIl9jb3VudFNjcmlwdHNEcmFmdHMiLCJfZGVsZXRlQWxsQ29uZmlnS2V5c0RyYWZ0cyIsIl9kZWxldGVBbGxTY3JlZW5zRHJhZnRzIiwiX2RlbGV0ZUFsbFNjcmlwdHNEcmFmdHMiLCJfZGVsZXRlQWxsRGlhZ25vc2VzRHJhZnRzIiwiX3B1Ymxpc2hEaWFnbm9zZXMiLCJfY291bnREaWFnbm9zZXNEcmFmdHMiLCJfY2xlYXJQZW5kaW5nRGVsZXRpb24iLCJvcHNRdWVyaWVzIiwiX3NhdmVFZGl0b3JJbmZvIiwiX2dldEVkaXRvckluZm8iLCJnZXRFZGl0b3JEZXRhaWxzIiwiZXJyb3JzIiwic2hvdWxkUHVibGlzaERhdGEiLCJlZGl0b3JJbmZvIiwiZm9yRWFjaCIsImUiLCJwdXNoIiwicGVuZGluZ0RlbGV0aW9uIiwiX2NvdW50UGVuZGluZ0RlbGV0aW9uIiwiZHJhZnRzRXJyb3JzIiwiZHJhZnRzIiwiX2NvdW50RHJhZnRzIiwibW9kZSIsInRvdGFsIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiaW5mbyIsImRhdGEiLCJlcnJvciIsIm1lc3NhZ2UiLCJkZWZhdWx0Q291bnREcmFmdHNEYXRhIiwicGF0aCIsInR5cGUiLCJjb3VudEFsbERyYWZ0cyIsImNvbmZpZ0tleXMiLCJzY3JlZW5zIiwic2NyaXB0cyIsImRpYWdub3NlcyIsInB1Ymxpc2hEYXRhIiwicmVzdWx0cyIsInN1Y2Nlc3MiLCJwdWJsaXNoQ29uZmlnS2V5cyIsInB1Ymxpc2hTY3JpcHRzIiwicHVibGlzaFNjcmVlbnMiLCJwdWJsaXNoRGlhZ25vc2VzIiwiaW5jcmVhc2VWZXJzaW9uIiwiYnJvYWRjYXN0QWN0aW9uIiwibGFzdFB1Ymxpc2hEYXRlIiwiRGF0ZSIsImVtaXQiLCJkaXNjYXJkRHJhZnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/actions/ops.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/ops/discard-drafts/route.ts":
/*!*********************************************!*\
  !*** ./app/api/ops/discard-drafts/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _app_actions_is_authenticated__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/app/actions/is-authenticated */ \"(rsc)/./app/actions/is-authenticated.ts\");\n/* harmony import */ var _app_actions_ops__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/app/actions/ops */ \"(rsc)/./app/actions/ops.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\nasync function POST(req) {\n    try {\n        const isAuthorised = await (0,_app_actions_is_authenticated__WEBPACK_IMPORTED_MODULE_1__.isAuthenticated)();\n        if (!isAuthorised.yes) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            errors: [\n                \"Unauthorised\"\n            ]\n        }, {\n            status: 200\n        });\n        const data = await (0,_app_actions_ops__WEBPACK_IMPORTED_MODULE_2__.discardDrafts)();\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].log(\"/api/ops/publish-data\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            errors: [\n                e.message\n            ]\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL29wcy9kaXNjYXJkLWRyYWZ0cy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUF3RDtBQUVTO0FBQ2Y7QUFDaEI7QUFFM0IsZUFBZUksS0FBS0MsR0FBZ0I7SUFDdkMsSUFBSTtRQUNBLE1BQU1DLGVBQWUsTUFBTUwsOEVBQWVBO1FBRTFDLElBQUksQ0FBQ0ssYUFBYUMsR0FBRyxFQUFFLE9BQU9QLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsUUFBUTtnQkFBQzthQUFlO1FBQUUsR0FBRztZQUFFQyxRQUFRO1FBQUs7UUFFOUYsTUFBTUMsT0FBTyxNQUFNVCwrREFBYUE7UUFFaEMsT0FBT0YscURBQVlBLENBQUNRLElBQUksQ0FBQ0c7SUFDN0IsRUFBRSxPQUFNQyxHQUFRO1FBQ1pULG1EQUFNQSxDQUFDVSxHQUFHLENBQUMseUJBQXlCRDtRQUNwQyxPQUFPWixxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO1lBQUVDLFFBQVE7Z0JBQUNHLEVBQUVFLE9BQU87YUFBQztRQUFFO0lBQ3BEO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2FwcC9hcGkvb3BzL2Rpc2NhcmQtZHJhZnRzL3JvdXRlLnRzPzdhOTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuXG5pbXBvcnQgeyBpc0F1dGhlbnRpY2F0ZWQgfSBmcm9tIFwiQC9hcHAvYWN0aW9ucy9pcy1hdXRoZW50aWNhdGVkXCI7XG5pbXBvcnQgeyBkaXNjYXJkRHJhZnRzIH0gZnJvbSBcIkAvYXBwL2FjdGlvbnMvb3BzXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBOZXh0UmVxdWVzdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGlzQXV0aG9yaXNlZCA9IGF3YWl0IGlzQXV0aGVudGljYXRlZCgpO1xuXG4gICAgICAgIGlmICghaXNBdXRob3Jpc2VkLnllcykgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3JzOiBbJ1VuYXV0aG9yaXNlZCddLCB9LCB7IHN0YXR1czogMjAwLCB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBkaXNjYXJkRHJhZnRzKCk7XG5cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEpO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5sb2coJy9hcGkvb3BzL3B1Ymxpc2gtZGF0YScsIGUpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcnM6IFtlLm1lc3NhZ2VdLCB9KTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiaXNBdXRoZW50aWNhdGVkIiwiZGlzY2FyZERyYWZ0cyIsImxvZ2dlciIsIlBPU1QiLCJyZXEiLCJpc0F1dGhvcmlzZWQiLCJ5ZXMiLCJqc29uIiwiZXJyb3JzIiwic3RhdHVzIiwiZGF0YSIsImUiLCJsb2ciLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ops/discard-drafts/route.ts\n");

/***/ }),

/***/ "(rsc)/./constants/index.ts":
/*!****************************!*\
  !*** ./constants/index.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SymptomTypes: () => (/* binding */ SymptomTypes),\n/* harmony export */   defaultPreferences: () => (/* binding */ defaultPreferences),\n/* harmony export */   screenTypes: () => (/* binding */ screenTypes),\n/* harmony export */   scriptTypes: () => (/* binding */ scriptTypes),\n/* harmony export */   scriptsPageTabs: () => (/* binding */ scriptsPageTabs)\n/* harmony export */ });\nconst defaultPreferences = {\n    fontSize: {},\n    fontWeight: {},\n    fontStyle: {},\n    textColor: {},\n    backgroundColor: {},\n    highlight: {}\n};\nconst scriptsPageTabs = [\n    {\n        value: \"screens\",\n        label: \"Screens\"\n    },\n    {\n        value: \"diagnoses\",\n        label: \"Diagnoses\"\n    }\n];\nconst scriptTypes = [\n    {\n        label: \"Admission\",\n        value: \"admission\"\n    },\n    {\n        label: \"Discharge\",\n        value: \"discharge\"\n    },\n    {\n        label: \"Neolab\",\n        value: \"neolab\"\n    }\n];\nconst screenTypes = [\n    {\n        value: \"checklist\",\n        label: \"Checklist\"\n    },\n    {\n        value: \"form\",\n        label: \"Form\"\n    },\n    {\n        value: \"management\",\n        label: \"Management\"\n    },\n    {\n        value: \"multi_select\",\n        label: \"Multiple choice list\"\n    },\n    // { value: 'list', label: 'Simple list' },\n    {\n        value: \"single_select\",\n        label: \"Single choice list\"\n    },\n    {\n        value: \"progress\",\n        label: \"Progress\"\n    },\n    {\n        value: \"timer\",\n        label: \"Timer\"\n    },\n    {\n        value: \"yesno\",\n        label: \"Yes/No\"\n    },\n    {\n        value: \"zw_edliz_summary_table\",\n        label: \"EDLIZ summary table (ZW)\"\n    },\n    {\n        value: \"mwi_edliz_summary_table\",\n        label: \"EDLIZ summary table (MWI)\"\n    },\n    {\n        value: \"diagnosis\",\n        label: \"Diagnosis\"\n    }\n];\nconst SymptomTypes = [\n    {\n        value: \"risk\",\n        label: \"Risk factor\"\n    },\n    {\n        value: \"sign\",\n        label: \"Sign/Symptom\"\n    }\n];\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9jb25zdGFudHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFJTyxNQUFNQSxxQkFBcUI7SUFDOUJDLFVBQVUsQ0FBQztJQUNYQyxZQUFZLENBQUM7SUFDYkMsV0FBVyxDQUFDO0lBQ1pDLFdBQVcsQ0FBQztJQUNaQyxpQkFBaUIsQ0FBQztJQUNsQkMsV0FBVyxDQUFDO0FBQ2hCLEVBQWlCO0FBRVYsTUFBTUMsa0JBQWtCO0lBQzNCO1FBQUVDLE9BQU87UUFBV0MsT0FBTztJQUFXO0lBQ3RDO1FBQUVELE9BQU87UUFBYUMsT0FBTztJQUFhO0NBQzdDLENBQUM7QUFFSyxNQUFNQyxjQUFjO0lBQ3ZCO1FBQUVELE9BQU87UUFBYUQsT0FBTztJQUFhO0lBQzFDO1FBQUVDLE9BQU87UUFBYUQsT0FBTztJQUFhO0lBQzFDO1FBQUVDLE9BQU87UUFBVUQsT0FBTztJQUFVO0NBQ3ZDLENBQXdGO0FBRWxGLE1BQU1HLGNBQWM7SUFDdkI7UUFBRUgsT0FBTztRQUFhQyxPQUFPO0lBQVk7SUFDekM7UUFBRUQsT0FBTztRQUFRQyxPQUFPO0lBQU87SUFDL0I7UUFBRUQsT0FBTztRQUFjQyxPQUFPO0lBQWE7SUFDM0M7UUFBRUQsT0FBTztRQUFnQkMsT0FBTztJQUF1QjtJQUN2RCwyQ0FBMkM7SUFDM0M7UUFBRUQsT0FBTztRQUFpQkMsT0FBTztJQUFxQjtJQUN0RDtRQUFFRCxPQUFPO1FBQVlDLE9BQU87SUFBVztJQUN2QztRQUFFRCxPQUFPO1FBQVNDLE9BQU87SUFBUTtJQUNqQztRQUFFRCxPQUFPO1FBQVNDLE9BQU87SUFBUztJQUNsQztRQUFFRCxPQUFPO1FBQTBCQyxPQUFPO0lBQTJCO0lBQ3JFO1FBQUVELE9BQU87UUFBMkJDLE9BQU87SUFBNEI7SUFDdkU7UUFBRUQsT0FBTztRQUFhQyxPQUFPO0lBQVk7Q0FDNUMsQ0FBd0Y7QUFFbEYsTUFBTUcsZUFBZTtJQUN4QjtRQUFFSixPQUFPO1FBQVFDLE9BQU87SUFBZTtJQUN2QztRQUFFRCxPQUFPO1FBQVFDLE9BQU87SUFBZ0I7Q0FDM0MsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vY29uc3RhbnRzL2luZGV4LnRzPzY2NGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0U2NyZWVuV2l0aERyYWZ0IH0gZnJvbSBcIkAvYXBwL2FjdGlvbnMvX3NjcmVlbnNcIjtcbmltcG9ydCB7IGdldFNjcmlwdFdpdGhEcmFmdCB9IGZyb20gXCJAL2FwcC9hY3Rpb25zL19zY3JpcHRzXCI7XG5pbXBvcnQgeyBQcmVmZXJlbmNlcyB9IGZyb20gXCJAL3R5cGVzXCI7XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0UHJlZmVyZW5jZXMgPSB7IFxuICAgIGZvbnRTaXplOiB7fSwgXG4gICAgZm9udFdlaWdodDoge30sIFxuICAgIGZvbnRTdHlsZToge30sIFxuICAgIHRleHRDb2xvcjoge30sIFxuICAgIGJhY2tncm91bmRDb2xvcjoge30sIFxuICAgIGhpZ2hsaWdodDoge30sXG59IGFzIFByZWZlcmVuY2VzO1xuXG5leHBvcnQgY29uc3Qgc2NyaXB0c1BhZ2VUYWJzID0gW1xuICAgIHsgdmFsdWU6ICdzY3JlZW5zJywgbGFiZWw6ICdTY3JlZW5zJywgfSxcbiAgICB7IHZhbHVlOiAnZGlhZ25vc2VzJywgbGFiZWw6ICdEaWFnbm9zZXMnLCB9LFxuXTtcblxuZXhwb3J0IGNvbnN0IHNjcmlwdFR5cGVzID0gW1xuICAgIHsgbGFiZWw6ICdBZG1pc3Npb24nLCB2YWx1ZTogJ2FkbWlzc2lvbicsIH0sXG4gICAgeyBsYWJlbDogJ0Rpc2NoYXJnZScsIHZhbHVlOiAnZGlzY2hhcmdlJywgfSxcbiAgICB7IGxhYmVsOiAnTmVvbGFiJywgdmFsdWU6ICduZW9sYWInLCB9LFxuXSBhcyB7IGxhYmVsOiBzdHJpbmc7IHZhbHVlOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIGdldFNjcmlwdFdpdGhEcmFmdD4+Wyd0eXBlJ107IH1bXTtcblxuZXhwb3J0IGNvbnN0IHNjcmVlblR5cGVzID0gW1xuICAgIHsgdmFsdWU6ICdjaGVja2xpc3QnLCBsYWJlbDogJ0NoZWNrbGlzdCcgfSxcbiAgICB7IHZhbHVlOiAnZm9ybScsIGxhYmVsOiAnRm9ybScgfSxcbiAgICB7IHZhbHVlOiAnbWFuYWdlbWVudCcsIGxhYmVsOiAnTWFuYWdlbWVudCcgfSxcbiAgICB7IHZhbHVlOiAnbXVsdGlfc2VsZWN0JywgbGFiZWw6ICdNdWx0aXBsZSBjaG9pY2UgbGlzdCcgfSxcbiAgICAvLyB7IHZhbHVlOiAnbGlzdCcsIGxhYmVsOiAnU2ltcGxlIGxpc3QnIH0sXG4gICAgeyB2YWx1ZTogJ3NpbmdsZV9zZWxlY3QnLCBsYWJlbDogJ1NpbmdsZSBjaG9pY2UgbGlzdCcgfSxcbiAgICB7IHZhbHVlOiAncHJvZ3Jlc3MnLCBsYWJlbDogJ1Byb2dyZXNzJyB9LFxuICAgIHsgdmFsdWU6ICd0aW1lcicsIGxhYmVsOiAnVGltZXInIH0sXG4gICAgeyB2YWx1ZTogJ3llc25vJywgbGFiZWw6ICdZZXMvTm8nIH0sXG4gICAgeyB2YWx1ZTogJ3p3X2VkbGl6X3N1bW1hcnlfdGFibGUnLCBsYWJlbDogJ0VETElaIHN1bW1hcnkgdGFibGUgKFpXKScgfSxcbiAgICB7IHZhbHVlOiAnbXdpX2VkbGl6X3N1bW1hcnlfdGFibGUnLCBsYWJlbDogJ0VETElaIHN1bW1hcnkgdGFibGUgKE1XSSknIH0sXG4gICAgeyB2YWx1ZTogJ2RpYWdub3NpcycsIGxhYmVsOiAnRGlhZ25vc2lzJyB9LFxuXSBhcyB7IGxhYmVsOiBzdHJpbmc7IHZhbHVlOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIGdldFNjcmVlbldpdGhEcmFmdD4+Wyd0eXBlJ107IH1bXTtcblxuZXhwb3J0IGNvbnN0IFN5bXB0b21UeXBlcyA9IFtcbiAgICB7IHZhbHVlOiAncmlzaycsIGxhYmVsOiAnUmlzayBmYWN0b3InLCB9LFxuICAgIHsgdmFsdWU6ICdzaWduJywgbGFiZWw6ICdTaWduL1N5bXB0b20nLCB9LFxuXTtcbiJdLCJuYW1lcyI6WyJkZWZhdWx0UHJlZmVyZW5jZXMiLCJmb250U2l6ZSIsImZvbnRXZWlnaHQiLCJmb250U3R5bGUiLCJ0ZXh0Q29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoaWdobGlnaHQiLCJzY3JpcHRzUGFnZVRhYnMiLCJ2YWx1ZSIsImxhYmVsIiwic2NyaXB0VHlwZXMiLCJzY3JlZW5UeXBlcyIsIlN5bXB0b21UeXBlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./constants/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_config-keys-drafts.ts":
/*!****************************************************!*\
  !*** ./databases/mutations/_config-keys-drafts.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _createConfigKeysDrafts: () => (/* binding */ _createConfigKeysDrafts),\n/* harmony export */   _deleteAllConfigKeysDrafts: () => (/* binding */ _deleteAllConfigKeysDrafts),\n/* harmony export */   _deleteConfigKeysDrafts: () => (/* binding */ _deleteConfigKeysDrafts),\n/* harmony export */   _updateConfigKeysDrafts: () => (/* binding */ _updateConfigKeysDrafts)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_config_keys_drafts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../queries/_config-keys-drafts */ \"(rsc)/./databases/queries/_config-keys-drafts.ts\");\n/* harmony import */ var _queries_config_keys__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/_config-keys */ \"(rsc)/./databases/queries/_config-keys.ts\");\n\n\n\n\n\n\n\nasync function _deleteConfigKeysDrafts(configKeysDraftsIds, opts) {\n    if (configKeysDraftsIds.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, configKeysDraftsIds));\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_screens_drafts\");\n    }\n    return true;\n}\nasync function _deleteAllConfigKeysDrafts(opts) {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts);\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_screens_drafts\");\n    return res;\n}\nasync function _createConfigKeysDrafts(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const configKeysList = await (0,_queries_config_keys__WEBPACK_IMPORTED_MODULE_4__._listConfigKeys)();\n        const lastPosition = configKeysList.data.length ? Math.max(...configKeysList.data.map((s)=>s.position)) : 0;\n        let position = lastPosition + 1;\n        const insertData = [];\n        for (const c of data){\n            const configKeyDraftId = c.configKeyId;\n            const existing = !configKeyDraftId ? null : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, configKeyDraftId)\n            });\n            if (!existing) {\n                insertData.push({\n                    ...c,\n                    data: {\n                        ...c.data,\n                        position: c.configKeyId ? c.data.position : position\n                    },\n                    configKeyDraftId: configKeyDraftId || (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])()\n                });\n                if (!c.configKeyId) position++;\n            }\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts).values(insertData);\n        if (opts?.returnInserted) {\n            const inserted = await (0,_queries_config_keys_drafts__WEBPACK_IMPORTED_MODULE_3__._getConfigKeysDrafts)({\n                configKeyDraftIds: insertData.map((u)=>u.configKeyDraftId)\n            });\n            results.inserted = inserted.data;\n        }\n        results.success = true;\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n    } catch (e) {\n        results.error = e.message;\n    } finally{\n        return results;\n    }\n}\nasync function _updateConfigKeysDrafts(data, opts) {\n    const results = [];\n    for (const { configKeyDraftId, data: draft } of data){\n        try {\n            const existing = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, configKeyDraftId)\n            });\n            const draftData = {\n                ...existing?.data,\n                ...draft\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts).set({\n                data: draftData\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, configKeyDraftId));\n            const configKeyDraft = !opts?.returnUpdated ? undefined : await (0,_queries_config_keys_drafts__WEBPACK_IMPORTED_MODULE_3__._getConfigKeyDraft)(configKeyDraftId);\n            results.push({\n                configKeyDraftId,\n                configKeyDraft\n            });\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n        } catch (e) {\n            results.push({\n                configKeyDraftId,\n                error: e.message\n            });\n        }\n    }\n    return results;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19jb25maWcta2V5cy1kcmFmdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBMEM7QUFDaEI7QUFFUztBQUNKO0FBQ2lCO0FBQ2tFO0FBQ3hEO0FBRW5ELGVBQWVTLHdCQUNsQkMsbUJBQTZCLEVBQzdCQyxJQUVDO0lBRUQsSUFBSUQsb0JBQW9CRSxNQUFNLEVBQUU7UUFDNUIsTUFBTVIsbURBQUVBLENBQUNTLE1BQU0sQ0FBQ1Isd0RBQWdCQSxFQUFFUyxLQUFLLENBQUNiLG9EQUFPQSxDQUFDSSx3REFBZ0JBLENBQUNVLGdCQUFnQixFQUFFTDtRQUNuRixJQUFJQyxNQUFNSyxpQkFBaUJiLG1EQUFNQSxDQUFDYyxJQUFJLENBQUMsZ0JBQWdCO0lBQzNEO0lBQ0EsT0FBTztBQUNYO0FBRU8sZUFBZUMsMkJBQ2xCUCxJQUVDO0lBRUQsTUFBTVEsTUFBTSxNQUFNZixtREFBRUEsQ0FBQ1MsTUFBTSxDQUFDUix3REFBZ0JBO0lBQzVDLElBQUlNLE1BQU1LLGlCQUFpQmIsbURBQU1BLENBQUNjLElBQUksQ0FBQyxnQkFBZ0I7SUFDdkQsT0FBT0U7QUFDWDtBQUVPLGVBQWVDLHdCQUNsQkMsSUFHSSxFQUNKVixJQUdDO0lBRUQsSUFBSVcsVUFJQTtRQUFFQyxVQUFVLEVBQUU7UUFBRUMsU0FBUztJQUFPO0lBRXBDLElBQUk7UUFDQSxNQUFNQyxpQkFBaUIsTUFBTWpCLHFFQUFlQTtRQUM1QyxNQUFNa0IsZUFBZUQsZUFBZUosSUFBSSxDQUFDVCxNQUFNLEdBQUdlLEtBQUtDLEdBQUcsSUFBSUgsZUFBZUosSUFBSSxDQUFDUSxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUVDLFFBQVEsS0FBSztRQUMxRyxJQUFJQSxXQUFXTCxlQUFlO1FBRTlCLE1BQU1NLGFBQXFELEVBQUU7UUFFN0QsS0FBSSxNQUFNQyxLQUFLWixLQUFNO1lBQ2pCLE1BQU1OLG1CQUFtQmtCLEVBQUVDLFdBQVc7WUFDdEMsTUFBTUMsV0FBVyxDQUFDcEIsbUJBQW1CLE9BQU8sTUFBTVgsbURBQUVBLENBQUNnQyxLQUFLLENBQUMvQixnQkFBZ0IsQ0FBQ2dDLFNBQVMsQ0FBQztnQkFDbEZ2QixPQUFPZCwrQ0FBRUEsQ0FBQ0ssd0RBQWdCQSxDQUFDVSxnQkFBZ0IsRUFBRUE7WUFDakQ7WUFFQSxJQUFJLENBQUNvQixVQUFVO2dCQUNYSCxXQUFXTSxJQUFJLENBQUM7b0JBQ1osR0FBR0wsQ0FBQztvQkFDSlosTUFBTTt3QkFDRixHQUFHWSxFQUFFWixJQUFJO3dCQUNUVSxVQUFVRSxFQUFFQyxXQUFXLEdBQUdELEVBQUVaLElBQUksQ0FBQ1UsUUFBUSxHQUFHQTtvQkFDaEQ7b0JBQ0FoQixrQkFBa0JBLG9CQUFvQmIsZ0RBQUVBO2dCQUM1QztnQkFDQSxJQUFJLENBQUMrQixFQUFFQyxXQUFXLEVBQUVIO1lBQ3hCO1FBQ0o7UUFFQSxJQUFJQyxXQUFXcEIsTUFBTSxFQUFFLE1BQU1SLG1EQUFFQSxDQUFDbUMsTUFBTSxDQUFDbEMsd0RBQWdCQSxFQUFFbUMsTUFBTSxDQUFDUjtRQUVoRSxJQUFJckIsTUFBTThCLGdCQUFnQjtZQUN0QixNQUFNbEIsV0FBVyxNQUFNaEIsaUZBQW9CQSxDQUFDO2dCQUFFbUMsbUJBQW1CVixXQUFXSCxHQUFHLENBQUNjLENBQUFBLElBQUtBLEVBQUU1QixnQkFBZ0I7WUFBSTtZQUMzR08sUUFBUUMsUUFBUSxHQUFHQSxTQUFTRixJQUFJO1FBQ3BDO1FBQ0FDLFFBQVFFLE9BQU8sR0FBRztRQUNsQixJQUFJYixNQUFNSyxpQkFBaUJiLG1EQUFNQSxDQUFDYyxJQUFJLENBQUMsZ0JBQWdCO0lBQzNELEVBQUUsT0FBTTJCLEdBQVE7UUFDWnRCLFFBQVF1QixLQUFLLEdBQUdELEVBQUVFLE9BQU87SUFDN0IsU0FBVTtRQUNOLE9BQU94QjtJQUNYO0FBQ0o7QUFFTyxlQUFleUIsd0JBQ2xCMUIsSUFHSSxFQUNKVixJQUdDO0lBRUQsTUFBTVcsVUFJQyxFQUFFO0lBRVQsS0FBSSxNQUFNLEVBQUVQLGdCQUFnQixFQUFFTSxNQUFNMkIsS0FBSyxFQUFJLElBQUkzQixLQUFNO1FBQ25ELElBQUk7WUFDQSxNQUFNYyxXQUFXLE1BQU0vQixtREFBRUEsQ0FBQ2dDLEtBQUssQ0FBQy9CLGdCQUFnQixDQUFDZ0MsU0FBUyxDQUFDO2dCQUN2RHZCLE9BQU9kLCtDQUFFQSxDQUFDSyx3REFBZ0JBLENBQUNVLGdCQUFnQixFQUFFQTtZQUNqRDtZQUNBLE1BQU1rQyxZQUFZO2dCQUFFLEdBQUdkLFVBQVVkLElBQUk7Z0JBQUUsR0FBRzJCLEtBQUs7WUFBRTtZQUNqRCxNQUFNNUMsbURBQUVBLENBQUM4QyxNQUFNLENBQUM3Qyx3REFBZ0JBLEVBQUU4QyxHQUFHLENBQUM7Z0JBQUU5QixNQUFNNEI7WUFBVyxHQUFHbkMsS0FBSyxDQUFDZCwrQ0FBRUEsQ0FBQ0ssd0RBQWdCQSxDQUFDVSxnQkFBZ0IsRUFBRUE7WUFDeEcsTUFBTXFDLGlCQUFpQixDQUFDekMsTUFBTTBDLGdCQUFnQkMsWUFBWSxNQUFNaEQsK0VBQWtCQSxDQUFDUztZQUNuRk8sUUFBUWdCLElBQUksQ0FBQztnQkFBRXZCO2dCQUFrQnFDO1lBQWdCO1lBQ2pELElBQUl6QyxNQUFNSyxpQkFBaUJiLG1EQUFNQSxDQUFDYyxJQUFJLENBQUMsZ0JBQWdCO1FBQzNELEVBQUUsT0FBTTJCLEdBQVE7WUFDWnRCLFFBQVFnQixJQUFJLENBQUM7Z0JBQUV2QjtnQkFBa0I4QixPQUFPRCxFQUFFRSxPQUFPO1lBQUU7UUFDdkQ7SUFDSjtJQUVBLE9BQU94QjtBQUNYIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19jb25maWcta2V5cy1kcmFmdHMudHM/YmRjMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcSwgaW5BcnJheSB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0IHsgdjQgfSBmcm9tIFwidXVpZFwiO1xuXG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBjb25maWdLZXlzRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgX2NvdW50Q29uZmlnS2V5c0RyYWZ0cywgX2dldENvbmZpZ0tleURyYWZ0LCBfZ2V0Q29uZmlnS2V5c0RyYWZ0cyB9IGZyb20gJy4uL3F1ZXJpZXMvX2NvbmZpZy1rZXlzLWRyYWZ0cyc7XG5pbXBvcnQgeyBfbGlzdENvbmZpZ0tleXMgfSBmcm9tIFwiLi4vcXVlcmllcy9fY29uZmlnLWtleXNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVDb25maWdLZXlzRHJhZnRzKFxuICAgIGNvbmZpZ0tleXNEcmFmdHNJZHM6IHN0cmluZ1tdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgaWYgKGNvbmZpZ0tleXNEcmFmdHNJZHMubGVuZ3RoKSB7XG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZShjb25maWdLZXlzRHJhZnRzKS53aGVyZShpbkFycmF5KGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5RHJhZnRJZCwgY29uZmlnS2V5c0RyYWZ0c0lkcykpO1xuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9zY3JlZW5zX2RyYWZ0cycpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVBbGxDb25maWdLZXlzRHJhZnRzKFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZGIuZGVsZXRlKGNvbmZpZ0tleXNEcmFmdHMpO1xuICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnZGVsZXRlX3NjcmVlbnNfZHJhZnRzJyk7XG4gICAgcmV0dXJuIHJlcztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9jcmVhdGVDb25maWdLZXlzRHJhZnRzKFxuICAgIGRhdGE6ICh0eXBlb2YgY29uZmlnS2V5c0RyYWZ0cy4kaW5mZXJJbnNlcnQgJiB7XG4gICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ6IHN0cmluZztcbiAgICAgICAgZGF0YTogRXhjbHVkZTwodHlwZW9mIGNvbmZpZ0tleXNEcmFmdHMuJGluZmVySW5zZXJ0KVsnZGF0YSddLCAndmVyc2lvbic+O1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVybkluc2VydGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9LFxuKSB7XG4gICAgbGV0IHJlc3VsdHM6IHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7XG4gICAgICAgIGluc2VydGVkOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXRDb25maWdLZXlzRHJhZnRzPj5bJ2RhdGEnXTtcbiAgICB9ID0geyBpbnNlcnRlZDogW10sIHN1Y2Nlc3M6IGZhbHNlLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29uZmlnS2V5c0xpc3QgPSBhd2FpdCBfbGlzdENvbmZpZ0tleXMoKTtcbiAgICAgICAgY29uc3QgbGFzdFBvc2l0aW9uID0gY29uZmlnS2V5c0xpc3QuZGF0YS5sZW5ndGggPyBNYXRoLm1heCguLi5jb25maWdLZXlzTGlzdC5kYXRhLm1hcChzID0+IHMucG9zaXRpb24pKSA6IDA7XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IGxhc3RQb3NpdGlvbiArIDE7XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIGNvbmZpZ0tleXNEcmFmdHMuJGluZmVySW5zZXJ0W10gPSBbXTtcblxuICAgICAgICBmb3IoY29uc3QgYyBvZiBkYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdLZXlEcmFmdElkID0gYy5jb25maWdLZXlJZDtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gIWNvbmZpZ0tleURyYWZ0SWQgPyBudWxsIDogYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBlcShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleURyYWZ0SWQpLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAuLi5jLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5jLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYy5jb25maWdLZXlJZCA/IGMuZGF0YS5wb3NpdGlvbiA6IHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjb25maWdLZXlEcmFmdElkOiBjb25maWdLZXlEcmFmdElkIHx8IHY0KCksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjLmNvbmZpZ0tleUlkKSBwb3NpdGlvbisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydERhdGEubGVuZ3RoKSBhd2FpdCBkYi5pbnNlcnQoY29uZmlnS2V5c0RyYWZ0cykudmFsdWVzKGluc2VydERhdGEpO1xuICAgICAgICBcbiAgICAgICAgaWYgKG9wdHM/LnJldHVybkluc2VydGVkKSB7XG4gICAgICAgICAgICBjb25zdCBpbnNlcnRlZCA9IGF3YWl0IF9nZXRDb25maWdLZXlzRHJhZnRzKHsgY29uZmlnS2V5RHJhZnRJZHM6IGluc2VydERhdGEubWFwKHUgPT4gdS5jb25maWdLZXlEcmFmdElkISksIH0pO1xuICAgICAgICAgICAgcmVzdWx0cy5pbnNlcnRlZCA9IGluc2VydGVkLmRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdjcmVhdGVfc2NyZWVuc19kcmFmdHMnKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF91cGRhdGVDb25maWdLZXlzRHJhZnRzKFxuICAgIGRhdGE6ICh7XG4gICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ6IHN0cmluZztcbiAgICAgICAgZGF0YTogUGFydGlhbDx0eXBlb2YgY29uZmlnS2V5c0RyYWZ0cy4kaW5mZXJTZWxlY3Q+WydkYXRhJ107XG4gICAgfSlbXSwgXG4gICAgb3B0cz86IHtcbiAgICAgICAgcmV0dXJuVXBkYXRlZD86IGJvb2xlYW47XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzdWx0czogKHsgXG4gICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ6IHN0cmluZztcbiAgICAgICAgY29uZmlnS2V5RHJhZnQ/OiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXRDb25maWdLZXlEcmFmdD4+O1xuICAgICAgICBlcnJvcj86IHN0cmluZzsgXG4gICAgfSlbXSA9IFtdO1xuXG4gICAgZm9yKGNvbnN0IHsgY29uZmlnS2V5RHJhZnRJZCwgZGF0YTogZHJhZnQsICB9IG9mIGRhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBlcShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleURyYWZ0SWQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBkcmFmdERhdGEgPSB7IC4uLmV4aXN0aW5nPy5kYXRhLCAuLi5kcmFmdCwgfSBhcyB0eXBlb2YgZHJhZnQ7XG4gICAgICAgICAgICBhd2FpdCBkYi51cGRhdGUoY29uZmlnS2V5c0RyYWZ0cykuc2V0KHsgZGF0YTogZHJhZnREYXRhLCB9KS53aGVyZShlcShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleURyYWZ0SWQpKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ0tleURyYWZ0ID0gIW9wdHM/LnJldHVyblVwZGF0ZWQgPyB1bmRlZmluZWQgOiBhd2FpdCBfZ2V0Q29uZmlnS2V5RHJhZnQoY29uZmlnS2V5RHJhZnRJZCk7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBjb25maWdLZXlEcmFmdElkLCBjb25maWdLZXlEcmFmdCwgfSk7XG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JlZW5zX2RyYWZ0cycpO1xuICAgICAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgY29uZmlnS2V5RHJhZnRJZCwgZXJyb3I6IGUubWVzc2FnZSwgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cbiJdLCJuYW1lcyI6WyJlcSIsImluQXJyYXkiLCJ2NCIsInNvY2tldCIsImRiIiwiY29uZmlnS2V5c0RyYWZ0cyIsIl9nZXRDb25maWdLZXlEcmFmdCIsIl9nZXRDb25maWdLZXlzRHJhZnRzIiwiX2xpc3RDb25maWdLZXlzIiwiX2RlbGV0ZUNvbmZpZ0tleXNEcmFmdHMiLCJjb25maWdLZXlzRHJhZnRzSWRzIiwib3B0cyIsImxlbmd0aCIsImRlbGV0ZSIsIndoZXJlIiwiY29uZmlnS2V5RHJhZnRJZCIsImJyb2FkY2FzdEFjdGlvbiIsImVtaXQiLCJfZGVsZXRlQWxsQ29uZmlnS2V5c0RyYWZ0cyIsInJlcyIsIl9jcmVhdGVDb25maWdLZXlzRHJhZnRzIiwiZGF0YSIsInJlc3VsdHMiLCJpbnNlcnRlZCIsInN1Y2Nlc3MiLCJjb25maWdLZXlzTGlzdCIsImxhc3RQb3NpdGlvbiIsIk1hdGgiLCJtYXgiLCJtYXAiLCJzIiwicG9zaXRpb24iLCJpbnNlcnREYXRhIiwiYyIsImNvbmZpZ0tleUlkIiwiZXhpc3RpbmciLCJxdWVyeSIsImZpbmRGaXJzdCIsInB1c2giLCJpbnNlcnQiLCJ2YWx1ZXMiLCJyZXR1cm5JbnNlcnRlZCIsImNvbmZpZ0tleURyYWZ0SWRzIiwidSIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfdXBkYXRlQ29uZmlnS2V5c0RyYWZ0cyIsImRyYWZ0IiwiZHJhZnREYXRhIiwidXBkYXRlIiwic2V0IiwiY29uZmlnS2V5RHJhZnQiLCJyZXR1cm5VcGRhdGVkIiwidW5kZWZpbmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_config-keys-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_config-keys.ts":
/*!*********************************************!*\
  !*** ./databases/mutations/_config-keys.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _createConfigKeys: () => (/* binding */ _createConfigKeys),\n/* harmony export */   _deleteConfigKeys: () => (/* binding */ _deleteConfigKeys),\n/* harmony export */   _publishConfigKeys: () => (/* binding */ _publishConfigKeys),\n/* harmony export */   _saveConfigKeysHistory: () => (/* binding */ _saveConfigKeysHistory),\n/* harmony export */   _updateConfigKeys: () => (/* binding */ _updateConfigKeys),\n/* harmony export */   _updateConfigKeysWithoutPublishing: () => (/* binding */ _updateConfigKeysWithoutPublishing)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_config_keys__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/_config-keys */ \"(rsc)/./databases/queries/_config-keys.ts\");\n\n\n\n\n\n\n\nasync function _updateConfigKeysWithoutPublishing(payload, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const configKeysReferences = payload.map((s)=>s.configKeyId).filter((s)=>s);\n        const whereConfigKey = !configKeysReferences.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyId, configKeysReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyDraftId, configKeysReferences));\n        if (whereConfigKey) {\n            const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeysDrafts.findMany({\n                where: whereConfigKey\n            });\n            let publishedConfigKeys = [];\n            if (configKeysReferences.length) {\n                publishedConfigKeys = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeys.findMany({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...[\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.deletedAt),\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, configKeysReferences),\n                        ...drafts.filter((s)=>s.configKeyId).length ? [\n                            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, drafts.map((s)=>s.configKeyId))\n                        ] : []\n                    ]),\n                    orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.asc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.position)\n                });\n            }\n            const newDrafts = [];\n            let updatedDrafts = 0;\n            for (const { configKeyId, data } of payload){\n                const draft = drafts.filter((s)=>s.data.configKeyId === configKeyId)[0];\n                const publishedConfigKey = publishedConfigKeys.filter((s)=>s.configKeyId === configKeyId)[0];\n                if (draft) {\n                    await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts).set({\n                        data: {\n                            ...draft.data,\n                            ...data\n                        }\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.id, draft.id));\n                    updatedDrafts++;\n                } else if (publishedConfigKey) {\n                    newDrafts.push({\n                        position: data.position,\n                        configKeyId: publishedConfigKey.configKeyId,\n                        configKeyDraftId: publishedConfigKey.configKeyId,\n                        data: {\n                            ...publishedConfigKey,\n                            ...data,\n                            version: data.version || publishedConfigKey.version + 1\n                        }\n                    });\n                }\n            }\n            if (newDrafts.length) {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts).values(newDrafts);\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_configKeys_drafts\");\n            }\n            if (opts?.broadcastAction && updatedDrafts) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_configKeys_drafts\");\n            }\n        }\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_orderConfigKeys ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _publishConfigKeys(opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeysDrafts.findMany({\n            columns: {\n                configKeyDraftId: true,\n                configKeyId: true\n            }\n        });\n        const insertData = drafts.filter((c)=>!c.configKeyId);\n        const updateData = drafts.filter((c)=>c.configKeyId).map((c)=>({\n                ...c,\n                configKeyId: c.configKeyId\n            }));\n        const errors = [];\n        if (insertData.length) {\n            const { error } = await _createConfigKeys(insertData);\n            if (error) errors.push(error);\n        }\n        if (updateData.length) {\n            const res = await _updateConfigKeys(updateData);\n            res.forEach((c)=>c.error && errors.push(c.error));\n        }\n        if (errors.length) {\n            results.success = false;\n            results.errors = errors;\n        }\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_publishConfigKeys ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _deleteConfigKeys(configKeyIds, opts) {\n    if (configKeyIds.length) {\n        const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, configKeyIds);\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeys.findMany({\n            where\n        });\n        if (items.length) {\n            const deletedAt = new Date();\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys).set({\n                deletedAt\n            }).where(where);\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyId, configKeyIds)));\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysHistory).values(items.map((item)=>({\n                    version: item.version,\n                    configKeyId: item.configKeyId,\n                    changes: {\n                        action: \"delete_config_key\",\n                        description: \"Delete config key\",\n                        oldValues: [\n                            {\n                                deletedAt: null\n                            }\n                        ],\n                        newValues: [\n                            {\n                                deletedAt\n                            }\n                        ]\n                    }\n                })));\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_config_keys\");\n        }\n    }\n    return true;\n}\nasync function _createConfigKeys(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const insertData = [];\n        let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeysDrafts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyDraftId, data.map((c)=>c.configKeyDraftId))\n        });\n        // we'll use data before to compare changes\n        let dataBefore = [];\n        if (drafts.filter((c)=>c.configKeyId).length) {\n            dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeys.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, drafts.filter((c)=>c.configKeyId).map((c)=>c.configKeyId))\n            });\n        }\n        for (const { id, data } of drafts){\n            const configKeyId = data.configKeyId || (0,uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"])();\n            insertData.push({\n                ...data,\n                configKeyId\n            });\n            drafts = drafts.map((d)=>{\n                if (d.id === id) d.data.configKeyId = configKeyId;\n                return d;\n            });\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys).values(insertData);\n        const inserted = await (0,_queries_config_keys__WEBPACK_IMPORTED_MODULE_4__._getConfigKeys)({\n            configKeyIds: insertData.map((c)=>c.configKeyId)\n        });\n        results.inserted = opts?.returnInserted ? inserted.data : [];\n        results.success = true;\n        await _saveConfigKeysHistory({\n            drafts: drafts,\n            previous: dataBefore\n        });\n        if (drafts.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.id, drafts.map((d)=>d.id)));\n        }\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_config_keys\");\n    } catch (e) {\n        results.error = e.message;\n    } finally{\n        return results;\n    }\n}\nasync function _updateConfigKeys(data, opts) {\n    const results = [];\n    let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeysDrafts.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.configKeyId, data.map((c)=>c.configKeyId))\n    });\n    // we'll use data before to compare changes\n    let dataBefore = [];\n    if (drafts.filter((c)=>c.configKeyId).length) {\n        dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.configKeys.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, drafts.filter((c)=>c.configKeyId).map((c)=>c.configKeyId))\n        });\n    }\n    for (const { configKeyId: _configKeyId, data: c } of drafts){\n        const configKeyId = _configKeyId;\n        const { configKeyId: __configKeyId, oldConfigKeyId, id, createdAt, updatedAt, deletedAt, ...payload } = c;\n        try {\n            const updates = {\n                ...payload,\n                publishDate: new Date()\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys).set(updates).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeys.configKeyId, configKeyId));\n            const configKey = !opts?.returnUpdated ? undefined : await (0,_queries_config_keys__WEBPACK_IMPORTED_MODULE_4__._getConfigKey)(configKeyId);\n            results.push({\n                configKeyId,\n                configKey\n            });\n        } catch (e) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(`_updateConfigKeys configKeyId=${configKeyId}`, e.message);\n            results.push({\n                configKeyId,\n                error: e.message\n            });\n            drafts = drafts.filter((c)=>c.data.configKeyId !== configKeyId);\n        }\n    }\n    await _saveConfigKeysHistory({\n        drafts: drafts,\n        previous: dataBefore\n    });\n    if (drafts.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysDrafts.id, drafts.map((d)=>d.id)));\n    }\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_config_keys\");\n    return results;\n}\nasync function _saveConfigKeysHistory({ previous, drafts }) {\n    try {\n        const insertData = [];\n        for (const c of drafts){\n            const changeHistoryData = {\n                version: c?.data?.version || 1,\n                configKeyId: c?.data?.configKeyId,\n                changes: {}\n            };\n            if (c?.data?.version === 1) {\n                changeHistoryData.changes = {\n                    action: \"create_config_key\",\n                    description: \"Create config key\",\n                    oldValues: [],\n                    newValues: []\n                };\n            } else {\n                const prev = previous.filter((prevC)=>prevC.configKeyId === c?.data?.configKeyId)[0];\n                const oldValues = [];\n                const newValues = [];\n                Object.keys({\n                    ...c?.data\n                }).filter((key)=>![\n                        \"version\",\n                        \"draft\"\n                    ].includes(key)).forEach((_key)=>{\n                    const key = _key;\n                    const newValue = c.data[key];\n                    const oldValue = {\n                        ...prev\n                    }[key];\n                    if (JSON.stringify(newValue) !== JSON.stringify(oldValue)) {\n                        oldValues.push({\n                            [key]: oldValue\n                        });\n                        newValues.push({\n                            [key]: newValue\n                        });\n                    }\n                });\n                changeHistoryData.changes = {\n                    action: \"update_config_key\",\n                    description: \"Update config key\",\n                    oldValues,\n                    newValues\n                };\n            }\n            insertData.push(changeHistoryData);\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.configKeysHistory).values(insertData);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(e.message);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19jb25maWcta2V5cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUF1RjtBQUM3RDtBQUVTO0FBQ0Q7QUFDSDtBQUNnRDtBQUNQO0FBRWpFLGVBQWVpQixtQ0FDbEJDLE9BR0csRUFDSEMsSUFFQztJQUVELE1BQU1DLFVBQTZEO1FBQUVDLFNBQVM7SUFBSztJQUVuRixJQUFJO1FBQ0EsTUFBTUMsdUJBQXVCSixRQUFRSyxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUVDLFdBQVcsRUFBRUMsTUFBTSxDQUFDRixDQUFBQSxJQUFLQTtRQUV6RSxNQUFNRyxpQkFBaUIsQ0FBQ0wscUJBQXFCTSxNQUFNLEdBQUdDLFlBQVl0QiwrQ0FBRUEsQ0FDaEVMLG9EQUFPQSxDQUFDVyx3REFBZ0JBLENBQUNZLFdBQVcsRUFBRUgsdUJBQ3RDcEIsb0RBQU9BLENBQUNXLHdEQUFnQkEsQ0FBQ2lCLGdCQUFnQixFQUFFUjtRQUcvQyxJQUFJSyxnQkFBZ0I7WUFDaEIsTUFBTUksU0FBUyxNQUFNcEIsbURBQUVBLENBQUNxQixLQUFLLENBQUNuQixnQkFBZ0IsQ0FBQ29CLFFBQVEsQ0FBQztnQkFDcERDLE9BQU9QO1lBQ1g7WUFFQSxJQUFJUSxzQkFBd0QsRUFBRTtZQUM5RCxJQUFJYixxQkFBcUJNLE1BQU0sRUFBRTtnQkFDN0JPLHNCQUFzQixNQUFNeEIsbURBQUVBLENBQUNxQixLQUFLLENBQUNwQixVQUFVLENBQUNxQixRQUFRLENBQUM7b0JBQ3JEQyxPQUFPbEMsZ0RBQUdBLElBQUk7d0JBQ1ZJLG1EQUFNQSxDQUFDUSxrREFBVUEsQ0FBQ3dCLFNBQVM7d0JBQzNCbEMsb0RBQU9BLENBQUNVLGtEQUFVQSxDQUFDYSxXQUFXLEVBQUVIOzJCQUM1QlMsT0FBT0wsTUFBTSxDQUFDRixDQUFBQSxJQUFLQSxFQUFFQyxXQUFXLEVBQUVHLE1BQU0sR0FBRzs0QkFBQ3ZCLHVEQUFVQSxDQUFDTyxrREFBVUEsQ0FBQ2Es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QUM7NEJBQUUsQ0FBQ2tELElBQUksRUFBRUk7d0JBQVU7d0JBQ2xDekIsVUFBVTdCLElBQUksQ0FBQzs0QkFBRSxDQUFDa0QsSUFBSSxFQUFFRzt3QkFBVTtvQkFDdEM7Z0JBQ0o7Z0JBRUpSLGtCQUFrQnBCLE9BQU8sR0FBRztvQkFDeEJDLFFBQVE7b0JBQ1JDLGFBQWE7b0JBQ2JDO29CQUNBQztnQkFDSjtZQUNKO1lBRUFsQixXQUFXWCxJQUFJLENBQUM2QztRQUNwQjtRQUVBLE1BQU1qRixtREFBRUEsQ0FBQ3NDLE1BQU0sQ0FBQ25DLHlEQUFpQkEsRUFBRW9DLE1BQU0sQ0FBQ1E7SUFDOUMsRUFBRSxPQUFNTCxHQUFRO1FBQ1ozQyxtREFBTUEsQ0FBQzRDLEtBQUssQ0FBQ0QsRUFBRUUsT0FBTztJQUMxQjtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19jb25maWcta2V5cy50cz9lMThmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuZCwgZXEsIGluQXJyYXksIGlzTm90TnVsbCwgaXNOdWxsLCBub3RJbkFycmF5LCBhc2MsIG9yIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyB2NCB9IGZyb20gXCJ1dWlkXCI7XG5cbmltcG9ydCBzb2NrZXQgIGZyb20gJ0AvbGliL3NvY2tldCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgY29uZmlnS2V5cywgY29uZmlnS2V5c0RyYWZ0cywgY29uZmlnS2V5c0hpc3RvcnkgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgeyBfZ2V0Q29uZmlnS2V5LCBfZ2V0Q29uZmlnS2V5cyB9IGZyb20gJy4uL3F1ZXJpZXMvX2NvbmZpZy1rZXlzJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF91cGRhdGVDb25maWdLZXlzV2l0aG91dFB1Ymxpc2hpbmcoXG4gICAgcGF5bG9hZDogeyBcbiAgICAgICAgY29uZmlnS2V5SWQ6IHN0cmluZztcbiAgICAgICAgZGF0YTogUGFydGlhbDx0eXBlb2YgY29uZmlnS2V5c0RyYWZ0cy4kaW5mZXJJbnNlcnRbJ2RhdGEnXT47ICBcbiAgICB9W10sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9LFxuKSB7XG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZzsgZGF0YT86IGFueTsgfSA9IHsgc3VjY2VzczogdHJ1ZSB9OyBcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0tleXNSZWZlcmVuY2VzID0gcGF5bG9hZC5tYXAocyA9PiBzLmNvbmZpZ0tleUlkKS5maWx0ZXIocyA9PiBzKTtcblxuICAgICAgICBjb25zdCB3aGVyZUNvbmZpZ0tleSA9ICFjb25maWdLZXlzUmVmZXJlbmNlcy5sZW5ndGggPyB1bmRlZmluZWQgOiBvcihcbiAgICAgICAgICAgIGluQXJyYXkoY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlJZCwgY29uZmlnS2V5c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleXNSZWZlcmVuY2VzKSxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAod2hlcmVDb25maWdLZXkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB3aGVyZUNvbmZpZ0tleSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgcHVibGlzaGVkQ29uZmlnS2V5czogdHlwZW9mIGNvbmZpZ0tleXMuJGluZmVyU2VsZWN0W10gPSBbXTtcbiAgICAgICAgICAgIGlmIChjb25maWdLZXlzUmVmZXJlbmNlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBwdWJsaXNoZWRDb25maWdLZXlzID0gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5cy5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiBhbmQoLi4uW1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNOdWxsKGNvbmZpZ0tleXMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluQXJyYXkoY29uZmlnS2V5cy5jb25maWdLZXlJZCwgY29uZmlnS2V5c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uKGRyYWZ0cy5maWx0ZXIocyA9PiBzLmNvbmZpZ0tleUlkKS5sZW5ndGggPyBbbm90SW5BcnJheShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBkcmFmdHMubWFwKHMgPT4gcy5jb25maWdLZXlJZCEpKV0gOiBbXSksXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiBhc2MoY29uZmlnS2V5cy5wb3NpdGlvbiksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld0RyYWZ0czogdHlwZW9mIGNvbmZpZ0tleXNEcmFmdHMuJGluZmVySW5zZXJ0W10gPSBbXTtcbiAgICAgICAgICAgIGxldCB1cGRhdGVkRHJhZnRzID0gMDtcblxuICAgICAgICAgICAgZm9yIChjb25zdCB7IGNvbmZpZ0tleUlkLCBkYXRhIH0gb2YgcGF5bG9hZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRyYWZ0ID0gZHJhZnRzLmZpbHRlcihzID0+IHMuZGF0YS5jb25maWdLZXlJZCA9PT0gY29uZmlnS2V5SWQpWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHB1Ymxpc2hlZENvbmZpZ0tleSA9IHB1Ymxpc2hlZENvbmZpZ0tleXMuZmlsdGVyKHMgPT4gcy5jb25maWdLZXlJZCA9PT0gY29uZmlnS2V5SWQpWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRyYWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShjb25maWdLZXlzRHJhZnRzKS5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmRyYWZ0LmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pLndoZXJlKGVxKGNvbmZpZ0tleXNEcmFmdHMuaWQsIGRyYWZ0LmlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWREcmFmdHMrKztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hlZENvbmZpZ0tleSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdEcmFmdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZGF0YS5wb3NpdGlvbiEsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWdLZXlJZDogcHVibGlzaGVkQ29uZmlnS2V5LmNvbmZpZ0tleUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZDogcHVibGlzaGVkQ29uZmlnS2V5LmNvbmZpZ0tleUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnB1Ymxpc2hlZENvbmZpZ0tleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IGRhdGEudmVyc2lvbiB8fCAocHVibGlzaGVkQ29uZmlnS2V5LnZlcnNpb24gKyAxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gYXMgdHlwZW9mIG5ld0RyYWZ0c1swXVsnZGF0YSddLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdEcmFmdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGNvbmZpZ0tleXNEcmFmdHMpLnZhbHVlcyhuZXdEcmFmdHMpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX2NvbmZpZ0tleXNfZHJhZnRzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24gJiYgdXBkYXRlZERyYWZ0cykgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICd1cGRhdGVfY29uZmlnS2V5c19kcmFmdHMnKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19vcmRlckNvbmZpZ0tleXMgRVJST1InLCBlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfcHVibGlzaENvbmZpZ0tleXMoXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiB7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9ycz86IHN0cmluZ1tdOyB9ID0geyBzdWNjZXNzOiB0cnVlLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZHJhZnRzID0gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25maWdLZXlJZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBpbnNlcnREYXRhID0gZHJhZnRzLmZpbHRlcihjID0+ICFjLmNvbmZpZ0tleUlkKTtcbiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmNvbmZpZ0tleUlkKS5tYXAoYyA9PiAoeyAuLi5jLCBjb25maWdLZXlJZDogYy5jb25maWdLZXlJZCEgfSkpO1xuXG4gICAgICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgICBpZiAoaW5zZXJ0RGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IF9jcmVhdGVDb25maWdLZXlzKGluc2VydERhdGEpO1xuICAgICAgICAgICAgaWYgKGVycm9yKSBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXBkYXRlRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IF91cGRhdGVDb25maWdLZXlzKHVwZGF0ZURhdGEpO1xuICAgICAgICAgICAgcmVzLmZvckVhY2goYyA9PiBjLmVycm9yICYmIGVycm9ycy5wdXNoKGMuZXJyb3IpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzID0gZXJyb3JzO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdHMuZXJyb3JzID0gW2UubWVzc2FnZV07XG4gICAgICAgIGxvZ2dlci5lcnJvcignX3B1Ymxpc2hDb25maWdLZXlzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZGVsZXRlQ29uZmlnS2V5cyhcbiAgICBjb25maWdLZXlJZHM6IHN0cmluZ1tdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgaWYgKGNvbmZpZ0tleUlkcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgd2hlcmUgPSBpbkFycmF5KGNvbmZpZ0tleXMuY29uZmlnS2V5SWQsIGNvbmZpZ0tleUlkcyk7XG5cbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBkYi5xdWVyeS5jb25maWdLZXlzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgICAgICAgIC51cGRhdGUoY29uZmlnS2V5cylcbiAgICAgICAgICAgICAgICAuc2V0KHsgZGVsZXRlZEF0LCB9KVxuICAgICAgICAgICAgICAgIC53aGVyZSh3aGVyZSk7XG5cbiAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShjb25maWdLZXlzRHJhZnRzKS53aGVyZShhbmQoXG4gICAgICAgICAgICAgICAgaXNOb3ROdWxsKGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5SWQpLFxuICAgICAgICAgICAgICAgIGluQXJyYXkoY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlJZCwgY29uZmlnS2V5SWRzKSxcbiAgICAgICAgICAgICkpO1xuXG4gICAgICAgICAgICBhd2FpdCBkYi5pbnNlcnQoY29uZmlnS2V5c0hpc3RvcnkpLnZhbHVlcyhpdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgICAgIHZlcnNpb246IGl0ZW0udmVyc2lvbixcbiAgICAgICAgICAgICAgICBjb25maWdLZXlJZDogaXRlbS5jb25maWdLZXlJZCxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZV9jb25maWdfa2V5JyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZWxldGUgY29uZmlnIGtleScsXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlczogW3sgZGVsZXRlZEF0OiBudWxsLCB9XSxcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVzOiBbeyBkZWxldGVkQXQgfV0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pKSk7XG5cbiAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnZGVsZXRlX2NvbmZpZ19rZXlzJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY3JlYXRlQ29uZmlnS2V5cyhcbiAgICBkYXRhOiAoe1xuICAgICAgICBjb25maWdLZXlEcmFmdElkOiBzdHJpbmc7XG4gICAgfSlbXSwgXG4gICAgb3B0cz86IHtcbiAgICAgICAgcmV0dXJuSW5zZXJ0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGxldCByZXN1bHRzOiB7XG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIGVycm9yPzogc3RyaW5nO1xuICAgICAgICBpbnNlcnRlZDogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0Q29uZmlnS2V5cz4+WydkYXRhJ107XG4gICAgfSA9IHsgaW5zZXJ0ZWQ6IFtdLCBzdWNjZXNzOiBmYWxzZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluc2VydERhdGE6IHR5cGVvZiBjb25maWdLZXlzLiRpbmZlckluc2VydFtdID0gW107XG5cbiAgICAgICAgbGV0IGRyYWZ0cyA9ICFkYXRhLmxlbmd0aCA/IFtdIDogYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGRhdGEubWFwKGMgPT4gYy5jb25maWdLZXlEcmFmdElkKSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHdlJ2xsIHVzZSBkYXRhIGJlZm9yZSB0byBjb21wYXJlIGNoYW5nZXNcbiAgICAgICAgbGV0IGRhdGFCZWZvcmU6IHR5cGVvZiBjb25maWdLZXlzLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgICAgIGlmIChkcmFmdHMuZmlsdGVyKGMgPT4gYy5jb25maWdLZXlJZCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBkYXRhQmVmb3JlID0gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5cy5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoY29uZmlnS2V5cy5jb25maWdLZXlJZCwgZHJhZnRzLmZpbHRlcihjID0+IGMuY29uZmlnS2V5SWQpLm1hcChjID0+IGMuY29uZmlnS2V5SWQhKSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmb3IoY29uc3QgeyBpZCwgZGF0YSB9IG9mIGRyYWZ0cykge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnS2V5SWQgPSBkYXRhLmNvbmZpZ0tleUlkIHx8IHY0KCk7XG4gICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goeyAuLi5kYXRhLCBjb25maWdLZXlJZCwgfSk7XG4gICAgICAgICAgICBkcmFmdHMgPSBkcmFmdHMubWFwKGQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChkLmlkID09PSBpZCkgZC5kYXRhLmNvbmZpZ0tleUlkID0gY29uZmlnS2V5SWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IGRiLmluc2VydChjb25maWdLZXlzKS52YWx1ZXMoaW5zZXJ0RGF0YSk7XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0ZWQgPSBhd2FpdCBfZ2V0Q29uZmlnS2V5cyh7IGNvbmZpZ0tleUlkczogaW5zZXJ0RGF0YS5tYXAoYyA9PiBjLmNvbmZpZ0tleUlkISksIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuaW5zZXJ0ZWQgPSBvcHRzPy5yZXR1cm5JbnNlcnRlZCA/IGluc2VydGVkLmRhdGEgOiBbXTtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gdHJ1ZTtcblxuICAgICAgICBhd2FpdCBfc2F2ZUNvbmZpZ0tleXNIaXN0b3J5KHsgZHJhZnRzOiBkcmFmdHMsIHByZXZpb3VzOiBkYXRhQmVmb3JlLCB9KTtcblxuICAgICAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgZGIuZGVsZXRlKGNvbmZpZ0tleXNEcmFmdHMpLndoZXJlKGluQXJyYXkoY29uZmlnS2V5c0RyYWZ0cy5pZCwgZHJhZnRzLm1hcChkID0+IGQuaWQpKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9jb25maWdfa2V5cycpO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX3VwZGF0ZUNvbmZpZ0tleXMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgY29uZmlnS2V5SWQ6IHN0cmluZztcbiAgICB9KVtdLCBcbiAgICBvcHRzPzoge1xuICAgICAgICByZXR1cm5VcGRhdGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiAoeyBcbiAgICAgICAgY29uZmlnS2V5SWQ6IHN0cmluZztcbiAgICAgICAgY29uZmlnS2V5PzogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0Q29uZmlnS2V5Pj47XG4gICAgICAgIGVycm9yPzogc3RyaW5nOyBcbiAgICB9KVtdID0gW107XG5cbiAgICBsZXQgZHJhZnRzID0gIWRhdGEubGVuZ3RoID8gW10gOiBhd2FpdCBkYi5xdWVyeS5jb25maWdLZXlzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IGluQXJyYXkoY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlJZCwgZGF0YS5tYXAoYyA9PiBjLmNvbmZpZ0tleUlkKSksXG4gICAgfSk7XG5cbiAgICAvLyB3ZSdsbCB1c2UgZGF0YSBiZWZvcmUgdG8gY29tcGFyZSBjaGFuZ2VzXG4gICAgbGV0IGRhdGFCZWZvcmU6IHR5cGVvZiBjb25maWdLZXlzLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgaWYgKGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmNvbmZpZ0tleUlkKS5sZW5ndGgpIHtcbiAgICAgICAgZGF0YUJlZm9yZSA9IGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoY29uZmlnS2V5cy5jb25maWdLZXlJZCwgZHJhZnRzLmZpbHRlcihjID0+IGMuY29uZmlnS2V5SWQpLm1hcChjID0+IGMuY29uZmlnS2V5SWQhKSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZm9yKGNvbnN0IHsgY29uZmlnS2V5SWQ6IF9jb25maWdLZXlJZCwgZGF0YTogYyB9IG9mIGRyYWZ0cykge1xuICAgICAgICBjb25zdCBjb25maWdLZXlJZCA9IF9jb25maWdLZXlJZCE7XG5cbiAgICAgICAgY29uc3QgeyBcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkOiBfX2NvbmZpZ0tleUlkLCBcbiAgICAgICAgICAgIG9sZENvbmZpZ0tleUlkLCBcbiAgICAgICAgICAgIGlkLCBcbiAgICAgICAgICAgIGNyZWF0ZWRBdCwgXG4gICAgICAgICAgICB1cGRhdGVkQXQsIFxuICAgICAgICAgICAgZGVsZXRlZEF0LCBcbiAgICAgICAgICAgIC4uLnBheWxvYWQgXG4gICAgICAgIH0gPSBjO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgICAgICAgICAgIC4uLnBheWxvYWQsXG4gICAgICAgICAgICAgICAgcHVibGlzaERhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAudXBkYXRlKGNvbmZpZ0tleXMpXG4gICAgICAgICAgICAgICAgLnNldCh1cGRhdGVzKVxuICAgICAgICAgICAgICAgIC53aGVyZShlcShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBjb25maWdLZXlJZCkpO1xuXG4gICAgICAgICAgICBjb25zdCBjb25maWdLZXkgPSAhb3B0cz8ucmV0dXJuVXBkYXRlZCA/IHVuZGVmaW5lZCA6IGF3YWl0IF9nZXRDb25maWdLZXkoY29uZmlnS2V5SWQpO1xuXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBjb25maWdLZXlJZCwgY29uZmlnS2V5LCB9KTtcbiAgICAgICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgX3VwZGF0ZUNvbmZpZ0tleXMgY29uZmlnS2V5SWQ9JHtjb25maWdLZXlJZH1gLCBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgY29uZmlnS2V5SWQsIGVycm9yOiBlLm1lc3NhZ2UsIH0pO1xuICAgICAgICAgICAgZHJhZnRzID0gZHJhZnRzLmZpbHRlcihjID0+IGMuZGF0YS5jb25maWdLZXlJZCAhPT0gY29uZmlnS2V5SWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgX3NhdmVDb25maWdLZXlzSGlzdG9yeSh7IGRyYWZ0czogZHJhZnRzLCBwcmV2aW91czogZGF0YUJlZm9yZSwgfSk7XG5cbiAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBkYi5kZWxldGUoY29uZmlnS2V5c0RyYWZ0cykud2hlcmUoaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmlkLCBkcmFmdHMubWFwKGQgPT4gZC5pZCkpKTtcbiAgICB9XG5cbiAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ3VwZGF0ZV9jb25maWdfa2V5cycpO1xuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfc2F2ZUNvbmZpZ0tleXNIaXN0b3J5KHsgcHJldmlvdXMsIGRyYWZ0cywgfToge1xuICAgIGRyYWZ0czogdHlwZW9mIGNvbmZpZ0tleXNEcmFmdHMuJGluZmVyU2VsZWN0W107XG4gICAgcHJldmlvdXM6IHR5cGVvZiBjb25maWdLZXlzLiRpbmZlclNlbGVjdFtdO1xufSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluc2VydERhdGE6IHR5cGVvZiBjb25maWdLZXlzSGlzdG9yeS4kaW5mZXJJbnNlcnRbXSA9IFtdO1xuXG4gICAgICAgIGZvcihjb25zdCBjIG9mIGRyYWZ0cykge1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlSGlzdG9yeURhdGE6IHR5cGVvZiBjb25maWdLZXlzSGlzdG9yeS4kaW5mZXJJbnNlcnQgPSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogYz8uZGF0YT8udmVyc2lvbiB8fCAxLFxuICAgICAgICAgICAgICAgIGNvbmZpZ0tleUlkOiBjPy5kYXRhPy5jb25maWdLZXlJZCEsXG4gICAgICAgICAgICAgICAgY2hhbmdlczoge30sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoYz8uZGF0YT8udmVyc2lvbiA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNoYW5nZUhpc3RvcnlEYXRhLmNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2NyZWF0ZV9jb25maWdfa2V5JyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdDcmVhdGUgY29uZmlnIGtleScsXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlczogW10sXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlczogW10sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldiA9IHByZXZpb3VzLmZpbHRlcihwcmV2QyA9PiBwcmV2Qy5jb25maWdLZXlJZCA9PT0gYz8uZGF0YT8uY29uZmlnS2V5SWQpWzBdO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlczogYW55W10gPSBbXTtcblxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKCh7IC4uLmM/LmRhdGEgfSkpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoa2V5ID0+ICFbJ3ZlcnNpb24nLCAnZHJhZnQnXS5pbmNsdWRlcyhrZXkpKVxuICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChfa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IF9rZXkgYXMgdW5rbm93biBhcyBrZXlvZiB0eXBlb2YgYy5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBjLmRhdGFba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gKHsgLi4ucHJldiB9KVtrZXkgYXMga2V5b2YgdHlwZW9mIHByZXZdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlKSAhPT0gSlNPTi5zdHJpbmdpZnkob2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWVzLnB1c2goeyBba2V5XTogb2xkVmFsdWUsIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlcy5wdXNoKHsgW2tleV06IG5ld1ZhbHVlLCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjaGFuZ2VIaXN0b3J5RGF0YS5jaGFuZ2VzID0ge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd1cGRhdGVfY29uZmlnX2tleScsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXBkYXRlIGNvbmZpZyBrZXknLFxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZXMsXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlcyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goY2hhbmdlSGlzdG9yeURhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGNvbmZpZ0tleXNIaXN0b3J5KS52YWx1ZXMoaW5zZXJ0RGF0YSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGUubWVzc2FnZSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImFuZCIsImVxIiwiaW5BcnJheSIsImlzTm90TnVsbCIsImlzTnVsbCIsIm5vdEluQXJyYXkiLCJhc2MiLCJvciIsInY0Iiwic29ja2V0IiwibG9nZ2VyIiwiZGIiLCJjb25maWdLZXlzIiwiY29uZmlnS2V5c0RyYWZ0cyIsImNvbmZpZ0tleXNIaXN0b3J5IiwiX2dldENvbmZpZ0tleSIsIl9nZXRDb25maWdLZXlzIiwiX3VwZGF0ZUNvbmZpZ0tleXNXaXRob3V0UHVibGlzaGluZyIsInBheWxvYWQiLCJvcHRzIiwicmVzdWx0cyIsInN1Y2Nlc3MiLCJjb25maWdLZXlzUmVmZXJlbmNlcyIsIm1hcCIsInMiLCJjb25maWdLZXlJZCIsImZpbHRlciIsIndoZXJlQ29uZmlnS2V5IiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiY29uZmlnS2V5RHJhZnRJZCIsImRyYWZ0cyIsInF1ZXJ5IiwiZmluZE1hbnkiLCJ3aGVyZSIsInB1Ymxpc2hlZENvbmZpZ0tleXMiLCJkZWxldGVkQXQiLCJvcmRlckJ5IiwicG9zaXRpb24iLCJuZXdEcmFmdHMiLCJ1cGRhdGVkRHJhZnRzIiwiZGF0YSIsImRyYWZ0IiwicHVibGlzaGVkQ29uZmlnS2V5IiwidXBkYXRlIiwic2V0IiwiaWQiLCJwdXNoIiwidmVyc2lvbiIsImluc2VydCIsInZhbHVlcyIsImJyb2FkY2FzdEFjdGlvbiIsImVtaXQiLCJlIiwiZXJyb3IiLCJtZXNzYWdlIiwiX3B1Ymxpc2hDb25maWdLZXlzIiwiY29sdW1ucyIsImluc2VydERhdGEiLCJjIiwidXBkYXRlRGF0YSIsImVycm9ycyIsIl9jcmVhdGVDb25maWdLZXlzIiwicmVzIiwiX3VwZGF0ZUNvbmZpZ0tleXMiLCJmb3JFYWNoIiwiX2RlbGV0ZUNvbmZpZ0tleXMiLCJjb25maWdLZXlJZHMiLCJpdGVtcyIsIkRhdGUiLCJkZWxldGUiLCJpdGVtIiwiY2hhbmdlcyIsImFjdGlvbiIsImRlc2NyaXB0aW9uIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiaW5zZXJ0ZWQiLCJkYXRhQmVmb3JlIiwiZCIsInJldHVybkluc2VydGVkIiwiX3NhdmVDb25maWdLZXlzSGlzdG9yeSIsInByZXZpb3VzIiwiX2NvbmZpZ0tleUlkIiwiX19jb25maWdLZXlJZCIsIm9sZENvbmZpZ0tleUlkIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwidXBkYXRlcyIsInB1Ymxpc2hEYXRlIiwiY29uZmlnS2V5IiwicmV0dXJuVXBkYXRlZCIsImNoYW5nZUhpc3RvcnlEYXRhIiwicHJldiIsInByZXZDIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsImluY2x1ZGVzIiwiX2tleSIsIm5ld1ZhbHVlIiwib2xkVmFsdWUiLCJKU09OIiwic3RyaW5naWZ5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_config-keys.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/_delete-diagnoses.ts":
/*!***********************************************************!*\
  !*** ./databases/mutations/_scripts/_delete-diagnoses.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _deleteDiagnoses: () => (/* binding */ _deleteDiagnoses)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\n\nasync function _deleteDiagnoses(params, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        const { diagnosisIds, scriptsIds, restoreKey, force } = {\n            ...params\n        };\n        const where = [\n            ...!diagnosisIds && !scriptsIds ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)(!diagnosisIds?.filter((s)=>s)?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, diagnosisIds), !scriptsIds?.filter((s)=>s)?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.scriptId, scriptsIds))\n            ]\n        ];\n        if (!where.length && !force) throw new Error(\"You&apos;re trying to delete all the diagnoses, please provide a force parameter.\");\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnoses.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where)\n        });\n        const deletedAt = new Date();\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses).set({\n            deletedAt\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where));\n        if (items.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId, items.map((s)=>s.diagnosisId))));\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory).values(items.map((item)=>({\n                version: item.version,\n                diagnosisId: item.diagnosisId,\n                scriptId: item.scriptId,\n                restoreKey,\n                changes: {\n                    action: \"delete_diagnosis\",\n                    dediagnosision: \"Delete diagnosis\",\n                    oldValues: [\n                        {\n                            deletedAt: null\n                        }\n                    ],\n                    newValues: [\n                        {\n                            deletedAt\n                        }\n                    ]\n                }\n            })));\n        if (!response.errors?.length) {\n            response.success = true;\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"delete_diagnoses\");\n        }\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_deleteDiagnoses ERROR\", e.message);\n        response.success = false;\n        response.errors = [\n            e.message\n        ];\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19kZWxldGUtZGlhZ25vc2VzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUEwRDtBQUV4QjtBQUNDO0FBQ0Q7QUFDNkM7QUFJeEUsZUFBZVUsaUJBQ2xCQyxNQUtDLEVBQ0RDLElBRUM7SUFFRCxNQUFNQyxXQUFxRDtRQUFFQyxTQUFTO0lBQU87SUFFN0UsSUFBSTtRQUNBLE1BQU0sRUFBRUMsWUFBWSxFQUFFQyxVQUFVLEVBQUVDLFVBQVUsRUFBRUMsS0FBSyxFQUFFLEdBQUc7WUFBRSxHQUFHUCxNQUFNO1FBQUM7UUFFcEUsTUFBTVEsUUFBUTtlQUNOLENBQUVKLGdCQUFnQixDQUFDQyxhQUFjLEVBQUUsR0FBRztnQkFBQ2IsK0NBQUVBLENBQ3pDLENBQUNZLGNBQWNLLE9BQU9DLENBQUFBLElBQUtBLElBQUlDLFNBQVNDLFlBQVl0QixvREFBT0EsQ0FBQ00saURBQVNBLENBQUNpQixXQUFXLEVBQUVULGVBQ25GLENBQUNDLFlBQVlJLE9BQU9DLENBQUFBLElBQUtBLElBQUlDLFNBQVNDLFlBQVl0QixvREFBT0EsQ0FBQ00saURBQVNBLENBQUNrQixRQUFRLEVBQUVUO2FBQ2hGO1NBQ0w7UUFFRCxJQUFJLENBQUNHLE1BQU1HLE1BQU0sSUFBSSxDQUFDSixPQUFPLE1BQU0sSUFBSVEsTUFBTTtRQUU3QyxNQUFNQyxRQUFRLE1BQU1yQixtREFBRUEsQ0FBQ3NCLEtBQUssQ0FBQ3JCLFNBQVMsQ0FBQ3NCLFFBQVEsQ0FBQztZQUM1Q1YsT0FBT25CLGdEQUFHQSxJQUFJbUI7UUFDbEI7UUFFQSxNQUFNVyxZQUFZLElBQUlDO1FBRXRCLE1BQU16QixtREFBRUEsQ0FDSDBCLE1BQU0sQ0FBQ3pCLGlEQUFTQSxFQUNoQjBCLEdBQUcsQ0FBQztZQUFFSDtRQUFXLEdBQ2pCWCxLQUFLLENBQUNuQixnREFBR0EsSUFBSW1CO1FBRWxCLElBQUlRLE1BQU1MLE1BQU0sRUFBRTtZQUNkLE1BQU1oQixtREFBRUEsQ0FBQzRCLE1BQU0sQ0FBQzFCLHVEQUFlQSxFQUFFVyxLQUFLLENBQUNuQixnREFBR0EsQ0FDdENFLHNEQUFTQSxDQUFDTSx1REFBZUEsQ0FBQ2dCLFdBQVcsR0FDckN2QixvREFBT0EsQ0FBQ08sdURBQWVBLENBQUNnQixXQUFXLEVBQUVHLE1BQU1RLEdBQUcsQ0FBQ2QsQ0FBQUEsSUFBS0EsRUFBRUcsV0FBVztRQUV6RTtRQUVBLE1BQU1sQixtREFBRUEsQ0FBQzhCLE1BQU0sQ0FBQzNCLHdEQUFnQkEsRUFBRTRCLE1BQU0sQ0FBQ1YsTUFBTVEsR0FBRyxDQUFDRyxDQUFBQSxPQUFTO2dCQUN4REMsU0FBU0QsS0FBS0MsT0FBTztnQkFDckJmLGFBQWFjLEtBQUtkLFdBQVc7Z0JBQzdCQyxVQUFVYSxLQUFLYixRQUFRO2dCQUN2QlI7Z0JBQ0F1QixTQUFTO29CQUNMQyxRQUFRO29CQUNSQyxnQkFBZ0I7b0JBQ2hCQyxXQUFXO3dCQUFDOzRCQUFFYixXQUFXO3dCQUFNO3FCQUFFO29CQUNqQ2MsV0FBVzt3QkFBQzs0QkFBRWQ7d0JBQVU7cUJBQUU7Z0JBQzlCO1lBQ0o7UUFFQSxJQUFJLENBQUNqQixTQUFTZ0MsTUFBTSxFQUFFdkIsUUFBUTtZQUMxQlQsU0FBU0MsT0FBTyxHQUFHO1lBQ25CLElBQUlGLE1BQU1rQyxpQkFBaUJ6QyxtREFBTUEsQ0FBQzBDLElBQUksQ0FBQyxnQkFBZ0I7UUFDM0Q7SUFDSixFQUFFLE9BQU1DLEdBQVE7UUFDWjVDLG1EQUFNQSxDQUFDNkMsS0FBSyxDQUFDLDBCQUEwQkQsRUFBRUUsT0FBTztRQUNoRHJDLFNBQVNDLE9BQU8sR0FBRztRQUNuQkQsU0FBU2dDLE1BQU0sR0FBRztZQUFDRyxFQUFFRSxPQUFPO1NBQUM7SUFDakMsU0FBVTtRQUNOLE9BQU9yQztJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9tdXRhdGlvbnMvX3NjcmlwdHMvX2RlbGV0ZS1kaWFnbm9zZXMudHM/NzNlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbmQsIGluQXJyYXksIGlzTm90TnVsbCwgb3IgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGRiIGZyb20gXCIuLi8uLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBkaWFnbm9zZXMsIGRpYWdub3Nlc0RyYWZ0cywgZGlhZ25vc2VzSGlzdG9yeSB9IGZyb20gXCIuLi8uLi9wZy9zY2hlbWFcIjtcbmltcG9ydCB7IF9nZXREaWFnbm9zaXMsIF9nZXREaWFnbm9zZXMsIF9saXN0UmF3RGlhZ25vc2VzLCBfbGlzdERpYWdub3NlcyB9IGZyb20gJy4uLy4uL3F1ZXJpZXMvZGlhZ25vc2VzJztcbmltcG9ydCB7IF9saXN0U2NyaXB0cyB9IGZyb20gXCIuLi8uLi9xdWVyaWVzL19zY3JpcHRzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZGVsZXRlRGlhZ25vc2VzKFxuICAgIHBhcmFtcz86IHtcbiAgICAgICAgZGlhZ25vc2lzSWRzPzogc3RyaW5nW107XG4gICAgICAgIHNjcmlwdHNJZHM/OiBzdHJpbmdbXTtcbiAgICAgICAgcmVzdG9yZUtleT86IHN0cmluZztcbiAgICAgICAgZm9yY2U/OiBib29sZWFuO1xuICAgIH0sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzcG9uc2U6IHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3JzPzogc3RyaW5nW107IH0gPSB7IHN1Y2Nlc3M6IGZhbHNlLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkaWFnbm9zaXNJZHMsIHNjcmlwdHNJZHMsIHJlc3RvcmVLZXksIGZvcmNlIH0gPSB7IC4uLnBhcmFtcyB9O1xuXG4gICAgICAgIGNvbnN0IHdoZXJlID0gW1xuICAgICAgICAgICAgLi4uKCghZGlhZ25vc2lzSWRzICYmICFzY3JpcHRzSWRzKSA/IFtdIDogW29yKFxuICAgICAgICAgICAgICAgICFkaWFnbm9zaXNJZHM/LmZpbHRlcihzID0+IHMpPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgZGlhZ25vc2lzSWRzKSxcbiAgICAgICAgICAgICAgICAhc2NyaXB0c0lkcz8uZmlsdGVyKHMgPT4gcyk/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoZGlhZ25vc2VzLnNjcmlwdElkLCBzY3JpcHRzSWRzKSxcbiAgICAgICAgICAgICldKSxcbiAgICAgICAgXTtcblxuICAgICAgICBpZiAoIXdoZXJlLmxlbmd0aCAmJiAhZm9yY2UpIHRocm93IG5ldyBFcnJvcignWW91JmFwb3M7cmUgdHJ5aW5nIHRvIGRlbGV0ZSBhbGwgdGhlIGRpYWdub3NlcywgcGxlYXNlIHByb3ZpZGUgYSBmb3JjZSBwYXJhbWV0ZXIuJyk7XG5cbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi53aGVyZSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgIC51cGRhdGUoZGlhZ25vc2VzKVxuICAgICAgICAgICAgLnNldCh7IGRlbGV0ZWRBdCwgfSlcbiAgICAgICAgICAgIC53aGVyZShhbmQoLi4ud2hlcmUpKTtcblxuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBhd2FpdCBkYi5kZWxldGUoZGlhZ25vc2VzRHJhZnRzKS53aGVyZShhbmQoXG4gICAgICAgICAgICAgICAgaXNOb3ROdWxsKGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCksXG4gICAgICAgICAgICAgICAgaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzSWQsIGl0ZW1zLm1hcChzID0+IHMuZGlhZ25vc2lzSWQpKSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGRpYWdub3Nlc0hpc3RvcnkpLnZhbHVlcyhpdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgdmVyc2lvbjogaXRlbS52ZXJzaW9uLFxuICAgICAgICAgICAgZGlhZ25vc2lzSWQ6IGl0ZW0uZGlhZ25vc2lzSWQsXG4gICAgICAgICAgICBzY3JpcHRJZDogaXRlbS5zY3JpcHRJZCxcbiAgICAgICAgICAgIHJlc3RvcmVLZXksXG4gICAgICAgICAgICBjaGFuZ2VzOiB7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlX2RpYWdub3NpcycsXG4gICAgICAgICAgICAgICAgZGVkaWFnbm9zaXNpb246ICdEZWxldGUgZGlhZ25vc2lzJyxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZXM6IFt7IGRlbGV0ZWRBdDogbnVsbCwgfV0sXG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzOiBbeyBkZWxldGVkQXQgfV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSkpO1xuXG4gICAgICAgIGlmICghcmVzcG9uc2UuZXJyb3JzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdkZWxldGVfZGlhZ25vc2VzJyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19kZWxldGVEaWFnbm9zZXMgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHJlc3BvbnNlLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiYW5kIiwiaW5BcnJheSIsImlzTm90TnVsbCIsIm9yIiwibG9nZ2VyIiwic29ja2V0IiwiZGIiLCJkaWFnbm9zZXMiLCJkaWFnbm9zZXNEcmFmdHMiLCJkaWFnbm9zZXNIaXN0b3J5IiwiX2RlbGV0ZURpYWdub3NlcyIsInBhcmFtcyIsIm9wdHMiLCJyZXNwb25zZSIsInN1Y2Nlc3MiLCJkaWFnbm9zaXNJZHMiLCJzY3JpcHRzSWRzIiwicmVzdG9yZUtleSIsImZvcmNlIiwid2hlcmUiLCJmaWx0ZXIiLCJzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiZGlhZ25vc2lzSWQiLCJzY3JpcHRJZCIsIkVycm9yIiwiaXRlbXMiLCJxdWVyeSIsImZpbmRNYW55IiwiZGVsZXRlZEF0IiwiRGF0ZSIsInVwZGF0ZSIsInNldCIsImRlbGV0ZSIsIm1hcCIsImluc2VydCIsInZhbHVlcyIsIml0ZW0iLCJ2ZXJzaW9uIiwiY2hhbmdlcyIsImFjdGlvbiIsImRlZGlhZ25vc2lzaW9uIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiZXJyb3JzIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsImUiLCJlcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/_delete-diagnoses.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/_delete-screens.ts":
/*!*********************************************************!*\
  !*** ./databases/mutations/_scripts/_delete-screens.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _deleteScreens: () => (/* binding */ _deleteScreens)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\n\nasync function _deleteScreens(params, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        const { screenIds, scriptsIds, restoreKey, force } = {\n            ...params\n        };\n        const where = [\n            ...!screenIds && !scriptsIds ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)(!screenIds?.filter((s)=>s)?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, screenIds), !scriptsIds?.filter((s)=>s)?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.scriptId, scriptsIds))\n            ]\n        ];\n        if (!where.length && !force) throw new Error(\"You&apos;re trying to delete all the screens, please provide a force parameter.\");\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screens.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where)\n        });\n        const deletedAt = new Date();\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens).set({\n            deletedAt\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where));\n        if (items.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId, items.map((s)=>s.screenId))));\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).values(items.map((item)=>({\n                version: item.version,\n                screenId: item.screenId,\n                scriptId: item.scriptId,\n                restoreKey,\n                changes: {\n                    action: \"delete_screen\",\n                    descreenion: \"Delete screen\",\n                    oldValues: [\n                        {\n                            deletedAt: null\n                        }\n                    ],\n                    newValues: [\n                        {\n                            deletedAt\n                        }\n                    ]\n                }\n            })));\n        if (!response.errors?.length) {\n            response.success = true;\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"delete_screens\");\n        }\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_deleteScreens ERROR\", e.message);\n        response.success = false;\n        response.errors = [\n            e.message\n        ];\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19kZWxldGUtc2NyZWVucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBMEQ7QUFFeEI7QUFDQztBQUNEO0FBQ3VDO0FBSWxFLGVBQWVVLGVBQ2xCQyxNQUtDLEVBQ0RDLElBRUM7SUFFRCxNQUFNQyxXQUFxRDtRQUFFQyxTQUFTO0lBQU87SUFFN0UsSUFBSTtRQUNBLE1BQU0sRUFBRUMsU0FBUyxFQUFFQyxVQUFVLEVBQUVDLFVBQVUsRUFBRUMsS0FBSyxFQUFFLEdBQUc7WUFBRSxHQUFHUCxNQUFNO1FBQUM7UUFFakUsTUFBTVEsUUFBUTtlQUNOLENBQUVKLGFBQWEsQ0FBQ0MsYUFBYyxFQUFFLEdBQUc7Z0JBQUNiLCtDQUFFQSxDQUN0QyxDQUFDWSxXQUFXSyxPQUFPQyxDQUFBQSxJQUFLQSxJQUFJQyxTQUFTQyxZQUFZdEIsb0RBQU9BLENBQUNNLCtDQUFPQSxDQUFDaUIsUUFBUSxFQUFFVCxZQUMzRSxDQUFDQyxZQUFZSSxPQUFPQyxDQUFBQSxJQUFLQSxJQUFJQyxTQUFTQyxZQUFZdEIsb0RBQU9BLENBQUNNLCtDQUFPQSxDQUFDa0IsUUFBUSxFQUFFVDthQUM5RTtTQUNMO1FBRUQsSUFBSSxDQUFDRyxNQUFNRyxNQUFNLElBQUksQ0FBQ0osT0FBTyxNQUFNLElBQUlRLE1BQU07UUFFN0MsTUFBTUMsUUFBUSxNQUFNckIsbURBQUVBLENBQUNzQixLQUFLLENBQUNyQixPQUFPLENBQUNzQixRQUFRLENBQUM7WUFDMUNWLE9BQU9uQixnREFBR0EsSUFBSW1CO1FBQ2xCO1FBRUEsTUFBTVcsWUFBWSxJQUFJQztRQUV0QixNQUFNekIsbURBQUVBLENBQ0gwQixNQUFNLENBQUN6QiwrQ0FBT0EsRUFDZDBCLEdBQUcsQ0FBQztZQUFFSDtRQUFXLEdBQ2pCWCxLQUFLLENBQUNuQixnREFBR0EsSUFBSW1CO1FBRWxCLElBQUlRLE1BQU1MLE1BQU0sRUFBRTtZQUNkLE1BQU1oQixtREFBRUEsQ0FBQzRCLE1BQU0sQ0FBQzFCLHFEQUFhQSxFQUFFVyxLQUFLLENBQUNuQixnREFBR0EsQ0FDcENFLHNEQUFTQSxDQUFDTSxxREFBYUEsQ0FBQ2dCLFFBQVEsR0FDaEN2QixvREFBT0EsQ0FBQ08scURBQWFBLENBQUNnQixRQUFRLEVBQUVHLE1BQU1RLEdBQUcsQ0FBQ2QsQ0FBQUEsSUFBS0EsRUFBRUcsUUFBUTtRQUVqRTtRQUVBLE1BQU1sQixtREFBRUEsQ0FBQzhCLE1BQU0sQ0FBQzNCLHNEQUFjQSxFQUFFNEIsTUFBTSxDQUFDVixNQUFNUSxHQUFHLENBQUNHLENBQUFBLE9BQVM7Z0JBQ3REQyxTQUFTRCxLQUFLQyxPQUFPO2dCQUNyQmYsVUFBVWMsS0FBS2QsUUFBUTtnQkFDdkJDLFVBQVVhLEtBQUtiLFFBQVE7Z0JBQ3ZCUjtnQkFDQXVCLFNBQVM7b0JBQ0xDLFFBQVE7b0JBQ1JDLGFBQWE7b0JBQ2JDLFdBQVc7d0JBQUM7NEJBQUViLFdBQVc7d0JBQU07cUJBQUU7b0JBQ2pDYyxXQUFXO3dCQUFDOzRCQUFFZDt3QkFBVTtxQkFBRTtnQkFDOUI7WUFDSjtRQUVBLElBQUksQ0FBQ2pCLFNBQVNnQyxNQUFNLEVBQUV2QixRQUFRO1lBQzFCVCxTQUFTQyxPQUFPLEdBQUc7WUFDbkIsSUFBSUYsTUFBTWtDLGlCQUFpQnpDLG1EQUFNQSxDQUFDMEMsSUFBSSxDQUFDLGdCQUFnQjtRQUMzRDtJQUNKLEVBQUUsT0FBTUMsR0FBUTtRQUNaNUMsbURBQU1BLENBQUM2QyxLQUFLLENBQUMsd0JBQXdCRCxFQUFFRSxPQUFPO1FBQzlDckMsU0FBU0MsT0FBTyxHQUFHO1FBQ25CRCxTQUFTZ0MsTUFBTSxHQUFHO1lBQUNHLEVBQUVFLE9BQU87U0FBQztJQUNqQyxTQUFVO1FBQ04sT0FBT3JDO0lBQ1g7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL211dGF0aW9ucy9fc2NyaXB0cy9fZGVsZXRlLXNjcmVlbnMudHM/ZjllMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbmQsIGluQXJyYXksIGlzTm90TnVsbCwgb3IgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGRiIGZyb20gXCIuLi8uLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBzY3JlZW5zLCBzY3JlZW5zRHJhZnRzLCBzY3JlZW5zSGlzdG9yeSB9IGZyb20gXCIuLi8uLi9wZy9zY2hlbWFcIjtcbmltcG9ydCB7IF9nZXRTY3JlZW4sIF9nZXRTY3JlZW5zLCBfbGlzdFJhd1NjcmVlbnMsIF9saXN0U2NyZWVucyB9IGZyb20gJy4uLy4uL3F1ZXJpZXMvc2NyZWVucyc7XG5pbXBvcnQgeyBfbGlzdFNjcmlwdHMgfSBmcm9tIFwiLi4vLi4vcXVlcmllcy9fc2NyaXB0c1wiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2RlbGV0ZVNjcmVlbnMoXG4gICAgcGFyYW1zPzoge1xuICAgICAgICBzY3JlZW5JZHM/OiBzdHJpbmdbXTtcbiAgICAgICAgc2NyaXB0c0lkcz86IHN0cmluZ1tdO1xuICAgICAgICByZXN0b3JlS2V5Pzogc3RyaW5nO1xuICAgICAgICBmb3JjZT86IGJvb2xlYW47XG4gICAgfSwgXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXNwb25zZTogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogZmFsc2UsIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHNjcmVlbklkcywgc2NyaXB0c0lkcywgcmVzdG9yZUtleSwgZm9yY2UgfSA9IHsgLi4ucGFyYW1zIH07XG5cbiAgICAgICAgY29uc3Qgd2hlcmUgPSBbXG4gICAgICAgICAgICAuLi4oKCFzY3JlZW5JZHMgJiYgIXNjcmlwdHNJZHMpID8gW10gOiBbb3IoXG4gICAgICAgICAgICAgICAgIXNjcmVlbklkcz8uZmlsdGVyKHMgPT4gcyk/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoc2NyZWVucy5zY3JlZW5JZCwgc2NyZWVuSWRzKSxcbiAgICAgICAgICAgICAgICAhc2NyaXB0c0lkcz8uZmlsdGVyKHMgPT4gcyk/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoc2NyZWVucy5zY3JpcHRJZCwgc2NyaXB0c0lkcyksXG4gICAgICAgICAgICApXSksXG4gICAgICAgIF07XG5cbiAgICAgICAgaWYgKCF3aGVyZS5sZW5ndGggJiYgIWZvcmNlKSB0aHJvdyBuZXcgRXJyb3IoJ1lvdSZhcG9zO3JlIHRyeWluZyB0byBkZWxldGUgYWxsIHRoZSBzY3JlZW5zLCBwbGVhc2UgcHJvdmlkZSBhIGZvcmNlIHBhcmFtZXRlci4nKTtcblxuICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi53aGVyZSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgIC51cGRhdGUoc2NyZWVucylcbiAgICAgICAgICAgIC5zZXQoeyBkZWxldGVkQXQsIH0pXG4gICAgICAgICAgICAud2hlcmUoYW5kKC4uLndoZXJlKSk7XG5cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjcmVlbnNEcmFmdHMpLndoZXJlKGFuZChcbiAgICAgICAgICAgICAgICBpc05vdE51bGwoc2NyZWVuc0RyYWZ0cy5zY3JlZW5JZCksXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmVlbklkLCBpdGVtcy5tYXAocyA9PiBzLnNjcmVlbklkKSksXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JlZW5zSGlzdG9yeSkudmFsdWVzKGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgICB2ZXJzaW9uOiBpdGVtLnZlcnNpb24sXG4gICAgICAgICAgICBzY3JlZW5JZDogaXRlbS5zY3JlZW5JZCxcbiAgICAgICAgICAgIHNjcmlwdElkOiBpdGVtLnNjcmlwdElkLFxuICAgICAgICAgICAgcmVzdG9yZUtleSxcbiAgICAgICAgICAgIGNoYW5nZXM6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdkZWxldGVfc2NyZWVuJyxcbiAgICAgICAgICAgICAgICBkZXNjcmVlbmlvbjogJ0RlbGV0ZSBzY3JlZW4nLFxuICAgICAgICAgICAgICAgIG9sZFZhbHVlczogW3sgZGVsZXRlZEF0OiBudWxsLCB9XSxcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZXM6IFt7IGRlbGV0ZWRBdCB9XSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pKSk7XG5cbiAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcnM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9zY3JlZW5zJyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19kZWxldGVTY3JlZW5zIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXNwb25zZS5lcnJvcnMgPSBbZS5tZXNzYWdlXTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImFuZCIsImluQXJyYXkiLCJpc05vdE51bGwiLCJvciIsImxvZ2dlciIsInNvY2tldCIsImRiIiwic2NyZWVucyIsInNjcmVlbnNEcmFmdHMiLCJzY3JlZW5zSGlzdG9yeSIsIl9kZWxldGVTY3JlZW5zIiwicGFyYW1zIiwib3B0cyIsInJlc3BvbnNlIiwic3VjY2VzcyIsInNjcmVlbklkcyIsInNjcmlwdHNJZHMiLCJyZXN0b3JlS2V5IiwiZm9yY2UiLCJ3aGVyZSIsImZpbHRlciIsInMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzY3JlZW5JZCIsInNjcmlwdElkIiwiRXJyb3IiLCJpdGVtcyIsInF1ZXJ5IiwiZmluZE1hbnkiLCJkZWxldGVkQXQiLCJEYXRlIiwidXBkYXRlIiwic2V0IiwiZGVsZXRlIiwibWFwIiwiaW5zZXJ0IiwidmFsdWVzIiwiaXRlbSIsInZlcnNpb24iLCJjaGFuZ2VzIiwiYWN0aW9uIiwiZGVzY3JlZW5pb24iLCJvbGRWYWx1ZXMiLCJuZXdWYWx1ZXMiLCJlcnJvcnMiLCJicm9hZGNhc3RBY3Rpb24iLCJlbWl0IiwiZSIsImVycm9yIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/_delete-screens.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/_import-scripts.ts":
/*!*********************************************************!*\
  !*** ./databases/mutations/_scripts/_import-scripts.ts ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __importScripts: () => (/* binding */ __importScripts),\n/* harmony export */   _importScripts: () => (/* binding */ _importScripts)\n/* harmony export */ });\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _databases_queries_scripts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/databases/queries/_scripts */ \"(rsc)/./databases/queries/_scripts/index.ts\");\n/* harmony import */ var _databases_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/databases/utils */ \"(rsc)/./databases/utils.ts\");\n/* harmony import */ var _delete_diagnoses__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./_delete-diagnoses */ \"(rsc)/./databases/mutations/_scripts/_delete-diagnoses.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _delete_screens__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./_delete-screens */ \"(rsc)/./databases/mutations/_scripts/_delete-screens.ts\");\n\n\n\n\n\n\n\n\n\nasync function _importScripts(data, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        for (const { scriptId, overWriteExistingScriptWithId } of data){\n            const { data: scripts, errors } = await (0,_databases_queries_scripts__WEBPACK_IMPORTED_MODULE_4__._getScriptsWithItems)({\n                scriptsIds: [\n                    scriptId\n                ]\n            });\n            if (errors) {\n                response.success = false;\n                response.errors = [\n                    ...response.errors || [],\n                    ...errors\n                ];\n            } else {\n                const res = await __importScripts(scripts.map((s)=>({\n                        ...s,\n                        scriptId: overWriteExistingScriptWithId || s.scriptId\n                    })), {\n                    overWriteScriptId: !overWriteExistingScriptWithId\n                });\n                if (res.errors) {\n                    response.success = false;\n                    response.errors = [\n                        ...response.errors || [],\n                        ...res.errors\n                    ];\n                }\n            }\n        }\n        if (!response.errors?.length) {\n            response.success = true;\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"create_scripts_drafts\");\n        }\n    } catch (e) {\n        const message = e.response?.data?.message || e.response?.data || e.message;\n        response.success = false;\n        response.errors = [\n            message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"importScripts ERROR\", message);\n    } finally{\n        return response;\n    }\n}\nasync function __importScripts(scripts, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        const overWriteScriptId = opts?.overWriteScriptId === undefined ? true : opts.overWriteScriptId;\n        const scriptsList = await (0,_databases_queries_scripts__WEBPACK_IMPORTED_MODULE_4__._listScripts)();\n        const lastPosition = scriptsList.data.length ? Math.max(...scriptsList.data.map((s)=>s.position)) : 0;\n        let position = lastPosition + 1;\n        for (const { screens = [], diagnoses = [], ...s } of scripts){\n            try {\n                const updateScript = await (overWriteScriptId ? null : _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.scripts.findFirst({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.scriptId, s.scriptId),\n                    with: {\n                        draft: true\n                    }\n                }));\n                const updateScriptDraft = await (overWriteScriptId ? null : updateScript?.draft || _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.scriptsDrafts.findFirst({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptDraftId, s.scriptId)\n                }));\n                let scriptDraftData = {\n                    ...(0,_databases_utils__WEBPACK_IMPORTED_MODULE_5__.scriptToDraftInsertData)(s),\n                    position\n                };\n                position++;\n                scriptDraftData.scriptId = updateScriptDraft?.scriptDraftId || updateScript?.scriptId || scriptDraftData.scriptId;\n                scriptDraftData.position = updateScriptDraft?.data?.position || updateScript?.position || position;\n                scriptDraftData.version = updateScriptDraft?.data?.version || (updateScript?.version ? updateScript.version + 1 : scriptDraftData.version);\n                if (updateScriptDraft) {\n                    await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].update(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts).set({\n                        data: scriptDraftData\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptDraftId, updateScriptDraft.scriptDraftId));\n                } else {\n                    await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].insert(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts).values([\n                        {\n                            data: scriptDraftData,\n                            scriptDraftId: scriptDraftData.scriptId,\n                            scriptId: updateScript?.scriptId,\n                            position: scriptDraftData.position\n                        }\n                    ]);\n                }\n                if (updateScriptDraft || updateScript) {\n                    await (0,_delete_screens__WEBPACK_IMPORTED_MODULE_7__._deleteScreens)({\n                        scriptsIds: [\n                            scriptDraftData.scriptId\n                        ],\n                        restoreKey: `script_draft_${scriptDraftData.scriptId}`\n                    });\n                    await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts.scriptDraftId, scriptDraftData.scriptId));\n                }\n                for (const screen of screens){\n                    const screenDraftData = (0,_databases_utils__WEBPACK_IMPORTED_MODULE_5__.screenToDraftInsertData)(screen);\n                    try {\n                        await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].insert(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts).values([\n                            {\n                                data: screenDraftData,\n                                position: screenDraftData.position,\n                                screenDraftId: screenDraftData.screenId,\n                                scriptDraftId: scriptDraftData.scriptId,\n                                type: screenDraftData.type\n                            }\n                        ]);\n                    } catch (e) {\n                        response.success = false;\n                        response.errors = response.errors || [];\n                        response.errors.push(`Failed to save script: ${s.title} (${e.message})`);\n                    }\n                }\n                if (updateScriptDraft || updateScript) {\n                    await (0,_delete_diagnoses__WEBPACK_IMPORTED_MODULE_6__._deleteDiagnoses)({\n                        scriptsIds: [\n                            scriptDraftData.scriptId\n                        ],\n                        restoreKey: `script_draft_${scriptDraftData.scriptId}`\n                    });\n                    await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts.scriptDraftId, scriptDraftData.scriptId));\n                }\n                for (const diagnosis of diagnoses){\n                    const diagnosisDraftData = (0,_databases_utils__WEBPACK_IMPORTED_MODULE_5__.diagnosisToDraftInsertData)(diagnosis);\n                    try {\n                        await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].insert(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts).values([\n                            {\n                                data: diagnosisDraftData,\n                                position: diagnosisDraftData.position,\n                                diagnosisDraftId: diagnosisDraftData.diagnosisId,\n                                scriptDraftId: scriptDraftData.scriptId\n                            }\n                        ]);\n                    } catch (e) {\n                        response.success = false;\n                        response.errors = response.errors || [];\n                        response.errors.push(`Failed to save script: ${s.title} (${e.message})`);\n                    }\n                }\n            } catch (e) {\n                response.success = false;\n                response.errors = response.errors || [];\n                response.errors.push(`Failed to save script: ${s.title} (${e.message})`);\n            }\n        }\n        if (!response.errors?.length) {\n            response.success = true;\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"create_scripts_drafts\");\n        }\n    } catch (e) {\n        const message = e.response?.data?.message || e.response?.data || e.message;\n        response.success = false;\n        response.errors = [\n            message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"importScripts ERROR\", message);\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19pbXBvcnQtc2NyaXB0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUF3QztBQU1UO0FBQ0c7QUFDQztBQUMrQztBQUMrQjtBQUcxRDtBQUV0QjtBQUNrQjtBQUU1QyxlQUFlbUIsZUFDbEJDLElBR0csRUFDSEMsSUFFQztJQUVELE1BQU1DLFdBQXFEO1FBQUVDLFNBQVM7SUFBTztJQUM3RSxJQUFJO1FBQ0EsS0FBSSxNQUFNLEVBQUVDLFFBQVEsRUFBRUMsNkJBQTZCLEVBQUUsSUFBSUwsS0FBTTtZQUMzRCxNQUFNLEVBQUVBLE1BQU1iLE9BQU8sRUFBRW1CLE1BQU0sRUFBRSxHQUFHLE1BQU1mLGdGQUFvQkEsQ0FBQztnQkFBRWdCLFlBQVk7b0JBQUNIO2lCQUFTO1lBQUU7WUFDdkYsSUFBSUUsUUFBUTtnQkFDUkosU0FBU0MsT0FBTyxHQUFHO2dCQUNuQkQsU0FBU0ksTUFBTSxHQUFHO3VCQUFLSixTQUFTSSxNQUFNLElBQUksRUFBRTt1QkFBTUE7aUJBQU87WUFDN0QsT0FBTztnQkFDSCxNQUFNRSxNQUFNLE1BQU1DLGdCQUNkdEIsUUFBUXVCLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBTTt3QkFDZCxHQUFHQSxDQUFDO3dCQUNKUCxVQUFVQyxpQ0FBaUNNLEVBQUVQLFFBQVE7b0JBQ3pELEtBQ0E7b0JBQUVRLG1CQUFtQixDQUFDUDtnQkFBOEI7Z0JBRXhELElBQUlHLElBQUlGLE1BQU0sRUFBRTtvQkFDWkosU0FBU0MsT0FBTyxHQUFHO29CQUNuQkQsU0FBU0ksTUFBTSxHQUFHOzJCQUFLSixTQUFTSSxNQUFNLElBQUksRUFBRTsyQkFBTUUsSUFBSUYsTUFBTTtxQkFBQztnQkFDakU7WUFDSjtRQUNKO1FBRUEsSUFBSSxDQUFDSixTQUFTSSxNQUFNLEVBQUVPLFFBQVE7WUFDMUJYLFNBQVNDLE9BQU8sR0FBRztZQUNuQixJQUFJRixNQUFNYSxpQkFBaUJ4QixtREFBTUEsQ0FBQ3lC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QzNEO0lBQ0osRUFBRSxPQUFNQyxHQUFRO1FBQ1osTUFBTUMsVUFBVUQsRUFBRWQsUUFBUSxFQUFFRixNQUFNaUIsV0FBV0QsRUFBRWQsUUFBUSxFQUFFRixRQUFRZ0IsRUFBRUMsT0FBTztRQUMxRWYsU0FBU0MsT0FBTyxHQUFHO1FBQ25CRCxTQUFTSSxNQUFNLEdBQUc7WUFBQ1c7U0FBUTtRQUMzQjVCLG1EQUFNQSxDQUFDNkIsS0FBSyxDQUFDLHVCQUF1QkQ7SUFDeEMsU0FBVTtRQUNOLE9BQU9mO0lBQ1g7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL211dGF0aW9ucy9fc2NyaXB0cy9faW1wb3J0LXNjcmlwdHMudHM/YWMwMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGIgZnJvbSBcIkAvZGF0YWJhc2VzL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IFxuICAgIHNjcmVlbnNEcmFmdHMgYXMgc2NyZWVuc0RyYWZ0c1RhYmxlLCBcbiAgICBkaWFnbm9zZXNEcmFmdHMgYXMgZGlhZ25vc2VzRHJhZnRzVGFibGUsIFxuICAgIHNjcmlwdHNEcmFmdHMgYXMgc2NyaXB0c0RyYWZ0c1RhYmxlLFxuICAgIHNjcmlwdHMgYXMgc2NyaXB0c1RhYmxlLCBcbn0gZnJvbSBcIkAvZGF0YWJhc2VzL3BnL3NjaGVtYVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IHsgX2dldFNjcmlwdHNXaXRoSXRlbXMsIF9saXN0U2NyaXB0cyB9IGZyb20gJ0AvZGF0YWJhc2VzL3F1ZXJpZXMvX3NjcmlwdHMnO1xuaW1wb3J0IHsgc2NyZWVuVG9EcmFmdEluc2VydERhdGEsIHNjcmlwdFRvRHJhZnRJbnNlcnREYXRhLCBkaWFnbm9zaXNUb0RyYWZ0SW5zZXJ0RGF0YSB9IGZyb20gJ0AvZGF0YWJhc2VzL3V0aWxzJztcbmltcG9ydCB7IF9jcmVhdGVTY3JlZW5zRHJhZnRzIH0gZnJvbSAnLi4vc2NyZWVucy1kcmFmdHMnO1xuaW1wb3J0IHsgX2NyZWF0ZURpYWdub3Nlc0RyYWZ0cyB9IGZyb20gJy4uL2RpYWdub3Nlcy1kcmFmdHMnO1xuaW1wb3J0IHsgX2RlbGV0ZURpYWdub3NlcyB9IGZyb20gJy4vX2RlbGV0ZS1kaWFnbm9zZXMnO1xuXG5pbXBvcnQgeyBlcSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IF9kZWxldGVTY3JlZW5zIH0gZnJvbSAnLi9fZGVsZXRlLXNjcmVlbnMnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2ltcG9ydFNjcmlwdHMoXG4gICAgZGF0YToge1xuICAgICAgICBzY3JpcHRJZDogc3RyaW5nO1xuICAgICAgICBvdmVyV3JpdGVFeGlzdGluZ1NjcmlwdFdpdGhJZD86IHN0cmluZztcbiAgICB9W10sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXNwb25zZTogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogZmFsc2UsIH07XG4gICAgdHJ5IHtcbiAgICAgICAgZm9yKGNvbnN0IHsgc2NyaXB0SWQsIG92ZXJXcml0ZUV4aXN0aW5nU2NyaXB0V2l0aElkIH0gb2YgZGF0YSkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBzY3JpcHRzLCBlcnJvcnMgfSA9IGF3YWl0IF9nZXRTY3JpcHRzV2l0aEl0ZW1zKHsgc2NyaXB0c0lkczogW3NjcmlwdElkXSwgfSk7XG4gICAgICAgICAgICBpZiAoZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9ycyA9IFsuLi4ocmVzcG9uc2UuZXJyb3JzIHx8IFtdKSwgLi4uZXJyb3JzXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgX19pbXBvcnRTY3JpcHRzKFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHRzLm1hcChzID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQ6IG92ZXJXcml0ZUV4aXN0aW5nU2NyaXB0V2l0aElkIHx8IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICAgICAgICAgIH0pKSwgXG4gICAgICAgICAgICAgICAgICAgIHsgb3ZlcldyaXRlU2NyaXB0SWQ6ICFvdmVyV3JpdGVFeGlzdGluZ1NjcmlwdFdpdGhJZCB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmVycm9ycykge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9ycyA9IFsuLi4ocmVzcG9uc2UuZXJyb3JzIHx8IFtdKSwgLi4ucmVzLmVycm9yc107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcnM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JpcHRzX2RyYWZ0cycpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGUucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZS5yZXNwb25zZT8uZGF0YSB8fCBlLm1lc3NhZ2U7XG4gICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzcG9uc2UuZXJyb3JzID0gW21lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ2ltcG9ydFNjcmlwdHMgRVJST1InLCBtZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX19pbXBvcnRTY3JpcHRzKFxuICAgIHNjcmlwdHM6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX2dldFNjcmlwdHNXaXRoSXRlbXM+PlsnZGF0YSddLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgICAgIG92ZXJXcml0ZVNjcmlwdElkPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXNwb25zZTogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogZmFsc2UsIH07XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgb3ZlcldyaXRlU2NyaXB0SWQgPSBvcHRzPy5vdmVyV3JpdGVTY3JpcHRJZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IG9wdHMub3ZlcldyaXRlU2NyaXB0SWQ7XG5cbiAgICAgICAgY29uc3Qgc2NyaXB0c0xpc3QgPSBhd2FpdCBfbGlzdFNjcmlwdHMoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0UG9zaXRpb24gPSBzY3JpcHRzTGlzdC5kYXRhLmxlbmd0aCA/IE1hdGgubWF4KC4uLnNjcmlwdHNMaXN0LmRhdGEubWFwKHMgPT4gcy5wb3NpdGlvbikpIDogMDtcbiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb24gPSBsYXN0UG9zaXRpb24gKyAxOyBcblxuICAgICAgICBmb3IgKGNvbnN0IHsgc2NyZWVucyA9IFtdLCBkaWFnbm9zZXMgPSBbXSwgLi4ucyB9IG9mIHNjcmlwdHMpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU2NyaXB0ID0gYXdhaXQgKG92ZXJXcml0ZVNjcmlwdElkID8gbnVsbCA6IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IGVxKHNjcmlwdHNUYWJsZS5zY3JpcHRJZCwgcy5zY3JpcHRJZCksXG4gICAgICAgICAgICAgICAgICAgIHdpdGg6IHsgZHJhZnQ6IHRydWUsIH0sXG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlU2NyaXB0RHJhZnQgPSBhd2FpdCAob3ZlcldyaXRlU2NyaXB0SWQgPyBudWxsIDogdXBkYXRlU2NyaXB0Py5kcmFmdCB8fCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiBlcShzY3JpcHRzRHJhZnRzVGFibGUuc2NyaXB0RHJhZnRJZCwgcy5zY3JpcHRJZCksXG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgbGV0IHNjcmlwdERyYWZ0RGF0YSA9IHsgLi4uc2NyaXB0VG9EcmFmdEluc2VydERhdGEocyksIHBvc2l0aW9uLCB9O1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uKys7XG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnREYXRhLnNjcmlwdElkID0gdXBkYXRlU2NyaXB0RHJhZnQ/LnNjcmlwdERyYWZ0SWQgfHwgdXBkYXRlU2NyaXB0Py5zY3JpcHRJZCB8fCBzY3JpcHREcmFmdERhdGEuc2NyaXB0SWQ7XG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnREYXRhLnBvc2l0aW9uID0gdXBkYXRlU2NyaXB0RHJhZnQ/LmRhdGE/LnBvc2l0aW9uIHx8IHVwZGF0ZVNjcmlwdD8ucG9zaXRpb24gfHwgcG9zaXRpb247XG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnREYXRhLnZlcnNpb24gPSB1cGRhdGVTY3JpcHREcmFmdD8uZGF0YT8udmVyc2lvbiB8fCAodXBkYXRlU2NyaXB0Py52ZXJzaW9uID8gKHVwZGF0ZVNjcmlwdC52ZXJzaW9uICsgMSkgOiBzY3JpcHREcmFmdERhdGEudmVyc2lvbik7XG5cbiAgICAgICAgICAgICAgICBpZiAodXBkYXRlU2NyaXB0RHJhZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGIudXBkYXRlKHNjcmlwdHNEcmFmdHNUYWJsZSkuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNjcmlwdERyYWZ0RGF0YSxcbiAgICAgICAgICAgICAgICAgICAgfSkud2hlcmUoZXEoc2NyaXB0c0RyYWZ0c1RhYmxlLnNjcmlwdERyYWZ0SWQsIHVwZGF0ZVNjcmlwdERyYWZ0LnNjcmlwdERyYWZ0SWQpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JpcHRzRHJhZnRzVGFibGUpLnZhbHVlcyhbe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogc2NyaXB0RHJhZnREYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogc2NyaXB0RHJhZnREYXRhLnNjcmlwdElkISxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdElkOiB1cGRhdGVTY3JpcHQ/LnNjcmlwdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHNjcmlwdERyYWZ0RGF0YS5wb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgfV0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh1cGRhdGVTY3JpcHREcmFmdCB8fCB1cGRhdGVTY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgX2RlbGV0ZVNjcmVlbnMoeyBzY3JpcHRzSWRzOiBbc2NyaXB0RHJhZnREYXRhLnNjcmlwdElkIV0sIHJlc3RvcmVLZXk6IGBzY3JpcHRfZHJhZnRfJHtzY3JpcHREcmFmdERhdGEuc2NyaXB0SWR9YCwgfSk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JlZW5zRHJhZnRzVGFibGUpLndoZXJlKGVxKHNjcmVlbnNEcmFmdHNUYWJsZS5zY3JpcHREcmFmdElkLCBzY3JpcHREcmFmdERhdGEuc2NyaXB0SWQhKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzY3JlZW4gb2Ygc2NyZWVucykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzY3JlZW5EcmFmdERhdGEgPSBzY3JlZW5Ub0RyYWZ0SW5zZXJ0RGF0YShzY3JlZW4pO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JlZW5zRHJhZnRzVGFibGUpLnZhbHVlcyhbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNjcmVlbkRyYWZ0RGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogc2NyZWVuRHJhZnREYXRhLnBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbkRyYWZ0SWQ6IHNjcmVlbkRyYWZ0RGF0YS5zY3JlZW5JZCEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogc2NyaXB0RHJhZnREYXRhLnNjcmlwdElkISxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBzY3JlZW5EcmFmdERhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9ycyA9IHJlc3BvbnNlLmVycm9ycyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVycm9ycy5wdXNoKGBGYWlsZWQgdG8gc2F2ZSBzY3JpcHQ6ICR7cy50aXRsZX0gKCR7ZS5tZXNzYWdlfSlgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh1cGRhdGVTY3JpcHREcmFmdCB8fCB1cGRhdGVTY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgX2RlbGV0ZURpYWdub3Nlcyh7IHNjcmlwdHNJZHM6IFtzY3JpcHREcmFmdERhdGEuc2NyaXB0SWQhXSwgcmVzdG9yZUtleTogYHNjcmlwdF9kcmFmdF8ke3NjcmlwdERyYWZ0RGF0YS5zY3JpcHRJZH1gLCB9KTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGIuZGVsZXRlKGRpYWdub3Nlc0RyYWZ0c1RhYmxlKS53aGVyZShlcShkaWFnbm9zZXNEcmFmdHNUYWJsZS5zY3JpcHREcmFmdElkLCBzY3JpcHREcmFmdERhdGEuc2NyaXB0SWQhKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBkaWFnbm9zaXMgb2YgZGlhZ25vc2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpYWdub3Npc0RyYWZ0RGF0YSA9IGRpYWdub3Npc1RvRHJhZnRJbnNlcnREYXRhKGRpYWdub3Npcyk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGRpYWdub3Nlc0RyYWZ0c1RhYmxlKS52YWx1ZXMoW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkaWFnbm9zaXNEcmFmdERhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGRpYWdub3Npc0RyYWZ0RGF0YS5wb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWFnbm9zaXNEcmFmdElkOiBkaWFnbm9zaXNEcmFmdERhdGEuZGlhZ25vc2lzSWQhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHNjcmlwdERyYWZ0RGF0YS5zY3JpcHRJZCEsXG4gICAgICAgICAgICAgICAgICAgICAgICB9XSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvcnMgPSByZXNwb25zZS5lcnJvcnMgfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvcnMucHVzaChgRmFpbGVkIHRvIHNhdmUgc2NyaXB0OiAke3MudGl0bGV9ICgke2UubWVzc2FnZX0pYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvcnMgPSByZXNwb25zZS5lcnJvcnMgfHwgW107XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZXJyb3JzLnB1c2goYEZhaWxlZCB0byBzYXZlIHNjcmlwdDogJHtzLnRpdGxlfSAoJHtlLm1lc3NhZ2V9KWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcnM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JpcHRzX2RyYWZ0cycpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGUucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2UgfHwgZS5yZXNwb25zZT8uZGF0YSB8fCBlLm1lc3NhZ2U7XG4gICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzcG9uc2UuZXJyb3JzID0gW21lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ2ltcG9ydFNjcmlwdHMgRVJST1InLCBtZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImRiIiwic2NyZWVuc0RyYWZ0cyIsInNjcmVlbnNEcmFmdHNUYWJsZSIsImRpYWdub3Nlc0RyYWZ0cyIsImRpYWdub3Nlc0RyYWZ0c1RhYmxlIiwic2NyaXB0c0RyYWZ0cyIsInNjcmlwdHNEcmFmdHNUYWJsZSIsInNjcmlwdHMiLCJzY3JpcHRzVGFibGUiLCJsb2dnZXIiLCJzb2NrZXQiLCJfZ2V0U2NyaXB0c1dpdGhJdGVtcyIsIl9saXN0U2NyaXB0cyIsInNjcmVlblRvRHJhZnRJbnNlcnREYXRhIiwic2NyaXB0VG9EcmFmdEluc2VydERhdGEiLCJkaWFnbm9zaXNUb0RyYWZ0SW5zZXJ0RGF0YSIsIl9kZWxldGVEaWFnbm9zZXMiLCJlcSIsIl9kZWxldGVTY3JlZW5zIiwiX2ltcG9ydFNjcmlwdHMiLCJkYXRhIiwib3B0cyIsInJlc3BvbnNlIiwic3VjY2VzcyIsInNjcmlwdElkIiwib3ZlcldyaXRlRXhpc3RpbmdTY3JpcHRXaXRoSWQiLCJlcnJvcnMiLCJzY3JpcHRzSWRzIiwicmVzIiwiX19pbXBvcnRTY3JpcHRzIiwibWFwIiwicyIsIm92ZXJXcml0ZVNjcmlwdElkIiwibGVuZ3RoIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsImUiLCJtZXNzYWdlIiwiZXJyb3IiLCJ1bmRlZmluZWQiLCJzY3JpcHRzTGlzdCIsImxhc3RQb3NpdGlvbiIsIk1hdGgiLCJtYXgiLCJwb3NpdGlvbiIsInNjcmVlbnMiLCJkaWFnbm9zZXMiLCJ1cGRhdGVTY3JpcHQiLCJxdWVyeSIsImZpbmRGaXJzdCIsIndoZXJlIiwid2l0aCIsImRyYWZ0IiwidXBkYXRlU2NyaXB0RHJhZnQiLCJzY3JpcHREcmFmdElkIiwic2NyaXB0RHJhZnREYXRhIiwidmVyc2lvbiIsInVwZGF0ZSIsInNldCIsImluc2VydCIsInZhbHVlcyIsInJlc3RvcmVLZXkiLCJkZWxldGUiLCJzY3JlZW4iLCJzY3JlZW5EcmFmdERhdGEiLCJzY3JlZW5EcmFmdElkIiwic2NyZWVuSWQiLCJ0eXBlIiwicHVzaCIsInRpdGxlIiwiZGlhZ25vc2lzIiwiZGlhZ25vc2lzRHJhZnREYXRhIiwiZGlhZ25vc2lzRHJhZnRJZCIsImRpYWdub3Npc0lkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/_import-scripts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/_restore-diagnoses.ts":
/*!************************************************************!*\
  !*** ./databases/mutations/_scripts/_restore-diagnoses.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _restoreDiagnoses: () => (/* binding */ _restoreDiagnoses)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\n\nasync function _restoreDiagnoses({ restoreKeys }, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        const histories = !restoreKeys.length ? [] : await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.diagnosesHistory.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory.restoreKey, restoreKeys),\n            columns: {\n                id: true,\n                diagnosisId: true\n            }\n        });\n        const diagnosesIds = histories.map((s)=>s.diagnosisId);\n        if (diagnosesIds.length) {\n            await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].update(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses).set({\n                deletedAt: null\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, diagnosesIds));\n            await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory.id, histories.map((s)=>s.id)));\n        }\n        if (!response.errors?.length) {\n            response.success = true;\n            if (diagnosesIds.length && opts?.broadcastAction) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_2__[\"default\"].emit(\"data_changed\", \"update_diagnoses\");\n            }\n        }\n    } catch (e) {\n        response.success = false;\n        response.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_restoreDiagnoses ERROR\", e.message);\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19yZXN0b3JlLWRpYWdub3Nlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBc0M7QUFFRTtBQUNOO0FBQ0M7QUFDaUM7QUFFN0QsZUFBZU0sa0JBQ2xCLEVBQUVDLFdBQVcsRUFFWixFQUNEQyxJQUVDO0lBRUQsTUFBTUMsV0FHRjtRQUFFQyxTQUFTO0lBQU87SUFFdEIsSUFBSTtRQUNBLE1BQU1DLFlBQVksQ0FBQ0osWUFBWUssTUFBTSxHQUFHLEVBQUUsR0FBRyxNQUFNWCw2REFBRUEsQ0FBQ1ksS0FBSyxDQUFDUixnQkFBZ0IsQ0FBQ1MsUUFBUSxDQUFDO1lBQ2xGQyxPQUFPZixvREFBT0EsQ0FBQ0ssa0VBQWdCQSxDQUFDVyxVQUFVLEVBQUVUO1lBQzVDVSxTQUFTO2dCQUNMQyxJQUFJO2dCQUNKQyxhQUFhO1lBQ2pCO1FBQ0o7UUFDQSxNQUFNQyxlQUFlVCxVQUFVVSxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUVILFdBQVc7UUFDckQsSUFBSUMsYUFBYVIsTUFBTSxFQUFFO1lBQ3JCLE1BQU1YLDZEQUFFQSxDQUFDc0IsTUFBTSxDQUFDbkIsMkRBQVNBLEVBQUVvQixHQUFHLENBQUM7Z0JBQUVDLFdBQVc7WUFBSyxHQUFHVixLQUFLLENBQUNmLG9EQUFPQSxDQUFDSSwyREFBU0EsQ0FBQ2UsV0FBVyxFQUFFQztZQUN6RixNQUFNbkIsNkRBQUVBLENBQUN5QixNQUFNLENBQUNyQixrRUFBZ0JBLEVBQUVVLEtBQUssQ0FBQ2Ysb0RBQU9BLENBQUNLLGtFQUFnQkEsQ0FBQ2EsRUFBRSxFQUFFUCxVQUFVVSxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUVKLEVBQUU7UUFDaEc7UUFFQSxJQUFJLENBQUNULFNBQVNrQixNQUFNLEVBQUVmLFFBQVE7WUFDMUJILFNBQVNDLE9BQU8sR0FBRztZQUNuQixJQUFJVSxhQUFhUixNQUFNLElBQUlKLE1BQU1vQixpQkFBaUI7Z0JBQUEsSUFBSXBCLE1BQU1vQixpQkFBaUJ6QixtREFBTUEsQ0FBQzBCLElBQUksQ0FBQyxnQkFBZ0I7WUFBbUI7UUFDaEk7SUFDSixFQUFFLE9BQU1DLEdBQVE7UUFDWnJCLFNBQVNDLE9BQU8sR0FBRztRQUNuQkQsU0FBU2tCLE1BQU0sR0FBRztZQUFDRyxFQUFFQyxPQUFPO1NBQUM7UUFDN0I3QixtREFBTUEsQ0FBQzhCLEtBQUssQ0FBQywyQkFBMkJGLEVBQUVDLE9BQU87SUFDckQsU0FBVTtRQUNOLE9BQU90QjtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9tdXRhdGlvbnMvX3NjcmlwdHMvX3Jlc3RvcmUtZGlhZ25vc2VzLnRzPzA3NjYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5BcnJheSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcblxuaW1wb3J0IGRiIGZyb20gJ0AvZGF0YWJhc2VzL3BnL2RyaXp6bGUnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHNvY2tldCAgZnJvbSAnQC9saWIvc29ja2V0JztcbmltcG9ydCB7IGRpYWdub3NlcywgZGlhZ25vc2VzSGlzdG9yeSB9IGZyb20gJ0AvZGF0YWJhc2VzL3BnL3NjaGVtYSc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfcmVzdG9yZURpYWdub3NlcyhcbiAgICB7IHJlc3RvcmVLZXlzIH06IHtcbiAgICAgICAgcmVzdG9yZUtleXM6IHN0cmluZ1tdO1xuICAgIH0sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXNwb25zZTogeyBcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjsgXG4gICAgICAgIGVycm9ycz86IHN0cmluZ1tdOyBcbiAgICB9ID0geyBzdWNjZXNzOiBmYWxzZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGhpc3RvcmllcyA9ICFyZXN0b3JlS2V5cy5sZW5ndGggPyBbXSA6IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlc0hpc3RvcnkuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoZGlhZ25vc2VzSGlzdG9yeS5yZXN0b3JlS2V5LCByZXN0b3JlS2V5cyksXG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZGlhZ25vc2lzSWQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZGlhZ25vc2VzSWRzID0gaGlzdG9yaWVzLm1hcChzID0+IHMuZGlhZ25vc2lzSWQpO1xuICAgICAgICBpZiAoZGlhZ25vc2VzSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgZGIudXBkYXRlKGRpYWdub3Nlcykuc2V0KHsgZGVsZXRlZEF0OiBudWxsIH0pLndoZXJlKGluQXJyYXkoZGlhZ25vc2VzLmRpYWdub3Npc0lkLCBkaWFnbm9zZXNJZHMpKTtcbiAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShkaWFnbm9zZXNIaXN0b3J5KS53aGVyZShpbkFycmF5KGRpYWdub3Nlc0hpc3RvcnkuaWQsIGhpc3Rvcmllcy5tYXAocyA9PiBzLmlkKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcnM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBpZiAoZGlhZ25vc2VzSWRzLmxlbmd0aCAmJiBvcHRzPy5icm9hZGNhc3RBY3Rpb24pIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAndXBkYXRlX2RpYWdub3NlcycpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXNwb25zZS5lcnJvcnMgPSBbZS5tZXNzYWdlXTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfcmVzdG9yZURpYWdub3NlcyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJpbkFycmF5IiwiZGIiLCJsb2dnZXIiLCJzb2NrZXQiLCJkaWFnbm9zZXMiLCJkaWFnbm9zZXNIaXN0b3J5IiwiX3Jlc3RvcmVEaWFnbm9zZXMiLCJyZXN0b3JlS2V5cyIsIm9wdHMiLCJyZXNwb25zZSIsInN1Y2Nlc3MiLCJoaXN0b3JpZXMiLCJsZW5ndGgiLCJxdWVyeSIsImZpbmRNYW55Iiwid2hlcmUiLCJyZXN0b3JlS2V5IiwiY29sdW1ucyIsImlkIiwiZGlhZ25vc2lzSWQiLCJkaWFnbm9zZXNJZHMiLCJtYXAiLCJzIiwidXBkYXRlIiwic2V0IiwiZGVsZXRlZEF0IiwiZGVsZXRlIiwiZXJyb3JzIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsImUiLCJtZXNzYWdlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/_restore-diagnoses.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/_restore-screens.ts":
/*!**********************************************************!*\
  !*** ./databases/mutations/_scripts/_restore-screens.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _restoreScreens: () => (/* binding */ _restoreScreens)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\n\nasync function _restoreScreens({ restoreKeys }, opts) {\n    const response = {\n        success: false\n    };\n    try {\n        const histories = !restoreKeys.length ? [] : await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensHistory.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory.restoreKey, restoreKeys),\n            columns: {\n                id: true,\n                screenId: true\n            }\n        });\n        const screensIds = histories.map((s)=>s.screenId);\n        if (screensIds.length) {\n            await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens).set({\n                deletedAt: null\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, screensIds));\n            await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory.id, histories.map((s)=>s.id)));\n        }\n        if (!response.errors?.length) {\n            response.success = true;\n            if (screensIds.length && opts?.broadcastAction) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_screens\");\n            }\n        }\n    } catch (e) {\n        response.success = false;\n        response.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_restoreScreens ERROR\", e.message);\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19yZXN0b3JlLXNjcmVlbnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXNDO0FBRUg7QUFDSztBQUNOO0FBQzhCO0FBRXpELGVBQWVNLGdCQUNsQixFQUFFQyxXQUFXLEVBRVosRUFDREMsSUFFQztJQUVELE1BQU1DLFdBR0Y7UUFBRUMsU0FBUztJQUFPO0lBRXRCLElBQUk7UUFDQSxNQUFNQyxZQUFZLENBQUNKLFlBQVlLLE1BQU0sR0FBRyxFQUFFLEdBQUcsTUFBTVYsNkRBQUVBLENBQUNXLEtBQUssQ0FBQ1IsY0FBYyxDQUFDUyxRQUFRLENBQUM7WUFDaEZDLE9BQU9mLG9EQUFPQSxDQUFDSyxnRUFBY0EsQ0FBQ1csVUFBVSxFQUFFVDtZQUMxQ1UsU0FBUztnQkFDTEMsSUFBSTtnQkFDSkMsVUFBVTtZQUNkO1FBQ0o7UUFDQSxNQUFNQyxhQUFhVCxVQUFVVSxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUVILFFBQVE7UUFDaEQsSUFBSUMsV0FBV1IsTUFBTSxFQUFFO1lBQ25CLE1BQU1WLDZEQUFFQSxDQUFDcUIsTUFBTSxDQUFDbkIseURBQU9BLEVBQUVvQixHQUFHLENBQUM7Z0JBQUVDLFdBQVc7WUFBSyxHQUFHVixLQUFLLENBQUNmLG9EQUFPQSxDQUFDSSx5REFBT0EsQ0FBQ2UsUUFBUSxFQUFFQztZQUNsRixNQUFNbEIsNkRBQUVBLENBQUN3QixNQUFNLENBQUNyQixnRUFBY0EsRUFBRVUsS0FBSyxDQUFDZixvREFBT0EsQ0FBQ0ssZ0VBQWNBLENBQUNhLEVBQUUsRUFBRVAsVUFBVVUsR0FBRyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFSixFQUFFO1FBQzVGO1FBRUEsSUFBSSxDQUFDVCxTQUFTa0IsTUFBTSxFQUFFZixRQUFRO1lBQzFCSCxTQUFTQyxPQUFPLEdBQUc7WUFDbkIsSUFBSVUsV0FBV1IsTUFBTSxJQUFJSixNQUFNb0IsaUJBQWlCO2dCQUFBLElBQUlwQixNQUFNb0IsaUJBQWlCM0IsbURBQU1BLENBQUM0QixJQUFJLENBQUMsZ0JBQWdCO1lBQWlCO1FBQzVIO0lBQ0osRUFBRSxPQUFNQyxHQUFRO1FBQ1pyQixTQUFTQyxPQUFPLEdBQUc7UUFDbkJELFNBQVNrQixNQUFNLEdBQUc7WUFBQ0csRUFBRUMsT0FBTztTQUFDO1FBQzdCNUIsbURBQU1BLENBQUM2QixLQUFLLENBQUMseUJBQXlCRixFQUFFQyxPQUFPO0lBQ25ELFNBQVU7UUFDTixPQUFPdEI7SUFDWDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL19yZXN0b3JlLXNjcmVlbnMudHM/ZWUyZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbkFycmF5IH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuXG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGRiIGZyb20gJ0AvZGF0YWJhc2VzL3BnL2RyaXp6bGUnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgc2NyZWVucywgc2NyZWVuc0hpc3RvcnkgfSBmcm9tICdAL2RhdGFiYXNlcy9wZy9zY2hlbWEnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX3Jlc3RvcmVTY3JlZW5zKFxuICAgIHsgcmVzdG9yZUtleXMgfToge1xuICAgICAgICByZXN0b3JlS2V5czogc3RyaW5nW107XG4gICAgfSxcbiAgICBvcHRzPzoge1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlc3BvbnNlOiB7IFxuICAgICAgICBzdWNjZXNzOiBib29sZWFuOyBcbiAgICAgICAgZXJyb3JzPzogc3RyaW5nW107IFxuICAgIH0gPSB7IHN1Y2Nlc3M6IGZhbHNlLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaGlzdG9yaWVzID0gIXJlc3RvcmVLZXlzLmxlbmd0aCA/IFtdIDogYXdhaXQgZGIucXVlcnkuc2NyZWVuc0hpc3RvcnkuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoc2NyZWVuc0hpc3RvcnkucmVzdG9yZUtleSwgcmVzdG9yZUtleXMpLFxuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjcmVlbklkOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNjcmVlbnNJZHMgPSBoaXN0b3JpZXMubWFwKHMgPT4gcy5zY3JlZW5JZCk7XG4gICAgICAgIGlmIChzY3JlZW5zSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgZGIudXBkYXRlKHNjcmVlbnMpLnNldCh7IGRlbGV0ZWRBdDogbnVsbCB9KS53aGVyZShpbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIHNjcmVlbnNJZHMpKTtcbiAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JlZW5zSGlzdG9yeSkud2hlcmUoaW5BcnJheShzY3JlZW5zSGlzdG9yeS5pZCwgaGlzdG9yaWVzLm1hcChzID0+IHMuaWQpKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXJlc3BvbnNlLmVycm9ycz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXNwb25zZS5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChzY3JlZW5zSWRzLmxlbmd0aCAmJiBvcHRzPy5icm9hZGNhc3RBY3Rpb24pIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAndXBkYXRlX3NjcmVlbnMnKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzcG9uc2UuZXJyb3JzID0gW2UubWVzc2FnZV07XG4gICAgICAgIGxvZ2dlci5lcnJvcignX3Jlc3RvcmVTY3JlZW5zIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImluQXJyYXkiLCJzb2NrZXQiLCJkYiIsImxvZ2dlciIsInNjcmVlbnMiLCJzY3JlZW5zSGlzdG9yeSIsIl9yZXN0b3JlU2NyZWVucyIsInJlc3RvcmVLZXlzIiwib3B0cyIsInJlc3BvbnNlIiwic3VjY2VzcyIsImhpc3RvcmllcyIsImxlbmd0aCIsInF1ZXJ5IiwiZmluZE1hbnkiLCJ3aGVyZSIsInJlc3RvcmVLZXkiLCJjb2x1bW5zIiwiaWQiLCJzY3JlZW5JZCIsInNjcmVlbnNJZHMiLCJtYXAiLCJzIiwidXBkYXRlIiwic2V0IiwiZGVsZXRlZEF0IiwiZGVsZXRlIiwiZXJyb3JzIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsImUiLCJtZXNzYWdlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/_restore-screens.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/_scripts/index.ts":
/*!***********************************************!*\
  !*** ./databases/mutations/_scripts/index.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __importScripts: () => (/* reexport safe */ _import_scripts__WEBPACK_IMPORTED_MODULE_8__.__importScripts),\n/* harmony export */   _createScripts: () => (/* binding */ _createScripts),\n/* harmony export */   _deleteDiagnoses: () => (/* reexport safe */ _delete_diagnoses__WEBPACK_IMPORTED_MODULE_10__._deleteDiagnoses),\n/* harmony export */   _deleteScreens: () => (/* reexport safe */ _delete_screens__WEBPACK_IMPORTED_MODULE_9__._deleteScreens),\n/* harmony export */   _deleteScripts: () => (/* binding */ _deleteScripts),\n/* harmony export */   _importScripts: () => (/* reexport safe */ _import_scripts__WEBPACK_IMPORTED_MODULE_8__._importScripts),\n/* harmony export */   _publishScripts: () => (/* binding */ _publishScripts),\n/* harmony export */   _restoreDiagnoses: () => (/* reexport safe */ _restore_diagnoses__WEBPACK_IMPORTED_MODULE_11__._restoreDiagnoses),\n/* harmony export */   _restoreScreens: () => (/* reexport safe */ _restore_screens__WEBPACK_IMPORTED_MODULE_6__._restoreScreens),\n/* harmony export */   _saveScriptsHistory: () => (/* binding */ _saveScriptsHistory),\n/* harmony export */   _updateScripts: () => (/* binding */ _updateScripts),\n/* harmony export */   _updateScriptsWithoutPublishing: () => (/* binding */ _updateScriptsWithoutPublishing)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_scripts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../queries/_scripts */ \"(rsc)/./databases/queries/_scripts/index.ts\");\n/* harmony import */ var _screens__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../screens */ \"(rsc)/./databases/mutations/screens.ts\");\n/* harmony import */ var _restore_screens__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./_restore-screens */ \"(rsc)/./databases/mutations/_scripts/_restore-screens.ts\");\n/* harmony import */ var _diagnoses__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../diagnoses */ \"(rsc)/./databases/mutations/diagnoses.ts\");\n/* harmony import */ var _import_scripts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./_import-scripts */ \"(rsc)/./databases/mutations/_scripts/_import-scripts.ts\");\n/* harmony import */ var _delete_screens__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./_delete-screens */ \"(rsc)/./databases/mutations/_scripts/_delete-screens.ts\");\n/* harmony import */ var _delete_diagnoses__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./_delete-diagnoses */ \"(rsc)/./databases/mutations/_scripts/_delete-diagnoses.ts\");\n/* harmony import */ var _restore_diagnoses__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./_restore-diagnoses */ \"(rsc)/./databases/mutations/_scripts/_restore-diagnoses.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nasync function _publishScripts() {\n    const results = {\n        success: true\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n            columns: {\n                scriptDraftId: true,\n                scriptId: true\n            }\n        });\n        const insertData = drafts.filter((c)=>!c.scriptId).map((s)=>({\n                scriptDraftId: s.scriptDraftId\n            }));\n        const updateData = drafts.filter((c)=>c.scriptId).map((c)=>({\n                scriptId: c.scriptId\n            }));\n        const errors = [];\n        if (updateData.length) {\n            const res = await _updateScripts(updateData);\n            res.data.forEach((c)=>c.errors?.forEach((e)=>errors.push(e)));\n            res.errors?.forEach((e)=>errors.push(e));\n        }\n        if (insertData.length) {\n            const res = await _createScripts(insertData);\n            res.errors?.forEach((e)=>errors.push(e));\n        }\n        if (errors.length) {\n            results.success = false;\n            results.errors = errors;\n        }\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_publishScripts ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _deleteScripts(scriptsIds, opts) {\n    if (scriptsIds.length) {\n        const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, scriptsIds);\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n            where\n        });\n        const deletedAt = new Date();\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts).set({\n            deletedAt\n        }).where(where);\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId, scriptsIds)));\n        if (scriptsIds.length) {\n            await (0,_restore_screens__WEBPACK_IMPORTED_MODULE_6__._restoreScreens)({\n                restoreKeys: scriptsIds.map((id)=>`script_draft_${id}`)\n            });\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).set({\n                restoreKey: null\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory.restoreKey, scriptsIds.map((sId)=>`script_draft_${sId}`)));\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsHistory).values(items.map((item)=>({\n                version: item.version,\n                scriptId: item.scriptId,\n                changes: {\n                    action: \"delete_script\",\n                    description: \"Delete script\",\n                    oldValues: [\n                        {\n                            deletedAt: null\n                        }\n                    ],\n                    newValues: [\n                        {\n                            deletedAt\n                        }\n                    ]\n                }\n            })));\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_scripts\");\n    }\n    return true;\n}\nasync function _updateScriptsWithoutPublishing(payload, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const scriptsReferences = payload.map((s)=>s.scriptId).filter((s)=>s);\n        const whereScript = !scriptsReferences.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptDraftId, scriptsReferences));\n        if (whereScript) {\n            const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n                where: whereScript\n            });\n            let publishedScripts = [];\n            if (scriptsReferences.length) {\n                publishedScripts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.and)(...[\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt),\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, scriptsReferences),\n                        ...drafts.filter((s)=>s.scriptId).length ? [\n                            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, drafts.map((s)=>s.scriptId))\n                        ] : []\n                    ]),\n                    orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_13__.asc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.position)\n                });\n            }\n            const newDrafts = [];\n            let updatedDrafts = 0;\n            for (const { scriptId, data } of payload){\n                const draft = drafts.filter((s)=>s.data.scriptId === scriptId)[0];\n                const publishedScript = publishedScripts.filter((s)=>s.scriptId === scriptId)[0];\n                if (draft) {\n                    await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts).set({\n                        data: {\n                            ...draft.data,\n                            ...data\n                        }\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.id, draft.id));\n                    updatedDrafts++;\n                } else if (publishedScript) {\n                    newDrafts.push({\n                        position: data.position,\n                        scriptId: publishedScript.scriptId,\n                        scriptDraftId: publishedScript.scriptId,\n                        data: {\n                            ...publishedScript,\n                            ...data,\n                            version: data.version || publishedScript.version + 1\n                        }\n                    });\n                }\n            }\n            if (newDrafts.length) {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts).values(newDrafts);\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_scripts_drafts\");\n            }\n            if (opts?.broadcastAction && updatedDrafts) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_scripts_drafts\");\n            }\n        }\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_orderScripts ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _createScripts(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const insertData = [];\n        let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptDraftId, data.map((c)=>c.scriptDraftId))\n        });\n        // we'll use data before to compare changes\n        let dataBefore = [];\n        if (drafts.filter((c)=>c.scriptId).length) {\n            dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, drafts.filter((c)=>c.scriptId).map((c)=>c.scriptId))\n            });\n        }\n        for (const { id, data } of drafts){\n            const scriptId = data.scriptId || (0,uuid__WEBPACK_IMPORTED_MODULE_14__[\"default\"])();\n            insertData.push({\n                ...data,\n                scriptId\n            });\n            drafts = drafts.map((d)=>{\n                if (d.id === id) d.data.scriptId = scriptId;\n                return d;\n            });\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts).values(insertData);\n        const inserted = await (0,_queries_scripts__WEBPACK_IMPORTED_MODULE_4__._getScripts)({\n            scriptIds: insertData.map((c)=>c.scriptId)\n        });\n        for (const { scriptId } of inserted.data){\n            const draft = drafts.filter((s)=>s.data.scriptId === scriptId)[0];\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).set({\n                scriptId\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptDraftId, draft.scriptDraftId));\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).set({\n                scriptId\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptDraftId, draft.scriptDraftId));\n        }\n        const publishScreens = await (0,_screens__WEBPACK_IMPORTED_MODULE_5__._publishScreens)({\n            scriptsReferences: data.map((s)=>s.scriptDraftId)\n        });\n        if (publishScreens.errors) results.errors = [\n            ...results.errors || [],\n            ...publishScreens.errors\n        ];\n        const publishDiagnoses = await (0,_diagnoses__WEBPACK_IMPORTED_MODULE_7__._publishDiagnoses)({\n            scriptsReferences: data.map((s)=>s.scriptDraftId)\n        });\n        if (publishDiagnoses.errors) results.errors = [\n            ...results.errors || [],\n            ...publishDiagnoses.errors\n        ];\n        results.inserted = opts?.returnInserted ? inserted.data : [];\n        results.success = true;\n        await _saveScriptsHistory({\n            drafts,\n            previous: dataBefore\n        });\n        if (drafts.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.id, drafts.map((d)=>d.id)));\n            if (drafts.length) {\n                await (0,_restore_screens__WEBPACK_IMPORTED_MODULE_6__._restoreScreens)({\n                    restoreKeys: drafts.map((d)=>`script_draft_${d.scriptDraftId}`)\n                });\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).set({\n                    restoreKey: null\n                }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory.restoreKey, drafts.map((s)=>`script_draft_${s.scriptDraftId}`)));\n            }\n        }\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_scripts\");\n    } catch (e) {\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_createScripts ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _updateScripts(data, opts) {\n    const results = {\n        data: []\n    };\n    try {\n        let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId, data.map((c)=>c.scriptId))\n        });\n        // we'll use data before to compare changes\n        let dataBefore = [];\n        if (drafts.filter((c)=>c.scriptId).length) {\n            dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, drafts.filter((c)=>c.scriptId).map((c)=>c.scriptId))\n            });\n        }\n        for (const { scriptId: _scriptId, data: c } of drafts){\n            const scriptId = _scriptId;\n            const { scriptId: __scriptId, id, oldScriptId, createdAt, updatedAt, deletedAt, ...payload } = c;\n            try {\n                const updates = {\n                    ...payload,\n                    publishDate: new Date()\n                };\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts).set(updates).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, scriptId));\n                const script = !opts?.returnUpdated ? undefined : await (0,_queries_scripts__WEBPACK_IMPORTED_MODULE_4__._getScript)(scriptId);\n                results.data.push({\n                    scriptId,\n                    script\n                });\n            } catch (e) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(`_updateScripts scriptId=${scriptId}`, e.message);\n                results.data.push({\n                    scriptId,\n                    errors: [\n                        e.message\n                    ]\n                });\n                drafts = drafts.filter((c)=>c.data.scriptId !== scriptId);\n            }\n        }\n        await _saveScriptsHistory({\n            drafts: drafts,\n            previous: dataBefore\n        });\n        const publishScreens = await (0,_screens__WEBPACK_IMPORTED_MODULE_5__._publishScreens)({\n            scriptsReferences: data.map((s)=>s.scriptId)\n        });\n        if (publishScreens.errors) results.errors = [\n            ...results.errors || [],\n            ...publishScreens.errors\n        ];\n        if (drafts.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.id, drafts.map((d)=>d.id)));\n            if (drafts.length) {\n                await (0,_restore_screens__WEBPACK_IMPORTED_MODULE_6__._restoreScreens)({\n                    restoreKeys: drafts.map((d)=>`script_draft_${d.scriptDraftId}`)\n                });\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).set({\n                    restoreKey: null\n                }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory.restoreKey, drafts.map((s)=>`script_draft_${s.scriptDraftId}`)));\n            }\n        }\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_scripts\");\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_updateScripts ERROR\", e);\n        results.errors = [\n            e.message,\n            ...results.errors || []\n        ];\n    } finally{\n        return results;\n    }\n}\nasync function _saveScriptsHistory({ previous, drafts }) {\n    try {\n        const insertData = [];\n        for (const c of drafts){\n            const changeHistoryData = {\n                version: c?.data?.version || 1,\n                scriptId: c?.data?.scriptId,\n                changes: {}\n            };\n            if (c?.data?.version === 1) {\n                changeHistoryData.changes = {\n                    action: \"create_script\",\n                    description: \"Create script\",\n                    oldValues: [],\n                    newValues: []\n                };\n            } else {\n                const prev = previous.filter((prevC)=>prevC.scriptId === c?.data?.scriptId)[0];\n                const oldValues = [];\n                const newValues = [];\n                Object.keys({\n                    ...c?.data\n                }).filter((key)=>![\n                        \"version\",\n                        \"draft\"\n                    ].includes(key)).forEach((_key)=>{\n                    const key = _key;\n                    const newValue = c.data[key];\n                    const oldValue = {\n                        ...prev\n                    }[key];\n                    if (JSON.stringify(newValue) !== JSON.stringify(oldValue)) {\n                        oldValues.push({\n                            [key]: oldValue\n                        });\n                        newValues.push({\n                            [key]: newValue\n                        });\n                    }\n                });\n                changeHistoryData.changes = {\n                    action: \"update_script\",\n                    description: \"Update script\",\n                    oldValues,\n                    newValues\n                };\n            }\n            insertData.push(changeHistoryData);\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsHistory).values(insertData);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(e.message);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL19zY3JpcHRzL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF1RjtBQUM3RDtBQUVTO0FBQ0Q7QUFDQTtBQUN1RjtBQUN4RDtBQUNwQjtBQUNRO0FBQ0o7QUFFZjtBQUNBO0FBQ0U7QUFDRDtBQUNFO0FBRTlCLGVBQWV1QjtJQUNsQixNQUFNQyxVQUdGO1FBQUVDLFNBQVM7SUFBTTtJQUVyQixJQUFJO1FBQ0EsTUFBTUMsU0FBUyxNQUFNZixtREFBRUEsQ0FBQ2dCLEtBQUssQ0FBQ2IsYUFBYSxDQUFDYyxRQUFRLENBQUM7WUFDakRDLFNBQVM7Z0JBQ0xDLGVBQWU7Z0JBQ2ZDLFVBQVU7WUFDZDtRQUNKO1FBQ0EsTUFBTUMsYUFBYU4sT0FBT08sTUFBTSxDQUFDQyxDQUFBQSxJQUFLLENBQUNBLEVBQUVILFFBQVEsRUFBRUksR0FBRyxDQUFDQyxDQUFBQSxJQUFNO2dCQUFFTixlQUFlTSxFQUFFTixhQUFhO1lBQUU7UUFDL0YsTUFBTU8sYUFBYVgsT0FBT08sTUFBTSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFSCxRQUFRLEVBQUVJLEdBQUcsQ0FBQ0QsQ0FBQUEsSUFBTTtnQkFBRUgsVUFBVUcsRUFBRUgsUUFBUTtZQUFFO1FBRXBGLE1BQU1PLFNBQW1CLEVBQUU7UUFFM0IsSUFBSUQsV0FBV0UsTUFBTSxFQUFFO1lBQ25CLE1BQU1DLE1BQU0sTUFBTUMsZUFBZUo7WUFDakNHLElBQUlFLElBQUksQ0FBQ0MsT0FBTyxDQUFDVCxDQUFBQSxJQUFLQSxFQUFFSSxNQUFNLEVBQUVLLFFBQVFDLENBQUFBLElBQUtOLE9BQU9PLElBQUksQ0FBQ0Q7WUFDekRKLElBQUlGLE1BQU0sRUFBRUssUUFBUUMsQ0FBQUEsSUFBS04sT0FBT08sSUFBSSxDQUFDRDtRQUN6QztRQUVBLElBQUlaLFdBQVdPLE1BQU0sRUFBRTtZQUNuQixNQUFNQyxNQUFNLE1BQU1NLGVBQWVkO1lBQ2pD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QSxDQUFDc0MsS0FBSyxDQUFDSixFQUFFRyxPQUFPO0lBQzFCO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9tdXRhdGlvbnMvX3NjcmlwdHMvaW5kZXgudHM/OTYyMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbmQsIGFzYywgZXEsIGluQXJyYXksIGlzTm90TnVsbCwgaXNOdWxsLCBub3RJbkFycmF5LCBvciB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0IHsgdjQgfSBmcm9tIFwidXVpZFwiO1xuXG5pbXBvcnQgc29ja2V0ICBmcm9tICdAL2xpYi9zb2NrZXQnO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5pbXBvcnQgZGIgZnJvbSBcIi4uLy4uL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IHNjcmVlbnNEcmFmdHMsIHNjcmlwdHMsIHNjcmlwdHNEcmFmdHMsIHNjcmlwdHNIaXN0b3J5LCBzY3JlZW5zSGlzdG9yeSwgZGlhZ25vc2VzRHJhZnRzIH0gZnJvbSBcIi4uLy4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgX2dldFNjcmlwdCwgX2dldFNjcmlwdHMgfSBmcm9tICcuLi8uLi9xdWVyaWVzL19zY3JpcHRzJztcbmltcG9ydCB7IF9wdWJsaXNoU2NyZWVucyB9IGZyb20gXCIuLi9zY3JlZW5zXCI7XG5pbXBvcnQgeyBfcmVzdG9yZVNjcmVlbnMgfSBmcm9tIFwiLi9fcmVzdG9yZS1zY3JlZW5zXCI7XG5pbXBvcnQgeyBfcHVibGlzaERpYWdub3NlcyB9IGZyb20gXCIuLi9kaWFnbm9zZXNcIjtcblxuZXhwb3J0ICogZnJvbSAnLi9faW1wb3J0LXNjcmlwdHMnO1xuZXhwb3J0ICogZnJvbSAnLi9fZGVsZXRlLXNjcmVlbnMnO1xuZXhwb3J0ICogZnJvbSAnLi9fZGVsZXRlLWRpYWdub3Nlcyc7XG5leHBvcnQgKiBmcm9tICcuL19yZXN0b3JlLXNjcmVlbnMnO1xuZXhwb3J0ICogZnJvbSAnLi9fcmVzdG9yZS1kaWFnbm9zZXMnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX3B1Ymxpc2hTY3JpcHRzKCkge1xuICAgIGNvbnN0IHJlc3VsdHM6IHsgXG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW47IFxuICAgICAgICBlcnJvcnM/OiBzdHJpbmdbXTsgXG4gICAgfSA9IHsgc3VjY2VzczogdHJ1ZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YSA9IGRyYWZ0cy5maWx0ZXIoYyA9PiAhYy5zY3JpcHRJZCkubWFwKHMgPT4gKHsgc2NyaXB0RHJhZnRJZDogcy5zY3JpcHREcmFmdElkLCB9KSk7XG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSBkcmFmdHMuZmlsdGVyKGMgPT4gYy5zY3JpcHRJZCkubWFwKGMgPT4gKHsgc2NyaXB0SWQ6IGMuc2NyaXB0SWQhIH0pKTtcblxuICAgICAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaWYgKHVwZGF0ZURhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBfdXBkYXRlU2NyaXB0cyh1cGRhdGVEYXRhKTtcbiAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goYyA9PiBjLmVycm9ycz8uZm9yRWFjaChlID0+IGVycm9ycy5wdXNoKGUpKSk7XG4gICAgICAgICAgICByZXMuZXJyb3JzPy5mb3JFYWNoKGUgPT4gZXJyb3JzLnB1c2goZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydERhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBfY3JlYXRlU2NyaXB0cyhpbnNlcnREYXRhKTtcbiAgICAgICAgICAgIHJlcy5lcnJvcnM/LmZvckVhY2goZSA9PiBlcnJvcnMucHVzaChlKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICByZXN1bHRzLmVycm9ycyA9IGVycm9ycztcbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXN1bHRzLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19wdWJsaXNoU2NyaXB0cyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2RlbGV0ZVNjcmlwdHMoXG4gICAgc2NyaXB0c0lkczogc3RyaW5nW10sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9LFxuKSB7XG4gICAgaWYgKHNjcmlwdHNJZHMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHdoZXJlID0gaW5BcnJheShzY3JpcHRzLnNjcmlwdElkLCBzY3JpcHRzSWRzKTtcblxuICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgIC51cGRhdGUoc2NyaXB0cylcbiAgICAgICAgICAgIC5zZXQoeyBkZWxldGVkQXQsIH0pXG4gICAgICAgICAgICAud2hlcmUod2hlcmUpO1xuXG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JpcHRzRHJhZnRzKS53aGVyZShhbmQoXG4gICAgICAgICAgICBpc05vdE51bGwoc2NyaXB0c0RyYWZ0cy5zY3JpcHRJZCksXG4gICAgICAgICAgICBpbkFycmF5KHNjcmlwdHNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNJZHMpLFxuICAgICAgICApKTtcblxuICAgICAgICBpZiAoc2NyaXB0c0lkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGF3YWl0IF9yZXN0b3JlU2NyZWVucyh7IHJlc3RvcmVLZXlzOiBzY3JpcHRzSWRzLm1hcChpZCA9PiBgc2NyaXB0X2RyYWZ0XyR7aWR9YCksIH0pO1xuICAgICAgICAgICAgYXdhaXQgZGIudXBkYXRlKHNjcmVlbnNIaXN0b3J5KS5zZXQoeyByZXN0b3JlS2V5OiBudWxsLCB9KS53aGVyZShpbkFycmF5KHNjcmVlbnNIaXN0b3J5LnJlc3RvcmVLZXksIHNjcmlwdHNJZHMubWFwKHNJZCA9PiBgc2NyaXB0X2RyYWZ0XyR7c0lkfWApKSk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NyaXB0c0hpc3RvcnkpLnZhbHVlcyhpdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgdmVyc2lvbjogaXRlbS52ZXJzaW9uLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IGl0ZW0uc2NyaXB0SWQsXG4gICAgICAgICAgICBjaGFuZ2VzOiB7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlX3NjcmlwdCcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZWxldGUgc2NyaXB0JyxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZXM6IFt7IGRlbGV0ZWRBdDogbnVsbCwgfV0sXG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzOiBbeyBkZWxldGVkQXQgfV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSkpO1xuXG4gICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnZGVsZXRlX3NjcmlwdHMnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfdXBkYXRlU2NyaXB0c1dpdGhvdXRQdWJsaXNoaW5nKFxuICAgIHBheWxvYWQ6IHsgXG4gICAgICAgIHNjcmlwdElkOiBzdHJpbmc7XG4gICAgICAgIGRhdGE6IFBhcnRpYWw8dHlwZW9mIHNjcmlwdHNEcmFmdHMuJGluZmVySW5zZXJ0WydkYXRhJ10+OyAgXG4gICAgfVtdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfSxcbikge1xuICAgIGNvbnN0IHJlc3VsdHM6IHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmc7IGRhdGE/OiBhbnk7IH0gPSB7IHN1Y2Nlc3M6IHRydWUgfTsgXG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBzY3JpcHRzUmVmZXJlbmNlcyA9IHBheWxvYWQubWFwKHMgPT4gcy5zY3JpcHRJZCkuZmlsdGVyKHMgPT4gcyk7XG5cbiAgICAgICAgY29uc3Qgd2hlcmVTY3JpcHQgPSAhc2NyaXB0c1JlZmVyZW5jZXMubGVuZ3RoID8gdW5kZWZpbmVkIDogb3IoXG4gICAgICAgICAgICBpbkFycmF5KHNjcmlwdHNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgIGluQXJyYXkoc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHdoZXJlU2NyaXB0KSB7XG4gICAgICAgICAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogd2hlcmVTY3JpcHQsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHB1Ymxpc2hlZFNjcmlwdHM6IHR5cGVvZiBzY3JpcHRzLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgICAgICAgICBpZiAoc2NyaXB0c1JlZmVyZW5jZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcHVibGlzaGVkU2NyaXB0cyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogYW5kKC4uLltcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCksXG4gICAgICAgICAgICAgICAgICAgICAgICBpbkFycmF5KHNjcmlwdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLihkcmFmdHMuZmlsdGVyKHMgPT4gcy5zY3JpcHRJZCkubGVuZ3RoID8gW25vdEluQXJyYXkoc2NyaXB0cy5zY3JpcHRJZCwgZHJhZnRzLm1hcChzID0+IHMuc2NyaXB0SWQhKSldIDogW10pLFxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogYXNjKHNjcmlwdHMucG9zaXRpb24pLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBuZXdEcmFmdHM6IHR5cGVvZiBzY3JpcHRzRHJhZnRzLiRpbmZlckluc2VydFtdID0gW107XG4gICAgICAgICAgICBsZXQgdXBkYXRlZERyYWZ0cyA9IDA7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgeyBzY3JpcHRJZCwgZGF0YSB9IG9mIHBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkcmFmdCA9IGRyYWZ0cy5maWx0ZXIocyA9PiBzLmRhdGEuc2NyaXB0SWQgPT09IHNjcmlwdElkKVswXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwdWJsaXNoZWRTY3JpcHQgPSBwdWJsaXNoZWRTY3JpcHRzLmZpbHRlcihzID0+IHMuc2NyaXB0SWQgPT09IHNjcmlwdElkKVswXTtcblxuICAgICAgICAgICAgICAgIGlmIChkcmFmdCkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBkYi51cGRhdGUoc2NyaXB0c0RyYWZ0cykuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5kcmFmdC5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KS53aGVyZShlcShzY3JpcHRzRHJhZnRzLmlkLCBkcmFmdC5pZCkpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkRHJhZnRzKys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwdWJsaXNoZWRTY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RHJhZnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGRhdGEucG9zaXRpb24hLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHB1Ymxpc2hlZFNjcmlwdC5zY3JpcHRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHB1Ymxpc2hlZFNjcmlwdC5zY3JpcHRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5wdWJsaXNoZWRTY3JpcHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkYXRhLnZlcnNpb24gfHwgKHB1Ymxpc2hlZFNjcmlwdC52ZXJzaW9uICsgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGFzIHR5cGVvZiBuZXdEcmFmdHNbMF1bJ2RhdGEnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3RHJhZnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JpcHRzRHJhZnRzKS52YWx1ZXMobmV3RHJhZnRzKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JpcHRzX2RyYWZ0cycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uICYmIHVwZGF0ZWREcmFmdHMpIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAndXBkYXRlX3NjcmlwdHNfZHJhZnRzJyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzdWx0cy5lcnJvciA9IGUubWVzc2FnZTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfb3JkZXJTY3JpcHRzIEVSUk9SJywgZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NyZWF0ZVNjcmlwdHMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgc2NyaXB0RHJhZnRJZDogc3RyaW5nO1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVybkluc2VydGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9LFxuKSB7XG4gICAgbGV0IHJlc3VsdHM6IHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgZXJyb3JzPzogc3RyaW5nW107XG4gICAgICAgIGluc2VydGVkOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXRTY3JpcHRzPj5bJ2RhdGEnXTtcbiAgICB9ID0geyBpbnNlcnRlZDogW10sIHN1Y2Nlc3M6IGZhbHNlLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIHNjcmlwdHMuJGluZmVySW5zZXJ0W10gPSBbXTtcblxuICAgICAgICBsZXQgZHJhZnRzID0gIWRhdGEubGVuZ3RoID8gW10gOiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiBpbkFycmF5KHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgZGF0YS5tYXAoYyA9PiBjLnNjcmlwdERyYWZ0SWQpKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gd2UnbGwgdXNlIGRhdGEgYmVmb3JlIHRvIGNvbXBhcmUgY2hhbmdlc1xuICAgICAgICBsZXQgZGF0YUJlZm9yZTogdHlwZW9mIHNjcmlwdHMuJGluZmVyU2VsZWN0W10gPSBbXTtcbiAgICAgICAgaWYgKGRyYWZ0cy5maWx0ZXIoYyA9PiBjLnNjcmlwdElkKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRhdGFCZWZvcmUgPSBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogaW5BcnJheShzY3JpcHRzLnNjcmlwdElkLCBkcmFmdHMuZmlsdGVyKGMgPT4gYy5zY3JpcHRJZCkubWFwKGMgPT4gYy5zY3JpcHRJZCEpKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvcihjb25zdCB7IGlkLCBkYXRhIH0gb2YgZHJhZnRzKSB7XG4gICAgICAgICAgICBjb25zdCBzY3JpcHRJZCA9IGRhdGEuc2NyaXB0SWQgfHwgdjQoKTtcbiAgICAgICAgICAgIGluc2VydERhdGEucHVzaCh7IC4uLmRhdGEsIHNjcmlwdElkLCB9KTtcbiAgICAgICAgICAgIGRyYWZ0cyA9IGRyYWZ0cy5tYXAoZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGQuaWQgPT09IGlkKSBkLmRhdGEuc2NyaXB0SWQgPSBzY3JpcHRJZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjcmlwdHMpLnZhbHVlcyhpbnNlcnREYXRhKTtcblxuICAgICAgICBjb25zdCBpbnNlcnRlZCA9IGF3YWl0IF9nZXRTY3JpcHRzKHsgc2NyaXB0SWRzOiBpbnNlcnREYXRhLm1hcChjID0+IGMuc2NyaXB0SWQhKSwgfSk7XG5cbiAgICAgICAgZm9yKGNvbnN0IHsgc2NyaXB0SWQgfSBvZiBpbnNlcnRlZC5kYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBkcmFmdCA9IGRyYWZ0cy5maWx0ZXIocyA9PiBzLmRhdGEuc2NyaXB0SWQgPT09IHNjcmlwdElkKVswXTtcbiAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShzY3JlZW5zRHJhZnRzKS5zZXQoeyBzY3JpcHRJZCB9KS53aGVyZShlcShzY3JlZW5zRHJhZnRzLnNjcmlwdERyYWZ0SWQsIGRyYWZ0LnNjcmlwdERyYWZ0SWQpKTtcbiAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShkaWFnbm9zZXNEcmFmdHMpLnNldCh7IHNjcmlwdElkIH0pLndoZXJlKGVxKGRpYWdub3Nlc0RyYWZ0cy5zY3JpcHREcmFmdElkLCBkcmFmdC5zY3JpcHREcmFmdElkKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwdWJsaXNoU2NyZWVucyA9IGF3YWl0IF9wdWJsaXNoU2NyZWVucyh7IHNjcmlwdHNSZWZlcmVuY2VzOiBkYXRhLm1hcChzID0+IHMuc2NyaXB0RHJhZnRJZCksIH0pO1xuICAgICAgICBpZiAocHVibGlzaFNjcmVlbnMuZXJyb3JzKSByZXN1bHRzLmVycm9ycyA9IFsuLi4ocmVzdWx0cy5lcnJvcnMgfHwgW10pLCAuLi5wdWJsaXNoU2NyZWVucy5lcnJvcnNdO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hEaWFnbm9zZXMgPSBhd2FpdCBfcHVibGlzaERpYWdub3Nlcyh7IHNjcmlwdHNSZWZlcmVuY2VzOiBkYXRhLm1hcChzID0+IHMuc2NyaXB0RHJhZnRJZCksIH0pO1xuICAgICAgICBpZiAocHVibGlzaERpYWdub3Nlcy5lcnJvcnMpIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIC4uLnB1Ymxpc2hEaWFnbm9zZXMuZXJyb3JzXTtcblxuICAgICAgICByZXN1bHRzLmluc2VydGVkID0gb3B0cz8ucmV0dXJuSW5zZXJ0ZWQgPyBpbnNlcnRlZC5kYXRhIDogW107XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IHRydWU7XG5cbiAgICAgICAgYXdhaXQgX3NhdmVTY3JpcHRzSGlzdG9yeSh7IGRyYWZ0cywgcHJldmlvdXM6IGRhdGFCZWZvcmUsIH0pO1xuXG4gICAgICAgIGlmIChkcmFmdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBhd2FpdCBkYi5kZWxldGUoc2NyaXB0c0RyYWZ0cykud2hlcmUoaW5BcnJheShzY3JpcHRzRHJhZnRzLmlkLCBkcmFmdHMubWFwKGQgPT4gZC5pZCkpKTtcbiAgICAgICAgICAgIGlmIChkcmFmdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgX3Jlc3RvcmVTY3JlZW5zKHsgcmVzdG9yZUtleXM6IGRyYWZ0cy5tYXAoZCA9PiBgc2NyaXB0X2RyYWZ0XyR7ZC5zY3JpcHREcmFmdElkfWApLCB9KTtcbiAgICAgICAgICAgICAgICBhd2FpdCBkYi51cGRhdGUoc2NyZWVuc0hpc3RvcnkpLnNldCh7IHJlc3RvcmVLZXk6IG51bGwsIH0pLndoZXJlKGluQXJyYXkoc2NyZWVuc0hpc3RvcnkucmVzdG9yZUtleSwgZHJhZnRzLm1hcChzID0+IGBzY3JpcHRfZHJhZnRfJHtzLnNjcmlwdERyYWZ0SWR9YCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX3NjcmlwdHMnKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jcmVhdGVTY3JpcHRzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfdXBkYXRlU2NyaXB0cyhcbiAgICBkYXRhOiAoe1xuICAgICAgICBzY3JpcHRJZDogc3RyaW5nO1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVyblVwZGF0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH0sXG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiB7XG4gICAgICAgIGVycm9ycz86IHN0cmluZ1tdO1xuICAgICAgICBkYXRhOiAoeyBcbiAgICAgICAgICAgIHNjcmlwdElkOiBzdHJpbmc7XG4gICAgICAgICAgICBzY3JpcHQ/OiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXRTY3JpcHQ+PjtcbiAgICAgICAgICAgIGVycm9ycz86IHN0cmluZ1tdOyBcbiAgICAgICAgfSlbXTtcbiAgICB9ID0geyBkYXRhOiBbXSwgfTtcbiAgICB0cnkge1xuICAgICAgICBsZXQgZHJhZnRzID0gIWRhdGEubGVuZ3RoID8gW10gOiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiBpbkFycmF5KHNjcmlwdHNEcmFmdHMuc2NyaXB0SWQsIGRhdGEubWFwKGMgPT4gYy5zY3JpcHRJZCkpLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyB3ZSdsbCB1c2UgZGF0YSBiZWZvcmUgdG8gY29tcGFyZSBjaGFuZ2VzXG4gICAgICAgIGxldCBkYXRhQmVmb3JlOiB0eXBlb2Ygc2NyaXB0cy4kaW5mZXJTZWxlY3RbXSA9IFtdO1xuICAgICAgICBpZiAoZHJhZnRzLmZpbHRlcihjID0+IGMuc2NyaXB0SWQpLmxlbmd0aCkge1xuICAgICAgICAgICAgZGF0YUJlZm9yZSA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBpbkFycmF5KHNjcmlwdHMuc2NyaXB0SWQsIGRyYWZ0cy5maWx0ZXIoYyA9PiBjLnNjcmlwdElkKS5tYXAoYyA9PiBjLnNjcmlwdElkISkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvcihjb25zdCB7IHNjcmlwdElkOiBfc2NyaXB0SWQsIGRhdGE6IGMgfSBvZiBkcmFmdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcmlwdElkID0gX3NjcmlwdElkITtcblxuICAgICAgICAgICAgY29uc3QgeyBzY3JpcHRJZDogX19zY3JpcHRJZCwgaWQsIG9sZFNjcmlwdElkLCBjcmVhdGVkQXQsIHVwZGF0ZWRBdCwgZGVsZXRlZEF0LCAuLi5wYXlsb2FkIH0gPSBjO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBheWxvYWQsXG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZShzY3JpcHRzKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHVwZGF0ZXMpXG4gICAgICAgICAgICAgICAgICAgIC53aGVyZShlcShzY3JpcHRzLnNjcmlwdElkLCBzY3JpcHRJZCkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gIW9wdHM/LnJldHVyblVwZGF0ZWQgPyB1bmRlZmluZWQgOiBhd2FpdCBfZ2V0U2NyaXB0KHNjcmlwdElkKTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdHMuZGF0YS5wdXNoKHsgc2NyaXB0SWQsIHNjcmlwdCwgfSk7XG4gICAgICAgICAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgX3VwZGF0ZVNjcmlwdHMgc2NyaXB0SWQ9JHtzY3JpcHRJZH1gLCBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMuZGF0YS5wdXNoKHsgc2NyaXB0SWQsIGVycm9yczogW2UubWVzc2FnZV0sIH0pO1xuICAgICAgICAgICAgICAgIGRyYWZ0cyA9IGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmRhdGEuc2NyaXB0SWQgIT09IHNjcmlwdElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IF9zYXZlU2NyaXB0c0hpc3RvcnkoeyBkcmFmdHM6IGRyYWZ0cywgcHJldmlvdXM6IGRhdGFCZWZvcmUsIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hTY3JlZW5zID0gYXdhaXQgX3B1Ymxpc2hTY3JlZW5zKHsgc2NyaXB0c1JlZmVyZW5jZXM6IGRhdGEubWFwKHMgPT4gcy5zY3JpcHRJZCkgfSk7XG4gICAgICAgIGlmIChwdWJsaXNoU2NyZWVucy5lcnJvcnMpIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIC4uLnB1Ymxpc2hTY3JlZW5zLmVycm9yc107XG5cbiAgICAgICAgaWYgKGRyYWZ0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JpcHRzRHJhZnRzKS53aGVyZShpbkFycmF5KHNjcmlwdHNEcmFmdHMuaWQsIGRyYWZ0cy5tYXAoZCA9PiBkLmlkKSkpO1xuICAgICAgICAgICAgaWYgKGRyYWZ0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBfcmVzdG9yZVNjcmVlbnMoeyByZXN0b3JlS2V5czogZHJhZnRzLm1hcChkID0+IGBzY3JpcHRfZHJhZnRfJHtkLnNjcmlwdERyYWZ0SWR9YCksIH0pO1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShzY3JlZW5zSGlzdG9yeSkuc2V0KHsgcmVzdG9yZUtleTogbnVsbCwgfSkud2hlcmUoaW5BcnJheShzY3JlZW5zSGlzdG9yeS5yZXN0b3JlS2V5LCBkcmFmdHMubWFwKHMgPT4gYHNjcmlwdF9kcmFmdF8ke3Muc2NyaXB0RHJhZnRJZH1gKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICd1cGRhdGVfc2NyaXB0cycpO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX3VwZGF0ZVNjcmlwdHMgRVJST1InLCBlKTtcbiAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbZS5tZXNzYWdlLCAuLi4ocmVzdWx0cy5lcnJvcnMgfHwgW10pXTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfc2F2ZVNjcmlwdHNIaXN0b3J5KHsgcHJldmlvdXMsIGRyYWZ0cywgfToge1xuICAgIGRyYWZ0czogdHlwZW9mIHNjcmlwdHNEcmFmdHMuJGluZmVyU2VsZWN0W107XG4gICAgcHJldmlvdXM6IHR5cGVvZiBzY3JpcHRzLiRpbmZlclNlbGVjdFtdO1xufSkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluc2VydERhdGE6IHR5cGVvZiBzY3JpcHRzSGlzdG9yeS4kaW5mZXJJbnNlcnRbXSA9IFtdO1xuXG4gICAgICAgIGZvcihjb25zdCBjIG9mIGRyYWZ0cykge1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlSGlzdG9yeURhdGE6IHR5cGVvZiBzY3JpcHRzSGlzdG9yeS4kaW5mZXJJbnNlcnQgPSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogYz8uZGF0YT8udmVyc2lvbiB8fCAxLFxuICAgICAgICAgICAgICAgIHNjcmlwdElkOiBjPy5kYXRhPy5zY3JpcHRJZCEsXG4gICAgICAgICAgICAgICAgY2hhbmdlczoge30sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoYz8uZGF0YT8udmVyc2lvbiA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNoYW5nZUhpc3RvcnlEYXRhLmNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2NyZWF0ZV9zY3JpcHQnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZSBzY3JpcHQnLFxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZXM6IFtdLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXYgPSBwcmV2aW91cy5maWx0ZXIocHJldkMgPT4gcHJldkMuc2NyaXB0SWQgPT09IGM/LmRhdGE/LnNjcmlwdElkKVswXTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlczogYW55W10gPSBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZXM6IGFueVtdID0gW107XG5cbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cygoeyAuLi5jPy5kYXRhIH0pKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGtleSA9PiAhWyd2ZXJzaW9uJywgJ2RyYWZ0J10uaW5jbHVkZXMoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goX2tleSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBfa2V5IGFzIHVua25vd24gYXMga2V5b2YgdHlwZW9mIGMuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gYy5kYXRhW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9ICh7IC4uLnByZXYgfSlba2V5IGFzIGtleW9mIHR5cGVvZiBwcmV2XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShuZXdWYWx1ZSkgIT09IEpTT04uc3RyaW5naWZ5KG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlcy5wdXNoKHsgW2tleV06IG9sZFZhbHVlLCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZXMucHVzaCh7IFtrZXldOiBuZXdWYWx1ZSwgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY2hhbmdlSGlzdG9yeURhdGEuY2hhbmdlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAndXBkYXRlX3NjcmlwdCcsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXBkYXRlIHNjcmlwdCcsXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlcyxcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGluc2VydERhdGEucHVzaChjaGFuZ2VIaXN0b3J5RGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NyaXB0c0hpc3RvcnkpLnZhbHVlcyhpbnNlcnREYXRhKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoZS5tZXNzYWdlKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiYW5kIiwiYXNjIiwiZXEiLCJpbkFycmF5IiwiaXNOb3ROdWxsIiwiaXNOdWxsIiwibm90SW5BcnJheSIsIm9yIiwidjQiLCJzb2NrZXQiLCJsb2dnZXIiLCJkYiIsInNjcmVlbnNEcmFmdHMiLCJzY3JpcHRzIiwic2NyaXB0c0RyYWZ0cyIsInNjcmlwdHNIaXN0b3J5Iiwic2NyZWVuc0hpc3RvcnkiLCJkaWFnbm9zZXNEcmFmdHMiLCJfZ2V0U2NyaXB0IiwiX2dldFNjcmlwdHMiLCJfcHVibGlzaFNjcmVlbnMiLCJfcmVzdG9yZVNjcmVlbnMiLCJfcHVibGlzaERpYWdub3NlcyIsIl9wdWJsaXNoU2NyaXB0cyIsInJlc3VsdHMiLCJzdWNjZXNzIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsImNvbHVtbnMiLCJzY3JpcHREcmFmdElkIiwic2NyaXB0SWQiLCJpbnNlcnREYXRhIiwiZmlsdGVyIiwiYyIsIm1hcCIsInMiLCJ1cGRhdGVEYXRhIiwiZXJyb3JzIiwibGVuZ3RoIiwicmVzIiwiX3VwZGF0ZVNjcmlwdHMiLCJkYXRhIiwiZm9yRWFjaCIsImUiLCJwdXNoIiwiX2NyZWF0ZVNjcmlwdHMiLCJtZXNzYWdlIiwiZXJyb3IiLCJfZGVsZXRlU2NyaXB0cyIsInNjcmlwdHNJZHMiLCJvcHRzIiwid2hlcmUiLCJpdGVtcyIsImRlbGV0ZWRBdCIsIkRhdGUiLCJ1cGRhdGUiLCJzZXQiLCJkZWxldGUiLCJyZXN0b3JlS2V5cyIsImlkIiwicmVzdG9yZUtleSIsInNJZCIsImluc2VydCIsInZhbHVlcyIsIml0ZW0iLCJ2ZXJzaW9uIiwiY2hhbmdlcyIsImFjdGlvbiIsImRlc2NyaXB0aW9uIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsIl91cGRhdGVTY3JpcHRzV2l0aG91dFB1Ymxpc2hpbmciLCJwYXlsb2FkIiwic2NyaXB0c1JlZmVyZW5jZXMiLCJ3aGVyZVNjcmlwdCIsInVuZGVmaW5lZCIsInB1Ymxpc2hlZFNjcmlwdHMiLCJvcmRlckJ5IiwicG9zaXRpb24iLCJuZXdEcmFmdHMiLCJ1cGRhdGVkRHJhZnRzIiwiZHJhZnQiLCJwdWJsaXNoZWRTY3JpcHQiLCJpbnNlcnRlZCIsImRhdGFCZWZvcmUiLCJkIiwic2NyaXB0SWRzIiwicHVibGlzaFNjcmVlbnMiLCJwdWJsaXNoRGlhZ25vc2VzIiwicmV0dXJuSW5zZXJ0ZWQiLCJfc2F2ZVNjcmlwdHNIaXN0b3J5IiwicHJldmlvdXMiLCJfc2NyaXB0SWQiLCJfX3NjcmlwdElkIiwib2xkU2NyaXB0SWQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJ1cGRhdGVzIiwicHVibGlzaERhdGUiLCJzY3JpcHQiLCJyZXR1cm5VcGRhdGVkIiwiY2hhbmdlSGlzdG9yeURhdGEiLCJwcmV2IiwicHJldkMiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiaW5jbHVkZXMiLCJfa2V5IiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsIkpTT04iLCJzdHJpbmdpZnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/_scripts/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/diagnoses-drafts.ts":
/*!*************************************************!*\
  !*** ./databases/mutations/diagnoses-drafts.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _createDiagnosesDrafts: () => (/* binding */ _createDiagnosesDrafts),\n/* harmony export */   _deleteAllDiagnosesDrafts: () => (/* binding */ _deleteAllDiagnosesDrafts),\n/* harmony export */   _deleteDiagnosesDrafts: () => (/* binding */ _deleteDiagnosesDrafts),\n/* harmony export */   _updateDiagnosesDrafts: () => (/* binding */ _updateDiagnosesDrafts)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../queries/diagnoses-drafts */ \"(rsc)/./databases/queries/diagnoses-drafts.ts\");\n/* harmony import */ var _queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/diagnoses */ \"(rsc)/./databases/queries/diagnoses.ts\");\n\n\n\n\n\n\n\nasync function _deleteDiagnosesDrafts(diagnosesDraftsIds, opts) {\n    if (diagnosesDraftsIds.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosesDraftsIds));\n        // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'delete_diagnoses_drafts', data: diagnosesDraftsIds, });\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_diagnoses_drafts\");\n    }\n    return true;\n}\nasync function _deleteAllDiagnosesDrafts(opts) {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts);\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_diagnoses_drafts\");\n    return res;\n}\nasync function _createDiagnosesDrafts(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const missingScriptsReferences = data.filter((s)=>!s.scriptDraftId && !s.scriptId);\n        if (missingScriptsReferences.length) throw new Error(\"Missing scripts references\");\n        const diagnosesList = await (0,_queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__._listDiagnoses)({\n            scriptsReferences: data.map((s)=>s.scriptId || s.scriptDraftId)\n        });\n        const lastPosition = diagnosesList.data.length ? Math.max(...diagnosesList.data.map((s)=>s.position)) : 0;\n        let position = lastPosition + 1;\n        const insertData = [];\n        for (const s of data){\n            let diagnosisDraftId = s.diagnosisId || s.data.diagnosisId;\n            const existing = !diagnosisDraftId ? null : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosisDraftId)\n            });\n            if (!existing) {\n                insertData.push({\n                    ...s,\n                    data: {\n                        ...s.data,\n                        position: s.diagnosisId ? s.data.position : position\n                    },\n                    diagnosisDraftId: diagnosisDraftId || (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(),\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId\n                });\n                if (!s.diagnosisId) position++;\n            }\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts).values(insertData);\n        if (opts?.returnInserted) {\n            const inserted = await (0,_queries_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_3__._getDiagnosesDrafts)({\n                diagnosisDraftIds: insertData.map((u)=>u.diagnosisDraftId)\n            });\n            results.inserted = inserted.data;\n        }\n        results.success = true;\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_diagnoses_drafts\");\n    } catch (e) {\n        results.error = e.message;\n    } finally{\n        return results;\n    }\n}\nasync function _updateDiagnosesDrafts(data, opts) {\n    const results = [];\n    for (const { diagnosisDraftId, data: draft } of data){\n        try {\n            const existing = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosisDraftId)\n            });\n            const draftData = {\n                ...existing?.data,\n                ...draft\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts).set({\n                data: draftData\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosisDraftId));\n            const diagnosisDraft = !opts?.returnUpdated ? undefined : await (0,_queries_diagnoses_drafts__WEBPACK_IMPORTED_MODULE_3__._getDiagnosisDraft)(diagnosisDraftId);\n            results.push({\n                diagnosisDraftId,\n                diagnosisDraft\n            });\n            // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'update_diagnoses_drafts', data: data.map(u => u.diagnosisDraftId), });\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_diagnoses_drafts\");\n        } catch (e) {\n            results.push({\n                diagnosisDraftId,\n                error: e.message\n            });\n        }\n    }\n    return results;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL2RpYWdub3Nlcy1kcmFmdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBMEM7QUFDaEI7QUFFUztBQUNKO0FBQ2dCO0FBQ3VDO0FBQ2hDO0FBRS9DLGVBQWVTLHVCQUNsQkMsa0JBQTRCLEVBQzVCQyxJQUVDO0lBRUQsSUFBSUQsbUJBQW1CRSxNQUFNLEVBQUU7UUFDM0IsTUFBTVIsbURBQUVBLENBQUNTLE1BQU0sQ0FBQ1IsdURBQWVBLEVBQUVTLEtBQUssQ0FBQ2Isb0RBQU9BLENBQUNJLHVEQUFlQSxDQUFDVSxnQkFBZ0IsRUFBRUw7UUFDakYsNEhBQTRIO1FBQzVILElBQUlDLE1BQU1LLGlCQUFpQmIsbURBQU1BLENBQUNjLElBQUksQ0FBQyxnQkFBZ0I7SUFDM0Q7SUFDQSxPQUFPO0FBQ1g7QUFFTyxlQUFlQywwQkFDbEJQLElBRUM7SUFFRCxNQUFNUSxNQUFNLE1BQU1mLG1EQUFFQSxDQUFDUyxNQUFNLENBQUNSLHVEQUFlQTtJQUMzQyxJQUFJTSxNQUFNSyxpQkFBaUJiLG1EQUFNQSxDQUFDYyxJQUFJLENBQUMsZ0JBQWdCO0lBQ3ZELE9BQU9FO0FBQ1g7QUFFTyxlQUFlQyx1QkFDbEJDLElBS0ksRUFDSlYsSUFHQztJQUVELElBQUlXLFVBSUE7UUFBRUMsVUFBVSxFQUFFO1FBQUVDLFNBQVM7SUFBTztJQUVwQyxJQUFJO1FBQ0EsTUFBTUMsMkJBQTJCSixLQUFLSyxNQUFNLENBQUNDLENBQUFBLElBQUssQ0FBQ0EsRUFBRUMsYUFBYSxJQUFJLENBQUNELEVBQUVFLFFBQVE7UUFFakYsSUFBSUoseUJBQXlCYixNQUFNLEVBQUUsTUFBTSxJQUFJa0IsTUFBTTtRQUVyRCxNQUFNQyxnQkFBZ0IsTUFBTXZCLGtFQUFjQSxDQUFDO1lBQUV3QixtQkFBbUJYLEtBQUtZLEdBQUcsQ0FBQ04sQ0FBQUEsSUFBS0EsRUFBRUUsUUFBUSxJQUFLRixFQUFFQyxhQUFhO1FBQUk7UUFDaEgsTUFBTU0sZUFB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cUIsSUFBSSxDQUFDO2dCQUFFNUI7Z0JBQWtCbUMsT0FBT0QsRUFBRUUsT0FBTztZQUFFO1FBQ3ZEO0lBQ0o7SUFFQSxPQUFPN0I7QUFDWCIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL211dGF0aW9ucy9kaWFnbm9zZXMtZHJhZnRzLnRzPzZhNzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGluQXJyYXkgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IHY0IH0gZnJvbSBcInV1aWRcIjtcblxuaW1wb3J0IHNvY2tldCAgZnJvbSAnQC9saWIvc29ja2V0JztcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgZGlhZ25vc2VzRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgX2dldERpYWdub3Npc0RyYWZ0LCBfZ2V0RGlhZ25vc2VzRHJhZnRzIH0gZnJvbSAnLi4vcXVlcmllcy9kaWFnbm9zZXMtZHJhZnRzJztcbmltcG9ydCB7IF9saXN0RGlhZ25vc2VzIH0gZnJvbSBcIi4uL3F1ZXJpZXMvZGlhZ25vc2VzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZGVsZXRlRGlhZ25vc2VzRHJhZnRzKFxuICAgIGRpYWdub3Nlc0RyYWZ0c0lkczogc3RyaW5nW10sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBpZiAoZGlhZ25vc2VzRHJhZnRzSWRzLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBkYi5kZWxldGUoZGlhZ25vc2VzRHJhZnRzKS53aGVyZShpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNEcmFmdElkLCBkaWFnbm9zZXNEcmFmdHNJZHMpKTtcbiAgICAgICAgLy8gaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsIHsgYWN0aW9uOiAnZGVsZXRlX2RpYWdub3Nlc19kcmFmdHMnLCBkYXRhOiBkaWFnbm9zZXNEcmFmdHNJZHMsIH0pO1xuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9kaWFnbm9zZXNfZHJhZnRzJyk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2RlbGV0ZUFsbERpYWdub3Nlc0RyYWZ0cyhcbiAgICBvcHRzPzoge1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLmRlbGV0ZShkaWFnbm9zZXNEcmFmdHMpO1xuICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnZGVsZXRlX2RpYWdub3Nlc19kcmFmdHMnKTtcbiAgICByZXR1cm4gcmVzO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NyZWF0ZURpYWdub3Nlc0RyYWZ0cyhcbiAgICBkYXRhOiAodHlwZW9mIGRpYWdub3Nlc0RyYWZ0cy4kaW5mZXJJbnNlcnQgJiB7XG4gICAgICAgIHNjcmlwdElkPzogc3RyaW5nO1xuICAgICAgICBzY3JpcHREcmFmdElkPzogc3RyaW5nO1xuICAgICAgICBkaWFnbm9zaXNEcmFmdElkOiBzdHJpbmc7XG4gICAgICAgIGRhdGE6IEV4Y2x1ZGU8KHR5cGVvZiBkaWFnbm9zZXNEcmFmdHMuJGluZmVySW5zZXJ0KVsnZGF0YSddLCAndmVyc2lvbic+O1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVybkluc2VydGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBsZXQgcmVzdWx0czoge1xuICAgICAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgICAgICBlcnJvcj86IHN0cmluZztcbiAgICAgICAgaW5zZXJ0ZWQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX2dldERpYWdub3Nlc0RyYWZ0cz4+WydkYXRhJ107XG4gICAgfSA9IHsgaW5zZXJ0ZWQ6IFtdLCBzdWNjZXNzOiBmYWxzZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1pc3NpbmdTY3JpcHRzUmVmZXJlbmNlcyA9IGRhdGEuZmlsdGVyKHMgPT4gIXMuc2NyaXB0RHJhZnRJZCAmJiAhcy5zY3JpcHRJZCk7XG5cbiAgICAgICAgaWYgKG1pc3NpbmdTY3JpcHRzUmVmZXJlbmNlcy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBzY3JpcHRzIHJlZmVyZW5jZXMnKTtcblxuICAgICAgICBjb25zdCBkaWFnbm9zZXNMaXN0ID0gYXdhaXQgX2xpc3REaWFnbm9zZXMoeyBzY3JpcHRzUmVmZXJlbmNlczogZGF0YS5tYXAocyA9PiBzLnNjcmlwdElkISB8fCBzLnNjcmlwdERyYWZ0SWQhKSwgfSk7XG4gICAgICAgIGNvbnN0IGxhc3RQb3NpdGlvbiA9IGRpYWdub3Nlc0xpc3QuZGF0YS5sZW5ndGggPyBNYXRoLm1heCguLi5kaWFnbm9zZXNMaXN0LmRhdGEubWFwKHMgPT4gcy5wb3NpdGlvbikpIDogMDtcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gbGFzdFBvc2l0aW9uICsgMTtcblxuICAgICAgICBjb25zdCBpbnNlcnREYXRhOiB0eXBlb2YgZGlhZ25vc2VzRHJhZnRzLiRpbmZlckluc2VydFtdID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IoY29uc3QgcyBvZiBkYXRhKSB7XG4gICAgICAgICAgICBsZXQgZGlhZ25vc2lzRHJhZnRJZCA9IHMuZGlhZ25vc2lzSWQgfHwgcy5kYXRhLmRpYWdub3Npc0lkO1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSAhZGlhZ25vc2lzRHJhZnRJZCA/IG51bGwgOiBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogZXEoZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0RyYWZ0SWQsIGRpYWdub3Npc0RyYWZ0SWQpLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAuLi5zLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcy5kaWFnbm9zaXNJZCA/IHMuZGF0YS5wb3NpdGlvbiA6IHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkaWFnbm9zaXNEcmFmdElkOiBkaWFnbm9zaXNEcmFmdElkIHx8IHY0KCksXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdElkOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFzLmRpYWdub3Npc0lkKSBwb3NpdGlvbisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydERhdGEubGVuZ3RoKSBhd2FpdCBkYi5pbnNlcnQoZGlhZ25vc2VzRHJhZnRzKS52YWx1ZXMoaW5zZXJ0RGF0YSk7XG4gICAgICAgIFxuICAgICAgICBpZiAob3B0cz8ucmV0dXJuSW5zZXJ0ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydGVkID0gYXdhaXQgX2dldERpYWdub3Nlc0RyYWZ0cyh7IGRpYWdub3Npc0RyYWZ0SWRzOiBpbnNlcnREYXRhLm1hcCh1ID0+IHUuZGlhZ25vc2lzRHJhZnRJZCEpLCB9KTtcbiAgICAgICAgICAgIHJlc3VsdHMuaW5zZXJ0ZWQgPSBpbnNlcnRlZC5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX2RpYWdub3Nlc19kcmFmdHMnKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF91cGRhdGVEaWFnbm9zZXNEcmFmdHMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgZGlhZ25vc2lzRHJhZnRJZDogc3RyaW5nO1xuICAgICAgICBkYXRhOiBQYXJ0aWFsPHR5cGVvZiBkaWFnbm9zZXNEcmFmdHMuJGluZmVyU2VsZWN0PlsnZGF0YSddO1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVyblVwZGF0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlc3VsdHM6ICh7IFxuICAgICAgICBkaWFnbm9zaXNEcmFmdElkOiBzdHJpbmc7XG4gICAgICAgIGRpYWdub3Npc0RyYWZ0PzogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0RGlhZ25vc2lzRHJhZnQ+PjtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7IFxuICAgIH0pW10gPSBbXTtcblxuICAgIGZvcihjb25zdCB7IGRpYWdub3Npc0RyYWZ0SWQsIGRhdGE6IGRyYWZ0LCAgfSBvZiBkYXRhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlc0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBlcShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzRHJhZnRJZCwgZGlhZ25vc2lzRHJhZnRJZCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGRyYWZ0RGF0YSA9IHsgLi4uZXhpc3Rpbmc/LmRhdGEsIC4uLmRyYWZ0LCB9IGFzIHR5cGVvZiBkcmFmdDtcbiAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShkaWFnbm9zZXNEcmFmdHMpLnNldCh7IGRhdGE6IGRyYWZ0RGF0YSwgfSkud2hlcmUoZXEoZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0RyYWZ0SWQsIGRpYWdub3Npc0RyYWZ0SWQpKTtcbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3Npc0RyYWZ0ID0gIW9wdHM/LnJldHVyblVwZGF0ZWQgPyB1bmRlZmluZWQgOiBhd2FpdCBfZ2V0RGlhZ25vc2lzRHJhZnQoZGlhZ25vc2lzRHJhZnRJZCk7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBkaWFnbm9zaXNEcmFmdElkLCBkaWFnbm9zaXNEcmFmdCwgfSk7XG4gICAgICAgICAgICAvLyBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgeyBhY3Rpb246ICd1cGRhdGVfZGlhZ25vc2VzX2RyYWZ0cycsIGRhdGE6IGRhdGEubWFwKHUgPT4gdS5kaWFnbm9zaXNEcmFmdElkKSwgfSk7XG4gICAgICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9kaWFnbm9zZXNfZHJhZnRzJyk7XG4gICAgICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBkaWFnbm9zaXNEcmFmdElkLCBlcnJvcjogZS5tZXNzYWdlLCB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xufVxuIl0sIm5hbWVzIjpbImVxIiwiaW5BcnJheSIsInY0Iiwic29ja2V0IiwiZGIiLCJkaWFnbm9zZXNEcmFmdHMiLCJfZ2V0RGlhZ25vc2lzRHJhZnQiLCJfZ2V0RGlhZ25vc2VzRHJhZnRzIiwiX2xpc3REaWFnbm9zZXMiLCJfZGVsZXRlRGlhZ25vc2VzRHJhZnRzIiwiZGlhZ25vc2VzRHJhZnRzSWRzIiwib3B0cyIsImxlbmd0aCIsImRlbGV0ZSIsIndoZXJlIiwiZGlhZ25vc2lzRHJhZnRJZCIsImJyb2FkY2FzdEFjdGlvbiIsImVtaXQiLCJfZGVsZXRlQWxsRGlhZ25vc2VzRHJhZnRzIiwicmVzIiwiX2NyZWF0ZURpYWdub3Nlc0RyYWZ0cyIsImRhdGEiLCJyZXN1bHRzIiwiaW5zZXJ0ZWQiLCJzdWNjZXNzIiwibWlzc2luZ1NjcmlwdHNSZWZlcmVuY2VzIiwiZmlsdGVyIiwicyIsInNjcmlwdERyYWZ0SWQiLCJzY3JpcHRJZCIsIkVycm9yIiwiZGlhZ25vc2VzTGlzdCIsInNjcmlwdHNSZWZlcmVuY2VzIiwibWFwIiwibGFzdFBvc2l0aW9uIiwiTWF0aCIsIm1heCIsInBvc2l0aW9uIiwiaW5zZXJ0RGF0YSIsImRpYWdub3Npc0lkIiwiZXhpc3RpbmciLCJxdWVyeSIsImZpbmRGaXJzdCIsInB1c2giLCJpbnNlcnQiLCJ2YWx1ZXMiLCJyZXR1cm5JbnNlcnRlZCIsImRpYWdub3Npc0RyYWZ0SWRzIiwidSIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfdXBkYXRlRGlhZ25vc2VzRHJhZnRzIiwiZHJhZnQiLCJkcmFmdERhdGEiLCJ1cGRhdGUiLCJzZXQiLCJkaWFnbm9zaXNEcmFmdCIsInJldHVyblVwZGF0ZWQiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/diagnoses-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/diagnoses.ts":
/*!******************************************!*\
  !*** ./databases/mutations/diagnoses.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _copyDiagnoses: () => (/* binding */ _copyDiagnoses),\n/* harmony export */   _createDiagnoses: () => (/* binding */ _createDiagnoses),\n/* harmony export */   _deleteDiagnoses: () => (/* binding */ _deleteDiagnoses),\n/* harmony export */   _publishDiagnoses: () => (/* binding */ _publishDiagnoses),\n/* harmony export */   _saveDiagnosesHistory: () => (/* binding */ _saveDiagnosesHistory),\n/* harmony export */   _updateDiagnoses: () => (/* binding */ _updateDiagnoses),\n/* harmony export */   _updateDiagnosesWithoutPublishing: () => (/* binding */ _updateDiagnosesWithoutPublishing)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/diagnoses */ \"(rsc)/./databases/queries/diagnoses.ts\");\n/* harmony import */ var _queries_scripts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../queries/_scripts */ \"(rsc)/./databases/queries/_scripts/index.ts\");\n\n\n\n\n\n\n\n\nasync function _copyDiagnoses({ diagnosesReferences, scriptsReferences }, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const diagnosesList = await (0,_queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__._listRawDiagnoses)({\n            diagnosesReferences\n        });\n        if (diagnosesList.error) throw new Error(diagnosesList.error);\n        const scriptsList = await (0,_queries_scripts__WEBPACK_IMPORTED_MODULE_5__._listScripts)(scriptsReferences);\n        if (scriptsList.error) throw new Error(scriptsList.error);\n        const insertData = [];\n        for (const s of scriptsList.data){\n            const scriptDiagnosesList = await (0,_queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__._listDiagnoses)({\n                scriptsReferences: [\n                    s.scriptId || s.scriptDraftId\n                ]\n            });\n            const lastPosition = scriptDiagnosesList.data.length ? Math.max(...scriptDiagnosesList.data.map((s)=>s.position)) : 0;\n            let position = lastPosition + 1;\n            diagnosesList.data.forEach((data)=>{\n                const diagnosisId = (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])();\n                insertData.push({\n                    data: {\n                        ...data,\n                        diagnosisId,\n                        scriptId: s.scriptId,\n                        oldDiagnosisId: null,\n                        position\n                    },\n                    position,\n                    diagnosisId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId\n                });\n                position++;\n            });\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).values(insertData);\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_diagnoses_drafts\");\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_copyDiagnoses ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _updateDiagnosesWithoutPublishing(payload, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const scriptsReferences = payload.map((s)=>s.scriptReference).filter((s)=>s);\n        const whereScript = !scriptsReferences.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptDraftId, scriptsReferences));\n        if (whereScript) {\n            const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnosesDrafts.findMany({\n                where: whereScript\n            });\n            let publishedDiagnoses = [];\n            if (scriptsReferences.length) {\n                publishedDiagnoses = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnoses.findMany({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(...[\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.deletedAt),\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.scriptId, scriptsReferences),\n                        ...drafts.filter((s)=>s.diagnosisId).length ? [\n                            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, drafts.map((s)=>s.diagnosisId))\n                        ] : []\n                    ]),\n                    orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.asc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.position)\n                });\n            }\n            const newDrafts = [];\n            let updatedDrafts = 0;\n            for (const { diagnosisId, data } of payload){\n                const draft = drafts.filter((s)=>s.data.diagnosisId === diagnosisId)[0];\n                const publishedDiagnosis = publishedDiagnoses.filter((s)=>s.diagnosisId === diagnosisId)[0];\n                if (draft) {\n                    await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).set({\n                        data: {\n                            ...draft.data,\n                            ...data\n                        }\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.id, draft.id));\n                    updatedDrafts++;\n                } else if (publishedDiagnosis) {\n                    newDrafts.push({\n                        diagnosisId: publishedDiagnosis.diagnosisId,\n                        scriptId: publishedDiagnosis.scriptId,\n                        position: data.position,\n                        data: {\n                            ...publishedDiagnosis,\n                            ...data,\n                            version: data.version || publishedDiagnosis.version + 1\n                        }\n                    });\n                }\n            }\n            if (newDrafts.length) {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).values(newDrafts);\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_diagnoses_drafts\");\n            }\n            if (updatedDrafts) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"update_diagnoses_drafts\");\n            }\n        }\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_orderDiagnoses ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _publishDiagnoses(opts) {\n    const { scriptsReferences, diagnosesReferences } = {\n        ...opts\n    };\n    const results = {\n        success: true\n    };\n    const errors = [];\n    try {\n        let updates = [];\n        let inserts = [];\n        if (scriptsReferences?.length || diagnosesReferences?.length) {\n            const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnosesDrafts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.or)(!scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptId, scriptsReferences), !scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptDraftId, scriptsReferences), !diagnosesReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId, diagnosesReferences), !diagnosesReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisDraftId, diagnosesReferences)),\n                columns: {\n                    diagnosisId: true,\n                    diagnosisDraftId: true\n                }\n            });\n            updates = res.filter((s)=>s.diagnosisId).map((s)=>({\n                    diagnosisId: s.diagnosisId\n                }));\n            inserts = res.filter((s)=>!s.diagnosisId).map((s)=>({\n                    diagnosisDraftId: s.diagnosisDraftId\n                }));\n        } else {\n            const _diagnosesDrafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnosesDrafts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.scriptId),\n                columns: {\n                    diagnosisId: true,\n                    diagnosisDraftId: true\n                }\n            });\n            updates = _diagnosesDrafts.filter((s)=>s.diagnosisId).map((s)=>({\n                    diagnosisId: s.diagnosisId\n                }));\n            inserts = _diagnosesDrafts.filter((s)=>!s.diagnosisId).map((s)=>({\n                    diagnosisDraftId: s.diagnosisDraftId\n                }));\n        }\n        if (updates.length) {\n            const res = await _updateDiagnoses(updates);\n            res.forEach((s)=>s.error && errors.push(s.error));\n        }\n        if (inserts.length) {\n            const res = await _createDiagnoses(inserts);\n            res.errors?.forEach((e)=>errors.push(e));\n        }\n        if (errors.length) {\n            results.success = false;\n            results.errors = errors;\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_publishDiagnoses ERRORS\", errors);\n        }\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_publishDiagnoses ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _deleteDiagnoses(diagnosisIds, opts) {\n    if (diagnosisIds.length) {\n        const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, diagnosisIds);\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnoses.findMany({\n            where\n        });\n        const deletedAt = new Date();\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses).set({\n            deletedAt\n        }).where(where);\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId, diagnosisIds)));\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory).values(items.map((item)=>({\n                version: item.version,\n                diagnosisId: item.diagnosisId,\n                scriptId: item.scriptId,\n                changes: {\n                    action: \"delete_diagnosis\",\n                    dediagnosision: \"Delete diagnosis\",\n                    oldValues: [\n                        {\n                            deletedAt: null\n                        }\n                    ],\n                    newValues: [\n                        {\n                            deletedAt\n                        }\n                    ]\n                }\n            })));\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"delete_diagnoses\");\n    }\n    return true;\n}\nasync function _createDiagnoses(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const insertData = [];\n        let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnosesDrafts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisDraftId, data.map((c)=>c.diagnosisDraftId))\n        });\n        // we'll use data before to compare changes\n        let dataBefore = [];\n        if (drafts.filter((c)=>c.diagnosisId).length) {\n            dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnoses.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, drafts.filter((c)=>c.diagnosisId).map((c)=>c.diagnosisId))\n            });\n        }\n        for (const { id, scriptId: _scriptId, data } of drafts){\n            const diagnosisId = data.diagnosisId || (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])();\n            const scriptId = data.scriptId || _scriptId;\n            const payload = {\n                ...data,\n                diagnosisId,\n                scriptId\n            };\n            insertData.push(payload);\n            drafts = drafts.map((d)=>{\n                if (d.id === id) d.data.diagnosisId = diagnosisId;\n                return d;\n            });\n            try {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses).values(payload);\n            } catch (e) {\n                results.errors = [\n                    ...results.errors || [],\n                    `Error inserting ${data.name} - ${e.message}`\n                ];\n            }\n        }\n        const inserted = await (0,_queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__._getDiagnoses)({\n            diagnosisIds: insertData.map((c)=>c.diagnosisId)\n        });\n        results.inserted = opts?.returnInserted ? inserted.data : [];\n        results.success = true;\n        await _saveDiagnosesHistory({\n            drafts: drafts,\n            previous: dataBefore\n        });\n        if (drafts.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.id, drafts.map((d)=>d.id)));\n        }\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_diagnoses\");\n    } catch (e) {\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_createDiagnoses ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _updateDiagnoses(data, opts) {\n    const results = [];\n    let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnosesDrafts.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.diagnosisId, data.map((c)=>c.diagnosisId))\n    });\n    // we'll use data before to compare changes\n    let dataBefore = [];\n    if (drafts.filter((c)=>c.diagnosisId).length) {\n        dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.diagnoses.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, drafts.filter((c)=>c.diagnosisId).map((c)=>c.diagnosisId))\n        });\n    }\n    for (const { diagnosisId: _diagnosisId, data: c } of drafts){\n        const diagnosisId = _diagnosisId;\n        const { diagnosisId: __diagnosisId, id, oldDiagnosisId, createdAt, updatedAt, deletedAt, ...payload } = c;\n        try {\n            const updates = {\n                ...payload,\n                publishDate: new Date()\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses).set(updates).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnoses.diagnosisId, diagnosisId));\n            const diagnosis = !opts?.returnUpdated ? undefined : await (0,_queries_diagnoses__WEBPACK_IMPORTED_MODULE_4__._getDiagnosis)(diagnosisId);\n            results.push({\n                diagnosisId,\n                diagnosis\n            });\n        } catch (e) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(`_updateDiagnoses diagnosisId=${diagnosisId}`, e.message);\n            results.push({\n                diagnosisId,\n                error: e.message\n            });\n            drafts = drafts.filter((c)=>c.data.diagnosisId !== diagnosisId);\n        }\n    }\n    await _saveDiagnosesHistory({\n        drafts: drafts,\n        previous: dataBefore\n    });\n    if (drafts.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesDrafts.id, drafts.map((d)=>d.id)));\n    }\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_diagnoses\");\n    return results;\n}\nasync function _saveDiagnosesHistory({ previous, drafts }) {\n    try {\n        const insertData = [];\n        for (const c of drafts){\n            const changeHistoryData = {\n                version: c?.data?.version || 1,\n                diagnosisId: c?.data?.diagnosisId,\n                scriptId: c?.data?.scriptId,\n                changes: {}\n            };\n            if (c?.data?.version === 1) {\n                changeHistoryData.changes = {\n                    action: \"create_diagnosis\",\n                    dediagnosision: \"Create diagnosis\",\n                    oldValues: [],\n                    newValues: []\n                };\n            } else {\n                const prev = previous.filter((prevC)=>prevC.diagnosisId === c?.data?.diagnosisId)[0];\n                const oldValues = [];\n                const newValues = [];\n                Object.keys({\n                    ...c?.data\n                }).filter((key)=>![\n                        \"version\",\n                        \"draft\"\n                    ].includes(key)).forEach((_key)=>{\n                    const key = _key;\n                    const newValue = c.data[key];\n                    const oldValue = {\n                        ...prev\n                    }[key];\n                    if (JSON.stringify(newValue) !== JSON.stringify(oldValue)) {\n                        oldValues.push({\n                            [key]: oldValue\n                        });\n                        newValues.push({\n                            [key]: newValue\n                        });\n                    }\n                });\n                changeHistoryData.changes = {\n                    action: \"update_diagnosis\",\n                    dediagnosision: \"Update diagnosis\",\n                    oldValues,\n                    newValues\n                };\n            }\n            insertData.push(changeHistoryData);\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.diagnosesHistory).values(insertData);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(e.message);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL2RpYWdub3Nlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTZGO0FBQ25FO0FBRVE7QUFDQztBQUNKO0FBQzZDO0FBQzJCO0FBQ3BEO0FBRTVDLGVBQWVvQixlQUNsQixFQUFFQyxtQkFBbUIsRUFBRUMsaUJBQWlCLEVBR3ZDLEVBQ0RDLElBRUM7SUFFRCxNQUFNQyxVQUE2RDtRQUFFQyxTQUFTO0lBQUs7SUFDbkYsSUFBSTtRQUNBLE1BQU1DLGdCQUFnQixNQUFNVCxxRUFBaUJBLENBQUM7WUFBRUk7UUFBb0I7UUFFcEUsSUFBSUssY0FBY0MsS0FBSyxFQUFFLE1BQU0sSUFBSUMsTUFBTUYsY0FBY0MsS0FBSztRQUU1RCxNQUFNRSxjQUFjLE1BQU1WLDhEQUFZQSxDQUFDRztRQUV2QyxJQUFJTyxZQUFZRixLQUFLLEVBQUUsTUFBTSxJQUFJQyxNQUFNQyxZQUFZRixLQUFLO1FBRXhELE1BQU1HLGFBQW9ELEVBQUU7UUFFNUQsS0FBSyxNQUFNQyxLQUFLRixZQUFZRyxJQUFJLENBQUU7WUFDOUIsTUFBTUMsc0JBQXNCLE1BQU1mLGtFQUFjQSxDQUFDO2dCQUFFSSxtQkFBbUI7b0JBQUNTLEVBQUVHLFFBQVEsSUFBS0gsRUFBRUksYUFBYTtpQkFBRTtZQUFFO1lBQ3pHLE1BQU1DLGVBQWVILG9CQUFvQkQsSUFBSSxDQUFDSyxNQUFNLEdBQUdDLEtBQUtDLEdBQUcsSUFBSU4sb0JBQW9CRCxJQUFJLENBQUNRLEdBQUcsQ0FBQ1QsQ0FBQUEsSUFBS0EsRUFBRVUsUUFBUSxLQUFLO1lBQ3BILElBQUlBLFdBQVdMLGVBQWU7WUFFOUJWLGNBQWNNLElBQUksQ0FBQ1UsT0FBTyxDQUFDVixDQUFBQTtnQkFDdkIsTUFBTVcsY0FBY25DLGdEQUFFQTtnQkFDdEJzQixXQUFXYyxJQUFJLENBQUM7b0JBQ1paLE1BQU07d0JBQ0YsR0FBR0EsSUFBSTt3QkFDUFc7d0JBQ0FULFVBQVVILEVBQUVHLFFBQVE7d0JBQ3BCVyxnQkFBZ0I7d0JBQ2hCSjtvQkFDSjtvQkFDQUE7b0JBQ0FFO29CQUNBVCxVQUFVSCxFQUFFRyxRQUFRO29CQUNwQkMsZUFBZUosRUFBRUksYUFBYTtnQkFDbEM7Z0JBQ0FNO1lBQ0o7UUFDSjtRQUVBLElBQUlYLFdBQVdPLE1BQU0sRUFBRSxNQUFNMUIsbURBQUVBLENBQUNtQyxNQUFNLENBQUNqQyx1REFBZUEsRUFBRWtDLE1BQU0sQ0FBQ2pCO1FBRS9ELElBQUlQLE1BQU15QixpQkFBaUJ0QyxtREFBTUEsQ0FBQ3VDLElBQUksQ0FBQyxnQkFBZ0I7SUFDM0QsRUFBRSxPQUFNQyxHQUFRO1FBQ1oxQixRQUFRQyxPQUFPLEdBQUc7UUFDbEJELFFBQVFHLEtBQUssR0FBR3VCLEVBQUVDLE9BQU87UUFDekIxQyxtREFBTUEsQ0FBQ2tCLEtBQUssQ0FBQyx3QkFBd0J1QixFQUFFQyxPQUFPO0lBQ2xELFNBQVU7UUFDTixPQUFPM0I7SUFDWDtBQUNKO0FBRU8sZUFBZTRCLGtDQUNsQkMsT0FJRyxFQUNIOUIsSUFFQztJQUVELE1BQU1DLFVBQTZEO1FBQUVDLFNBQVM7SUFBSztJQUVuRixJQUFJO1FBQ0EsTUFBTUgsb0JBQW9CK0IsUUFBUWIsR0FBRyxDQUFDVCxDQUFBQSxJQUFLQSxFQUFFdUIsZUFBZSxFQUFFQyxNQUFNLENBQUN4QixDQUFBQSxJQUFLQTtRQUUxRSxNQUFNeUIsY0FBYyxDQUFDbEMsa0JBQWtCZSxNQUFNLEdBQUdvQixZQUFZbEQsK0NBQUVBLENBQzFESixvREFBT0EsQ0FBQ1UsdURBQWVBLENBQUNxQixRQUFRLEVBQUVaLG9CQUNsQ25CLG9EQUFPQSxDQUFDVSx1REFBZUEsQ0FBQ3NCLGFBQWEsRUFBRWI7UUFHM0MsSUFBSWtDLGFBQWE7WUFDYixNQUFNRSxTQUFTLE1BQU0vQyxtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQzlDLGVBQWUsQ0FBQytDLFFBQVEsQ0FBQztnQkFDbkRDLE9BQU9MO1lBQ1g7WUFFQSxJQUFJTSxxQkFBc0QsRUFBRTtZQUM1RCxJQUFJeEMsa0JBQWtCZSxNQUFNLEVBQUU7Z0JBQzFCeUIscUJBQXFCLE1BQU1uRCxtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQy9DLFNBQVMsQ0FBQ2dELFFBQVEsQ0FBQztvQkFDbkRDLE9BQU83RCxnREFBR0EsSUFBSTt3QkFDVkssbURBQU1BLENBQUNPLGlEQUFTQSxDQUFDbUQsU0FBUzt3QkFDMUI1RCxvREFBT0EsQ0FBQ1MsaURBQVNBLENBQUNzQixRQUFRLEVBQUVaOzJCQUN4Qm9DLE9BQU9ILE1BQU0sQ0FBQ3hCLENBQUFBLElBQUtBLEVBQUVZLFdBQVcsRUFBRU4sTUFBTSxHQUFHOzRCQUFDL0IsdURBQVVBLENBQUNNLGlEQUFTQSxDQUFDK0IsV0FBVyxFQUFFZSxPQUFPbEIsR0FBRyxDQUFDVCxDQUFBQSxJQUFLQSxFQUFFWSxXQUFXO3lCQUFJLEdBQUcsRUFBRTtxQkFDM0g7b0JBQ0RxQixTQUFTL0QsZ0RBQUdBLENBQUNXLGlEQUFTQSxDQUFDNkIsUUFBUTtnQkFDbkM7WUFDSjtZQUVBLE1BQU13QixZQUFtRCxFQUFFO1lBQzNELElBQUlDLGdCQUFnQjtZQUVwQixLQUFLLE1BQU0sRUFBRXZCLFdBQVcsRUFBRVgsSUFBSSxFQUFFLElBQUlxQixRQUFTO2dCQUN6QyxNQUFNYyxRQUFRVCxPQUFPSCxNQUFNLENBQUN4QixDQUFBQSxJQUFLQSxFQUFFQyxJQUFJLENBQUNXLFdBQVcsS0FBS0EsWUFBWSxDQUFDLEVBQUU7Z0JBQ3ZFLE1BQU15QixxQkFBcUJOLG1CQUFtQlAsTUFBTSxDQUFDeEIsQ0FBQUEsSUFBS0EsRUFBRVksV0FBVyxLQUFLQSxZQUFZLENBQUMsRUFBRTtnQkFFM0YsSUFBSXdCLE9BQU87b0JBQ1AsTUFBTXhELG1EQUFFQSxDQUFDMEQsTUFBTSxDQUFDeEQsdURBQWVBLEVBQUV5RCxHQUFHLENBQUM7d0JBQ2pDdEMsTUFBTTs0QkFDRixHQUFHbUMsTUFBTW5DLElBQUk7NEJBQ2IsR0FBR0EsSUFBSTt3QkFDWDtvQkFDSixHQUFHNkIsS0FBSyxDQUFDM0QsK0NBQUVBLENBQUNXLHVEQUFlQSxDQUFDMEQsRUFBRSxFQUFFSixNQUFNSSxFQUFFO29CQUN4Q0w7Z0JBQ0osT0FBTyxJQUFJRSxvQkFBb0I7b0JBQzNCSCxVQUFVckIsSUFBSSxDQUFDO3dCQUNYRCxhQUFheUIsbUJBQW1CekIsV0FBVzt3QkFDM0NULFVBQVVrQyxtQkFBbUJsQyxRQUFRO3dCQUNyQ08sVUFBVVQsS0FBS1MsUUFBUTt3QkFDdkJULE1BQU07NEJBQ0YsR0FBR29DLGtCQUFrQjs0QkFDckIsR0FBR3BDLElBQUk7NEJBQ1B3QyxTQUFTeEMsS0FBS3dDLE9BQU8sSUFBS0osbUJBQW1CSSxPQUFPLEdBQUc7d0JBQzNEO29CQUNKO2dCQUNKO1lBQ0o7WUFFQSxJQUFJUCxVQUFVNUIsTUFBTSxFQUFFO2dCQUNsQixNQUFNMUIsbURBQUVBLENBQUNtQyxNQUFNLENBQUNqQyx1REFBZUEsRUFBRWtDLE1BQU0sQ0FBQ2tCO2dCQUN4QyxJQUFJMUMsTUFBTXlCLGlCQUFpQnRDLG1EQUFNQSxDQUFDdUMsSUFBSSxDQUFDLGdCQUFnQjtZQUMzRDtZQUVBLElBQUlpQixlQUFlO2dCQUFBLElBQUkzQyxNQUFNeUIsaUJBQWlCdEMsbURBQU1BLENBQUN1QyxJQUFJLENBQUMsZ0JBQWdCO1lBQTBCO1FBQ3hHO0lBQ0osRUFBRSxPQUFNQyxHQUFRO1FBQ1oxQixRQUFRQyxPQUFPLEdBQUc7UUFDbEJELFFBQVFHLEtBQUssR0FBR3VCLEVBQUVDLE9BQU87UUFDekIxQyxtREFBTUEsQ0FBQ2tCLEtBQUssQ0FBQyx5QkFBeUJ1QjtJQUMxQyxTQUFVO1FBQ04sT0FBTzFCO0lBQ1g7QUFDSjtBQUVPLGVBQWVpRCxrQkFBa0JsRCxJQUl2QztJQUNHLE1BQU0sRUFBRUQsaUJBQWlCLEVBQUVELG1CQUFtQixFQUFHLEdBQUc7UUFBRSxHQUFHRSxJQUFJO0lBQUU7SUFFL0QsTUFBTUMsVUFBb0Q7UUFBRUMsU0FBUztJQUFLO0lBQzFFLE1BQU1pRCxTQUFtQixFQUFFO0lBRTNCLElBQUk7UUFDQSxJQUFJQyxVQUFzQyxFQUFFO1FBQzVDLElBQUlDLFVBQTJDLEVBQUU7UUFFakQsSUFBSXRELG1CQUFtQmUsVUFBVWhCLHFCQUFxQmdCLFFBQVE7WUFDMUQsTUFBTXdDLE1BQU0sTUFBTWxFLG1EQUFFQSxDQUFDZ0QsS0FBSyxDQUFDOUMsZUFBZSxDQUFDK0MsUUFBUSxDQUFDO2dCQUNoREMsT0FBT3RELCtDQUFFQSxDQUNMLENBQUNlLG1CQUFtQmUsU0FBU29CLFlBQVl0RCxvREFBT0EsQ0FBQ1UsdURBQWVBLENBQUNxQixRQUFRLEVBQUVaLG9CQUMzRSxDQUFDQSxtQkFBbUJlLFNBQVNvQixZQUFZdEQsb0RBQU9BLENBQUNVLHVEQUFlQSxDQUFDc0IsYUFBYSxFQUFFYixvQkFDaEYsQ0FBQ0QscUJBQXFCZ0IsU0FBU29CLFlBQVl0RCxvREFBT0EsQ0FBQ1UsdURBQWVBLENBQUM4QixXQUFXLEVBQUV0QixzQkFDaEYsQ0FBQ0EscUJBQXFCZ0IsU0FBU29CLFlBQVl0RCxvREFBT0EsQ0FBQ1UsdURBQWVBLENBQUNpRSxnQkFBZ0IsRUFBRXpEO2dCQUV6RjBELFNBQVM7b0JBQUVwQyxhQUFhO29CQUFNbUMsa0JBQWtCO2dCQUFNO1lBQzFEO1lBRUFILFVBQVVFLElBQUl0QixNQUFNLENBQUN4QixDQUFBQSxJQUFLQSxFQUFFWSxXQUFXLEVBQUVILEdBQUcsQ0FBQ1QsQ0FBQUEsSUFBTTtvQkFBRVksYUFBYVosRUFBRVksV0FBVztnQkFBRTtZQUNqRmlDLFVBQVVDLElBQUl0QixNQUFNLENBQUN4QixDQUFBQSxJQUFLLENBQUNBLEVBQUVZLFdBQVcsRUFBRUgsR0FBRyxDQUFDVCxDQUFBQSxJQUFNO29CQUFFK0Msa0JBQWtCL0MsRUFBRStDLGdCQUFnQjtnQkFBRTtRQUNoRyxPQUFPO1lBQ0gsTUFBTUUsbUJBQW1CLE1BQU1yRSxtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQzlDLGVBQWUsQ0FBQytDLFFBQVEsQ0FBQztnQkFDN0RDLE9BQU96RCxzREFBU0EsQ0FBQ1MsdURBQWVBLENBQUNxQixRQUFRO2dCQUN6QzZDLFNBQVM7b0JBQUVwQyxhQUFhO29CQUFNbUMsa0JBQWtCO2dCQUFNO1lBQzFEO1lBQ0FILFVBQVVLLGlCQUFpQnpCLE1BQU0sQ0FBQ3hCLENBQUFBLElBQUtBLEVBQUVZLFdBQVcsRUFBRUgsR0FBRyxDQUFDVCxDQUFBQSxJQUFNO29CQUFFWSxhQUFhWixFQUFFWSxXQUFXO2dCQUFFO1lBQzlGaUMsVUFBVUksaUJBQWlCekIsTUFBTSxDQUFDeEIsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFWSxXQUFXLEVBQUVILEdBQUcsQ0FBQ1QsQ0FBQUEsSUFBTTtvQkFBRStDLGtCQUFrQi9DLEVBQUUrQyxnQkFBZ0I7Z0JBQUU7UUFDN0c7UUFFQSxJQUFJSCxRQUFRdEMsTUFBTSxFQUFFO1lBQ2hCLE1BQU13QyxNQUFNLE1BQU1JLGlCQUFpQk47WUFDbkNFLElBQUluQyxPQUFPLENBQUNYLENBQUFBLElBQUtBLEVBQUVKLEtBQUssSUFBSStDLE9BQU85QixJQUFJLENBQUNiLEVBQUVKLEtBQUs7UUFDbkQ7UUFFQSxJQUFJaUQsUUFBUXZDLE1BQU0sRUFBRTtZQUNoQixNQUFNd0MsTUFBTSxNQUFNSyxpQkFBaUJOO1lBQ25DQyxJQUFJSCxNQUFNLEVBQUVoQyxRQUFRUSxDQUFBQSxJQUFLd0IsT0FBTzlCLElBQUksQ0FBQ007UUFDekM7UUFFQSxJQUFJd0IsT0FBT3JDLE1BQU0sRUFBRTtZQUNmYixRQUFRQyxPQUFPLEdBQUc7WUFDbEJELFFBQVFrRCxNQUFNLEdBQUdBO1lBQ2pCakUsbURBQU1BLENBQUNrQixLQUFLLENBQUMsNEJBQTRCK0M7UUFDN0M7SUFDSixFQUFFLE9BQU14QixHQUFRO1FBQ1oxQixRQUFRQyxPQUFPLEdBQUc7UUFDbEJELFFBQVFrRCxNQUFNLEdBQUc7WUFBQ3hCLEVBQUVDLE9BQU87U0FBQztRQUM1QjFDLG1EQUFNQSxDQUFDa0IsS0FBSyxDQUFDLDJCQUEyQnVCO0lBQzVDLFNBQVU7UUFDTixPQUFPMUI7SUFDWDtBQUNKO0FBRU8sZUFBZTJELGlCQUNsQkMsWUFBc0IsRUFDdEI3RCxJQUVDO0lBRUQsSUFBSTZELGFBQWEvQyxNQUFNLEVBQUU7UUFDckIsTUFBTXdCLFFBQVExRCxvREFBT0EsQ0FBQ1MsaURBQVNBLENBQUMrQixXQUFXLEVBQUV5QztRQUU3QyxNQUFNQyxRQUFRLE1BQU0xRSxtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQy9DLFNBQVMsQ0FBQ2dELFFBQVEsQ0FBQztZQUM1Q0M7UUFDSjtRQUVBLE1BQU1FLFlBQVksSUFBSXVCO1FBRXRCLE1BQU0zRSxtREFBRUEsQ0FDSDBELE1BQU0sQ0FBQ3pELGlEQUFTQSxFQUNoQjBELEdBQUcsQ0FBQztZQUFFUDtRQUFXLEdBQ2pCRixLQUFLLENBQUNBO1FBRVgsTUFBTWxELG1EQUFFQSxDQUFDNEUsTUFBTSxDQUFDMUUsdURBQWVBLEVBQUVnRCxLQUFLLENBQUM3RCxnREFBR0EsQ0FDdENJLHNEQUFTQSxDQUFDUyx1REFBZUEsQ0FBQzhCLFdBQVcsR0FDckN4QyxvREFBT0EsQ0FBQ1UsdURBQWVBLENBQUM4QixXQUFXLEVBQUV5QztRQUd6QyxNQUFNekUsbURBQUVBLENBQUNtQyxNQUFNLENBQUNoQyx3REFBZ0JBLEVBQUVpQyxNQUFNLENBQUNzQyxNQUFNN0MsR0FBRyxDQUFDZ0QsQ0FBQUEsT0FBUztnQkFDeERoQixTQUFTZ0IsS0FBS2hCLE9BQU87Z0JBQ3JCN0IsYUFBYTZDLEtBQUs3QyxXQUFXO2dCQUM3QlQsVUFBVXNELEtBQUt0RCxRQUFRO2dCQUN2QnVELFNBQVM7b0JBQ0xDLFFBQVE7b0JBQ1JDLGdCQUFnQjtvQkFDaEJDLFdBQVc7d0JBQUM7NEJBQUU3QixXQUFXO3dCQUFNO3FCQUFFO29CQUNqQzhCLFdBQVc7d0JBQUM7NEJBQUU5Qjt3QkFBVTtxQkFBRTtnQkFDOUI7WUFDSjtRQUVBLElBQUl4QyxNQUFNeUIsaUJBQWlCdEMsbURBQU1BLENBQUN1QyxJQUFJLENBQUMsZ0JBQWdCO0lBQzNEO0lBQ0EsT0FBTztBQUNYO0FBRU8sZUFBZWlDLGlCQUNsQmxELElBRUksRUFDSlQsSUFHQztJQUVELElBQUlDLFVBSUE7UUFBRXNFLFVBQVUsRUFBRTtRQUFFckUsU0FBUztJQUFPO0lBRXBDLElBQUk7UUFDQSxNQUFNSyxhQUE4QyxFQUFFO1FBRXRELElBQUk0QixTQUFTLENBQUMxQixLQUFLSyxNQUFNLEdBQUcsRUFBRSxHQUFHLE1BQU0xQixtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQzlDLGVBQWUsQ0FBQytDLFFBQVEsQ0FBQztZQUNyRUMsT0FBTzFELG9EQUFPQSxDQUFDVSx1REFBZUEsQ0FBQ2lFLGdCQUFnQixFQUFFOUMsS0FBS1EsR0FBRyxDQUFDdUQsQ0FBQUEsSUFBS0EsRUFBRWpCLGdCQUFnQjtRQUNyRjtRQUVBLDJDQUEyQztRQUMzQyxJQUFJa0IsYUFBOEMsRUFBRTtRQUNwRCxJQUFJdEMsT0FBT0gsTUFBTSxDQUFDd0MsQ0FBQUEsSUFBS0EsRUFBRXBELFdBQVcsRUFBRU4sTUFBTSxFQUFFO1lBQzFDMkQsYUFBYSxNQUFNckYsbURBQUVBLENBQUNnRCxLQUFLLENBQUMvQyxTQUFTLENBQUNnRCxRQUFRLENBQUM7Z0JBQzNDQyxPQUFPMUQsb0RBQU9BLENBQUNTLGlEQUFTQSxDQUFDK0IsV0FBVyxFQUFFZSxPQUFPSCxNQUFNLENBQUN3QyxDQUFBQSxJQUFLQSxFQUFFcEQsV0FBVyxFQUFFSCxHQUFHLENBQUN1RCxDQUFBQSxJQUFLQSxFQUFFcEQsV0FBVztZQUNsRztRQUNKO1FBRUEsS0FBSSxNQUFNLEVBQUU0QixFQUFFLEVBQUVyQyxVQUFVK0QsU0FBUyxFQUFFakUsSUFBSSxFQUFFLElBQUkwQixPQUFRO1lBQ25ELE1BQU1mLGNBQWNYLEtBQUtXLFdBQVcsSUFBSW5DLGdEQUFFQTtZQUMxQyxNQUFNMEIsV0FBWUYsS0FBS0UsUUFBUSxJQUFJK0Q7WUFDbkMsTUFBTTVDLFVBQVU7Z0JBQUUsR0FBR3JCLElBQUk7Z0JBQUVXO2dCQUFhVDtZQUFTO1lBQ2pESixXQUFXYyxJQUFJLENBQUNTO1lBQ2hCSyxTQUFTQSxPQUFPbEIsR0FBRyxDQUFDMEQsQ0FBQUE7Z0JBQ2hCLElBQUlBLEVBQUUzQixFQUFFLEtBQUtBLElBQUkyQixFQUFFbEUsSUFBSSxDQUFDVyxXQUFXLEdBQUdBO2dCQUN0QyxPQUFPdUQ7WUFDWDtZQUNBLElBQUk7Z0JBQ0EsTUFBTXZGLG1EQUFFQSxDQUFDbUMsTUFBTSxDQUFDbEMsaURBQVNBLEVBQUVtQyxNQUFNLENBQUNNO1lBQ3RDLEVBQUUsT0FBTUgsR0FBUTtnQkFDWjFCLFFBQVFrRCxNQUFNLEdBQUc7dUJBQUtsRCxRQUFRa0QsTUFBTSxJQUFJLEVBQUU7b0JBQUcsQ0FBQyxnQkFBZ0IsRUFBRTFDLEtBQUttRSxJQUFJLENBQUMsR0FBRyxFQUFFakQsRUFBRUMsT0FBTyxDQUFDLENBQUM7aUJBQUM7WUFDL0Y7UUFDSjtRQUVBLE1BQU0yQyxXQUFXLE1BQU05RSxpRUFBYUEsQ0FBQztZQUFFb0UsY0FBY3RELFdBQVdVLEdBQUcsQ0FBQ3VELENBQUFBLElBQUtBLEVBQUVwRCxXQUFXO1FBQUk7UUFFMUZuQixRQUFRc0UsUUFBUSxHQUFHdkUsTUFBTTZFLGlCQUFpQk4sU0FBUzlELElBQUksR0FBRyxFQUFFO1FBQzVEUixRQUFRQyxPQUFPLEdBQUc7UUFFbEIsTUFBTTRFLHNCQUFzQjtZQUFFM0MsUUFBUUE7WUFBUTRDLFVBQVVOO1FBQVk7UUFFcEUsSUFBSXRDLE9BQU9yQixNQUFNLEVBQUU7WUFDZixNQUFNMUIsbURBQUVBLENBQUM0RSxNQUFNLENBQUMxRSx1REFBZUEsRUFBRWdELEtBQUssQ0FBQzFELG9EQUFPQSxDQUFDVSx1REFBZUEsQ0FBQzBELEVBQUUsRUFBRWIsT0FBT2xCLEdBQUcsQ0FBQzBELENBQUFBLElBQUtBLEVBQUUzQixFQUFFO1FBQzNGO1FBRUEsSUFBSWhELE1BQU15QixpQkFBaUJ0QyxtREFBTUEsQ0FBQ3VDLElBQUksQ0FBQyxnQkFBZ0I7SUFDM0QsRUFBRSxPQUFNQyxHQUFRO1FBQ1oxQixRQUFRa0QsTUFBTSxHQUFHO1lBQUN4QixFQUFFQyxPQUFPO1NBQUM7UUFDNUIxQyxtREFBTUEsQ0FBQ2tCLEtBQUssQ0FBQywwQkFBMEJ1QixFQUFFQyxPQUFPO0lBQ3BELFNBQVU7UUFDTixPQUFPM0I7SUFDWDtBQUNKO0FBRU8sZUFBZXlELGlCQUNsQmpELElBRUksRUFDSlQsSUFHQztJQUVELE1BQU1DLFVBSUMsRUFBRTtJQUVULElBQUlrQyxTQUFTLENBQUMxQixLQUFLSyxNQUFNLEdBQUcsRUFBRSxHQUFHLE1BQU0xQixtREFBRUEsQ0FBQ2dELEtBQUssQ0FBQzlDLGVBQWUsQ0FBQytDLFFBQVEsQ0FBQztRQUNyRUMsT0FBTzFELG9EQUFPQSxDQUFDVSx1REFBZUEsQ0FBQzhCLFdBQVcsRUFBRVgsS0FBS1EsR0FBRyxDQUFDdUQsQ0FBQUEsSUFBS0EsRUFBRXBELFdBQVc7SUFDM0U7SUFFQSwyQ0FBMkM7SUFDM0MsSUFBSXFELGFBQThDLEVBQUU7SUFDcEQsSUFBSXRDLE9BQU9ILE1BQU0sQ0FBQ3dDLENBQUFBLElBQUtBLEVBQUVwRCxXQUFXLEVBQUVOLE1BQU0sRUFBRTtRQUMxQzJELGFBQWEsTUFBTXJGLG1EQUFFQSxDQUFDZ0QsS0FBSyxDQUFDL0MsU0FBUyxDQUFDZ0QsUUFBUSxDQUFDO1lBQzNDQyxPQUFPMUQsb0RBQU9BLENBQUNTLGlEQUFTQSxDQUFDK0IsV0FBVyxFQUFFZSxPQUFPSCxNQUFNLENBQUN3QyxDQUFBQSxJQUFLQSxFQUFFcEQsV0FBVyxFQUFFSCxHQUFHLENBQUN1RCxDQUFBQSxJQUFLQSxFQUFFcEQsV0FBVztRQUNsRztJQUNKO0lBRUEsS0FBSSxNQUFNLEVBQUVBLGFBQWE0RCxZQUFZLEVBQUV2RSxNQUFNK0QsQ0FBQyxFQUFFLElBQUlyQyxPQUFRO1FBQ3hELE1BQU1mLGNBQWM0RDtRQUVwQixNQUFNLEVBQUU1RCxhQUFhNkQsYUFBYSxFQUFFakMsRUFBRSxFQUFFMUIsY0FBYyxFQUFFNEQsU0FBUyxFQUFFQyxTQUFTLEVBQUUzQyxTQUFTLEVBQUUsR0FBR1YsU0FBUyxHQUFHMEM7UUFFeEcsSUFBSTtZQUNBLE1BQU1wQixVQUFVO2dCQUNaLEdBQUd0QixPQUFPO2dCQUNWc0QsYUFBYSxJQUFJckI7WUFDckI7WUFDQSxNQUFNM0UsbURBQUVBLENBQ0gwRCxNQUFNLENBQUN6RCxpREFBU0EsRUFDaEIwRCxHQUFHLENBQUNLLFNBQ0pkLEtBQUssQ0FBQzNELCtDQUFFQSxDQUFDVSxpREFBU0EsQ0FBQytCLFdBQVcsRUFBRUE7WUFFckMsTUFBTWlFLFlBQVksQ0FBQ3JGLE1BQU1zRixnQkFBZ0JwRCxZQUFZLE1BQU0xQyxpRUFBYUEsQ0FBQzRCO1lBRXpFbkIsUUFBUW9CLElBQUksQ0FBQztnQkFBRUQ7Z0JBQWFpRTtZQUFXO1FBQzNDLEVBQUUsT0FBTTFELEdBQVE7WUFDWnpDLG1EQUFNQSxDQUFDa0IsS0FBSyxDQUFDLENBQUMsNkJBQTZCLEVBQUVnQixZQUFZLENBQUMsRUFBRU8sRUFBRUMsT0FBTztZQUNyRTNCLFFBQVFvQixJQUFJLENBQUM7Z0JBQUVEO2dCQUFhaEIsT0FBT3VCLEVBQUVDLE9BQU87WUFBRTtZQUM5Q08sU0FBU0EsT0FBT0gsTUFBTSxDQUFDd0MsQ0FBQUEsSUFBS0EsRUFBRS9ELElBQUksQ0FBQ1csV0FBVyxLQUFLQTtRQUN2RDtJQUNKO0lBRUEsTUFBTTBELHNCQUFzQjtRQUFFM0MsUUFBUUE7UUFBUTRDLFVBQVVOO0lBQVk7SUFFcEUsSUFBSXRDLE9BQU9yQixNQUFNLEVBQUU7UUFDZixNQUFNMUIsbURBQUVBLENBQUM0RSxNQUFNLENBQUMxRSx1REFBZUEsRUFBRWdELEtBQUssQ0FBQzFELG9EQUFPQSxDQUFDVSx1REFBZUEsQ0FBQzBELEVBQUUsRUFBRWIsT0FBT2xCLEdBQUcsQ0FBQzBELENBQUFBLElBQUtBLEVBQUUzQixFQUFFO0lBQzNGO0lBRUEsSUFBSWhELE1BQU15QixpQkFBaUJ0QyxtREFBTUEsQ0FBQ3VDLElBQUksQ0FBQyxnQkFBZ0I7SUFFdkQsT0FBT3pCO0FBQ1g7QUFFTyxlQUFlNkUsc0JBQXNCLEVBQUVDLFFBQVEsRUFBRTVDLE1BQU0sRUFHN0Q7SUFDRyxJQUFJO1FBQ0EsTUFBTTVCLGFBQXFELEVBQUU7UUFFN0QsS0FBSSxNQUFNaUUsS0FBS3JDLE9BQVE7WUFDbkIsTUFBTW9ELG9CQUEwRDtnQkFDNUR0QyxTQUFTdUIsR0FBRy9ELE1BQU13QyxXQUFXO2dCQUM3QjdCLGFBQWFvRCxHQUFHL0QsTUFBTVc7Z0JBQ3RCVCxVQUFVNkQsR0FBRy9ELE1BQU1FO2dCQUNuQnVELFNBQVMsQ0FBQztZQUNkO1lBRUEsSUFBSU0sR0FBRy9ELE1BQU13QyxZQUFZLEdBQUc7Z0JBQ3hCc0Msa0JBQWtCckIsT0FBTyxHQUFHO29CQUN4QkMsUUFBUTtvQkFDUkMsZ0JBQWdCO29CQUNoQkMsV0FBVyxFQUFFO29CQUNiQyxXQUFXLEVBQUU7Z0JBQ2pCO1lBQ0osT0FBTztnQkFDSCxNQUFNa0IsT0FBT1QsU0FBUy9DLE1BQU0sQ0FBQ3lELENBQUFBLFFBQVNBLE1BQU1yRSxXQUFXLEtBQUtvRCxHQUFHL0QsTUFBTVcsWUFBWSxDQUFDLEVBQUU7Z0JBRXBGLE1BQU1pRCxZQUFtQixFQUFFO2dCQUMzQixNQUFNQyxZQUFtQixFQUFFO2dCQUUzQm9CLE9BQU9DLElBQUksQ0FBRTtvQkFBRSxHQUFHbkIsR0FBRy9ELElBQUk7Z0JBQUMsR0FDckJ1QixNQUFNLENBQUM0RCxDQUFBQSxNQUFPLENBQUM7d0JBQUM7d0JBQVc7cUJBQVEsQ0FBQ0MsUUFBUSxDQUFDRCxNQUM3Q3pFLE9BQU8sQ0FBQzJFLENBQUFBO29CQUNMLE1BQU1GLE1BQU1FO29CQUNaLE1BQU1DLFdBQVd2QixFQUFFL0QsSUFBSSxDQUFDbUYsSUFBSTtvQkFDNUIsTUFBTUksV0FBVzt3QkFBRyxHQUFHUixJQUFJO29CQUFDLENBQUUsQ0FBQ0ksSUFBeUI7b0JBQ3hELElBQUlLLEtBQUtDLFNBQVMsQ0FBQ0gsY0FBY0UsS0FBS0MsU0FBUyxDQUFDRixXQUFXO3dCQUN2RDNCLFVBQVVoRCxJQUFJLENBQUM7NEJBQUUsQ0FBQ3VFLElBQUksRUFBRUk7d0JBQVU7d0JBQ2xDMUIsVUFBVWpELElBQUksQ0FBQzs0QkFBRSxDQUFDdUUsSUFBSSxFQUFFRzt3QkFBVTtvQkFDdEM7Z0JBQ0o7Z0JBRUpSLGtCQUFrQnJCLE9BQU8sR0FBRztvQkFDeEJDLFFBQVE7b0JBQ1JDLGdCQUFnQjtvQkFDaEJDO29CQUNBQztnQkFDSjtZQUNKO1lBRUEvRCxXQUFXYyxJQUFJLENBQUNrRTtRQUNwQjtRQUVBLE1BQU1uRyxtREFBRUEsQ0FBQ21DLE1BQU0sQ0FBQ2hDLHdEQUFnQkEsRUFBRWlDLE1BQU0sQ0FBQ2pCO0lBQzdDLEVBQUUsT0FBTW9CLEdBQVE7UUFDWnpDLG1EQUFNQSxDQUFDa0IsS0FBSyxDQUFDdUIsRUFBRUMsT0FBTztJQUMxQjtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL2RpYWdub3Nlcy50cz83MDIwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuZCwgYXNjLCBkZXNjLCBlcSwgaW5BcnJheSwgaXNOb3ROdWxsLCBpc051bGwsIG5vdEluQXJyYXksIG9yIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgeyB2NCB9IGZyb20gXCJ1dWlkXCI7XG5cbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuaW1wb3J0IHNvY2tldCAgZnJvbSAnQC9saWIvc29ja2V0JztcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgZGlhZ25vc2VzLCBkaWFnbm9zZXNEcmFmdHMsIGRpYWdub3Nlc0hpc3RvcnkgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgeyBfZ2V0RGlhZ25vc2lzLCBfZ2V0RGlhZ25vc2VzLCBfbGlzdFJhd0RpYWdub3NlcywgX2xpc3REaWFnbm9zZXMgfSBmcm9tICcuLi9xdWVyaWVzL2RpYWdub3Nlcyc7XG5pbXBvcnQgeyBfbGlzdFNjcmlwdHMgfSBmcm9tIFwiLi4vcXVlcmllcy9fc2NyaXB0c1wiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NvcHlEaWFnbm9zZXMoXG4gICAgeyBkaWFnbm9zZXNSZWZlcmVuY2VzLCBzY3JpcHRzUmVmZXJlbmNlcyB9OiB7IFxuICAgICAgICBkaWFnbm9zZXNSZWZlcmVuY2VzOiBzdHJpbmdbXSwgXG4gICAgICAgIHNjcmlwdHNSZWZlcmVuY2VzOiBzdHJpbmdbXTsgXG4gICAgfSxcbiAgICBvcHRzPzoge1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlc3VsdHM6IHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmc7IGRhdGE/OiBhbnk7IH0gPSB7IHN1Y2Nlc3M6IHRydWUgfTsgXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGlhZ25vc2VzTGlzdCA9IGF3YWl0IF9saXN0UmF3RGlhZ25vc2VzKHsgZGlhZ25vc2VzUmVmZXJlbmNlcyB9KTtcblxuICAgICAgICBpZiAoZGlhZ25vc2VzTGlzdC5lcnJvcikgdGhyb3cgbmV3IEVycm9yKGRpYWdub3Nlc0xpc3QuZXJyb3IpO1xuXG4gICAgICAgIGNvbnN0IHNjcmlwdHNMaXN0ID0gYXdhaXQgX2xpc3RTY3JpcHRzKHNjcmlwdHNSZWZlcmVuY2VzKTtcblxuICAgICAgICBpZiAoc2NyaXB0c0xpc3QuZXJyb3IpIHRocm93IG5ldyBFcnJvcihzY3JpcHRzTGlzdC5lcnJvcik7XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIGRpYWdub3Nlc0RyYWZ0cy4kaW5mZXJJbnNlcnRbXSA9IFtdO1xuXG4gICAgICAgIGZvciAoY29uc3QgcyBvZiBzY3JpcHRzTGlzdC5kYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBzY3JpcHREaWFnbm9zZXNMaXN0ID0gYXdhaXQgX2xpc3REaWFnbm9zZXMoeyBzY3JpcHRzUmVmZXJlbmNlczogW3Muc2NyaXB0SWQhIHx8IHMuc2NyaXB0RHJhZnRJZCFdLCB9KTtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RQb3NpdGlvbiA9IHNjcmlwdERpYWdub3Nlc0xpc3QuZGF0YS5sZW5ndGggPyBNYXRoLm1heCguLi5zY3JpcHREaWFnbm9zZXNMaXN0LmRhdGEubWFwKHMgPT4gcy5wb3NpdGlvbikpIDogMDtcbiAgICAgICAgICAgIGxldCBwb3NpdGlvbiA9IGxhc3RQb3NpdGlvbiArIDE7XG5cbiAgICAgICAgICAgIGRpYWdub3Nlc0xpc3QuZGF0YS5mb3JFYWNoKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpYWdub3Npc0lkID0gdjQoKTtcbiAgICAgICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlhZ25vc2lzSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCEsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGREaWFnbm9zaXNJZDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGlhZ25vc2lzSWQsXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdElkOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24rKztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydERhdGEubGVuZ3RoKSBhd2FpdCBkYi5pbnNlcnQoZGlhZ25vc2VzRHJhZnRzKS52YWx1ZXMoaW5zZXJ0RGF0YSk7XG5cbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdjcmVhdGVfZGlhZ25vc2VzX2RyYWZ0cycpO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jb3B5RGlhZ25vc2VzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfdXBkYXRlRGlhZ25vc2VzV2l0aG91dFB1Ymxpc2hpbmcoXG4gICAgcGF5bG9hZDogeyBcbiAgICAgICAgZGlhZ25vc2lzSWQ6IHN0cmluZztcbiAgICAgICAgc2NyaXB0UmVmZXJlbmNlOiBzdHJpbmc7IFxuICAgICAgICBkYXRhOiBQYXJ0aWFsPHR5cGVvZiBkaWFnbm9zZXNEcmFmdHMuJGluZmVySW5zZXJ0WydkYXRhJ10+OyAgXG4gICAgfVtdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZzsgZGF0YT86IGFueTsgfSA9IHsgc3VjY2VzczogdHJ1ZSB9OyBcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdHNSZWZlcmVuY2VzID0gcGF5bG9hZC5tYXAocyA9PiBzLnNjcmlwdFJlZmVyZW5jZSkuZmlsdGVyKHMgPT4gcyk7XG5cbiAgICAgICAgY29uc3Qgd2hlcmVTY3JpcHQgPSAhc2NyaXB0c1JlZmVyZW5jZXMubGVuZ3RoID8gdW5kZWZpbmVkIDogb3IoXG4gICAgICAgICAgICBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5zY3JpcHRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICApO1xuXG4gICAgICAgIGlmICh3aGVyZVNjcmlwdCkge1xuICAgICAgICAgICAgY29uc3QgZHJhZnRzID0gYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogd2hlcmVTY3JpcHQsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHB1Ymxpc2hlZERpYWdub3NlczogdHlwZW9mIGRpYWdub3Nlcy4kaW5mZXJTZWxlY3RbXSA9IFtdO1xuICAgICAgICAgICAgaWYgKHNjcmlwdHNSZWZlcmVuY2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHB1Ymxpc2hlZERpYWdub3NlcyA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiBhbmQoLi4uW1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNOdWxsKGRpYWdub3Nlcy5kZWxldGVkQXQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5BcnJheShkaWFnbm9zZXMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLihkcmFmdHMuZmlsdGVyKHMgPT4gcy5kaWFnbm9zaXNJZCkubGVuZ3RoID8gW25vdEluQXJyYXkoZGlhZ25vc2VzLmRpYWdub3Npc0lkLCBkcmFmdHMubWFwKHMgPT4gcy5kaWFnbm9zaXNJZCEpKV0gOiBbXSksXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiBhc2MoZGlhZ25vc2VzLnBvc2l0aW9uKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgbmV3RHJhZnRzOiB0eXBlb2YgZGlhZ25vc2VzRHJhZnRzLiRpbmZlckluc2VydFtdID0gW107XG4gICAgICAgICAgICBsZXQgdXBkYXRlZERyYWZ0cyA9IDA7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgeyBkaWFnbm9zaXNJZCwgZGF0YSB9IG9mIHBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkcmFmdCA9IGRyYWZ0cy5maWx0ZXIocyA9PiBzLmRhdGEuZGlhZ25vc2lzSWQgPT09IGRpYWdub3Npc0lkKVswXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwdWJsaXNoZWREaWFnbm9zaXMgPSBwdWJsaXNoZWREaWFnbm9zZXMuZmlsdGVyKHMgPT4gcy5kaWFnbm9zaXNJZCA9PT0gZGlhZ25vc2lzSWQpWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRyYWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShkaWFnbm9zZXNEcmFmdHMpLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZHJhZnQuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSkud2hlcmUoZXEoZGlhZ25vc2VzRHJhZnRzLmlkLCBkcmFmdC5pZCkpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkRHJhZnRzKys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwdWJsaXNoZWREaWFnbm9zaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RHJhZnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhZ25vc2lzSWQ6IHB1Ymxpc2hlZERpYWdub3Npcy5kaWFnbm9zaXNJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdElkOiBwdWJsaXNoZWREaWFnbm9zaXMuc2NyaXB0SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZGF0YS5wb3NpdGlvbiEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHVibGlzaGVkRGlhZ25vc2lzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZGF0YS52ZXJzaW9uIHx8IChwdWJsaXNoZWREaWFnbm9zaXMudmVyc2lvbiArIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3RHJhZnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChkaWFnbm9zZXNEcmFmdHMpLnZhbHVlcyhuZXdEcmFmdHMpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX2RpYWdub3Nlc19kcmFmdHMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVwZGF0ZWREcmFmdHMpIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAndXBkYXRlX2RpYWdub3Nlc19kcmFmdHMnKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19vcmRlckRpYWdub3NlcyBFUlJPUicsIGUpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9wdWJsaXNoRGlhZ25vc2VzKG9wdHM/OiB7XG4gICAgc2NyaXB0c1JlZmVyZW5jZXM/OiBzdHJpbmdbXTtcbiAgICBkaWFnbm9zZXNSZWZlcmVuY2VzPzogc3RyaW5nW107XG4gICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB7IHNjcmlwdHNSZWZlcmVuY2VzLCBkaWFnbm9zZXNSZWZlcmVuY2VzLCB9ID0geyAuLi5vcHRzLCB9O1xuXG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCB1cGRhdGVzOiB7IGRpYWdub3Npc0lkOiBzdHJpbmc7IH1bXSA9IFtdO1xuICAgICAgICBsZXQgaW5zZXJ0czogeyBkaWFnbm9zaXNEcmFmdElkOiBzdHJpbmc7IH1bXSA9IFtdO1xuXG4gICAgICAgIGlmIChzY3JpcHRzUmVmZXJlbmNlcz8ubGVuZ3RoIHx8IGRpYWdub3Nlc1JlZmVyZW5jZXM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogb3IoXG4gICAgICAgICAgICAgICAgICAgICFzY3JpcHRzUmVmZXJlbmNlcz8ubGVuZ3RoID8gdW5kZWZpbmVkIDogaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICAgICAgIXNjcmlwdHNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgICAgICFkaWFnbm9zZXNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCwgZGlhZ25vc2VzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgICAgICFkaWFnbm9zZXNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNEcmFmdElkLCBkaWFnbm9zZXNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHsgZGlhZ25vc2lzSWQ6IHRydWUsIGRpYWdub3Npc0RyYWZ0SWQ6IHRydWUsIH0sXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdXBkYXRlcyA9IHJlcy5maWx0ZXIocyA9PiBzLmRpYWdub3Npc0lkKS5tYXAocyA9PiAoeyBkaWFnbm9zaXNJZDogcy5kaWFnbm9zaXNJZCEgfSkpO1xuICAgICAgICAgICAgaW5zZXJ0cyA9IHJlcy5maWx0ZXIocyA9PiAhcy5kaWFnbm9zaXNJZCkubWFwKHMgPT4gKHsgZGlhZ25vc2lzRHJhZnRJZDogcy5kaWFnbm9zaXNEcmFmdElkISB9KSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBfZGlhZ25vc2VzRHJhZnRzID0gYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogaXNOb3ROdWxsKGRpYWdub3Nlc0RyYWZ0cy5zY3JpcHRJZCksXG4gICAgICAgICAgICAgICAgY29sdW1uczogeyBkaWFnbm9zaXNJZDogdHJ1ZSwgZGlhZ25vc2lzRHJhZnRJZDogdHJ1ZSwgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdXBkYXRlcyA9IF9kaWFnbm9zZXNEcmFmdHMuZmlsdGVyKHMgPT4gcy5kaWFnbm9zaXNJZCkubWFwKHMgPT4gKHsgZGlhZ25vc2lzSWQ6IHMuZGlhZ25vc2lzSWQhIH0pKTtcbiAgICAgICAgICAgIGluc2VydHMgPSBfZGlhZ25vc2VzRHJhZnRzLmZpbHRlcihzID0+ICFzLmRpYWdub3Npc0lkKS5tYXAocyA9PiAoeyBkaWFnbm9zaXNEcmFmdElkOiBzLmRpYWdub3Npc0RyYWZ0SWQhIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1cGRhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgX3VwZGF0ZURpYWdub3Nlcyh1cGRhdGVzKTtcbiAgICAgICAgICAgIHJlcy5mb3JFYWNoKHMgPT4gcy5lcnJvciAmJiBlcnJvcnMucHVzaChzLmVycm9yKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5zZXJ0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IF9jcmVhdGVEaWFnbm9zZXMoaW5zZXJ0cyk7XG4gICAgICAgICAgICByZXMuZXJyb3JzPy5mb3JFYWNoKGUgPT4gZXJyb3JzLnB1c2goZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBlcnJvcnM7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ19wdWJsaXNoRGlhZ25vc2VzIEVSUk9SUycsIGVycm9ycyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbZS5tZXNzYWdlXTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfcHVibGlzaERpYWdub3NlcyBFUlJPUicsIGUpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVEaWFnbm9zZXMoXG4gICAgZGlhZ25vc2lzSWRzOiBzdHJpbmdbXSxcbiAgICBvcHRzPzoge1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGlmIChkaWFnbm9zaXNJZHMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHdoZXJlID0gaW5BcnJheShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIGRpYWdub3Npc0lkcyk7XG5cbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZWRBdCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgIC51cGRhdGUoZGlhZ25vc2VzKVxuICAgICAgICAgICAgLnNldCh7IGRlbGV0ZWRBdCwgfSlcbiAgICAgICAgICAgIC53aGVyZSh3aGVyZSk7XG5cbiAgICAgICAgYXdhaXQgZGIuZGVsZXRlKGRpYWdub3Nlc0RyYWZ0cykud2hlcmUoYW5kKFxuICAgICAgICAgICAgaXNOb3ROdWxsKGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCksXG4gICAgICAgICAgICBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCwgZGlhZ25vc2lzSWRzKVxuICAgICAgICApKTtcblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoZGlhZ25vc2VzSGlzdG9yeSkudmFsdWVzKGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgICB2ZXJzaW9uOiBpdGVtLnZlcnNpb24sXG4gICAgICAgICAgICBkaWFnbm9zaXNJZDogaXRlbS5kaWFnbm9zaXNJZCxcbiAgICAgICAgICAgIHNjcmlwdElkOiBpdGVtLnNjcmlwdElkLFxuICAgICAgICAgICAgY2hhbmdlczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZV9kaWFnbm9zaXMnLFxuICAgICAgICAgICAgICAgIGRlZGlhZ25vc2lzaW9uOiAnRGVsZXRlIGRpYWdub3NpcycsXG4gICAgICAgICAgICAgICAgb2xkVmFsdWVzOiBbeyBkZWxldGVkQXQ6IG51bGwsIH1dLFxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlczogW3sgZGVsZXRlZEF0IH1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpKTtcblxuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9kaWFnbm9zZXMnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY3JlYXRlRGlhZ25vc2VzKFxuICAgIGRhdGE6ICh7XG4gICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHN0cmluZztcbiAgICB9KVtdLCBcbiAgICBvcHRzPzoge1xuICAgICAgICByZXR1cm5JbnNlcnRlZD86IGJvb2xlYW47XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgbGV0IHJlc3VsdHM6IHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgZXJyb3JzPzogc3RyaW5nW107XG4gICAgICAgIGluc2VydGVkOiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXREaWFnbm9zZXM+PlsnZGF0YSddO1xuICAgIH0gPSB7IGluc2VydGVkOiBbXSwgc3VjY2VzczogZmFsc2UsIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnNlcnREYXRhOiB0eXBlb2YgZGlhZ25vc2VzLiRpbmZlckluc2VydFtdID0gW107XG5cbiAgICAgICAgbGV0IGRyYWZ0cyA9ICFkYXRhLmxlbmd0aCA/IFtdIDogYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNEcmFmdElkLCBkYXRhLm1hcChjID0+IGMuZGlhZ25vc2lzRHJhZnRJZCkpLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyB3ZSdsbCB1c2UgZGF0YSBiZWZvcmUgdG8gY29tcGFyZSBjaGFuZ2VzXG4gICAgICAgIGxldCBkYXRhQmVmb3JlOiB0eXBlb2YgZGlhZ25vc2VzLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgICAgIGlmIChkcmFmdHMuZmlsdGVyKGMgPT4gYy5kaWFnbm9zaXNJZCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBkYXRhQmVmb3JlID0gYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogaW5BcnJheShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmRpYWdub3Npc0lkKS5tYXAoYyA9PiBjLmRpYWdub3Npc0lkISkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yKGNvbnN0IHsgaWQsIHNjcmlwdElkOiBfc2NyaXB0SWQsIGRhdGEgfSBvZiBkcmFmdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3Npc0lkID0gZGF0YS5kaWFnbm9zaXNJZCB8fCB2NCgpO1xuICAgICAgICAgICAgY29uc3Qgc2NyaXB0SWQgPSAoZGF0YS5zY3JpcHRJZCB8fCBfc2NyaXB0SWQpITtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IC4uLmRhdGEsIGRpYWdub3Npc0lkLCBzY3JpcHRJZCB9O1xuICAgICAgICAgICAgaW5zZXJ0RGF0YS5wdXNoKHBheWxvYWQpO1xuICAgICAgICAgICAgZHJhZnRzID0gZHJhZnRzLm1hcChkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZC5pZCA9PT0gaWQpIGQuZGF0YS5kaWFnbm9zaXNJZCA9IGRpYWdub3Npc0lkO1xuICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChkaWFnbm9zZXMpLnZhbHVlcyhwYXlsb2FkKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbLi4uKHJlc3VsdHMuZXJyb3JzIHx8IFtdKSwgYEVycm9yIGluc2VydGluZyAke2RhdGEubmFtZX0gLSAke2UubWVzc2FnZX1gXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGluc2VydGVkID0gYXdhaXQgX2dldERpYWdub3Nlcyh7IGRpYWdub3Npc0lkczogaW5zZXJ0RGF0YS5tYXAoYyA9PiBjLmRpYWdub3Npc0lkISksIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuaW5zZXJ0ZWQgPSBvcHRzPy5yZXR1cm5JbnNlcnRlZCA/IGluc2VydGVkLmRhdGEgOiBbXTtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gdHJ1ZTtcblxuICAgICAgICBhd2FpdCBfc2F2ZURpYWdub3Nlc0hpc3RvcnkoeyBkcmFmdHM6IGRyYWZ0cywgcHJldmlvdXM6IGRhdGFCZWZvcmUsIH0pO1xuXG4gICAgICAgIGlmIChkcmFmdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBhd2FpdCBkYi5kZWxldGUoZGlhZ25vc2VzRHJhZnRzKS53aGVyZShpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5pZCwgZHJhZnRzLm1hcChkID0+IGQuaWQpKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9kaWFnbm9zZXMnKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jcmVhdGVEaWFnbm9zZXMgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF91cGRhdGVEaWFnbm9zZXMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgZGlhZ25vc2lzSWQ6IHN0cmluZztcbiAgICB9KVtdLCBcbiAgICBvcHRzPzoge1xuICAgICAgICByZXR1cm5VcGRhdGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiAoeyBcbiAgICAgICAgZGlhZ25vc2lzSWQ6IHN0cmluZztcbiAgICAgICAgZGlhZ25vc2lzPzogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0RGlhZ25vc2lzPj47XG4gICAgICAgIGVycm9yPzogc3RyaW5nOyBcbiAgICB9KVtdID0gW107XG5cbiAgICBsZXQgZHJhZnRzID0gIWRhdGEubGVuZ3RoID8gW10gOiBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzSWQsIGRhdGEubWFwKGMgPT4gYy5kaWFnbm9zaXNJZCkpLFxuICAgIH0pO1xuXG4gICAgLy8gd2UnbGwgdXNlIGRhdGEgYmVmb3JlIHRvIGNvbXBhcmUgY2hhbmdlc1xuICAgIGxldCBkYXRhQmVmb3JlOiB0eXBlb2YgZGlhZ25vc2VzLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgaWYgKGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmRpYWdub3Npc0lkKS5sZW5ndGgpIHtcbiAgICAgICAgZGF0YUJlZm9yZSA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogaW5BcnJheShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmRpYWdub3Npc0lkKS5tYXAoYyA9PiBjLmRpYWdub3Npc0lkISkpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZvcihjb25zdCB7IGRpYWdub3Npc0lkOiBfZGlhZ25vc2lzSWQsIGRhdGE6IGMgfSBvZiBkcmFmdHMpIHtcbiAgICAgICAgY29uc3QgZGlhZ25vc2lzSWQgPSBfZGlhZ25vc2lzSWQhO1xuXG4gICAgICAgIGNvbnN0IHsgZGlhZ25vc2lzSWQ6IF9fZGlhZ25vc2lzSWQsIGlkLCBvbGREaWFnbm9zaXNJZCwgY3JlYXRlZEF0LCB1cGRhdGVkQXQsIGRlbGV0ZWRBdCwgLi4ucGF5bG9hZCB9ID0gYztcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHtcbiAgICAgICAgICAgICAgICAuLi5wYXlsb2FkLFxuICAgICAgICAgICAgICAgIHB1Ymxpc2hEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAgICAgLnVwZGF0ZShkaWFnbm9zZXMpXG4gICAgICAgICAgICAgICAgLnNldCh1cGRhdGVzKVxuICAgICAgICAgICAgICAgIC53aGVyZShlcShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIGRpYWdub3Npc0lkKSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3NpcyA9ICFvcHRzPy5yZXR1cm5VcGRhdGVkID8gdW5kZWZpbmVkIDogYXdhaXQgX2dldERpYWdub3NpcyhkaWFnbm9zaXNJZCk7XG5cbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGRpYWdub3Npc0lkLCBkaWFnbm9zaXMsIH0pO1xuICAgICAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBfdXBkYXRlRGlhZ25vc2VzIGRpYWdub3Npc0lkPSR7ZGlhZ25vc2lzSWR9YCwgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGRpYWdub3Npc0lkLCBlcnJvcjogZS5tZXNzYWdlLCB9KTtcbiAgICAgICAgICAgIGRyYWZ0cyA9IGRyYWZ0cy5maWx0ZXIoYyA9PiBjLmRhdGEuZGlhZ25vc2lzSWQgIT09IGRpYWdub3Npc0lkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGF3YWl0IF9zYXZlRGlhZ25vc2VzSGlzdG9yeSh7IGRyYWZ0czogZHJhZnRzLCBwcmV2aW91czogZGF0YUJlZm9yZSwgfSk7XG5cbiAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBkYi5kZWxldGUoZGlhZ25vc2VzRHJhZnRzKS53aGVyZShpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5pZCwgZHJhZnRzLm1hcChkID0+IGQuaWQpKSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdjcmVhdGVfZGlhZ25vc2VzJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9zYXZlRGlhZ25vc2VzSGlzdG9yeSh7IHByZXZpb3VzLCBkcmFmdHMsIH06IHtcbiAgICBkcmFmdHM6IHR5cGVvZiBkaWFnbm9zZXNEcmFmdHMuJGluZmVyU2VsZWN0W107XG4gICAgcHJldmlvdXM6IHR5cGVvZiBkaWFnbm9zZXMuJGluZmVyU2VsZWN0W107XG59KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIGRpYWdub3Nlc0hpc3RvcnkuJGluZmVySW5zZXJ0W10gPSBbXTtcblxuICAgICAgICBmb3IoY29uc3QgYyBvZiBkcmFmdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZUhpc3RvcnlEYXRhOiB0eXBlb2YgZGlhZ25vc2VzSGlzdG9yeS4kaW5mZXJJbnNlcnQgPSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogYz8uZGF0YT8udmVyc2lvbiB8fCAxLFxuICAgICAgICAgICAgICAgIGRpYWdub3Npc0lkOiBjPy5kYXRhPy5kaWFnbm9zaXNJZCEsXG4gICAgICAgICAgICAgICAgc2NyaXB0SWQ6IGM/LmRhdGE/LnNjcmlwdElkLFxuICAgICAgICAgICAgICAgIGNoYW5nZXM6IHt9LFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGM/LmRhdGE/LnZlcnNpb24gPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VIaXN0b3J5RGF0YS5jaGFuZ2VzID0ge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdjcmVhdGVfZGlhZ25vc2lzJyxcbiAgICAgICAgICAgICAgICAgICAgZGVkaWFnbm9zaXNpb246ICdDcmVhdGUgZGlhZ25vc2lzJyxcbiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2ID0gcHJldmlvdXMuZmlsdGVyKHByZXZDID0+IHByZXZDLmRpYWdub3Npc0lkID09PSBjPy5kYXRhPy5kaWFnbm9zaXNJZClbMF07XG5cbiAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZXM6IGFueVtdID0gW107XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWVzOiBhbnlbXSA9IFtdO1xuXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoKHsgLi4uYz8uZGF0YSB9KSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihrZXkgPT4gIVsndmVyc2lvbicsICdkcmFmdCddLmluY2x1ZGVzKGtleSkpXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKF9rZXkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gX2tleSBhcyB1bmtub3duIGFzIGtleW9mIHR5cGVvZiBjLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGMuZGF0YVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSAoeyAuLi5wcmV2IH0pW2tleSBhcyBrZXlvZiB0eXBlb2YgcHJldl07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkobmV3VmFsdWUpICE9PSBKU09OLnN0cmluZ2lmeShvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZXMucHVzaCh7IFtrZXldOiBvbGRWYWx1ZSwgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVzLnB1c2goeyBba2V5XTogbmV3VmFsdWUsIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNoYW5nZUhpc3RvcnlEYXRhLmNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3VwZGF0ZV9kaWFnbm9zaXMnLFxuICAgICAgICAgICAgICAgICAgICBkZWRpYWdub3Npc2lvbjogJ1VwZGF0ZSBkaWFnbm9zaXMnLFxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZXMsXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlcyxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbnNlcnREYXRhLnB1c2goY2hhbmdlSGlzdG9yeURhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KGRpYWdub3Nlc0hpc3RvcnkpLnZhbHVlcyhpbnNlcnREYXRhKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoZS5tZXNzYWdlKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiYW5kIiwiYXNjIiwiZXEiLCJpbkFycmF5IiwiaXNOb3ROdWxsIiwiaXNOdWxsIiwibm90SW5BcnJheSIsIm9yIiwidjQiLCJsb2dnZXIiLCJzb2NrZXQiLCJkYiIsImRpYWdub3NlcyIsImRpYWdub3Nlc0RyYWZ0cyIsImRpYWdub3Nlc0hpc3RvcnkiLCJfZ2V0RGlhZ25vc2lzIiwiX2dldERpYWdub3NlcyIsIl9saXN0UmF3RGlhZ25vc2VzIiwiX2xpc3REaWFnbm9zZXMiLCJfbGlzdFNjcmlwdHMiLCJfY29weURpYWdub3NlcyIsImRpYWdub3Nlc1JlZmVyZW5jZXMiLCJzY3JpcHRzUmVmZXJlbmNlcyIsIm9wdHMiLCJyZXN1bHRzIiwic3VjY2VzcyIsImRpYWdub3Nlc0xpc3QiLCJlcnJvciIsIkVycm9yIiwic2NyaXB0c0xpc3QiLCJpbnNlcnREYXRhIiwicyIsImRhdGEiLCJzY3JpcHREaWFnbm9zZXNMaXN0Iiwic2NyaXB0SWQiLCJzY3JpcHREcmFmdElkIiwibGFzdFBvc2l0aW9uIiwibGVuZ3RoIiwiTWF0aCIsIm1heCIsIm1hcCIsInBvc2l0aW9uIiwiZm9yRWFjaCIsImRpYWdub3Npc0lkIiwicHVzaCIsIm9sZERpYWdub3Npc0lkIiwiaW5zZXJ0IiwidmFsdWVzIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsImUiLCJtZXNzYWdlIiwiX3VwZGF0ZURpYWdub3Nlc1dpdGhvdXRQdWJsaXNoaW5nIiwicGF5bG9hZCIsInNjcmlwdFJlZmVyZW5jZSIsImZpbHRlciIsIndoZXJlU2NyaXB0IiwidW5kZWZpbmVkIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsIndoZXJlIiwicHVibGlzaGVkRGlhZ25vc2VzIiwiZGVsZXRlZEF0Iiwib3JkZXJCeSIsIm5ld0RyYWZ0cyIsInVwZGF0ZWREcmFmdHMiLCJkcmFmdCIsInB1Ymxpc2hlZERpYWdub3NpcyIsInVwZGF0ZSIsInNldCIsImlkIiwidmVyc2lvbiIsIl9wdWJsaXNoRGlhZ25vc2VzIiwiZXJyb3JzIiwidXBkYXRlcyIsImluc2VydHMiLCJyZXMiLCJkaWFnbm9zaXNEcmFmdElkIiwiY29sdW1ucyIsIl9kaWFnbm9zZXNEcmFmdHMiLCJfdXBkYXRlRGlhZ25vc2VzIiwiX2NyZWF0ZURpYWdub3NlcyIsIl9kZWxldGVEaWFnbm9zZXMiLCJkaWFnbm9zaXNJZHMiLCJpdGVtcyIsIkRhdGUiLCJkZWxldGUiLCJpdGVtIiwiY2hhbmdlcyIsImFjdGlvbiIsImRlZGlhZ25vc2lzaW9uIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiaW5zZXJ0ZWQiLCJjIiwiZGF0YUJlZm9yZSIsIl9zY3JpcHRJZCIsImQiLCJuYW1lIiwicmV0dXJuSW5zZXJ0ZWQiLCJfc2F2ZURpYWdub3Nlc0hpc3RvcnkiLCJwcmV2aW91cyIsIl9kaWFnbm9zaXNJZCIsIl9fZGlhZ25vc2lzSWQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJwdWJsaXNoRGF0ZSIsImRpYWdub3NpcyIsInJldHVyblVwZGF0ZWQiLCJjaGFuZ2VIaXN0b3J5RGF0YSIsInByZXYiLCJwcmV2QyIsIk9iamVjdCIsImtleXMiLCJrZXkiLCJpbmNsdWRlcyIsIl9rZXkiLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIiwiSlNPTiIsInN0cmluZ2lmeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/diagnoses.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/editor-info/index.ts":
/*!**************************************************!*\
  !*** ./databases/mutations/editor-info/index.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _saveEditorInfo: () => (/* binding */ _saveEditorInfo)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n\n\n\n\n\nasync function _saveEditorInfo({ data, increaseVersion, broadcastAction }) {\n    try {\n        let info = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.editorInfo.findFirst();\n        if (info) {\n            const dataVersion = increaseVersion ? info.dataVersion + 1 : info.dataVersion;\n            await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].update(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.editorInfo).set({\n                ...data,\n                dataVersion\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.editorInfo.id, info.id));\n        }\n        info = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.editorInfo.findFirst();\n        if (!!info && broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"save_editor_info\");\n        return {\n            data: info || null,\n            success: !!info\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_saveEditorInfo ERROR\", e.message);\n        return {\n            data: null,\n            success: false,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL2VkaXRvci1pbmZvL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFpQztBQUVPO0FBQ1c7QUFDakI7QUFDQTtBQWMzQixlQUFlSyxnQkFBZ0IsRUFBRUMsSUFBSSxFQUFFQyxlQUFlLEVBQUVDLGVBQWUsRUFBd0I7SUFDbEcsSUFBSTtRQUNBLElBQUlDLE9BQU8sTUFBTVIsNkRBQUVBLENBQUNTLEtBQUssQ0FBQ1IsVUFBVSxDQUFDUyxTQUFTO1FBRTlDLElBQUlGLE1BQU07WUFDTixNQUFNRyxjQUFjTCxrQkFBbUJFLEtBQUtHLFdBQVcsR0FBRyxJQUFLSCxLQUFLRyxXQUFXO1lBQy9FLE1BQU1YLDZEQUFFQSxDQUFDWSxNQUFNLENBQUNYLDREQUFVQSxFQUFFWSxHQUFHLENBQUM7Z0JBQUUsR0FBR1IsSUFBSTtnQkFBRU07WUFBYSxHQUFHRyxLQUFLLENBQUNmLCtDQUFFQSxDQUFDRSw0REFBVUEsQ0FBQ2MsRUFBRSxFQUFFUCxLQUFLTyxFQUFFO1FBQzlGO1FBRUFQLE9BQU8sTUFBTVIsNkRBQUVBLENBQUNTLEtBQUssQ0FBQ1IsVUFBVSxDQUFDUyxTQUFTO1FBRTFDLElBQUksQ0FBQyxDQUFDRixRQUFRRCxpQkFBaUJKLG1EQUFNQSxDQUFDYSxJQUFJLENBQUMsZ0JBQWdCO1FBRTNELE9BQVE7WUFBRVgsTUFBTUcsUUFBUTtZQUFNUyxTQUFTLENBQUMsQ0FBQ1Q7UUFBTTtJQUNuRCxFQUFFLE9BQU1VLEdBQVE7UUFDWmhCLG1EQUFNQSxDQUFDaUIsS0FBSyxDQUFDLHlCQUF5QkQsRUFBRUUsT0FBTztRQUMvQyxPQUFPO1lBQUVmLE1BQU07WUFBTVksU0FBUztZQUFPSSxRQUFRO2dCQUFDSCxFQUFFRSxPQUFPO2FBQUM7UUFBRTtJQUM5RDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL2VkaXRvci1pbmZvL2luZGV4LnRzPzdiMTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IGRiIGZyb20gXCJAL2RhdGFiYXNlcy9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBlZGl0b3JJbmZvIH0gZnJvbSBcIkAvZGF0YWJhc2VzL3BnL3NjaGVtYVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5pbXBvcnQgc29ja2V0IGZyb20gXCJAL2xpYi9zb2NrZXRcIjtcblxuZXhwb3J0IHR5cGUgU2F2ZUVkaXRvckluZm9QYXJhbXMgPSB7XG4gICAgZGF0YTogUGFydGlhbDx0eXBlb2YgZWRpdG9ySW5mby4kaW5mZXJTZWxlY3Q+O1xuICAgIGluY3JlYXNlVmVyc2lvbj86IGJvb2xlYW47XG4gICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIFNhdmVFZGl0b3JJbmZvUmVzdWx0cyA9IHtcbiAgICBkYXRhOiBudWxsIHwgdHlwZW9mIGVkaXRvckluZm8uJGluZmVyU2VsZWN0O1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgZXJyb3JzPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX3NhdmVFZGl0b3JJbmZvKHsgZGF0YSwgaW5jcmVhc2VWZXJzaW9uLCBicm9hZGNhc3RBY3Rpb24gfTogU2F2ZUVkaXRvckluZm9QYXJhbXMpOiBQcm9taXNlPFNhdmVFZGl0b3JJbmZvUmVzdWx0cz4ge1xuICAgIHRyeSB7XG4gICAgICAgIGxldCBpbmZvID0gYXdhaXQgZGIucXVlcnkuZWRpdG9ySW5mby5maW5kRmlyc3QoKTtcblxuICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgY29uc3QgZGF0YVZlcnNpb24gPSBpbmNyZWFzZVZlcnNpb24gPyAoaW5mby5kYXRhVmVyc2lvbiArIDEpIDogaW5mby5kYXRhVmVyc2lvbjtcbiAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShlZGl0b3JJbmZvKS5zZXQoeyAuLi5kYXRhLCBkYXRhVmVyc2lvbiwgfSkud2hlcmUoZXEoZWRpdG9ySW5mby5pZCwgaW5mby5pZCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5mbyA9IGF3YWl0IGRiLnF1ZXJ5LmVkaXRvckluZm8uZmluZEZpcnN0KCk7XG5cbiAgICAgICAgaWYgKCEhaW5mbyAmJiBicm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnc2F2ZV9lZGl0b3JfaW5mbycpO1xuXG4gICAgICAgIHJldHVybiAgeyBkYXRhOiBpbmZvIHx8IG51bGwsIHN1Y2Nlc3M6ICEhaW5mbywgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19zYXZlRWRpdG9ySW5mbyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwsIHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcnM6IFtlLm1lc3NhZ2VdLCB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJlcSIsImRiIiwiZWRpdG9ySW5mbyIsImxvZ2dlciIsInNvY2tldCIsIl9zYXZlRWRpdG9ySW5mbyIsImRhdGEiLCJpbmNyZWFzZVZlcnNpb24iLCJicm9hZGNhc3RBY3Rpb24iLCJpbmZvIiwicXVlcnkiLCJmaW5kRmlyc3QiLCJkYXRhVmVyc2lvbiIsInVwZGF0ZSIsInNldCIsIndoZXJlIiwiaWQiLCJlbWl0Iiwic3VjY2VzcyIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/editor-info/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/ops/index.ts":
/*!******************************************!*\
  !*** ./databases/mutations/ops/index.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _clearPendingDeletion: () => (/* binding */ _clearPendingDeletion)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n\n\n\n\n\nasync function _clearPendingDeletion(params) {\n    try {\n        const { items, broadcastAction } = {\n            ...params\n        };\n        const where = [\n            items === \"configKeys\" ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.configKeyId) : undefined,\n            items === \"scripts\" ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.scriptId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.screenId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.diagnosisId)) : undefined,\n            items === \"screens\" ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.screenId) : undefined,\n            items === \"diagnoses\" ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.diagnosisId) : undefined\n        ];\n        await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion).where(!where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where));\n        if (broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_3__[\"default\"].emit(\"data_changed\", \"clear_pending_deletion\");\n        return {\n            success: true\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_clearPendingDeletion ERROR\", e.message);\n        return {\n            success: false,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL29wcy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBcUQ7QUFFYjtBQUNnQjtBQUN0QjtBQUNBO0FBRTNCLGVBQWVPLHNCQUFzQkMsTUFHM0M7SUFDRyxJQUFJO1FBQ0EsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLGVBQWUsRUFBRyxHQUFHO1lBQUUsR0FBR0YsTUFBTTtRQUFDO1FBRWhELE1BQU1HLFFBQVE7WUFDVkYsVUFBVSxlQUFlVCxzREFBU0EsQ0FBQ0ksaUVBQWVBLENBQUNRLFdBQVcsSUFBSUM7WUFDbEVKLFVBQVUsWUFBWVIsZ0RBQUdBLENBQ3JCRCxzREFBU0EsQ0FBQ0ksaUVBQWVBLENBQUNVLFFBQVEsR0FDbENaLG1EQUFNQSxDQUFDRSxpRUFBZUEsQ0FBQ1csUUFBUSxHQUMvQmIsbURBQU1BLENBQUNFLGlFQUFlQSxDQUFDWSxXQUFXLEtBQ2xDSDtZQUNKSixVQUFVLFlBQVlULHNEQUFTQSxDQUFDSSxpRUFBZUEsQ0FBQ1csUUFBUSxJQUFJRjtZQUM1REosVUFBVSxjQUFjVCxzREFBU0EsQ0FBQ0ksaUVBQWVBLENBQUNZLFdBQVcsSUFBSUg7U0FDcEU7UUFFRCxNQUFNViw2REFBRUEsQ0FBQ2MsTUFBTSxDQUFDYixpRUFBZUEsRUFBRU8sS0FBSyxDQUFDLENBQUNBLE1BQU1PLE1BQU0sR0FBR0wsWUFBWVosZ0RBQUdBLElBQUlVO1FBRTFFLElBQUlELGlCQUFpQkosbURBQU1BLENBQUNhLElBQUksQ0FBQyxnQkFBZ0I7UUFFakQsT0FBTztZQUFFQyxTQUFTO1FBQU07SUFDNUIsRUFBRSxPQUFNQyxHQUFRO1FBQ1poQixtREFBTUEsQ0FBQ2lCLEtBQUssQ0FBQywrQkFBK0JELEVBQUVFLE9BQU87UUFDckQsT0FBTztZQUFFSCxTQUFTO1lBQU9JLFFBQVE7Z0JBQUNILEVBQUVFLE9BQU87YUFBQztRQUFFO0lBQ2xEO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9tdXRhdGlvbnMvb3BzL2luZGV4LnRzPzg1NjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNOb3ROdWxsLCBhbmQsIGlzTnVsbCB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG5pbXBvcnQgZGIgZnJvbSBcIkAvZGF0YWJhc2VzL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IHBlbmRpbmdEZWxldGlvbiB9IGZyb20gXCJAL2RhdGFiYXNlcy9wZy9zY2hlbWFcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuaW1wb3J0IHNvY2tldCBmcm9tIFwiQC9saWIvc29ja2V0XCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY2xlYXJQZW5kaW5nRGVsZXRpb24ocGFyYW1zPzoge1xuICAgIGl0ZW1zPzogJ3NjcmVlbnMnIHwgJ3NjcmlwdHMnIHwgJ2RpYWdub3NlcycgfCAnY29uZmlnS2V5cycsXG4gICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbn0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3JzPzogc3RyaW5nW107IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGl0ZW1zLCBicm9hZGNhc3RBY3Rpb24sIH0gPSB7IC4uLnBhcmFtcyB9O1xuXG4gICAgICAgIGNvbnN0IHdoZXJlID0gW1xuICAgICAgICAgICAgaXRlbXMgPT09ICdjb25maWdLZXlzJyA/IGlzTm90TnVsbChwZW5kaW5nRGVsZXRpb24uY29uZmlnS2V5SWQpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgaXRlbXMgPT09ICdzY3JpcHRzJyA/IGFuZChcbiAgICAgICAgICAgICAgICBpc05vdE51bGwocGVuZGluZ0RlbGV0aW9uLnNjcmlwdElkKSxcbiAgICAgICAgICAgICAgICBpc051bGwocGVuZGluZ0RlbGV0aW9uLnNjcmVlbklkKSxcbiAgICAgICAgICAgICAgICBpc051bGwocGVuZGluZ0RlbGV0aW9uLmRpYWdub3Npc0lkKSxcbiAgICAgICAgICAgICkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBpdGVtcyA9PT0gJ3NjcmVlbnMnID8gaXNOb3ROdWxsKHBlbmRpbmdEZWxldGlvbi5zY3JlZW5JZCkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBpdGVtcyA9PT0gJ2RpYWdub3NlcycgPyBpc05vdE51bGwocGVuZGluZ0RlbGV0aW9uLmRpYWdub3Npc0lkKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgXTtcblxuICAgICAgICBhd2FpdCBkYi5kZWxldGUocGVuZGluZ0RlbGV0aW9uKS53aGVyZSghd2hlcmUubGVuZ3RoID8gdW5kZWZpbmVkIDogYW5kKC4uLndoZXJlKSk7XG5cbiAgICAgICAgaWYgKGJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdjbGVhcl9wZW5kaW5nX2RlbGV0aW9uJyk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jbGVhclBlbmRpbmdEZWxldGlvbiBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcnM6IFtlLm1lc3NhZ2VdLCB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJpc05vdE51bGwiLCJhbmQiLCJpc051bGwiLCJkYiIsInBlbmRpbmdEZWxldGlvbiIsImxvZ2dlciIsInNvY2tldCIsIl9jbGVhclBlbmRpbmdEZWxldGlvbiIsInBhcmFtcyIsIml0ZW1zIiwiYnJvYWRjYXN0QWN0aW9uIiwid2hlcmUiLCJjb25maWdLZXlJZCIsInVuZGVmaW5lZCIsInNjcmlwdElkIiwic2NyZWVuSWQiLCJkaWFnbm9zaXNJZCIsImRlbGV0ZSIsImxlbmd0aCIsImVtaXQiLCJzdWNjZXNzIiwiZSIsImVycm9yIiwibWVzc2FnZSIsImVycm9ycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/ops/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/screens-drafts.ts":
/*!***********************************************!*\
  !*** ./databases/mutations/screens-drafts.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _createScreensDrafts: () => (/* binding */ _createScreensDrafts),\n/* harmony export */   _deleteAllScreensDrafts: () => (/* binding */ _deleteAllScreensDrafts),\n/* harmony export */   _deleteScreensDrafts: () => (/* binding */ _deleteScreensDrafts),\n/* harmony export */   _updateScreensDrafts: () => (/* binding */ _updateScreensDrafts)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_screens_drafts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../queries/screens-drafts */ \"(rsc)/./databases/queries/screens-drafts.ts\");\n/* harmony import */ var _queries_screens__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/screens */ \"(rsc)/./databases/queries/screens.ts\");\n\n\n\n\n\n\n\nasync function _deleteScreensDrafts(screensDraftsIds, opts) {\n    if (screensDraftsIds.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screensDraftsIds));\n        // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'delete_screens_drafts', data: screensDraftsIds, });\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_screens_drafts\");\n    }\n    return true;\n}\nasync function _deleteAllScreensDrafts(opts) {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts);\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_screens_drafts\");\n    return res;\n}\nasync function _createScreensDrafts(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const missingScriptsReferences = data.filter((s)=>!s.scriptDraftId && !s.scriptId);\n        if (missingScriptsReferences.length) throw new Error(\"Missing scripts references\");\n        const screensList = await (0,_queries_screens__WEBPACK_IMPORTED_MODULE_4__._listScreens)({\n            scriptsReferences: data.map((s)=>s.scriptId || s.scriptDraftId)\n        });\n        const lastPosition = screensList.data.length ? Math.max(...screensList.data.map((s)=>s.position)) : 0;\n        let position = lastPosition + 1;\n        const insertData = [];\n        for (const s of data){\n            let screenDraftId = s.screenId || s.data.screenId;\n            const existing = !screenDraftId ? null : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screenDraftId)\n            });\n            if (!existing) {\n                insertData.push({\n                    ...s,\n                    data: {\n                        ...s.data,\n                        position: s.screenId ? s.data.position : position\n                    },\n                    screenDraftId: screenDraftId || (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(),\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId\n                });\n                if (!s.screenId) position++;\n            }\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts).values(insertData);\n        if (opts?.returnInserted) {\n            const inserted = await (0,_queries_screens_drafts__WEBPACK_IMPORTED_MODULE_3__._getScreensDrafts)({\n                screenDraftIds: insertData.map((u)=>u.screenDraftId)\n            });\n            results.inserted = inserted.data;\n        }\n        results.success = true;\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n    } catch (e) {\n        results.error = e.message;\n    } finally{\n        return results;\n    }\n}\nasync function _updateScreensDrafts(data, opts) {\n    const results = [];\n    for (const { screenDraftId, data: draft } of data){\n        try {\n            const existing = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screenDraftId)\n            });\n            const draftData = {\n                ...existing?.data,\n                ...draft\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts).set({\n                data: draftData\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screenDraftId));\n            const screenDraft = !opts?.returnUpdated ? undefined : await (0,_queries_screens_drafts__WEBPACK_IMPORTED_MODULE_3__._getScreenDraft)(screenDraftId);\n            results.push({\n                screenDraftId,\n                screenDraft\n            });\n            // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'update_screens_drafts', data: data.map(u => u.screenDraftId), });\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n        } catch (e) {\n            results.push({\n                screenDraftId,\n                error: e.message\n            });\n        }\n    }\n    return results;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmVlbnMtZHJhZnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQTBDO0FBQ2hCO0FBRVM7QUFDSjtBQUNjO0FBQ2tDO0FBQzdCO0FBRTNDLGVBQWVTLHFCQUNsQkMsZ0JBQTBCLEVBQzFCQyxJQUVDO0lBRUQsSUFBSUQsaUJBQWlCRSxNQUFNLEVBQUU7UUFDekIsTUFBTVIsbURBQUVBLENBQUNTLE1BQU0sQ0FBQ1IscURBQWFBLEVBQUVTLEtBQUssQ0FBQ2Isb0RBQU9BLENBQUNJLHFEQUFhQSxDQUFDVSxhQUFhLEVBQUVMO1FBQzFFLHdIQUF3SDtRQUN4SCxJQUFJQyxNQUFNSyxpQkFBaUJiLG1EQUFNQSxDQUFDYyxJQUFJLENBQUMsZ0JBQWdCO0lBQzNEO0lBQ0EsT0FBTztBQUNYO0FBRU8sZUFBZUMsd0JBQ2xCUCxJQUVDO0lBRUQsTUFBTVEsTUFBTSxNQUFNZixtREFBRUEsQ0FBQ1MsTUFBTSxDQUFDUixxREFBYUE7SUFDekMsSUFBSU0sTUFBTUssaUJBQWlCYixtREFBTUEsQ0FBQ2MsSUFBSSxDQUFDLGdCQUFnQjtJQUN2RCxPQUFPRTtBQUNYO0FBRU8sZUFBZUMscUJBQ2xCQyxJQUtJLEVBQ0pWLElBR0M7SUFFRCxJQUFJVyxVQUlBO1FBQUVDLFVBQVUsRUFBRTtRQUFFQyxTQUFTO0lBQU87SUFFcEMsSUFBSTtRQUNBLE1BQU1DLDJCQUEyQkosS0FBS0ssTUFBTSxDQUFDQyxDQUFBQSxJQUFLLENBQUNBLEVBQUVDLGFBQWEsSUFBSSxDQUFDRCxFQUFFRSxRQUFRO1FBRWpGLElBQUlKLHlCQUF5QmIsTUFBTSxFQUFFLE1BQU0sSUFBSWtCLE1BQU07UUFFckQsTUFBTUMsY0FBYyxNQUFNdkIsOERBQVlBLENBQUM7WUFBRXdCLG1CQUFtQlgsS0FBS1ksR0FBRyxDQUFDTixDQUFBQSxJQUFLQSxFQUFFRSxRQUFRLElBQUtGLEVBQUVDLGFBQWE7UUFBSTtRQUM1RyxNQUFNTSxlQUFlSCxZQUFZ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QWVtQyxPQUFPRCxFQUFFRSxPQUFPO1lBQUU7UUFDcEQ7SUFDSjtJQUVBLE9BQU83QjtBQUNYIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmVlbnMtZHJhZnRzLnRzPzRkMjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGluQXJyYXkgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IHY0IH0gZnJvbSBcInV1aWRcIjtcblxuaW1wb3J0IHNvY2tldCAgZnJvbSAnQC9saWIvc29ja2V0JztcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgc2NyZWVuc0RyYWZ0cyB9IGZyb20gXCIuLi9wZy9zY2hlbWFcIjtcbmltcG9ydCB7IF9nZXRTY3JlZW5EcmFmdCwgX2dldFNjcmVlbnNEcmFmdHMgfSBmcm9tICcuLi9xdWVyaWVzL3NjcmVlbnMtZHJhZnRzJztcbmltcG9ydCB7IF9saXN0U2NyZWVucyB9IGZyb20gXCIuLi9xdWVyaWVzL3NjcmVlbnNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVTY3JlZW5zRHJhZnRzKFxuICAgIHNjcmVlbnNEcmFmdHNJZHM6IHN0cmluZ1tdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgaWYgKHNjcmVlbnNEcmFmdHNJZHMubGVuZ3RoKSB7XG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JlZW5zRHJhZnRzKS53aGVyZShpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCwgc2NyZWVuc0RyYWZ0c0lkcykpO1xuICAgICAgICAvLyBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgeyBhY3Rpb246ICdkZWxldGVfc2NyZWVuc19kcmFmdHMnLCBkYXRhOiBzY3JlZW5zRHJhZnRzSWRzLCB9KTtcbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdkZWxldGVfc2NyZWVuc19kcmFmdHMnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZGVsZXRlQWxsU2NyZWVuc0RyYWZ0cyhcbiAgICBvcHRzPzoge1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLmRlbGV0ZShzY3JlZW5zRHJhZnRzKTtcbiAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9zY3JlZW5zX2RyYWZ0cycpO1xuICAgIHJldHVybiByZXM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY3JlYXRlU2NyZWVuc0RyYWZ0cyhcbiAgICBkYXRhOiAodHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVySW5zZXJ0ICYge1xuICAgICAgICBzY3JpcHRJZD86IHN0cmluZztcbiAgICAgICAgc2NyaXB0RHJhZnRJZD86IHN0cmluZztcbiAgICAgICAgc2NyZWVuRHJhZnRJZDogc3RyaW5nO1xuICAgICAgICBkYXRhOiBFeGNsdWRlPCh0eXBlb2Ygc2NyZWVuc0RyYWZ0cy4kaW5mZXJJbnNlcnQpWydkYXRhJ10sICd2ZXJzaW9uJz47XG4gICAgfSlbXSwgXG4gICAgb3B0cz86IHtcbiAgICAgICAgcmV0dXJuSW5zZXJ0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGxldCByZXN1bHRzOiB7XG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIGVycm9yPzogc3RyaW5nO1xuICAgICAgICBpbnNlcnRlZDogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0U2NyZWVuc0RyYWZ0cz4+WydkYXRhJ107XG4gICAgfSA9IHsgaW5zZXJ0ZWQ6IFtdLCBzdWNjZXNzOiBmYWxzZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1pc3NpbmdTY3JpcHRzUmVmZXJlbmNlcyA9IGRhdGEuZmlsdGVyKHMgPT4gIXMuc2NyaXB0RHJhZnRJZCAmJiAhcy5zY3JpcHRJZCk7XG5cbiAgICAgICAgaWYgKG1pc3NpbmdTY3JpcHRzUmVmZXJlbmNlcy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBzY3JpcHRzIHJlZmVyZW5jZXMnKTtcblxuICAgICAgICBjb25zdCBzY3JlZW5zTGlzdCA9IGF3YWl0IF9saXN0U2NyZWVucyh7IHNjcmlwdHNSZWZlcmVuY2VzOiBkYXRhLm1hcChzID0+IHMuc2NyaXB0SWQhIHx8IHMuc2NyaXB0RHJhZnRJZCEpLCB9KTtcbiAgICAgICAgY29uc3QgbGFzdFBvc2l0aW9uID0gc2NyZWVuc0xpc3QuZGF0YS5sZW5ndGggPyBNYXRoLm1heCguLi5zY3JlZW5zTGlzdC5kYXRhLm1hcChzID0+IHMucG9zaXRpb24pKSA6IDA7XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IGxhc3RQb3NpdGlvbiArIDE7XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVySW5zZXJ0W10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGZvcihjb25zdCBzIG9mIGRhdGEpIHtcbiAgICAgICAgICAgIGxldCBzY3JlZW5EcmFmdElkID0gcy5zY3JlZW5JZCB8fCBzLmRhdGEuc2NyZWVuSWQ7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9ICFzY3JlZW5EcmFmdElkID8gbnVsbCA6IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogZXEoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBzY3JlZW5EcmFmdElkKSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucy5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHMuc2NyZWVuSWQgPyBzLmRhdGEucG9zaXRpb24gOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2NyZWVuRHJhZnRJZDogc2NyZWVuRHJhZnRJZCB8fCB2NCgpLFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCxcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogcy5zY3JpcHREcmFmdElkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghcy5zY3JlZW5JZCkgcG9zaXRpb24rKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbnNlcnREYXRhLmxlbmd0aCkgYXdhaXQgZGIuaW5zZXJ0KHNjcmVlbnNEcmFmdHMpLnZhbHVlcyhpbnNlcnREYXRhKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChvcHRzPy5yZXR1cm5JbnNlcnRlZCkge1xuICAgICAgICAgICAgY29uc3QgaW5zZXJ0ZWQgPSBhd2FpdCBfZ2V0U2NyZWVuc0RyYWZ0cyh7IHNjcmVlbkRyYWZ0SWRzOiBpbnNlcnREYXRhLm1hcCh1ID0+IHUuc2NyZWVuRHJhZnRJZCEpLCB9KTtcbiAgICAgICAgICAgIHJlc3VsdHMuaW5zZXJ0ZWQgPSBpbnNlcnRlZC5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX3NjcmVlbnNfZHJhZnRzJyk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5lcnJvciA9IGUubWVzc2FnZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfdXBkYXRlU2NyZWVuc0RyYWZ0cyhcbiAgICBkYXRhOiAoe1xuICAgICAgICBzY3JlZW5EcmFmdElkOiBzdHJpbmc7XG4gICAgICAgIGRhdGE6IFBhcnRpYWw8dHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVyU2VsZWN0PlsnZGF0YSddO1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVyblVwZGF0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlc3VsdHM6ICh7IFxuICAgICAgICBzY3JlZW5EcmFmdElkOiBzdHJpbmc7XG4gICAgICAgIHNjcmVlbkRyYWZ0PzogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0U2NyZWVuRHJhZnQ+PjtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7IFxuICAgIH0pW10gPSBbXTtcblxuICAgIGZvcihjb25zdCB7IHNjcmVlbkRyYWZ0SWQsIGRhdGE6IGRyYWZ0LCAgfSBvZiBkYXRhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogZXEoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBzY3JlZW5EcmFmdElkKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgZHJhZnREYXRhID0geyAuLi5leGlzdGluZz8uZGF0YSwgLi4uZHJhZnQsIH0gYXMgdHlwZW9mIGRyYWZ0O1xuICAgICAgICAgICAgYXdhaXQgZGIudXBkYXRlKHNjcmVlbnNEcmFmdHMpLnNldCh7IGRhdGE6IGRyYWZ0RGF0YSwgfSkud2hlcmUoZXEoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBzY3JlZW5EcmFmdElkKSk7XG4gICAgICAgICAgICBjb25zdCBzY3JlZW5EcmFmdCA9ICFvcHRzPy5yZXR1cm5VcGRhdGVkID8gdW5kZWZpbmVkIDogYXdhaXQgX2dldFNjcmVlbkRyYWZ0KHNjcmVlbkRyYWZ0SWQpO1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgc2NyZWVuRHJhZnRJZCwgc2NyZWVuRHJhZnQsIH0pO1xuICAgICAgICAgICAgLy8gaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsIHsgYWN0aW9uOiAndXBkYXRlX3NjcmVlbnNfZHJhZnRzJywgZGF0YTogZGF0YS5tYXAodSA9PiB1LnNjcmVlbkRyYWZ0SWQpLCB9KTtcbiAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX3NjcmVlbnNfZHJhZnRzJyk7XG4gICAgICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBzY3JlZW5EcmFmdElkLCBlcnJvcjogZS5tZXNzYWdlLCB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xufVxuIl0sIm5hbWVzIjpbImVxIiwiaW5BcnJheSIsInY0Iiwic29ja2V0IiwiZGIiLCJzY3JlZW5zRHJhZnRzIiwiX2dldFNjcmVlbkRyYWZ0IiwiX2dldFNjcmVlbnNEcmFmdHMiLCJfbGlzdFNjcmVlbnMiLCJfZGVsZXRlU2NyZWVuc0RyYWZ0cyIsInNjcmVlbnNEcmFmdHNJZHMiLCJvcHRzIiwibGVuZ3RoIiwiZGVsZXRlIiwid2hlcmUiLCJzY3JlZW5EcmFmdElkIiwiYnJvYWRjYXN0QWN0aW9uIiwiZW1pdCIsIl9kZWxldGVBbGxTY3JlZW5zRHJhZnRzIiwicmVzIiwiX2NyZWF0ZVNjcmVlbnNEcmFmdHMiLCJkYXRhIiwicmVzdWx0cyIsImluc2VydGVkIiwic3VjY2VzcyIsIm1pc3NpbmdTY3JpcHRzUmVmZXJlbmNlcyIsImZpbHRlciIsInMiLCJzY3JpcHREcmFmdElkIiwic2NyaXB0SWQiLCJFcnJvciIsInNjcmVlbnNMaXN0Iiwic2NyaXB0c1JlZmVyZW5jZXMiLCJtYXAiLCJsYXN0UG9zaXRpb24iLCJNYXRoIiwibWF4IiwicG9zaXRpb24iLCJpbnNlcnREYXRhIiwic2NyZWVuSWQiLCJleGlzdGluZyIsInF1ZXJ5IiwiZmluZEZpcnN0IiwicHVzaCIsImluc2VydCIsInZhbHVlcyIsInJldHVybkluc2VydGVkIiwic2NyZWVuRHJhZnRJZHMiLCJ1IiwiZSIsImVycm9yIiwibWVzc2FnZSIsIl91cGRhdGVTY3JlZW5zRHJhZnRzIiwiZHJhZnQiLCJkcmFmdERhdGEiLCJ1cGRhdGUiLCJzZXQiLCJzY3JlZW5EcmFmdCIsInJldHVyblVwZGF0ZWQiLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/screens-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/screens.ts":
/*!****************************************!*\
  !*** ./databases/mutations/screens.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _copyScreens: () => (/* binding */ _copyScreens),\n/* harmony export */   _createScreens: () => (/* binding */ _createScreens),\n/* harmony export */   _deleteScreens: () => (/* binding */ _deleteScreens),\n/* harmony export */   _publishScreens: () => (/* binding */ _publishScreens),\n/* harmony export */   _saveScreensHistory: () => (/* binding */ _saveScreensHistory),\n/* harmony export */   _updateScreens: () => (/* binding */ _updateScreens),\n/* harmony export */   _updateScreensWithoutPublishing: () => (/* binding */ _updateScreensWithoutPublishing)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_screens__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/screens */ \"(rsc)/./databases/queries/screens.ts\");\n/* harmony import */ var _queries_scripts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../queries/_scripts */ \"(rsc)/./databases/queries/_scripts/index.ts\");\n\n\n\n\n\n\n\n\nasync function _copyScreens({ screensReferences, scriptsReferences }, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const screensList = await (0,_queries_screens__WEBPACK_IMPORTED_MODULE_4__._listRawScreens)({\n            screensReferences\n        });\n        if (screensList.error) throw new Error(screensList.error);\n        const scriptsList = await (0,_queries_scripts__WEBPACK_IMPORTED_MODULE_5__._listScripts)(scriptsReferences);\n        if (scriptsList.error) throw new Error(scriptsList.error);\n        const insertData = [];\n        for (const s of scriptsList.data){\n            const scriptScreensList = await (0,_queries_screens__WEBPACK_IMPORTED_MODULE_4__._listScreens)({\n                scriptsReferences: [\n                    s.scriptId || s.scriptDraftId\n                ]\n            });\n            const lastPosition = scriptScreensList.data.length ? Math.max(...scriptScreensList.data.map((s)=>s.position)) : 0;\n            let position = lastPosition + 1;\n            screensList.data.forEach((data)=>{\n                const screenId = (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])();\n                insertData.push({\n                    data: {\n                        ...data,\n                        screenId,\n                        scriptId: s.scriptId,\n                        oldScreenId: null,\n                        position\n                    },\n                    position,\n                    type: data.type,\n                    screenId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId\n                });\n                position++;\n            });\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).values(insertData);\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_copyScreens ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _updateScreensWithoutPublishing(payload, opts) {\n    const results = {\n        success: true\n    };\n    try {\n        const scriptsReferences = payload.map((s)=>s.scriptReference).filter((s)=>s);\n        const whereScript = !scriptsReferences.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptDraftId, scriptsReferences));\n        if (whereScript) {\n            const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screensDrafts.findMany({\n                where: whereScript\n            });\n            let publishedScreens = [];\n            if (scriptsReferences.length) {\n                publishedScreens = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screens.findMany({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(...[\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.deletedAt),\n                        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.scriptId, scriptsReferences),\n                        ...drafts.filter((s)=>s.screenId).length ? [\n                            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, drafts.map((s)=>s.screenId))\n                        ] : []\n                    ]),\n                    orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.asc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.position)\n                });\n            }\n            const newDrafts = [];\n            let updatedDrafts = 0;\n            for (const { screenId, data } of payload){\n                const draft = drafts.filter((s)=>s.data.screenId === screenId)[0];\n                const publishedScreen = publishedScreens.filter((s)=>s.screenId === screenId)[0];\n                if (draft) {\n                    await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).set({\n                        data: {\n                            ...draft.data,\n                            ...data\n                        }\n                    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.id, draft.id));\n                    updatedDrafts++;\n                } else if (publishedScreen) {\n                    newDrafts.push({\n                        screenId: publishedScreen.screenId,\n                        scriptId: publishedScreen.scriptId,\n                        position: data.position,\n                        type: publishedScreen.type,\n                        data: {\n                            ...publishedScreen,\n                            ...data,\n                            version: data.version || publishedScreen.version + 1\n                        }\n                    });\n                }\n            }\n            if (newDrafts.length) {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).values(newDrafts);\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_screens_drafts\");\n            }\n            if (updatedDrafts) {\n                if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"update_screens_drafts\");\n            }\n        }\n    } catch (e) {\n        results.success = false;\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_updateScreensWithoutPublishing ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _publishScreens(opts) {\n    const { scriptsReferences, screensReferences } = {\n        ...opts\n    };\n    const results = {\n        success: true\n    };\n    const errors = [];\n    try {\n        let updates = [];\n        let inserts = [];\n        if (scriptsReferences?.length || screensReferences?.length) {\n            const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screensDrafts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.or)(!scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptId, scriptsReferences), !scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptDraftId, scriptsReferences), !screensReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId, screensReferences), !screensReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenDraftId, screensReferences)),\n                columns: {\n                    screenId: true,\n                    screenDraftId: true\n                }\n            });\n            updates = res.filter((s)=>s.screenId).map((s)=>({\n                    screenId: s.screenId\n                }));\n            inserts = res.filter((s)=>!s.screenId).map((s)=>({\n                    screenDraftId: s.screenDraftId\n                }));\n        } else {\n            const _screensDrafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screensDrafts.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.scriptId),\n                columns: {\n                    screenId: true,\n                    screenDraftId: true\n                }\n            });\n            updates = _screensDrafts.filter((s)=>s.screenId).map((s)=>({\n                    screenId: s.screenId\n                }));\n            inserts = _screensDrafts.filter((s)=>!s.screenId).map((s)=>({\n                    screenDraftId: s.screenDraftId\n                }));\n        }\n        if (updates.length) {\n            const res = await _updateScreens(updates);\n            res.forEach((s)=>s.error && errors.push(s.error));\n        }\n        if (inserts.length) {\n            const res = await _createScreens(inserts);\n            res.errors?.forEach((e)=>errors.push(e));\n        }\n        if (errors.length) {\n            results.success = false;\n            results.errors = errors;\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_publishScreens ERRORS\", errors);\n        }\n    } catch (e) {\n        results.success = false;\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_publishScreens ERROR\", e);\n    } finally{\n        return results;\n    }\n}\nasync function _deleteScreens(screenIds, opts) {\n    if (screenIds.length) {\n        const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, screenIds);\n        const items = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screens.findMany({\n            where\n        });\n        const deletedAt = new Date();\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens).set({\n            deletedAt\n        }).where(where);\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId, screenIds)));\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).values(items.map((item)=>({\n                version: item.version,\n                screenId: item.screenId,\n                scriptId: item.scriptId,\n                changes: {\n                    action: \"delete_screen\",\n                    descreenion: \"Delete screen\",\n                    oldValues: [\n                        {\n                            deletedAt: null\n                        }\n                    ],\n                    newValues: [\n                        {\n                            deletedAt\n                        }\n                    ]\n                }\n            })));\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"delete_screens\");\n    }\n    return true;\n}\nasync function _createScreens(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const insertData = [];\n        let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screensDrafts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenDraftId, data.map((c)=>c.screenDraftId))\n        });\n        // we'll use data before to compare changes\n        let dataBefore = [];\n        if (drafts.filter((c)=>c.screenId).length) {\n            dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screens.findMany({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, drafts.filter((c)=>c.screenId).map((c)=>c.screenId))\n            });\n        }\n        for (const { id, scriptId: _scriptId, data } of drafts){\n            const screenId = data.screenId || (0,uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"])();\n            const scriptId = data.scriptId || _scriptId;\n            const payload = {\n                ...data,\n                screenId,\n                scriptId\n            };\n            insertData.push(payload);\n            drafts = drafts.map((d)=>{\n                if (d.id === id) d.data.screenId = screenId;\n                return d;\n            });\n            try {\n                await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens).values(payload);\n            } catch (e) {\n                results.errors = [\n                    ...results.errors || [],\n                    `Error inserting ${data.title} - ${e.message}`\n                ];\n            }\n        }\n        const inserted = await (0,_queries_screens__WEBPACK_IMPORTED_MODULE_4__._getScreens)({\n            screenIds: insertData.map((c)=>c.screenId)\n        });\n        results.inserted = opts?.returnInserted ? inserted.data : [];\n        results.success = true;\n        await _saveScreensHistory({\n            drafts: drafts,\n            previous: dataBefore\n        });\n        if (drafts.length) {\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.id, drafts.map((d)=>d.id)));\n        }\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_screens\");\n    } catch (e) {\n        results.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_createScreens ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _updateScreens(data, opts) {\n    const results = [];\n    let drafts = !data.length ? [] : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screensDrafts.findMany({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.screenId, data.map((c)=>c.screenId))\n    });\n    // we'll use data before to compare changes\n    let dataBefore = [];\n    if (drafts.filter((c)=>c.screenId).length) {\n        dataBefore = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.screens.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, drafts.filter((c)=>c.screenId).map((c)=>c.screenId))\n        });\n    }\n    for (const { screenId: _screenId, data: c } of drafts){\n        const screenId = _screenId;\n        const { screenId: __screenId, id, oldScreenId, createdAt, updatedAt, deletedAt, ...payload } = c;\n        try {\n            const updates = {\n                ...payload,\n                publishDate: new Date()\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens).set(updates).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screens.screenId, screenId));\n            const screen = !opts?.returnUpdated ? undefined : await (0,_queries_screens__WEBPACK_IMPORTED_MODULE_4__._getScreen)(screenId);\n            results.push({\n                screenId,\n                screen\n            });\n        } catch (e) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(`_updateScreens screenId=${screenId}`, e.message);\n            results.push({\n                screenId,\n                error: e.message\n            });\n            drafts = drafts.filter((c)=>c.data.screenId !== screenId);\n        }\n    }\n    await _saveScreensHistory({\n        drafts: drafts,\n        previous: dataBefore\n    });\n    if (drafts.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensDrafts.id, drafts.map((d)=>d.id)));\n    }\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_1__[\"default\"].emit(\"data_changed\", \"create_screens\");\n    return results;\n}\nasync function _saveScreensHistory({ previous, drafts }) {\n    try {\n        const insertData = [];\n        for (const c of drafts){\n            const changeHistoryData = {\n                version: c?.data?.version || 1,\n                screenId: c?.data?.screenId,\n                scriptId: c?.data?.scriptId,\n                changes: {}\n            };\n            if (c?.data?.version === 1) {\n                changeHistoryData.changes = {\n                    action: \"create_screen\",\n                    descreenion: \"Create screen\",\n                    oldValues: [],\n                    newValues: []\n                };\n            } else {\n                const prev = previous.filter((prevC)=>prevC.screenId === c?.data?.screenId)[0];\n                const oldValues = [];\n                const newValues = [];\n                Object.keys({\n                    ...c?.data\n                }).filter((key)=>![\n                        \"version\",\n                        \"draft\"\n                    ].includes(key)).forEach((_key)=>{\n                    const key = _key;\n                    const newValue = c.data[key];\n                    const oldValue = {\n                        ...prev\n                    }[key];\n                    if (JSON.stringify(newValue) !== JSON.stringify(oldValue)) {\n                        oldValues.push({\n                            [key]: oldValue\n                        });\n                        newValues.push({\n                            [key]: newValue\n                        });\n                    }\n                });\n                changeHistoryData.changes = {\n                    action: \"update_screen\",\n                    descreenion: \"Update screen\",\n                    oldValues,\n                    newValues\n                };\n            }\n            insertData.push(changeHistoryData);\n        }\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.screensHistory).values(insertData);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(e.message);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmVlbnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE2RjtBQUNuRTtBQUVRO0FBQ0M7QUFDSjtBQUN1QztBQUNzQjtBQUN6QztBQUU1QyxlQUFlb0IsYUFDbEIsRUFBRUMsaUJBQWlCLEVBQUVDLGlCQUFpQixFQUdyQyxFQUNEQyxJQUVDO0lBRUQsTUFBTUMsVUFBNkQ7UUFBRUMsU0FBUztJQUFLO0lBQ25GLElBQUk7UUFDQSxNQUFNQyxjQUFjLE1BQU1ULGlFQUFlQSxDQUFDO1lBQUVJO1FBQWtCO1FBRTlELElBQUlLLFlBQVlDLEtBQUssRUFBRSxNQUFNLElBQUlDLE1BQU1GLFlBQVlDLEtBQUs7UUFFeEQsTUFBTUUsY0FBYyxNQUFNViw4REFBWUEsQ0FBQ0c7UUFFdkMsSUFBSU8sWUFBWUYsS0FBSyxFQUFFLE1BQU0sSUFBSUMsTUFBTUMsWUFBWUYsS0FBSztRQUV4RCxNQUFNRyxhQUFrRCxFQUFFO1FBRTFELEtBQUssTUFBTUMsS0FBS0YsWUFBWUcsSUFBSSxDQUFFO1lBQzlCLE1BQU1DLG9CQUFvQixNQUFNZiw4REFBWUEsQ0FBQztnQkFBRUksbUJBQW1CO29CQUFDUyxFQUFFRyxRQUFRLElBQUtILEVBQUVJLGFBQWE7aUJBQUU7WUFBRTtZQUNyRyxNQUFNQyxlQUFlSCxrQkFBa0JELElBQUksQ0FBQ0ssTUFBTSxHQUFHQyxLQUFLQyxHQUFHLElBQUlOLGtCQUFrQkQsSUFBSSxDQUFDUSxHQUFHLENBQUNULENBQUFBLElBQUtBLEVBQUVVLFFBQVEsS0FBSztZQUNoSCxJQUFJQSxXQUFXTCxlQUFlO1lBRTlCVixZQUFZTSxJQUFJLENBQUNVLE9BQU8sQ0FBQ1YsQ0FBQUE7Z0JBQ3JCLE1BQU1XLFdBQVduQyxnREFBRUE7Z0JBQ25Cc0IsV0FBV2MsSUFBSSxDQUFDO29CQUNaWixNQUFNO3dCQUNGLEdBQUdBLElBQUk7d0JBQ1BXO3dCQUNBVCxVQUFVSCxFQUFFRyxRQUFRO3dCQUNw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Z0JBQ0o7WUFDSjtZQUVBaEUsV0FBV2MsSUFBSSxDQUFDbUU7UUFDcEI7UUFFQSxNQUFNcEcsbURBQUVBLENBQUNvQyxNQUFNLENBQUNqQyxzREFBY0EsRUFBRWtDLE1BQU0sQ0FBQ2xCO0lBQzNDLEVBQUUsT0FBTXFCLEdBQVE7UUFDWjFDLG1EQUFNQSxDQUFDa0IsS0FBSyxDQUFDd0IsRUFBRUMsT0FBTztJQUMxQjtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmVlbnMudHM/YWJjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbmQsIGFzYywgZGVzYywgZXEsIGluQXJyYXksIGlzTm90TnVsbCwgaXNOdWxsLCBub3RJbkFycmF5LCBvciB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0IHsgdjQgfSBmcm9tIFwidXVpZFwiO1xuXG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcbmltcG9ydCBzb2NrZXQgIGZyb20gJ0AvbGliL3NvY2tldCc7XG5pbXBvcnQgZGIgZnJvbSBcIi4uL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IHNjcmVlbnMsIHNjcmVlbnNEcmFmdHMsIHNjcmVlbnNIaXN0b3J5IH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgX2dldFNjcmVlbiwgX2dldFNjcmVlbnMsIF9saXN0UmF3U2NyZWVucywgX2xpc3RTY3JlZW5zIH0gZnJvbSAnLi4vcXVlcmllcy9zY3JlZW5zJztcbmltcG9ydCB7IF9saXN0U2NyaXB0cyB9IGZyb20gXCIuLi9xdWVyaWVzL19zY3JpcHRzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY29weVNjcmVlbnMoXG4gICAgeyBzY3JlZW5zUmVmZXJlbmNlcywgc2NyaXB0c1JlZmVyZW5jZXMgfTogeyBcbiAgICAgICAgc2NyZWVuc1JlZmVyZW5jZXM6IHN0cmluZ1tdLCBcbiAgICAgICAgc2NyaXB0c1JlZmVyZW5jZXM6IHN0cmluZ1tdOyBcbiAgICB9LFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZzsgZGF0YT86IGFueTsgfSA9IHsgc3VjY2VzczogdHJ1ZSB9OyBcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBzY3JlZW5zTGlzdCA9IGF3YWl0IF9saXN0UmF3U2NyZWVucyh7IHNjcmVlbnNSZWZlcmVuY2VzIH0pO1xuXG4gICAgICAgIGlmIChzY3JlZW5zTGlzdC5lcnJvcikgdGhyb3cgbmV3IEVycm9yKHNjcmVlbnNMaXN0LmVycm9yKTtcblxuICAgICAgICBjb25zdCBzY3JpcHRzTGlzdCA9IGF3YWl0IF9saXN0U2NyaXB0cyhzY3JpcHRzUmVmZXJlbmNlcyk7XG5cbiAgICAgICAgaWYgKHNjcmlwdHNMaXN0LmVycm9yKSB0aHJvdyBuZXcgRXJyb3Ioc2NyaXB0c0xpc3QuZXJyb3IpO1xuXG4gICAgICAgIGNvbnN0IGluc2VydERhdGE6IHR5cGVvZiBzY3JlZW5zRHJhZnRzLiRpbmZlckluc2VydFtdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHNjcmlwdHNMaXN0LmRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcmlwdFNjcmVlbnNMaXN0ID0gYXdhaXQgX2xpc3RTY3JlZW5zKHsgc2NyaXB0c1JlZmVyZW5jZXM6IFtzLnNjcmlwdElkISB8fCBzLnNjcmlwdERyYWZ0SWQhXSwgfSk7XG4gICAgICAgICAgICBjb25zdCBsYXN0UG9zaXRpb24gPSBzY3JpcHRTY3JlZW5zTGlzdC5kYXRhLmxlbmd0aCA/IE1hdGgubWF4KC4uLnNjcmlwdFNjcmVlbnNMaXN0LmRhdGEubWFwKHMgPT4gcy5wb3NpdGlvbikpIDogMDtcbiAgICAgICAgICAgIGxldCBwb3NpdGlvbiA9IGxhc3RQb3NpdGlvbiArIDE7XG5cbiAgICAgICAgICAgIHNjcmVlbnNMaXN0LmRhdGEuZm9yRWFjaChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzY3JlZW5JZCA9IHY0KCk7XG4gICAgICAgICAgICAgICAgaW5zZXJ0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQhLFxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkU2NyZWVuSWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGRhdGEudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgc2NyZWVuSWQsXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdElkOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24rKztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydERhdGEubGVuZ3RoKSBhd2FpdCBkYi5pbnNlcnQoc2NyZWVuc0RyYWZ0cykudmFsdWVzKGluc2VydERhdGEpO1xuXG4gICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX3NjcmVlbnNfZHJhZnRzJyk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2NvcHlTY3JlZW5zIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfdXBkYXRlU2NyZWVuc1dpdGhvdXRQdWJsaXNoaW5nKFxuICAgIHBheWxvYWQ6IHsgXG4gICAgICAgIHNjcmVlbklkOiBzdHJpbmc7XG4gICAgICAgIHNjcmlwdFJlZmVyZW5jZTogc3RyaW5nOyBcbiAgICAgICAgZGF0YTogUGFydGlhbDx0eXBlb2Ygc2NyZWVuc0RyYWZ0cy4kaW5mZXJJbnNlcnRbJ2RhdGEnXT47ICBcbiAgICB9W10sXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiB7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nOyBkYXRhPzogYW55OyB9ID0geyBzdWNjZXNzOiB0cnVlIH07IFxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2NyaXB0c1JlZmVyZW5jZXMgPSBwYXlsb2FkLm1hcChzID0+IHMuc2NyaXB0UmVmZXJlbmNlKS5maWx0ZXIocyA9PiBzKTtcblxuICAgICAgICBjb25zdCB3aGVyZVNjcmlwdCA9ICFzY3JpcHRzUmVmZXJlbmNlcy5sZW5ndGggPyB1bmRlZmluZWQgOiBvcihcbiAgICAgICAgICAgIGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JpcHRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAod2hlcmVTY3JpcHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB3aGVyZVNjcmlwdCxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgcHVibGlzaGVkU2NyZWVuczogdHlwZW9mIHNjcmVlbnMuJGluZmVyU2VsZWN0W10gPSBbXTtcbiAgICAgICAgICAgIGlmIChzY3JpcHRzUmVmZXJlbmNlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBwdWJsaXNoZWRTY3JlZW5zID0gYXdhaXQgZGIucXVlcnkuc2NyZWVucy5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiBhbmQoLi4uW1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNOdWxsKHNjcmVlbnMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluQXJyYXkoc2NyZWVucy5zY3JpcHRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uKGRyYWZ0cy5maWx0ZXIocyA9PiBzLnNjcmVlbklkKS5sZW5ndGggPyBbbm90SW5BcnJheShzY3JlZW5zLnNjcmVlbklkLCBkcmFmdHMubWFwKHMgPT4gcy5zY3JlZW5JZCEpKV0gOiBbXSksXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiBhc2Moc2NyZWVucy5wb3NpdGlvbiksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld0RyYWZ0czogdHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVySW5zZXJ0W10gPSBbXTtcbiAgICAgICAgICAgIGxldCB1cGRhdGVkRHJhZnRzID0gMDtcblxuICAgICAgICAgICAgZm9yIChjb25zdCB7IHNjcmVlbklkLCBkYXRhIH0gb2YgcGF5bG9hZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRyYWZ0ID0gZHJhZnRzLmZpbHRlcihzID0+IHMuZGF0YS5zY3JlZW5JZCA9PT0gc2NyZWVuSWQpWzBdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHB1Ymxpc2hlZFNjcmVlbiA9IHB1Ymxpc2hlZFNjcmVlbnMuZmlsdGVyKHMgPT4gcy5zY3JlZW5JZCA9PT0gc2NyZWVuSWQpWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRyYWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShzY3JlZW5zRHJhZnRzKS5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmRyYWZ0LmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pLndoZXJlKGVxKHNjcmVlbnNEcmFmdHMuaWQsIGRyYWZ0LmlkKSk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWREcmFmdHMrKztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hlZFNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICBuZXdEcmFmdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5JZDogcHVibGlzaGVkU2NyZWVuLnNjcmVlbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHB1Ymxpc2hlZFNjcmVlbi5zY3JpcHRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBkYXRhLnBvc2l0aW9uISxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHB1Ymxpc2hlZFNjcmVlbi50eXBlISxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5wdWJsaXNoZWRTY3JlZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkYXRhLnZlcnNpb24gfHwgKHB1Ymxpc2hlZFNjcmVlbi52ZXJzaW9uICsgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdEcmFmdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjcmVlbnNEcmFmdHMpLnZhbHVlcyhuZXdEcmFmdHMpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRzPy5icm9hZGNhc3RBY3Rpb24pIHNvY2tldC5lbWl0KCdkYXRhX2NoYW5nZWQnLCAnY3JlYXRlX3NjcmVlbnNfZHJhZnRzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1cGRhdGVkRHJhZnRzKSBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ3VwZGF0ZV9zY3JlZW5zX2RyYWZ0cycpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX3VwZGF0ZVNjcmVlbnNXaXRob3V0UHVibGlzaGluZyBFUlJPUicsIGUpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9wdWJsaXNoU2NyZWVucyhvcHRzPzoge1xuICAgIHNjcmlwdHNSZWZlcmVuY2VzPzogc3RyaW5nW107XG4gICAgc2NyZWVuc1JlZmVyZW5jZXM/OiBzdHJpbmdbXTtcbiAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xufSkge1xuICAgIGNvbnN0IHsgc2NyaXB0c1JlZmVyZW5jZXMsIHNjcmVlbnNSZWZlcmVuY2VzLCB9ID0geyAuLi5vcHRzLCB9O1xuXG4gICAgY29uc3QgcmVzdWx0czogeyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXTsgfSA9IHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCB1cGRhdGVzOiB7IHNjcmVlbklkOiBzdHJpbmc7IH1bXSA9IFtdO1xuICAgICAgICBsZXQgaW5zZXJ0czogeyBzY3JlZW5EcmFmdElkOiBzdHJpbmc7IH1bXSA9IFtdO1xuXG4gICAgICAgIGlmIChzY3JpcHRzUmVmZXJlbmNlcz8ubGVuZ3RoIHx8IHNjcmVlbnNSZWZlcmVuY2VzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBvcihcbiAgICAgICAgICAgICAgICAgICAgIXNjcmlwdHNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICAgICAgIXNjcmlwdHNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgICAgICAgICAhc2NyZWVuc1JlZmVyZW5jZXM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JlZW5JZCwgc2NyZWVuc1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgICAgICAgICAhc2NyZWVuc1JlZmVyZW5jZXM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBzY3JlZW5zUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiB7IHNjcmVlbklkOiB0cnVlLCBzY3JlZW5EcmFmdElkOiB0cnVlLCB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHVwZGF0ZXMgPSByZXMuZmlsdGVyKHMgPT4gcy5zY3JlZW5JZCkubWFwKHMgPT4gKHsgc2NyZWVuSWQ6IHMuc2NyZWVuSWQhIH0pKTtcbiAgICAgICAgICAgIGluc2VydHMgPSByZXMuZmlsdGVyKHMgPT4gIXMuc2NyZWVuSWQpLm1hcChzID0+ICh7IHNjcmVlbkRyYWZ0SWQ6IHMuc2NyZWVuRHJhZnRJZCEgfSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgX3NjcmVlbnNEcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZTogaXNOb3ROdWxsKHNjcmVlbnNEcmFmdHMuc2NyaXB0SWQpLFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHsgc2NyZWVuSWQ6IHRydWUsIHNjcmVlbkRyYWZ0SWQ6IHRydWUsIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHVwZGF0ZXMgPSBfc2NyZWVuc0RyYWZ0cy5maWx0ZXIocyA9PiBzLnNjcmVlbklkKS5tYXAocyA9PiAoeyBzY3JlZW5JZDogcy5zY3JlZW5JZCEgfSkpO1xuICAgICAgICAgICAgaW5zZXJ0cyA9IF9zY3JlZW5zRHJhZnRzLmZpbHRlcihzID0+ICFzLnNjcmVlbklkKS5tYXAocyA9PiAoeyBzY3JlZW5EcmFmdElkOiBzLnNjcmVlbkRyYWZ0SWQhIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1cGRhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgX3VwZGF0ZVNjcmVlbnModXBkYXRlcyk7XG4gICAgICAgICAgICByZXMuZm9yRWFjaChzID0+IHMuZXJyb3IgJiYgZXJyb3JzLnB1c2gocy5lcnJvcikpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc2VydHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBfY3JlYXRlU2NyZWVucyhpbnNlcnRzKTtcbiAgICAgICAgICAgIHJlcy5lcnJvcnM/LmZvckVhY2goZSA9PiBlcnJvcnMucHVzaChlKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICByZXN1bHRzLmVycm9ycyA9IGVycm9ycztcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignX3B1Ymxpc2hTY3JlZW5zIEVSUk9SUycsIGVycm9ycyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbZS5tZXNzYWdlXTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfcHVibGlzaFNjcmVlbnMgRVJST1InLCBlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZGVsZXRlU2NyZWVucyhcbiAgICBzY3JlZW5JZHM6IHN0cmluZ1tdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgaWYgKHNjcmVlbklkcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgd2hlcmUgPSBpbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIHNjcmVlbklkcyk7XG5cbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBkZWxldGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAudXBkYXRlKHNjcmVlbnMpXG4gICAgICAgICAgICAuc2V0KHsgZGVsZXRlZEF0LCB9KVxuICAgICAgICAgICAgLndoZXJlKHdoZXJlKTtcblxuICAgICAgICBhd2FpdCBkYi5kZWxldGUoc2NyZWVuc0RyYWZ0cykud2hlcmUoYW5kKFxuICAgICAgICAgICAgaXNOb3ROdWxsKHNjcmVlbnNEcmFmdHMuc2NyZWVuSWQpLFxuICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmVlbklkLCBzY3JlZW5JZHMpXG4gICAgICAgICkpO1xuXG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JlZW5zSGlzdG9yeSkudmFsdWVzKGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgICB2ZXJzaW9uOiBpdGVtLnZlcnNpb24sXG4gICAgICAgICAgICBzY3JlZW5JZDogaXRlbS5zY3JlZW5JZCxcbiAgICAgICAgICAgIHNjcmlwdElkOiBpdGVtLnNjcmlwdElkLFxuICAgICAgICAgICAgY2hhbmdlczoge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZV9zY3JlZW4nLFxuICAgICAgICAgICAgICAgIGRlc2NyZWVuaW9uOiAnRGVsZXRlIHNjcmVlbicsXG4gICAgICAgICAgICAgICAgb2xkVmFsdWVzOiBbeyBkZWxldGVkQXQ6IG51bGwsIH1dLFxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlczogW3sgZGVsZXRlZEF0IH1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSkpKTtcblxuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2RlbGV0ZV9zY3JlZW5zJyk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NyZWF0ZVNjcmVlbnMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgc2NyZWVuRHJhZnRJZDogc3RyaW5nO1xuICAgIH0pW10sIFxuICAgIG9wdHM/OiB7XG4gICAgICAgIHJldHVybkluc2VydGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBsZXQgcmVzdWx0czoge1xuICAgICAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgICAgICBlcnJvcnM/OiBzdHJpbmdbXTtcbiAgICAgICAgaW5zZXJ0ZWQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX2dldFNjcmVlbnM+PlsnZGF0YSddO1xuICAgIH0gPSB7IGluc2VydGVkOiBbXSwgc3VjY2VzczogZmFsc2UsIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnNlcnREYXRhOiB0eXBlb2Ygc2NyZWVucy4kaW5mZXJJbnNlcnRbXSA9IFtdO1xuXG4gICAgICAgIGxldCBkcmFmdHMgPSAhZGF0YS5sZW5ndGggPyBbXSA6IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBkYXRhLm1hcChjID0+IGMuc2NyZWVuRHJhZnRJZCkpLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyB3ZSdsbCB1c2UgZGF0YSBiZWZvcmUgdG8gY29tcGFyZSBjaGFuZ2VzXG4gICAgICAgIGxldCBkYXRhQmVmb3JlOiB0eXBlb2Ygc2NyZWVucy4kaW5mZXJTZWxlY3RbXSA9IFtdO1xuICAgICAgICBpZiAoZHJhZnRzLmZpbHRlcihjID0+IGMuc2NyZWVuSWQpLmxlbmd0aCkge1xuICAgICAgICAgICAgZGF0YUJlZm9yZSA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnMuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBpbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIGRyYWZ0cy5maWx0ZXIoYyA9PiBjLnNjcmVlbklkKS5tYXAoYyA9PiBjLnNjcmVlbklkISkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yKGNvbnN0IHsgaWQsIHNjcmlwdElkOiBfc2NyaXB0SWQsIGRhdGEgfSBvZiBkcmFmdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcmVlbklkID0gZGF0YS5zY3JlZW5JZCB8fCB2NCgpO1xuICAgICAgICAgICAgY29uc3Qgc2NyaXB0SWQgPSAoZGF0YS5zY3JpcHRJZCB8fCBfc2NyaXB0SWQpITtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IC4uLmRhdGEsIHNjcmVlbklkLCBzY3JpcHRJZCB9O1xuICAgICAgICAgICAgaW5zZXJ0RGF0YS5wdXNoKHBheWxvYWQpO1xuICAgICAgICAgICAgZHJhZnRzID0gZHJhZnRzLm1hcChkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZC5pZCA9PT0gaWQpIGQuZGF0YS5zY3JlZW5JZCA9IHNjcmVlbklkO1xuICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLmluc2VydChzY3JlZW5zKS52YWx1ZXMocGF5bG9hZCk7XG4gICAgICAgICAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHMuZXJyb3JzID0gWy4uLihyZXN1bHRzLmVycm9ycyB8fCBbXSksIGBFcnJvciBpbnNlcnRpbmcgJHtkYXRhLnRpdGxlfSAtICR7ZS5tZXNzYWdlfWBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaW5zZXJ0ZWQgPSBhd2FpdCBfZ2V0U2NyZWVucyh7IHNjcmVlbklkczogaW5zZXJ0RGF0YS5tYXAoYyA9PiBjLnNjcmVlbklkISksIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuaW5zZXJ0ZWQgPSBvcHRzPy5yZXR1cm5JbnNlcnRlZCA/IGluc2VydGVkLmRhdGEgOiBbXTtcbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gdHJ1ZTtcblxuICAgICAgICBhd2FpdCBfc2F2ZVNjcmVlbnNIaXN0b3J5KHsgZHJhZnRzOiBkcmFmdHMsIHByZXZpb3VzOiBkYXRhQmVmb3JlLCB9KTtcblxuICAgICAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjcmVlbnNEcmFmdHMpLndoZXJlKGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5pZCwgZHJhZnRzLm1hcChkID0+IGQuaWQpKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JlZW5zJyk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgcmVzdWx0cy5lcnJvcnMgPSBbZS5tZXNzYWdlXTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfY3JlYXRlU2NyZWVucyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX3VwZGF0ZVNjcmVlbnMoXG4gICAgZGF0YTogKHtcbiAgICAgICAgc2NyZWVuSWQ6IHN0cmluZztcbiAgICB9KVtdLCBcbiAgICBvcHRzPzoge1xuICAgICAgICByZXR1cm5VcGRhdGVkPzogYm9vbGVhbjtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCByZXN1bHRzOiAoeyBcbiAgICAgICAgc2NyZWVuSWQ6IHN0cmluZztcbiAgICAgICAgc2NyZWVuPzogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0U2NyZWVuPj47XG4gICAgICAgIGVycm9yPzogc3RyaW5nOyBcbiAgICB9KVtdID0gW107XG5cbiAgICBsZXQgZHJhZnRzID0gIWRhdGEubGVuZ3RoID8gW10gOiBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JlZW5JZCwgZGF0YS5tYXAoYyA9PiBjLnNjcmVlbklkKSksXG4gICAgfSk7XG5cbiAgICAvLyB3ZSdsbCB1c2UgZGF0YSBiZWZvcmUgdG8gY29tcGFyZSBjaGFuZ2VzXG4gICAgbGV0IGRhdGFCZWZvcmU6IHR5cGVvZiBzY3JlZW5zLiRpbmZlclNlbGVjdFtdID0gW107XG4gICAgaWYgKGRyYWZ0cy5maWx0ZXIoYyA9PiBjLnNjcmVlbklkKS5sZW5ndGgpIHtcbiAgICAgICAgZGF0YUJlZm9yZSA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGluQXJyYXkoc2NyZWVucy5zY3JlZW5JZCwgZHJhZnRzLmZpbHRlcihjID0+IGMuc2NyZWVuSWQpLm1hcChjID0+IGMuc2NyZWVuSWQhKSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZm9yKGNvbnN0IHsgc2NyZWVuSWQ6IF9zY3JlZW5JZCwgZGF0YTogYyB9IG9mIGRyYWZ0cykge1xuICAgICAgICBjb25zdCBzY3JlZW5JZCA9IF9zY3JlZW5JZCE7XG5cbiAgICAgICAgY29uc3QgeyBzY3JlZW5JZDogX19zY3JlZW5JZCwgaWQsIG9sZFNjcmVlbklkLCBjcmVhdGVkQXQsIHVwZGF0ZWRBdCwgZGVsZXRlZEF0LCAuLi5wYXlsb2FkIH0gPSBjO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgICAgICAgICAgIC4uLnBheWxvYWQsXG4gICAgICAgICAgICAgICAgcHVibGlzaERhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAudXBkYXRlKHNjcmVlbnMpXG4gICAgICAgICAgICAgICAgLnNldCh1cGRhdGVzKVxuICAgICAgICAgICAgICAgIC53aGVyZShlcShzY3JlZW5zLnNjcmVlbklkLCBzY3JlZW5JZCkpO1xuXG4gICAgICAgICAgICBjb25zdCBzY3JlZW4gPSAhb3B0cz8ucmV0dXJuVXBkYXRlZCA/IHVuZGVmaW5lZCA6IGF3YWl0IF9nZXRTY3JlZW4oc2NyZWVuSWQpO1xuXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBzY3JlZW5JZCwgc2NyZWVuLCB9KTtcbiAgICAgICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgX3VwZGF0ZVNjcmVlbnMgc2NyZWVuSWQ9JHtzY3JlZW5JZH1gLCBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgc2NyZWVuSWQsIGVycm9yOiBlLm1lc3NhZ2UsIH0pO1xuICAgICAgICAgICAgZHJhZnRzID0gZHJhZnRzLmZpbHRlcihjID0+IGMuZGF0YS5zY3JlZW5JZCAhPT0gc2NyZWVuSWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXdhaXQgX3NhdmVTY3JlZW5zSGlzdG9yeSh7IGRyYWZ0czogZHJhZnRzLCBwcmV2aW91czogZGF0YUJlZm9yZSwgfSk7XG5cbiAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBkYi5kZWxldGUoc2NyZWVuc0RyYWZ0cykud2hlcmUoaW5BcnJheShzY3JlZW5zRHJhZnRzLmlkLCBkcmFmdHMubWFwKGQgPT4gZC5pZCkpKTtcbiAgICB9XG5cbiAgICBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgJ2NyZWF0ZV9zY3JlZW5zJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9zYXZlU2NyZWVuc0hpc3RvcnkoeyBwcmV2aW91cywgZHJhZnRzLCB9OiB7XG4gICAgZHJhZnRzOiB0eXBlb2Ygc2NyZWVuc0RyYWZ0cy4kaW5mZXJTZWxlY3RbXTtcbiAgICBwcmV2aW91czogdHlwZW9mIHNjcmVlbnMuJGluZmVyU2VsZWN0W107XG59KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5zZXJ0RGF0YTogdHlwZW9mIHNjcmVlbnNIaXN0b3J5LiRpbmZlckluc2VydFtdID0gW107XG5cbiAgICAgICAgZm9yKGNvbnN0IGMgb2YgZHJhZnRzKSB7XG4gICAgICAgICAgICBjb25zdCBjaGFuZ2VIaXN0b3J5RGF0YTogdHlwZW9mIHNjcmVlbnNIaXN0b3J5LiRpbmZlckluc2VydCA9IHtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBjPy5kYXRhPy52ZXJzaW9uIHx8IDEsXG4gICAgICAgICAgICAgICAgc2NyZWVuSWQ6IGM/LmRhdGE/LnNjcmVlbklkISxcbiAgICAgICAgICAgICAgICBzY3JpcHRJZDogYz8uZGF0YT8uc2NyaXB0SWQsXG4gICAgICAgICAgICAgICAgY2hhbmdlczoge30sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoYz8uZGF0YT8udmVyc2lvbiA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNoYW5nZUhpc3RvcnlEYXRhLmNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2NyZWF0ZV9zY3JlZW4nLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmVlbmlvbjogJ0NyZWF0ZSBzY3JlZW4nLFxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZXM6IFtdLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXYgPSBwcmV2aW91cy5maWx0ZXIocHJldkMgPT4gcHJldkMuc2NyZWVuSWQgPT09IGM/LmRhdGE/LnNjcmVlbklkKVswXTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlczogYW55W10gPSBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZXM6IGFueVtdID0gW107XG5cbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cygoeyAuLi5jPy5kYXRhIH0pKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGtleSA9PiAhWyd2ZXJzaW9uJywgJ2RyYWZ0J10uaW5jbHVkZXMoa2V5KSlcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goX2tleSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBfa2V5IGFzIHVua25vd24gYXMga2V5b2YgdHlwZW9mIGMuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gYy5kYXRhW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9ICh7IC4uLnByZXYgfSlba2V5IGFzIGtleW9mIHR5cGVvZiBwcmV2XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShuZXdWYWx1ZSkgIT09IEpTT04uc3RyaW5naWZ5KG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlcy5wdXNoKHsgW2tleV06IG9sZFZhbHVlLCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZXMucHVzaCh7IFtrZXldOiBuZXdWYWx1ZSwgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY2hhbmdlSGlzdG9yeURhdGEuY2hhbmdlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAndXBkYXRlX3NjcmVlbicsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyZWVuaW9uOiAnVXBkYXRlIHNjcmVlbicsXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlcyxcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVzLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGluc2VydERhdGEucHVzaChjaGFuZ2VIaXN0b3J5RGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NyZWVuc0hpc3RvcnkpLnZhbHVlcyhpbnNlcnREYXRhKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoZS5tZXNzYWdlKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiYW5kIiwiYXNjIiwiZXEiLCJpbkFycmF5IiwiaXNOb3ROdWxsIiwiaXNOdWxsIiwibm90SW5BcnJheSIsIm9yIiwidjQiLCJsb2dnZXIiLCJzb2NrZXQiLCJkYiIsInNjcmVlbnMiLCJzY3JlZW5zRHJhZnRzIiwic2NyZWVuc0hpc3RvcnkiLCJfZ2V0U2NyZWVuIiwiX2dldFNjcmVlbnMiLCJfbGlzdFJhd1NjcmVlbnMiLCJfbGlzdFNjcmVlbnMiLCJfbGlzdFNjcmlwdHMiLCJfY29weVNjcmVlbnMiLCJzY3JlZW5zUmVmZXJlbmNlcyIsInNjcmlwdHNSZWZlcmVuY2VzIiwib3B0cyIsInJlc3VsdHMiLCJzdWNjZXNzIiwic2NyZWVuc0xpc3QiLCJlcnJvciIsIkVycm9yIiwic2NyaXB0c0xpc3QiLCJpbnNlcnREYXRhIiwicyIsImRhdGEiLCJzY3JpcHRTY3JlZW5zTGlzdCIsInNjcmlwdElkIiwic2NyaXB0RHJhZnRJZCIsImxhc3RQb3NpdGlvbiIsImxlbmd0aCIsIk1hdGgiLCJtYXgiLCJtYXAiLCJwb3NpdGlvbiIsImZvckVhY2giLCJzY3JlZW5JZCIsInB1c2giLCJvbGRTY3JlZW5JZCIsInR5cGUiLCJpbnNlcnQiLCJ2YWx1ZXMiLCJicm9hZGNhc3RBY3Rpb24iLCJlbWl0IiwiZSIsIm1lc3NhZ2UiLCJfdXBkYXRlU2NyZWVuc1dpdGhvdXRQdWJsaXNoaW5nIiwicGF5bG9hZCIsInNjcmlwdFJlZmVyZW5jZSIsImZpbHRlciIsIndoZXJlU2NyaXB0IiwidW5kZWZpbmVkIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsIndoZXJlIiwicHVibGlzaGVkU2NyZWVucyIsImRlbGV0ZWRBdCIsIm9yZGVyQnkiLCJuZXdEcmFmdHMiLCJ1cGRhdGVkRHJhZnRzIiwiZHJhZnQiLCJwdWJsaXNoZWRTY3JlZW4iLCJ1cGRhdGUiLCJzZXQiLCJpZCIsInZlcnNpb24iLCJfcHVibGlzaFNjcmVlbnMiLCJlcnJvcnMiLCJ1cGRhdGVzIiwiaW5zZXJ0cyIsInJlcyIsInNjcmVlbkRyYWZ0SWQiLCJjb2x1bW5zIiwiX3NjcmVlbnNEcmFmdHMiLCJfdXBkYXRlU2NyZWVucyIsIl9jcmVhdGVTY3JlZW5zIiwiX2RlbGV0ZVNjcmVlbnMiLCJzY3JlZW5JZHMiLCJpdGVtcyIsIkRhdGUiLCJkZWxldGUiLCJpdGVtIiwiY2hhbmdlcyIsImFjdGlvbiIsImRlc2NyZWVuaW9uIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiaW5zZXJ0ZWQiLCJjIiwiZGF0YUJlZm9yZSIsIl9zY3JpcHRJZCIsImQiLCJ0aXRsZSIsInJldHVybkluc2VydGVkIiwiX3NhdmVTY3JlZW5zSGlzdG9yeSIsInByZXZpb3VzIiwiX3NjcmVlbklkIiwiX19zY3JlZW5JZCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInB1Ymxpc2hEYXRlIiwic2NyZWVuIiwicmV0dXJuVXBkYXRlZCIsImNoYW5nZUhpc3RvcnlEYXRhIiwicHJldiIsInByZXZDIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsImluY2x1ZGVzIiwiX2tleSIsIm5ld1ZhbHVlIiwib2xkVmFsdWUiLCJKU09OIiwic3RyaW5naWZ5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/screens.ts\n");

/***/ }),

/***/ "(rsc)/./databases/mutations/scripts-drafts.ts":
/*!***********************************************!*\
  !*** ./databases/mutations/scripts-drafts.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _createScriptsDrafts: () => (/* binding */ _createScriptsDrafts),\n/* harmony export */   _deleteAllScriptsDrafts: () => (/* binding */ _deleteAllScriptsDrafts),\n/* harmony export */   _deleteScriptsDrafts: () => (/* binding */ _deleteScriptsDrafts),\n/* harmony export */   _updateScriptsDrafts: () => (/* binding */ _updateScriptsDrafts)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./lib/socket.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _queries_scripts_drafts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../queries/scripts-drafts */ \"(rsc)/./databases/queries/scripts-drafts.ts\");\n/* harmony import */ var _queries_scripts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../queries/_scripts */ \"(rsc)/./databases/queries/_scripts/index.ts\");\n/* harmony import */ var _scripts_restore_screens__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./_scripts/_restore-screens */ \"(rsc)/./databases/mutations/_scripts/_restore-screens.ts\");\n\n\n\n\n\n\n\n\nasync function _deleteScriptsDrafts(scriptsDraftsIds, opts) {\n    if (scriptsDraftsIds.length) {\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptsDraftsIds));\n        // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'delete_scripts_drafts', data: scriptsDraftsIds, });\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_scripts_drafts\");\n        if (scriptsDraftsIds.length) {\n            await (0,_scripts_restore_screens__WEBPACK_IMPORTED_MODULE_5__._restoreScreens)({\n                restoreKeys: scriptsDraftsIds.map((id)=>`script_draft_${id}`)\n            });\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensHistory).set({\n                restoreKey: null\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensHistory.restoreKey, scriptsDraftsIds.map((sId)=>`script_draft_${sId}`)));\n        }\n    }\n    return true;\n}\nasync function _deleteAllScriptsDrafts(opts) {\n    const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findMany({\n        columns: {\n            scriptDraftId: true,\n            scriptId: true\n        }\n    });\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].delete(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts);\n    if (drafts.length) {\n        await (0,_scripts_restore_screens__WEBPACK_IMPORTED_MODULE_5__._restoreScreens)({\n            restoreKeys: drafts.map((d)=>`script_draft_${d.scriptDraftId}`)\n        });\n        await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensHistory).set({\n            restoreKey: null\n        }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensHistory.restoreKey, drafts.map((s)=>`script_draft_${s.scriptDraftId}`)));\n    }\n    if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"delete_scripts_drafts\");\n    return res;\n}\nasync function _createScriptsDrafts(data, opts) {\n    let results = {\n        inserted: [],\n        success: false\n    };\n    try {\n        const insertData = [];\n        const scriptsList = await (0,_queries_scripts__WEBPACK_IMPORTED_MODULE_4__._listScripts)();\n        const lastPosition = scriptsList.data.length ? Math.max(...scriptsList.data.map((s)=>s.position)) : 0;\n        let position = lastPosition + 1;\n        for (const c of data){\n            let scriptDraftId = c.scriptId || c.data.scriptId;\n            const existing = !scriptDraftId ? null : await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptDraftId)\n            });\n            if (!existing) {\n                insertData.push({\n                    ...c,\n                    data: {\n                        ...c.data,\n                        position: c.scriptId ? c.data.position : position\n                    },\n                    scriptDraftId: scriptDraftId || (0,uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"])()\n                });\n                if (!c.scriptId) position++;\n            }\n        }\n        if (insertData.length) await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].insert(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts).values(insertData);\n        if (opts?.returnInserted) {\n            const inserted = await (0,_queries_scripts_drafts__WEBPACK_IMPORTED_MODULE_3__._getScriptsDrafts)({\n                scriptDraftIds: insertData.map((u)=>u.scriptDraftId)\n            });\n            results.inserted = inserted.data;\n        }\n        results.success = true;\n        // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'create_scripts_drafts', data: insertData.map(u => u.scriptDraftId), });\n        if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"create_scripts_drafts\");\n    } catch (e) {\n        results.error = e.message;\n    } finally{\n        return results;\n    }\n}\nasync function _updateScriptsDrafts(data, opts) {\n    const results = [];\n    for (const { scriptDraftId, data: draft } of data){\n        try {\n            const existing = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findFirst({\n                where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptDraftId)\n            });\n            const draftData = {\n                ...existing?.data,\n                ...draft\n            };\n            await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].update(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts).set({\n                data: draftData\n            }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptDraftId));\n            const scriptDraft = !opts?.returnUpdated ? undefined : await (0,_queries_scripts_drafts__WEBPACK_IMPORTED_MODULE_3__._getScriptDraft)(scriptDraftId);\n            results.push({\n                scriptDraftId,\n                scriptDraft\n            });\n            // if (opts?.broadcastAction) socket.emit('data_changed', { action: 'update_scripts_drafts', data: data.map(u => u.scriptDraftId), });\n            if (opts?.broadcastAction) _lib_socket__WEBPACK_IMPORTED_MODULE_0__[\"default\"].emit(\"data_changed\", \"update_scripts_drafts\");\n        } catch (e) {\n            results.push({\n                scriptDraftId,\n                error: e.message\n            });\n        }\n    }\n    return results;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmlwdHMtZHJhZnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUEwQztBQUNoQjtBQUVTO0FBQ0o7QUFDOEI7QUFDbUI7QUFDN0I7QUFDVztBQUV2RCxlQUFlVyxxQkFDbEJDLGdCQUEwQixFQUMxQkMsSUFFQztJQUVELElBQUlELGlCQUFpQkUsTUFBTSxFQUFFO1FBQ3pCLE1BQU1WLG1EQUFFQSxDQUFDVyxNQUFNLENBQUNWLHFEQUFhQSxFQUFFVyxLQUFLLENBQUNmLG9EQUFPQSxDQUFDSSxxREFBYUEsQ0FBQ1ksYUFBYSxFQUFFTDtRQUMxRSx3SEFBd0g7UUFDeEgsSUFBSUMsTUFBTUssaUJBQWlCZixtREFBTUEsQ0FBQ2dCLElBQUksQ0FBQyxnQkFBZ0I7UUFDdkQsSUFBSVAsaUJBQWlCRSxNQUFNLEVBQUU7WUFDekIsTUFBTUoseUVBQWVBLENBQUM7Z0JBQUVVLGFBQWFSLGlCQUFpQlMsR0FBRyxDQUFDQyxDQUFBQSxLQUFNLENBQUMsYUFBYSxFQUFFQSxHQUFHLENBQUM7WUFBRztZQUN2RixNQUFNbEIsbURBQUVBLENBQUNtQixNQUFNLENBQUNqQixzREFBY0EsRUFBRWtCLEdBQUcsQ0FBQztnQkFBRUMsWUFBWTtZQUFNLEdBQUdULEtBQUssQ0FBQ2Ysb0RBQU9BLENBQUNLLHNEQUFjQSxDQUFDbUIsVUFBVSxFQUFFYixpQkFBaUJTLEdBQUcsQ0FBQ0ssQ0FBQUEsTUFBTyxDQUFDLGFBQWEsRUFBRUEsSUFBSSxDQUFDO1FBQ3pKO0lBQ0o7SUFDQSxPQUFPO0FBQ1g7QUFFTyxlQUFlQyx3QkFDbEJkLElBRUM7SUFFRCxNQUFNZSxTQUFTLE1BQU14QixtREFBRUEsQ0FBQ3lCLEtBQUssQ0FBQ3hCLGFBQWEsQ0FBQ3lCLFFBQVEsQ0FBQztRQUNqREMsU0FBUztZQUNMZCxlQUFlO1lBQ2ZlLFVBQVU7UUFDZDtJQUNKO0lBQ0EsTUFBTUMsTUFBTSxNQUFNN0IsbURBQUVBLENBQUNXLE1BQU0s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NUMsbURBQUVBLENBQUN5QixLQUFLLENBQUN4QixhQUFhLENBQUM0QyxTQUFTLENBQUM7Z0JBQ3BEakMsT0FBT2hCLCtDQUFFQSxDQUFDSyxxREFBYUEsQ0FBQ1ksYUFBYSxFQUFFQTtZQUMzQztZQUNBLE1BQU00QyxZQUFZO2dCQUFFLEdBQUdiLFVBQVVYLElBQUk7Z0JBQUUsR0FBR3VCLEtBQUs7WUFBRTtZQUNqRCxNQUFNeEQsbURBQUVBLENBQUNtQixNQUFNLENBQUNsQixxREFBYUEsRUFBRW1CLEdBQUcsQ0FBQztnQkFBRWEsTUFBTXdCO1lBQVcsR0FBRzdDLEtBQUssQ0FBQ2hCLCtDQUFFQSxDQUFDSyxxREFBYUEsQ0FBQ1ksYUFBYSxFQUFFQTtZQUMvRixNQUFNNkMsY0FBYyxDQUFDakQsTUFBTWtELGdCQUFnQkMsWUFBWSxNQUFNekQsd0VBQWVBLENBQUNVO1lBQzdFcUIsUUFBUVksSUFBSSxDQUFDO2dCQUFFakM7Z0JBQWU2QztZQUFhO1lBQzNDLHNJQUFzSTtZQUN0SSxJQUFJakQsTUFBTUssaUJBQWlCZixtREFBTUEsQ0FBQ2dCLElBQUksQ0FBQyxnQkFBZ0I7UUFDM0QsRUFBRSxPQUFNcUMsR0FBUTtZQUNabEIsUUFBUVksSUFBSSxDQUFDO2dCQUFFakM7Z0JBQWV3QyxPQUFPRCxFQUFFRSxPQUFPO1lBQUU7UUFDcEQ7SUFDSjtJQUVBLE9BQU9wQjtBQUNYIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvbXV0YXRpb25zL3NjcmlwdHMtZHJhZnRzLnRzPzg4YzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGluQXJyYXkgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCB7IHY0IH0gZnJvbSBcInV1aWRcIjtcblxuaW1wb3J0IHNvY2tldCAgZnJvbSAnQC9saWIvc29ja2V0JztcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgc2NyaXB0c0RyYWZ0cywgc2NyZWVuc0hpc3RvcnkgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgeyBfZ2V0U2NyaXB0RHJhZnQsIF9nZXRTY3JpcHRzRHJhZnRzLCB9IGZyb20gJy4uL3F1ZXJpZXMvc2NyaXB0cy1kcmFmdHMnO1xuaW1wb3J0IHsgX2xpc3RTY3JpcHRzIH0gZnJvbSBcIi4uL3F1ZXJpZXMvX3NjcmlwdHNcIjtcbmltcG9ydCB7IF9yZXN0b3JlU2NyZWVucyB9IGZyb20gXCIuL19zY3JpcHRzL19yZXN0b3JlLXNjcmVlbnNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVTY3JpcHRzRHJhZnRzKFxuICAgIHNjcmlwdHNEcmFmdHNJZHM6IHN0cmluZ1tdLFxuICAgIG9wdHM/OiB7XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgaWYgKHNjcmlwdHNEcmFmdHNJZHMubGVuZ3RoKSB7XG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY3JpcHRzRHJhZnRzKS53aGVyZShpbkFycmF5KHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c0RyYWZ0c0lkcykpO1xuICAgICAgICAvLyBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgeyBhY3Rpb246ICdkZWxldGVfc2NyaXB0c19kcmFmdHMnLCBkYXRhOiBzY3JpcHRzRHJhZnRzSWRzLCB9KTtcbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdkZWxldGVfc2NyaXB0c19kcmFmdHMnKTtcbiAgICAgICAgaWYgKHNjcmlwdHNEcmFmdHNJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBhd2FpdCBfcmVzdG9yZVNjcmVlbnMoeyByZXN0b3JlS2V5czogc2NyaXB0c0RyYWZ0c0lkcy5tYXAoaWQgPT4gYHNjcmlwdF9kcmFmdF8ke2lkfWApLCB9KTtcbiAgICAgICAgICAgIGF3YWl0IGRiLnVwZGF0ZShzY3JlZW5zSGlzdG9yeSkuc2V0KHsgcmVzdG9yZUtleTogbnVsbCwgfSkud2hlcmUoaW5BcnJheShzY3JlZW5zSGlzdG9yeS5yZXN0b3JlS2V5LCBzY3JpcHRzRHJhZnRzSWRzLm1hcChzSWQgPT4gYHNjcmlwdF9kcmFmdF8ke3NJZH1gKSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2RlbGV0ZUFsbFNjcmlwdHNEcmFmdHMoXG4gICAgb3B0cz86IHtcbiAgICAgICAgYnJvYWRjYXN0QWN0aW9uPzogYm9vbGVhbjtcbiAgICB9XG4pIHtcbiAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLmRlbGV0ZShzY3JpcHRzRHJhZnRzKTtcbiAgICBpZiAoZHJhZnRzLmxlbmd0aCkge1xuICAgICAgICBhd2FpdCBfcmVzdG9yZVNjcmVlbnMoeyByZXN0b3JlS2V5czogZHJhZnRzLm1hcChkID0+IGBzY3JpcHRfZHJhZnRfJHtkLnNjcmlwdERyYWZ0SWR9YCksIH0pO1xuICAgICAgICBhd2FpdCBkYi51cGRhdGUoc2NyZWVuc0hpc3RvcnkpLnNldCh7IHJlc3RvcmVLZXk6IG51bGwsIH0pLndoZXJlKGluQXJyYXkoc2NyZWVuc0hpc3RvcnkucmVzdG9yZUtleSwgZHJhZnRzLm1hcChzID0+IGBzY3JpcHRfZHJhZnRfJHtzLnNjcmlwdERyYWZ0SWR9YCkpKTtcbiAgICB9XG4gICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdkZWxldGVfc2NyaXB0c19kcmFmdHMnKTtcbiAgICByZXR1cm4gcmVzO1xufVxuXG5leHBvcnQgdHlwZSBDcmVhdGVTY3JpcHRzRHJhZnRzUGFyYW1zID0gKHR5cGVvZiBzY3JpcHRzRHJhZnRzLiRpbmZlckluc2VydCAmIHtcbiAgICBzY3JpcHREcmFmdElkOiBzdHJpbmc7XG4gICAgZGF0YTogRXhjbHVkZTwodHlwZW9mIHNjcmlwdHNEcmFmdHMuJGluZmVySW5zZXJ0KVsnZGF0YSddLCAndmVyc2lvbic+O1xufSlbXTtcblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NyZWF0ZVNjcmlwdHNEcmFmdHMoXG4gICAgZGF0YTogQ3JlYXRlU2NyaXB0c0RyYWZ0c1BhcmFtcywgXG4gICAgb3B0cz86IHtcbiAgICAgICAgcmV0dXJuSW5zZXJ0ZWQ/OiBib29sZWFuO1xuICAgICAgICBicm9hZGNhc3RBY3Rpb24/OiBib29sZWFuO1xuICAgIH1cbikge1xuICAgIGxldCByZXN1bHRzOiB7XG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIGVycm9yPzogc3RyaW5nO1xuICAgICAgICBpbnNlcnRlZDogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfZ2V0U2NyaXB0c0RyYWZ0cz4+WydkYXRhJ107XG4gICAgfSA9IHsgaW5zZXJ0ZWQ6IFtdLCBzdWNjZXNzOiBmYWxzZSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluc2VydERhdGE6IHR5cGVvZiBzY3JpcHRzRHJhZnRzLiRpbmZlckluc2VydFtdID0gW107XG5cbiAgICAgICAgY29uc3Qgc2NyaXB0c0xpc3QgPSBhd2FpdCBfbGlzdFNjcmlwdHMoKTtcbiAgICAgICAgY29uc3QgbGFzdFBvc2l0aW9uID0gc2NyaXB0c0xpc3QuZGF0YS5sZW5ndGggPyBNYXRoLm1heCguLi5zY3JpcHRzTGlzdC5kYXRhLm1hcChzID0+IHMucG9zaXRpb24pKSA6IDA7XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IGxhc3RQb3NpdGlvbiArIDE7XG4gICAgICAgIFxuICAgICAgICBmb3IoY29uc3QgYyBvZiBkYXRhKSB7XG4gICAgICAgICAgICBsZXQgc2NyaXB0RHJhZnRJZCA9IGMuc2NyaXB0SWQgfHwgYy5kYXRhLnNjcmlwdElkO1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSAhc2NyaXB0RHJhZnRJZCA/IG51bGwgOiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IGVxKHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0RHJhZnRJZCksXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgICAgIGluc2VydERhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIC4uLmMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmMuZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBjLnNjcmlwdElkID8gYy5kYXRhLnBvc2l0aW9uIDogcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHNjcmlwdERyYWZ0SWQgfHwgdjQoKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWMuc2NyaXB0SWQpIHBvc2l0aW9uKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5zZXJ0RGF0YS5sZW5ndGgpICBhd2FpdCBkYi5pbnNlcnQoc2NyaXB0c0RyYWZ0cykudmFsdWVzKGluc2VydERhdGEpO1xuICAgICAgICBcbiAgICAgICAgaWYgKG9wdHM/LnJldHVybkluc2VydGVkKSB7XG4gICAgICAgICAgICBjb25zdCBpbnNlcnRlZCA9IGF3YWl0IF9nZXRTY3JpcHRzRHJhZnRzKHsgc2NyaXB0RHJhZnRJZHM6IGluc2VydERhdGEubWFwKHUgPT4gdS5zY3JpcHREcmFmdElkISksIH0pO1xuICAgICAgICAgICAgcmVzdWx0cy5pbnNlcnRlZCA9IGluc2VydGVkLmRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0cy5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgLy8gaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsIHsgYWN0aW9uOiAnY3JlYXRlX3NjcmlwdHNfZHJhZnRzJywgZGF0YTogaW5zZXJ0RGF0YS5tYXAodSA9PiB1LnNjcmlwdERyYWZ0SWQpLCB9KTtcbiAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICdjcmVhdGVfc2NyaXB0c19kcmFmdHMnKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF91cGRhdGVTY3JpcHRzRHJhZnRzKFxuICAgIGRhdGE6ICh7XG4gICAgICAgIHNjcmlwdERyYWZ0SWQ6IHN0cmluZztcbiAgICAgICAgZGF0YTogUGFydGlhbDx0eXBlb2Ygc2NyaXB0c0RyYWZ0cy4kaW5mZXJTZWxlY3Q+WydkYXRhJ107XG4gICAgfSlbXSwgXG4gICAgb3B0cz86IHtcbiAgICAgICAgcmV0dXJuVXBkYXRlZD86IGJvb2xlYW47XG4gICAgICAgIGJyb2FkY2FzdEFjdGlvbj86IGJvb2xlYW47XG4gICAgfVxuKSB7XG4gICAgY29uc3QgcmVzdWx0czogKHsgXG4gICAgICAgIHNjcmlwdERyYWZ0SWQ6IHN0cmluZztcbiAgICAgICAgc2NyaXB0RHJhZnQ/OiBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9nZXRTY3JpcHREcmFmdD4+O1xuICAgICAgICBlcnJvcj86IHN0cmluZzsgXG4gICAgfSlbXSA9IFtdO1xuXG4gICAgZm9yKGNvbnN0IHsgc2NyaXB0RHJhZnRJZCwgZGF0YTogZHJhZnQsICB9IG9mIGRhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgZGIucXVlcnkuc2NyaXB0c0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiBlcShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdERyYWZ0SWQpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBkcmFmdERhdGEgPSB7IC4uLmV4aXN0aW5nPy5kYXRhLCAuLi5kcmFmdCwgfSBhcyB0eXBlb2YgZHJhZnQ7XG4gICAgICAgICAgICBhd2FpdCBkYi51cGRhdGUoc2NyaXB0c0RyYWZ0cykuc2V0KHsgZGF0YTogZHJhZnREYXRhLCB9KS53aGVyZShlcShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdERyYWZ0SWQpKTtcbiAgICAgICAgICAgIGNvbnN0IHNjcmlwdERyYWZ0ID0gIW9wdHM/LnJldHVyblVwZGF0ZWQgPyB1bmRlZmluZWQgOiBhd2FpdCBfZ2V0U2NyaXB0RHJhZnQoc2NyaXB0RHJhZnRJZCk7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goeyBzY3JpcHREcmFmdElkLCBzY3JpcHREcmFmdCwgfSk7XG4gICAgICAgICAgICAvLyBpZiAob3B0cz8uYnJvYWRjYXN0QWN0aW9uKSBzb2NrZXQuZW1pdCgnZGF0YV9jaGFuZ2VkJywgeyBhY3Rpb246ICd1cGRhdGVfc2NyaXB0c19kcmFmdHMnLCBkYXRhOiBkYXRhLm1hcCh1ID0+IHUuc2NyaXB0RHJhZnRJZCksIH0pO1xuICAgICAgICAgICAgaWYgKG9wdHM/LmJyb2FkY2FzdEFjdGlvbikgc29ja2V0LmVtaXQoJ2RhdGFfY2hhbmdlZCcsICd1cGRhdGVfc2NyaXB0c19kcmFmdHMnKTtcbiAgICAgICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IHNjcmlwdERyYWZ0SWQsIGVycm9yOiBlLm1lc3NhZ2UsIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG4iXSwibmFtZXMiOlsiZXEiLCJpbkFycmF5IiwidjQiLCJzb2NrZXQiLCJkYiIsInNjcmlwdHNEcmFmdHMiLCJzY3JlZW5zSGlzdG9yeSIsIl9nZXRTY3JpcHREcmFmdCIsIl9nZXRTY3JpcHRzRHJhZnRzIiwiX2xpc3RTY3JpcHRzIiwiX3Jlc3RvcmVTY3JlZW5zIiwiX2RlbGV0ZVNjcmlwdHNEcmFmdHMiLCJzY3JpcHRzRHJhZnRzSWRzIiwib3B0cyIsImxlbmd0aCIsImRlbGV0ZSIsIndoZXJlIiwic2NyaXB0RHJhZnRJZCIsImJyb2FkY2FzdEFjdGlvbiIsImVtaXQiLCJyZXN0b3JlS2V5cyIsIm1hcCIsImlkIiwidXBkYXRlIiwic2V0IiwicmVzdG9yZUtleSIsInNJZCIsIl9kZWxldGVBbGxTY3JpcHRzRHJhZnRzIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsImNvbHVtbnMiLCJzY3JpcHRJZCIsInJlcyIsImQiLCJzIiwiX2NyZWF0ZVNjcmlwdHNEcmFmdHMiLCJkYXRhIiwicmVzdWx0cyIsImluc2VydGVkIiwic3VjY2VzcyIsImluc2VydERhdGEiLCJzY3JpcHRzTGlzdCIsImxhc3RQb3NpdGlvbiIsIk1hdGgiLCJtYXgiLCJwb3NpdGlvbiIsImMiLCJleGlzdGluZyIsImZpbmRGaXJzdCIsInB1c2giLCJpbnNlcnQiLCJ2YWx1ZXMiLCJyZXR1cm5JbnNlcnRlZCIsInNjcmlwdERyYWZ0SWRzIiwidSIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfdXBkYXRlU2NyaXB0c0RyYWZ0cyIsImRyYWZ0IiwiZHJhZnREYXRhIiwic2NyaXB0RHJhZnQiLCJyZXR1cm5VcGRhdGVkIiwidW5kZWZpbmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/mutations/scripts-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/pg/drizzle.ts":
/*!*********************************!*\
  !*** ./databases/pg/drizzle.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dbInit: () => (/* binding */ dbInit),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm_postgres_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm/postgres-js */ \"(rsc)/./node_modules/drizzle-orm/postgres-js/driver.js\");\n/* harmony import */ var postgres__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! postgres */ \"(rsc)/./node_modules/postgres/src/index.js\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\nconst isProd = \"development\" === \"production\";\nfunction dbInit() {\n    const client = (0,postgres__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(process.env.POSTGRES_DB_URL);\n    const db = (0,drizzle_orm_postgres_js__WEBPACK_IMPORTED_MODULE_2__.drizzle)(client, {\n        schema: _schema__WEBPACK_IMPORTED_MODULE_1__,\n        logger: !isProd\n    });\n    return db;\n}\nconst db = globalThis.drizzle || dbInit();\nif (true) globalThis.drizzle = db;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (db);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcGcvZHJpenpsZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUF5RjtBQUN6RDtBQUVHO0FBTW5DLE1BQU1JLFNBQVNDLGtCQUF5QjtBQUVqQyxTQUFTQztJQUNaLE1BQU1DLFNBQVNMLG9EQUFRQSxDQUFDRyxRQUFRRyxHQUFHLENBQUNDLGVBQWU7SUFDbkQsTUFBTUMsS0FBS1QsZ0VBQWVBLENBQUNNLFFBQVE7UUFDL0JKLE1BQU1BLHNDQUFBQTtRQUNOUSxRQUFRLENBQUNQO0lBQ2I7SUFDQSxPQUFPTTtBQUNYO0FBRUEsTUFBTUEsS0FBS0UsV0FBV1osT0FBTyxJQUFJTTtBQUVqQyxJQUFJRCxJQUF5QixFQUFjTyxXQUFXWixPQUFPLEdBQUdVO0FBRWhFLGlFQUFlQSxFQUFFQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcGcvZHJpenpsZS50cz9hYmI2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRyaXp6bGUgYXMgcG9zdGdyZXNEcml6emxlLCBQb3N0Z3Jlc0pzRGF0YWJhc2UgfSBmcm9tICdkcml6emxlLW9ybS9wb3N0Z3Jlcy1qcyc7XG5pbXBvcnQgcG9zdGdyZXMgZnJvbSAncG9zdGdyZXMnO1xuXG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnLi9zY2hlbWEnO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gICAgdmFyIGRyaXp6bGU6IFJldHVyblR5cGU8dHlwZW9mIGRiSW5pdD4gfCB1bmRlZmluZWQ7XG59XG5cbmNvbnN0IGlzUHJvZCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbic7XG5cbmV4cG9ydCBmdW5jdGlvbiBkYkluaXQoKSB7XG4gICAgY29uc3QgY2xpZW50ID0gcG9zdGdyZXMocHJvY2Vzcy5lbnYuUE9TVEdSRVNfREJfVVJMISk7XG4gICAgY29uc3QgZGIgPSBwb3N0Z3Jlc0RyaXp6bGUoY2xpZW50LCB7IFxuICAgICAgICBzY2hlbWEsIFxuICAgICAgICBsb2dnZXI6ICFpc1Byb2QsIFxuICAgIH0pO1xuICAgIHJldHVybiBkYjtcbn1cblxuY29uc3QgZGIgPSBnbG9iYWxUaGlzLmRyaXp6bGUgfHwgZGJJbml0KCk7XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxUaGlzLmRyaXp6bGUgPSBkYjtcblxuZXhwb3J0IGRlZmF1bHQgZGI7XG4iXSwibmFtZXMiOlsiZHJpenpsZSIsInBvc3RncmVzRHJpenpsZSIsInBvc3RncmVzIiwic2NoZW1hIiwiaXNQcm9kIiwicHJvY2VzcyIsImRiSW5pdCIsImNsaWVudCIsImVudiIsIlBPU1RHUkVTX0RCX1VSTCIsImRiIiwibG9nZ2VyIiwiZ2xvYmFsVGhpcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/pg/drizzle.ts\n");

/***/ }),

/***/ "(rsc)/./databases/pg/schema/_utils.ts":
/*!***************************************!*\
  !*** ./databases/pg/schema/_utils.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   bytea: () => (/* binding */ bytea),\n/* harmony export */   mailerServiceEnum: () => (/* binding */ mailerServiceEnum),\n/* harmony export */   roleNameEnum: () => (/* binding */ roleNameEnum),\n/* harmony export */   screenTypeEnum: () => (/* binding */ screenTypeEnum),\n/* harmony export */   scriptTypeEnum: () => (/* binding */ scriptTypeEnum),\n/* harmony export */   siteEnvEnum: () => (/* binding */ siteEnvEnum),\n/* harmony export */   siteTypeEnum: () => (/* binding */ siteTypeEnum)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/custom.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/enum.js\");\n\nconst bytea = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_0__.customType)({\n    dataType () {\n        return \"bytea\";\n    }\n});\n// MAILER SETTINGS ENUM\nconst mailerServiceEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"mailer_service\", [\n    \"gmail\",\n    \"smtp\"\n]);\n// ROLES\nconst roleNameEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"role_name\", [\n    \"user\",\n    \"admin\",\n    \"super_user\"\n]);\n// SITES\nconst siteTypeEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"site_type\", [\n    \"nodeapi\",\n    \"webeditor\"\n]);\nconst siteEnvEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"site_env\", [\n    \"production\",\n    \"stage\",\n    \"development\",\n    \"demo\"\n]);\n// SCRIPT TYPES ENUM\nconst scriptTypeEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"script_type\", [\n    \"admission\",\n    \"discharge\",\n    \"neolab\"\n]);\n// SCREEN TYPES ENUM\nconst screenTypeEnum = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_1__.pgEnum)(\"screen_type\", [\n    \"diagnosis\",\n    \"checklist\",\n    \"form\",\n    \"management\",\n    \"multi_select\",\n    \"single_select\",\n    \"progress\",\n    \"timer\",\n    \"yesno\",\n    \"zw_edliz_summary_table\",\n    \"mwi_edliz_summary_table\",\n    \"edliz_summary_table\"\n]);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcGcvc2NoZW1hL191dGlscy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBeUQ7QUFFbEQsTUFBTUUsUUFBUUYsK0RBQVVBLENBQW1EO0lBQzlFRztRQUNJLE9BQU87SUFDWDtBQUNKLEdBQUc7QUFFSCx1QkFBdUI7QUFDaEIsTUFBTUMsb0JBQW9CSCwyREFBTUEsQ0FBQyxrQkFBa0I7SUFBQztJQUFTO0NBQU8sRUFBRTtBQUU3RSxRQUFRO0FBQ0QsTUFBTUksZUFBZUosMkRBQU1BLENBQUMsYUFBYTtJQUFDO0lBQVE7SUFBUztDQUFhLEVBQUU7QUFFakYsUUFBUTtBQUNELE1BQU1LLGVBQWVMLDJEQUFNQSxDQUFDLGFBQWE7SUFBQztJQUFXO0NBQVksRUFBRTtBQUNuRSxNQUFNTSxjQUFjTiwyREFBTUEsQ0FBQyxZQUFZO0lBQUM7SUFBYztJQUFTO0lBQWU7Q0FBTyxFQUFFO0FBRTlGLG9CQUFvQjtBQUNiLE1BQU1PLGlCQUFpQlAsMkRBQU1BLENBQUMsZUFBZTtJQUFDO0lBQWE7SUFBYTtDQUFTLEVBQUU7QUFFMUYsb0JBQW9CO0FBQ2IsTUFBTVEsaUJBQWlCUiwyREFBTUEsQ0FBQyxlQUFlO0lBQ2hEO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtDQUNILEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9wZy9zY2hlbWEvX3V0aWxzLnRzPzA0NjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3VzdG9tVHlwZSwgcGdFbnVtIH0gZnJvbSBcImRyaXp6bGUtb3JtL3BnLWNvcmVcIjtcblxuZXhwb3J0IGNvbnN0IGJ5dGVhID0gY3VzdG9tVHlwZTx7IGRhdGE6IEJ1ZmZlcjsgbm90TnVsbDogZmFsc2U7IGRlZmF1bHQ6IGZhbHNlIH0+KHtcbiAgICBkYXRhVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiYnl0ZWFcIjtcbiAgICB9LFxufSk7XG5cbi8vIE1BSUxFUiBTRVRUSU5HUyBFTlVNXG5leHBvcnQgY29uc3QgbWFpbGVyU2VydmljZUVudW0gPSBwZ0VudW0oJ21haWxlcl9zZXJ2aWNlJywgWydnbWFpbCcsICdzbXRwJ10pO1xuXG4vLyBST0xFU1xuZXhwb3J0IGNvbnN0IHJvbGVOYW1lRW51bSA9IHBnRW51bSgncm9sZV9uYW1lJywgWyd1c2VyJywgJ2FkbWluJywgJ3N1cGVyX3VzZXInXSk7XG5cbi8vIFNJVEVTXG5leHBvcnQgY29uc3Qgc2l0ZVR5cGVFbnVtID0gcGdFbnVtKCdzaXRlX3R5cGUnLCBbJ25vZGVhcGknLCAnd2ViZWRpdG9yJ10pO1xuZXhwb3J0IGNvbnN0IHNpdGVFbnZFbnVtID0gcGdFbnVtKCdzaXRlX2VudicsIFsncHJvZHVjdGlvbicsICdzdGFnZScsICdkZXZlbG9wbWVudCcsICdkZW1vJ10pO1xuXG4vLyBTQ1JJUFQgVFlQRVMgRU5VTVxuZXhwb3J0IGNvbnN0IHNjcmlwdFR5cGVFbnVtID0gcGdFbnVtKCdzY3JpcHRfdHlwZScsIFsnYWRtaXNzaW9uJywgJ2Rpc2NoYXJnZScsICduZW9sYWInXSk7XG5cbi8vIFNDUkVFTiBUWVBFUyBFTlVNXG5leHBvcnQgY29uc3Qgc2NyZWVuVHlwZUVudW0gPSBwZ0VudW0oJ3NjcmVlbl90eXBlJywgW1xuICAgICdkaWFnbm9zaXMnLFxuICAgICdjaGVja2xpc3QnLFxuICAgICdmb3JtJyxcbiAgICAnbWFuYWdlbWVudCcsXG4gICAgJ211bHRpX3NlbGVjdCcsXG4gICAgJ3NpbmdsZV9zZWxlY3QnLFxuICAgICdwcm9ncmVzcycsXG4gICAgJ3RpbWVyJyxcbiAgICAneWVzbm8nLFxuICAgICd6d19lZGxpel9zdW1tYXJ5X3RhYmxlJyxcbiAgICAnbXdpX2VkbGl6X3N1bW1hcnlfdGFibGUnLFxuICAgICdlZGxpel9zdW1tYXJ5X3RhYmxlJyxcbl0pO1xuIl0sIm5hbWVzIjpbImN1c3RvbVR5cGUiLCJwZ0VudW0iLCJieXRlYSIsImRhdGFUeXBlIiwibWFpbGVyU2VydmljZUVudW0iLCJyb2xlTmFtZUVudW0iLCJzaXRlVHlwZUVudW0iLCJzaXRlRW52RW51bSIsInNjcmlwdFR5cGVFbnVtIiwic2NyZWVuVHlwZUVudW0iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/pg/schema/_utils.ts\n");

/***/ }),

/***/ "(rsc)/./databases/pg/schema/index.ts":
/*!**************************************!*\
  !*** ./databases/pg/schema/index.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   apiKeys: () => (/* binding */ apiKeys),\n/* harmony export */   authClients: () => (/* binding */ authClients),\n/* harmony export */   authClientsRelations: () => (/* binding */ authClientsRelations),\n/* harmony export */   bytea: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.bytea),\n/* harmony export */   configKeys: () => (/* binding */ configKeys),\n/* harmony export */   configKeysDrafts: () => (/* binding */ configKeysDrafts),\n/* harmony export */   configKeysDraftsRelations: () => (/* binding */ configKeysDraftsRelations),\n/* harmony export */   configKeysHistory: () => (/* binding */ configKeysHistory),\n/* harmony export */   configKeysHistoryRelations: () => (/* binding */ configKeysHistoryRelations),\n/* harmony export */   configKeysRelations: () => (/* binding */ configKeysRelations),\n/* harmony export */   devices: () => (/* binding */ devices),\n/* harmony export */   diagnoses: () => (/* binding */ diagnoses),\n/* harmony export */   diagnosesDrafts: () => (/* binding */ diagnosesDrafts),\n/* harmony export */   diagnosesDraftsRelations: () => (/* binding */ diagnosesDraftsRelations),\n/* harmony export */   diagnosesHistory: () => (/* binding */ diagnosesHistory),\n/* harmony export */   diagnosesHistoryRelations: () => (/* binding */ diagnosesHistoryRelations),\n/* harmony export */   diagnosesRelations: () => (/* binding */ diagnosesRelations),\n/* harmony export */   editorInfo: () => (/* binding */ editorInfo),\n/* harmony export */   emailTemplates: () => (/* binding */ emailTemplates),\n/* harmony export */   files: () => (/* binding */ files),\n/* harmony export */   filesChunks: () => (/* binding */ filesChunks),\n/* harmony export */   filesRelations: () => (/* binding */ filesRelations),\n/* harmony export */   hospitals: () => (/* binding */ hospitals),\n/* harmony export */   languages: () => (/* binding */ languages),\n/* harmony export */   mailerServiceEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.mailerServiceEnum),\n/* harmony export */   mailerSettings: () => (/* binding */ mailerSettings),\n/* harmony export */   pendingDeletion: () => (/* binding */ pendingDeletion),\n/* harmony export */   pendingDeletionRelations: () => (/* binding */ pendingDeletionRelations),\n/* harmony export */   roleNameEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.roleNameEnum),\n/* harmony export */   rolesRelations: () => (/* binding */ rolesRelations),\n/* harmony export */   screenTypeEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.screenTypeEnum),\n/* harmony export */   screens: () => (/* binding */ screens),\n/* harmony export */   screensDrafts: () => (/* binding */ screensDrafts),\n/* harmony export */   screensDraftsRelations: () => (/* binding */ screensDraftsRelations),\n/* harmony export */   screensHistory: () => (/* binding */ screensHistory),\n/* harmony export */   screensHistoryRelations: () => (/* binding */ screensHistoryRelations),\n/* harmony export */   screensRelations: () => (/* binding */ screensRelations),\n/* harmony export */   scriptTypeEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.scriptTypeEnum),\n/* harmony export */   scripts: () => (/* binding */ scripts),\n/* harmony export */   scriptsDrafts: () => (/* binding */ scriptsDrafts),\n/* harmony export */   scriptsDraftsRelations: () => (/* binding */ scriptsDraftsRelations),\n/* harmony export */   scriptsHistory: () => (/* binding */ scriptsHistory),\n/* harmony export */   scriptsHistoryRelations: () => (/* binding */ scriptsHistoryRelations),\n/* harmony export */   scriptsRelations: () => (/* binding */ scriptsRelations),\n/* harmony export */   siteEnvEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.siteEnvEnum),\n/* harmony export */   siteTypeEnum: () => (/* reexport safe */ _utils__WEBPACK_IMPORTED_MODULE_0__.siteTypeEnum),\n/* harmony export */   sites: () => (/* binding */ sites),\n/* harmony export */   sys: () => (/* binding */ sys),\n/* harmony export */   tokens: () => (/* binding */ tokens),\n/* harmony export */   tokensRelations: () => (/* binding */ tokensRelations),\n/* harmony export */   userRoles: () => (/* binding */ userRoles),\n/* harmony export */   users: () => (/* binding */ users),\n/* harmony export */   usersRelations: () => (/* binding */ usersRelations)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/relations.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/table.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/serial.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/uuid.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/text.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/integer.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/boolean.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/jsonb.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/columns/timestamp.js\");\n/* harmony import */ var drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! drizzle-orm/pg-core */ \"(rsc)/./node_modules/drizzle-orm/pg-core/indexes.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./_utils */ \"(rsc)/./databases/pg/schema/_utils.ts\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/constants */ \"(rsc)/./constants/index.ts\");\n\n\n\n\n\n\n// MAILER SETTINGS\nconst mailerSettings = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_mailer_settings\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    settingId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"setting_id\").notNull().unique().defaultRandom(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().unique(),\n    service: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.mailerServiceEnum)(\"service\").notNull(),\n    authUsername: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"auth_username\").notNull(),\n    authPassword: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"auth_password\").notNull(),\n    authType: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"auth_type\"),\n    authMethod: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"auth_method\"),\n    host: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"host\").notNull().default(\"\"),\n    port: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"port\"),\n    encryption: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"encryption\").notNull().default(\"\"),\n    fromAddress: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"from_address\").notNull().default(\"\"),\n    fromName: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"from_name\").notNull().default(\"\"),\n    isActive: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"is_active\").default(false).notNull(),\n    secure: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"secure\").default(false).notNull()\n});\n// EMAIL TEMPLATES\nconst emailTemplates = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_email_templates\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    templateId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"template_id\").notNull().unique().defaultRandom(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().unique(),\n    data: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").notNull()\n});\n// SYS\nconst sys = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_sys\", {\n    _id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"_id\").primaryKey(),\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"id\").notNull().unique().defaultRandom(),\n    key: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"key\").notNull().unique(),\n    value: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"value\").notNull()\n});\n// TOKENS\nconst tokens = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_tokens\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    token: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"token\").notNull().unique(),\n    userId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"user_id\").references(()=>users.userId, {\n        onDelete: \"cascade\"\n    }),\n    validUntil: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"valid_until\").notNull()\n});\nconst tokensRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(tokens, ({ one })=>({\n        user: one(users, {\n            fields: [\n                tokens.userId\n            ],\n            references: [\n                users.userId\n            ]\n        })\n    }));\nconst userRoles = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_user_roles\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    name: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.roleNameEnum)(\"name\").notNull().unique(),\n    description: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"description\")\n});\nconst rolesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(userRoles, ({ many })=>({\n        users: many(users)\n    }));\n// LANGUAGES\nconst languages = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_languages\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().unique(),\n    iso: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"iso\").notNull().unique(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n});\n// USERS\nconst users = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_users\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    userId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"user_id\").notNull().unique().defaultRandom(),\n    role: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.roleNameEnum)(\"role\").references(()=>userRoles.name, {\n        onDelete: \"cascade\"\n    }).default(\"user\").notNull(),\n    email: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"email\").notNull().unique(),\n    password: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"password\").notNull(),\n    displayName: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"display_name\").notNull(),\n    firstName: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"first_name\"),\n    lastName: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"last_name\"),\n    avatar: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"avatar\"),\n    avatar_sm: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"avatar_sm\"),\n    avatar_md: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"avatar_md\"),\n    activationDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"activation_date\"),\n    lastLoginDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"last_login_date\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"users_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.email}) ||\n                    to_tsvector('english', ${table.displayName}) ||\n                    to_tsvector('english', ${table.firstName}) ||\n                    to_tsvector('english', ${table.lastName})\n                )`)\n    }));\nconst usersRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(users, ({ many, one })=>({\n        authTokens: many(authClients),\n        tokens: many(tokens),\n        files: many(files),\n        role: one(userRoles, {\n            fields: [\n                users.role\n            ],\n            references: [\n                userRoles.name\n            ]\n        })\n    }));\n// AUTH CLIENTS\nconst authClients = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_auth_clients\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    clientId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"client_id\").notNull().unique().defaultRandom(),\n    clientToken: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"client_token\").notNull().unique(),\n    userId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"user_id\").references(()=>users.userId, {\n        onDelete: \"cascade\"\n    }),\n    validUntil: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"valid_until\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst authClientsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(authClients, ({ one })=>({\n        user: one(users, {\n            fields: [\n                authClients.userId\n            ],\n            references: [\n                users.userId\n            ]\n        })\n    }));\n// API KEYS\nconst apiKeys = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_api_keys\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    apiKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"api_key_id\").notNull().unique().defaultRandom(),\n    apiKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"api_key\").notNull().unique().$defaultFn(()=>(0,uuid__WEBPACK_IMPORTED_MODULE_13__[\"default\"])()),\n    validUntil: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"valid_until\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst sites = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_sites\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    siteId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"site_id\").notNull().unique().defaultRandom(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().unique(),\n    link: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"link\").notNull().unique(),\n    apiKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"api_key\").notNull(),\n    type: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.siteTypeEnum)(\"type\").notNull(),\n    env: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.siteEnvEnum)(\"env\").notNull().default(\"production\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n});\n// HOSPITALS\nconst hospitals = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_hospitals\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    hospitalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"hospital_id\").notNull().unique().defaultRandom(),\n    oldHospitalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_hospital_id\").unique(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().unique(),\n    country: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"country\").default(\"\"),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"hospitals_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.name})\n                )`)\n    }));\n// DEVICES\nconst editorInfo = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_editor_info\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    dataVersion: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"data_version\").notNull().default(1),\n    lastPublishDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"last_publish_date\")\n});\n// DEVICES\nconst devices = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_devices\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    deviceId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"device_id\").notNull().unique(),\n    deviceHash: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"device_hash\").notNull().unique(),\n    details: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"details\").default({}),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n});\n// FILES\nconst files = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_files\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    fileId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"file_id\").notNull().unique().defaultRandom(),\n    ownerId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"owner_id\").references(()=>users.userId, {\n        onDelete: \"cascade\"\n    }),\n    filename: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"filename\").notNull(),\n    contentType: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"content_type\").notNull(),\n    size: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"size\").notNull(),\n    metadata: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"metadata\").default(\"{}\").notNull(),\n    data: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.bytea)(\"data\").notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n});\nconst filesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(files, ({ many, one })=>({\n        owner: one(users, {\n            fields: [\n                files.ownerId\n            ],\n            references: [\n                users.userId\n            ]\n        })\n    }));\nconst filesChunks = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_files_chunks\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    chunkId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"chunk_id\").notNull().unique().defaultRandom(),\n    fileId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"file_id\").references(()=>files.fileId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    data: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.bytea)(\"data\").notNull()\n});\n// CONFIG KEYS\nconst configKeys = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_config_keys\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    configKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_id\").notNull().unique().defaultRandom(),\n    oldConfigKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_config_key_id\").unique(),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    key: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"key\").notNull().unique(),\n    label: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"label\").notNull().unique(),\n    summary: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"summary\").notNull(),\n    source: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"source\").default(\"editor\"),\n    preferences: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"preferences\").default(JSON.stringify(_constants__WEBPACK_IMPORTED_MODULE_1__.defaultPreferences)).notNull(),\n    publishDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"publish_date\").defaultNow().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"config_keys_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.key}) ||\n                    to_tsvector('english', ${table.label}) ||\n                    to_tsvector('english', ${table.summary})\n                )`)\n    }));\nconst configKeysRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(configKeys, ({ many, one })=>({\n        history: many(configKeysHistory),\n        draft: one(configKeysDrafts, {\n            fields: [\n                configKeys.configKeyId\n            ],\n            references: [\n                configKeysDrafts.configKeyId\n            ]\n        })\n    }));\n// CONFIG KEYS DRAFTS\nconst configKeysDrafts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_config_keys_drafts\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    configKeyDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_draft_id\").notNull().unique().defaultRandom(),\n    configKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_id\").references(()=>configKeys.configKeyId, {\n        onDelete: \"cascade\"\n    }),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    data: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").$type().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date())\n});\nconst configKeysDraftsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(configKeysDrafts, ({ one })=>({\n        configKey: one(configKeys, {\n            fields: [\n                configKeysDrafts.configKeyId\n            ],\n            references: [\n                configKeys.configKeyId\n            ]\n        })\n    }));\n// CONFIG KEYS HISTORY\nconst configKeysHistory = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_config_keys_history\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    configKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_id\").references(()=>configKeys.configKeyId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    restoreKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"restore_key\"),\n    changes: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").default([]),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst configKeysHistoryRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(configKeysHistory, ({ one })=>({\n        configKey: one(configKeys, {\n            fields: [\n                configKeysHistory.configKeyId\n            ],\n            references: [\n                configKeys.configKeyId\n            ]\n        })\n    }));\n// SCRIPTS\nconst scripts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_scripts\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").notNull().unique().defaultRandom(),\n    oldScriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_script_id\").unique(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    type: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.scriptTypeEnum)(\"type\").notNull().default(\"admission\"),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    source: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"source\").default(\"editor\"),\n    title: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title\").notNull(),\n    printTitle: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"print_title\").notNull(),\n    description: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"description\").notNull().default(\"\"),\n    hospitalId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"hospital_id\").references(()=>hospitals.hospitalId, {\n        onDelete: \"cascade\"\n    }),\n    exportable: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"exportable\").notNull().default(true),\n    nuidSearchEnabled: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"nuid_search_enabled\").notNull().default(false),\n    nuidSearchFields: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"nuid_search_fields\").default(\"[]\").notNull(),\n    preferences: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"preferences\").default(JSON.stringify(_constants__WEBPACK_IMPORTED_MODULE_1__.defaultPreferences)).notNull(),\n    publishDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"publish_date\").defaultNow().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"scripts_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.title}) ||\n                    to_tsvector('english', ${table.description})\n                )`)\n    }));\nconst scriptsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(scripts, ({ many, one })=>({\n        screens: many(screens),\n        screensDrafts: many(screensDrafts),\n        screensHistory: many(screensHistory),\n        diagnoses: many(diagnoses),\n        diagnosesDrafts: many(diagnosesDrafts),\n        diagnosesHistory: many(diagnosesHistory),\n        history: many(scriptsHistory),\n        draft: one(scriptsDrafts, {\n            fields: [\n                scripts.scriptId\n            ],\n            references: [\n                scriptsDrafts.scriptId\n            ]\n        })\n    }));\n// SCRIPTS DRAFTS\nconst scriptsDrafts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_scripts_drafts\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    scriptDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_draft_id\").notNull().unique().defaultRandom(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    data: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").$type().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date())\n});\nconst scriptsDraftsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(scriptsDrafts, ({ one, many })=>({\n        screensDrafts: many(screensDrafts),\n        diagnosesDrafts: many(diagnosesDrafts),\n        script: one(scripts, {\n            fields: [\n                scriptsDrafts.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// SCRIPTS HISTORY\nconst scriptsHistory = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_scripts_history\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    restoreKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"restore_key\"),\n    changes: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").default([]),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst scriptsHistoryRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(scriptsHistory, ({ one })=>({\n        script: one(scripts, {\n            fields: [\n                scriptsHistory.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// SCREENS\nconst screens = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_screens\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    screenId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_id\").notNull().unique().defaultRandom(),\n    oldScreenId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_screen_id\").unique(),\n    oldScriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_script_id\"),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    type: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.screenTypeEnum)(\"type\").notNull(),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    source: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"source\").default(\"editor\"),\n    sectionTitle: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"section_title\").notNull(),\n    previewTitle: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"preview_title\").notNull().default(\"\"),\n    previewPrintTitle: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"preview_print_title\").notNull().default(\"\"),\n    condition: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"condition\").notNull().default(\"\"),\n    epicId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"epic_id\").notNull().default(\"\"),\n    storyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"story_id\").notNull().default(\"\"),\n    refId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"ref_id\").notNull().default(\"\"),\n    refKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"ref_key\").notNull().default(\"\"),\n    step: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"step\").notNull().default(\"\"),\n    actionText: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"action_text\").notNull().default(\"\"),\n    contentText: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"content_text\").notNull().default(\"\"),\n    infoText: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"info_text\").notNull().default(\"\"),\n    title: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title\").notNull(),\n    title1: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title1\").notNull().default(\"\"),\n    title2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title2\").notNull().default(\"\"),\n    title3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title3\").notNull().default(\"\"),\n    title4: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"title4\").notNull().default(\"\"),\n    text1: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text1\").notNull().default(\"\"),\n    text2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text2\").notNull().default(\"\"),\n    text3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text3\").notNull().default(\"\"),\n    image1: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image1\"),\n    image2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image2\"),\n    image3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image3\"),\n    instructions: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"instructions\").notNull().default(\"\"),\n    instructions2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"instructions2\").notNull().default(\"\"),\n    instructions3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"instructions3\").notNull().default(\"\"),\n    instructions4: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"instructions4\").notNull().default(\"\"),\n    hcwDiagnosesInstructions: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"hcw_diagnoses_instructions\").notNull().default(\"\"),\n    suggestedDiagnosesInstructions: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"suggested_diagnoses_instructions\").notNull().default(\"\"),\n    notes: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"notes\").notNull().default(\"\"),\n    dataType: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"data_type\").notNull().default(\"\"),\n    key: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"key\").notNull().default(\"\"),\n    label: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"label\").notNull().default(\"\"),\n    negativeLabel: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"negative_label\").notNull().default(\"\"),\n    positiveLabel: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"positive_label\").notNull().default(\"\"),\n    timerValue: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"timer_value\"),\n    multiplier: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"multiplier\"),\n    minValue: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"min_value\"),\n    maxValue: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"max_value\"),\n    exportable: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"exportable\").notNull().default(true),\n    printable: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"printable\"),\n    skippable: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"skippable\").notNull().default(false),\n    confidential: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_7__.boolean)(\"confidential\").notNull().default(false),\n    prePopulate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"pre_populate\").default(\"[]\").notNull(),\n    fields: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"fields\").default(\"[]\").notNull(),\n    items: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"items\").default(\"[]\").notNull(),\n    preferences: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"preferences\").default(JSON.stringify(_constants__WEBPACK_IMPORTED_MODULE_1__.defaultPreferences)).notNull(),\n    publishDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"publish_date\").defaultNow().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"screens_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.title})\n                )`)\n    }));\nconst screensRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(screens, ({ many, one })=>({\n        history: many(screensHistory),\n        script: one(scripts, {\n            fields: [\n                screens.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        }),\n        draft: one(screensDrafts, {\n            fields: [\n                screens.screenId\n            ],\n            references: [\n                screensDrafts.screenId\n            ]\n        })\n    }));\n// SCREENS DRAFTS\nconst screensDrafts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_screens_drafts\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    screenDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_draft_id\").notNull().unique().defaultRandom(),\n    screenId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_id\").references(()=>screens.screenId, {\n        onDelete: \"cascade\"\n    }),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    scriptDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_draft_id\").references(()=>scriptsDrafts.scriptDraftId, {\n        onDelete: \"cascade\"\n    }),\n    type: (0,_utils__WEBPACK_IMPORTED_MODULE_0__.screenTypeEnum)(\"type\").notNull(),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    data: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").$type().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date())\n});\nconst screensDraftsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(screensDrafts, ({ one })=>({\n        screen: one(screens, {\n            fields: [\n                screensDrafts.screenId\n            ],\n            references: [\n                screens.screenId\n            ]\n        }),\n        scriptDraft: one(scriptsDrafts, {\n            fields: [\n                screensDrafts.scriptDraftId\n            ],\n            references: [\n                scriptsDrafts.scriptDraftId\n            ]\n        }),\n        script: one(scripts, {\n            fields: [\n                screensDrafts.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// SCREENS HISTORY\nconst screensHistory = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_screens_history\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    screenId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_id\").references(()=>screens.screenId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    restoreKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"restore_key\"),\n    changes: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").default([]),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst screensHistoryRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(screensHistory, ({ one })=>({\n        screen: one(screens, {\n            fields: [\n                screensHistory.screenId\n            ],\n            references: [\n                screens.screenId\n            ]\n        }),\n        script: one(scripts, {\n            fields: [\n                screensHistory.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// DIAGNOSES\nconst diagnoses = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_diagnoses\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    diagnosisId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_id\").notNull().unique().defaultRandom(),\n    oldDiagnosisId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_diagnosis_id\").unique(),\n    oldScriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"old_script_id\"),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    source: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"source\").default(\"editor\"),\n    expression: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"expression\").notNull(),\n    name: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"name\").notNull().default(\"\"),\n    description: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"description\").notNull().default(\"\"),\n    key: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"key\").default(\"\"),\n    severityOrder: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"severity_order\"),\n    expressionMeaning: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"expression_meaning\").notNull().default(\"\"),\n    symptoms: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"symptoms\").default(\"[]\").notNull(),\n    text1: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text1\").notNull().default(\"\"),\n    text2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text2\").notNull().default(\"\"),\n    text3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"text3\").notNull().default(\"\"),\n    image1: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image1\"),\n    image2: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image2\"),\n    image3: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"image3\"),\n    preferences: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"preferences\").default(JSON.stringify(_constants__WEBPACK_IMPORTED_MODULE_1__.defaultPreferences)).notNull(),\n    publishDate: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"publish_date\").defaultNow().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date()),\n    deletedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"deleted_at\")\n}, (table)=>({\n        searchIndex: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_11__.index)(\"diagnoses_search_index\").using(\"gin\", (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_12__.sql)`(\n                    to_tsvector('english', ${table.name})\n                )`)\n    }));\nconst diagnosesRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(diagnoses, ({ many, one })=>({\n        history: many(diagnosesHistory),\n        script: one(scripts, {\n            fields: [\n                diagnoses.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        }),\n        draft: one(diagnosesDrafts, {\n            fields: [\n                diagnoses.diagnosisId\n            ],\n            references: [\n                diagnosesDrafts.diagnosisId\n            ]\n        })\n    }));\n// DIAGNOSES DRAFTS\nconst diagnosesDrafts = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_diagnoses_drafts\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    diagnosisDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_draft_id\").notNull().unique().defaultRandom(),\n    diagnosisId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_id\").references(()=>diagnoses.diagnosisId, {\n        onDelete: \"cascade\"\n    }),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    scriptDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_draft_id\").references(()=>scriptsDrafts.scriptDraftId, {\n        onDelete: \"cascade\"\n    }),\n    position: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"position\").notNull(),\n    data: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").$type().notNull(),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull(),\n    updatedAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"updated_at\").defaultNow().notNull().$onUpdate(()=>new Date())\n});\nconst diagnosesDraftsRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(diagnosesDrafts, ({ one })=>({\n        diagnosis: one(diagnoses, {\n            fields: [\n                diagnosesDrafts.diagnosisId\n            ],\n            references: [\n                diagnoses.diagnosisId\n            ]\n        }),\n        scriptDraft: one(scriptsDrafts, {\n            fields: [\n                diagnosesDrafts.scriptDraftId\n            ],\n            references: [\n                scriptsDrafts.scriptDraftId\n            ]\n        }),\n        script: one(scripts, {\n            fields: [\n                diagnosesDrafts.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// DIAGNOSES HISTORY\nconst diagnosesHistory = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_diagnoses_history\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    version: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_6__.integer)(\"version\").notNull(),\n    diagnosisId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_id\").references(()=>diagnoses.diagnosisId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }).notNull(),\n    restoreKey: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_5__.text)(\"restore_key\"),\n    changes: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_8__.jsonb)(\"data\").default([]),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst diagnosesHistoryRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(diagnosesHistory, ({ one })=>({\n        diagnosis: one(diagnoses, {\n            fields: [\n                diagnosesHistory.diagnosisId\n            ],\n            references: [\n                diagnoses.diagnosisId\n            ]\n        }),\n        script: one(scripts, {\n            fields: [\n                diagnosesHistory.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        })\n    }));\n// PENDING DELETION\nconst pendingDeletion = (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_2__.pgTable)(\"nt_pending_deletion\", {\n    id: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_3__.serial)(\"id\").primaryKey(),\n    scriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    screenId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_id\").references(()=>screens.screenId, {\n        onDelete: \"cascade\"\n    }),\n    screenScriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    diagnosisId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_id\").references(()=>diagnoses.diagnosisId, {\n        onDelete: \"cascade\"\n    }),\n    diagnosisScriptId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_script_id\").references(()=>scripts.scriptId, {\n        onDelete: \"cascade\"\n    }),\n    configKeyId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_id\").references(()=>configKeys.configKeyId, {\n        onDelete: \"cascade\"\n    }),\n    scriptDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"script_draft_id\").references(()=>scriptsDrafts.scriptDraftId, {\n        onDelete: \"cascade\"\n    }),\n    screenDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"screen_draft_id\").references(()=>screensDrafts.screenDraftId, {\n        onDelete: \"cascade\"\n    }),\n    diagnosisDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"diagnosis_draft_id\").references(()=>diagnosesDrafts.diagnosisDraftId, {\n        onDelete: \"cascade\"\n    }),\n    configKeyDraftId: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_4__.uuid)(\"config_key_draft_id\").references(()=>configKeysDrafts.configKeyDraftId, {\n        onDelete: \"cascade\"\n    }),\n    createdAt: (0,drizzle_orm_pg_core__WEBPACK_IMPORTED_MODULE_9__.timestamp)(\"created_at\").defaultNow().notNull()\n});\nconst pendingDeletionRelations = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.relations)(pendingDeletion, ({ one })=>({\n        script: one(scripts, {\n            fields: [\n                pendingDeletion.scriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        }),\n        screen: one(screens, {\n            fields: [\n                pendingDeletion.screenId\n            ],\n            references: [\n                screens.screenId\n            ]\n        }),\n        screenScript: one(scripts, {\n            fields: [\n                pendingDeletion.screenScriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        }),\n        diagnosis: one(diagnoses, {\n            fields: [\n                pendingDeletion.diagnosisId\n            ],\n            references: [\n                diagnoses.diagnosisId\n            ]\n        }),\n        diagnosisScript: one(scripts, {\n            fields: [\n                pendingDeletion.diagnosisScriptId\n            ],\n            references: [\n                scripts.scriptId\n            ]\n        }),\n        configKey: one(configKeys, {\n            fields: [\n                pendingDeletion.configKeyId\n            ],\n            references: [\n                configKeys.configKeyId\n            ]\n        }),\n        scriptDraft: one(scriptsDrafts, {\n            fields: [\n                pendingDeletion.scriptId\n            ],\n            references: [\n                scriptsDrafts.scriptDraftId\n            ]\n        }),\n        screenDraft: one(screensDrafts, {\n            fields: [\n                pendingDeletion.screenId\n            ],\n            references: [\n                screensDrafts.screenDraftId\n            ]\n        }),\n        diagnosisDraft: one(diagnosesDrafts, {\n            fields: [\n                pendingDeletion.diagnosisId\n            ],\n            references: [\n                diagnosesDrafts.diagnosisDraftId\n            ]\n        }),\n        configKeyDraft: one(configKeysDrafts, {\n            fields: [\n                pendingDeletion.configKeyId\n            ],\n            references: [\n                configKeysDrafts.configKeyDraftId\n            ]\n        })\n    }));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcGcvc2NoZW1hL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNkM7QUFXaEI7QUFDTztBQVdsQjtBQUMrQjtBQUV4QjtBQUV6QixrQkFBa0I7QUFDWCxNQUFNcUIsaUJBQWlCZiw0REFBT0EsQ0FBQyxzQkFBc0I7SUFDeERnQixJQUFJZiwyREFBTUEsQ0FBQyxNQUFNZ0IsVUFBVTtJQUMzQkMsV0FBV2QseURBQUlBLENBQUMsY0FBY2UsT0FBTyxHQUFHQyxNQUFNLEdBQUdDLGFBQWE7SUFDOURDLE1BQU1wQix5REFBSUEsQ0FBQyxRQUFRaUIsT0FBTyxHQUFHQyxNQUFNO0lBQ25DRyxTQUFTZix5REFBaUJBLENBQUMsV0FBV1csT0FBTztJQUM3Q0ssY0FBY3RCLHlEQUFJQSxDQUFDLGlCQUFpQmlCLE9BQU87SUFDM0NNLGNBQWN2Qix5REFBSUEsQ0FBQyxpQkFBaUJpQixPQUFPO0lBQzNDTyxVQUFVeEIseURBQUlBLENBQUM7SUFDZnlCLFlBQVl6Qix5REFBSUEsQ0FBQztJQUNqQjBCLE1BQU0xQix5REFBSUEsQ0FBQyxRQUFRaUIsT0FBTyxHQUFHVSxPQUFPLENBQUM7SUFDckNDLE1BQU1oQyw0REFBT0EsQ0FBQztJQUNkaUMsWUFBWTdCLHlEQUFJQSxDQUFDLGNBQWNpQixPQUFPLEdBQUdVLE9BQU8sQ0FBQztJQUNqREcsYUFBYTlCLHlEQUFJQSxDQUFDLGdCQUFnQmlCLE9BQU8sR0FBR1UsT0FBTyxDQUFDO0lBQ3BESSxVQUFVL0IseURBQUlBLENBQUMsYUFBYWlCLE9BQU8sR0FBR1UsT0FBTyxDQUFDO0lBQzlDSyxVQUFVdEMsNERBQU9BLENBQUMsYUFBYWlDLE9BQU8sQ0FBQyxPQUFPVixPQUFPO0lBQ3JEZ0IsUUFBUXZDLDREQUFPQSxDQUFDLFVBQVVpQyxPQUFPLENBQUMsT0FBT1YsT0FBTztBQUNw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WUFDckNySyxZQUFZO2dCQUFDNEcsZ0JBQWdCZ0UsZ0JBQWdCO2FBQUM7UUFDbEQ7UUFDQVksZ0JBQWdCbkwsSUFBSWtGLGtCQUFrQjtZQUNsQ2hGLFFBQVE7Z0JBQUN5SyxnQkFBZ0J4RyxXQUFXO2FBQUM7WUFDckN4RSxZQUFZO2dCQUFDdUYsaUJBQWlCQyxnQkFBZ0I7YUFBQztRQUNuRDtJQUNKLElBQUkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9wZy9zY2hlbWEvaW5kZXgudHM/OGRhMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZWxhdGlvbnMsIHNxbCB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0IHsgXG4gICAgYm9vbGVhbixcbiAgICBpbmRleCxcbiAgICBpbnRlZ2VyLCBcbiAgICBqc29uYiwgXG4gICAgcGdUYWJsZSwgXG4gICAgc2VyaWFsLCBcbiAgICB0ZXh0LCBcbiAgICB0aW1lc3RhbXAsIFxuICAgIHV1aWQsXG59IGZyb20gXCJkcml6emxlLW9ybS9wZy1jb3JlXCI7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tIFwidXVpZFwiO1xuXG5pbXBvcnQgeyBTY3JpcHRGaWVsZCB9IGZyb20gXCJAL3R5cGVzXCI7XG5pbXBvcnQgeyBcbiAgICBieXRlYSxcbiAgICBtYWlsZXJTZXJ2aWNlRW51bSxcbiAgICByb2xlTmFtZUVudW0sXG4gICAgc2l0ZVR5cGVFbnVtLFxuICAgIHNpdGVFbnZFbnVtLFxuICAgIHNjcmlwdFR5cGVFbnVtLFxuICAgIHNjcmVlblR5cGVFbnVtLFxufSBmcm9tIFwiLi9fdXRpbHNcIjtcbmltcG9ydCB7IGRlZmF1bHRQcmVmZXJlbmNlcyB9IGZyb20gXCJAL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgKiBmcm9tICcuL191dGlscyc7XG5cbi8vIE1BSUxFUiBTRVRUSU5HU1xuZXhwb3J0IGNvbnN0IG1haWxlclNldHRpbmdzID0gcGdUYWJsZSgnbnRfbWFpbGVyX3NldHRpbmdzJywge1xuICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgIHNldHRpbmdJZDogdXVpZCgnc2V0dGluZ19pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgbmFtZTogdGV4dCgnbmFtZScpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICBzZXJ2aWNlOiBtYWlsZXJTZXJ2aWNlRW51bSgnc2VydmljZScpLm5vdE51bGwoKSxcbiAgICBhdXRoVXNlcm5hbWU6IHRleHQoJ2F1dGhfdXNlcm5hbWUnKS5ub3ROdWxsKCksXG4gICAgYXV0aFBhc3N3b3JkOiB0ZXh0KCdhdXRoX3Bhc3N3b3JkJykubm90TnVsbCgpLFxuICAgIGF1dGhUeXBlOiB0ZXh0KCdhdXRoX3R5cGUnKSxcbiAgICBhdXRoTWV0aG9kOiB0ZXh0KCdhdXRoX21ldGhvZCcpLFxuICAgIGhvc3Q6IHRleHQoJ2hvc3QnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgcG9ydDogaW50ZWdlcigncG9ydCcpLFxuICAgIGVuY3J5cHRpb246IHRleHQoJ2VuY3J5cHRpb24nKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgZnJvbUFkZHJlc3M6IHRleHQoJ2Zyb21fYWRkcmVzcycpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICBmcm9tTmFtZTogdGV4dCgnZnJvbV9uYW1lJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgIGlzQWN0aXZlOiBib29sZWFuKCdpc19hY3RpdmUnKS5kZWZhdWx0KGZhbHNlKS5ub3ROdWxsKCksXG4gICAgc2VjdXJlOiBib29sZWFuKCdzZWN1cmUnKS5kZWZhdWx0KGZhbHNlKS5ub3ROdWxsKCksXG59KTtcblxuLy8gRU1BSUwgVEVNUExBVEVTXG5leHBvcnQgY29uc3QgZW1haWxUZW1wbGF0ZXMgPSBwZ1RhYmxlKCdudF9lbWFpbF90ZW1wbGF0ZXMnLCB7XG4gICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgdGVtcGxhdGVJZDogdXVpZCgndGVtcGxhdGVfaWQnKS5ub3ROdWxsKCkudW5pcXVlKCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIG5hbWU6IHRleHQoJ25hbWUnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgZGF0YToganNvbmIoJ2RhdGEnKS5ub3ROdWxsKCksXG59KTtcblxuLy8gU1lTXG5leHBvcnQgY29uc3Qgc3lzID0gcGdUYWJsZSgnbnRfc3lzJywge1xuICAgIF9pZDogc2VyaWFsKCdfaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgaWQ6IHV1aWQoJ2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBrZXk6IHRleHQoJ2tleScpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICB2YWx1ZTogdGV4dCgndmFsdWUnKS5ub3ROdWxsKCksXG59KTtcblxuLy8gVE9LRU5TXG5leHBvcnQgY29uc3QgdG9rZW5zID0gcGdUYWJsZSgnbnRfdG9rZW5zJywge1xuICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgIHRva2VuOiBpbnRlZ2VyKCd0b2tlbicpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICB1c2VySWQ6IHV1aWQoJ3VzZXJfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHVzZXJzLnVzZXJJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICB2YWxpZFVudGlsOiB0aW1lc3RhbXAoJ3ZhbGlkX3VudGlsJykubm90TnVsbCgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCB0b2tlbnNSZWxhdGlvbnMgPSByZWxhdGlvbnModG9rZW5zLCAoeyBvbmUgfSkgPT4gKHtcbiAgICB1c2VyOiBvbmUodXNlcnMsIHtcbiAgICAgICAgZmllbGRzOiBbdG9rZW5zLnVzZXJJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFt1c2Vycy51c2VySWRdLFxuICAgIH0pLFxufSkpO1xuXG5leHBvcnQgY29uc3QgdXNlclJvbGVzID0gcGdUYWJsZSgnbnRfdXNlcl9yb2xlcycsIHtcbiAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICBuYW1lOiByb2xlTmFtZUVudW0oJ25hbWUnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgZGVzY3JpcHRpb246IHRleHQoJ2Rlc2NyaXB0aW9uJyksXG59KTtcblxuZXhwb3J0IGNvbnN0IHJvbGVzUmVsYXRpb25zID0gcmVsYXRpb25zKHVzZXJSb2xlcywgKHsgbWFueSB9KSA9PiAoe1xuICAgIHVzZXJzOiBtYW55KHVzZXJzKSxcbn0pKTtcblxuLy8gTEFOR1VBR0VTXG5leHBvcnQgY29uc3QgbGFuZ3VhZ2VzID0gcGdUYWJsZSgnbnRfbGFuZ3VhZ2VzJywge1xuICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgIG5hbWU6IHRleHQoJ25hbWUnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgaXNvOiB0ZXh0KCdpc28nKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgXG4gICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgZGVsZXRlZEF0OiB0aW1lc3RhbXAoJ2RlbGV0ZWRfYXQnKSxcbn0pO1xuXG4vLyBVU0VSU1xuZXhwb3J0IGNvbnN0IHVzZXJzID0gcGdUYWJsZShcbiAgICAnbnRfdXNlcnMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICB1c2VySWQ6IHV1aWQoJ3VzZXJfaWQnKS5ub3ROdWxsKCkudW5pcXVlKCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgICAgICByb2xlOiByb2xlTmFtZUVudW0oJ3JvbGUnKS5yZWZlcmVuY2VzKCgpID0+IHVzZXJSb2xlcy5uYW1lLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLmRlZmF1bHQoJ3VzZXInKS5ub3ROdWxsKCksXG4gICAgICAgIGVtYWlsOiB0ZXh0KCdlbWFpbCcpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICAgICAgcGFzc3dvcmQ6IHRleHQoJ3Bhc3N3b3JkJykubm90TnVsbCgpLFxuICAgICAgICBkaXNwbGF5TmFtZTogdGV4dCgnZGlzcGxheV9uYW1lJykubm90TnVsbCgpLFxuICAgICAgICBmaXJzdE5hbWU6IHRleHQoJ2ZpcnN0X25hbWUnKSxcbiAgICAgICAgbGFzdE5hbWU6IHRleHQoJ2xhc3RfbmFtZScpLCAgICAgXG5cbiAgICAgICAgYXZhdGFyOiB0ZXh0KCdhdmF0YXInKSxcbiAgICAgICAgYXZhdGFyX3NtOiB0ZXh0KCdhdmF0YXJfc20nKSxcbiAgICAgICAgYXZhdGFyX21kOiB0ZXh0KCdhdmF0YXJfbWQnKSxcblxuICAgICAgICBhY3RpdmF0aW9uRGF0ZTogdGltZXN0YW1wKCdhY3RpdmF0aW9uX2RhdGUnKSxcbiAgICAgICAgbGFzdExvZ2luRGF0ZTogdGltZXN0YW1wKCdsYXN0X2xvZ2luX2RhdGUnKSxcbiAgICAgICAgXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICAgICAgdXBkYXRlZEF0OiB0aW1lc3RhbXAoJ3VwZGF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICAgICAgZGVsZXRlZEF0OiB0aW1lc3RhbXAoJ2RlbGV0ZWRfYXQnKSxcbiAgICB9LFxuICAgIHRhYmxlID0+ICh7XG4gICAgICAgIHNlYXJjaEluZGV4OiBpbmRleCgndXNlcnNfc2VhcmNoX2luZGV4JylcbiAgICAgICAgICAgIC51c2luZyhcbiAgICAgICAgICAgICAgICAnZ2luJywgXG4gICAgICAgICAgICAgICAgc3FsYChcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLmVtYWlsfSkgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLmRpc3BsYXlOYW1lfSkgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLmZpcnN0TmFtZX0pIHx8XG4gICAgICAgICAgICAgICAgICAgIHRvX3RzdmVjdG9yKCdlbmdsaXNoJywgJHt0YWJsZS5sYXN0TmFtZX0pXG4gICAgICAgICAgICAgICAgKWBcbiAgICAgICAgICAgICksXG4gICAgfSksXG4pO1xuXG5leHBvcnQgY29uc3QgdXNlcnNSZWxhdGlvbnMgPSByZWxhdGlvbnModXNlcnMsICh7IG1hbnksIG9uZSB9KSA9PiAoe1xuICAgIGF1dGhUb2tlbnM6IG1hbnkoYXV0aENsaWVudHMpLFxuICAgIHRva2VuczogbWFueSh0b2tlbnMpLFxuICAgIGZpbGVzOiBtYW55KGZpbGVzKSxcbiAgICByb2xlOiBvbmUodXNlclJvbGVzLCB7XG4gICAgICAgIGZpZWxkczogW3VzZXJzLnJvbGVdLFxuICAgICAgICByZWZlcmVuY2VzOiBbdXNlclJvbGVzLm5hbWVdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBBVVRIIENMSUVOVFNcbmV4cG9ydCBjb25zdCBhdXRoQ2xpZW50cyA9IHBnVGFibGUoJ250X2F1dGhfY2xpZW50cycsIHtcbiAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICBjbGllbnRJZDogdXVpZCgnY2xpZW50X2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBjbGllbnRUb2tlbjogdGV4dCgnY2xpZW50X3Rva2VuJykubm90TnVsbCgpLnVuaXF1ZSgpLFxuICAgIHVzZXJJZDogdXVpZCgndXNlcl9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gdXNlcnMudXNlcklkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLFxuICAgIHZhbGlkVW50aWw6IHRpbWVzdGFtcCgndmFsaWRfdW50aWwnKSxcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG59KTtcblxuZXhwb3J0IGNvbnN0IGF1dGhDbGllbnRzUmVsYXRpb25zID0gcmVsYXRpb25zKGF1dGhDbGllbnRzLCAoeyBvbmUgfSkgPT4gKHtcbiAgICB1c2VyOiBvbmUodXNlcnMsIHtcbiAgICAgICAgZmllbGRzOiBbYXV0aENsaWVudHMudXNlcklkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3VzZXJzLnVzZXJJZF0sXG4gICAgfSksXG59KSk7XG5cbi8vIEFQSSBLRVlTXG5leHBvcnQgY29uc3QgYXBpS2V5cyA9IHBnVGFibGUoJ250X2FwaV9rZXlzJywge1xuICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgIGFwaUtleUlkOiB1dWlkKCdhcGlfa2V5X2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICBhcGlLZXk6IHRleHQoJ2FwaV9rZXknKS5ub3ROdWxsKCkudW5pcXVlKCkuJGRlZmF1bHRGbigoKSA9PiB1dWlkdjQoKSksXG4gICAgdmFsaWRVbnRpbDogdGltZXN0YW1wKCd2YWxpZF91bnRpbCcpLFxuICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbn0pO1xuXG5leHBvcnQgY29uc3Qgc2l0ZXMgPSBwZ1RhYmxlKCdudF9zaXRlcycsIHtcbiAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICBzaXRlSWQ6IHV1aWQoJ3NpdGVfaWQnKS5ub3ROdWxsKCkudW5pcXVlKCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgIG5hbWU6IHRleHQoJ25hbWUnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgbGluazogdGV4dCgnbGluaycpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICBhcGlLZXk6IHRleHQoJ2FwaV9rZXknKS5ub3ROdWxsKCksXG4gICAgdHlwZTogc2l0ZVR5cGVFbnVtKCd0eXBlJykubm90TnVsbCgpLFxuICAgIGVudjogc2l0ZUVudkVudW0oJ2VudicpLm5vdE51bGwoKS5kZWZhdWx0KCdwcm9kdWN0aW9uJyksXG4gICAgXG4gICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgZGVsZXRlZEF0OiB0aW1lc3RhbXAoJ2RlbGV0ZWRfYXQnKSxcbn0pO1xuXG4vLyBIT1NQSVRBTFNcbmV4cG9ydCBjb25zdCBob3NwaXRhbHMgPSBwZ1RhYmxlKFxuICAgICdudF9ob3NwaXRhbHMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICBob3NwaXRhbElkOiB1dWlkKCdob3NwaXRhbF9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIG9sZEhvc3BpdGFsSWQ6IHRleHQoJ29sZF9ob3NwaXRhbF9pZCcpLnVuaXF1ZSgpLFxuICAgICAgICBuYW1lOiB0ZXh0KCduYW1lJykubm90TnVsbCgpLnVuaXF1ZSgpLFxuICAgICAgICBjb3VudHJ5OiB0ZXh0KCdjb3VudHJ5JykuZGVmYXVsdCgnJyksXG4gICAgICAgIFxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgICAgIGRlbGV0ZWRBdDogdGltZXN0YW1wKCdkZWxldGVkX2F0JyksXG4gICAgfSxcbiAgICB0YWJsZSA9PiAoe1xuICAgICAgICBzZWFyY2hJbmRleDogaW5kZXgoJ2hvc3BpdGFsc19zZWFyY2hfaW5kZXgnKVxuICAgICAgICAgICAgLnVzaW5nKFxuICAgICAgICAgICAgICAgICdnaW4nLCBcbiAgICAgICAgICAgICAgICBzcWxgKFxuICAgICAgICAgICAgICAgICAgICB0b190c3ZlY3RvcignZW5nbGlzaCcsICR7dGFibGUubmFtZX0pXG4gICAgICAgICAgICAgICAgKWBcbiAgICAgICAgICAgICksXG4gICAgfSksXG4pO1xuXG4vLyBERVZJQ0VTXG5leHBvcnQgY29uc3QgZWRpdG9ySW5mbyA9IHBnVGFibGUoXG4gICAgJ250X2VkaXRvcl9pbmZvJywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgZGF0YVZlcnNpb246IGludGVnZXIoJ2RhdGFfdmVyc2lvbicpLm5vdE51bGwoKS5kZWZhdWx0KDEpLFxuICAgICAgICBsYXN0UHVibGlzaERhdGU6IHRpbWVzdGFtcCgnbGFzdF9wdWJsaXNoX2RhdGUnKSxcbiAgICB9LFxuKTtcblxuLy8gREVWSUNFU1xuZXhwb3J0IGNvbnN0IGRldmljZXMgPSBwZ1RhYmxlKFxuICAgICdudF9kZXZpY2VzJywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgZGV2aWNlSWQ6IHRleHQoJ2RldmljZV9pZCcpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICAgICAgZGV2aWNlSGFzaDogdGV4dCgnZGV2aWNlX2hhc2gnKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgICAgIGRldGFpbHM6IGpzb25iKCdkZXRhaWxzJykuZGVmYXVsdCh7fSksXG4gICAgICAgIFxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgICAgIGRlbGV0ZWRBdDogdGltZXN0YW1wKCdkZWxldGVkX2F0JyksXG4gICAgfSxcbik7XG5cbi8vIEZJTEVTXG5leHBvcnQgY29uc3QgZmlsZXMgPSBwZ1RhYmxlKFxuICAgICdudF9maWxlcycsIFxuICAgIHtcbiAgICAgICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgICAgIGZpbGVJZDogdXVpZCgnZmlsZV9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIG93bmVySWQ6IHV1aWQoJ293bmVyX2lkJykucmVmZXJlbmNlcygoKSA9PiB1c2Vycy51c2VySWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIGZpbGVuYW1lOiB0ZXh0KCdmaWxlbmFtZScpLm5vdE51bGwoKSxcbiAgICAgICAgY29udGVudFR5cGU6IHRleHQoJ2NvbnRlbnRfdHlwZScpLm5vdE51bGwoKSxcbiAgICAgICAgc2l6ZTogaW50ZWdlcignc2l6ZScpLm5vdE51bGwoKSxcbiAgICAgICAgbWV0YWRhdGE6IGpzb25iKCdtZXRhZGF0YScpLmRlZmF1bHQoJ3t9Jykubm90TnVsbCgpLFxuICAgICAgICBkYXRhOiBieXRlYSgnZGF0YScpLm5vdE51bGwoKSxcblxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgICAgIGRlbGV0ZWRBdDogdGltZXN0YW1wKCdkZWxldGVkX2F0JyksXG4gICAgfSxcbik7XG5cbmV4cG9ydCBjb25zdCBmaWxlc1JlbGF0aW9ucyA9IHJlbGF0aW9ucyhmaWxlcywgKHsgbWFueSwgb25lIH0pID0+ICh7XG4gICAgb3duZXI6IG9uZSh1c2Vycywge1xuICAgICAgICBmaWVsZHM6IFtmaWxlcy5vd25lcklkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3VzZXJzLnVzZXJJZF0sXG4gICAgfSksXG59KSk7XG5cbmV4cG9ydCBjb25zdCBmaWxlc0NodW5rcyA9IHBnVGFibGUoXG4gICAgJ250X2ZpbGVzX2NodW5rcycsIFxuICAgIHtcbiAgICAgICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgICAgIGNodW5rSWQ6IHV1aWQoJ2NodW5rX2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICAgICAgZmlsZUlkOiB1dWlkKCdmaWxlX2lkJykucmVmZXJlbmNlcygoKSA9PiBmaWxlcy5maWxlSWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSkubm90TnVsbCgpLFxuICAgICAgICBkYXRhOiBieXRlYSgnZGF0YScpLm5vdE51bGwoKSxcbiAgICB9LFxuKTtcblxuLy8gQ09ORklHIEtFWVNcbmV4cG9ydCBjb25zdCBjb25maWdLZXlzID0gcGdUYWJsZShcbiAgICAnbnRfY29uZmlnX2tleXMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICBjb25maWdLZXlJZDogdXVpZCgnY29uZmlnX2tleV9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIG9sZENvbmZpZ0tleUlkOiB0ZXh0KCdvbGRfY29uZmlnX2tleV9pZCcpLnVuaXF1ZSgpLFxuICAgICAgICBwb3NpdGlvbjogaW50ZWdlcigncG9zaXRpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIHZlcnNpb246IGludGVnZXIoJ3ZlcnNpb24nKS5ub3ROdWxsKCksXG5cbiAgICAgICAga2V5OiB0ZXh0KCdrZXknKS5ub3ROdWxsKCkudW5pcXVlKCksXG4gICAgICAgIGxhYmVsOiB0ZXh0KCdsYWJlbCcpLm5vdE51bGwoKS51bmlxdWUoKSxcbiAgICAgICAgc3VtbWFyeTogdGV4dCgnc3VtbWFyeScpLm5vdE51bGwoKSxcbiAgICAgICAgc291cmNlOiB0ZXh0KCdzb3VyY2UnKS5kZWZhdWx0KCdlZGl0b3InKSxcbiAgICAgICAgcHJlZmVyZW5jZXM6IGpzb25iKCdwcmVmZXJlbmNlcycpLmRlZmF1bHQoSlNPTi5zdHJpbmdpZnkoZGVmYXVsdFByZWZlcmVuY2VzKSkubm90TnVsbCgpLFxuICAgICAgICBcbiAgICAgICAgcHVibGlzaERhdGU6IHRpbWVzdGFtcCgncHVibGlzaF9kYXRlJykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICAgICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgICAgICB1cGRhdGVkQXQ6IHRpbWVzdGFtcCgndXBkYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCkuJG9uVXBkYXRlKCgpID0+IG5ldyBEYXRlKCkpLFxuICAgICAgICBkZWxldGVkQXQ6IHRpbWVzdGFtcCgnZGVsZXRlZF9hdCcpLFxuICAgIH0sXG4gICAgdGFibGUgPT4gKHtcbiAgICAgICAgc2VhcmNoSW5kZXg6IGluZGV4KCdjb25maWdfa2V5c19zZWFyY2hfaW5kZXgnKVxuICAgICAgICAgICAgLnVzaW5nKFxuICAgICAgICAgICAgICAgICdnaW4nLCBcbiAgICAgICAgICAgICAgICBzcWxgKFxuICAgICAgICAgICAgICAgICAgICB0b190c3ZlY3RvcignZW5nbGlzaCcsICR7dGFibGUua2V5fSkgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLmxhYmVsfSkgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLnN1bW1hcnl9KVxuICAgICAgICAgICAgICAgIClgXG4gICAgICAgICAgICApLFxuICAgIH0pLFxuKTtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZ0tleXNSZWxhdGlvbnMgPSByZWxhdGlvbnMoY29uZmlnS2V5cywgKHsgbWFueSwgb25lIH0pID0+ICh7XG4gICAgaGlzdG9yeTogbWFueShjb25maWdLZXlzSGlzdG9yeSksXG4gICAgZHJhZnQ6IG9uZShjb25maWdLZXlzRHJhZnRzLCB7XG4gICAgICAgIGZpZWxkczogW2NvbmZpZ0tleXMuY29uZmlnS2V5SWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlJZF0sXG4gICAgfSksXG59KSk7XG5cbi8vIENPTkZJRyBLRVlTIERSQUZUU1xuZXhwb3J0IGNvbnN0IGNvbmZpZ0tleXNEcmFmdHMgPSBwZ1RhYmxlKFxuICAgICdudF9jb25maWdfa2V5c19kcmFmdHMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICBjb25maWdLZXlEcmFmdElkOiB1dWlkKCdjb25maWdfa2V5X2RyYWZ0X2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICAgICAgY29uZmlnS2V5SWQ6IHV1aWQoJ2NvbmZpZ19rZXlfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGNvbmZpZ0tleXMuY29uZmlnS2V5SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIHBvc2l0aW9uOiBpbnRlZ2VyKCdwb3NpdGlvbicpLm5vdE51bGwoKSxcbiAgICAgICAgZGF0YToganNvbmIoJ2RhdGEnKS4kdHlwZTx0eXBlb2YgY29uZmlnS2V5cy4kaW5mZXJJbnNlcnQ+KCkubm90TnVsbCgpLFxuXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICAgICAgdXBkYXRlZEF0OiB0aW1lc3RhbXAoJ3VwZGF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICB9LFxuKTtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZ0tleXNEcmFmdHNSZWxhdGlvbnMgPSByZWxhdGlvbnMoY29uZmlnS2V5c0RyYWZ0cywgKHsgb25lIH0pID0+ICh7XG4gICAgY29uZmlnS2V5OiBvbmUoY29uZmlnS2V5cywge1xuICAgICAgICBmaWVsZHM6IFtjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleUlkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW2NvbmZpZ0tleXMuY29uZmlnS2V5SWRdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBDT05GSUcgS0VZUyBISVNUT1JZXG5leHBvcnQgY29uc3QgY29uZmlnS2V5c0hpc3RvcnkgPSBwZ1RhYmxlKFxuICAgICdudF9jb25maWdfa2V5c19oaXN0b3J5JywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgdmVyc2lvbjogaW50ZWdlcigndmVyc2lvbicpLm5vdE51bGwoKSxcbiAgICAgICAgY29uZmlnS2V5SWQ6IHV1aWQoJ2NvbmZpZ19rZXlfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGNvbmZpZ0tleXMuY29uZmlnS2V5SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSkubm90TnVsbCgpLFxuICAgICAgICByZXN0b3JlS2V5OiB1dWlkKCdyZXN0b3JlX2tleScpLFxuICAgICAgICBjaGFuZ2VzOiBqc29uYignZGF0YScpLmRlZmF1bHQoW10pLFxuXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICB9LFxuKTtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZ0tleXNIaXN0b3J5UmVsYXRpb25zID0gcmVsYXRpb25zKGNvbmZpZ0tleXNIaXN0b3J5LCAoeyBvbmUgfSkgPT4gKHtcbiAgICBjb25maWdLZXk6IG9uZShjb25maWdLZXlzLCB7XG4gICAgICAgIGZpZWxkczogW2NvbmZpZ0tleXNIaXN0b3J5LmNvbmZpZ0tleUlkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW2NvbmZpZ0tleXMuY29uZmlnS2V5SWRdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBTQ1JJUFRTXG5leHBvcnQgY29uc3Qgc2NyaXB0cyA9IHBnVGFibGUoXG4gICAgJ250X3NjcmlwdHMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICBzY3JpcHRJZDogdXVpZCgnc2NyaXB0X2lkJykubm90TnVsbCgpLnVuaXF1ZSgpLmRlZmF1bHRSYW5kb20oKSxcbiAgICAgICAgb2xkU2NyaXB0SWQ6IHRleHQoJ29sZF9zY3JpcHRfaWQnKS51bmlxdWUoKSxcbiAgICAgICAgdmVyc2lvbjogaW50ZWdlcigndmVyc2lvbicpLm5vdE51bGwoKSxcblxuICAgICAgICB0eXBlOiBzY3JpcHRUeXBlRW51bSgndHlwZScpLm5vdE51bGwoKS5kZWZhdWx0KCdhZG1pc3Npb24nKSxcbiAgICAgICAgcG9zaXRpb246IGludGVnZXIoJ3Bvc2l0aW9uJykubm90TnVsbCgpLFxuICAgICAgICBzb3VyY2U6IHRleHQoJ3NvdXJjZScpLmRlZmF1bHQoJ2VkaXRvcicpLFxuICAgICAgICB0aXRsZTogdGV4dCgndGl0bGUnKS5ub3ROdWxsKCksXG4gICAgICAgIHByaW50VGl0bGU6IHRleHQoJ3ByaW50X3RpdGxlJykubm90TnVsbCgpLFxuICAgICAgICBkZXNjcmlwdGlvbjogdGV4dCgnZGVzY3JpcHRpb24nKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGhvc3BpdGFsSWQ6IHV1aWQoJ2hvc3BpdGFsX2lkJykucmVmZXJlbmNlcygoKSA9PiBob3NwaXRhbHMuaG9zcGl0YWxJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgZXhwb3J0YWJsZTogYm9vbGVhbignZXhwb3J0YWJsZScpLm5vdE51bGwoKS5kZWZhdWx0KHRydWUpLFxuICAgICAgICBudWlkU2VhcmNoRW5hYmxlZDogYm9vbGVhbignbnVpZF9zZWFyY2hfZW5hYmxlZCcpLm5vdE51bGwoKS5kZWZhdWx0KGZhbHNlKSxcbiAgICAgICAgbnVpZFNlYXJjaEZpZWxkczoganNvbmIoJ251aWRfc2VhcmNoX2ZpZWxkcycpLmRlZmF1bHQoJ1tdJykubm90TnVsbCgpLFxuICAgICAgICBwcmVmZXJlbmNlczoganNvbmIoJ3ByZWZlcmVuY2VzJykuZGVmYXVsdChKU09OLnN0cmluZ2lmeShkZWZhdWx0UHJlZmVyZW5jZXMpKS5ub3ROdWxsKCksXG4gICAgICAgIFxuICAgICAgICBwdWJsaXNoRGF0ZTogdGltZXN0YW1wKCdwdWJsaXNoX2RhdGUnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgICAgIGRlbGV0ZWRBdDogdGltZXN0YW1wKCdkZWxldGVkX2F0JyksXG4gICAgfSxcbiAgICB0YWJsZSA9PiAoe1xuICAgICAgICBzZWFyY2hJbmRleDogaW5kZXgoJ3NjcmlwdHNfc2VhcmNoX2luZGV4JylcbiAgICAgICAgICAgIC51c2luZyhcbiAgICAgICAgICAgICAgICAnZ2luJywgXG4gICAgICAgICAgICAgICAgc3FsYChcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLnRpdGxlfSkgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3RhYmxlLmRlc2NyaXB0aW9ufSlcbiAgICAgICAgICAgICAgICApYFxuICAgICAgICAgICAgKSxcbiAgICB9KSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY3JpcHRzUmVsYXRpb25zID0gcmVsYXRpb25zKHNjcmlwdHMsICh7IG1hbnksIG9uZSB9KSA9PiAoe1xuICAgIHNjcmVlbnM6IG1hbnkoc2NyZWVucyksXG4gICAgc2NyZWVuc0RyYWZ0czogbWFueShzY3JlZW5zRHJhZnRzKSxcbiAgICBzY3JlZW5zSGlzdG9yeTogbWFueShzY3JlZW5zSGlzdG9yeSksXG4gICAgZGlhZ25vc2VzOiBtYW55KGRpYWdub3NlcyksXG4gICAgZGlhZ25vc2VzRHJhZnRzOiBtYW55KGRpYWdub3Nlc0RyYWZ0cyksXG4gICAgZGlhZ25vc2VzSGlzdG9yeTogbWFueShkaWFnbm9zZXNIaXN0b3J5KSxcbiAgICBoaXN0b3J5OiBtYW55KHNjcmlwdHNIaXN0b3J5KSxcbiAgICBkcmFmdDogb25lKHNjcmlwdHNEcmFmdHMsIHtcbiAgICAgICAgZmllbGRzOiBbc2NyaXB0cy5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzRHJhZnRzLnNjcmlwdElkXSxcbiAgICB9KSxcbn0pKTtcblxuLy8gU0NSSVBUUyBEUkFGVFNcbmV4cG9ydCBjb25zdCBzY3JpcHRzRHJhZnRzID0gcGdUYWJsZShcbiAgICAnbnRfc2NyaXB0c19kcmFmdHMnLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICBzY3JpcHREcmFmdElkOiB1dWlkKCdzY3JpcHRfZHJhZnRfaWQnKS5ub3ROdWxsKCkudW5pcXVlKCkuZGVmYXVsdFJhbmRvbSgpLFxuICAgICAgICBzY3JpcHRJZDogdXVpZCgnc2NyaXB0X2lkJykucmVmZXJlbmNlcygoKSA9PiBzY3JpcHRzLnNjcmlwdElkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLFxuICAgICAgICBwb3NpdGlvbjogaW50ZWdlcigncG9zaXRpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIGRhdGE6IGpzb25iKCdkYXRhJykuJHR5cGU8dHlwZW9mIHNjcmlwdHMuJGluZmVySW5zZXJ0ICYgeyBudWlkU2VhcmNoRmllbGRzOiBTY3JpcHRGaWVsZFtdOyB9PigpLm5vdE51bGwoKSxcblxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKCd1cGRhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKS4kb25VcGRhdGUoKCkgPT4gbmV3IERhdGUoKSksXG4gICAgfSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY3JpcHRzRHJhZnRzUmVsYXRpb25zID0gcmVsYXRpb25zKHNjcmlwdHNEcmFmdHMsICh7IG9uZSwgbWFueSwgfSkgPT4gKHtcbiAgICBzY3JlZW5zRHJhZnRzOiBtYW55KHNjcmVlbnNEcmFmdHMpLFxuICAgIGRpYWdub3Nlc0RyYWZ0czogbWFueShkaWFnbm9zZXNEcmFmdHMpLFxuICAgIHNjcmlwdDogb25lKHNjcmlwdHMsIHtcbiAgICAgICAgZmllbGRzOiBbc2NyaXB0c0RyYWZ0cy5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbn0pKTtcblxuLy8gU0NSSVBUUyBISVNUT1JZXG5leHBvcnQgY29uc3Qgc2NyaXB0c0hpc3RvcnkgPSBwZ1RhYmxlKFxuICAgICdudF9zY3JpcHRzX2hpc3RvcnknLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICB2ZXJzaW9uOiBpbnRlZ2VyKCd2ZXJzaW9uJykubm90TnVsbCgpLFxuICAgICAgICBzY3JpcHRJZDogdXVpZCgnc2NyaXB0X2lkJykucmVmZXJlbmNlcygoKSA9PiBzY3JpcHRzLnNjcmlwdElkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLm5vdE51bGwoKSxcbiAgICAgICAgcmVzdG9yZUtleTogdXVpZCgncmVzdG9yZV9rZXknKSxcbiAgICAgICAgY2hhbmdlczoganNvbmIoJ2RhdGEnKS5kZWZhdWx0KFtdKSxcblxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgfSxcbik7XG5cbmV4cG9ydCBjb25zdCBzY3JpcHRzSGlzdG9yeVJlbGF0aW9ucyA9IHJlbGF0aW9ucyhzY3JpcHRzSGlzdG9yeSwgKHsgb25lIH0pID0+ICh7XG4gICAgc2NyaXB0OiBvbmUoc2NyaXB0cywge1xuICAgICAgICBmaWVsZHM6IFtzY3JpcHRzSGlzdG9yeS5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbn0pKTtcblxuLy8gU0NSRUVOU1xuZXhwb3J0IGNvbnN0IHNjcmVlbnMgPSBwZ1RhYmxlKFxuICAgICdudF9zY3JlZW5zJywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgc2NyZWVuSWQ6IHV1aWQoJ3NjcmVlbl9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIG9sZFNjcmVlbklkOiB0ZXh0KCdvbGRfc2NyZWVuX2lkJykudW5pcXVlKCksXG4gICAgICAgIG9sZFNjcmlwdElkOiB0ZXh0KCdvbGRfc2NyaXB0X2lkJyksXG4gICAgICAgIHZlcnNpb246IGludGVnZXIoJ3ZlcnNpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIHNjcmlwdElkOiB1dWlkKCdzY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSkubm90TnVsbCgpLFxuXG4gICAgICAgIHR5cGU6IHNjcmVlblR5cGVFbnVtKCd0eXBlJykubm90TnVsbCgpLFxuICAgICAgICBwb3NpdGlvbjogaW50ZWdlcigncG9zaXRpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIHNvdXJjZTogdGV4dCgnc291cmNlJykuZGVmYXVsdCgnZWRpdG9yJyksXG4gICAgICAgIHNlY3Rpb25UaXRsZTogdGV4dCgnc2VjdGlvbl90aXRsZScpLm5vdE51bGwoKSxcbiAgICAgICAgcHJldmlld1RpdGxlOiB0ZXh0KCdwcmV2aWV3X3RpdGxlJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBwcmV2aWV3UHJpbnRUaXRsZTogdGV4dCgncHJldmlld19wcmludF90aXRsZScpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgY29uZGl0aW9uOiB0ZXh0KCdjb25kaXRpb24nKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGVwaWNJZDogdGV4dCgnZXBpY19pZCcpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgc3RvcnlJZDogdGV4dCgnc3RvcnlfaWQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIHJlZklkOiB0ZXh0KCdyZWZfaWQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIHJlZktleTogdGV4dCgncmVmX2tleScpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgc3RlcDogdGV4dCgnc3RlcCcpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgYWN0aW9uVGV4dDogdGV4dCgnYWN0aW9uX3RleHQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGNvbnRlbnRUZXh0OiB0ZXh0KCdjb250ZW50X3RleHQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGluZm9UZXh0OiB0ZXh0KCdpbmZvX3RleHQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIHRpdGxlOiB0ZXh0KCd0aXRsZScpLm5vdE51bGwoKSxcbiAgICAgICAgdGl0bGUxOiB0ZXh0KCd0aXRsZTEnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIHRpdGxlMjogdGV4dCgndGl0bGUyJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICB0aXRsZTM6IHRleHQoJ3RpdGxlMycpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgdGl0bGU0OiB0ZXh0KCd0aXRsZTQnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIHRleHQxOiB0ZXh0KCd0ZXh0MScpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgdGV4dDI6IHRleHQoJ3RleHQyJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICB0ZXh0MzogdGV4dCgndGV4dDMnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGltYWdlMToganNvbmIoJ2ltYWdlMScpLFxuICAgICAgICBpbWFnZTI6IGpzb25iKCdpbWFnZTInKSxcbiAgICAgICAgaW1hZ2UzOiBqc29uYignaW1hZ2UzJyksXG4gICAgICAgIGluc3RydWN0aW9uczogdGV4dCgnaW5zdHJ1Y3Rpb25zJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBpbnN0cnVjdGlvbnMyOiB0ZXh0KCdpbnN0cnVjdGlvbnMyJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBpbnN0cnVjdGlvbnMzOiB0ZXh0KCdpbnN0cnVjdGlvbnMzJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBpbnN0cnVjdGlvbnM0OiB0ZXh0KCdpbnN0cnVjdGlvbnM0Jykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBoY3dEaWFnbm9zZXNJbnN0cnVjdGlvbnM6IHRleHQoJ2hjd19kaWFnbm9zZXNfaW5zdHJ1Y3Rpb25zJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBzdWdnZXN0ZWREaWFnbm9zZXNJbnN0cnVjdGlvbnM6IHRleHQoJ3N1Z2dlc3RlZF9kaWFnbm9zZXNfaW5zdHJ1Y3Rpb25zJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBub3RlczogdGV4dCgnbm90ZXMnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGRhdGFUeXBlOiB0ZXh0KCdkYXRhX3R5cGUnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGtleTogdGV4dCgna2V5Jykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBsYWJlbDogdGV4dCgnbGFiZWwnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIG5lZ2F0aXZlTGFiZWw6IHRleHQoJ25lZ2F0aXZlX2xhYmVsJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBwb3NpdGl2ZUxhYmVsOiB0ZXh0KCdwb3NpdGl2ZV9sYWJlbCcpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgdGltZXJWYWx1ZTogaW50ZWdlcigndGltZXJfdmFsdWUnKSxcbiAgICAgICAgbXVsdGlwbGllcjogaW50ZWdlcignbXVsdGlwbGllcicpLFxuICAgICAgICBtaW5WYWx1ZTogaW50ZWdlcignbWluX3ZhbHVlJyksXG4gICAgICAgIG1heFZhbHVlOiBpbnRlZ2VyKCdtYXhfdmFsdWUnKSxcbiAgICAgICAgZXhwb3J0YWJsZTogYm9vbGVhbignZXhwb3J0YWJsZScpLm5vdE51bGwoKS5kZWZhdWx0KHRydWUpLFxuICAgICAgICBwcmludGFibGU6IGJvb2xlYW4oJ3ByaW50YWJsZScpLFxuICAgICAgICBza2lwcGFibGU6IGJvb2xlYW4oJ3NraXBwYWJsZScpLm5vdE51bGwoKS5kZWZhdWx0KGZhbHNlKSxcbiAgICAgICAgY29uZmlkZW50aWFsOiBib29sZWFuKCdjb25maWRlbnRpYWwnKS5ub3ROdWxsKCkuZGVmYXVsdChmYWxzZSksXG4gICAgICAgIHByZVBvcHVsYXRlOiBqc29uYigncHJlX3BvcHVsYXRlJykuZGVmYXVsdCgnW10nKS5ub3ROdWxsKCksXG4gICAgICAgIGZpZWxkczoganNvbmIoJ2ZpZWxkcycpLmRlZmF1bHQoJ1tdJykubm90TnVsbCgpLFxuICAgICAgICBpdGVtczoganNvbmIoJ2l0ZW1zJykuZGVmYXVsdCgnW10nKS5ub3ROdWxsKCksXG4gICAgICAgIHByZWZlcmVuY2VzOiBqc29uYigncHJlZmVyZW5jZXMnKS5kZWZhdWx0KEpTT04uc3RyaW5naWZ5KGRlZmF1bHRQcmVmZXJlbmNlcykpLm5vdE51bGwoKSxcbiAgICAgICAgXG4gICAgICAgIHB1Ymxpc2hEYXRlOiB0aW1lc3RhbXAoJ3B1Ymxpc2hfZGF0ZScpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICAgICAgdXBkYXRlZEF0OiB0aW1lc3RhbXAoJ3VwZGF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICAgICAgZGVsZXRlZEF0OiB0aW1lc3RhbXAoJ2RlbGV0ZWRfYXQnKSxcbiAgICB9LFxuICAgIHRhYmxlID0+ICh7XG4gICAgICAgIHNlYXJjaEluZGV4OiBpbmRleCgnc2NyZWVuc19zZWFyY2hfaW5kZXgnKVxuICAgICAgICAgICAgLnVzaW5nKFxuICAgICAgICAgICAgICAgICdnaW4nLCBcbiAgICAgICAgICAgICAgICBzcWxgKFxuICAgICAgICAgICAgICAgICAgICB0b190c3ZlY3RvcignZW5nbGlzaCcsICR7dGFibGUudGl0bGV9KVxuICAgICAgICAgICAgICAgIClgXG4gICAgICAgICAgICApLFxuICAgIH0pLFxuKTtcblxuZXhwb3J0IGNvbnN0IHNjcmVlbnNSZWxhdGlvbnMgPSByZWxhdGlvbnMoc2NyZWVucywgKHsgbWFueSwgb25lIH0pID0+ICh7XG4gICAgaGlzdG9yeTogbWFueShzY3JlZW5zSGlzdG9yeSksXG4gICAgc2NyaXB0OiBvbmUoc2NyaXB0cywge1xuICAgICAgICBmaWVsZHM6IFtzY3JlZW5zLnNjcmlwdElkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3NjcmlwdHMuc2NyaXB0SWRdLFxuICAgIH0pLFxuICAgIGRyYWZ0OiBvbmUoc2NyZWVuc0RyYWZ0cywge1xuICAgICAgICBmaWVsZHM6IFtzY3JlZW5zLnNjcmVlbklkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3NjcmVlbnNEcmFmdHMuc2NyZWVuSWRdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBTQ1JFRU5TIERSQUZUU1xuZXhwb3J0IGNvbnN0IHNjcmVlbnNEcmFmdHMgPSBwZ1RhYmxlKFxuICAgICdudF9zY3JlZW5zX2RyYWZ0cycsIFxuICAgIHtcbiAgICAgICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgICAgIHNjcmVlbkRyYWZ0SWQ6IHV1aWQoJ3NjcmVlbl9kcmFmdF9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIHNjcmVlbklkOiB1dWlkKCdzY3JlZW5faWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmVlbnMuc2NyZWVuSWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIHNjcmlwdElkOiB1dWlkKCdzY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIHNjcmlwdERyYWZ0SWQ6IHV1aWQoJ3NjcmlwdF9kcmFmdF9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLFxuICAgICAgICB0eXBlOiBzY3JlZW5UeXBlRW51bSgndHlwZScpLm5vdE51bGwoKSxcbiAgICAgICAgcG9zaXRpb246IGludGVnZXIoJ3Bvc2l0aW9uJykubm90TnVsbCgpLFxuICAgICAgICBkYXRhOiBqc29uYignZGF0YScpLiR0eXBlPHR5cGVvZiBzY3JlZW5zLiRpbmZlckluc2VydD4oKS5ub3ROdWxsKCksXG5cbiAgICAgICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgICAgICB1cGRhdGVkQXQ6IHRpbWVzdGFtcCgndXBkYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCkuJG9uVXBkYXRlKCgpID0+IG5ldyBEYXRlKCkpLFxuICAgIH0sXG4pO1xuXG5leHBvcnQgY29uc3Qgc2NyZWVuc0RyYWZ0c1JlbGF0aW9ucyA9IHJlbGF0aW9ucyhzY3JlZW5zRHJhZnRzLCAoeyBvbmUgfSkgPT4gKHtcbiAgICBzY3JlZW46IG9uZShzY3JlZW5zLCB7XG4gICAgICAgIGZpZWxkczogW3NjcmVlbnNEcmFmdHMuc2NyZWVuSWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbc2NyZWVucy5zY3JlZW5JZF0sXG4gICAgfSksXG4gICAgc2NyaXB0RHJhZnQ6IG9uZShzY3JpcHRzRHJhZnRzLCB7XG4gICAgICAgIGZpZWxkczogW3NjcmVlbnNEcmFmdHMuc2NyaXB0RHJhZnRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWRdLFxuICAgIH0pLFxuICAgIHNjcmlwdDogb25lKHNjcmlwdHMsIHtcbiAgICAgICAgZmllbGRzOiBbc2NyZWVuc0RyYWZ0cy5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbn0pKTtcblxuLy8gU0NSRUVOUyBISVNUT1JZXG5leHBvcnQgY29uc3Qgc2NyZWVuc0hpc3RvcnkgPSBwZ1RhYmxlKFxuICAgICdudF9zY3JlZW5zX2hpc3RvcnknLCBcbiAgICB7XG4gICAgICAgIGlkOiBzZXJpYWwoJ2lkJykucHJpbWFyeUtleSgpLFxuICAgICAgICB2ZXJzaW9uOiBpbnRlZ2VyKCd2ZXJzaW9uJykubm90TnVsbCgpLFxuICAgICAgICBzY3JlZW5JZDogdXVpZCgnc2NyZWVuX2lkJykucmVmZXJlbmNlcygoKSA9PiBzY3JlZW5zLnNjcmVlbklkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLm5vdE51bGwoKSxcbiAgICAgICAgc2NyaXB0SWQ6IHV1aWQoJ3NjcmlwdF9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gc2NyaXB0cy5zY3JpcHRJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KS5ub3ROdWxsKCksXG4gICAgICAgIHJlc3RvcmVLZXk6IHRleHQoJ3Jlc3RvcmVfa2V5JyksXG4gICAgICAgIGNoYW5nZXM6IGpzb25iKCdkYXRhJykuZGVmYXVsdChbXSksXG5cbiAgICAgICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgIH0sXG4pO1xuXG5leHBvcnQgY29uc3Qgc2NyZWVuc0hpc3RvcnlSZWxhdGlvbnMgPSByZWxhdGlvbnMoc2NyZWVuc0hpc3RvcnksICh7IG9uZSB9KSA9PiAoe1xuICAgIHNjcmVlbjogb25lKHNjcmVlbnMsIHtcbiAgICAgICAgZmllbGRzOiBbc2NyZWVuc0hpc3Rvcnkuc2NyZWVuSWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbc2NyZWVucy5zY3JlZW5JZF0sXG4gICAgfSksXG4gICAgc2NyaXB0OiBvbmUoc2NyaXB0cywge1xuICAgICAgICBmaWVsZHM6IFtzY3JlZW5zSGlzdG9yeS5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbn0pKTtcblxuLy8gRElBR05PU0VTXG5leHBvcnQgY29uc3QgZGlhZ25vc2VzID0gcGdUYWJsZShcbiAgICAnbnRfZGlhZ25vc2VzJywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgZGlhZ25vc2lzSWQ6IHV1aWQoJ2RpYWdub3Npc19pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIG9sZERpYWdub3Npc0lkOiB0ZXh0KCdvbGRfZGlhZ25vc2lzX2lkJykudW5pcXVlKCksXG4gICAgICAgIG9sZFNjcmlwdElkOiB0ZXh0KCdvbGRfc2NyaXB0X2lkJyksXG4gICAgICAgIHZlcnNpb246IGludGVnZXIoJ3ZlcnNpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIHNjcmlwdElkOiB1dWlkKCdzY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSkubm90TnVsbCgpLFxuXG4gICAgICAgIHBvc2l0aW9uOiBpbnRlZ2VyKCdwb3NpdGlvbicpLm5vdE51bGwoKSxcbiAgICAgICAgc291cmNlOiB0ZXh0KCdzb3VyY2UnKS5kZWZhdWx0KCdlZGl0b3InKSxcbiAgICAgICAgZXhwcmVzc2lvbjogdGV4dCgnZXhwcmVzc2lvbicpLm5vdE51bGwoKSxcbiAgICAgICAgbmFtZTogdGV4dCgnbmFtZScpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgZGVzY3JpcHRpb246IHRleHQoJ2Rlc2NyaXB0aW9uJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBrZXk6IHRleHQoJ2tleScpLmRlZmF1bHQoJycpLFxuICAgICAgICBzZXZlcml0eU9yZGVyOiBpbnRlZ2VyKCdzZXZlcml0eV9vcmRlcicpLFxuICAgICAgICBleHByZXNzaW9uTWVhbmluZzogdGV4dCgnZXhwcmVzc2lvbl9tZWFuaW5nJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICBzeW1wdG9tczoganNvbmIoJ3N5bXB0b21zJykuZGVmYXVsdCgnW10nKS5ub3ROdWxsKCksXG4gICAgICAgIHRleHQxOiB0ZXh0KCd0ZXh0MScpLm5vdE51bGwoKS5kZWZhdWx0KCcnKSxcbiAgICAgICAgdGV4dDI6IHRleHQoJ3RleHQyJykubm90TnVsbCgpLmRlZmF1bHQoJycpLFxuICAgICAgICB0ZXh0MzogdGV4dCgndGV4dDMnKS5ub3ROdWxsKCkuZGVmYXVsdCgnJyksXG4gICAgICAgIGltYWdlMToganNvbmIoJ2ltYWdlMScpLFxuICAgICAgICBpbWFnZTI6IGpzb25iKCdpbWFnZTInKSxcbiAgICAgICAgaW1hZ2UzOiBqc29uYignaW1hZ2UzJyksXG4gICAgICAgIHByZWZlcmVuY2VzOiBqc29uYigncHJlZmVyZW5jZXMnKS5kZWZhdWx0KEpTT04uc3RyaW5naWZ5KGRlZmF1bHRQcmVmZXJlbmNlcykpLm5vdE51bGwoKSxcbiAgICAgICAgXG4gICAgICAgIHB1Ymxpc2hEYXRlOiB0aW1lc3RhbXAoJ3B1Ymxpc2hfZGF0ZScpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICAgICAgdXBkYXRlZEF0OiB0aW1lc3RhbXAoJ3VwZGF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLiRvblVwZGF0ZSgoKSA9PiBuZXcgRGF0ZSgpKSxcbiAgICAgICAgZGVsZXRlZEF0OiB0aW1lc3RhbXAoJ2RlbGV0ZWRfYXQnKSxcbiAgICB9LFxuICAgIHRhYmxlID0+ICh7XG4gICAgICAgIHNlYXJjaEluZGV4OiBpbmRleCgnZGlhZ25vc2VzX3NlYXJjaF9pbmRleCcpXG4gICAgICAgICAgICAudXNpbmcoXG4gICAgICAgICAgICAgICAgJ2dpbicsIFxuICAgICAgICAgICAgICAgIHNxbGAoXG4gICAgICAgICAgICAgICAgICAgIHRvX3RzdmVjdG9yKCdlbmdsaXNoJywgJHt0YWJsZS5uYW1lfSlcbiAgICAgICAgICAgICAgICApYFxuICAgICAgICAgICAgKSxcbiAgICB9KSxcbik7XG5cbmV4cG9ydCBjb25zdCBkaWFnbm9zZXNSZWxhdGlvbnMgPSByZWxhdGlvbnMoZGlhZ25vc2VzLCAoeyBtYW55LCBvbmUgfSkgPT4gKHtcbiAgICBoaXN0b3J5OiBtYW55KGRpYWdub3Nlc0hpc3RvcnkpLFxuICAgIHNjcmlwdDogb25lKHNjcmlwdHMsIHtcbiAgICAgICAgZmllbGRzOiBbZGlhZ25vc2VzLnNjcmlwdElkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3NjcmlwdHMuc2NyaXB0SWRdLFxuICAgIH0pLFxuICAgIGRyYWZ0OiBvbmUoZGlhZ25vc2VzRHJhZnRzLCB7XG4gICAgICAgIGZpZWxkczogW2RpYWdub3Nlcy5kaWFnbm9zaXNJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzSWRdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBESUFHTk9TRVMgRFJBRlRTXG5leHBvcnQgY29uc3QgZGlhZ25vc2VzRHJhZnRzID0gcGdUYWJsZShcbiAgICAnbnRfZGlhZ25vc2VzX2RyYWZ0cycsIFxuICAgIHtcbiAgICAgICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHV1aWQoJ2RpYWdub3Npc19kcmFmdF9pZCcpLm5vdE51bGwoKS51bmlxdWUoKS5kZWZhdWx0UmFuZG9tKCksXG4gICAgICAgIGRpYWdub3Npc0lkOiB1dWlkKCdkaWFnbm9zaXNfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgc2NyaXB0SWQ6IHV1aWQoJ3NjcmlwdF9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gc2NyaXB0cy5zY3JpcHRJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgc2NyaXB0RHJhZnRJZDogdXVpZCgnc2NyaXB0X2RyYWZ0X2lkJykucmVmZXJlbmNlcygoKSA9PiBzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIHBvc2l0aW9uOiBpbnRlZ2VyKCdwb3NpdGlvbicpLm5vdE51bGwoKSxcbiAgICAgICAgZGF0YToganNvbmIoJ2RhdGEnKS4kdHlwZTx0eXBlb2YgZGlhZ25vc2VzLiRpbmZlckluc2VydD4oKS5ub3ROdWxsKCksXG5cbiAgICAgICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoJ2NyZWF0ZWRfYXQnKS5kZWZhdWx0Tm93KCkubm90TnVsbCgpLFxuICAgICAgICB1cGRhdGVkQXQ6IHRpbWVzdGFtcCgndXBkYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCkuJG9uVXBkYXRlKCgpID0+IG5ldyBEYXRlKCkpLFxuICAgIH0sXG4pO1xuXG5leHBvcnQgY29uc3QgZGlhZ25vc2VzRHJhZnRzUmVsYXRpb25zID0gcmVsYXRpb25zKGRpYWdub3Nlc0RyYWZ0cywgKHsgb25lIH0pID0+ICh7XG4gICAgZGlhZ25vc2lzOiBvbmUoZGlhZ25vc2VzLCB7XG4gICAgICAgIGZpZWxkczogW2RpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtkaWFnbm9zZXMuZGlhZ25vc2lzSWRdLFxuICAgIH0pLFxuICAgIHNjcmlwdERyYWZ0OiBvbmUoc2NyaXB0c0RyYWZ0cywge1xuICAgICAgICBmaWVsZHM6IFtkaWFnbm9zZXNEcmFmdHMuc2NyaXB0RHJhZnRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWRdLFxuICAgIH0pLFxuICAgIHNjcmlwdDogb25lKHNjcmlwdHMsIHtcbiAgICAgICAgZmllbGRzOiBbZGlhZ25vc2VzRHJhZnRzLnNjcmlwdElkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW3NjcmlwdHMuc2NyaXB0SWRdLFxuICAgIH0pLFxufSkpO1xuXG4vLyBESUFHTk9TRVMgSElTVE9SWVxuZXhwb3J0IGNvbnN0IGRpYWdub3Nlc0hpc3RvcnkgPSBwZ1RhYmxlKFxuICAgICdudF9kaWFnbm9zZXNfaGlzdG9yeScsIFxuICAgIHtcbiAgICAgICAgaWQ6IHNlcmlhbCgnaWQnKS5wcmltYXJ5S2V5KCksXG4gICAgICAgIHZlcnNpb246IGludGVnZXIoJ3ZlcnNpb24nKS5ub3ROdWxsKCksXG4gICAgICAgIGRpYWdub3Npc0lkOiB1dWlkKCdkaWFnbm9zaXNfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KS5ub3ROdWxsKCksXG4gICAgICAgIHNjcmlwdElkOiB1dWlkKCdzY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSkubm90TnVsbCgpLFxuICAgICAgICByZXN0b3JlS2V5OiB0ZXh0KCdyZXN0b3JlX2tleScpLFxuICAgICAgICBjaGFuZ2VzOiBqc29uYignZGF0YScpLmRlZmF1bHQoW10pLFxuXG4gICAgICAgIGNyZWF0ZWRBdDogdGltZXN0YW1wKCdjcmVhdGVkX2F0JykuZGVmYXVsdE5vdygpLm5vdE51bGwoKSxcbiAgICB9LFxuKTtcblxuZXhwb3J0IGNvbnN0IGRpYWdub3Nlc0hpc3RvcnlSZWxhdGlvbnMgPSByZWxhdGlvbnMoZGlhZ25vc2VzSGlzdG9yeSwgKHsgb25lIH0pID0+ICh7XG4gICAgZGlhZ25vc2lzOiBvbmUoZGlhZ25vc2VzLCB7XG4gICAgICAgIGZpZWxkczogW2RpYWdub3Nlc0hpc3RvcnkuZGlhZ25vc2lzSWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbZGlhZ25vc2VzLmRpYWdub3Npc0lkXSxcbiAgICB9KSxcbiAgICBzY3JpcHQ6IG9uZShzY3JpcHRzLCB7XG4gICAgICAgIGZpZWxkczogW2RpYWdub3Nlc0hpc3Rvcnkuc2NyaXB0SWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbc2NyaXB0cy5zY3JpcHRJZF0sXG4gICAgfSksXG59KSk7XG5cbi8vIFBFTkRJTkcgREVMRVRJT05cbmV4cG9ydCBjb25zdCBwZW5kaW5nRGVsZXRpb24gPSBwZ1RhYmxlKFxuICAgICdudF9wZW5kaW5nX2RlbGV0aW9uJywgXG4gICAge1xuICAgICAgICBpZDogc2VyaWFsKCdpZCcpLnByaW1hcnlLZXkoKSxcbiAgICAgICAgc2NyaXB0SWQ6IHV1aWQoJ3NjcmlwdF9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gc2NyaXB0cy5zY3JpcHRJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgc2NyZWVuSWQ6IHV1aWQoJ3NjcmVlbl9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gc2NyZWVucy5zY3JlZW5JZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgc2NyZWVuU2NyaXB0SWQ6IHV1aWQoJ3NjcmVlbl9zY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIGRpYWdub3Npc0lkOiB1dWlkKCdkaWFnbm9zaXNfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgZGlhZ25vc2lzU2NyaXB0SWQ6IHV1aWQoJ2RpYWdub3Npc19zY3JpcHRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHMuc2NyaXB0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIGNvbmZpZ0tleUlkOiB1dWlkKCdjb25maWdfa2V5X2lkJykucmVmZXJlbmNlcygoKSA9PiBjb25maWdLZXlzLmNvbmZpZ0tleUlkLCB7IG9uRGVsZXRlOiAnY2FzY2FkZScsIH0pLFxuICAgICAgICBzY3JpcHREcmFmdElkOiB1dWlkKCdzY3JpcHRfZHJhZnRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcbiAgICAgICAgc2NyZWVuRHJhZnRJZDogdXVpZCgnc2NyZWVuX2RyYWZ0X2lkJykucmVmZXJlbmNlcygoKSA9PiBzY3JlZW5zRHJhZnRzLnNjcmVlbkRyYWZ0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHV1aWQoJ2RpYWdub3Npc19kcmFmdF9pZCcpLnJlZmVyZW5jZXMoKCkgPT4gZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0RyYWZ0SWQsIHsgb25EZWxldGU6ICdjYXNjYWRlJywgfSksXG4gICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ6IHV1aWQoJ2NvbmZpZ19rZXlfZHJhZnRfaWQnKS5yZWZlcmVuY2VzKCgpID0+IGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5RHJhZnRJZCwgeyBvbkRlbGV0ZTogJ2Nhc2NhZGUnLCB9KSxcblxuICAgICAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCgnY3JlYXRlZF9hdCcpLmRlZmF1bHROb3coKS5ub3ROdWxsKCksXG4gICAgfSxcbik7XG5cbmV4cG9ydCBjb25zdCBwZW5kaW5nRGVsZXRpb25SZWxhdGlvbnMgPSByZWxhdGlvbnMocGVuZGluZ0RlbGV0aW9uLCAoeyBvbmUgfSkgPT4gKHtcbiAgICBzY3JpcHQ6IG9uZShzY3JpcHRzLCB7XG4gICAgICAgIGZpZWxkczogW3BlbmRpbmdEZWxldGlvbi5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbiAgICBzY3JlZW46IG9uZShzY3JlZW5zLCB7XG4gICAgICAgIGZpZWxkczogW3BlbmRpbmdEZWxldGlvbi5zY3JlZW5JZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JlZW5zLnNjcmVlbklkXSxcbiAgICB9KSxcbiAgICBzY3JlZW5TY3JpcHQ6IG9uZShzY3JpcHRzLCB7XG4gICAgICAgIGZpZWxkczogW3BlbmRpbmdEZWxldGlvbi5zY3JlZW5TY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzLnNjcmlwdElkXSxcbiAgICB9KSxcbiAgICBkaWFnbm9zaXM6IG9uZShkaWFnbm9zZXMsIHtcbiAgICAgICAgZmllbGRzOiBbcGVuZGluZ0RlbGV0aW9uLmRpYWdub3Npc0lkXSxcbiAgICAgICAgcmVmZXJlbmNlczogW2RpYWdub3Nlcy5kaWFnbm9zaXNJZF0sXG4gICAgfSksXG4gICAgZGlhZ25vc2lzU2NyaXB0OiBvbmUoc2NyaXB0cywge1xuICAgICAgICBmaWVsZHM6IFtwZW5kaW5nRGVsZXRpb24uZGlhZ25vc2lzU2NyaXB0SWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbc2NyaXB0cy5zY3JpcHRJZF0sXG4gICAgfSksXG4gICAgY29uZmlnS2V5OiBvbmUoY29uZmlnS2V5cywge1xuICAgICAgICBmaWVsZHM6IFtwZW5kaW5nRGVsZXRpb24uY29uZmlnS2V5SWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbY29uZmlnS2V5cy5jb25maWdLZXlJZF0sXG4gICAgfSksXG4gICAgc2NyaXB0RHJhZnQ6IG9uZShzY3JpcHRzRHJhZnRzLCB7XG4gICAgICAgIGZpZWxkczogW3BlbmRpbmdEZWxldGlvbi5zY3JpcHRJZF0sXG4gICAgICAgIHJlZmVyZW5jZXM6IFtzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWRdLFxuICAgIH0pLFxuICAgIHNjcmVlbkRyYWZ0OiBvbmUoc2NyZWVuc0RyYWZ0cywge1xuICAgICAgICBmaWVsZHM6IFtwZW5kaW5nRGVsZXRpb24uc2NyZWVuSWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkXSxcbiAgICB9KSxcbiAgICBkaWFnbm9zaXNEcmFmdDogb25lKGRpYWdub3Nlc0RyYWZ0cywge1xuICAgICAgICBmaWVsZHM6IFtwZW5kaW5nRGVsZXRpb24uZGlhZ25vc2lzSWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0RyYWZ0SWRdLFxuICAgIH0pLFxuICAgIGNvbmZpZ0tleURyYWZ0OiBvbmUoY29uZmlnS2V5c0RyYWZ0cywge1xuICAgICAgICBmaWVsZHM6IFtwZW5kaW5nRGVsZXRpb24uY29uZmlnS2V5SWRdLFxuICAgICAgICByZWZlcmVuY2VzOiBbY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlEcmFmdElkXSxcbiAgICB9KSxcbn0pKTtcbiJdLCJuYW1lcyI6WyJyZWxhdGlvbnMiLCJzcWwiLCJib29sZWFuIiwiaW5kZXgiLCJpbnRlZ2VyIiwianNvbmIiLCJwZ1RhYmxlIiwic2VyaWFsIiwidGV4dCIsInRpbWVzdGFtcCIsInV1aWQiLCJ2NCIsInV1aWR2NCIsImJ5dGVhIiwibWFpbGVyU2VydmljZUVudW0iLCJyb2xlTmFtZUVudW0iLCJzaXRlVHlwZUVudW0iLCJzaXRlRW52RW51bSIsInNjcmlwdFR5cGVFbnVtIiwic2NyZWVuVHlwZUVudW0iLCJkZWZhdWx0UHJlZmVyZW5jZXMiLCJtYWlsZXJTZXR0aW5ncyIsImlkIiwicHJpbWFyeUtleSIsInNldHRpbmdJZCIsIm5vdE51bGwiLCJ1bmlxdWUiLCJkZWZhdWx0UmFuZG9tIiwibmFtZSIsInNlcnZpY2UiLCJhdXRoVXNlcm5hbWUiLCJhdXRoUGFzc3dvcmQiLCJhdXRoVHlwZSIsImF1dGhNZXRob2QiLCJob3N0IiwiZGVmYXVsdCIsInBvcnQiLCJlbmNyeXB0aW9uIiwiZnJvbUFkZHJlc3MiLCJmcm9tTmFtZSIsImlzQWN0aXZlIiwic2VjdXJlIiwiZW1haWxUZW1wbGF0ZXMiLCJ0ZW1wbGF0ZUlkIiwiZGF0YSIsInN5cyIsIl9pZCIsImtleSIsInZhbHVlIiwidG9rZW5zIiwidG9rZW4iLCJ1c2VySWQiLCJyZWZlcmVuY2VzIiwidXNlcnMiLCJvbkRlbGV0ZSIsInZhbGlkVW50aWwiLCJ0b2tlbnNSZWxhdGlvbnMiLCJvbmUiLCJ1c2VyIiwiZmllbGRzIiwidXNlclJvbGVzIiwiZGVzY3JpcHRpb24iLCJyb2xlc1JlbGF0aW9ucyIsIm1hbnkiLCJsYW5ndWFnZXMiLCJpc28iLCJjcmVhdGVkQXQiLCJkZWZhdWx0Tm93IiwidXBkYXRlZEF0IiwiJG9uVXBkYXRlIiwiRGF0ZSIsImRlbGV0ZWRBdCIsInJvbGUiLCJlbWFpbCIsInBhc3N3b3JkIiwiZGlzcGxheU5hbWUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImF2YXRhciIsImF2YXRhcl9zbSIsImF2YXRhcl9tZCIsImFjdGl2YXRpb25EYXRlIiwibGFzdExvZ2luRGF0ZSIsInRhYmxlIiwic2VhcmNoSW5kZXgiLCJ1c2luZyIsInVzZXJzUmVsYXRpb25zIiwiYXV0aFRva2VucyIsImF1dGhDbGllbnRzIiwiZmlsZXMiLCJjbGllbnRJZCIsImNsaWVudFRva2VuIiwiYXV0aENsaWVudHNSZWxhdGlvbnMiLCJhcGlLZXlzIiwiYXBpS2V5SWQiLCJhcGlLZXkiLCIkZGVmYXVsdEZuIiwic2l0ZXMiLCJzaXRlSWQiLCJsaW5rIiwidHlwZSIsImVudiIsImhvc3BpdGFscyIsImhvc3BpdGFsSWQiLCJvbGRIb3NwaXRhbElkIiwiY291bnRyeSIsImVkaXRvckluZm8iLCJkYXRhVmVyc2lvbiIsImxhc3RQdWJsaXNoRGF0ZSIsImRldmljZXMiLCJkZXZpY2VJZCIsImRldmljZUhhc2giLCJkZXRhaWxzIiwiZmlsZUlkIiwib3duZXJJZCIsImZpbGVuYW1lIiwiY29udGVudFR5cGUiLCJzaXplIiwibWV0YWRhdGEiLCJmaWxlc1JlbGF0aW9ucyIsIm93bmVyIiwiZmlsZXNDaHVua3MiLCJjaHVua0lkIiwiY29uZmlnS2V5cyIsImNvbmZpZ0tleUlkIiwib2xkQ29uZmlnS2V5SWQiLCJwb3NpdGlvbiIsInZlcnNpb24iLCJsYWJlbCIsInN1bW1hcnkiLCJzb3VyY2UiLCJwcmVmZXJlbmNlcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJwdWJsaXNoRGF0ZSIsImNvbmZpZ0tleXNSZWxhdGlvbnMiLCJoaXN0b3J5IiwiY29uZmlnS2V5c0hpc3RvcnkiLCJkcmFmdCIsImNvbmZpZ0tleXNEcmFmdHMiLCJjb25maWdLZXlEcmFmdElkIiwiJHR5cGUiLCJjb25maWdLZXlzRHJhZnRzUmVsYXRpb25zIiwiY29uZmlnS2V5IiwicmVzdG9yZUtleSIsImNoYW5nZXMiLCJjb25maWdLZXlzSGlzdG9yeVJlbGF0aW9ucyIsInNjcmlwdHMiLCJzY3JpcHRJZCIsIm9sZFNjcmlwdElkIiwidGl0bGUiLCJwcmludFRpdGxlIiwiZXhwb3J0YWJsZSIsIm51aWRTZWFyY2hFbmFibGVkIiwibnVpZFNlYXJjaEZpZWxkcyIsInNjcmlwdHNSZWxhdGlvbnMiLCJzY3JlZW5zIiwic2NyZWVuc0RyYWZ0cyIsInNjcmVlbnNIaXN0b3J5IiwiZGlhZ25vc2VzIiwiZGlhZ25vc2VzRHJhZnRzIiwiZGlhZ25vc2VzSGlzdG9yeSIsInNjcmlwdHNIaXN0b3J5Iiwic2NyaXB0c0RyYWZ0cyIsInNjcmlwdERyYWZ0SWQiLCJzY3JpcHRzRHJhZnRzUmVsYXRpb25zIiwic2NyaXB0Iiwic2NyaXB0c0hpc3RvcnlSZWxhdGlvbnMiLCJzY3JlZW5JZCIsIm9sZFNjcmVlbklkIiwic2VjdGlvblRpdGxlIiwicHJldmlld1RpdGxlIiwicHJldmlld1ByaW50VGl0bGUiLCJjb25kaXRpb24iLCJlcGljSWQiLCJzdG9yeUlkIiwicmVmSWQiLCJyZWZLZXkiLCJzdGVwIiwiYWN0aW9uVGV4dCIsImNvbnRlbnRUZXh0IiwiaW5mb1RleHQiLCJ0aXRsZTEiLCJ0aXRsZTIiLCJ0aXRsZTMiLCJ0aXRsZTQiLCJ0ZXh0MSIsInRleHQyIiwidGV4dDMiLCJpbWFnZTEiLCJpbWFnZTIiLCJpbWFnZTMiLCJpbnN0cnVjdGlvbnMiLCJpbnN0cnVjdGlvbnMyIiwiaW5zdHJ1Y3Rpb25zMyIsImluc3RydWN0aW9uczQiLCJoY3dEaWFnbm9zZXNJbnN0cnVjdGlvbnMiLCJzdWdnZXN0ZWREaWFnbm9zZXNJbnN0cnVjdGlvbnMiLCJub3RlcyIsImRhdGFUeXBlIiwibmVnYXRpdmVMYWJlbCIsInBvc2l0aXZlTGFiZWwiLCJ0aW1lclZhbHVlIiwibXVsdGlwbGllciIsIm1pblZhbHVlIiwibWF4VmFsdWUiLCJwcmludGFibGUiLCJza2lwcGFibGUiLCJjb25maWRlbnRpYWwiLCJwcmVQb3B1bGF0ZSIsIml0ZW1zIiwic2NyZWVuc1JlbGF0aW9ucyIsInNjcmVlbkRyYWZ0SWQiLCJzY3JlZW5zRHJhZnRzUmVsYXRpb25zIiwic2NyZWVuIiwic2NyaXB0RHJhZnQiLCJzY3JlZW5zSGlzdG9yeVJlbGF0aW9ucyIsImRpYWdub3Npc0lkIiwib2xkRGlhZ25vc2lzSWQiLCJleHByZXNzaW9uIiwic2V2ZXJpdHlPcmRlciIsImV4cHJlc3Npb25NZWFuaW5nIiwic3ltcHRvbXMiLCJkaWFnbm9zZXNSZWxhdGlvbnMiLCJkaWFnbm9zaXNEcmFmdElkIiwiZGlhZ25vc2VzRHJhZnRzUmVsYXRpb25zIiwiZGlhZ25vc2lzIiwiZGlhZ25vc2VzSGlzdG9yeVJlbGF0aW9ucyIsInBlbmRpbmdEZWxldGlvbiIsInNjcmVlblNjcmlwdElkIiwiZGlhZ25vc2lzU2NyaXB0SWQiLCJwZW5kaW5nRGVsZXRpb25SZWxhdGlvbnMiLCJzY3JlZW5TY3JpcHQiLCJkaWFnbm9zaXNTY3JpcHQiLCJzY3JlZW5EcmFmdCIsImRpYWdub3Npc0RyYWZ0IiwiY29uZmlnS2V5RHJhZnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/pg/schema/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/_config-keys-drafts.ts":
/*!**************************************************!*\
  !*** ./databases/queries/_config-keys-drafts.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countConfigKeysDrafts: () => (/* binding */ _countConfigKeysDrafts),\n/* harmony export */   _getConfigKeyDraft: () => (/* binding */ _getConfigKeyDraft),\n/* harmony export */   _getConfigKeyDraftMini: () => (/* binding */ _getConfigKeyDraftMini),\n/* harmony export */   _getConfigKeysDrafts: () => (/* binding */ _getConfigKeysDrafts),\n/* harmony export */   _getConfigKeysDraftsDefaultResults: () => (/* binding */ _getConfigKeysDraftsDefaultResults),\n/* harmony export */   _getFullConfigKeyDraft: () => (/* binding */ _getFullConfigKeyDraft)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\nasync function _countConfigKeysDrafts(opts) {\n    const where = opts?.firstVersion ? [\n        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyId)\n    ] : [];\n    if (opts?.configKeysDraftsIds) where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, opts.configKeysDraftsIds));\n    if (opts?.configKeysIds) where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyId, opts.configKeysIds));\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts);\n    if (where.length) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where));\n    const res = await q.execute();\n    return res[0]?.count || 0;\n}\nasync function _getConfigKeyDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            configKeyDraftId: true,\n            configKeyId: true,\n            data: true\n        }\n    });\n}\nasync function _getConfigKeyDraftMini(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            configKeyDraftId: true,\n            configKeyId: true,\n            data: true\n        }\n    });\n}\nasync function _getFullConfigKeyDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findFirst({\n        where\n    });\n}\nasync function __getConfigKeysDrafts({ limit, page = 1, configKeyDraftIds, searchValue, withoutConfigKeyId }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (configKeyDraftIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyDraftId, configKeyDraftIds));\n    if (withoutConfigKeyId) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.configKeyId));\n    searchValue = `${searchValue || \"\"}`.trim();\n    // if (searchValue) {\n    //     const search = ['%', searchValue, '%'].join('');\n    //     conditions.push(sql`json_array_elements(content->data) like LOWER(${search})`);\n    // }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const data = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.configKeysDrafts.findMany({\n        where: conditions.length ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions) : undefined,\n        limit: (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : limit,\n        orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.configKeysDrafts.id),\n        offset,\n        columns: {\n            id: true,\n            configKeyDraftId: true,\n            configKeyId: true,\n            data: true\n        }\n    });\n    return {\n        page,\n        limit,\n        data: data.map(({ data, id, configKeyId, configKeyDraftId })=>({\n                ...data,\n                id,\n                configKeyDraftId,\n                publishedVersion: !configKeyId ? null : Math.max(1, data.version - 1)\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getConfigKeysDraftsDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getConfigKeysDrafts(params) {\n    let rslts = _getConfigKeysDraftsDefaultResults;\n    try {\n        rslts = await __getConfigKeysDrafts({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getConfigKeyDrafts ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9fY29uZmlnLWtleXMtZHJhZnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMEU7QUFFbEM7QUFDVDtBQUNpQjtBQUNkO0FBRTNCLGVBQWVVLHVCQUF1QkMsSUFLNUM7SUFDRyxNQUFNQyxRQUFRRCxNQUFNRSxlQUFlO1FBQUNSLG1EQUFNQSxDQUFDRyx3REFBZ0JBLENBQUNNLFdBQVc7S0FBRSxHQUFHLEVBQUU7SUFDOUUsSUFBSUgsTUFBTUkscUJBQXFCSCxNQUFNSSxJQUFJLENBQUNiLG9EQUFPQSxDQUFDSyx3REFBZ0JBLENBQUNTLGdCQUFnQixFQUFFTixLQUFLSSxtQkFBbUI7SUFDN0csSUFBSUosTUFBTU8sZUFBZU4sTUFBTUksSUFBSSxDQUFDYixvREFBT0EsQ0FBQ0ssd0RBQWdCQSxDQUFDTSxXQUFXLEVBQUVILEtBQUtPLGFBQWE7SUFFNUYsTUFBTUMsSUFBSVosbURBQUVBLENBQ1BhLE1BQU0sQ0FBQztRQUFFbEIsT0FBT0Esa0RBQUtBO0lBQUksR0FDekJtQixJQUFJLENBQUNiLHdEQUFnQkE7SUFFMUIsSUFBSUksTUFBTVUsTUFBTSxFQUFFSCxFQUFFUCxLQUFLLENBQUNYLGdEQUFHQSxJQUFJVztJQUVqQyxNQUFNVyxNQUFNLE1BQU1KLEVBQUVLLE9BQU87SUFFM0IsT0FBT0QsR0FBRyxDQUFDLEVBQUUsRUFBRXJCLFNBQVM7QUFDNUI7QUFJTyxlQUFldUIsbUJBQW1CQyxNQUErQjtJQUNwRSxNQUFNZCxRQUFRWiwrQ0FBRUEsQ0FBQ1Esd0RBQWdCQSxDQUFDUyxnQkFBZ0IsRUFBRVM7SUFDcEQsT0FBTyxNQUFNbkIsbURBQUVBLENBQUNvQixLQUFLLENBQUNuQixnQkFBZ0IsQ0FBQ29CLFNBQVMsQ0FBQztRQUM3Q2hCO1FBQ0FpQixTQUFTO1lBQ0xDLElBQUk7WUFDSmIsa0JBQWtCO1lBQ2xCSCxhQUFhO1lBQ2JpQixNQUFNO1FBQ1Y7SUFDSjtBQUNKO0FBRU8sZUFBZUMsdUJB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TyxNQUFNTyxxQ0FBcUM7SUFDOUNyQixNQUFNO0lBQ05ELE9BQU9lO0lBQ1BMLFdBQVc7SUFDWEMsWUFBWTtJQUNaZixNQUFNLEVBQUU7SUFDUk8sYUFBYVk7SUFDYk0sT0FBT047QUFDWCxFQUF1RDtBQUVoRCxlQUFlUSxxQkFBcUJoQyxNQUFrQztJQUN6RSxJQUFJaUMsUUFBUUY7SUFFWixJQUFJO1FBQ0FFLFFBQVEsTUFBTXpCLHNCQUFzQjtZQUFFLEdBQUdSLE1BQU07UUFBQztJQUNwRCxFQUFFLE9BQU1rQyxHQUFRO1FBQ1puRCxtREFBTUEsQ0FBQytDLEtBQUssQ0FBQyw2QkFBNkJJO1FBQzFDRCxNQUFNSCxLQUFLLEdBQUdJLEVBQUVDLE9BQU87SUFDM0IsU0FBVTtRQUNOLE9BQU9GO0lBQ1g7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvX2NvbmZpZy1rZXlzLWRyYWZ0cy50cz8wNjhmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVxLCBhbmQsIFNRTCwgY291bnQsIGluQXJyYXksIGRlc2MsIGlzTnVsbCwgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gXCJAL2xpYi9pc0VtcHR5XCI7XG5pbXBvcnQgZGIgZnJvbSBcIi4uL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IGNvbmZpZ0tleXNEcmFmdHMgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9jb3VudENvbmZpZ0tleXNEcmFmdHMob3B0cz86IHtcbiAgICBmaXJzdFZlcnNpb24/OiBib29sZWFuO1xuICAgIHZlcnNpb24/OiBib29sZWFuO1xuICAgIGNvbmZpZ0tleXNJZHM/OiBzdHJpbmdbXTtcbiAgICBjb25maWdLZXlzRHJhZnRzSWRzPzogc3RyaW5nW107XG59KSB7XG4gICAgY29uc3Qgd2hlcmUgPSBvcHRzPy5maXJzdFZlcnNpb24gPyBbaXNOdWxsKGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5SWQpXSA6IFtdO1xuICAgIGlmIChvcHRzPy5jb25maWdLZXlzRHJhZnRzSWRzKSB3aGVyZS5wdXNoKGluQXJyYXkoY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlEcmFmdElkLCBvcHRzLmNvbmZpZ0tleXNEcmFmdHNJZHMpKTtcbiAgICBpZiAob3B0cz8uY29uZmlnS2V5c0lkcykgd2hlcmUucHVzaChpbkFycmF5KGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5SWQsIG9wdHMuY29uZmlnS2V5c0lkcykpO1xuXG4gICAgY29uc3QgcSA9IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSlcbiAgICAgICAgLmZyb20oY29uZmlnS2V5c0RyYWZ0cyk7XG5cbiAgICBpZiAod2hlcmUubGVuZ3RoKSBxLndoZXJlKGFuZCguLi53aGVyZSkpO1xuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcS5leGVjdXRlKCk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8uY291bnQgfHwgMDtcbn1cblxuZXhwb3J0IHR5cGUgR2V0Q29uZmlnS2V5RHJhZnRQYXJhbXMgPSBzdHJpbmc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0Q29uZmlnS2V5RHJhZnQocGFyYW1zOiBHZXRDb25maWdLZXlEcmFmdFBhcmFtcykge1xuICAgIGNvbnN0IHdoZXJlID0gZXEoY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlEcmFmdElkLCBwYXJhbXMpO1xuICAgIHJldHVybiBhd2FpdCBkYi5xdWVyeS5jb25maWdLZXlzRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICBjb25maWdLZXlJZDogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0Q29uZmlnS2V5RHJhZnRNaW5pKHBhcmFtczogR2V0Q29uZmlnS2V5RHJhZnRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IGVxKGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5RHJhZnRJZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBjb25maWdLZXlEcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlnS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldEZ1bGxDb25maWdLZXlEcmFmdChwYXJhbXM6IEdldENvbmZpZ0tleURyYWZ0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSBlcShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIHBhcmFtcyk7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmUsXG4gICAgfSk7XG59XG5cbmV4cG9ydCB0eXBlIEdldENvbmZpZ0tleXNEcmFmdHNQYXJhbXMgPSB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgY29uZmlnS2V5RHJhZnRJZHM/OiBzdHJpbmdbXTtcbiAgICBzZWFyY2hWYWx1ZT86IHN0cmluZztcbiAgICB3aXRob3V0Q29uZmlnS2V5SWQ/OiBib29sZWFuO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gX19nZXRDb25maWdLZXlzRHJhZnRzKHtcbiAgICBsaW1pdCxcbiAgICBwYWdlID0gMSxcbiAgICBjb25maWdLZXlEcmFmdElkcyxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICB3aXRob3V0Q29uZmlnS2V5SWQsXG59OiBHZXRDb25maWdLZXlzRHJhZnRzUGFyYW1zKSB7XG4gICAgcGFnZSA9IE1hdGgubWF4KDAsIHBhZ2UpO1xuXG4gICAgY29uc3QgY29uZGl0aW9uczogU1FMW10gPSBbXTtcblxuICAgIGlmIChjb25maWdLZXlEcmFmdElkcz8ubGVuZ3RoKSBjb25kaXRpb25zLnB1c2goaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleURyYWZ0SWRzKSk7XG5cbiAgICBpZiAod2l0aG91dENvbmZpZ0tleUlkKSBjb25kaXRpb25zLnB1c2goaXNOdWxsKGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5SWQpKTtcblxuICAgIHNlYXJjaFZhbHVlID0gYCR7c2VhcmNoVmFsdWUgfHwgJyd9YC50cmltKCk7XG4gICAgLy8gaWYgKHNlYXJjaFZhbHVlKSB7XG4gICAgLy8gICAgIGNvbnN0IHNlYXJjaCA9IFsnJScsIHNlYXJjaFZhbHVlLCAnJSddLmpvaW4oJycpO1xuICAgIC8vICAgICBjb25kaXRpb25zLnB1c2goc3FsYGpzb25fYXJyYXlfZWxlbWVudHMoY29udGVudC0+ZGF0YSkgbGlrZSBMT1dFUigke3NlYXJjaH0pYCk7XG4gICAgLy8gfVxuXG4gICAgY29uc3QgY291bnRRdWVyeSA9IGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KS5mcm9tKGNvbmZpZ0tleXNEcmFmdHMpO1xuICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCkgY291bnRRdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gICAgY29uc3QgW3sgY291bnQ6IHRvdGFsUm93cywgfV0gPSBhd2FpdCBjb3VudFF1ZXJ5LmV4ZWN1dGUoKTtcblxuICAgIGxldCB0b3RhbFBhZ2VzID0gMTtcbiAgICBpZiAodG90YWxSb3dzKXtcbiAgICAgICAgdG90YWxQYWdlcyA9IGlzRW1wdHkobGltaXQpID8gMSA6IE1hdGguY2VpbCh0b3RhbFJvd3MgLyBsaW1pdCEpO1xuICAgICAgICBwYWdlID0gTWF0aC5taW4ocGFnZSwgdG90YWxQYWdlcyk7XG4gICAgfVxuXG4gICAgY29uc3Qgb2Zmc2V0ID0gaXNFbXB0eShsaW1pdCkgPyB1bmRlZmluZWQgOiBNYXRoLm1heCgwLCAocGFnZSAtIDEpICogbGltaXQhKTtcblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBkYi5xdWVyeS5jb25maWdLZXlzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IGNvbmRpdGlvbnMubGVuZ3RoID8gYW5kKC4uLmNvbmRpdGlvbnMpIDogdW5kZWZpbmVkLFxuICAgICAgICBsaW1pdDogaXNFbXB0eShsaW1pdCkgPyB1bmRlZmluZWQgOiBsaW1pdCEsXG4gICAgICAgIG9yZGVyQnk6IGRlc2MoY29uZmlnS2V5c0RyYWZ0cy5pZCksXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBjb25maWdLZXlEcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlnS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIGRhdGE6IGRhdGEubWFwKCh7IGRhdGEsIGlkLCBjb25maWdLZXlJZCwgY29uZmlnS2V5RHJhZnRJZCwgfSkgPT4gKHtcbiAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIGNvbmZpZ0tleURyYWZ0SWQsXG4gICAgICAgICAgICBwdWJsaXNoZWRWZXJzaW9uOiAhY29uZmlnS2V5SWQgPyBudWxsIDogTWF0aC5tYXgoMSwgZGF0YS52ZXJzaW9uIC0gMSksXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWxSb3dzLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICB9O1xufVxuXG5leHBvcnQgY29uc3QgX2dldENvbmZpZ0tleXNEcmFmdHNEZWZhdWx0UmVzdWx0cyA9IHtcbiAgICBwYWdlOiAxLFxuICAgIGxpbWl0OiB1bmRlZmluZWQsXG4gICAgdG90YWxSb3dzOiAwLFxuICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgZGF0YTogW10sXG4gICAgc2VhcmNoVmFsdWU6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICBlcnJvcjogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxufSBhcyBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9fZ2V0Q29uZmlnS2V5c0RyYWZ0cz4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldENvbmZpZ0tleXNEcmFmdHMocGFyYW1zPzogR2V0Q29uZmlnS2V5c0RyYWZ0c1BhcmFtcykge1xuICAgIGxldCByc2x0cyA9IF9nZXRDb25maWdLZXlzRHJhZnRzRGVmYXVsdFJlc3VsdHM7XG5cbiAgICB0cnkge1xuICAgICAgICByc2x0cyA9IGF3YWl0IF9fZ2V0Q29uZmlnS2V5c0RyYWZ0cyh7IC4uLnBhcmFtcyB9KTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXRDb25maWdLZXlEcmFmdHMgRVJST1InLCBlKTtcbiAgICAgICAgcnNsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJzbHRzO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJlcSIsImFuZCIsImNvdW50IiwiaW5BcnJheSIsImRlc2MiLCJpc051bGwiLCJpc0VtcHR5IiwiZGIiLCJjb25maWdLZXlzRHJhZnRzIiwibG9nZ2VyIiwiX2NvdW50Q29uZmlnS2V5c0RyYWZ0cyIsIm9wdHMiLCJ3aGVyZSIsImZpcnN0VmVyc2lvbiIsImNvbmZpZ0tleUlkIiwiY29uZmlnS2V5c0RyYWZ0c0lkcyIsInB1c2giLCJjb25maWdLZXlEcmFmdElkIiwiY29uZmlnS2V5c0lkcyIsInEiLCJzZWxlY3QiLCJmcm9tIiwibGVuZ3RoIiwicmVzIiwiZXhlY3V0ZSIsIl9nZXRDb25maWdLZXlEcmFmdCIsInBhcmFtcyIsInF1ZXJ5IiwiZmluZEZpcnN0IiwiY29sdW1ucyIsImlkIiwiZGF0YSIsIl9nZXRDb25maWdLZXlEcmFmdE1pbmkiLCJfZ2V0RnVsbENvbmZpZ0tleURyYWZ0IiwiX19nZXRDb25maWdLZXlzRHJhZnRzIiwibGltaXQiLCJwYWdlIiwiY29uZmlnS2V5RHJhZnRJZHMiLCJzZWFyY2hWYWx1ZSIsIndpdGhvdXRDb25maWdLZXlJZCIsIk1hdGgiLCJtYXgiLCJjb25kaXRpb25zIiwidHJpbSIsImNvdW50UXVlcnkiLCJ0b3RhbFJvd3MiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsIm1pbiIsIm9mZnNldCIsInVuZGVmaW5lZCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm1hcCIsInB1Ymxpc2hlZFZlcnNpb24iLCJ2ZXJzaW9uIiwiZXJyb3IiLCJfZ2V0Q29uZmlnS2V5c0RyYWZ0c0RlZmF1bHRSZXN1bHRzIiwiX2dldENvbmZpZ0tleXNEcmFmdHMiLCJyc2x0cyIsImUiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/_config-keys-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/_config-keys.ts":
/*!*******************************************!*\
  !*** ./databases/queries/_config-keys.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countConfigKeys: () => (/* binding */ _countConfigKeys),\n/* harmony export */   _getConfigKey: () => (/* binding */ _getConfigKey),\n/* harmony export */   _getConfigKeyMini: () => (/* binding */ _getConfigKeyMini),\n/* harmony export */   _getConfigKeyWithDraft: () => (/* binding */ _getConfigKeyWithDraft),\n/* harmony export */   _getConfigKeys: () => (/* binding */ _getConfigKeys),\n/* harmony export */   _getConfigKeysDefaultResults: () => (/* binding */ _getConfigKeysDefaultResults),\n/* harmony export */   _getFullConfigKey: () => (/* binding */ _getFullConfigKey),\n/* harmony export */   _getLastConfigKeyPosition: () => (/* binding */ _getLastConfigKeyPosition),\n/* harmony export */   _listConfigKeys: () => (/* binding */ _listConfigKeys),\n/* harmony export */   _listRawConfigKeys: () => (/* binding */ _listRawConfigKeys)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/validate.js\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\n\nasync function _listConfigKeys(configKeysReferences) {\n    const results = {\n        data: []\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeysDrafts.findMany({\n            where: !configKeysReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyId, configKeysReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyDraftId, configKeysReferences)),\n            columns: {\n                configKeyId: true,\n                configKeyDraftId: true,\n                data: true\n            }\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, drafts.map((s)=>s.data.configKeyId))\n                ]\n            ]),\n            columns: {\n                configKeyId: true,\n                position: true,\n                label: true\n            }\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>({\n                    configKeyReference: s.configKeyDraftId,\n                    configKeyId: s.configKeyId,\n                    configKeyDraftId: s.configKeyDraftId,\n                    isDraft: true,\n                    label: s.data.label,\n                    position: s.data.position\n                }))\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    configKeyReference: s.configKeyId,\n                    configKeyId: s.configKeyId,\n                    isDraft: false,\n                    label: s.label,\n                    position: s.position\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listConfigKeys ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _listRawConfigKeys(configKeysReferences) {\n    const results = {\n        data: []\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeysDrafts.findMany({\n            where: !configKeysReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyId, configKeysReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyDraftId, configKeysReferences))\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, drafts.map((s)=>s.data.configKeyId))\n                ]\n            ])\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>{\n                return {\n                    ...s.data,\n                    configKeyReference: s.configKeyDraftId,\n                    configKeyId: s.configKeyId || undefined,\n                    configKeyDraftId: s.configKeyDraftId,\n                    isDraft: true\n                };\n            })\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    ...s,\n                    configKeyReference: s.configKeyId,\n                    configKeyId: s.configKeyId,\n                    isDraft: false\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listRawConfigKeys ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _getLastConfigKeyPosition() {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.position\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt)).limit(1).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.position));\n    return res[0]?.position || 0;\n}\nasync function _countConfigKeys(opts) {\n    const { withArchived } = {\n        ...opts\n    };\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys);\n    if (!withArchived) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt));\n    const res = await q.execute();\n    return res[0]?.count;\n}\nasync function _getConfigKey(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.oldConfigKeyId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt)),\n        columns: {\n            id: true,\n            configKeyId: true,\n            oldConfigKeyId: true,\n            label: true,\n            key: true,\n            summary: true,\n            version: true,\n            position: true\n        }\n    });\n}\nasync function _getConfigKeyWithDraft(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.oldConfigKeyId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt)),\n        columns: {\n            id: true,\n            configKeyId: true,\n            oldConfigKeyId: true,\n            label: true,\n            key: true,\n            summary: true,\n            version: true,\n            position: true\n        },\n        with: {\n            draft: true,\n            history: true\n        }\n    });\n}\nasync function _getConfigKeyMini(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.oldConfigKeyId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt)),\n        columns: {\n            id: true,\n            configKeyId: true,\n            oldConfigKeyId: true,\n            label: true,\n            key: true,\n            summary: true,\n            version: true,\n            position: true\n        }\n    });\n}\nasync function _getFullConfigKey(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.oldConfigKeyId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.configKeys.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt))\n    });\n}\nasync function __getConfigKeys({ limit, page = 1, configKeyIds, searchValue, archived }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (archived) {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt));\n    } else {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.deletedAt));\n    }\n    if (configKeyIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, configKeyIds));\n    searchValue = `${searchValue || \"\"}`.trim();\n    if (searchValue) {\n        const search = [\n            \"%\",\n            searchValue,\n            \"%\"\n        ].join(\"\");\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.sql)`LOWER(configKeys.name) like LOWER(${search})`);\n    }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        id: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.id,\n        configKeyId: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId,\n        oldConfigKeyId: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.oldConfigKeyId,\n        label: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.label,\n        key: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.key,\n        summary: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.summary,\n        version: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.version,\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.position,\n        configKeyDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyDraftId\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys).leftJoin(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.configKeyId, _pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.configKeyId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.id));\n    if (!(0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit)) q.limit(limit);\n    if (offset) q.offset(offset);\n    if (conditions.length) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const data = await q.execute();\n    return {\n        page,\n        limit,\n        data: data.map((c)=>({\n                ...c,\n                publishedVersion: c.version\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getConfigKeysDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getConfigKeys(params) {\n    let rslts = _getConfigKeysDefaultResults;\n    try {\n        rslts = await __getConfigKeys({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getConfigKeys ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9fY29uZmlnLWtleXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF5RztBQUM1RTtBQUVFO0FBQzZCO0FBQ3BCO0FBRU47QUFFM0IsZUFBZWdCLGdCQUFnQkMsb0JBQStCO0lBQ2pFLE1BQU1DLFVBWUY7UUFDQUMsTUFBTSxFQUFFO0lBQ1o7SUFFQSxJQUFJO1FBQ0EsTUFBTUMsU0FBUyxNQUFNVCxtREFBRUEsQ0FBQ1UsS0FBSyxDQUFDUixnQkFBZ0IsQ0FBQ1MsUUFBUSxDQUFDO1lBQ3BEQyxPQUFPLENBQUNOLHNCQUFzQk8sU0FBU0MsWUFBWWhCLCtDQUFFQSxDQUNqREwsb0RBQU9BLENBQUNTLHdEQUFnQkEsQ0FBQ2EsV0FBVyxFQUFFVCx1QkFDdENiLG9EQUFPQSxDQUFDUyx3REFBZ0JBLENBQUNjLGdCQUFnQixFQUFFVjtZQUUvQ1csU0FBUztnQkFDTEYsYUFBYTtnQkFDYkMsa0JBQWtCO2dCQUNsQlIsTUFBTTtZQUNWO1FBQ0o7UUFFQSxNQUFNVSxZQUFZLE1BQU1sQixtREFBRUEsQ0FBQ1UsS0FBSyxDQUFDVCxVQUFVLENBQUNVLFFBQVEsQ0FBQztZQUNqREMsT0FBT3RCLGdEQUFHQSxJQUFJO2dCQUNWQyxtREFBTUEsQ0FBQ1Usa0RBQVVBLENBQUNrQixTQUFTO21CQUN2QixDQUFDVixPQUFPSSxNQUFNLEdBQUcsRUFBRSxHQUFHO29CQUFDaEIsdURBQVVBLENBQUNJLGtEQUFVQSxDQUFDYyxXQUFXLEVBQUVOLE9BQU9XLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRWIsSUFBSSxDQUFDTyxXQUFXO2lCQUFJO2FBQ3ZHO1lBQ0RFLFNBQVM7Z0JBQ0xGLGFBQWE7Z0JBQ2JPLFVBQVU7Z0JBQ1ZDLE9BQU87WUFDWDtRQUNKO1FBRUFoQixRQUFRQyxJQUFJLEdBQUc7ZUFBSUQsUUFBUUMsSUFBSTtlQUFLQyxPQUFPVyxHQUFHLENBQUNDLENBQUFBLElBQU07b0JBQ2pERyxvQkFB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QU8sQ0FBQzVDLGlEQUFJQSxDQUFDTyxrREFBVUEsQ0FBQ2dELEVBQUU7SUFFL0IsSUFBSSxDQUFDOUMscURBQU9BLENBQUNrQyxRQUFRSyxFQUFFTCxLQUFLLENBQUNBO0lBRTdCLElBQUl1QyxRQUFRbEMsRUFBRWtDLE1BQU0sQ0FBQ0E7SUFFckIsSUFBSVYsV0FBV3JELE1BQU0sRUFBRTZCLEVBQUU5QixLQUFLLENBQUN0QixnREFBR0EsSUFBSTRFO0lBRXRDLE1BQU0xRCxPQUFPLE1BQU1rQyxFQUFFQyxPQUFPO0lBRTVCLE9BQU87UUFDSGlCO1FBQ0F2QjtRQUNBN0IsTUFBTUEsS0FBS1ksR0FBRyxDQUFDMEQsQ0FBQUEsSUFBTTtnQkFDakIsR0FBR0EsQ0FBQztnQkFDSkMsa0JBQWtCRCxFQUFFMUIsT0FBTztZQUMvQjtRQUNBb0I7UUFDQUM7UUFDQVg7UUFDQWhDLE9BQU9oQjtJQUNYO0FBQ0o7QUFFTyxNQUFNa0UsK0JBQStCO0lBQ3hDcEIsTUFBTTtJQUNOdkIsT0FBT3ZCO0lBQ1AwRCxXQUFXO0lBQ1hDLFlBQVk7SUFDWmpFLE1BQU0sRUFBRTtJQUNSc0QsYUFBYWhEO0lBQ2JnQixPQUFPaEI7QUFDWCxFQUFpRDtBQUUxQyxlQUFlbUUsZUFBZXBDLE1BQTRCO0lBQzdELElBQUlxQyxRQUFRRjtJQUVaLElBQUk7UUFDQUUsUUFBUSxNQUFNdkIsZ0JBQWdCO1lBQUUsR0FBR2QsTUFBTTtRQUFDO0lBQzlDLEVBQUUsT0FBTWhCLEdBQVE7UUFDWnpCLG1EQUFNQSxDQUFDMEIsS0FBSyxDQUFDLHdCQUF3QkQ7UUFDckNxRCxNQUFNcEQsS0FBSyxHQUFHRCxFQUFFRSxPQUFPO0lBQzNCLFNBQVU7UUFDTixPQUFPbUQ7SUFDWDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcXVlcmllcy9fY29uZmlnLWtleXMudHM/MDM3NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcSwgYW5kLCBpc051bGwsIFNRTCwgY291bnQsIGluQXJyYXksIGRlc2MsIHNxbCwgaXNOb3ROdWxsLCBub3RJbkFycmF5LCBvciB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0ICogYXMgdXVpZCBmcm9tICd1dWlkJztcblxuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBjb25maWdLZXlzLCBjb25maWdLZXlzRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gXCJAL2xpYi9pc0VtcHR5XCI7XG5pbXBvcnQgeyBfZ2V0Q29uZmlnS2V5c0RyYWZ0cyB9IGZyb20gXCIuL19jb25maWcta2V5cy1kcmFmdHNcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2xpc3RDb25maWdLZXlzKGNvbmZpZ0tleXNSZWZlcmVuY2VzPzogc3RyaW5nW10pIHtcbiAgICBjb25zdCByZXN1bHRzOiB7XG4gICAgICAgIGVycm9yPzogc3RyaW5nO1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBjb25maWdLZXlSZWZlcmVuY2U6IHN0cmluZztcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICAgIGNvbmZpZ0tleURyYWZ0SWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgICAgICAgc2NyaXB0SWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZD86IHN0cmluZyB8IG51bGw7XG4gICAgICAgICAgICBpc0RyYWZ0OiBib29sZWFuO1xuICAgICAgICAgICAgbGFiZWw6IHN0cmluZztcbiAgICAgICAgICAgIHBvc2l0aW9uOiBudW1iZXI7XG4gICAgICAgIH1bXTtcbiAgICB9ID0ge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZHJhZnRzID0gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5c0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogIWNvbmZpZ0tleXNSZWZlcmVuY2VzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBvcihcbiAgICAgICAgICAgICAgICBpbkFycmF5KGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5SWQsIGNvbmZpZ0tleXNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICBpbkFycmF5KGNvbmZpZ0tleXNEcmFmdHMuY29uZmlnS2V5RHJhZnRJZCwgY29uZmlnS2V5c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgICAgICBjb25maWdLZXlJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25maWdLZXlEcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRhdGE6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBwdWJsaXNoZWQgPSBhd2FpdCBkYi5xdWVyeS5jb25maWdLZXlzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiBhbmQoLi4uW1xuICAgICAgICAgICAgICAgIGlzTnVsbChjb25maWdLZXlzLmRlbGV0ZWRBdCksXG4gICAgICAgICAgICAgICAgLi4uKCFkcmFmdHMubGVuZ3RoID8gW10gOiBbbm90SW5BcnJheShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBkcmFmdHMubWFwKHMgPT4gcy5kYXRhLmNvbmZpZ0tleUlkISkpXSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICAgIGNvbmZpZ0tleUlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhYmVsOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzdWx0cy5kYXRhID0gWy4uLnJlc3VsdHMuZGF0YSwgLi4uZHJhZnRzLm1hcChzID0+ICh7XG4gICAgICAgICAgICBjb25maWdLZXlSZWZlcmVuY2U6IHMuY29uZmlnS2V5RHJhZnRJZCxcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkOiBzLmNvbmZpZ0tleUlkLFxuICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZDogcy5jb25maWdLZXlEcmFmdElkLFxuICAgICAgICAgICAgaXNEcmFmdDogdHJ1ZSxcbiAgICAgICAgICAgIGxhYmVsOiBzLmRhdGEubGFiZWwsXG4gICAgICAgICAgICBwb3NpdGlvbjogcy5kYXRhLnBvc2l0aW9uLFxuICAgICAgICB9KSldO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLnB1Ymxpc2hlZC5tYXAocyA9PiAoe1xuICAgICAgICAgICAgY29uZmlnS2V5UmVmZXJlbmNlOiBzLmNvbmZpZ0tleUlkLFxuICAgICAgICAgICAgY29uZmlnS2V5SWQ6IHMuY29uZmlnS2V5SWQsXG4gICAgICAgICAgICBpc0RyYWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIGxhYmVsOiBzLmxhYmVsLFxuICAgICAgICAgICAgcG9zaXRpb246IHMucG9zaXRpb24sXG4gICAgICAgIH0pKV0uc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2xpc3RDb25maWdLZXlzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfbGlzdFJhd0NvbmZpZ0tleXMoY29uZmlnS2V5c1JlZmVyZW5jZXM/OiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHJlc3VsdHM6IHtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7XG4gICAgICAgIGRhdGE6ICh0eXBlb2YgY29uZmlnS2V5cy4kaW5mZXJTZWxlY3QgJiB7XG4gICAgICAgICAgICBjb25maWdLZXlSZWZlcmVuY2U6IHN0cmluZztcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkPzogc3RyaW5nO1xuICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZD86IHN0cmluZztcbiAgICAgICAgICAgIHNjcmlwdElkPzogc3RyaW5nO1xuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZD86IHN0cmluZztcbiAgICAgICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgIH0pW107XG4gICAgfSA9IHtcbiAgICAgICAgZGF0YTogW10sXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6ICFjb25maWdLZXlzUmVmZXJlbmNlcz8ubGVuZ3RoID8gdW5kZWZpbmVkIDogb3IoXG4gICAgICAgICAgICAgICAgaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleUlkLCBjb25maWdLZXlzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgaW5BcnJheShjb25maWdLZXlzRHJhZnRzLmNvbmZpZ0tleURyYWZ0SWQsIGNvbmZpZ0tleXNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi5bXG4gICAgICAgICAgICAgICAgaXNOdWxsKGNvbmZpZ0tleXMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KGNvbmZpZ0tleXMuY29uZmlnS2V5SWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuY29uZmlnS2V5SWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLmRyYWZ0cy5tYXAocyA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnMuZGF0YSxcbiAgICAgICAgICAgICAgICBjb25maWdLZXlSZWZlcmVuY2U6IHMuY29uZmlnS2V5RHJhZnRJZCxcbiAgICAgICAgICAgICAgICBjb25maWdLZXlJZDogcy5jb25maWdLZXlJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZDogcy5jb25maWdLZXlEcmFmdElkLFxuICAgICAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICB9IGFzIHR5cGVvZiByZXN1bHRzLmRhdGFbMF07XG4gICAgICAgIH0pXTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5wdWJsaXNoZWQubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIC4uLnMsXG4gICAgICAgICAgICBjb25maWdLZXlSZWZlcmVuY2U6IHMuY29uZmlnS2V5SWQsXG4gICAgICAgICAgICBjb25maWdLZXlJZDogcy5jb25maWdLZXlJZCxcbiAgICAgICAgICAgIGlzRHJhZnQ6IGZhbHNlLFxuICAgICAgICB9KSldLnNvcnQoKGEsIGIpID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19saXN0UmF3Q29uZmlnS2V5cyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldExhc3RDb25maWdLZXlQb3NpdGlvbigpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgcG9zaXRpb246IGNvbmZpZ0tleXMucG9zaXRpb24sIH0pXG4gICAgICAgIC5mcm9tKGNvbmZpZ0tleXMpXG4gICAgICAgIC53aGVyZShpc051bGwoY29uZmlnS2V5cy5kZWxldGVkQXQpKVxuICAgICAgICAubGltaXQoMSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhjb25maWdLZXlzLnBvc2l0aW9uKSk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8ucG9zaXRpb24gfHwgMDtcbn0gXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY291bnRDb25maWdLZXlzKG9wdHM/OiB7XG4gICAgd2l0aEFyY2hpdmVkPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB7IHdpdGhBcmNoaXZlZCB9ID0geyAuLi5vcHRzIH07XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShjb25maWdLZXlzKTtcblxuICAgIGlmICghd2l0aEFyY2hpdmVkKSBxLndoZXJlKGlzTnVsbChjb25maWdLZXlzLmRlbGV0ZWRBdCkpO1xuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcS5leGVjdXRlKCk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8uY291bnQ7XG59IFxuXG5leHBvcnQgdHlwZSBHZXRDb25maWdLZXlQYXJhbXMgPSBzdHJpbmc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0Q29uZmlnS2V5KHBhcmFtczogR2V0Q29uZmlnS2V5UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBwYXJhbXMpIDogZXEoY29uZmlnS2V5cy5vbGRDb25maWdLZXlJZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoY29uZmlnS2V5cy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkOiB0cnVlLFxuICAgICAgICAgICAgb2xkQ29uZmlnS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICBsYWJlbDogdHJ1ZSxcbiAgICAgICAgICAgIGtleTogdHJ1ZSxcbiAgICAgICAgICAgIHN1bW1hcnk6IHRydWUsXG4gICAgICAgICAgICB2ZXJzaW9uOiB0cnVlLFxuICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0Q29uZmlnS2V5V2l0aERyYWZ0KHBhcmFtczogR2V0Q29uZmlnS2V5UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBwYXJhbXMpIDogZXEoY29uZmlnS2V5cy5vbGRDb25maWdLZXlJZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoY29uZmlnS2V5cy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkOiB0cnVlLFxuICAgICAgICAgICAgb2xkQ29uZmlnS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICBsYWJlbDogdHJ1ZSxcbiAgICAgICAgICAgIGtleTogdHJ1ZSxcbiAgICAgICAgICAgIHN1bW1hcnk6IHRydWUsXG4gICAgICAgICAgICB2ZXJzaW9uOiB0cnVlLFxuICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIHdpdGg6IHtcbiAgICAgICAgICAgIGRyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgaGlzdG9yeTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRDb25maWdLZXlNaW5pKHBhcmFtczogR2V0Q29uZmlnS2V5UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBwYXJhbXMpIDogZXEoY29uZmlnS2V5cy5vbGRDb25maWdLZXlJZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuY29uZmlnS2V5cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoY29uZmlnS2V5cy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ0tleUlkOiB0cnVlLFxuICAgICAgICAgICAgb2xkQ29uZmlnS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICBsYWJlbDogdHJ1ZSxcbiAgICAgICAgICAgIGtleTogdHJ1ZSxcbiAgICAgICAgICAgIHN1bW1hcnk6IHRydWUsXG4gICAgICAgICAgICB2ZXJzaW9uOiB0cnVlLFxuICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0RnVsbENvbmZpZ0tleShwYXJhbXM6IEdldENvbmZpZ0tleVBhcmFtcykge1xuICAgIGNvbnN0IHdoZXJlID0gdXVpZC52YWxpZGF0ZShwYXJhbXMpID8gZXEoY29uZmlnS2V5cy5jb25maWdLZXlJZCwgcGFyYW1zKSA6IGVxKGNvbmZpZ0tleXMub2xkQ29uZmlnS2V5SWQsIHBhcmFtcyk7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnF1ZXJ5LmNvbmZpZ0tleXMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgaXNOdWxsKGNvbmZpZ0tleXMuZGVsZXRlZEF0KSxcbiAgICAgICAgKSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IHR5cGUgR2V0Q29uZmlnS2V5c1BhcmFtcyA9IHtcbiAgICBsaW1pdD86IG51bWJlcjtcbiAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgcGFnZT86IG51bWJlcjtcbiAgICBjb25maWdLZXlJZHM/OiBzdHJpbmdbXTtcbiAgICBzZWFyY2hWYWx1ZT86IHN0cmluZztcbiAgICBhcmNoaXZlZD86IGJvb2xlYW47XG59O1xuXG5hc3luYyBmdW5jdGlvbiBfX2dldENvbmZpZ0tleXMoe1xuICAgIGxpbWl0LFxuICAgIHBhZ2UgPSAxLFxuICAgIGNvbmZpZ0tleUlkcyxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICBhcmNoaXZlZCxcbn06IEdldENvbmZpZ0tleXNQYXJhbXMpIHtcbiAgICBwYWdlID0gTWF0aC5tYXgoMCwgcGFnZSk7XG5cbiAgICBjb25zdCBjb25kaXRpb25zOiBTUUxbXSA9IFtdO1xuXG4gICAgaWYgKGFyY2hpdmVkKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChpc05vdE51bGwoY29uZmlnS2V5cy5kZWxldGVkQXQpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goaXNOdWxsKGNvbmZpZ0tleXMuZGVsZXRlZEF0KSk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZ0tleUlkcz8ubGVuZ3RoKSBjb25kaXRpb25zLnB1c2goaW5BcnJheShjb25maWdLZXlzLmNvbmZpZ0tleUlkLCBjb25maWdLZXlJZHMpKTtcblxuICAgIHNlYXJjaFZhbHVlID0gYCR7c2VhcmNoVmFsdWUgfHwgJyd9YC50cmltKCk7XG4gICAgaWYgKHNlYXJjaFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IFsnJScsIHNlYXJjaFZhbHVlLCAnJSddLmpvaW4oJycpO1xuICAgICAgICBjb25kaXRpb25zLnB1c2goc3FsYExPV0VSKGNvbmZpZ0tleXMubmFtZSkgbGlrZSBMT1dFUigke3NlYXJjaH0pYCk7XG4gICAgfVxuXG4gICAgY29uc3QgY291bnRRdWVyeSA9IGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KS5mcm9tKGNvbmZpZ0tleXMpO1xuICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCkgY291bnRRdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gICAgY29uc3QgW3sgY291bnQ6IHRvdGFsUm93cywgfV0gPSBhd2FpdCBjb3VudFF1ZXJ5LmV4ZWN1dGUoKTtcblxuICAgIGxldCB0b3RhbFBhZ2VzID0gMTtcbiAgICBpZiAodG90YWxSb3dzKXtcbiAgICAgICAgdG90YWxQYWdlcyA9IGlzRW1wdHkobGltaXQpID8gMSA6IE1hdGguY2VpbCh0b3RhbFJvd3MgLyBsaW1pdCEpO1xuICAgICAgICBwYWdlID0gTWF0aC5taW4ocGFnZSwgdG90YWxQYWdlcyk7XG4gICAgfVxuXG4gICAgY29uc3Qgb2Zmc2V0ID0gaXNFbXB0eShsaW1pdCkgPyB1bmRlZmluZWQgOiBNYXRoLm1heCgwLCAocGFnZSAtIDEpICogbGltaXQhKTtcblxuICAgIGNvbnN0IHEgPSBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBjb25maWdLZXlzLmlkLFxuICAgICAgICAgICAgY29uZmlnS2V5SWQ6IGNvbmZpZ0tleXMuY29uZmlnS2V5SWQsXG4gICAgICAgICAgICBvbGRDb25maWdLZXlJZDogY29uZmlnS2V5cy5vbGRDb25maWdLZXlJZCxcbiAgICAgICAgICAgIGxhYmVsOiBjb25maWdLZXlzLmxhYmVsLFxuICAgICAgICAgICAga2V5OiBjb25maWdLZXlzLmtleSxcbiAgICAgICAgICAgIHN1bW1hcnk6IGNvbmZpZ0tleXMuc3VtbWFyeSxcbiAgICAgICAgICAgIHZlcnNpb246IGNvbmZpZ0tleXMudmVyc2lvbixcbiAgICAgICAgICAgIHBvc2l0aW9uOiBjb25maWdLZXlzLnBvc2l0aW9uLFxuICAgICAgICAgICAgY29uZmlnS2V5RHJhZnRJZDogY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlEcmFmdElkLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShjb25maWdLZXlzKVxuICAgICAgICAubGVmdEpvaW4oY29uZmlnS2V5c0RyYWZ0cywgZXEoY29uZmlnS2V5cy5jb25maWdLZXlJZCwgY29uZmlnS2V5c0RyYWZ0cy5jb25maWdLZXlJZCkpXG4gICAgICAgIC5vcmRlckJ5KGRlc2MoY29uZmlnS2V5cy5pZCkpO1xuXG4gICAgaWYgKCFpc0VtcHR5KGxpbWl0KSkgcS5saW1pdChsaW1pdCEpO1xuXG4gICAgaWYgKG9mZnNldCkgcS5vZmZzZXQob2Zmc2V0KTtcblxuICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCkgcS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHEuZXhlY3V0ZSgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIGRhdGE6IGRhdGEubWFwKGMgPT4gKHtcbiAgICAgICAgICAgIC4uLmMsXG4gICAgICAgICAgICBwdWJsaXNoZWRWZXJzaW9uOiBjLnZlcnNpb24sXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWxSb3dzLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICB9O1xufVxuXG5leHBvcnQgY29uc3QgX2dldENvbmZpZ0tleXNEZWZhdWx0UmVzdWx0cyA9IHtcbiAgICBwYWdlOiAxLFxuICAgIGxpbWl0OiB1bmRlZmluZWQsXG4gICAgdG90YWxSb3dzOiAwLFxuICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgZGF0YTogW10sXG4gICAgc2VhcmNoVmFsdWU6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICBlcnJvcjogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxufSBhcyBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9fZ2V0Q29uZmlnS2V5cz4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldENvbmZpZ0tleXMocGFyYW1zPzogR2V0Q29uZmlnS2V5c1BhcmFtcykge1xuICAgIGxldCByc2x0cyA9IF9nZXRDb25maWdLZXlzRGVmYXVsdFJlc3VsdHM7XG5cbiAgICB0cnkge1xuICAgICAgICByc2x0cyA9IGF3YWl0IF9fZ2V0Q29uZmlnS2V5cyh7IC4uLnBhcmFtcyB9KTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXRDb25maWdLZXlzIEVSUk9SJywgZSk7XG4gICAgICAgIHJzbHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByc2x0cztcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZXEiLCJhbmQiLCJpc051bGwiLCJjb3VudCIsImluQXJyYXkiLCJkZXNjIiwic3FsIiwiaXNOb3ROdWxsIiwibm90SW5BcnJheSIsIm9yIiwidXVpZCIsImRiIiwiY29uZmlnS2V5cyIsImNvbmZpZ0tleXNEcmFmdHMiLCJpc0VtcHR5IiwibG9nZ2VyIiwiX2xpc3RDb25maWdLZXlzIiwiY29uZmlnS2V5c1JlZmVyZW5jZXMiLCJyZXN1bHRzIiwiZGF0YSIsImRyYWZ0cyIsInF1ZXJ5IiwiZmluZE1hbnkiLCJ3aGVyZSIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbmZpZ0tleUlkIiwiY29uZmlnS2V5RHJhZnRJZCIsImNvbHVtbnMiLCJwdWJsaXNoZWQiLCJkZWxldGVkQXQiLCJtYXAiLCJzIiwicG9zaXRpb24iLCJsYWJlbCIsImNvbmZpZ0tleVJlZmVyZW5jZSIsImlzRHJhZnQiLCJzb3J0IiwiYSIsImIiLCJlIiwiZXJyb3IiLCJtZXNzYWdlIiwiX2xpc3RSYXdDb25maWdLZXlzIiwiX2dldExhc3RDb25maWdLZXlQb3NpdGlvbiIsInJlcyIsInNlbGVjdCIsImZyb20iLCJsaW1pdCIsIm9yZGVyQnkiLCJfY291bnRDb25maWdLZXlzIiwib3B0cyIsIndpdGhBcmNoaXZlZCIsInEiLCJleGVjdXRlIiwiX2dldENvbmZpZ0tleSIsInBhcmFtcyIsInZhbGlkYXRlIiwib2xkQ29uZmlnS2V5SWQiLCJmaW5kRmlyc3QiLCJpZCIsImtleSIsInN1bW1hcnkiLCJ2ZXJzaW9uIiwiX2dldENvbmZpZ0tleVdpdGhEcmFmdCIsIndpdGgiLCJkcmFmdCIsImhpc3RvcnkiLCJfZ2V0Q29uZmlnS2V5TWluaSIsIl9nZXRGdWxsQ29uZmlnS2V5IiwiX19nZXRDb25maWdLZXlzIiwicGFnZSIsImNvbmZpZ0tleUlkcyIsInNlYXJjaFZhbHVlIiwiYXJjaGl2ZWQiLCJNYXRoIiwibWF4IiwiY29uZGl0aW9ucyIsInB1c2giLCJ0cmltIiwic2VhcmNoIiwiam9pbiIsImNvdW50UXVlcnkiLCJ0b3RhbFJvd3MiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsIm1pbiIsIm9mZnNldCIsImxlZnRKb2luIiwiYyIsInB1Ymxpc2hlZFZlcnNpb24iLCJfZ2V0Q29uZmlnS2V5c0RlZmF1bHRSZXN1bHRzIiwiX2dldENvbmZpZ0tleXMiLCJyc2x0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/_config-keys.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/_scripts/_count-scripts-items.ts":
/*!************************************************************!*\
  !*** ./databases/queries/_scripts/_count-scripts-items.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countScriptsItems: () => (/* binding */ _countScriptsItems)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\nasync function _countScriptsItems(itemsType, { scriptsIds, itemsTypes }) {\n    const response = {\n        data: []\n    };\n    try {\n        for (const scriptId of scriptsIds){\n            if (itemsType === \"screens\") {\n                const whereScreensTypes = !itemsTypes?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.type, itemsTypes);\n                const whereScreensDraftsTypes = !itemsTypes?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.type, itemsTypes);\n                const countScriptsItems = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n                    drafts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.id),\n                    published: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.id)\n                }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.scriptId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId), whereScreensTypes)).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId), whereScreensDraftsTypes)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId, scriptId));\n                const countScriptsDraftsItems = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n                    drafts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.id),\n                    published: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.id)\n                }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.scriptId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId), whereScreensTypes)).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId), whereScreensDraftsTypes)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptId));\n                const scripts_screensDraftsCount = countScriptsItems[0]?.drafts || 0;\n                const scripts_screensCount = countScriptsItems[0]?.published || 0;\n                const scriptsDrafts_screensDraftsCount = countScriptsDraftsItems[0]?.drafts || 0;\n                const scriptsDrafts_screensCount = countScriptsDraftsItems[0]?.published || 0;\n                const drafts = scripts_screensDraftsCount + scriptsDrafts_screensDraftsCount;\n                const published = scripts_screensCount + scriptsDrafts_screensCount;\n                response.data.push({\n                    scriptId,\n                    drafts,\n                    published,\n                    total: drafts + published\n                });\n            } else if (itemsType === \"diagnoses\") {\n                const countScriptsItems = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n                    drafts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.id),\n                    published: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.id)\n                }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.scriptId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId)).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scripts.scriptId, scriptId));\n                const countScriptsDraftsItems = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n                    drafts: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.id),\n                    published: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.id)\n                }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.scriptId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId)).leftJoin(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId, _databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId)).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptId));\n                const scripts_diagnosesDraftsCount = countScriptsItems[0]?.drafts || 0;\n                const scripts_diagnosesCount = countScriptsItems[0]?.published || 0;\n                const scriptsDrafts_diagnosesDraftsCount = countScriptsDraftsItems[0]?.drafts || 0;\n                const scriptsDrafts_diagnosesCount = countScriptsDraftsItems[0]?.published || 0;\n                const drafts = scripts_diagnosesDraftsCount + scriptsDrafts_diagnosesDraftsCount;\n                const published = scripts_diagnosesCount + scriptsDrafts_diagnosesCount;\n                response.data.push({\n                    scriptId,\n                    drafts,\n                    published,\n                    total: drafts + published\n                });\n            }\n        }\n    } catch (e) {\n        response.errors = [\n            e.message\n        ];\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_countScriptsItems ERROR\", e.message);\n    } finally{\n        return response;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9fc2NyaXB0cy9fY291bnQtc2NyaXB0cy1pdGVtcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBdUU7QUFFckM7QUFDTTtBQVFUO0FBRXhCLGVBQWVZLG1CQUNsQkMsU0FBa0MsRUFDbEMsRUFBRUMsVUFBVSxFQUFFQyxVQUFVLEVBR3ZCO0lBRUQsTUFBTUMsV0FRRjtRQUFFQyxNQUFNLEVBQUU7SUFBRTtJQUVoQixJQUFJO1FBQ0EsS0FBSSxNQUFNQyxZQUFZSixXQUFZO1lBQzlCLElBQUlELGNBQWMsV0FBVztnQkFDekIsTUFBTU0sb0JBQW9CLENBQUNKLFlBQVlLLFNBQVNDLFlBQVlsQixvREFBT0EsQ0FBQ0sseURBQU9BLENBQUNjLElBQUksRUFBRVA7Z0JBQ2xGLE1BQU1RLDBCQUEwQixDQUFDUixZQUFZSyxTQUFTQyxZQUFZbEIsb0RBQU9BLENBQUNNLCtEQUFhQSxDQUFDYSxJQUFJLEVBQUVQO2dCQUU5RixNQUFNUyxvQkFBb0IsTUFBTW5CLDZEQUFFQSxDQUM3Qm9CLE1BQU0sQ0FBQztvQkFDSkMsUUFBUXpCLGtEQUFLQSxDQUFDUSwrREFBYUEsQ0FBQ2tCLEVBQUU7b0JBQzlCQyxXQUFXM0Isa0RBQUtBLENBQUNPLHlEQUFPQSxDQUFDbUIsRUFBRTtnQkFDL0IsR0FDQ0UsSUFBSSxDQUFDbkIseURBQU9BLEVBQ1pvQixRQUFRLENBQUN0Qix5REFBT0EsRUFBRVIsZ0RBQUdBLENBQ2xCRSwrQ0FBRUEsQ0FBQ00seURBQU9BLENBQUNVLFFBQVEsRUFBRVIseURBQU9BLENBQUNRLFFBQVEsR0FDckNDLG9CQUVIVyxRQUFRLENBQUNyQiwrREFBYUEsRUFBRVQsZ0RBQUdBLENBQ3hCRSwrQ0FBRUEsQ0FBQ08sK0RBQWFBLENBQUNzQixhQUFhLEVBQUVyQix5REFBT0EsQ0FBQ1EsUUFBUSxHQUNoREssMEJBRUhTLEtBQUssQ0FBQzlCLCtDQUFFQSxDQUFDUSx5REFBT0EsQ0FBQ1EsUUFBUSxFQUFFQTtnQkFF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QkFBK0JWLHVCQUF1QixDQUFDLEVBQUUsRUFBRUwsYUFBYTtnQkFFOUUsTUFBTUYsU0FBU2MsK0JBQStCRTtnQkFDOUMsTUFBTWQsWUFBWWEseUJBQXlCRTtnQkFFM0MzQixTQUFTQyxJQUFJLENBQUNxQixJQUFJLENBQUM7b0JBQ2ZwQjtvQkFDQVE7b0JBQ0FFO29CQUNBVyxPQUFPYixTQUFTRTtnQkFDcEI7WUFDSjtRQUNKO0lBQ0osRUFBRSxPQUFNZ0IsR0FBUTtRQUNaNUIsU0FBUzZCLE1BQU0sR0FBRztZQUFDRCxFQUFFRSxPQUFPO1NBQUM7UUFDN0IxQyxtREFBTUEsQ0FBQzJDLEtBQUssQ0FBQyw0QkFBNEJILEVBQUVFLE9BQU87SUFDdEQsU0FBVTtRQUNOLE9BQU85QjtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL19zY3JpcHRzL19jb3VudC1zY3JpcHRzLWl0ZW1zLnRzP2MwZjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYW5kLCBjb3VudCwgZXEsIGluQXJyYXksIGlzTnVsbCwgb3IsIHNxbCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcblxuaW1wb3J0IGxvZ2dlciBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IGRiIGZyb20gJ0AvZGF0YWJhc2VzL3BnL2RyaXp6bGUnO1xuaW1wb3J0IHsgXG4gICAgZGlhZ25vc2VzLFxuICAgIGRpYWdub3Nlc0RyYWZ0cyxcbiAgICBzY3JlZW5zLCBcbiAgICBzY3JlZW5zRHJhZnRzLCBcbiAgICBzY3JpcHRzLCBcbiAgICBzY3JpcHRzRHJhZnRzIFxufSBmcm9tICdAL2RhdGFiYXNlcy9wZy9zY2hlbWEnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NvdW50U2NyaXB0c0l0ZW1zKFxuICAgIGl0ZW1zVHlwZTogJ3NjcmVlbnMnIHwgJ2RpYWdub3NlcycsXG4gICAgeyBzY3JpcHRzSWRzLCBpdGVtc1R5cGVzIH06IHtcbiAgICAgICAgc2NyaXB0c0lkczogc3RyaW5nW107XG4gICAgICAgIGl0ZW1zVHlwZXM/OiB0eXBlb2Ygc2NyZWVucy4kaW5mZXJJbnNlcnRbJ3R5cGUnXVtdO1xuICAgIH1cbikge1xuICAgIGNvbnN0IHJlc3BvbnNlOiB7IFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzY3JpcHRJZDogc3RyaW5nLFxuICAgICAgICAgICAgdG90YWw6IG51bWJlcjtcbiAgICAgICAgICAgIGRyYWZ0czogbnVtYmVyO1xuICAgICAgICAgICAgcHVibGlzaGVkOiBudW1iZXI7XG4gICAgICAgIH1bXTsgXG4gICAgICAgIGVycm9ycz86IHN0cmluZ1tdOyBcbiAgICB9ID0geyBkYXRhOiBbXSwgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGZvcihjb25zdCBzY3JpcHRJZCBvZiBzY3JpcHRzSWRzKSB7XG4gICAgICAgICAgICBpZiAoaXRlbXNUeXBlID09PSAnc2NyZWVucycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB3aGVyZVNjcmVlbnNUeXBlcyA9ICFpdGVtc1R5cGVzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KHNjcmVlbnMudHlwZSwgaXRlbXNUeXBlcyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmVTY3JlZW5zRHJhZnRzVHlwZXMgPSAhaXRlbXNUeXBlcz8ubGVuZ3RoID8gdW5kZWZpbmVkIDogaW5BcnJheShzY3JlZW5zRHJhZnRzLnR5cGUsIGl0ZW1zVHlwZXMpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnRTY3JpcHRzSXRlbXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWZ0czogY291bnQoc2NyZWVuc0RyYWZ0cy5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaXNoZWQ6IGNvdW50KHNjcmVlbnMuaWQpLFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZnJvbShzY3JpcHRzKVxuICAgICAgICAgICAgICAgICAgICAubGVmdEpvaW4oc2NyZWVucywgYW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgZXEoc2NyZWVucy5zY3JpcHRJZCwgc2NyaXB0cy5zY3JpcHRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZVNjcmVlbnNUeXBlc1xuICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICAubGVmdEpvaW4oc2NyZWVuc0RyYWZ0cywgYW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgZXEoc2NyZWVuc0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzLnNjcmlwdElkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlU2NyZWVuc0RyYWZ0c1R5cGVzLFxuICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICAud2hlcmUoZXEoc2NyaXB0cy5zY3JpcHRJZCwgc2NyaXB0SWQpKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50U2NyaXB0c0RyYWZ0c0l0ZW1zID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmFmdHM6IGNvdW50KHNjcmVlbnNEcmFmdHMuaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkOiBjb3VudChzY3JlZW5zLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZyb20oc2NyaXB0c0RyYWZ0cylcbiAgICAgICAgICAgICAgICAgICAgLmxlZnRKb2luKHNjcmVlbnMsIGFuZChcbiAgICAgICAgICAgICAgICAgICAgICAgIGVxKHNjcmVlbnMuc2NyaXB0SWQsIHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZVNjcmVlbnNUeXBlcyxcbiAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgLmxlZnRKb2luKHNjcmVlbnNEcmFmdHMsIGFuZChcbiAgICAgICAgICAgICAgICAgICAgICAgIGVxKHNjcmVlbnNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlU2NyZWVuc0RyYWZ0c1R5cGVzXG4gICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgIC53aGVyZShlcShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdElkKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRzX3NjcmVlbnNEcmFmdHNDb3VudCA9IGNvdW50U2NyaXB0c0l0ZW1zWzBdPy5kcmFmdHMgfHwgMDtcbiAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRzX3NjcmVlbnNDb3VudCA9IGNvdW50U2NyaXB0c0l0ZW1zWzBdPy5wdWJsaXNoZWQgfHwgMDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdHNEcmFmdHNfc2NyZWVuc0RyYWZ0c0NvdW50ID0gY291bnRTY3JpcHRzRHJhZnRzSXRlbXNbMF0/LmRyYWZ0cyB8fCAwO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdHNEcmFmdHNfc2NyZWVuc0NvdW50ID0gY291bnRTY3JpcHRzRHJhZnRzSXRlbXNbMF0/LnB1Ymxpc2hlZCB8fCAwO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZHJhZnRzID0gc2NyaXB0c19zY3JlZW5zRHJhZnRzQ291bnQgKyBzY3JpcHRzRHJhZnRzX3NjcmVlbnNEcmFmdHNDb3VudDtcbiAgICAgICAgICAgICAgICBjb25zdCBwdWJsaXNoZWQgPSBzY3JpcHRzX3NjcmVlbnNDb3VudCArIHNjcmlwdHNEcmFmdHNfc2NyZWVuc0NvdW50O1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SWQsXG4gICAgICAgICAgICAgICAgICAgIGRyYWZ0cyxcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogZHJhZnRzICsgcHVibGlzaGVkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtc1R5cGUgPT09ICdkaWFnbm9zZXMnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY291bnRTY3JpcHRzSXRlbXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWZ0czogY291bnQoZGlhZ25vc2VzRHJhZnRzLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hlZDogY291bnQoZGlhZ25vc2VzLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZyb20oc2NyaXB0cylcbiAgICAgICAgICAgICAgICAgICAgLmxlZnRKb2luKGRpYWdub3NlcywgZXEoZGlhZ25vc2VzLnNjcmlwdElkLCBzY3JpcHRzLnNjcmlwdElkKSlcbiAgICAgICAgICAgICAgICAgICAgLmxlZnRKb2luKGRpYWdub3Nlc0RyYWZ0cywgZXEoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHMuc2NyaXB0SWQpKVxuICAgICAgICAgICAgICAgICAgICAud2hlcmUoZXEoc2NyaXB0cy5zY3JpcHRJZCwgc2NyaXB0SWQpKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50U2NyaXB0c0RyYWZ0c0l0ZW1zID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmFmdHM6IGNvdW50KGRpYWdub3Nlc0RyYWZ0cy5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaXNoZWQ6IGNvdW50KGRpYWdub3Nlcy5pZCksXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mcm9tKHNjcmlwdHNEcmFmdHMpXG4gICAgICAgICAgICAgICAgICAgIC5sZWZ0Sm9pbihkaWFnbm9zZXMsIGVxKGRpYWdub3Nlcy5zY3JpcHRJZCwgc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkKSlcbiAgICAgICAgICAgICAgICAgICAgLmxlZnRKb2luKGRpYWdub3Nlc0RyYWZ0cywgZXEoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCkpXG4gICAgICAgICAgICAgICAgICAgIC53aGVyZShlcShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdElkKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRzX2RpYWdub3Nlc0RyYWZ0c0NvdW50ID0gY291bnRTY3JpcHRzSXRlbXNbMF0/LmRyYWZ0cyB8fCAwO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdHNfZGlhZ25vc2VzQ291bnQgPSBjb3VudFNjcmlwdHNJdGVtc1swXT8ucHVibGlzaGVkIHx8IDA7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHRzRHJhZnRzX2RpYWdub3Nlc0RyYWZ0c0NvdW50ID0gY291bnRTY3JpcHRzRHJhZnRzSXRlbXNbMF0/LmRyYWZ0cyB8fCAwO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdHNEcmFmdHNfZGlhZ25vc2VzQ291bnQgPSBjb3VudFNjcmlwdHNEcmFmdHNJdGVtc1swXT8ucHVibGlzaGVkIHx8IDA7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkcmFmdHMgPSBzY3JpcHRzX2RpYWdub3Nlc0RyYWZ0c0NvdW50ICsgc2NyaXB0c0RyYWZ0c19kaWFnbm9zZXNEcmFmdHNDb3VudDtcbiAgICAgICAgICAgICAgICBjb25zdCBwdWJsaXNoZWQgPSBzY3JpcHRzX2RpYWdub3Nlc0NvdW50ICsgc2NyaXB0c0RyYWZ0c19kaWFnbm9zZXNDb3VudDtcblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNjcmlwdElkLFxuICAgICAgICAgICAgICAgICAgICBkcmFmdHMsXG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGRyYWZ0cyArIHB1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3BvbnNlLmVycm9ycyA9IFtlLm1lc3NhZ2VdO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jb3VudFNjcmlwdHNJdGVtcyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJhbmQiLCJjb3VudCIsImVxIiwiaW5BcnJheSIsImxvZ2dlciIsImRiIiwiZGlhZ25vc2VzIiwiZGlhZ25vc2VzRHJhZnRzIiwic2NyZWVucyIsInNjcmVlbnNEcmFmdHMiLCJzY3JpcHRzIiwic2NyaXB0c0RyYWZ0cyIsIl9jb3VudFNjcmlwdHNJdGVtcyIsIml0ZW1zVHlwZSIsInNjcmlwdHNJZHMiLCJpdGVtc1R5cGVzIiwicmVzcG9uc2UiLCJkYXRhIiwic2NyaXB0SWQiLCJ3aGVyZVNjcmVlbnNUeXBlcyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInR5cGUiLCJ3aGVyZVNjcmVlbnNEcmFmdHNUeXBlcyIsImNvdW50U2NyaXB0c0l0ZW1zIiwic2VsZWN0IiwiZHJhZnRzIiwiaWQiLCJwdWJsaXNoZWQiLCJmcm9tIiwibGVmdEpvaW4iLCJzY3JpcHREcmFmdElkIiwid2hlcmUiLCJjb3VudFNjcmlwdHNEcmFmdHNJdGVtcyIsInNjcmlwdHNfc2NyZWVuc0RyYWZ0c0NvdW50Iiwic2NyaXB0c19zY3JlZW5zQ291bnQiLCJzY3JpcHRzRHJhZnRzX3NjcmVlbnNEcmFmdHNDb3VudCIsInNjcmlwdHNEcmFmdHNfc2NyZWVuc0NvdW50IiwicHVzaCIsInRvdGFsIiwic2NyaXB0c19kaWFnbm9zZXNEcmFmdHNDb3VudCIsInNjcmlwdHNfZGlhZ25vc2VzQ291bnQiLCJzY3JpcHRzRHJhZnRzX2RpYWdub3Nlc0RyYWZ0c0NvdW50Iiwic2NyaXB0c0RyYWZ0c19kaWFnbm9zZXNDb3VudCIsImUiLCJlcnJvcnMiLCJtZXNzYWdlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/_scripts/_count-scripts-items.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/_scripts/_get-scripts-with-items.ts":
/*!***************************************************************!*\
  !*** ./databases/queries/_scripts/_get-scripts-with-items.ts ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getScriptsWithItems: () => (/* binding */ _getScriptsWithItems)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\nasync function _getScriptsWithItems(params) {\n    try {\n        const whereScriptsDrafts = [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptId),\n            ...!params?.scriptsIds?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptId, params.scriptsIds), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptDraftId, params.scriptsIds))\n            ]\n        ];\n        const scriptsDrafts = params?.published ? [] : await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.scriptsDrafts.findMany({\n            where: !whereScriptsDrafts.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)(...whereScriptsDrafts),\n            with: {\n                screensDrafts: {\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts.scriptId)\n                },\n                diagnosesDrafts: {\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.scriptId)\n                }\n            }\n        });\n        let whereScriptsIdsInArray = params?.scriptsIds || [];\n        const whereScriptsIdsNotInArray = [];\n        scriptsDrafts.forEach((s)=>{\n            if (s.scriptId) {\n                whereScriptsIdsInArray = whereScriptsIdsInArray.filter((id)=>id !== s.scriptId);\n                whereScriptsIdsNotInArray.push(s.scriptId);\n            }\n        });\n        const whereScripts = [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.deletedAt),\n            ...!whereScriptsIdsInArray.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.scriptId, whereScriptsIdsInArray)\n            ],\n            ...!whereScriptsIdsNotInArray.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.notInArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.scriptId, whereScriptsIdsNotInArray)\n            ]\n        ];\n        let publishedScripts = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.scripts.findMany({\n            where: !whereScripts.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)(...whereScripts),\n            with: {\n                screens: true,\n                screensDrafts: params?.published ? undefined : true,\n                diagnoses: true,\n                diagnosesDrafts: params?.published ? undefined : true\n            }\n        });\n        publishedScripts = publishedScripts.map((s)=>({\n                ...s,\n                screensDrafts: s.screensDrafts || [],\n                diagnosesDrafts: s.diagnosesDrafts || []\n            }));\n        let data = publishedScripts.reduce((acc, { screens, screensDrafts, ...s })=>{\n            return {\n                ...acc,\n                [s.scriptId]: {\n                    ...s,\n                    screens: [],\n                    diagnoses: [],\n                    isDraft: false,\n                    publishedVersion: s.version\n                }\n            };\n        }, {});\n        data = scriptsDrafts.reduce((acc, { screensDrafts, ...s })=>{\n            return {\n                ...acc,\n                [s.scriptDraftId]: {\n                    ...s.data,\n                    screens: [],\n                    diagnoses: [],\n                    isDraft: true,\n                    publishedVersion: !s.scriptId ? null : Math.max(1, s.data.version - 1)\n                }\n            };\n        }, data);\n        scriptsDrafts.forEach((s)=>s.screensDrafts.map((screenDraft)=>{\n                data[s.scriptDraftId].screens.push({\n                    ...screenDraft.data,\n                    isDraft: true,\n                    publishedVersion: !screenDraft.screenId ? null : Math.max(1, s.data.version - 1)\n                });\n            }));\n        publishedScripts.forEach((s)=>s.screensDrafts.forEach((screenDraft)=>{\n                if (screenDraft.screenId && !data[s.scriptId].screens.map((s)=>s.screenId).includes(screenDraft.screenId)) {\n                    data[s.scriptId].screens.push({\n                        ...screenDraft.data,\n                        isDraft: true,\n                        publishedVersion: !screenDraft.screenId ? null : Math.max(1, s.version - 1)\n                    });\n                }\n            }));\n        publishedScripts.forEach((s)=>s.screens.forEach((screen)=>{\n                if (screen.screenId && !data[s.scriptId].screens.map((s)=>s.screenId).includes(screen.screenId)) {\n                    data[s.scriptId].screens.push({\n                        ...screen,\n                        isDraft: true,\n                        publishedVersion: s.version\n                    });\n                }\n            }));\n        const response = {\n            data: Object.values(data).sort((a, b)=>a.position - b.position).map((s)=>({\n                    ...s,\n                    screens: s.screens.sort((a, b)=>a.position - b.position)\n                }))\n        };\n        return response;\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_getScriptsWithItems ERROR\", e.message);\n        return {\n            data: [],\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9fc2NyaXB0cy9fZ2V0LXNjcmlwdHMtd2l0aC1pdGVtcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUE0RTtBQUVwQztBQVFUO0FBQ0c7QUF1QjNCLGVBQWVhLHFCQUFxQkMsTUFBeUI7SUFDaEUsSUFBSTtRQUNBLE1BQU1DLHFCQUFxQjtZQUN2QmIsbURBQU1BLENBQUNPLCtEQUFrQkEsQ0FBQ08sUUFBUTtlQUM5QixDQUFDRixRQUFRRyxZQUFZQyxTQUFTLEVBQUUsR0FBRztnQkFBQ2QsK0NBQUVBLENBQ3RDSCxvREFBT0EsQ0FBQ1EsK0RBQWtCQSxDQUFDTyxRQUFRLEVBQUVGLE9BQU9HLFVBQVUsR0FDdERoQixvREFBT0EsQ0FBQ1EsK0RBQWtCQSxDQUFDVSxhQUFhLEVBQUVMLE9BQU9HLFVBQVU7YUFDN0Q7U0FDTDtRQUVELE1BQU1ULGdCQUFnQk0sUUFBUU0sWUFBWSxFQUFFLEdBQUcsTUFBTWYsNkRBQUVBLENBQUNnQixLQUFLLENBQUNiLGFBQWEsQ0FBQ2MsUUFBUSxDQUFDO1lBQ2pGQyxPQUFPLENBQUNSLG1CQUFtQkcsTUFBTSxHQUFHTSxZQUFZeEIsZ0RBQUdBLElBQUllO1lBQ3ZEVSxNQUFNO2dCQUNGZixlQUFlO29CQUNYYSxPQUFPckIsbURBQU1BLENBQUNTLCtEQUFrQkEsQ0FBQ0ssUUFBUTtnQkFDN0M7Z0JBQ0FVLGlCQUFpQjtvQkFDYkgsT0FBT3JCLG1EQUFNQSxDQUFDTywrREFBa0JBLENBQUNPLFFBQVE7Z0JBQzdDO1lBQ0o7UUFDSjtRQUVBLElBQUlXLHlCQUF5QmIsUUFBUUcsY0FBYyxFQUFFO1FBQ3JELE1BQU1XLDRCQUFzQyxFQUFFO1FBRTlDcEIsY0FBY3FCLE9BQU8sQ0FBQ0MsQ0FBQUE7WUFDbEIsSUFBSUEsRUFBRWQsUUFBUSxFQUFFO2dCQUNaVyx5QkFBeUJBLHVCQUF1QkksTUFBTSxDQUFDQyxDQUFBQSxLQUFNQSxPQUFPRixFQUFFZCxRQUFRO2dCQUM5RVksMEJBQTBCSyxJQUFJLENBQUNILEVBQUVkLFFBQVE7WUFDN0M7UUFDSjtRQUVBLE1BQU1rQixlQUFlO1lBQ2pCaEMsbURBQU1BLENBQUNLLHlEQUFZQSxDQUFDNEIsU0FBUztlQUN6QixDQUFDUix1QkFBdUJULE1BQU0sR0FBRyxFQUFFLEdBQUc7Z0JBQUNqQixvREFBT0EsQ0FBQ00seURBQVlBLENBQUNTLFFBQVEsRUFBRVc7YUFBd0I7ZUFDOUYsQ0FBQ0MsMEJBQTBCVixNQUFNLEdBQUcsRUFBRSxHQUFHO2dCQUFDZix1REFBVUEsQ0FBQ0kseURBQVlBLENBQUNTLFFBQVEsRUFBRVk7YUFBMkI7U0FDOUc7UUFFRCxJQUFJUSxtQkFBbUIsTUFBTS9CLDZEQUFFQSxDQUFDZ0IsS0FBSyxDQUFDZixPQUFPLENBQUNnQixRQUFRLENBQUM7WUFDbkRDLE9BQU8sQ0FBQ1csYUFBYWhCLE1BQU0sR0FBR00sWUFBWXhCLGdEQUFHQSxJQUFJa0M7WUFDakRULE1BQU07Z0JBQ0ZZLFNBQVM7Z0JBQ1QzQixlQUFlSSxRQUFRTSxZQUFZSSxZQUFZO2dCQUMvQ2MsV0FBVztnQkFDWFosaUJBQWlCWixRQUFRTSxZQUFZSSxZQUFZO1lBQ3JEO1FBQ0o7UUFFQVksbUJBQW1CQSxpQkFBaUJHLEdBQUcsQ0FBQ1QsQ0FBQUEsSUFBTTtnQkFDMUMsR0FBR0EsQ0FBQztnQkFDSnBCLGVBQWVvQixFQUFFcEIsYUFBYSxJQUFJLEVBQUU7Z0JBQ3BDZ0IsaUJBQWlCSSxFQUFFSixlQUFlLElBQUksRUFBRTtZQUM1QztRQUVBLElBQUljLE9BQU9KLGlCQUNOSyxNQUFNLENBQUMsQ0FBQ0MsS0FBSyxFQUFFTCxPQUFPLEVBQUUzQixhQUFhLEVBQUUsR0FBR29CLEdBQUc7WUFDMUMsT0FBTztnQkFDSCxHQUFHWSxHQUFHO2dCQUNOLENBQUNaLEVBQUVkLFFBQVEsQ0FBQyxFQUFFO29CQUNWLEdBQUdjLENBQUM7b0JBQ0pPLFNBQVMsRUFBRTtvQkFDWEMsV0FBVyxFQUFFO29CQUNiSyxTQUFTO29CQUNUQyxrQkFBa0JkLEVBQUVlLE9BQU87Z0JBQy9CO1lBQ0o7UUFDSixHQUFHLENBQUM7UUFFUkwsT0FBT2hDLGNBQ0ZpQyxNQUFNLENBQUMsQ0FBQ0MsS0FBSyxFQUFFaEMsYUFBYSxFQUFFLEdBQUdvQixHQUFHO1lBQ2pDLE9BQU87Z0JBQ0gsR0FBR1ksR0FBRztnQkFDTixDQUFDWixFQUFFWCxhQUFhLENBQUMsRUFBRTtvQkFDZixHQUFHVyxFQUFFVSxJQUFJO29CQUNUSCxTQUFTLEVBQUU7b0JBQ1hDLFdBQVcsRUFBRTtvQkFDYkssU0FBUztvQkFDVEMsa0JBQWtCLENBQUNkLEVBQUVkLFFBQVEsR0FBRyxPQUFPOEIsS0FBS0MsR0FBRyxDQUFDLEdBQUdqQixFQUFFVSxJQUFJLENBQUNLLE9BQU8sR0FBRztnQkFDeEU7WUFDSjtRQUNKLEdBQUdMO1FBRVBoQyxjQUFjcUIsT0FBTyxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFcEIsYUFBYSxDQUFDNkIsR0FBRyxDQUFDUyxDQUFBQTtnQkFDM0NSLElBQUksQ0FBQ1YsRUFBRVgsYUFBYSxDQUFDLENBQUNrQixPQUFPLENBQUNKLElBQUksQ0FBQztvQkFDL0IsR0FBR2UsWUFBWVIsSUFBSTtvQkFDbkJHLFNBQVM7b0JBQ1RDLGtCQUFrQixDQUFDSSxZQUFZQyxRQUFRLEdBQUcsT0FBT0gsS0FBS0MsR0FBRyxDQUFDLEdBQUdqQixFQUFFVSxJQUFJLENBQUNLLE9BQU8sR0FBRztnQkFDbEY7WUFDSjtRQUVBVCxpQkFBaUJQLE9BQU8sQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRXBCLGFBQWEsQ0FBQ21CLE9BQU8sQ0FBQ21CLENBQUFBO2dCQUNsRCxJQUFJQSxZQUFZQyxRQUFRLElBQUksQ0FBQ1QsSUFBSSxDQUFDVixFQUFFZCxRQUFRLENBQUMsQ0FBQ3FCLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDVCxDQUFBQSxJQUFLQSxFQUFFbUIsUUFBUSxFQUFFQyxRQUFRLENBQUNGLFlBQVlDLFFBQVEsR0FBRztvQkFDdkdULElBQUksQ0FBQ1YsRUFBRWQsUUFBUSxDQUFDLENBQUNxQixPQUFPLENBQUNKLElBQUksQ0FBQzt3QkFDMUIsR0FBR2UsWUFBWVIsSUFBSTt3QkFDbkJHLFNBQVM7d0JBQ1RDLGtCQUFrQixDQUFDSSxZQUFZQyxRQUFRLEdBQUcsT0FBT0gsS0FBS0MsR0FBRyxDQUFDLEdBQUdqQixFQUFFZSxPQUFPLEdBQUc7b0JBQzdFO2dCQUNKO1lBQ0o7UUFFQVQsaUJBQWlCUCxPQUFPLENBQUNDLENBQUFBLElBQUtBLEVBQUVPLE9BQU8sQ0FBQ1IsT0FBTyxDQUFDc0IsQ0FBQUE7Z0JBQzVDLElBQUlBLE9BQU9GLFFBQVEsSUFBSSxDQUFDVCxJQUFJLENBQUNWLEVBQUVkLFFBQVEsQ0FBQyxDQUFDcUIsT0FBTyxDQUFDRSxHQUFHLENBQUNULENBQUFBLElBQUtBLEVBQUVtQixRQUFRLEVBQUVDLFFBQVEsQ0FBQ0MsT0FBT0YsUUFBUSxHQUFHO29CQUM3RlQsSUFBSSxDQUFDVixFQUFFZCxRQUFRLENBQUMsQ0FBQ3FCLE9BQU8sQ0FBQ0osSUFBSSxDQUFDO3dCQUMxQixHQUFHa0IsTUFBTTt3QkFDVFIsU0FBUzt3QkFDVEMsa0JBQWtCZCxFQUFFZSxPQUFPO29CQUMvQjtnQkFDSjtZQUNKO1FBRUEsTUFBTU8sV0FBWTtZQUNkWixNQUFNYSxPQUFPQyxNQUFNLENBQUNkLE1BQU1lLElBQUksQ0FBQyxDQUFDQyxHQUFHQyxJQUFNRCxFQUFFRSxRQUFRLEdBQUdELEVBQUVDLFFBQVEsRUFBRW5CLEdBQUcsQ0FBQ1QsQ0FBQUEsSUFBTTtvQkFDeEUsR0FBR0EsQ0FBQztvQkFDSk8sU0FBU1AsRUFBRU8sT0FBTyxDQUFDa0IsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU1ELEVBQUVFLFFBQVEsR0FBR0QsRUFBRUMsUUFBUTtnQkFFN0Q7UUFDSjtRQUVBLE9BQU9OO0lBQ1gsRUFBRSxPQUFNTyxHQUFRO1FBQ1ovQyxtREFBTUEsQ0FBQ2dELEtBQUssQ0FBQyw4QkFBOEJELEVBQUVFLE9BQU87UUFDcEQsT0FBTztZQUFFckIsTUFBTSxFQUFFO1lBQUVzQixRQUFRO2dCQUFDSCxFQUFFRSxPQUFPO2FBQUM7UUFBRTtJQUM1QztBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcXVlcmllcy9fc2NyaXB0cy9fZ2V0LXNjcmlwdHMtd2l0aC1pdGVtcy50cz84MmE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuZCwgZXEsIGd0ZSwgaW5BcnJheSwgaXNOdWxsLCBub3RJbkFycmF5LCBvciB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuXG5pbXBvcnQgZGIgZnJvbSBcIkAvZGF0YWJhc2VzL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IFxuICAgIHNjcmlwdHMgYXMgc2NyaXB0c1RhYmxlLFxuICAgIHNjcmlwdHNEcmFmdHMgYXMgIHNjcmlwdHNEcmFmdHNUYWJsZSxcbiAgICBzY3JlZW5zIGFzIHNjcmVlbnNUYWJsZSwgXG4gICAgc2NyZWVuc0RyYWZ0cyBhcyBzY3JlZW5zRHJhZnRzVGFibGUsIFxuICAgIGRpYWdub3NlcyBhcyBkaWFnbm9zZXNUYWJsZSwgXG4gICAgZGlhZ25vc2VzRHJhZnRzIGFzIGRpYWdub3Nlc0RyYWZ0c1RhYmxlLCBcbn0gZnJvbSBcIkAvZGF0YWJhc2VzL3BnL3NjaGVtYVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5cbmV4cG9ydCB0eXBlIEdldFNjcmlwdHNQYXJhbXMgPSB7XG4gICAgc2NyaXB0c0lkcz86IHN0cmluZ1tdO1xuICAgIHB1Ymxpc2hlZD86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBHZXRTY3JpcHRzUmVzdWx0cyA9IHtcbiAgICBkYXRhOiAodHlwZW9mIHNjcmlwdHNUYWJsZS4kaW5mZXJTZWxlY3QgJiB7XG4gICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgIHB1Ymxpc2hlZFZlcnNpb246IG51bGwgfCBudW1iZXI7XG4gICAgICAgIHNjcmVlbnM6ICh0eXBlb2Ygc2NyZWVuc1RhYmxlLiRpbmZlclNlbGVjdCAmIHtcbiAgICAgICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgICAgICBwdWJsaXNoZWRWZXJzaW9uOiBudWxsIHwgbnVtYmVyO1xuICAgICAgICB9KVtdO1xuICAgICAgICBkaWFnbm9zZXM6ICh0eXBlb2YgZGlhZ25vc2VzVGFibGUuJGluZmVyU2VsZWN0ICYge1xuICAgICAgICAgICAgaXNEcmFmdDogYm9vbGVhbjtcbiAgICAgICAgICAgIHB1Ymxpc2hlZFZlcnNpb246IG51bGwgfCBudW1iZXI7XG4gICAgICAgIH0pW107XG4gICAgfSlbXTtcbiAgICBlcnJvcnM/OiBzdHJpbmdbXTtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyaXB0c1dpdGhJdGVtcyhwYXJhbXM/OiBHZXRTY3JpcHRzUGFyYW1zKTogUHJvbWlzZTxHZXRTY3JpcHRzUmVzdWx0cz4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHdoZXJlU2NyaXB0c0RyYWZ0cyA9IFtcbiAgICAgICAgICAgIGlzTnVsbChzY3JpcHRzRHJhZnRzVGFibGUuc2NyaXB0SWQpLFxuICAgICAgICAgICAgLi4uKCFwYXJhbXM/LnNjcmlwdHNJZHM/Lmxlbmd0aCA/IFtdIDogW29yKFxuICAgICAgICAgICAgICAgIGluQXJyYXkoc2NyaXB0c0RyYWZ0c1RhYmxlLnNjcmlwdElkLCBwYXJhbXMuc2NyaXB0c0lkcyksXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JpcHRzRHJhZnRzVGFibGUuc2NyaXB0RHJhZnRJZCwgcGFyYW1zLnNjcmlwdHNJZHMpXG4gICAgICAgICAgICApXSksXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3Qgc2NyaXB0c0RyYWZ0cyA9IHBhcmFtcz8ucHVibGlzaGVkID8gW10gOiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiAhd2hlcmVTY3JpcHRzRHJhZnRzLmxlbmd0aCA/IHVuZGVmaW5lZCA6IGFuZCguLi53aGVyZVNjcmlwdHNEcmFmdHMpLFxuICAgICAgICAgICAgd2l0aDoge1xuICAgICAgICAgICAgICAgIHNjcmVlbnNEcmFmdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IGlzTnVsbChzY3JlZW5zRHJhZnRzVGFibGUuc2NyaXB0SWQpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlhZ25vc2VzRHJhZnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiBpc051bGwoc2NyaXB0c0RyYWZ0c1RhYmxlLnNjcmlwdElkKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHdoZXJlU2NyaXB0c0lkc0luQXJyYXkgPSBwYXJhbXM/LnNjcmlwdHNJZHMgfHwgW107XG4gICAgICAgIGNvbnN0IHdoZXJlU2NyaXB0c0lkc05vdEluQXJyYXk6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgc2NyaXB0c0RyYWZ0cy5mb3JFYWNoKHMgPT4ge1xuICAgICAgICAgICAgaWYgKHMuc2NyaXB0SWQpIHtcbiAgICAgICAgICAgICAgICB3aGVyZVNjcmlwdHNJZHNJbkFycmF5ID0gd2hlcmVTY3JpcHRzSWRzSW5BcnJheS5maWx0ZXIoaWQgPT4gaWQgIT09IHMuc2NyaXB0SWQpO1xuICAgICAgICAgICAgICAgIHdoZXJlU2NyaXB0c0lkc05vdEluQXJyYXkucHVzaChzLnNjcmlwdElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgd2hlcmVTY3JpcHRzID0gW1xuICAgICAgICAgICAgaXNOdWxsKHNjcmlwdHNUYWJsZS5kZWxldGVkQXQpLFxuICAgICAgICAgICAgLi4uKCF3aGVyZVNjcmlwdHNJZHNJbkFycmF5Lmxlbmd0aCA/IFtdIDogW2luQXJyYXkoc2NyaXB0c1RhYmxlLnNjcmlwdElkLCB3aGVyZVNjcmlwdHNJZHNJbkFycmF5KV0pLFxuICAgICAgICAgICAgLi4uKCF3aGVyZVNjcmlwdHNJZHNOb3RJbkFycmF5Lmxlbmd0aCA/IFtdIDogW25vdEluQXJyYXkoc2NyaXB0c1RhYmxlLnNjcmlwdElkLCB3aGVyZVNjcmlwdHNJZHNOb3RJbkFycmF5KV0pLFxuICAgICAgICBdO1xuXG4gICAgICAgIGxldCBwdWJsaXNoZWRTY3JpcHRzID0gYXdhaXQgZGIucXVlcnkuc2NyaXB0cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogIXdoZXJlU2NyaXB0cy5sZW5ndGggPyB1bmRlZmluZWQgOiBhbmQoLi4ud2hlcmVTY3JpcHRzKSxcbiAgICAgICAgICAgIHdpdGg6IHtcbiAgICAgICAgICAgICAgICBzY3JlZW5zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjcmVlbnNEcmFmdHM6IHBhcmFtcz8ucHVibGlzaGVkID8gdW5kZWZpbmVkIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkaWFnbm9zZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgZGlhZ25vc2VzRHJhZnRzOiBwYXJhbXM/LnB1Ymxpc2hlZCA/IHVuZGVmaW5lZCA6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBwdWJsaXNoZWRTY3JpcHRzID0gcHVibGlzaGVkU2NyaXB0cy5tYXAocyA9PiAoe1xuICAgICAgICAgICAgLi4ucyxcbiAgICAgICAgICAgIHNjcmVlbnNEcmFmdHM6IHMuc2NyZWVuc0RyYWZ0cyB8fCBbXSxcbiAgICAgICAgICAgIGRpYWdub3Nlc0RyYWZ0czogcy5kaWFnbm9zZXNEcmFmdHMgfHwgW10sXG4gICAgICAgIH0pKTtcblxuICAgICAgICBsZXQgZGF0YSA9IHB1Ymxpc2hlZFNjcmlwdHNcbiAgICAgICAgICAgIC5yZWR1Y2UoKGFjYywgeyBzY3JlZW5zLCBzY3JlZW5zRHJhZnRzLCAuLi5zIH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hY2MsXG4gICAgICAgICAgICAgICAgICAgIFtzLnNjcmlwdElkXToge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlbnM6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlhZ25vc2VzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRHJhZnQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogcy52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LCB7fSBhcyB7IFtrZXk6IHN0cmluZ106IEdldFNjcmlwdHNSZXN1bHRzWydkYXRhJ11bMF0gfSk7XG5cbiAgICAgICAgZGF0YSA9IHNjcmlwdHNEcmFmdHNcbiAgICAgICAgICAgIC5yZWR1Y2UoKGFjYywgeyBzY3JlZW5zRHJhZnRzLCAuLi5zIH0pID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hY2MsXG4gICAgICAgICAgICAgICAgICAgIFtzLnNjcmlwdERyYWZ0SWRdOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zLmRhdGEgYXMgdHlwZW9mIHNjcmlwdHNUYWJsZS4kaW5mZXJTZWxlY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5zOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdub3NlczogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0RyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogIXMuc2NyaXB0SWQgPyBudWxsIDogTWF0aC5tYXgoMSwgcy5kYXRhLnZlcnNpb24gLSAxKSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSwgZGF0YSk7XG5cbiAgICAgICAgc2NyaXB0c0RyYWZ0cy5mb3JFYWNoKHMgPT4gcy5zY3JlZW5zRHJhZnRzLm1hcChzY3JlZW5EcmFmdCA9PiB7XG4gICAgICAgICAgICBkYXRhW3Muc2NyaXB0RHJhZnRJZF0uc2NyZWVucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAuLi5zY3JlZW5EcmFmdC5kYXRhIGFzIHR5cGVvZiBzY3JlZW5zVGFibGUuJGluZmVyU2VsZWN0LFxuICAgICAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogIXNjcmVlbkRyYWZ0LnNjcmVlbklkID8gbnVsbCA6IE1hdGgubWF4KDEsIHMuZGF0YS52ZXJzaW9uIC0gMSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHB1Ymxpc2hlZFNjcmlwdHMuZm9yRWFjaChzID0+IHMuc2NyZWVuc0RyYWZ0cy5mb3JFYWNoKHNjcmVlbkRyYWZ0ID0+IHtcbiAgICAgICAgICAgIGlmIChzY3JlZW5EcmFmdC5zY3JlZW5JZCAmJiAhZGF0YVtzLnNjcmlwdElkXS5zY3JlZW5zLm1hcChzID0+IHMuc2NyZWVuSWQpLmluY2x1ZGVzKHNjcmVlbkRyYWZ0LnNjcmVlbklkKSkge1xuICAgICAgICAgICAgICAgIGRhdGFbcy5zY3JpcHRJZF0uc2NyZWVucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uc2NyZWVuRHJhZnQuZGF0YSBhcyB0eXBlb2Ygc2NyZWVuc1RhYmxlLiRpbmZlclNlbGVjdCxcbiAgICAgICAgICAgICAgICAgICAgaXNEcmFmdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogIXNjcmVlbkRyYWZ0LnNjcmVlbklkID8gbnVsbCA6IE1hdGgubWF4KDEsIHMudmVyc2lvbiAtIDEpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG5cbiAgICAgICAgcHVibGlzaGVkU2NyaXB0cy5mb3JFYWNoKHMgPT4gcy5zY3JlZW5zLmZvckVhY2goc2NyZWVuID0+IHtcbiAgICAgICAgICAgIGlmIChzY3JlZW4uc2NyZWVuSWQgJiYgIWRhdGFbcy5zY3JpcHRJZF0uc2NyZWVucy5tYXAocyA9PiBzLnNjcmVlbklkKS5pbmNsdWRlcyhzY3JlZW4uc2NyZWVuSWQpKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtzLnNjcmlwdElkXS5zY3JlZW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAuLi5zY3JlZW4sXG4gICAgICAgICAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hlZFZlcnNpb246IHMudmVyc2lvbixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gIHtcbiAgICAgICAgICAgIGRhdGE6IE9iamVjdC52YWx1ZXMoZGF0YSkuc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pLm1hcChzID0+ICh7XG4gICAgICAgICAgICAgICAgLi4ucyxcbiAgICAgICAgICAgICAgICBzY3JlZW5zOiBzLnNjcmVlbnMuc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pLFxuICAgICAgICAgICAgICAgIC8vIGRpYWdub3Nlczogcy5kaWFnbm9zZXMuc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2dldFNjcmlwdHNXaXRoSXRlbXMgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4geyBkYXRhOiBbXSwgZXJyb3JzOiBbZS5tZXNzYWdlXSwgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiYW5kIiwiaW5BcnJheSIsImlzTnVsbCIsIm5vdEluQXJyYXkiLCJvciIsImRiIiwic2NyaXB0cyIsInNjcmlwdHNUYWJsZSIsInNjcmlwdHNEcmFmdHMiLCJzY3JpcHRzRHJhZnRzVGFibGUiLCJzY3JlZW5zRHJhZnRzIiwic2NyZWVuc0RyYWZ0c1RhYmxlIiwibG9nZ2VyIiwiX2dldFNjcmlwdHNXaXRoSXRlbXMiLCJwYXJhbXMiLCJ3aGVyZVNjcmlwdHNEcmFmdHMiLCJzY3JpcHRJZCIsInNjcmlwdHNJZHMiLCJsZW5ndGgiLCJzY3JpcHREcmFmdElkIiwicHVibGlzaGVkIiwicXVlcnkiLCJmaW5kTWFueSIsIndoZXJlIiwidW5kZWZpbmVkIiwid2l0aCIsImRpYWdub3Nlc0RyYWZ0cyIsIndoZXJlU2NyaXB0c0lkc0luQXJyYXkiLCJ3aGVyZVNjcmlwdHNJZHNOb3RJbkFycmF5IiwiZm9yRWFjaCIsInMiLCJmaWx0ZXIiLCJpZCIsInB1c2giLCJ3aGVyZVNjcmlwdHMiLCJkZWxldGVkQXQiLCJwdWJsaXNoZWRTY3JpcHRzIiwic2NyZWVucyIsImRpYWdub3NlcyIsIm1hcCIsImRhdGEiLCJyZWR1Y2UiLCJhY2MiLCJpc0RyYWZ0IiwicHVibGlzaGVkVmVyc2lvbiIsInZlcnNpb24iLCJNYXRoIiwibWF4Iiwic2NyZWVuRHJhZnQiLCJzY3JlZW5JZCIsImluY2x1ZGVzIiwic2NyZWVuIiwicmVzcG9uc2UiLCJPYmplY3QiLCJ2YWx1ZXMiLCJzb3J0IiwiYSIsImIiLCJwb3NpdGlvbiIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/_scripts/_get-scripts-with-items.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/_scripts/index.ts":
/*!*********************************************!*\
  !*** ./databases/queries/_scripts/index.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countScripts: () => (/* binding */ _countScripts),\n/* harmony export */   _countScriptsItems: () => (/* reexport safe */ _count_scripts_items__WEBPACK_IMPORTED_MODULE_5__._countScriptsItems),\n/* harmony export */   _getFullScript: () => (/* binding */ _getFullScript),\n/* harmony export */   _getLastScriptPosition: () => (/* binding */ _getLastScriptPosition),\n/* harmony export */   _getScript: () => (/* binding */ _getScript),\n/* harmony export */   _getScriptMini: () => (/* binding */ _getScriptMini),\n/* harmony export */   _getScriptWithDraft: () => (/* binding */ _getScriptWithDraft),\n/* harmony export */   _getScripts: () => (/* binding */ _getScripts),\n/* harmony export */   _getScriptsDefaultResults: () => (/* binding */ _getScriptsDefaultResults),\n/* harmony export */   _getScriptsWithItems: () => (/* reexport safe */ _get_scripts_with_items__WEBPACK_IMPORTED_MODULE_4__._getScriptsWithItems),\n/* harmony export */   _listRawScripts: () => (/* binding */ _listRawScripts),\n/* harmony export */   _listScripts: () => (/* binding */ _listScripts)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/validate.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _get_scripts_with_items__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./_get-scripts-with-items */ \"(rsc)/./databases/queries/_scripts/_get-scripts-with-items.ts\");\n/* harmony import */ var _count_scripts_items__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./_count-scripts-items */ \"(rsc)/./databases/queries/_scripts/_count-scripts-items.ts\");\n\n\n\n\n\n\n\n\nasync function _listScripts(scriptsReferences) {\n    const results = {\n        data: []\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n            where: !scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptDraftId, scriptsReferences)),\n            columns: {\n                scriptId: true,\n                scriptDraftId: true,\n                data: true\n            }\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, drafts.map((s)=>s.data.scriptId))\n                ]\n            ]),\n            columns: {\n                scriptId: true,\n                position: true,\n                title: true\n            }\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>({\n                    scriptReference: s.scriptDraftId,\n                    scriptId: s.scriptId || undefined,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true,\n                    title: s.data.title,\n                    position: s.data.position\n                }))\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    scriptReference: s.scriptId,\n                    scriptId: s.scriptId,\n                    isDraft: false,\n                    title: s.title,\n                    position: s.position\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_listScripts ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _listRawScripts(scriptsReferences) {\n    const results = {\n        data: []\n    };\n    try {\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scriptsDrafts.findMany({\n            where: !scriptsReferences?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptDraftId, scriptsReferences))\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, drafts.map((s)=>s.data.scriptId))\n                ]\n            ])\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>{\n                return {\n                    ...s.data,\n                    scriptReference: s.scriptDraftId,\n                    scriptId: s.scriptId || undefined,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true\n                };\n            })\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    ...s,\n                    scriptReference: s.scriptId,\n                    scriptId: s.scriptId,\n                    isDraft: false\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_listRawScripts ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _getLastScriptPosition() {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.position\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt)).limit(1).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.position));\n    return res[0]?.position || 0;\n}\nasync function _countScripts(opts) {\n    const { withArchived } = {\n        ...opts\n    };\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts);\n    if (!withArchived) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt));\n    const res = await q.execute();\n    return res[0]?.count;\n}\nasync function _getScript(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_9__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.oldScriptId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt)),\n        columns: {\n            id: true,\n            scriptId: true,\n            oldScriptId: true,\n            publishDate: true,\n            createdAt: true,\n            updatedAt: true,\n            version: true,\n            type: true,\n            position: true,\n            title: true,\n            printTitle: true,\n            description: true,\n            hospitalId: true,\n            exportable: true,\n            nuidSearchEnabled: true,\n            nuidSearchFields: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        nuidSearchFields: res.nuidSearchFields\n    };\n}\nasync function _getScriptWithDraft(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_9__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.oldScriptId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt)),\n        columns: {\n            id: true,\n            scriptId: true,\n            oldScriptId: true,\n            publishDate: true,\n            createdAt: true,\n            updatedAt: true,\n            version: true,\n            type: true,\n            position: true,\n            title: true,\n            printTitle: true,\n            description: true,\n            hospitalId: true,\n            exportable: true,\n            nuidSearchEnabled: true,\n            nuidSearchFields: true\n        },\n        with: {\n            draft: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        nuidSearchFields: res.nuidSearchFields\n    };\n}\nasync function _getScriptMini(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_9__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.oldScriptId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt)),\n        columns: {\n            scriptId: true,\n            oldScriptId: true,\n            version: true,\n            type: true,\n            title: true,\n            printTitle: true,\n            description: true\n        }\n    });\n}\nasync function _getFullScript(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_9__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.oldScriptId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.scripts.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt))\n    });\n}\nasync function __getScripts({ limit, page = 1, scriptIds, searchValue, archived }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (archived) {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt));\n    } else {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.deletedAt));\n    }\n    if (scriptIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, scriptIds));\n    searchValue = `${searchValue || \"\"}`.trim();\n    if (searchValue) {\n        const search = [\n            \"%\",\n            searchValue,\n            \"%\"\n        ].join(\"\");\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_10__.sql)`LOWER(scripts.name) like LOWER(${search})`);\n    }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n        id: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.id,\n        scriptId: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId,\n        oldScriptId: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.oldScriptId,\n        publishDate: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.publishDate,\n        createdAt: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.createdAt,\n        updatedAt: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.updatedAt,\n        version: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.version,\n        type: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.type,\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.position,\n        title: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.title,\n        printTitle: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.printTitle,\n        description: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.description,\n        hospitalId: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.hospitalId,\n        exportable: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.exportable,\n        nuidSearchEnabled: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.nuidSearchEnabled,\n        scriptDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptDraftId\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts).leftJoin(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.scriptId, _pg_schema__WEBPACK_IMPORTED_MODULE_3__.scriptsDrafts.scriptId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_3__.scripts.position));\n    if (!(0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(limit)) q.limit(limit);\n    if (offset) q.offset(offset);\n    if (conditions.length) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)(...conditions));\n    const data = await q.execute();\n    return {\n        page,\n        limit,\n        data: data.map((s)=>({\n                ...s,\n                publishedVersion: s.version\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getScriptsDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getScripts(params) {\n    let rslts = _getScriptsDefaultResults;\n    try {\n        rslts = await __getScripts({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_getScripts ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9fc2NyaXB0cy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF5RztBQUM1RTtBQUVLO0FBRU07QUFDTjtBQUN1QjtBQUdmO0FBQ0g7QUFFaEMsZUFBZWdCLGFBQWFDLGlCQUE0QjtJQUMzRCxNQUFNQyxVQVVGO1FBQ0FDLE1BQU0sRUFBRTtJQUNaO0lBRUEsSUFBSTtRQUNBLE1BQU1DLFNBQVMsTUFBTVAsbURBQUVBLENBQUNRLEtBQUssQ0FBQ04sYUFBYSxDQUFDTyxRQUFRLENBQUM7WUFDakRDLE9BQU8sQ0FBQ04sbUJBQW1CTyxTQUFTQyxZQUFZaEIsK0NBQUVBLENBQzlDTCxvREFBT0EsQ0FBQ1cscURBQWFBLENBQUNXLFFBQVEsRUFBRVQsb0JBQ2hDYixvREFBT0EsQ0FBQ1cscURBQWFBLENBQUNZLGFBQWEsRUFBRVY7WUFFekNXLFNBQVM7Z0JBQ0xGLFVBQVU7Z0JBQ1ZDLGVBQWU7Z0JBQ2ZSLE1BQU07WUFDVjtRQUNKO1FBRUEsTUFBTVUsWUFBWSxNQUFNaEIsbURBQUVBLENBQUNRLEtBQUssQ0FBQ1AsT0FBTyxDQUFDUSxRQUFRLENBQUM7WUFDOUNDLE9BQU90QixnREFBR0EsSUFBSTtnQkFDVkMsbURBQU1BLENBQUNZLCtDQUFPQSxDQUFDZ0IsU0FBUzttQkFDcEIsQ0FBQ1YsT0FBT0ksTUFBTSxHQUFHLEVBQUUsR0FBRztvQkFBQ2hCLHVEQUFVQSxDQUFDTSwrQ0FBT0EsQ0FBQ1ksUUFBUSxFQUFFTixPQUFPVyxHQUFHLENBQUNDLENBQUFBLElBQUtBLEVBQUViLElBQUksQ0FBQ08sUUFBUTtpQkFBSTthQUM5RjtZQUNERSxTQUFTO2dCQUNMRixVQUFVO2dCQUNWTyxVQUFVO2dCQUNWQyxPQUFPO1lBQ1g7UUFDSjtRQUVBaEIsUUFBUUMsSUFBSSxHQUFHO2VBQUlELFFBQVFDLElBQUk7ZUFBS0MsT0FBT1csR0FBRyxDQUFDQyxDQUFBQSxJQUFNO29CQUNqREcs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UUFDQVg7UUFDQXZDLE9BQU9oQjtJQUNYO0FBQ0o7QUFFTyxNQUFNd0UsNEJBQTRCO0lBQ3JDbkIsTUFBTTtJQUNOOUIsT0FBT3ZCO0lBQ1BpRSxXQUFXO0lBQ1hDLFlBQVk7SUFDWnhFLE1BQU0sRUFBRTtJQUNSNkQsYUFBYXZEO0lBQ2JnQixPQUFPaEI7QUFDWCxFQUE4QztBQUV2QyxlQUFleUUsWUFBWTFDLE1BQXlCO0lBQ3ZELElBQUkyQyxRQUFRRjtJQUVaLElBQUk7UUFDQUUsUUFBUSxNQUFNdEIsYUFBYTtZQUFFLEdBQUdyQixNQUFNO1FBQUM7SUFDM0MsRUFBRSxPQUFNaEIsR0FBUTtRQUNaN0IsbURBQU1BLENBQUM4QixLQUFLLENBQUMscUJBQXFCRDtRQUNsQzJELE1BQU0xRCxLQUFLLEdBQUdELEVBQUVFLE9BQU87SUFDM0IsU0FBVTtRQUNOLE9BQU95RDtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL19zY3JpcHRzL2luZGV4LnRzPzJiNTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGFuZCwgaXNOdWxsLCBTUUwsIGNvdW50LCBpbkFycmF5LCBkZXNjLCBzcWwsIGlzTm90TnVsbCwgbm90SW5BcnJheSwgb3IgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcbmltcG9ydCAqIGFzIHV1aWQgZnJvbSAndXVpZCc7XG5cbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuaW1wb3J0IHsgU2NyaXB0RmllbGQgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gXCJAL2xpYi9pc0VtcHR5XCI7XG5pbXBvcnQgZGIgZnJvbSBcIi4uLy4uL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IHNjcmlwdHMsIHNjcmlwdHNEcmFmdHMgfSBmcm9tIFwiLi4vLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgeyBfZ2V0U2NyaXB0c0RyYWZ0cyB9IGZyb20gXCIuLi9zY3JpcHRzLWRyYWZ0c1wiO1xuXG5leHBvcnQgKiBmcm9tICcuL19nZXQtc2NyaXB0cy13aXRoLWl0ZW1zJztcbmV4cG9ydCAqIGZyb20gJy4vX2NvdW50LXNjcmlwdHMtaXRlbXMnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2xpc3RTY3JpcHRzKHNjcmlwdHNSZWZlcmVuY2VzPzogc3RyaW5nW10pIHtcbiAgICBjb25zdCByZXN1bHRzOiB7XG4gICAgICAgIGVycm9yPzogc3RyaW5nO1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzY3JpcHRSZWZlcmVuY2U6IHN0cmluZztcbiAgICAgICAgICAgIHNjcmlwdElkPzogc3RyaW5nO1xuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZD86IHN0cmluZztcbiAgICAgICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgICAgICAgcG9zaXRpb246IG51bWJlcjtcbiAgICAgICAgfVtdO1xuICAgIH0gPSB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiAhc2NyaXB0c1JlZmVyZW5jZXM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IG9yKFxuICAgICAgICAgICAgICAgIGluQXJyYXkoc2NyaXB0c0RyYWZ0cy5zY3JpcHRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgICAgIGluQXJyYXkoc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi5bXG4gICAgICAgICAgICAgICAgaXNOdWxsKHNjcmlwdHMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KHNjcmlwdHMuc2NyaXB0SWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuc2NyaXB0SWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5kcmFmdHMubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIHNjcmlwdFJlZmVyZW5jZTogcy5zY3JpcHREcmFmdElkLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogcy5zY3JpcHREcmFmdElkLFxuICAgICAgICAgICAgaXNEcmFmdDogdHJ1ZSxcbiAgICAgICAgICAgIHRpdGxlOiBzLmRhdGEudGl0bGUsXG4gICAgICAgICAgICBwb3NpdGlvbjogcy5kYXRhLnBvc2l0aW9uLFxuICAgICAgICB9KSldO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLnB1Ymxpc2hlZC5tYXAocyA9PiAoe1xuICAgICAgICAgICAgc2NyaXB0UmVmZXJlbmNlOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICBpc0RyYWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIHRpdGxlOiBzLnRpdGxlLFxuICAgICAgICAgICAgcG9zaXRpb246IHMucG9zaXRpb24sXG4gICAgICAgIH0pKV0uc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2xpc3RTY3JpcHRzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfbGlzdFJhd1NjcmlwdHMoc2NyaXB0c1JlZmVyZW5jZXM/OiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHJlc3VsdHM6IHtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7XG4gICAgICAgIGRhdGE6ICh0eXBlb2Ygc2NyaXB0cy4kaW5mZXJTZWxlY3QgJiB7XG4gICAgICAgICAgICBzY3JpcHRSZWZlcmVuY2U6IHN0cmluZztcbiAgICAgICAgICAgIHNjcmlwdElkPzogc3RyaW5nO1xuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZD86IHN0cmluZztcbiAgICAgICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgIH0pW107XG4gICAgfSA9IHtcbiAgICAgICAgZGF0YTogW10sXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6ICFzY3JpcHRzUmVmZXJlbmNlcz8ubGVuZ3RoID8gdW5kZWZpbmVkIDogb3IoXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JpcHRzRHJhZnRzLnNjcmlwdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi5bXG4gICAgICAgICAgICAgICAgaXNOdWxsKHNjcmlwdHMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KHNjcmlwdHMuc2NyaXB0SWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuc2NyaXB0SWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLmRyYWZ0cy5tYXAocyA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnMuZGF0YSxcbiAgICAgICAgICAgICAgICBzY3JpcHRSZWZlcmVuY2U6IHMuc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogcy5zY3JpcHREcmFmdElkLFxuICAgICAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICB9IGFzIHR5cGVvZiByZXN1bHRzLmRhdGFbMF07XG4gICAgICAgIH0pXTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5wdWJsaXNoZWQubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIC4uLnMsXG4gICAgICAgICAgICBzY3JpcHRSZWZlcmVuY2U6IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCxcbiAgICAgICAgICAgIGlzRHJhZnQ6IGZhbHNlLFxuICAgICAgICB9KSldLnNvcnQoKGEsIGIpID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19saXN0UmF3U2NyaXB0cyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldExhc3RTY3JpcHRQb3NpdGlvbigpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgcG9zaXRpb246IHNjcmlwdHMucG9zaXRpb24sIH0pXG4gICAgICAgIC5mcm9tKHNjcmlwdHMpXG4gICAgICAgIC53aGVyZShpc051bGwoc2NyaXB0cy5kZWxldGVkQXQpKVxuICAgICAgICAubGltaXQoMSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhzY3JpcHRzLnBvc2l0aW9uKSk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8ucG9zaXRpb24gfHwgMDtcbn0gXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY291bnRTY3JpcHRzKG9wdHM/OiB7XG4gICAgd2l0aEFyY2hpdmVkPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB7IHdpdGhBcmNoaXZlZCB9ID0geyAuLi5vcHRzIH07XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShzY3JpcHRzKTtcblxuICAgIGlmICghd2l0aEFyY2hpdmVkKSBxLndoZXJlKGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCkpO1xuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcS5leGVjdXRlKCk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8uY291bnQ7XG59IFxuXG5leHBvcnQgdHlwZSBHZXRTY3JpcHRQYXJhbXMgPSBzdHJpbmc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyaXB0KHBhcmFtczogR2V0U2NyaXB0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShzY3JpcHRzLnNjcmlwdElkLCBwYXJhbXMpIDogZXEoc2NyaXB0cy5vbGRTY3JpcHRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICBvbGRTY3JpcHRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHB1Ymxpc2hEYXRlOiB0cnVlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgdmVyc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IHRydWUsXG4gICAgICAgICAgICBwb3NpdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgcHJpbnRUaXRsZTogdHJ1ZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0cnVlLFxuICAgICAgICAgICAgaG9zcGl0YWxJZDogdHJ1ZSxcbiAgICAgICAgICAgIGV4cG9ydGFibGU6IHRydWUsXG4gICAgICAgICAgICBudWlkU2VhcmNoRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIG51aWRTZWFyY2hGaWVsZHM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgbnVpZFNlYXJjaEZpZWxkczogcmVzLm51aWRTZWFyY2hGaWVsZHMgYXMgU2NyaXB0RmllbGRbXSxcbiAgICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmlwdFdpdGhEcmFmdChwYXJhbXM6IEdldFNjcmlwdFBhcmFtcykge1xuICAgIGNvbnN0IHdoZXJlID0gdXVpZC52YWxpZGF0ZShwYXJhbXMpID8gZXEoc2NyaXB0cy5zY3JpcHRJZCwgcGFyYW1zKSA6IGVxKHNjcmlwdHMub2xkU2NyaXB0SWQsIHBhcmFtcyk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZGIucXVlcnkuc2NyaXB0cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoc2NyaXB0cy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgb2xkU2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICBwdWJsaXNoRGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgIHZlcnNpb246IHRydWUsXG4gICAgICAgICAgICB0eXBlOiB0cnVlLFxuICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgIHByaW50VGl0bGU6IHRydWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGhvc3BpdGFsSWQ6IHRydWUsXG4gICAgICAgICAgICBleHBvcnRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgbnVpZFNlYXJjaEVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBudWlkU2VhcmNoRmllbGRzOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICB3aXRoOiB7XG4gICAgICAgICAgICBkcmFmdDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgbnVpZFNlYXJjaEZpZWxkczogcmVzLm51aWRTZWFyY2hGaWVsZHMgYXMgU2NyaXB0RmllbGRbXSxcbiAgICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmlwdE1pbmkocGFyYW1zOiBHZXRTY3JpcHRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IHV1aWQudmFsaWRhdGUocGFyYW1zKSA/IGVxKHNjcmlwdHMuc2NyaXB0SWQsIHBhcmFtcykgOiBlcShzY3JpcHRzLm9sZFNjcmlwdElkLCBwYXJhbXMpO1xuICAgIHJldHVybiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgb2xkU2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICB2ZXJzaW9uOiB0cnVlLFxuICAgICAgICAgICAgdHlwZTogdHJ1ZSxcbiAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgcHJpbnRUaXRsZTogdHJ1ZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldEZ1bGxTY3JpcHQocGFyYW1zOiBHZXRTY3JpcHRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IHV1aWQudmFsaWRhdGUocGFyYW1zKSA/IGVxKHNjcmlwdHMuc2NyaXB0SWQsIHBhcmFtcykgOiBlcShzY3JpcHRzLm9sZFNjcmlwdElkLCBwYXJhbXMpO1xuICAgIHJldHVybiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgfSk7XG59XG5cbmV4cG9ydCB0eXBlIEdldFNjcmlwdHNQYXJhbXMgPSB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgc2NyaXB0SWRzPzogc3RyaW5nW107XG4gICAgc2VhcmNoVmFsdWU/OiBzdHJpbmc7XG4gICAgYXJjaGl2ZWQ/OiBib29sZWFuO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gX19nZXRTY3JpcHRzKHtcbiAgICBsaW1pdCxcbiAgICBwYWdlID0gMSxcbiAgICBzY3JpcHRJZHMsXG4gICAgc2VhcmNoVmFsdWUsXG4gICAgYXJjaGl2ZWQsXG59OiBHZXRTY3JpcHRzUGFyYW1zKSB7XG4gICAgcGFnZSA9IE1hdGgubWF4KDAsIHBhZ2UpO1xuXG4gICAgY29uc3QgY29uZGl0aW9uczogU1FMW10gPSBbXTtcblxuICAgIGlmIChhcmNoaXZlZCkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goaXNOb3ROdWxsKHNjcmlwdHMuZGVsZXRlZEF0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGlzTnVsbChzY3JpcHRzLmRlbGV0ZWRBdCkpO1xuICAgIH1cblxuICAgIGlmIChzY3JpcHRJZHM/Lmxlbmd0aCkgY29uZGl0aW9ucy5wdXNoKGluQXJyYXkoc2NyaXB0cy5zY3JpcHRJZCwgc2NyaXB0SWRzKSk7XG5cbiAgICBzZWFyY2hWYWx1ZSA9IGAke3NlYXJjaFZhbHVlIHx8ICcnfWAudHJpbSgpO1xuICAgIGlmIChzZWFyY2hWYWx1ZSkge1xuICAgICAgICBjb25zdCBzZWFyY2ggPSBbJyUnLCBzZWFyY2hWYWx1ZSwgJyUnXS5qb2luKCcnKTtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKHNxbGBMT1dFUihzY3JpcHRzLm5hbWUpIGxpa2UgTE9XRVIoJHtzZWFyY2h9KWApO1xuICAgIH1cblxuICAgIGNvbnN0IGNvdW50UXVlcnkgPSBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSkuZnJvbShzY3JpcHRzKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbFJvd3MsIH1dID0gYXdhaXQgY291bnRRdWVyeS5leGVjdXRlKCk7XG5cbiAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG4gICAgaWYgKHRvdGFsUm93cyl7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBpc0VtcHR5KGxpbWl0KSA/IDEgOiBNYXRoLmNlaWwodG90YWxSb3dzIC8gbGltaXQhKTtcbiAgICAgICAgcGFnZSA9IE1hdGgubWluKHBhZ2UsIHRvdGFsUGFnZXMpO1xuICAgIH1cblxuICAgIGNvbnN0IG9mZnNldCA9IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogTWF0aC5tYXgoMCwgKHBhZ2UgLSAxKSAqIGxpbWl0ISk7XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NyaXB0cy5pZCxcbiAgICAgICAgICAgIHNjcmlwdElkOiBzY3JpcHRzLnNjcmlwdElkLFxuICAgICAgICAgICAgb2xkU2NyaXB0SWQ6IHNjcmlwdHMub2xkU2NyaXB0SWQsXG4gICAgICAgICAgICBwdWJsaXNoRGF0ZTogc2NyaXB0cy5wdWJsaXNoRGF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2NyaXB0cy5jcmVhdGVkQXQsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHNjcmlwdHMudXBkYXRlZEF0LFxuICAgICAgICAgICAgdmVyc2lvbjogc2NyaXB0cy52ZXJzaW9uLFxuICAgICAgICAgICAgdHlwZTogc2NyaXB0cy50eXBlLFxuICAgICAgICAgICAgcG9zaXRpb246IHNjcmlwdHMucG9zaXRpb24sXG4gICAgICAgICAgICB0aXRsZTogc2NyaXB0cy50aXRsZSxcbiAgICAgICAgICAgIHByaW50VGl0bGU6IHNjcmlwdHMucHJpbnRUaXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBzY3JpcHRzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgaG9zcGl0YWxJZDogc2NyaXB0cy5ob3NwaXRhbElkLFxuICAgICAgICAgICAgZXhwb3J0YWJsZTogc2NyaXB0cy5leHBvcnRhYmxlLFxuICAgICAgICAgICAgbnVpZFNlYXJjaEVuYWJsZWQ6IHNjcmlwdHMubnVpZFNlYXJjaEVuYWJsZWQsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHNjcmlwdHMpXG4gICAgICAgIC5sZWZ0Sm9pbihzY3JpcHRzRHJhZnRzLCBlcShzY3JpcHRzLnNjcmlwdElkLCBzY3JpcHRzRHJhZnRzLnNjcmlwdElkKSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhzY3JpcHRzLnBvc2l0aW9uKSk7XG5cbiAgICBpZiAoIWlzRW1wdHkobGltaXQpKSBxLmxpbWl0KGxpbWl0ISk7XG5cbiAgICBpZiAob2Zmc2V0KSBxLm9mZnNldChvZmZzZXQpO1xuXG4gICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoKSBxLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcS5leGVjdXRlKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwYWdlLFxuICAgICAgICBsaW1pdCxcbiAgICAgICAgZGF0YTogZGF0YS5tYXAocyA9PiAoe1xuICAgICAgICAgICAgLi4ucyxcbiAgICAgICAgICAgIHB1Ymxpc2hlZFZlcnNpb246IHMudmVyc2lvbixcbiAgICAgICAgfSkpLFxuICAgICAgICB0b3RhbFJvd3MsXG4gICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgIHNlYXJjaFZhbHVlLFxuICAgICAgICBlcnJvcjogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxuICAgIH07XG59XG5cbmV4cG9ydCBjb25zdCBfZ2V0U2NyaXB0c0RlZmF1bHRSZXN1bHRzID0ge1xuICAgIHBhZ2U6IDEsXG4gICAgbGltaXQ6IHVuZGVmaW5lZCxcbiAgICB0b3RhbFJvd3M6IDAsXG4gICAgdG90YWxQYWdlczogMSxcbiAgICBkYXRhOiBbXSxcbiAgICBzZWFyY2hWYWx1ZTogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxuICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG59IGFzIEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX19nZXRTY3JpcHRzPj47XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyaXB0cyhwYXJhbXM/OiBHZXRTY3JpcHRzUGFyYW1zKSB7XG4gICAgbGV0IHJzbHRzID0gX2dldFNjcmlwdHNEZWZhdWx0UmVzdWx0cztcblxuICAgIHRyeSB7XG4gICAgICAgIHJzbHRzID0gYXdhaXQgX19nZXRTY3JpcHRzKHsgLi4ucGFyYW1zIH0pO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2dldFNjcmlwdHMgRVJST1InLCBlKTtcbiAgICAgICAgcnNsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJzbHRzO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJlcSIsImFuZCIsImlzTnVsbCIsImNvdW50IiwiaW5BcnJheSIsImRlc2MiLCJzcWwiLCJpc05vdE51bGwiLCJub3RJbkFycmF5Iiwib3IiLCJ1dWlkIiwibG9nZ2VyIiwiaXNFbXB0eSIsImRiIiwic2NyaXB0cyIsInNjcmlwdHNEcmFmdHMiLCJfbGlzdFNjcmlwdHMiLCJzY3JpcHRzUmVmZXJlbmNlcyIsInJlc3VsdHMiLCJkYXRhIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsIndoZXJlIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwic2NyaXB0SWQiLCJzY3JpcHREcmFmdElkIiwiY29sdW1ucyIsInB1Ymxpc2hlZCIsImRlbGV0ZWRBdCIsIm1hcCIsInMiLCJwb3NpdGlvbiIsInRpdGxlIiwic2NyaXB0UmVmZXJlbmNlIiwiaXNEcmFmdCIsInNvcnQiLCJhIiwiYiIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfbGlzdFJhd1NjcmlwdHMiLCJfZ2V0TGFzdFNjcmlwdFBvc2l0aW9uIiwicmVzIiwic2VsZWN0IiwiZnJvbSIsImxpbWl0Iiwib3JkZXJCeSIsIl9jb3VudFNjcmlwdHMiLCJvcHRzIiwid2l0aEFyY2hpdmVkIiwicSIsImV4ZWN1dGUiLCJfZ2V0U2NyaXB0IiwicGFyYW1zIiwidmFsaWRhdGUiLCJvbGRTY3JpcHRJZCIsImZpbmRGaXJzdCIsImlkIiwicHVibGlzaERhdGUiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJ2ZXJzaW9uIiwidHlwZSIsInByaW50VGl0bGUiLCJkZXNjcmlwdGlvbiIsImhvc3BpdGFsSWQiLCJleHBvcnRhYmxlIiwibnVpZFNlYXJjaEVuYWJsZWQiLCJudWlkU2VhcmNoRmllbGRzIiwiX2dldFNjcmlwdFdpdGhEcmFmdCIsIndpdGgiLCJkcmFmdCIsIl9nZXRTY3JpcHRNaW5pIiwiX2dldEZ1bGxTY3JpcHQiLCJfX2dldFNjcmlwdHMiLCJwYWdlIiwic2NyaXB0SWRzIiwic2VhcmNoVmFsdWUiLCJhcmNoaXZlZCIsIk1hdGgiLCJtYXgiLCJjb25kaXRpb25zIiwicHVzaCIsInRyaW0iLCJzZWFyY2giLCJqb2luIiwiY291bnRRdWVyeSIsInRvdGFsUm93cyIsInRvdGFsUGFnZXMiLCJjZWlsIiwibWluIiwib2Zmc2V0IiwibGVmdEpvaW4iLCJwdWJsaXNoZWRWZXJzaW9uIiwiX2dldFNjcmlwdHNEZWZhdWx0UmVzdWx0cyIsIl9nZXRTY3JpcHRzIiwicnNsdHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/_scripts/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/api-keys/_get-api-keys.ts":
/*!*****************************************************!*\
  !*** ./databases/queries/api-keys/_get-api-keys.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getApiKeys: () => (/* binding */ _getApiKeys)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\nasync function _getApiKeys(params) {\n    try {\n        const where = [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.apiKeys.validUntil), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.gte)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.apiKeys.validUntil, new Date())),\n            ...!params?.apiKeys?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.apiKeys.apiKey, params.apiKeys)\n            ],\n            ...!params?.apiKeysIds?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.apiKeys.apiKeyId, params.apiKeysIds)\n            ]\n        ];\n        const data = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.apiKeys.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)(...where),\n            columns: {\n                apiKeyId: true,\n                apiKey: true\n            }\n        });\n        return {\n            data\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_getApiKeys ERROR\", e.message);\n        return {\n            data: [],\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9hcGkta2V5cy9fZ2V0LWFwaS1rZXlzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTREO0FBRXBCO0FBQ1E7QUFDZDtBQWUzQixlQUFlUSxZQUFZQyxNQUF5QjtJQUN2RCxJQUFJO1FBQ0EsTUFBTUMsUUFBUTtZQUNWTiwrQ0FBRUEsQ0FBQ0QsbURBQU1BLENBQUNHLHlEQUFPQSxDQUFDSyxVQUFVLEdBQUdWLGdEQUFHQSxDQUFDSyx5REFBT0EsQ0FBQ0ssVUFBVSxFQUFFLElBQUlDO2VBQ3ZELENBQUNILFFBQVFILFNBQVNPLFNBQVMsRUFBRSxHQUFHO2dCQUFDWCxvREFBT0EsQ0FBQ0kseURBQU9BLENBQUNRLE1BQU0sRUFBRUwsT0FBT0gsT0FBTzthQUFFO2VBQ3pFLENBQUNHLFFBQVFNLFlBQVlGLFNBQVMsRUFBRSxHQUFHO2dCQUFDWCxvREFBT0EsQ0FBQ0kseURBQU9BLENBQUNVLFFBQVEsRUFBRVAsT0FBT00sVUFBVTthQUFFO1NBQ3hGO1FBRUQsTUFBTUUsT0FBTyxNQUFNWiw2REFBRUEsQ0FBQ2EsS0FBSyxDQUFDWixPQUFPLENBQUNhLFFBQVEsQ0FBQztZQUN6Q1QsT0FBTyxDQUFDQSxNQUFNRyxNQUFNLEdBQUdPLFlBQVlwQixnREFBR0EsSUFBSVU7WUFDMUNXLFNBQVM7Z0JBQ0xMLFVBQVU7Z0JBQ1ZGLFFBQVE7WUFDWjtRQUNKO1FBRUEsT0FBUTtZQUFFRztRQUFLO0lBQ25CLEVBQUUsT0FBTUssR0FBUTtRQUNaZixtREFBTUEsQ0FBQ2dCLEtBQUssQ0FBQyxxQkFBcUJELEVBQUVFLE9BQU87UUFDM0MsT0FBTztZQUFFUCxNQUFNLEVBQUU7WUFBRVEsUUFBUTtnQkFBQ0gsRUFBRUUsT0FBTzthQUFDO1FBQUU7SUFDNUM7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvYXBpLWtleXMvX2dldC1hcGkta2V5cy50cz82NTljIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuZCwgZ3RlLCBpbkFycmF5LCBpc051bGwsIG9yIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5cbmltcG9ydCBkYiBmcm9tIFwiQC9kYXRhYmFzZXMvcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgYXBpS2V5cyB9IGZyb20gXCJAL2RhdGFiYXNlcy9wZy9zY2hlbWFcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuXG5leHBvcnQgdHlwZSBHZXRBcGlLZXlzUGFyYW1zID0ge1xuICAgIGFwaUtleXM/OiBzdHJpbmdbXTtcbiAgICBhcGlLZXlzSWRzPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgdHlwZSBHZXRBcGlLZXlzUmVzdWx0cyA9IHtcbiAgICBkYXRhOiB7XG4gICAgICAgIGFwaUtleUlkOiB0eXBlb2YgYXBpS2V5cy4kaW5mZXJTZWxlY3RbJ2FwaUtleUlkJ107XG4gICAgICAgIGFwaUtleTogdHlwZW9mIGFwaUtleXMuJGluZmVyU2VsZWN0WydhcGlLZXknXTtcbiAgICB9W107XG4gICAgZXJyb3JzPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldEFwaUtleXMocGFyYW1zPzogR2V0QXBpS2V5c1BhcmFtcyk6IFByb21pc2U8R2V0QXBpS2V5c1Jlc3VsdHM+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB3aGVyZSA9IFtcbiAgICAgICAgICAgIG9yKGlzTnVsbChhcGlLZXlzLnZhbGlkVW50aWwpLCBndGUoYXBpS2V5cy52YWxpZFVudGlsLCBuZXcgRGF0ZSgpKSksXG4gICAgICAgICAgICAuLi4oIXBhcmFtcz8uYXBpS2V5cz8ubGVuZ3RoID8gW10gOiBbaW5BcnJheShhcGlLZXlzLmFwaUtleSwgcGFyYW1zLmFwaUtleXMpXSksXG4gICAgICAgICAgICAuLi4oIXBhcmFtcz8uYXBpS2V5c0lkcz8ubGVuZ3RoID8gW10gOiBbaW5BcnJheShhcGlLZXlzLmFwaUtleUlkLCBwYXJhbXMuYXBpS2V5c0lkcyldKSxcbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZGIucXVlcnkuYXBpS2V5cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogIXdoZXJlLmxlbmd0aCA/IHVuZGVmaW5lZCA6IGFuZCguLi53aGVyZSksXG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgYXBpS2V5SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgYXBpS2V5OiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuICB7IGRhdGEgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXRBcGlLZXlzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yczogW2UubWVzc2FnZV0sIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImFuZCIsImd0ZSIsImluQXJyYXkiLCJpc051bGwiLCJvciIsImRiIiwiYXBpS2V5cyIsImxvZ2dlciIsIl9nZXRBcGlLZXlzIiwicGFyYW1zIiwid2hlcmUiLCJ2YWxpZFVudGlsIiwiRGF0ZSIsImxlbmd0aCIsImFwaUtleSIsImFwaUtleXNJZHMiLCJhcGlLZXlJZCIsImRhdGEiLCJxdWVyeSIsImZpbmRNYW55IiwidW5kZWZpbmVkIiwiY29sdW1ucyIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/api-keys/_get-api-keys.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/api-keys/index.ts":
/*!*********************************************!*\
  !*** ./databases/queries/api-keys/index.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getApiKeys: () => (/* reexport safe */ _get_api_keys__WEBPACK_IMPORTED_MODULE_0__._getApiKeys)\n/* harmony export */ });\n/* harmony import */ var _get_api_keys__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./_get-api-keys */ \"(rsc)/./databases/queries/api-keys/_get-api-keys.ts\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9hcGkta2V5cy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFnQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvYXBpLWtleXMvaW5kZXgudHM/YzUwZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgKiBmcm9tICcuL19nZXQtYXBpLWtleXMnO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/api-keys/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/auth-clients/_get-auth-clients.ts":
/*!*************************************************************!*\
  !*** ./databases/queries/auth-clients/_get-auth-clients.ts ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getAuthClients: () => (/* binding */ _getAuthClients)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\nasync function _getAuthClients(params) {\n    try {\n        const where = [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.isNull)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.authClients.validUntil), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.gte)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.authClients.validUntil, new Date())),\n            ...!params?.usersIds?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.authClients.userId, params.usersIds)\n            ],\n            ...!params?.clientIds?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.authClients.clientId, params.clientIds)\n            ],\n            ...!params?.clientTokens?.length ? [] : [\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.inArray)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.authClients.clientToken, params.clientTokens)\n            ]\n        ];\n        const data = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.authClients.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.and)(...where),\n            columns: {\n                clientId: true,\n                clientToken: true,\n                userId: true\n            }\n        });\n        return {\n            data\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_2__[\"default\"].error(\"_getAuthClients ERROR\", e.message);\n        return {\n            data: [],\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9hdXRoLWNsaWVudHMvX2dldC1hdXRoLWNsaWVudHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBNEQ7QUFFcEI7QUFDWTtBQUNsQjtBQWlCM0IsZUFBZVEsZ0JBQWdCQyxNQUE2QjtJQUMvRCxJQUFJO1FBQ0EsTUFBTUMsUUFBUTtZQUNWTiwrQ0FBRUEsQ0FBQ0QsbURBQU1BLENBQUNHLDZEQUFXQSxDQUFDSyxVQUFVLEdBQUdWLGdEQUFHQSxDQUFDSyw2REFBV0EsQ0FBQ0ssVUFBVSxFQUFFLElBQUlDO2VBQy9ELENBQUNILFFBQVFJLFVBQVVDLFNBQVMsRUFBRSxHQUFHO2dCQUFDWixvREFBT0EsQ0FBQ0ksNkRBQVdBLENBQUNTLE1BQU0sRUFBRU4sT0FBT0ksUUFBUTthQUFFO2VBQy9FLENBQUNKLFFBQVFPLFdBQVdGLFNBQVMsRUFBRSxHQUFHO2dCQUFDWixvREFBT0EsQ0FBQ0ksNkRBQVdBLENBQUNXLFFBQVEsRUFBRVIsT0FBT08sU0FBUzthQUFFO2VBQ25GLENBQUNQLFFBQVFTLGNBQWNKLFNBQVMsRUFBRSxHQUFHO2dCQUFDWixvREFBT0EsQ0FBQ0ksNkRBQVdBLENBQUNhLFdBQVcsRUFBRVYsT0FBT1MsWUFBWTthQUFFO1NBQ25HO1FBRUQsTUFBTUUsT0FBTyxNQUFNZiw2REFBRUEsQ0FBQ2dCLEtBQUssQ0FBQ2YsV0FBVyxDQUFDZ0IsUUFBUSxDQUFDO1lBQzdDWixPQUFPLENBQUNBLE1BQU1JLE1BQU0sR0FBR1MsWUFBWXZCLGdEQUFHQSxJQUFJVTtZQUMxQ2MsU0FBUztnQkFDTFAsVUFBVTtnQkFDVkUsYUFBYTtnQkFDYkosUUFBUTtZQUNaO1FBQ0o7UUFFQSxPQUFRO1lBQUVLO1FBQUs7SUFDbkIsRUFBRSxPQUFNSyxHQUFRO1FBQ1psQixtREFBTUEsQ0FBQ21CLEtBQUssQ0FBQyx5QkFBeUJELEVBQUVFLE9BQU87UUFDL0MsT0FBTztZQUFFUCxNQUFNLEVBQUU7WUFBRVEsUUFBUTtnQkFBQ0gsRUFBRUUsT0FBTzthQUFDO1FBQUU7SUFDNUM7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvYXV0aC1jbGllbnRzL19nZXQtYXV0aC1jbGllbnRzLnRzP2ExOGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYW5kLCBndGUsIGluQXJyYXksIGlzTnVsbCwgb3IgfSBmcm9tIFwiZHJpenpsZS1vcm1cIjtcblxuaW1wb3J0IGRiIGZyb20gXCJAL2RhdGFiYXNlcy9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBhdXRoQ2xpZW50cyB9IGZyb20gXCJAL2RhdGFiYXNlcy9wZy9zY2hlbWFcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuXG5leHBvcnQgdHlwZSBHZXRBdXRoQ2xpZW50c1BhcmFtcyA9IHtcbiAgICB1c2Vyc0lkcz86IHN0cmluZ1tdO1xuICAgIGNsaWVudElkcz86IHN0cmluZ1tdO1xuICAgIGNsaWVudFRva2Vucz86IHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IHR5cGUgR2V0QXV0aENsaWVudHNSZXN1bHRzID0ge1xuICAgIGRhdGE6IHtcbiAgICAgICAgY2xpZW50SWQ6IHR5cGVvZiBhdXRoQ2xpZW50cy4kaW5mZXJTZWxlY3RbJ2NsaWVudElkJ107XG4gICAgICAgIGNsaWVudFRva2VuOiB0eXBlb2YgYXV0aENsaWVudHMuJGluZmVyU2VsZWN0WydjbGllbnRUb2tlbiddO1xuICAgICAgICB1c2VySWQ6IHR5cGVvZiBhdXRoQ2xpZW50cy4kaW5mZXJTZWxlY3RbJ3VzZXJJZCddO1xuICAgIH1bXTtcbiAgICBlcnJvcnM/OiBzdHJpbmdbXTtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0QXV0aENsaWVudHMocGFyYW1zPzogR2V0QXV0aENsaWVudHNQYXJhbXMpOiBQcm9taXNlPEdldEF1dGhDbGllbnRzUmVzdWx0cz4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHdoZXJlID0gW1xuICAgICAgICAgICAgb3IoaXNOdWxsKGF1dGhDbGllbnRzLnZhbGlkVW50aWwpLCBndGUoYXV0aENsaWVudHMudmFsaWRVbnRpbCwgbmV3IERhdGUoKSkpLFxuICAgICAgICAgICAgLi4uKCFwYXJhbXM/LnVzZXJzSWRzPy5sZW5ndGggPyBbXSA6IFtpbkFycmF5KGF1dGhDbGllbnRzLnVzZXJJZCwgcGFyYW1zLnVzZXJzSWRzKV0pLFxuICAgICAgICAgICAgLi4uKCFwYXJhbXM/LmNsaWVudElkcz8ubGVuZ3RoID8gW10gOiBbaW5BcnJheShhdXRoQ2xpZW50cy5jbGllbnRJZCwgcGFyYW1zLmNsaWVudElkcyldKSxcbiAgICAgICAgICAgIC4uLighcGFyYW1zPy5jbGllbnRUb2tlbnM/Lmxlbmd0aCA/IFtdIDogW2luQXJyYXkoYXV0aENsaWVudHMuY2xpZW50VG9rZW4sIHBhcmFtcy5jbGllbnRUb2tlbnMpXSksXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5LmF1dGhDbGllbnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiAhd2hlcmUubGVuZ3RoID8gdW5kZWZpbmVkIDogYW5kKC4uLndoZXJlKSxcbiAgICAgICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgICAgICBjbGllbnRJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjbGllbnRUb2tlbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gIHsgZGF0YSB9O1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2dldEF1dGhDbGllbnRzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yczogW2UubWVzc2FnZV0sIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImFuZCIsImd0ZSIsImluQXJyYXkiLCJpc051bGwiLCJvciIsImRiIiwiYXV0aENsaWVudHMiLCJsb2dnZXIiLCJfZ2V0QXV0aENsaWVudHMiLCJwYXJhbXMiLCJ3aGVyZSIsInZhbGlkVW50aWwiLCJEYXRlIiwidXNlcnNJZHMiLCJsZW5ndGgiLCJ1c2VySWQiLCJjbGllbnRJZHMiLCJjbGllbnRJZCIsImNsaWVudFRva2VucyIsImNsaWVudFRva2VuIiwiZGF0YSIsInF1ZXJ5IiwiZmluZE1hbnkiLCJ1bmRlZmluZWQiLCJjb2x1bW5zIiwiZSIsImVycm9yIiwibWVzc2FnZSIsImVycm9ycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/auth-clients/_get-auth-clients.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/auth-clients/index.ts":
/*!*************************************************!*\
  !*** ./databases/queries/auth-clients/index.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getAuthClients: () => (/* reexport safe */ _get_auth_clients__WEBPACK_IMPORTED_MODULE_0__._getAuthClients)\n/* harmony export */ });\n/* harmony import */ var _get_auth_clients__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./_get-auth-clients */ \"(rsc)/./databases/queries/auth-clients/_get-auth-clients.ts\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9hdXRoLWNsaWVudHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0MiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL2F1dGgtY2xpZW50cy9pbmRleC50cz9kODU5Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCAqIGZyb20gJy4vX2dldC1hdXRoLWNsaWVudHMnO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/auth-clients/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/diagnoses-drafts.ts":
/*!***********************************************!*\
  !*** ./databases/queries/diagnoses-drafts.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countDiagnosesDrafts: () => (/* binding */ _countDiagnosesDrafts),\n/* harmony export */   _getDiagnosesDrafts: () => (/* binding */ _getDiagnosesDrafts),\n/* harmony export */   _getDiagnosesDraftsDefaultResults: () => (/* binding */ _getDiagnosesDraftsDefaultResults),\n/* harmony export */   _getDiagnosisDraft: () => (/* binding */ _getDiagnosisDraft),\n/* harmony export */   _getDiagnosisDraftMini: () => (/* binding */ _getDiagnosisDraftMini),\n/* harmony export */   _getFullDiagnosisDraft: () => (/* binding */ _getFullDiagnosisDraft)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\nasync function _countDiagnosesDrafts(opts) {\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts);\n    if (opts?.firstVersion) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisId));\n    if (opts?.scriptId) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptId, opts.scriptId));\n    const res = await q.execute();\n    return res[0]?.count || 0;\n}\nasync function _getDiagnosisDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            diagnosisDraftId: true,\n            scriptDraftId: true,\n            diagnosisId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            items: res.data.symptoms,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3\n        }\n    };\n}\nasync function _getDiagnosisDraftMini(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            diagnosisDraftId: true,\n            diagnosisId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            items: res.data.symptoms,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3\n        }\n    };\n}\nasync function _getFullDiagnosisDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findFirst({\n        where\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            items: res.data.symptoms,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3\n        }\n    };\n}\nasync function __getDiagnosesDrafts({ limit, page = 1, diagnosisDraftIds, scriptsDraftsIds, searchValue, withoutDiagnosisId, scriptsIds }) {\n    page = Math.max(0, page);\n    const where = [\n        !withoutDiagnosisId ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisId),\n        !scriptsIds?.length && !scriptsDraftsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.or)(!scriptsDraftsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId, scriptsDraftsIds), !scriptsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptId, scriptsIds))\n    ].filter((s)=>s);\n    searchValue = `${searchValue || \"\"}`.trim();\n    // if (searchValue) {\n    //     const search = ['%', searchValue, '%'].join('');\n    //     conditions.push(sql`json_array_elements(content->data) like LOWER(${search})`);\n    // }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts);\n    if (where.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...where));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const data = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findMany({\n        where: where.length ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...where) : undefined,\n        limit: (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : limit,\n        orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.id),\n        offset,\n        columns: {\n            id: true,\n            diagnosisDraftId: true,\n            diagnosisId: true,\n            scriptId: true,\n            data: true,\n            scriptDraftId: true\n        }\n    });\n    return {\n        page,\n        limit,\n        data: data.map(({ data, id, diagnosisId, diagnosisDraftId, scriptId, scriptDraftId })=>{\n            return {\n                ...data,\n                id,\n                scriptId,\n                scriptDraftId,\n                diagnosisDraftId,\n                isDraft: true,\n                publishedVersion: !diagnosisId ? null : Math.max(1, data.version - 1)\n            };\n        }),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getDiagnosesDraftsDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getDiagnosesDrafts(params) {\n    let rslts = _getDiagnosesDraftsDefaultResults;\n    try {\n        rslts = await __getDiagnosesDrafts({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getDiagnosisDrafts ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9kaWFnbm9zZXMtZHJhZnRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBeUU7QUFFakM7QUFDVDtBQUNnQjtBQUViO0FBRTNCLGVBQWVXLHNCQUFzQkMsSUFHM0M7SUFDRyxNQUFNQyxJQUFJTCxtREFBRUEsQ0FDUE0sTUFBTSxDQUFDO1FBQUVaLE9BQU9BLGtEQUFLQTtJQUFJLEdBQ3pCYSxJQUFJLENBQUNOLHVEQUFlQTtJQUV6QixJQUFJRyxNQUFNSSxjQUFjSCxFQUFFSSxLQUFLLENBQUNaLG1EQUFNQSxDQUFDSSx1REFBZUEsQ0FBQ1MsV0FBVztJQUVsRSxJQUFJTixNQUFNTyxVQUFVTixFQUFFSSxLQUFLLENBQUNqQiwrQ0FBRUEsQ0FBQ1MsdURBQWVBLENBQUNVLFFBQVEsRUFBRVAsS0FBS08sUUFBUTtJQUV0RSxNQUFNQyxNQUFNLE1BQU1QLEVBQUVRLE9BQU87SUFFM0IsT0FBT0QsR0FBRyxDQUFDLEVBQUUsRUFBRWxCLFNBQVM7QUFDNUI7QUFJTyxlQUFlb0IsbUJBQW1CQyxNQUErQjtJQUNwRSxNQUFNTixRQUFRakIsK0NBQUVBLENBQUNTLHVEQUFlQSxDQUFDZSxnQkFBZ0IsRUFBRUQ7SUFDbkQsTUFBTUgsTUFBTSxNQUFNWixtREFBRUEsQ0FBQ2lCLEtBQUssQ0FBQ2hCLGVBQWUsQ0FBQ2lCLFNBQVMsQ0FBQztRQUNqRFQ7UUFDQVUsU0FBUztZQUNMQyxJQUFJO1lBQ0pKLGtCQUFrQjtZQUNsQkssZUFBZTtZQUNmWCxhQUFhO1lBQ2JDLFVBQVU7WUFDVlcsTUFBTTtRQUNWO0lBQ0o7SUFDQSxPQUFPLENBQUNWLE1BQU0sT0FBTztRQUNqQixHQUFHQSxHQUFHO1FBQ05VLE1BQU07WUFDRixHQUFHVixJQUFJVSxJQUFJO1lBQ1hDLE9BQU9YLElBQUlVLElBQUksQ0FBQ0UsUUFBUTtZQUN4QkMsUUFBUWIsSUFBSVUsSUFBSSxDQUFDRyxNQUFNO1lBQ3ZCQyxRQUFRZCxJQUFJVSxJQUFJ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LG9CQUFvQjVDLE1BQWlDO0lBQ3ZFLElBQUk2QyxRQUFRRjtJQUVaLElBQUk7UUFDQUUsUUFBUSxNQUFNOUIscUJBQXFCO1lBQUUsR0FBR2YsTUFBTTtRQUFDO0lBQ25ELEVBQUUsT0FBTThDLEdBQVE7UUFDWjNELG1EQUFNQSxDQUFDdUQsS0FBSyxDQUFDLDZCQUE2Qkk7UUFDMUNELE1BQU1ILEtBQUssR0FBR0ksRUFBRUMsT0FBTztJQUMzQixTQUFVO1FBQ04sT0FBT0Y7SUFDWDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcXVlcmllcy9kaWFnbm9zZXMtZHJhZnRzLnRzP2Y4MjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGFuZCwgY291bnQsIGluQXJyYXksIGRlc2MsIGlzTnVsbCwgb3IsIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5cbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tIFwiQC9saWIvaXNFbXB0eVwiO1xuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBkaWFnbm9zZXNEcmFmdHMgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgeyBTY3JpcHRGaWVsZCwgSW1hZ2VUZXh0RmllbGQsIFNjcmlwdEltYWdlLCBTY3JpcHRJdGVtLCBEaWFnbm9zaXNTeW1wdG9tIH0gZnJvbSBcIkAvdHlwZXNcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcIkAvbGliL2xvZ2dlclwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NvdW50RGlhZ25vc2VzRHJhZnRzKG9wdHM/OiB7XG4gICAgZmlyc3RWZXJzaW9uPzogYm9vbGVhbjtcbiAgICBzY3JpcHRJZD86IHN0cmluZztcbn0pIHtcbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShkaWFnbm9zZXNEcmFmdHMpO1xuXG4gICAgaWYgKG9wdHM/LmZpcnN0VmVyc2lvbikgcS53aGVyZShpc051bGwoZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0lkKSk7XG5cbiAgICBpZiAob3B0cz8uc2NyaXB0SWQpIHEud2hlcmUoZXEoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdElkLCBvcHRzLnNjcmlwdElkKSk7XG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCBxLmV4ZWN1dGUoKTtcbiAgICBcbiAgICByZXR1cm4gcmVzWzBdPy5jb3VudCB8fCAwO1xufVxuXG5leHBvcnQgdHlwZSBHZXREaWFnbm9zaXNEcmFmdFBhcmFtcyA9IHN0cmluZztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXREaWFnbm9zaXNEcmFmdChwYXJhbXM6IEdldERpYWdub3Npc0RyYWZ0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSBlcShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgZGlhZ25vc2lzRHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICBkaWFnbm9zaXNJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgLi4ucmVzLmRhdGEsXG4gICAgICAgICAgICBpdGVtczogcmVzLmRhdGEuc3ltcHRvbXMgYXMgRGlhZ25vc2lzU3ltcHRvbVtdLFxuICAgICAgICAgICAgaW1hZ2UxOiByZXMuZGF0YS5pbWFnZTEgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UyOiByZXMuZGF0YS5pbWFnZTIgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UzOiByZXMuZGF0YS5pbWFnZTMgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICB9LFxuICAgIH07IFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldERpYWdub3Npc0RyYWZ0TWluaShwYXJhbXM6IEdldERpYWdub3Npc0RyYWZ0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSBlcShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgZGlhZ25vc2lzRHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIGRpYWdub3Npc0lkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuICFyZXMgPyBudWxsIDoge1xuICAgICAgICAuLi5yZXMsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIC4uLnJlcy5kYXRhLFxuICAgICAgICAgICAgaXRlbXM6IHJlcy5kYXRhLnN5bXB0b21zIGFzIERpYWdub3Npc1N5bXB0b21bXSxcbiAgICAgICAgICAgIGltYWdlMTogcmVzLmRhdGEuaW1hZ2UxIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgIGltYWdlMjogcmVzLmRhdGEuaW1hZ2UyIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgIGltYWdlMzogcmVzLmRhdGEuaW1hZ2UzIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgfSxcbiAgICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldEZ1bGxEaWFnbm9zaXNEcmFmdChwYXJhbXM6IEdldERpYWdub3Npc0RyYWZ0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSBlcShkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmUsXG4gICAgfSk7XG4gICAgcmV0dXJuICFyZXMgPyBudWxsIDoge1xuICAgICAgICAuLi5yZXMsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIC4uLnJlcy5kYXRhLFxuICAgICAgICAgICAgaXRlbXM6IHJlcy5kYXRhLnN5bXB0b21zIGFzIERpYWdub3Npc1N5bXB0b21bXSxcbiAgICAgICAgICAgIGltYWdlMTogcmVzLmRhdGEuaW1hZ2UxIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgIGltYWdlMjogcmVzLmRhdGEuaW1hZ2UyIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgIGltYWdlMzogcmVzLmRhdGEuaW1hZ2UzIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgfSxcbiAgICB9O1xufVxuXG5leHBvcnQgdHlwZSBHZXREaWFnbm9zZXNEcmFmdHNQYXJhbXMgPSB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgZGlhZ25vc2lzRHJhZnRJZHM/OiBzdHJpbmdbXTtcbiAgICBzY3JpcHRzRHJhZnRzSWRzPzogc3RyaW5nW107XG4gICAgc2NyaXB0c0lkcz86IHN0cmluZ1tdO1xuICAgIHNlYXJjaFZhbHVlPzogc3RyaW5nO1xuICAgIHdpdGhvdXREaWFnbm9zaXNJZD86IGJvb2xlYW47XG59O1xuXG5hc3luYyBmdW5jdGlvbiBfX2dldERpYWdub3Nlc0RyYWZ0cyh7XG4gICAgbGltaXQsXG4gICAgcGFnZSA9IDEsXG4gICAgZGlhZ25vc2lzRHJhZnRJZHMsXG4gICAgc2NyaXB0c0RyYWZ0c0lkcyxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICB3aXRob3V0RGlhZ25vc2lzSWQsXG4gICAgc2NyaXB0c0lkcyxcbn06IEdldERpYWdub3Nlc0RyYWZ0c1BhcmFtcykge1xuICAgIHBhZ2UgPSBNYXRoLm1heCgwLCBwYWdlKTtcblxuICAgIGNvbnN0IHdoZXJlID0gW1xuICAgICAgICAhd2l0aG91dERpYWdub3Npc0lkID8gdW5kZWZpbmVkIDogaXNOdWxsKGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCksXG4gICAgICAgICFzY3JpcHRzSWRzPy5sZW5ndGggJiYgIXNjcmlwdHNEcmFmdHNJZHM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IG9yKFxuICAgICAgICAgICAgIXNjcmlwdHNEcmFmdHNJZHM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHNEcmFmdHNJZHMpLFxuICAgICAgICAgICAgIXNjcmlwdHNJZHM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdElkLCBzY3JpcHRzSWRzKVxuICAgICAgICApLFxuICAgIF0uZmlsdGVyKHMgPT4gcyk7XG5cbiAgICBzZWFyY2hWYWx1ZSA9IGAke3NlYXJjaFZhbHVlIHx8ICcnfWAudHJpbSgpO1xuICAgIC8vIGlmIChzZWFyY2hWYWx1ZSkge1xuICAgIC8vICAgICBjb25zdCBzZWFyY2ggPSBbJyUnLCBzZWFyY2hWYWx1ZSwgJyUnXS5qb2luKCcnKTtcbiAgICAvLyAgICAgY29uZGl0aW9ucy5wdXNoKHNxbGBqc29uX2FycmF5X2VsZW1lbnRzKGNvbnRlbnQtPmRhdGEpIGxpa2UgTE9XRVIoJHtzZWFyY2h9KWApO1xuICAgIC8vIH1cblxuICAgIGNvbnN0IGNvdW50UXVlcnkgPSBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSkuZnJvbShkaWFnbm9zZXNEcmFmdHMpO1xuICAgIGlmICh3aGVyZS5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLndoZXJlKSk7XG5cbiAgICBjb25zdCBbeyBjb3VudDogdG90YWxSb3dzLCB9XSA9IGF3YWl0IGNvdW50UXVlcnkuZXhlY3V0ZSgpO1xuXG4gICAgbGV0IHRvdGFsUGFnZXMgPSAxO1xuICAgIGlmICh0b3RhbFJvd3Mpe1xuICAgICAgICB0b3RhbFBhZ2VzID0gaXNFbXB0eShsaW1pdCkgPyAxIDogTWF0aC5jZWlsKHRvdGFsUm93cyAvIGxpbWl0ISk7XG4gICAgICAgIHBhZ2UgPSBNYXRoLm1pbihwYWdlLCB0b3RhbFBhZ2VzKTtcbiAgICB9XG5cbiAgICBjb25zdCBvZmZzZXQgPSBpc0VtcHR5KGxpbWl0KSA/IHVuZGVmaW5lZCA6IE1hdGgubWF4KDAsIChwYWdlIC0gMSkgKiBsaW1pdCEpO1xuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlc0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB3aGVyZS5sZW5ndGggPyBhbmQoLi4ud2hlcmUpIDogdW5kZWZpbmVkLFxuICAgICAgICBsaW1pdDogaXNFbXB0eShsaW1pdCkgPyB1bmRlZmluZWQgOiBsaW1pdCEsXG4gICAgICAgIG9yZGVyQnk6IGRlc2MoZGlhZ25vc2VzRHJhZnRzLmlkKSxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICBkaWFnbm9zaXNJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwYWdlLFxuICAgICAgICBsaW1pdCxcbiAgICAgICAgZGF0YTogZGF0YS5tYXAoKHsgZGF0YSwgaWQsIGRpYWdub3Npc0lkLCBkaWFnbm9zaXNEcmFmdElkLCBzY3JpcHRJZCwgc2NyaXB0RHJhZnRJZCwgfSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIHNjcmlwdElkLFxuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQsXG4gICAgICAgICAgICAgICAgZGlhZ25vc2lzRHJhZnRJZCxcbiAgICAgICAgICAgICAgICBpc0RyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHB1Ymxpc2hlZFZlcnNpb246ICFkaWFnbm9zaXNJZCA/IG51bGwgOiBNYXRoLm1heCgxLCBkYXRhLnZlcnNpb24gLSAxKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pLFxuICAgICAgICB0b3RhbFJvd3MsXG4gICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgIHNlYXJjaFZhbHVlLFxuICAgICAgICBlcnJvcjogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxuICAgIH07XG59XG5cbmV4cG9ydCBjb25zdCBfZ2V0RGlhZ25vc2VzRHJhZnRzRGVmYXVsdFJlc3VsdHMgPSB7XG4gICAgcGFnZTogMSxcbiAgICBsaW1pdDogdW5kZWZpbmVkLFxuICAgIHRvdGFsUm93czogMCxcbiAgICB0b3RhbFBhZ2VzOiAxLFxuICAgIGRhdGE6IFtdLFxuICAgIHNlYXJjaFZhbHVlOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbn0gYXMgQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfX2dldERpYWdub3Nlc0RyYWZ0cz4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldERpYWdub3Nlc0RyYWZ0cyhwYXJhbXM/OiBHZXREaWFnbm9zZXNEcmFmdHNQYXJhbXMpIHtcbiAgICBsZXQgcnNsdHMgPSBfZ2V0RGlhZ25vc2VzRHJhZnRzRGVmYXVsdFJlc3VsdHM7XG5cbiAgICB0cnkge1xuICAgICAgICByc2x0cyA9IGF3YWl0IF9fZ2V0RGlhZ25vc2VzRHJhZnRzKHsgLi4ucGFyYW1zIH0pO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2dldERpYWdub3Npc0RyYWZ0cyBFUlJPUicsIGUpO1xuICAgICAgICByc2x0cy5lcnJvciA9IGUubWVzc2FnZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcnNsdHM7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImVxIiwiYW5kIiwiY291bnQiLCJpbkFycmF5IiwiZGVzYyIsImlzTnVsbCIsIm9yIiwiaXNFbXB0eSIsImRiIiwiZGlhZ25vc2VzRHJhZnRzIiwibG9nZ2VyIiwiX2NvdW50RGlhZ25vc2VzRHJhZnRzIiwib3B0cyIsInEiLCJzZWxlY3QiLCJmcm9tIiwiZmlyc3RWZXJzaW9uIiwid2hlcmUiLCJkaWFnbm9zaXNJZCIsInNjcmlwdElkIiwicmVzIiwiZXhlY3V0ZSIsIl9nZXREaWFnbm9zaXNEcmFmdCIsInBhcmFtcyIsImRpYWdub3Npc0RyYWZ0SWQiLCJxdWVyeSIsImZpbmRGaXJzdCIsImNvbHVtbnMiLCJpZCIsInNjcmlwdERyYWZ0SWQiLCJkYXRhIiwiaXRlbXMiLCJzeW1wdG9tcyIsImltYWdlMSIsImltYWdlMiIsImltYWdlMyIsIl9nZXREaWFnbm9zaXNEcmFmdE1pbmkiLCJfZ2V0RnVsbERpYWdub3Npc0RyYWZ0IiwiX19nZXREaWFnbm9zZXNEcmFmdHMiLCJsaW1pdCIsInBhZ2UiLCJkaWFnbm9zaXNEcmFmdElkcyIsInNjcmlwdHNEcmFmdHNJZHMiLCJzZWFyY2hWYWx1ZSIsIndpdGhvdXREaWFnbm9zaXNJZCIsInNjcmlwdHNJZHMiLCJNYXRoIiwibWF4IiwidW5kZWZpbmVkIiwibGVuZ3RoIiwiZmlsdGVyIiwicyIsInRyaW0iLCJjb3VudFF1ZXJ5IiwidG90YWxSb3dzIiwidG90YWxQYWdlcyIsImNlaWwiLCJtaW4iLCJvZmZzZXQiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJtYXAiLCJpc0RyYWZ0IiwicHVibGlzaGVkVmVyc2lvbiIsInZlcnNpb24iLCJlcnJvciIsIl9nZXREaWFnbm9zZXNEcmFmdHNEZWZhdWx0UmVzdWx0cyIsIl9nZXREaWFnbm9zZXNEcmFmdHMiLCJyc2x0cyIsImUiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/diagnoses-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/diagnoses.ts":
/*!****************************************!*\
  !*** ./databases/queries/diagnoses.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countDiagnoses: () => (/* binding */ _countDiagnoses),\n/* harmony export */   _getDiagnoses: () => (/* binding */ _getDiagnoses),\n/* harmony export */   _getDiagnosesDefaultResults: () => (/* binding */ _getDiagnosesDefaultResults),\n/* harmony export */   _getDiagnosis: () => (/* binding */ _getDiagnosis),\n/* harmony export */   _getDiagnosisMini: () => (/* binding */ _getDiagnosisMini),\n/* harmony export */   _getDiagnosisWithDraft: () => (/* binding */ _getDiagnosisWithDraft),\n/* harmony export */   _getFullDiagnosis: () => (/* binding */ _getFullDiagnosis),\n/* harmony export */   _getLastDiagnosisPosition: () => (/* binding */ _getLastDiagnosisPosition),\n/* harmony export */   _listDiagnoses: () => (/* binding */ _listDiagnoses),\n/* harmony export */   _listRawDiagnoses: () => (/* binding */ _listRawDiagnoses)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/validate.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\n\nasync function _listDiagnoses(opts) {\n    const { diagnosesReferences, scriptsReferences } = {\n        ...opts\n    };\n    const results = {\n        data: []\n    };\n    try {\n        const where = !diagnosesReferences?.length ? [] : [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisId, diagnosesReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosesReferences))\n        ];\n        if (scriptsReferences?.length) {\n            where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId, scriptsReferences)));\n        }\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where),\n            columns: {\n                diagnosisId: true,\n                diagnosisDraftId: true,\n                scriptDraftId: true,\n                scriptId: true,\n                data: true\n            }\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, drafts.map((s)=>s.data.diagnosisId))\n                ]\n            ]),\n            columns: {\n                diagnosisId: true,\n                position: true,\n                name: true,\n                scriptId: true\n            }\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>({\n                    diagnosisReference: s.diagnosisDraftId,\n                    diagnosisId: s.diagnosisId,\n                    diagnosisDraftId: s.diagnosisDraftId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true,\n                    name: s.data.name,\n                    position: s.data.position\n                }))\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    diagnosisReference: s.diagnosisId,\n                    diagnosisId: s.diagnosisId,\n                    scriptId: s.scriptId,\n                    isDraft: false,\n                    name: s.name,\n                    position: s.position\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listDiagnoses ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _listRawDiagnoses(opts) {\n    const { diagnosesReferences, scriptsReferences } = {\n        ...opts\n    };\n    const results = {\n        data: []\n    };\n    try {\n        const where = !diagnosesReferences?.length ? [] : [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisId, diagnosesReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId, diagnosesReferences))\n        ];\n        if (scriptsReferences?.length) {\n            where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId, scriptsReferences)));\n        }\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnosesDrafts.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where)\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, drafts.map((s)=>s.data.diagnosisId))\n                ]\n            ])\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>{\n                return {\n                    ...s.data,\n                    diagnosisReference: s.diagnosisDraftId,\n                    diagnosisId: s.diagnosisId || undefined,\n                    diagnosisDraftId: s.diagnosisDraftId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true\n                };\n            })\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    ...s,\n                    diagnosisReference: s.diagnosisId,\n                    diagnosisId: s.diagnosisId,\n                    scriptId: s.scriptId,\n                    isDraft: false\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listRawDiagnoses ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _getLastDiagnosisPosition() {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.position\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt)).limit(1).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.position));\n    return res[0]?.position || 0;\n}\nasync function _countDiagnoses(opts) {\n    const { withArchived } = {\n        ...opts\n    };\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses);\n    if (!withArchived) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt));\n    const res = await q.execute();\n    return res[0]?.count;\n}\nasync function _getDiagnosis(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.oldDiagnosisId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt))\n    });\n    return !res ? null : {\n        ...res,\n        symptoms: res.symptoms,\n        image1: res.image1,\n        image2: res.image2,\n        image3: res.image3\n    };\n}\nasync function _getDiagnosisWithDraft(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.oldDiagnosisId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt)),\n        with: {\n            draft: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        symptoms: res.symptoms,\n        image1: res.image1,\n        image2: res.image2,\n        image3: res.image3,\n        draft: !res.draft ? null : {\n            ...res.draft,\n            data: {\n                ...res.draft.data,\n                symptoms: res.draft.data.symptoms,\n                image1: res.draft.data.image1,\n                image2: res.draft.data.image2,\n                image3: res.draft.data.image3\n            }\n        }\n    };\n}\nasync function _getDiagnosisMini(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.oldDiagnosisId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt)),\n        columns: {\n            diagnosisId: true,\n            oldDiagnosisId: true,\n            version: true,\n            name: true\n        }\n    });\n}\nasync function _getFullDiagnosis(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.oldDiagnosisId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.diagnoses.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt))\n    });\n}\nasync function __getDiagnoses({ limit, page = 1, diagnosisIds, searchValue, archived, scriptsIds }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (archived) {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt));\n    } else {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt));\n    }\n    if (diagnosisIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, diagnosisIds));\n    if (scriptsIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.scriptId, scriptsIds));\n    searchValue = `${searchValue || \"\"}`.trim();\n    if (searchValue) {\n        const search = [\n            \"%\",\n            searchValue,\n            \"%\"\n        ].join(\"\");\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.sql)`LOWER(diagnoses.name) like LOWER(${search})`);\n    }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        id: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.id,\n        diagnosisId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId,\n        oldDiagnosisId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.oldDiagnosisId,\n        version: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.version,\n        scriptId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.scriptId,\n        key: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.key,\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.position,\n        name: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.name,\n        description: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.description,\n        source: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.source,\n        expression: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.expression,\n        severityOrder: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.severityOrder,\n        expressionMeaning: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.expressionMeaning,\n        text1: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.text1,\n        text2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.text2,\n        text3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.text3,\n        image1: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.image1,\n        image2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.image2,\n        image3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.image3,\n        symptoms: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.symptoms,\n        publishDate: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.publishDate,\n        createdAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.createdAt,\n        updatedAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.updatedAt,\n        deletedAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.deletedAt,\n        diagnosisDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisDraftId,\n        scriptDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.scriptDraftId\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses).leftJoin(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.diagnosisId, _pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnosesDrafts.diagnosisId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.diagnoses.position));\n    if (!(0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit)) q.limit(limit);\n    if (offset) q.offset(offset);\n    if (conditions.length) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const data = await q.execute();\n    return {\n        page,\n        limit,\n        data: data.map((s)=>({\n                ...s,\n                publishedVersion: s.version,\n                isDraft: false,\n                diagnosisDraftId: s.diagnosisDraftId,\n                scriptDraftId: s.scriptDraftId\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getDiagnosesDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getDiagnoses(params) {\n    let rslts = _getDiagnosesDefaultResults;\n    try {\n        rslts = await __getDiagnoses({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getDiagnoses ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDakQsaURBQUlBLENBQUNRLGlEQUFTQSxDQUFDeUIsUUFBUTtJQUVwQyxJQUFJLENBQUMzQixxREFBT0EsQ0FBQzBDLFFBQVFJLEVBQUVKLEtBQUssQ0FBQ0E7SUFFN0IsSUFBSXNDLFFBQVFsQyxFQUFFa0MsTUFBTSxDQUFDQTtJQUVyQixJQUFJVCxXQUFXM0QsTUFBTSxFQUFFa0MsRUFBRW5DLEtBQUssQ0FBQ3JCLGdEQUFHQSxJQUFJaUY7SUFFdEMsTUFBTTdELE9BQU8sTUFBTW9DLEVBQUVDLE9BQU87SUFFNUIsT0FBTztRQUNIaUI7UUFDQXRCO1FBQ0FoQyxNQUFNQSxLQUFLZSxHQUFHLENBQUNDLENBQUFBLElBQU07Z0JBQ2pCLEdBQUdBLENBQUM7Z0JBQ0pxRSxrQkFBa0JyRSxFQUFFbUMsT0FBTztnQkFDM0IvQixTQUFTO2dCQUNUaEIsa0JBQWtCWSxFQUFFWixnQkFBZ0I7Z0JBQ3BDRyxlQUFlUyxFQUFFVCxhQUFhO1lBQ2xDO1FBQ0EyRDtRQUNBQztRQUNBWDtRQUNBL0IsT0FBT2Q7SUFDWDtBQUNKO0FBRU8sTUFBTTJFLDhCQUE4QjtJQUN2Q2hDLE1BQU07SUFDTnRCLE9BQU9yQjtJQUNQdUQsV0FBVztJQUNYQyxZQUFZO0lBQ1puRSxNQUFNLEVBQUU7SUFDUndELGFBQWE3QztJQUNiYyxPQUFPZDtBQUNYLEVBQWdEO0FBRXpDLGVBQWU0RSxjQUFjaEQsTUFBMkI7SUFDM0QsSUFBSWlELFFBQVFGO0lBRVosSUFBSTtRQUNBRSxRQUFRLE1BQU1uQyxlQUFlO1lBQUUsR0FBR2QsTUFBTTtRQUFDO0lBQzdDLEVBQUUsT0FBTWYsR0FBUTtRQUNaOUIsbURBQU1BLENBQUMrQixLQUFLLENBQUMsdUJBQXVCRDtRQUNwQ2dFLE1BQU0vRCxLQUFLLEdBQUdELEVBQUVFLE9BQU87SUFDM0IsU0FBVTtRQUNOLE9BQU84RDtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL2RpYWdub3Nlcy50cz8xYjRlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVxLCBhbmQsIGlzTnVsbCwgU1FMLCBjb3VudCwgaW5BcnJheSwgZGVzYywgc3FsLCBpc05vdE51bGwsIG5vdEluQXJyYXksIG9yIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5pbXBvcnQgKiBhcyB1dWlkIGZyb20gJ3V1aWQnO1xuXG5pbXBvcnQgeyBpc0VtcHR5IH0gZnJvbSBcIkAvbGliL2lzRW1wdHlcIjtcbmltcG9ydCBkYiBmcm9tIFwiLi4vcGcvZHJpenpsZVwiO1xuaW1wb3J0IHsgZGlhZ25vc2VzLCBkaWFnbm9zZXNEcmFmdHMgfSBmcm9tIFwiLi4vcGcvc2NoZW1hXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcbmltcG9ydCB7IERpYWdub3Npc1N5bXB0b20sIFNjcmlwdEltYWdlIH0gZnJvbSBcIkAvdHlwZXNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9saXN0RGlhZ25vc2VzKG9wdHM/OiB7XG4gICAgZGlhZ25vc2VzUmVmZXJlbmNlcz86IHN0cmluZ1tdXG4gICAgc2NyaXB0c1JlZmVyZW5jZXM/OiBzdHJpbmdbXVxufSkge1xuICAgIGNvbnN0IHsgZGlhZ25vc2VzUmVmZXJlbmNlcywgc2NyaXB0c1JlZmVyZW5jZXMgfSA9IHsgLi4ub3B0cyB9O1xuXG4gICAgY29uc3QgcmVzdWx0czoge1xuICAgICAgICBlcnJvcj86IHN0cmluZztcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZGlhZ25vc2lzUmVmZXJlbmNlOiBzdHJpbmc7XG4gICAgICAgICAgICBkaWFnbm9zaXNJZD86IHN0cmluZyB8IG51bGw7XG4gICAgICAgICAgICBkaWFnbm9zaXNEcmFmdElkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICAgIHNjcmlwdElkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgICAgICAgaXNEcmFmdDogYm9vbGVhbjtcbiAgICAgICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgICAgIHBvc2l0aW9uOiBudW1iZXI7XG4gICAgICAgIH1bXTtcbiAgICB9ID0ge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgd2hlcmUgPSAhZGlhZ25vc2VzUmVmZXJlbmNlcz8ubGVuZ3RoID8gW10gOiBbb3IoXG4gICAgICAgICAgICBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNJZCwgZGlhZ25vc2VzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNEcmFmdElkLCBkaWFnbm9zZXNSZWZlcmVuY2VzKSxcbiAgICAgICAgKV07XG4gICAgICAgIGlmIChzY3JpcHRzUmVmZXJlbmNlcz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICB3aGVyZS5wdXNoKG9yKFxuICAgICAgICAgICAgICAgIGluQXJyYXkoZGlhZ25vc2VzRHJhZnRzLnNjcmlwdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6ICF3aGVyZS5sZW5ndGggPyB1bmRlZmluZWQgOiBhbmQoLi4ud2hlcmUpLFxuICAgICAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgICAgIGRpYWdub3Npc0lkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzY3JpcHRJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcHVibGlzaGVkID0gYXdhaXQgZGIucXVlcnkuZGlhZ25vc2VzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiBhbmQoLi4uW1xuICAgICAgICAgICAgICAgIGlzTnVsbChkaWFnbm9zZXMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgZHJhZnRzLm1hcChzID0+IHMuZGF0YS5kaWFnbm9zaXNJZCEpKV0pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgICAgICBkaWFnbm9zaXNJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzdWx0cy5kYXRhID0gWy4uLnJlc3VsdHMuZGF0YSwgLi4uZHJhZnRzLm1hcChzID0+ICh7XG4gICAgICAgICAgICBkaWFnbm9zaXNSZWZlcmVuY2U6IHMuZGlhZ25vc2lzRHJhZnRJZCxcbiAgICAgICAgICAgIGRpYWdub3Npc0lkOiBzLmRpYWdub3Npc0lkLFxuICAgICAgICAgICAgZGlhZ25vc2lzRHJhZnRJZDogcy5kaWFnbm9zaXNEcmFmdElkLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgICAgICBpc0RyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgbmFtZTogcy5kYXRhLm5hbWUhLFxuICAgICAgICAgICAgcG9zaXRpb246IHMuZGF0YS5wb3NpdGlvbixcbiAgICAgICAgfSkpXTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5wdWJsaXNoZWQubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIGRpYWdub3Npc1JlZmVyZW5jZTogcy5kaWFnbm9zaXNJZCxcbiAgICAgICAgICAgIGRpYWdub3Npc0lkOiBzLmRpYWdub3Npc0lkLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICBpc0RyYWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIG5hbWU6IHMubmFtZSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiBzLnBvc2l0aW9uLFxuICAgICAgICB9KSldLnNvcnQoKGEsIGIpID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19saXN0RGlhZ25vc2VzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfbGlzdFJhd0RpYWdub3NlcyhvcHRzPzoge1xuICAgIGRpYWdub3Nlc1JlZmVyZW5jZXM/OiBzdHJpbmdbXTtcbiAgICBzY3JpcHRzUmVmZXJlbmNlcz86IHN0cmluZ1tdO1xufSkge1xuICAgIGNvbnN0IHsgZGlhZ25vc2VzUmVmZXJlbmNlcywgc2NyaXB0c1JlZmVyZW5jZXMgfSA9IHsgLi4ub3B0cyB9O1xuXG4gICAgY29uc3QgcmVzdWx0czoge1xuICAgICAgICBlcnJvcj86IHN0cmluZztcbiAgICAgICAgZGF0YTogKHR5cGVvZiBkaWFnbm9zZXMuJGluZmVyU2VsZWN0ICYge1xuICAgICAgICAgICAgZGlhZ25vc2lzUmVmZXJlbmNlOiBzdHJpbmc7XG4gICAgICAgICAgICBkaWFnbm9zaXNJZD86IHN0cmluZztcbiAgICAgICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzY3JpcHRJZD86IHN0cmluZztcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBpc0RyYWZ0OiBib29sZWFuO1xuICAgICAgICB9KVtdO1xuICAgIH0gPSB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB3aGVyZSA9ICFkaWFnbm9zZXNSZWZlcmVuY2VzPy5sZW5ndGggPyBbXSA6IFtvcihcbiAgICAgICAgICAgIGluQXJyYXkoZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0lkLCBkaWFnbm9zZXNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgIGluQXJyYXkoZGlhZ25vc2VzRHJhZnRzLmRpYWdub3Npc0RyYWZ0SWQsIGRpYWdub3Nlc1JlZmVyZW5jZXMpLFxuICAgICAgICApXTtcbiAgICAgICAgaWYgKHNjcmlwdHNSZWZlcmVuY2VzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHdoZXJlLnB1c2gob3IoXG4gICAgICAgICAgICAgICAgaW5BcnJheShkaWFnbm9zZXNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICBpbkFycmF5KGRpYWdub3Nlc0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRyYWZ0cyA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlc0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogIXdoZXJlLmxlbmd0aCA/IHVuZGVmaW5lZCA6IGFuZCguLi53aGVyZSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogYW5kKC4uLltcbiAgICAgICAgICAgICAgICBpc051bGwoZGlhZ25vc2VzLmRlbGV0ZWRBdCksXG4gICAgICAgICAgICAgICAgLi4uKCFkcmFmdHMubGVuZ3RoID8gW10gOiBbbm90SW5BcnJheShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuZGlhZ25vc2lzSWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLmRyYWZ0cy5tYXAocyA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnMuZGF0YSxcbiAgICAgICAgICAgICAgICBkaWFnbm9zaXNSZWZlcmVuY2U6IHMuZGlhZ25vc2lzRHJhZnRJZCxcbiAgICAgICAgICAgICAgICBkaWFnbm9zaXNJZDogcy5kaWFnbm9zaXNJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgZGlhZ25vc2lzRHJhZnRJZDogcy5kaWFnbm9zaXNEcmFmdElkLFxuICAgICAgICAgICAgICAgIHNjcmlwdElkOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHMuc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgICAgICAgICBpc0RyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgfSBhcyB0eXBlb2YgcmVzdWx0cy5kYXRhWzBdO1xuICAgICAgICB9KV07XG5cbiAgICAgICAgcmVzdWx0cy5kYXRhID0gWy4uLnJlc3VsdHMuZGF0YSwgLi4ucHVibGlzaGVkLm1hcChzID0+ICh7XG4gICAgICAgICAgICAuLi5zLFxuICAgICAgICAgICAgZGlhZ25vc2lzUmVmZXJlbmNlOiBzLmRpYWdub3Npc0lkLFxuICAgICAgICAgICAgZGlhZ25vc2lzSWQ6IHMuZGlhZ25vc2lzSWQsXG4gICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCxcbiAgICAgICAgICAgIGlzRHJhZnQ6IGZhbHNlLFxuICAgICAgICB9KSldLnNvcnQoKGEsIGIpID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19saXN0UmF3RGlhZ25vc2VzIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0TGFzdERpYWdub3Npc1Bvc2l0aW9uKCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBwb3NpdGlvbjogZGlhZ25vc2VzLnBvc2l0aW9uLCB9KVxuICAgICAgICAuZnJvbShkaWFnbm9zZXMpXG4gICAgICAgIC53aGVyZShpc051bGwoZGlhZ25vc2VzLmRlbGV0ZWRBdCkpXG4gICAgICAgIC5saW1pdCgxKVxuICAgICAgICAub3JkZXJCeShkZXNjKGRpYWdub3Nlcy5wb3NpdGlvbikpO1xuICAgIFxuICAgIHJldHVybiByZXNbMF0/LnBvc2l0aW9uIHx8IDA7XG59IFxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2NvdW50RGlhZ25vc2VzKG9wdHM/OiB7XG4gICAgd2l0aEFyY2hpdmVkPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB7IHdpdGhBcmNoaXZlZCB9ID0geyAuLi5vcHRzIH07XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShkaWFnbm9zZXMpO1xuXG4gICAgaWYgKCF3aXRoQXJjaGl2ZWQpIHEud2hlcmUoaXNOdWxsKGRpYWdub3Nlcy5kZWxldGVkQXQpKTtcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHEuZXhlY3V0ZSgpO1xuICAgIFxuICAgIHJldHVybiByZXNbMF0/LmNvdW50O1xufSBcblxuZXhwb3J0IHR5cGUgR2V0RGlhZ25vc2lzUGFyYW1zID0gc3RyaW5nO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldERpYWdub3NpcyhwYXJhbXM6IEdldERpYWdub3Npc1BhcmFtcykge1xuICAgIGNvbnN0IHdoZXJlID0gdXVpZC52YWxpZGF0ZShwYXJhbXMpID8gZXEoZGlhZ25vc2VzLmRpYWdub3Npc0lkLCBwYXJhbXMpIDogZXEoZGlhZ25vc2VzLm9sZERpYWdub3Npc0lkLCBwYXJhbXMpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoZGlhZ25vc2VzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgc3ltcHRvbXM6IHJlcy5zeW1wdG9tcyBhcyBEaWFnbm9zaXNTeW1wdG9tW10sXG4gICAgICAgIGltYWdlMTogcmVzLmltYWdlMSBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMjogcmVzLmltYWdlMiBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMzogcmVzLmltYWdlMyBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXREaWFnbm9zaXNXaXRoRHJhZnQocGFyYW1zOiBHZXREaWFnbm9zaXNQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IHV1aWQudmFsaWRhdGUocGFyYW1zKSA/IGVxKGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgcGFyYW1zKSA6IGVxKGRpYWdub3Nlcy5vbGREaWFnbm9zaXNJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5kaWFnbm9zZXMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgaXNOdWxsKGRpYWdub3Nlcy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICB3aXRoOiB7XG4gICAgICAgICAgICBkcmFmdDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgc3ltcHRvbXM6IHJlcy5zeW1wdG9tcyBhcyBEaWFnbm9zaXNTeW1wdG9tW10sXG4gICAgICAgIGltYWdlMTogcmVzLmltYWdlMSBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMjogcmVzLmltYWdlMiBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMzogcmVzLmltYWdlMyBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGRyYWZ0OiAhcmVzLmRyYWZ0ID8gbnVsbCEgOiB7XG4gICAgICAgICAgICAuLi5yZXMuZHJhZnQsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzLmRyYWZ0LmRhdGEsXG4gICAgICAgICAgICAgICAgc3ltcHRvbXM6IHJlcy5kcmFmdC5kYXRhLnN5bXB0b21zIGFzIERpYWdub3Npc1N5bXB0b21bXSxcbiAgICAgICAgICAgICAgICBpbWFnZTE6IHJlcy5kcmFmdC5kYXRhLmltYWdlMSBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgICAgICAgICAgaW1hZ2UyOiByZXMuZHJhZnQuZGF0YS5pbWFnZTIgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgICAgIGltYWdlMzogcmVzLmRyYWZ0LmRhdGEuaW1hZ2UzIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXREaWFnbm9zaXNNaW5pKHBhcmFtczogR2V0RGlhZ25vc2lzUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIHBhcmFtcykgOiBlcShkaWFnbm9zZXMub2xkRGlhZ25vc2lzSWQsIHBhcmFtcyk7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoZGlhZ25vc2VzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGRpYWdub3Npc0lkOiB0cnVlLFxuICAgICAgICAgICAgb2xkRGlhZ25vc2lzSWQ6IHRydWUsXG4gICAgICAgICAgICB2ZXJzaW9uOiB0cnVlLFxuICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRGdWxsRGlhZ25vc2lzKHBhcmFtczogR2V0RGlhZ25vc2lzUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShkaWFnbm9zZXMuZGlhZ25vc2lzSWQsIHBhcmFtcykgOiBlcShkaWFnbm9zZXMub2xkRGlhZ25vc2lzSWQsIHBhcmFtcyk7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnF1ZXJ5LmRpYWdub3Nlcy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoZGlhZ25vc2VzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgfSk7XG59XG5cbmV4cG9ydCB0eXBlIEdldERpYWdub3Nlc1BhcmFtcyA9IHtcbiAgICBsaW1pdD86IG51bWJlcjtcbiAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgcGFnZT86IG51bWJlcjtcbiAgICBkaWFnbm9zaXNJZHM/OiBzdHJpbmdbXTtcbiAgICBzZWFyY2hWYWx1ZT86IHN0cmluZztcbiAgICBhcmNoaXZlZD86IGJvb2xlYW47XG4gICAgc2NyaXB0c0lkcz86IHN0cmluZ1tdO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gX19nZXREaWFnbm9zZXMoe1xuICAgIGxpbWl0LFxuICAgIHBhZ2UgPSAxLFxuICAgIGRpYWdub3Npc0lkcyxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICBhcmNoaXZlZCxcbiAgICBzY3JpcHRzSWRzLFxufTogR2V0RGlhZ25vc2VzUGFyYW1zKSB7XG4gICAgcGFnZSA9IE1hdGgubWF4KDAsIHBhZ2UpO1xuXG4gICAgY29uc3QgY29uZGl0aW9uczogU1FMW10gPSBbXTtcblxuICAgIGlmIChhcmNoaXZlZCkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goaXNOb3ROdWxsKGRpYWdub3Nlcy5kZWxldGVkQXQpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goaXNOdWxsKGRpYWdub3Nlcy5kZWxldGVkQXQpKTtcbiAgICB9XG5cbiAgICBpZiAoZGlhZ25vc2lzSWRzPy5sZW5ndGgpIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KGRpYWdub3Nlcy5kaWFnbm9zaXNJZCwgZGlhZ25vc2lzSWRzKSk7XG5cbiAgICBpZiAoc2NyaXB0c0lkcz8ubGVuZ3RoKSBjb25kaXRpb25zLnB1c2goaW5BcnJheShkaWFnbm9zZXMuc2NyaXB0SWQsIHNjcmlwdHNJZHMpKTtcblxuICAgIHNlYXJjaFZhbHVlID0gYCR7c2VhcmNoVmFsdWUgfHwgJyd9YC50cmltKCk7XG4gICAgaWYgKHNlYXJjaFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IFsnJScsIHNlYXJjaFZhbHVlLCAnJSddLmpvaW4oJycpO1xuICAgICAgICBjb25kaXRpb25zLnB1c2goc3FsYExPV0VSKGRpYWdub3Nlcy5uYW1lKSBsaWtlIExPV0VSKCR7c2VhcmNofSlgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb3VudFF1ZXJ5ID0gZGIuc2VsZWN0KHsgY291bnQ6IGNvdW50KCksIH0pLmZyb20oZGlhZ25vc2VzKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbFJvd3MsIH1dID0gYXdhaXQgY291bnRRdWVyeS5leGVjdXRlKCk7XG5cbiAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG4gICAgaWYgKHRvdGFsUm93cyl7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBpc0VtcHR5KGxpbWl0KSA/IDEgOiBNYXRoLmNlaWwodG90YWxSb3dzIC8gbGltaXQhKTtcbiAgICAgICAgcGFnZSA9IE1hdGgubWluKHBhZ2UsIHRvdGFsUGFnZXMpO1xuICAgIH1cblxuICAgIGNvbnN0IG9mZnNldCA9IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogTWF0aC5tYXgoMCwgKHBhZ2UgLSAxKSAqIGxpbWl0ISk7XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogZGlhZ25vc2VzLmlkLFxuICAgICAgICAgICAgZGlhZ25vc2lzSWQ6IGRpYWdub3Nlcy5kaWFnbm9zaXNJZCxcbiAgICAgICAgICAgIG9sZERpYWdub3Npc0lkOiBkaWFnbm9zZXMub2xkRGlhZ25vc2lzSWQsXG4gICAgICAgICAgICB2ZXJzaW9uOiBkaWFnbm9zZXMudmVyc2lvbixcbiAgICAgICAgICAgIHNjcmlwdElkOiBkaWFnbm9zZXMuc2NyaXB0SWQsXG4gICAgICAgICAgICBrZXk6IGRpYWdub3Nlcy5rZXksXG4gICAgICAgICAgICBwb3NpdGlvbjogZGlhZ25vc2VzLnBvc2l0aW9uLFxuICAgICAgICAgICAgbmFtZTogZGlhZ25vc2VzLm5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogZGlhZ25vc2VzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgc291cmNlOiBkaWFnbm9zZXMuc291cmNlLFxuICAgICAgICAgICAgZXhwcmVzc2lvbjogZGlhZ25vc2VzLmV4cHJlc3Npb24sXG4gICAgICAgICAgICBzZXZlcml0eU9yZGVyOiBkaWFnbm9zZXMuc2V2ZXJpdHlPcmRlcixcbiAgICAgICAgICAgIGV4cHJlc3Npb25NZWFuaW5nOiBkaWFnbm9zZXMuZXhwcmVzc2lvbk1lYW5pbmcsXG4gICAgICAgICAgICB0ZXh0MTogZGlhZ25vc2VzLnRleHQxLFxuICAgICAgICAgICAgdGV4dDI6IGRpYWdub3Nlcy50ZXh0MixcbiAgICAgICAgICAgIHRleHQzOiBkaWFnbm9zZXMudGV4dDMsXG4gICAgICAgICAgICBpbWFnZTE6IGRpYWdub3Nlcy5pbWFnZTEsXG4gICAgICAgICAgICBpbWFnZTI6IGRpYWdub3Nlcy5pbWFnZTIsXG4gICAgICAgICAgICBpbWFnZTM6IGRpYWdub3Nlcy5pbWFnZTMsXG4gICAgICAgICAgICBzeW1wdG9tczogZGlhZ25vc2VzLnN5bXB0b21zLFxuICAgICAgICAgICAgcHVibGlzaERhdGU6IGRpYWdub3Nlcy5wdWJsaXNoRGF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogZGlhZ25vc2VzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogZGlhZ25vc2VzLnVwZGF0ZWRBdCxcbiAgICAgICAgICAgIGRlbGV0ZWRBdDogZGlhZ25vc2VzLmRlbGV0ZWRBdCxcbiAgICAgICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IGRpYWdub3Nlc0RyYWZ0cy5kaWFnbm9zaXNEcmFmdElkLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogZGlhZ25vc2VzRHJhZnRzLnNjcmlwdERyYWZ0SWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGRpYWdub3NlcylcbiAgICAgICAgLmxlZnRKb2luKGRpYWdub3Nlc0RyYWZ0cywgZXEoZGlhZ25vc2VzLmRpYWdub3Npc0lkLCBkaWFnbm9zZXNEcmFmdHMuZGlhZ25vc2lzSWQpKVxuICAgICAgICAub3JkZXJCeShkZXNjKGRpYWdub3Nlcy5wb3NpdGlvbikpO1xuXG4gICAgaWYgKCFpc0VtcHR5KGxpbWl0KSkgcS5saW1pdChsaW1pdCEpO1xuXG4gICAgaWYgKG9mZnNldCkgcS5vZmZzZXQob2Zmc2V0KTtcblxuICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCkgcS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHEuZXhlY3V0ZSgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIGRhdGE6IGRhdGEubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIC4uLnMsXG4gICAgICAgICAgICBwdWJsaXNoZWRWZXJzaW9uOiBzLnZlcnNpb24sXG4gICAgICAgICAgICBpc0RyYWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIGRpYWdub3Npc0RyYWZ0SWQ6IHMuZGlhZ25vc2lzRHJhZnRJZCBhcyB0eXBlb2YgZGlhZ25vc2VzRHJhZnRzLiRpbmZlclNlbGVjdFsnZGlhZ25vc2lzRHJhZnRJZCddIHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogcy5zY3JpcHREcmFmdElkIGFzIHR5cGVvZiBkaWFnbm9zZXNEcmFmdHMuJGluZmVyU2VsZWN0WydzY3JpcHREcmFmdElkJ10gfCB1bmRlZmluZWQsXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWxSb3dzLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICB9O1xufVxuXG5leHBvcnQgY29uc3QgX2dldERpYWdub3Nlc0RlZmF1bHRSZXN1bHRzID0ge1xuICAgIHBhZ2U6IDEsXG4gICAgbGltaXQ6IHVuZGVmaW5lZCxcbiAgICB0b3RhbFJvd3M6IDAsXG4gICAgdG90YWxQYWdlczogMSxcbiAgICBkYXRhOiBbXSxcbiAgICBzZWFyY2hWYWx1ZTogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxuICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG59IGFzIEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX19nZXREaWFnbm9zZXM+PjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXREaWFnbm9zZXMocGFyYW1zPzogR2V0RGlhZ25vc2VzUGFyYW1zKSB7XG4gICAgbGV0IHJzbHRzID0gX2dldERpYWdub3Nlc0RlZmF1bHRSZXN1bHRzO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAgIHJzbHRzID0gYXdhaXQgX19nZXREaWFnbm9zZXMoeyAuLi5wYXJhbXMgfSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfZ2V0RGlhZ25vc2VzIEVSUk9SJywgZSk7XG4gICAgICAgIHJzbHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByc2x0cztcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZXEiLCJhbmQiLCJpc051bGwiLCJjb3VudCIsImluQXJyYXkiLCJkZXNjIiwic3FsIiwiaXNOb3ROdWxsIiwibm90SW5BcnJheSIsIm9yIiwidXVpZCIsImlzRW1wdHkiLCJkYiIsImRpYWdub3NlcyIsImRpYWdub3Nlc0RyYWZ0cyIsImxvZ2dlciIsIl9saXN0RGlhZ25vc2VzIiwib3B0cyIsImRpYWdub3Nlc1JlZmVyZW5jZXMiLCJzY3JpcHRzUmVmZXJlbmNlcyIsInJlc3VsdHMiLCJkYXRhIiwid2hlcmUiLCJsZW5ndGgiLCJkaWFnbm9zaXNJZCIsImRpYWdub3Npc0RyYWZ0SWQiLCJwdXNoIiwic2NyaXB0SWQiLCJzY3JpcHREcmFmdElkIiwiZHJhZnRzIiwicXVlcnkiLCJmaW5kTWFueSIsInVuZGVmaW5lZCIsImNvbHVtbnMiLCJwdWJsaXNoZWQiLCJkZWxldGVkQXQiLCJtYXAiLCJzIiwicG9zaXRpb24iLCJuYW1lIiwiZGlhZ25vc2lzUmVmZXJlbmNlIiwiaXNEcmFmdCIsInNvcnQiLCJhIiwiYiIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfbGlzdFJhd0RpYWdub3NlcyIsIl9nZXRMYXN0RGlhZ25vc2lzUG9zaXRpb24iLCJyZXMiLCJzZWxlY3QiLCJmcm9tIiwibGltaXQiLCJvcmRlckJ5IiwiX2NvdW50RGlhZ25vc2VzIiwid2l0aEFyY2hpdmVkIiwicSIsImV4ZWN1dGUiLCJfZ2V0RGlhZ25vc2lzIiwicGFyYW1zIiwidmFsaWRhdGUiLCJvbGREaWFnbm9zaXNJZCIsImZpbmRGaXJzdCIsInN5bXB0b21zIiwiaW1hZ2UxIiwiaW1hZ2UyIiwiaW1hZ2UzIiwiX2dldERpYWdub3Npc1dpdGhEcmFmdCIsIndpdGgiLCJkcmFmdCIsIl9nZXREaWFnbm9zaXNNaW5pIiwidmVyc2lvbiIsIl9nZXRGdWxsRGlhZ25vc2lzIiwiX19nZXREaWFnbm9zZXMiLCJwYWdlIiwiZGlhZ25vc2lzSWRzIiwic2VhcmNoVmFsdWUiLCJhcmNoaXZlZCIsInNjcmlwdHNJZHMiLCJNYXRoIiwibWF4IiwiY29uZGl0aW9ucyIsInRyaW0iLCJzZWFyY2giLCJqb2luIiwiY291bnRRdWVyeSIsInRvdGFsUm93cyIsInRvdGFsUGFnZXMiLCJjZWlsIiwibWluIiwib2Zmc2V0IiwiaWQiLCJrZXkiLCJkZXNjcmlwdGlvbiIsInNvdXJjZSIsImV4cHJlc3Npb24iLCJzZXZlcml0eU9yZGVyIiwiZXhwcmVzc2lvbk1lYW5pbmciLCJ0ZXh0MSIsInRleHQyIiwidGV4dDMiLCJwdWJsaXNoRGF0ZSIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsImxlZnRKb2luIiwicHVibGlzaGVkVmVyc2lvbiIsIl9nZXREaWFnbm9zZXNEZWZhdWx0UmVzdWx0cyIsIl9nZXREaWFnbm9zZXMiLCJyc2x0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/diagnoses.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/editor-info/_editor-info-get.ts":
/*!***********************************************************!*\
  !*** ./databases/queries/editor-info/_editor-info-get.ts ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getEditorInfo: () => (/* binding */ _getEditorInfo)\n/* harmony export */ });\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\nasync function _getEditorInfo() {\n    try {\n        const data = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.editorInfo.findFirst();\n        return {\n            data: data || null\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__[\"default\"].error(\"_getEditorInfo ERROR\", e.message);\n        return {\n            data: null,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9lZGl0b3ItaW5mby9fZWRpdG9yLWluZm8tZ2V0LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF3QztBQUVOO0FBTzNCLGVBQWVFO0lBQ2xCLElBQUk7UUFDQSxNQUFNQyxPQUFPLE1BQU1ILDZEQUFFQSxDQUFDSSxLQUFLLENBQUNDLFVBQVUsQ0FBQ0MsU0FBUztRQUVoRCxPQUFRO1lBQUVILE1BQU1BLFFBQVE7UUFBTTtJQUNsQyxFQUFFLE9BQU1JLEdBQVE7UUFDWk4sbURBQU1BLENBQUNPLEtBQUssQ0FBQyx3QkFBd0JELEVBQUVFLE9BQU87UUFDOUMsT0FBTztZQUFFTixNQUFNO1lBQU1PLFFBQVE7Z0JBQUNILEVBQUVFLE9BQU87YUFBQztRQUFFO0lBQzlDO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL2VkaXRvci1pbmZvL19lZGl0b3ItaW5mby1nZXQudHM/OTRjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGIgZnJvbSBcIkAvZGF0YWJhc2VzL3BnL2RyaXp6bGVcIjtcbmltcG9ydCB7IGVkaXRvckluZm8gfSBmcm9tIFwiQC9kYXRhYmFzZXMvcGcvc2NoZW1hXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcblxuZXhwb3J0IHR5cGUgR2V0RWRpdG9ySW5mb1Jlc3VsdHMgPSB7XG4gICAgZGF0YTogbnVsbCB8IHR5cGVvZiBlZGl0b3JJbmZvLiRpbmZlclNlbGVjdDtcbiAgICBlcnJvcnM/OiBzdHJpbmdbXTtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0RWRpdG9ySW5mbygpOiBQcm9taXNlPEdldEVkaXRvckluZm9SZXN1bHRzPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5LmVkaXRvckluZm8uZmluZEZpcnN0KCk7XG5cbiAgICAgICAgcmV0dXJuICB7IGRhdGE6IGRhdGEgfHwgbnVsbCwgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXRFZGl0b3JJbmZvIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogbnVsbCwgZXJyb3JzOiBbZS5tZXNzYWdlXSwgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZGIiLCJsb2dnZXIiLCJfZ2V0RWRpdG9ySW5mbyIsImRhdGEiLCJxdWVyeSIsImVkaXRvckluZm8iLCJmaW5kRmlyc3QiLCJlIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXJyb3JzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/editor-info/_editor-info-get.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/editor-info/index.ts":
/*!************************************************!*\
  !*** ./databases/queries/editor-info/index.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getEditorInfo: () => (/* reexport safe */ _editor_info_get__WEBPACK_IMPORTED_MODULE_0__._getEditorInfo)\n/* harmony export */ });\n/* harmony import */ var _editor_info_get__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./_editor-info-get */ \"(rsc)/./databases/queries/editor-info/_editor-info-get.ts\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9lZGl0b3ItaW5mby9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFtQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvZWRpdG9yLWluZm8vaW5kZXgudHM/NjFlNiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgKiBmcm9tICcuL19lZGl0b3ItaW5mby1nZXQnO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/editor-info/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/ops/_get-last-changes-dates.ts":
/*!**********************************************************!*\
  !*** ./databases/queries/ops/_get-last-changes-dates.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getDatesWhenUpdatesWereMade: () => (/* binding */ _getDatesWhenUpdatesWereMade),\n/* harmony export */   defaultChangesDates: () => (/* binding */ defaultChangesDates)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n\n\n\n\nconst defaultChangesDates = {\n    configKeys: null,\n    diagnoses: null,\n    screens: null,\n    scripts: null,\n    configKeysDrafts: null,\n    diagnosesDrafts: null,\n    screensDrafts: null,\n    scriptsDrafts: null,\n    pendingDeletion: null,\n    lastPublished: null\n};\nasync function _getDatesWhenUpdatesWereMade() {\n    try {\n        const editor = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].query.editorInfo.findFirst();\n        const configKeysDraftsRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            configKeysDrafts: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts.updatedAt)).limit(1);\n        const diagnosesDraftsRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            diagnosesDrafts: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts.updatedAt)).limit(1);\n        const screensDraftsRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            screensDrafts: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts.updatedAt)).limit(1);\n        const scriptsDraftsRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            scriptsDrafts: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts.updatedAt)).limit(1);\n        const configKeysRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            configKeys: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeys.updatedAt)).limit(1);\n        const diagnosesRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            diagnoses: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnoses.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnoses).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnoses.updatedAt)).limit(1);\n        const screensRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            screens: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screens.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screens).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screens.updatedAt)).limit(1);\n        const scriptsRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            scripts: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.updatedAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scripts.updatedAt)).limit(1);\n        const pendingDeletionRes = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            pendingDeletion: _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.createdAt\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_3__.desc)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion.createdAt)).limit(1);\n        return {\n            data: {\n                ...defaultChangesDates,\n                ...configKeysDraftsRes[0],\n                ...diagnosesDraftsRes[0],\n                ...screensDraftsRes[0],\n                ...scriptsDraftsRes[0],\n                ...configKeysRes[0],\n                ...diagnosesRes[0],\n                ...screensRes[0],\n                ...scriptsRes[0],\n                ...pendingDeletionRes[0],\n                lastPublished: editor?.lastPublishDate || null\n            }\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_getDatesWhenUpdatesWereMade ERROR\", e.message);\n        return {\n            data: defaultChangesDates,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9vcHMvX2dldC1sYXN0LWNoYW5nZXMtZGF0ZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQW1DO0FBRUQ7QUFXSDtBQUNHO0FBRTNCLE1BQU1ZLHNCQUFzQjtJQUMvQlYsWUFBWTtJQUNaQyxXQUFXO0lBQ1hDLFNBQVM7SUFDVEMsU0FBUztJQUNUQyxrQkFBa0I7SUFDbEJDLGlCQUFpQjtJQUNqQkMsZUFBZTtJQUNmQyxlQUFlO0lBQ2ZDLGlCQUFpQjtJQUNqQkcsZUFBZTtBQUNuQixFQUFFO0FBRUssZUFBZUM7SUFDbEIsSUFBSTtRQUNBLE1BQU1DLFNBQVMsTUFBTUosbURBQUVBLENBQUNLLEtBQUssQ0FBQ0MsVUFBVSxDQUFDQyxTQUFTO1FBRWxELE1BQU1DLHNCQUFzQixNQUFNUixtREFBRUEsQ0FDL0JTLE1BQU0sQ0FBQztZQUFFZCxrQkFBa0JBLGtFQUFnQkEsQ0FBQ2UsU0FBUztRQUFFLEdBQ3ZEQyxJQUFJLENBQUNoQixrRUFBZ0JBLEVBQUVpQixPQUFPLENBQUN2QixpREFBSUEsQ0FBQ00sa0VBQWdCQSxDQUFDZSxTQUFTLEdBQzlERyxLQUFLLENBQUM7UUFFWCxNQUFNQyxxQkFBcUIsTUFBTWQsbURBQUVBLENBQzlCUyxNQUFNLENBQUM7WUFBRWIsaUJBQWlCQSxpRUFBZUEsQ0FBQ2MsU0FBUztRQUFFLEdBQ3JEQyxJQUFJLENBQUNmLGlFQUFlQSxFQUFFZ0IsT0FBTyxDQUFDdkIsaURBQUlBLENBQUNPLGlFQUFlQSxDQUFDYyxTQUFTLEdBQzVERyxLQUFLLENBQUM7UUFFWCxNQUFNRSxtQkFBbUIsTUFBTWYsbURBQUVBLENBQzVCUyxNQUFNLENBQUM7WUFBRVosZUFBZUEsK0RBQWFBLENBQUNhLFNBQVM7UUFBRSxHQUNqREMsSUFBSSxDQUFDZCwrREFBYUEsRUFBRWUsT0FBTyxDQUFDdkIsaURBQUlBLENBQUNRLCtEQUFhQSxDQUFDYSxTQUFTLEdBQ3hERyxLQUFLLENBQUM7UUFFWCxNQUFNRyxtQkFBbUIsTUFBTWhCLG1EQUFFQSxDQUM1QlMsTUFBTSxDQUFDO1lBQUVYLGVBQWVBLCtEQUFhQSxDQUFDWSxTQUFTO1FBQUUsR0FDakRDLElBQUksQ0FBQ2IsK0RBQWFBLEVBQUVjLE9BQU8sQ0FBQ3ZCLGlEQUFJQSxDQUFDUywrREFBYUEsQ0FBQ1ksU0FBUyxHQUN4REcsS0FBSyxDQUFDO1FBRVgsTUFBTUksZ0JBQWdCLE1BQU1qQixtREFBRUEsQ0FDekJTLE1BQU0sQ0FBQztZQUFFbEIsWUFBWUEsNERBQVVBLENBQUNtQixTQUFTO1FBQUUsR0FDM0NDLElBQUksQ0FBQ3BCLDREQUFVQSxFQUFFcUIsT0FBTyxDQUFDdkIsaURBQUlBLENBQUNFLDREQUFVQSxDQUFDbUIsU0FBUyxHQUNsREcsS0FBSyxDQUFDO1FBRVgsTUFBTUssZUFBZSxNQUFNbEIsbURBQUVBLENBQ3hCUyxNQUFNLENBQUM7WUFBRWpCLFdBQVdBLDJEQUFTQSxDQUFDa0IsU0FBUztRQUFFLEdBQ3pDQyxJQUFJLENBQUNuQiwyREFBU0EsRUFBRW9CLE9BQU8sQ0FBQ3ZCLGlEQUFJQSxDQUFDRywyREFBU0EsQ0FBQ2tCLFNBQVMsR0FDaERHLEtBQUssQ0FBQztRQUVYLE1BQU1NLGFBQWEsTUFBTW5CLG1EQUFFQSxDQUN0QlMsTUFBTSxDQUFDO1lBQUVoQixTQUFTQSx5REFBT0EsQ0FBQ2lCLFNBQVM7UUFBRSxHQUNyQ0MsSUFBSSxDQUFDbEIseURBQU9BLEVBQUVtQixPQUFPLENBQUN2QixpREFBSUEsQ0FBQ0kseURBQU9BLENBQUNpQixTQUFTLEdBQzVDRyxLQUFLLENBQUM7UUFFWCxNQUFNTyxhQUFhLE1BQU1wQixtREFBRUEsQ0FDdEJTLE1BQU0sQ0FBQztZQUFFZixTQUFTQSx5REFBT0EsQ0FBQ2dCLFNBQVM7UUFBRSxHQUNyQ0MsSUFBSSxDQUFDakIseURBQU9BLEVBQUVrQixPQUFPLENBQUN2QixpREFBSUEsQ0FBQ0sseURBQU9BLENBQUNnQixTQUFTLEdBQzVDRyxLQUFLLENBQUM7UUFFWCxNQUFNUSxxQkFBcUIsTUFBTXJCLG1EQUFFQSxDQUM5QlMsTUFBTSxDQUFDO1lBQUVWLGlCQUFpQkEsaUVBQWVBLENBQUN1QixTQUFTO1FBQUUsR0FDckRYLElBQUksQ0FBQ1osaUVBQWVBLEVBQUVhLE9BQU8sQ0FBQ3ZCLGlEQUFJQSxDQUFDVSxpRUFBZUEsQ0FBQ3VCLFNBQVMsR0FDNURULEtBQUssQ0FBQztRQUVYLE9BQU87WUFDSFUsTUFBTTtnQkFDRixHQUFHdEIsbUJBQW1CO2dCQUN0QixHQUFHTyxtQkFBbUIsQ0FBQyxFQUFFO2dCQUN6QixHQUFHTSxrQkFBa0IsQ0FBQyxFQUFFO2dCQUN4QixHQUFHQyxnQkFBZ0IsQ0FBQyxFQUFFO2dCQUN0QixHQUFHQyxnQkFBZ0IsQ0FBQyxFQUFFO2dCQUN0QixHQUFHQyxhQUFhLENBQUMsRUFBRTtnQkFDbkIsR0FBR0MsWUFBWSxDQUFDLEVBQUU7Z0JBQ2xCLEdBQUdDLFVBQVUsQ0FBQyxFQUFFO2dCQUNoQixHQUFHQyxVQUFVLENBQUMsRUFBRTtnQkFDaEIsR0FBR0Msa0JBQWtCLENBQUMsRUFBRTtnQkFDeEJuQixlQUFlRSxRQUFRb0IsbUJBQW1CO1lBQzlDO1FBQ0o7SUFDSixFQUFFLE9BQU1DLEdBQVE7UUFDWm5DLG1EQUFNQSxDQUFDb0MsS0FBSyxDQUFDLHNDQUFzQ0QsRUFBRUUsT0FBTztRQUM1RCxPQUFPO1lBQUVKLE1BQU10QjtZQUFxQjJCLFFBQVE7Z0JBQUNILEVBQUVFLE9BQU87YUFBQztRQUFFO0lBQzdEO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL29wcy9fZ2V0LWxhc3QtY2hhbmdlcy1kYXRlcy50cz82MjBiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2MgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbmltcG9ydCBsb2dnZXIgZnJvbSAnQC9saWIvbG9nZ2VyJztcbmltcG9ydCB7IFxuICAgIGNvbmZpZ0tleXMsIFxuICAgIGRpYWdub3NlcyxcbiAgICBzY3JlZW5zLCBcbiAgICBzY3JpcHRzLFxuICAgIGNvbmZpZ0tleXNEcmFmdHMsXG4gICAgZGlhZ25vc2VzRHJhZnRzLFxuICAgIHNjcmVlbnNEcmFmdHMsXG4gICAgc2NyaXB0c0RyYWZ0cyAsXG4gICAgcGVuZGluZ0RlbGV0aW9uXG59IGZyb20gJ0AvZGF0YWJhc2VzL3BnL3NjaGVtYSc7XG5pbXBvcnQgZGIgZnJvbSAnLi4vLi4vcGcvZHJpenpsZSc7XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0Q2hhbmdlc0RhdGVzID0ge1xuICAgIGNvbmZpZ0tleXM6IG51bGwgYXMgbnVsbCB8IERhdGUsIFxuICAgIGRpYWdub3NlczogbnVsbCBhcyBudWxsIHwgRGF0ZSxcbiAgICBzY3JlZW5zOiBudWxsIGFzIG51bGwgfCBEYXRlLCBcbiAgICBzY3JpcHRzOiBudWxsIGFzIG51bGwgfCBEYXRlLFxuICAgIGNvbmZpZ0tleXNEcmFmdHM6IG51bGwgYXMgbnVsbCB8IERhdGUsXG4gICAgZGlhZ25vc2VzRHJhZnRzOiBudWxsIGFzIG51bGwgfCBEYXRlLFxuICAgIHNjcmVlbnNEcmFmdHM6IG51bGwgYXMgbnVsbCB8IERhdGUsXG4gICAgc2NyaXB0c0RyYWZ0czogbnVsbCBhcyBudWxsIHwgRGF0ZSAsXG4gICAgcGVuZGluZ0RlbGV0aW9uOiBudWxsIGFzIG51bGwgfCBEYXRlLFxuICAgIGxhc3RQdWJsaXNoZWQ6IG51bGwgYXMgbnVsbCB8IERhdGUsXG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldERhdGVzV2hlblVwZGF0ZXNXZXJlTWFkZSgpOiBQcm9taXNlPHsgZGF0YTogdHlwZW9mIGRlZmF1bHRDaGFuZ2VzRGF0ZXM7IGVycm9ycz86IHN0cmluZ1tdOyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gYXdhaXQgZGIucXVlcnkuZWRpdG9ySW5mby5maW5kRmlyc3QoKTtcblxuICAgICAgICBjb25zdCBjb25maWdLZXlzRHJhZnRzUmVzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBjb25maWdLZXlzRHJhZnRzOiBjb25maWdLZXlzRHJhZnRzLnVwZGF0ZWRBdCwgfSlcbiAgICAgICAgICAgIC5mcm9tKGNvbmZpZ0tleXNEcmFmdHMpLm9yZGVyQnkoZGVzYyhjb25maWdLZXlzRHJhZnRzLnVwZGF0ZWRBdCkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgY29uc3QgZGlhZ25vc2VzRHJhZnRzUmVzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBkaWFnbm9zZXNEcmFmdHM6IGRpYWdub3Nlc0RyYWZ0cy51cGRhdGVkQXQsIH0pXG4gICAgICAgICAgICAuZnJvbShkaWFnbm9zZXNEcmFmdHMpLm9yZGVyQnkoZGVzYyhkaWFnbm9zZXNEcmFmdHMudXBkYXRlZEF0KSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBjb25zdCBzY3JlZW5zRHJhZnRzUmVzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBzY3JlZW5zRHJhZnRzOiBzY3JlZW5zRHJhZnRzLnVwZGF0ZWRBdCwgfSlcbiAgICAgICAgICAgIC5mcm9tKHNjcmVlbnNEcmFmdHMpLm9yZGVyQnkoZGVzYyhzY3JlZW5zRHJhZnRzLnVwZGF0ZWRBdCkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgY29uc3Qgc2NyaXB0c0RyYWZ0c1JlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHsgc2NyaXB0c0RyYWZ0czogc2NyaXB0c0RyYWZ0cy51cGRhdGVkQXQsIH0pXG4gICAgICAgICAgICAuZnJvbShzY3JpcHRzRHJhZnRzKS5vcmRlckJ5KGRlc2Moc2NyaXB0c0RyYWZ0cy51cGRhdGVkQXQpKVxuICAgICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGNvbnN0IGNvbmZpZ0tleXNSZXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IGNvbmZpZ0tleXM6IGNvbmZpZ0tleXMudXBkYXRlZEF0LCB9KVxuICAgICAgICAgICAgLmZyb20oY29uZmlnS2V5cykub3JkZXJCeShkZXNjKGNvbmZpZ0tleXMudXBkYXRlZEF0KSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBjb25zdCBkaWFnbm9zZXNSZXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IGRpYWdub3NlczogZGlhZ25vc2VzLnVwZGF0ZWRBdCwgfSlcbiAgICAgICAgICAgIC5mcm9tKGRpYWdub3Nlcykub3JkZXJCeShkZXNjKGRpYWdub3Nlcy51cGRhdGVkQXQpKVxuICAgICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGNvbnN0IHNjcmVlbnNSZXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IHNjcmVlbnM6IHNjcmVlbnMudXBkYXRlZEF0LCB9KVxuICAgICAgICAgICAgLmZyb20oc2NyZWVucykub3JkZXJCeShkZXNjKHNjcmVlbnMudXBkYXRlZEF0KSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBjb25zdCBzY3JpcHRzUmVzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBzY3JpcHRzOiBzY3JpcHRzLnVwZGF0ZWRBdCwgfSlcbiAgICAgICAgICAgIC5mcm9tKHNjcmlwdHMpLm9yZGVyQnkoZGVzYyhzY3JpcHRzLnVwZGF0ZWRBdCkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgY29uc3QgcGVuZGluZ0RlbGV0aW9uUmVzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBwZW5kaW5nRGVsZXRpb246IHBlbmRpbmdEZWxldGlvbi5jcmVhdGVkQXQsIH0pXG4gICAgICAgICAgICAuZnJvbShwZW5kaW5nRGVsZXRpb24pLm9yZGVyQnkoZGVzYyhwZW5kaW5nRGVsZXRpb24uY3JlYXRlZEF0KSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAuLi5kZWZhdWx0Q2hhbmdlc0RhdGVzLFxuICAgICAgICAgICAgICAgIC4uLmNvbmZpZ0tleXNEcmFmdHNSZXNbMF0sXG4gICAgICAgICAgICAgICAgLi4uZGlhZ25vc2VzRHJhZnRzUmVzWzBdLFxuICAgICAgICAgICAgICAgIC4uLnNjcmVlbnNEcmFmdHNSZXNbMF0sXG4gICAgICAgICAgICAgICAgLi4uc2NyaXB0c0RyYWZ0c1Jlc1swXSxcbiAgICAgICAgICAgICAgICAuLi5jb25maWdLZXlzUmVzWzBdLFxuICAgICAgICAgICAgICAgIC4uLmRpYWdub3Nlc1Jlc1swXSxcbiAgICAgICAgICAgICAgICAuLi5zY3JlZW5zUmVzWzBdLFxuICAgICAgICAgICAgICAgIC4uLnNjcmlwdHNSZXNbMF0sXG4gICAgICAgICAgICAgICAgLi4ucGVuZGluZ0RlbGV0aW9uUmVzWzBdLFxuICAgICAgICAgICAgICAgIGxhc3RQdWJsaXNoZWQ6IGVkaXRvcj8ubGFzdFB1Ymxpc2hEYXRlIHx8IG51bGwsXG4gICAgICAgICAgICB9LCBcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXREYXRlc1doZW5VcGRhdGVzV2VyZU1hZGUgRVJST1InLCBlLm1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4geyBkYXRhOiBkZWZhdWx0Q2hhbmdlc0RhdGVzLCBlcnJvcnM6IFtlLm1lc3NhZ2VdLCB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJkZXNjIiwibG9nZ2VyIiwiY29uZmlnS2V5cyIsImRpYWdub3NlcyIsInNjcmVlbnMiLCJzY3JpcHRzIiwiY29uZmlnS2V5c0RyYWZ0cyIsImRpYWdub3Nlc0RyYWZ0cyIsInNjcmVlbnNEcmFmdHMiLCJzY3JpcHRzRHJhZnRzIiwicGVuZGluZ0RlbGV0aW9uIiwiZGIiLCJkZWZhdWx0Q2hhbmdlc0RhdGVzIiwibGFzdFB1Ymxpc2hlZCIsIl9nZXREYXRlc1doZW5VcGRhdGVzV2VyZU1hZGUiLCJlZGl0b3IiLCJxdWVyeSIsImVkaXRvckluZm8iLCJmaW5kRmlyc3QiLCJjb25maWdLZXlzRHJhZnRzUmVzIiwic2VsZWN0IiwidXBkYXRlZEF0IiwiZnJvbSIsIm9yZGVyQnkiLCJsaW1pdCIsImRpYWdub3Nlc0RyYWZ0c1JlcyIsInNjcmVlbnNEcmFmdHNSZXMiLCJzY3JpcHRzRHJhZnRzUmVzIiwiY29uZmlnS2V5c1JlcyIsImRpYWdub3Nlc1JlcyIsInNjcmVlbnNSZXMiLCJzY3JpcHRzUmVzIiwicGVuZGluZ0RlbGV0aW9uUmVzIiwiY3JlYXRlZEF0IiwiZGF0YSIsImxhc3RQdWJsaXNoRGF0ZSIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJlcnJvcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/ops/_get-last-changes-dates.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/ops/index.ts":
/*!****************************************!*\
  !*** ./databases/queries/ops/index.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countDrafts: () => (/* binding */ _countDrafts),\n/* harmony export */   _countPendingDeletion: () => (/* binding */ _countPendingDeletion),\n/* harmony export */   _getDatesWhenUpdatesWereMade: () => (/* reexport safe */ _get_last_changes_dates__WEBPACK_IMPORTED_MODULE_3__._getDatesWhenUpdatesWereMade),\n/* harmony export */   defaultChangesDates: () => (/* reexport safe */ _get_last_changes_dates__WEBPACK_IMPORTED_MODULE_3__.defaultChangesDates),\n/* harmony export */   defaultCountDraftsData: () => (/* binding */ defaultCountDraftsData)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _get_last_changes_dates__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./_get-last-changes-dates */ \"(rsc)/./databases/queries/ops/_get-last-changes-dates.ts\");\n\n\n\n\n\nasync function _countPendingDeletion() {\n    try {\n        const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.pendingDeletion);\n        return {\n            total: res[0]?.count || 0\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_countPendingDeletion ERROR\", e.message);\n        return {\n            total: 0,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\nconst defaultCountDraftsData = {\n    scripts: 0,\n    screens: 0,\n    diagnoses: 0,\n    configKeys: 0,\n    total: 0\n};\nasync function _countDrafts() {\n    const data = {\n        ...defaultCountDraftsData\n    };\n    try {\n        const scripts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.scriptsDrafts);\n        data.scripts = scripts[0]?.count || 0;\n        const screens = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.screensDrafts);\n        data.screens = screens[0]?.count || 0;\n        const diagnoses = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.diagnosesDrafts);\n        data.diagnoses = diagnoses[0]?.count || 0;\n        const configKeys = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_2__[\"default\"].select({\n            count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n        }).from(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_1__.configKeysDrafts);\n        data.configKeys = configKeys[0]?.count || 0;\n        data.total = data.configKeys + data.diagnoses + data.screens + data.scripts;\n        return {\n            ...data\n        };\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__[\"default\"].error(\"_countDrafts ERROR\", e.message);\n        return {\n            ...data,\n            errors: [\n                e.message\n            ]\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9vcHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFvQztBQUVGO0FBT0g7QUFDRztBQUVRO0FBRW5DLGVBQWVRO0lBQ2xCLElBQUk7UUFDQSxNQUFNQyxNQUFNLE1BQU1GLG1EQUFFQSxDQUFDRyxNQUFNLENBQUM7WUFBRVYsT0FBT0Esa0RBQUtBO1FBQUksR0FBR1csSUFBSSxDQUFDTCxpRUFBZUE7UUFDckUsT0FBTztZQUFFTSxPQUFPSCxHQUFHLENBQUMsRUFBRSxFQUFFVCxTQUFTO1FBQUc7SUFDeEMsRUFBRSxPQUFNYSxHQUFRO1FBQ1paLG1EQUFNQSxDQUFDYSxLQUFLLENBQUMsK0JBQStCRCxFQUFFRSxPQUFPO1FBQ3JELE9BQU87WUFBRUgsT0FBTztZQUFHSSxRQUFRO2dCQUFDSCxFQUFFRSxPQUFPO2FBQUM7UUFBRTtJQUM1QztBQUNKO0FBRU8sTUFBTUUseUJBQXlCO0lBQ2xDQyxTQUFTO0lBQ1RDLFNBQVM7SUFDVEMsV0FBVztJQUNYQyxZQUFZO0lBQ1pULE9BQU87QUFDWCxFQUFFO0FBRUssZUFBZVU7SUFRbEIsTUFBTUMsT0FBTztRQUFFLEdBQUdOLHNCQUFzQjtJQUFFO0lBRTFDLElBQUk7UUFDQSxNQUFNQyxVQUFVLE1BQU1YLG1EQUFFQSxDQUFDRyxNQUFNLENBQUM7WUFBRVYsT0FBT0Esa0RBQUtBO1FBQUksR0FBR1csSUFBSSxDQUFDTiwrREFBYUE7UUFDdkVrQixLQUFLTCxPQUFPLEdBQUdBLE9BQU8sQ0FBQyxFQUFFLEVBQUVsQixTQUFTO1FBRXBDLE1BQU1tQixVQUFVLE1BQU1aLG1EQUFFQSxDQUFDRyxNQUFNLENBQUM7WUFBRVYsT0FBT0Esa0RBQUtBO1FBQUksR0FBR1csSUFBSSxDQUFDUCwrREFBYUE7UUFDdkVtQixLQUFLSixPQUFPLEdBQUdBLE9BQU8sQ0FBQyxFQUFFLEVBQUVuQixTQUFTO1FBRXBDLE1BQU1vQixZQUFZLE1BQU1iLG1EQUFFQSxDQUFDRyxNQUFNLENBQUM7WUFBRVYsT0FBT0Esa0RBQUtBO1FBQUksR0FBR1csSUFBSSxDQUFDUixpRUFBZUE7UUFDM0VvQixLQUFLSCxTQUFTLEdBQUdBLFNBQVMsQ0FBQyxFQUFFLEVBQUVwQixTQUFTO1FBRXhDLE1BQU1xQixhQUFhLE1BQU1kLG1EQUFFQSxDQUFDRyxNQUFNLENBQUM7WUFBRVYsT0FBT0Esa0RBQUtBO1FBQUksR0FBR1csSUFBSSxDQUFDVCxrRUFBZ0JBO1FBQzdFcUIsS0FBS0YsVUFBVSxHQUFHQSxVQUFVLENBQUMsRUFBRSxFQUFFckIsU0FBUztRQUUxQ3VCLEtBQUtYLEtBQUssR0FBR1csS0FBS0YsVUFBVSxHQUFHRSxLQUFLSCxTQUFTLEdBQUdHLEtBQUtKLE9BQU8sR0FBR0ksS0FBS0wsT0FBTztRQUUzRSxPQUFPO1lBQUUsR0FBR0ssSUFBSTtRQUFFO0lBQ3RCLEVBQUUsT0FBTVYsR0FBUTtRQUNaWixtREFBTUEsQ0FBQ2EsS0FBSyxDQUFDLHNCQUFzQkQsRUFBRUUsT0FBTztRQUM1QyxPQUFPO1lBQUUsR0FBR1EsSUFBSTtZQUFFUCxRQUFRO2dCQUFDSCxFQUFFRSxPQUFPO2FBQUM7UUFBRTtJQUMzQztBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcXVlcmllcy9vcHMvaW5kZXgudHM/YWJkYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb3VudCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcblxuaW1wb3J0IGxvZ2dlciBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgXG4gICAgY29uZmlnS2V5c0RyYWZ0cyxcbiAgICBkaWFnbm9zZXNEcmFmdHMsXG4gICAgc2NyZWVuc0RyYWZ0cyxcbiAgICBzY3JpcHRzRHJhZnRzICxcbiAgICBwZW5kaW5nRGVsZXRpb25cbn0gZnJvbSAnQC9kYXRhYmFzZXMvcGcvc2NoZW1hJztcbmltcG9ydCBkYiBmcm9tICcuLi8uLi9wZy9kcml6emxlJztcblxuZXhwb3J0ICogZnJvbSAnLi9fZ2V0LWxhc3QtY2hhbmdlcy1kYXRlcyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY291bnRQZW5kaW5nRGVsZXRpb24oKTogUHJvbWlzZTx7IGVycm9ycz86IHN0cmluZ1tdOyB0b3RhbDogbnVtYmVyOyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZGIuc2VsZWN0KHsgY291bnQ6IGNvdW50KCksIH0pLmZyb20ocGVuZGluZ0RlbGV0aW9uKTtcbiAgICAgICAgcmV0dXJuIHsgdG90YWw6IHJlc1swXT8uY291bnQgfHwgMCwgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jb3VudFBlbmRpbmdEZWxldGlvbiBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB7IHRvdGFsOiAwLCBlcnJvcnM6IFtlLm1lc3NhZ2VdLCB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRDb3VudERyYWZ0c0RhdGEgPSB7XG4gICAgc2NyaXB0czogMCxcbiAgICBzY3JlZW5zOiAwLFxuICAgIGRpYWdub3NlczogMCxcbiAgICBjb25maWdLZXlzOiAwLFxuICAgIHRvdGFsOiAwLFxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9jb3VudERyYWZ0cygpOiBQcm9taXNlPHsgXG4gICAgc2NyaXB0czogbnVtYmVyO1xuICAgIHNjcmVlbnM6IG51bWJlcjtcbiAgICBkaWFnbm9zZXM6IG51bWJlcjtcbiAgICBjb25maWdLZXlzOiBudW1iZXI7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBlcnJvcnM/OiBzdHJpbmdbXTtcbn0+IHtcbiAgICBjb25zdCBkYXRhID0geyAuLi5kZWZhdWx0Q291bnREcmFmdHNEYXRhLCB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2NyaXB0cyA9IGF3YWl0IGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KS5mcm9tKHNjcmlwdHNEcmFmdHMpO1xuICAgICAgICBkYXRhLnNjcmlwdHMgPSBzY3JpcHRzWzBdPy5jb3VudCB8fCAwO1xuXG4gICAgICAgIGNvbnN0IHNjcmVlbnMgPSBhd2FpdCBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSkuZnJvbShzY3JlZW5zRHJhZnRzKTtcbiAgICAgICAgZGF0YS5zY3JlZW5zID0gc2NyZWVuc1swXT8uY291bnQgfHwgMDtcblxuICAgICAgICBjb25zdCBkaWFnbm9zZXMgPSBhd2FpdCBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSkuZnJvbShkaWFnbm9zZXNEcmFmdHMpO1xuICAgICAgICBkYXRhLmRpYWdub3NlcyA9IGRpYWdub3Nlc1swXT8uY291bnQgfHwgMDtcblxuICAgICAgICBjb25zdCBjb25maWdLZXlzID0gYXdhaXQgZGIuc2VsZWN0KHsgY291bnQ6IGNvdW50KCksIH0pLmZyb20oY29uZmlnS2V5c0RyYWZ0cyk7XG4gICAgICAgIGRhdGEuY29uZmlnS2V5cyA9IGNvbmZpZ0tleXNbMF0/LmNvdW50IHx8IDA7XG5cbiAgICAgICAgZGF0YS50b3RhbCA9IGRhdGEuY29uZmlnS2V5cyArIGRhdGEuZGlhZ25vc2VzICsgZGF0YS5zY3JlZW5zICsgZGF0YS5zY3JpcHRzO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHsgLi4uZGF0YSwgfTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19jb3VudERyYWZ0cyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiB7IC4uLmRhdGEsIGVycm9yczogW2UubWVzc2FnZV0sIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImNvdW50IiwibG9nZ2VyIiwiY29uZmlnS2V5c0RyYWZ0cyIsImRpYWdub3Nlc0RyYWZ0cyIsInNjcmVlbnNEcmFmdHMiLCJzY3JpcHRzRHJhZnRzIiwicGVuZGluZ0RlbGV0aW9uIiwiZGIiLCJfY291bnRQZW5kaW5nRGVsZXRpb24iLCJyZXMiLCJzZWxlY3QiLCJmcm9tIiwidG90YWwiLCJlIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXJyb3JzIiwiZGVmYXVsdENvdW50RHJhZnRzRGF0YSIsInNjcmlwdHMiLCJzY3JlZW5zIiwiZGlhZ25vc2VzIiwiY29uZmlnS2V5cyIsIl9jb3VudERyYWZ0cyIsImRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/ops/index.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/screens-drafts.ts":
/*!*********************************************!*\
  !*** ./databases/queries/screens-drafts.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countScreensDrafts: () => (/* binding */ _countScreensDrafts),\n/* harmony export */   _getFullScreenDraft: () => (/* binding */ _getFullScreenDraft),\n/* harmony export */   _getScreenDraft: () => (/* binding */ _getScreenDraft),\n/* harmony export */   _getScreenDraftMini: () => (/* binding */ _getScreenDraftMini),\n/* harmony export */   _getScreensDrafts: () => (/* binding */ _getScreensDrafts),\n/* harmony export */   _getScreensDraftsDefaultResults: () => (/* binding */ _getScreensDraftsDefaultResults)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\nasync function _countScreensDrafts(opts) {\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts);\n    if (opts?.firstVersion) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenId));\n    if (opts?.scriptId) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptId, opts.scriptId));\n    const res = await q.execute();\n    return res[0]?.count || 0;\n}\nasync function _getScreenDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            screenDraftId: true,\n            scriptDraftId: true,\n            screenId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            fields: res.data.fields,\n            items: res.data.items,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3,\n            prePopulate: res.data.prePopulate\n        }\n    };\n}\nasync function _getScreenDraftMini(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            screenDraftId: true,\n            screenId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            fields: res.data.fields,\n            items: res.data.items,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3,\n            prePopulate: res.data.prePopulate\n        }\n    };\n}\nasync function _getFullScreenDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findFirst({\n        where\n    });\n    return !res ? null : {\n        ...res,\n        data: {\n            ...res.data,\n            fields: res.data.fields,\n            items: res.data.items,\n            image1: res.data.image1,\n            image2: res.data.image2,\n            image3: res.data.image3,\n            prePopulate: res.data.prePopulate\n        }\n    };\n}\nasync function __getScreensDrafts({ limit, page = 1, screenDraftIds, scriptsDraftsIds, searchValue, withoutScreenId, scriptsIds }) {\n    page = Math.max(0, page);\n    const where = [\n        !withoutScreenId ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenId),\n        !scriptsIds?.length && !scriptsDraftsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.or)(!scriptsDraftsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId, scriptsDraftsIds), !scriptsIds?.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptId, scriptsIds))\n    ].filter((s)=>s);\n    searchValue = `${searchValue || \"\"}`.trim();\n    // if (searchValue) {\n    //     const search = ['%', searchValue, '%'].join('');\n    //     conditions.push(sql`json_array_elements(content->data) like LOWER(${search})`);\n    // }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts);\n    if (where.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...where));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const data = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findMany({\n        where: where.length ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...where) : undefined,\n        limit: (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : limit,\n        orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.id),\n        offset,\n        columns: {\n            id: true,\n            screenDraftId: true,\n            screenId: true,\n            scriptId: true,\n            data: true,\n            scriptDraftId: true\n        }\n    });\n    return {\n        page,\n        limit,\n        data: data.map(({ data, id, screenId, screenDraftId, scriptId, scriptDraftId })=>{\n            return {\n                ...data,\n                id,\n                scriptId,\n                scriptDraftId,\n                screenDraftId,\n                isDraft: true,\n                publishedVersion: !screenId ? null : Math.max(1, data.version - 1)\n            };\n        }),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getScreensDraftsDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getScreensDrafts(params) {\n    let rslts = _getScreensDraftsDefaultResults;\n    try {\n        rslts = await __getScreensDrafts({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getScreenDrafts ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9zY3JlZW5zLWRyYWZ0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQXlFO0FBRWpDO0FBQ1Q7QUFDYztBQUVYO0FBRTNCLGVBQWVXLG9CQUFvQkMsSUFHekM7SUFDRyxNQUFNQyxJQUFJTCxtREFBRUEsQ0FDUE0sTUFBTSxDQUFDO1FBQUVaLE9BQU9BLGtEQUFLQTtJQUFJLEdBQ3pCYSxJQUFJLENBQUNOLHFEQUFhQTtJQUV2QixJQUFJRyxNQUFNSSxjQUFjSCxFQUFFSSxLQUFLLENBQUNaLG1EQUFNQSxDQUFDSSxxREFBYUEsQ0FBQ1MsUUFBUTtJQUU3RCxJQUFJTixNQUFNTyxVQUFVTixFQUFFSSxLQUFLLENBQUNqQiwrQ0FBRUEsQ0FBQ1MscURBQWFBLENBQUNVLFFBQVEsRUFBRVAsS0FBS08sUUFBUTtJQUVwRSxNQUFNQyxNQUFNLE1BQU1QLEVBQUVRLE9BQU87SUFFM0IsT0FBT0QsR0FBRyxDQUFDLEVBQUUsRUFBRWxCLFNBQVM7QUFDNUI7QUFJTyxlQUFlb0IsZ0JBQWdCQyxNQUE0QjtJQUM5RCxNQUFNTixRQUFRakIsK0NBQUVBLENBQUNTLHFEQUFhQSxDQUFDZSxhQUFhLEVBQUVEO0lBQzlDLE1BQU1ILE1BQU0sTUFBTVosbURBQUVBLENBQUNpQixLQUFLLENBQUNoQixhQUFhLENBQUNpQixTQUFTLENBQUM7UUFDL0NUO1FBQ0FVLFNBQVM7WUFDTEMsSUFBSTtZQUNKSixlQUFlO1lBQ2ZLLGVBQWU7WUFDZlgsVUFBVTtZQUNWQyxVQUFVO1lBQ1ZXLE1BQU07UUFDVjtJQUNKO0lBQ0EsT0FBTyxDQUFDVixNQUFNLE9BQU87UUFDakIsR0FBR0EsR0FBRztRQUNOVSxNQUFNO1lBQ0YsR0FBR1YsSUFBSVUsSUFBSTtZQUNYQyxRQUFRWCxJQUFJVSxJQUFJLENBQUNDLE1BQU07WUFDdkJDLE9BQU9aLElBQUlVLElBQUksQ0FBQ0UsS0FBSztZQUNyQkMsUUFBUWIsSUFBSVUsSUFBSSxDQUFDRyxN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RztZQUNwRTtRQUNKO1FBQ0FWO1FBQ0FDO1FBQ0FaO1FBQ0FzQixPQUFPakI7SUFDWDtBQUNKO0FBRU8sTUFBTWtCLGtDQUFrQztJQUMzQzFCLE1BQU07SUFDTkQsT0FBT1M7SUFDUE0sV0FBVztJQUNYQyxZQUFZO0lBQ1oxQixNQUFNLEVBQUU7SUFDUmMsYUFBYUs7SUFDYmlCLE9BQU9qQjtBQUNYLEVBQW9EO0FBRTdDLGVBQWVtQixrQkFBa0I3QyxNQUErQjtJQUNuRSxJQUFJOEMsUUFBUUY7SUFFWixJQUFJO1FBQ0FFLFFBQVEsTUFBTTlCLG1CQUFtQjtZQUFFLEdBQUdoQixNQUFNO1FBQUM7SUFDakQsRUFBRSxPQUFNK0MsR0FBUTtRQUNaNUQsbURBQU1BLENBQUN3RCxLQUFLLENBQUMsMEJBQTBCSTtRQUN2Q0QsTUFBTUgsS0FBSyxHQUFHSSxFQUFFQyxPQUFPO0lBQzNCLFNBQVU7UUFDTixPQUFPRjtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL3NjcmVlbnMtZHJhZnRzLnRzP2RmMDUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXEsIGFuZCwgY291bnQsIGluQXJyYXksIGRlc2MsIGlzTnVsbCwgb3IsIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5cbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tIFwiQC9saWIvaXNFbXB0eVwiO1xuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBzY3JlZW5zRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IHsgU2NyaXB0RmllbGQsIEltYWdlVGV4dEZpZWxkLCBTY3JpcHRJbWFnZSwgU2NyaXB0SXRlbSB9IGZyb20gXCJAL3R5cGVzXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJAL2xpYi9sb2dnZXJcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9jb3VudFNjcmVlbnNEcmFmdHMob3B0cz86IHtcbiAgICBmaXJzdFZlcnNpb24/OiBib29sZWFuO1xuICAgIHNjcmlwdElkPzogc3RyaW5nO1xufSkge1xuICAgIGNvbnN0IHEgPSBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCksIH0pXG4gICAgICAgIC5mcm9tKHNjcmVlbnNEcmFmdHMpO1xuXG4gICAgaWYgKG9wdHM/LmZpcnN0VmVyc2lvbikgcS53aGVyZShpc051bGwoc2NyZWVuc0RyYWZ0cy5zY3JlZW5JZCkpO1xuXG4gICAgaWYgKG9wdHM/LnNjcmlwdElkKSBxLndoZXJlKGVxKHNjcmVlbnNEcmFmdHMuc2NyaXB0SWQsIG9wdHMuc2NyaXB0SWQpKTtcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHEuZXhlY3V0ZSgpO1xuICAgIFxuICAgIHJldHVybiByZXNbMF0/LmNvdW50IHx8IDA7XG59XG5cbmV4cG9ydCB0eXBlIEdldFNjcmVlbkRyYWZ0UGFyYW1zID0gc3RyaW5nO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmVlbkRyYWZ0KHBhcmFtczogR2V0U2NyZWVuRHJhZnRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IGVxKHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmVlbkRyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgc2NyZWVuSWQ6IHRydWUsXG4gICAgICAgICAgICBzY3JpcHRJZDogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuICFyZXMgPyBudWxsIDoge1xuICAgICAgICAuLi5yZXMsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIC4uLnJlcy5kYXRhLFxuICAgICAgICAgICAgZmllbGRzOiByZXMuZGF0YS5maWVsZHMgYXMgU2NyaXB0RmllbGRbXSxcbiAgICAgICAgICAgIGl0ZW1zOiByZXMuZGF0YS5pdGVtcyBhcyBTY3JpcHRJdGVtW10sXG4gICAgICAgICAgICBpbWFnZTE6IHJlcy5kYXRhLmltYWdlMSBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgICAgICBpbWFnZTI6IHJlcy5kYXRhLmltYWdlMiBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgICAgICBpbWFnZTM6IHJlcy5kYXRhLmltYWdlMyBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgICAgICBwcmVQb3B1bGF0ZTogcmVzLmRhdGEucHJlUG9wdWxhdGUgYXMgc3RyaW5nW10sXG4gICAgICAgIH0sXG4gICAgfTsgXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyZWVuRHJhZnRNaW5pKHBhcmFtczogR2V0U2NyZWVuRHJhZnRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IGVxKHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmVlbkRyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICBzY3JlZW5JZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiAhcmVzID8gbnVsbCA6IHtcbiAgICAgICAgLi4ucmVzLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAuLi5yZXMuZGF0YSxcbiAgICAgICAgICAgIGZpZWxkczogcmVzLmRhdGEuZmllbGRzIGFzIFNjcmlwdEZpZWxkW10sXG4gICAgICAgICAgICBpdGVtczogcmVzLmRhdGEuaXRlbXMgYXMgU2NyaXB0SXRlbVtdLFxuICAgICAgICAgICAgaW1hZ2UxOiByZXMuZGF0YS5pbWFnZTEgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UyOiByZXMuZGF0YS5pbWFnZTIgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UzOiByZXMuZGF0YS5pbWFnZTMgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgcHJlUG9wdWxhdGU6IHJlcy5kYXRhLnByZVBvcHVsYXRlIGFzIHN0cmluZ1tdLFxuICAgICAgICB9LFxuICAgIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0RnVsbFNjcmVlbkRyYWZ0KHBhcmFtczogR2V0U2NyZWVuRHJhZnRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IGVxKHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlLFxuICAgIH0pO1xuICAgIHJldHVybiAhcmVzID8gbnVsbCA6IHtcbiAgICAgICAgLi4ucmVzLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAuLi5yZXMuZGF0YSxcbiAgICAgICAgICAgIGZpZWxkczogcmVzLmRhdGEuZmllbGRzIGFzIFNjcmlwdEZpZWxkW10sXG4gICAgICAgICAgICBpdGVtczogcmVzLmRhdGEuaXRlbXMgYXMgU2NyaXB0SXRlbVtdLFxuICAgICAgICAgICAgaW1hZ2UxOiByZXMuZGF0YS5pbWFnZTEgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UyOiByZXMuZGF0YS5pbWFnZTIgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgaW1hZ2UzOiByZXMuZGF0YS5pbWFnZTMgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgcHJlUG9wdWxhdGU6IHJlcy5kYXRhLnByZVBvcHVsYXRlIGFzIHN0cmluZ1tdLFxuICAgICAgICB9LFxuICAgIH07XG59XG5cbmV4cG9ydCB0eXBlIEdldFNjcmVlbnNEcmFmdHNQYXJhbXMgPSB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgc2NyZWVuRHJhZnRJZHM/OiBzdHJpbmdbXTtcbiAgICBzY3JpcHRzRHJhZnRzSWRzPzogc3RyaW5nW107XG4gICAgc2NyaXB0c0lkcz86IHN0cmluZ1tdO1xuICAgIHNlYXJjaFZhbHVlPzogc3RyaW5nO1xuICAgIHdpdGhvdXRTY3JlZW5JZD86IGJvb2xlYW47XG59O1xuXG5hc3luYyBmdW5jdGlvbiBfX2dldFNjcmVlbnNEcmFmdHMoe1xuICAgIGxpbWl0LFxuICAgIHBhZ2UgPSAxLFxuICAgIHNjcmVlbkRyYWZ0SWRzLFxuICAgIHNjcmlwdHNEcmFmdHNJZHMsXG4gICAgc2VhcmNoVmFsdWUsXG4gICAgd2l0aG91dFNjcmVlbklkLFxuICAgIHNjcmlwdHNJZHMsXG59OiBHZXRTY3JlZW5zRHJhZnRzUGFyYW1zKSB7XG4gICAgcGFnZSA9IE1hdGgubWF4KDAsIHBhZ2UpO1xuXG4gICAgY29uc3Qgd2hlcmUgPSBbXG4gICAgICAgICF3aXRob3V0U2NyZWVuSWQgPyB1bmRlZmluZWQgOiBpc051bGwoc2NyZWVuc0RyYWZ0cy5zY3JlZW5JZCksXG4gICAgICAgICFzY3JpcHRzSWRzPy5sZW5ndGggJiYgIXNjcmlwdHNEcmFmdHNJZHM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IG9yKFxuICAgICAgICAgICAgIXNjcmlwdHNEcmFmdHNJZHM/Lmxlbmd0aCA/IHVuZGVmaW5lZCA6IGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHRzRHJhZnRzSWRzKSxcbiAgICAgICAgICAgICFzY3JpcHRzSWRzPy5sZW5ndGggPyB1bmRlZmluZWQgOiBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNJZHMpXG4gICAgICAgICksXG4gICAgXS5maWx0ZXIocyA9PiBzKTtcblxuICAgIHNlYXJjaFZhbHVlID0gYCR7c2VhcmNoVmFsdWUgfHwgJyd9YC50cmltKCk7XG4gICAgLy8gaWYgKHNlYXJjaFZhbHVlKSB7XG4gICAgLy8gICAgIGNvbnN0IHNlYXJjaCA9IFsnJScsIHNlYXJjaFZhbHVlLCAnJSddLmpvaW4oJycpO1xuICAgIC8vICAgICBjb25kaXRpb25zLnB1c2goc3FsYGpzb25fYXJyYXlfZWxlbWVudHMoY29udGVudC0+ZGF0YSkgbGlrZSBMT1dFUigke3NlYXJjaH0pYCk7XG4gICAgLy8gfVxuXG4gICAgY29uc3QgY291bnRRdWVyeSA9IGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KS5mcm9tKHNjcmVlbnNEcmFmdHMpO1xuICAgIGlmICh3aGVyZS5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLndoZXJlKSk7XG5cbiAgICBjb25zdCBbeyBjb3VudDogdG90YWxSb3dzLCB9XSA9IGF3YWl0IGNvdW50UXVlcnkuZXhlY3V0ZSgpO1xuXG4gICAgbGV0IHRvdGFsUGFnZXMgPSAxO1xuICAgIGlmICh0b3RhbFJvd3Mpe1xuICAgICAgICB0b3RhbFBhZ2VzID0gaXNFbXB0eShsaW1pdCkgPyAxIDogTWF0aC5jZWlsKHRvdGFsUm93cyAvIGxpbWl0ISk7XG4gICAgICAgIHBhZ2UgPSBNYXRoLm1pbihwYWdlLCB0b3RhbFBhZ2VzKTtcbiAgICB9XG5cbiAgICBjb25zdCBvZmZzZXQgPSBpc0VtcHR5KGxpbWl0KSA/IHVuZGVmaW5lZCA6IE1hdGgubWF4KDAsIChwYWdlIC0gMSkgKiBsaW1pdCEpO1xuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnNEcmFmdHMuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogd2hlcmUubGVuZ3RoID8gYW5kKC4uLndoZXJlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgbGltaXQ6IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogbGltaXQhLFxuICAgICAgICBvcmRlckJ5OiBkZXNjKHNjcmVlbnNEcmFmdHMuaWQpLFxuICAgICAgICBvZmZzZXQsXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgc2NyZWVuRHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmVlbklkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBkYXRhOiBkYXRhLm1hcCgoeyBkYXRhLCBpZCwgc2NyZWVuSWQsIHNjcmVlbkRyYWZ0SWQsIHNjcmlwdElkLCBzY3JpcHREcmFmdElkLCB9KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgICAgc2NyaXB0SWQsXG4gICAgICAgICAgICAgICAgc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgICAgICAgICBzY3JlZW5EcmFmdElkLFxuICAgICAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogIXNjcmVlbklkID8gbnVsbCA6IE1hdGgubWF4KDEsIGRhdGEudmVyc2lvbiAtIDEpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgICAgIHRvdGFsUm93cyxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgc2VhcmNoVmFsdWUsXG4gICAgICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IF9nZXRTY3JlZW5zRHJhZnRzRGVmYXVsdFJlc3VsdHMgPSB7XG4gICAgcGFnZTogMSxcbiAgICBsaW1pdDogdW5kZWZpbmVkLFxuICAgIHRvdGFsUm93czogMCxcbiAgICB0b3RhbFBhZ2VzOiAxLFxuICAgIGRhdGE6IFtdLFxuICAgIHNlYXJjaFZhbHVlOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbn0gYXMgQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfX2dldFNjcmVlbnNEcmFmdHM+PjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRTY3JlZW5zRHJhZnRzKHBhcmFtcz86IEdldFNjcmVlbnNEcmFmdHNQYXJhbXMpIHtcbiAgICBsZXQgcnNsdHMgPSBfZ2V0U2NyZWVuc0RyYWZ0c0RlZmF1bHRSZXN1bHRzO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgcnNsdHMgPSBhd2FpdCBfX2dldFNjcmVlbnNEcmFmdHMoeyAuLi5wYXJhbXMgfSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfZ2V0U2NyZWVuRHJhZnRzIEVSUk9SJywgZSk7XG4gICAgICAgIHJzbHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByc2x0cztcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZXEiLCJhbmQiLCJjb3VudCIsImluQXJyYXkiLCJkZXNjIiwiaXNOdWxsIiwib3IiLCJpc0VtcHR5IiwiZGIiLCJzY3JlZW5zRHJhZnRzIiwibG9nZ2VyIiwiX2NvdW50U2NyZWVuc0RyYWZ0cyIsIm9wdHMiLCJxIiwic2VsZWN0IiwiZnJvbSIsImZpcnN0VmVyc2lvbiIsIndoZXJlIiwic2NyZWVuSWQiLCJzY3JpcHRJZCIsInJlcyIsImV4ZWN1dGUiLCJfZ2V0U2NyZWVuRHJhZnQiLCJwYXJhbXMiLCJzY3JlZW5EcmFmdElkIiwicXVlcnkiLCJmaW5kRmlyc3QiLCJjb2x1bW5zIiwiaWQiLCJzY3JpcHREcmFmdElkIiwiZGF0YSIsImZpZWxkcyIsIml0ZW1zIiwiaW1hZ2UxIiwiaW1hZ2UyIiwiaW1hZ2UzIiwicHJlUG9wdWxhdGUiLCJfZ2V0U2NyZWVuRHJhZnRNaW5pIiwiX2dldEZ1bGxTY3JlZW5EcmFmdCIsIl9fZ2V0U2NyZWVuc0RyYWZ0cyIsImxpbWl0IiwicGFnZSIsInNjcmVlbkRyYWZ0SWRzIiwic2NyaXB0c0RyYWZ0c0lkcyIsInNlYXJjaFZhbHVlIiwid2l0aG91dFNjcmVlbklkIiwic2NyaXB0c0lkcyIsIk1hdGgiLCJtYXgiLCJ1bmRlZmluZWQiLCJsZW5ndGgiLCJmaWx0ZXIiLCJzIiwidHJpbSIsImNvdW50UXVlcnkiLCJ0b3RhbFJvd3MiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsIm1pbiIsIm9mZnNldCIsImZpbmRNYW55Iiwib3JkZXJCeSIsIm1hcCIsImlzRHJhZnQiLCJwdWJsaXNoZWRWZXJzaW9uIiwidmVyc2lvbiIsImVycm9yIiwiX2dldFNjcmVlbnNEcmFmdHNEZWZhdWx0UmVzdWx0cyIsIl9nZXRTY3JlZW5zRHJhZnRzIiwicnNsdHMiLCJlIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/screens-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/screens.ts":
/*!**************************************!*\
  !*** ./databases/queries/screens.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countScreens: () => (/* binding */ _countScreens),\n/* harmony export */   _getFullScreen: () => (/* binding */ _getFullScreen),\n/* harmony export */   _getLastScreenPosition: () => (/* binding */ _getLastScreenPosition),\n/* harmony export */   _getScreen: () => (/* binding */ _getScreen),\n/* harmony export */   _getScreenMini: () => (/* binding */ _getScreenMini),\n/* harmony export */   _getScreenWithDraft: () => (/* binding */ _getScreenWithDraft),\n/* harmony export */   _getScreens: () => (/* binding */ _getScreens),\n/* harmony export */   _getScreensDefaultResults: () => (/* binding */ _getScreensDefaultResults),\n/* harmony export */   _listRawScreens: () => (/* binding */ _listRawScreens),\n/* harmony export */   _listScreens: () => (/* binding */ _listScreens)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/validate.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\n\nasync function _listScreens(opts) {\n    const { screensReferences, scriptsReferences } = {\n        ...opts\n    };\n    const results = {\n        data: []\n    };\n    try {\n        const where = !screensReferences?.length ? [] : [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenId, screensReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screensReferences))\n        ];\n        if (scriptsReferences?.length) {\n            where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId, scriptsReferences)));\n        }\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where),\n            columns: {\n                screenId: true,\n                screenDraftId: true,\n                scriptDraftId: true,\n                scriptId: true,\n                data: true\n            }\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, drafts.map((s)=>s.data.screenId))\n                ]\n            ]),\n            columns: {\n                screenId: true,\n                position: true,\n                title: true,\n                scriptId: true\n            }\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>({\n                    screenReference: s.screenDraftId,\n                    screenId: s.screenId,\n                    screenDraftId: s.screenDraftId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true,\n                    title: s.data.title,\n                    position: s.data.position\n                }))\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    screenReference: s.screenId,\n                    screenId: s.screenId,\n                    scriptId: s.scriptId,\n                    isDraft: false,\n                    title: s.title,\n                    position: s.position\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listScreens ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _listRawScreens(opts) {\n    const { screensReferences, scriptsReferences } = {\n        ...opts\n    };\n    const results = {\n        data: []\n    };\n    try {\n        const where = !screensReferences?.length ? [] : [\n            (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenId, screensReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId, screensReferences))\n        ];\n        if (scriptsReferences?.length) {\n            where.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.or)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptId, scriptsReferences), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId, scriptsReferences)));\n        }\n        const drafts = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screensDrafts.findMany({\n            where: !where.length ? undefined : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...where)\n        });\n        const published = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findMany({\n            where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...[\n                (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt),\n                ...!drafts.length ? [] : [\n                    (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.notInArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, drafts.map((s)=>s.data.screenId))\n                ]\n            ])\n        });\n        results.data = [\n            ...results.data,\n            ...drafts.map((s)=>{\n                return {\n                    ...s.data,\n                    screenReference: s.screenDraftId,\n                    screenId: s.screenId || undefined,\n                    screenDraftId: s.screenDraftId,\n                    scriptId: s.scriptId,\n                    scriptDraftId: s.scriptDraftId,\n                    isDraft: true\n                };\n            })\n        ];\n        results.data = [\n            ...results.data,\n            ...published.map((s)=>({\n                    ...s,\n                    screenReference: s.screenId,\n                    screenId: s.screenId,\n                    scriptId: s.scriptId,\n                    isDraft: false\n                }))\n        ].sort((a, b)=>a.position - b.position);\n        return results;\n    } catch (e) {\n        results.error = e.message;\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_listRawScreens ERROR\", e.message);\n    } finally{\n        return results;\n    }\n}\nasync function _getLastScreenPosition() {\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.position\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt)).limit(1).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.position));\n    return res[0]?.position || 0;\n}\nasync function _countScreens(opts) {\n    const { withArchived } = {\n        ...opts\n    };\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens);\n    if (!withArchived) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt));\n    const res = await q.execute();\n    return res[0]?.count;\n}\nasync function _getScreen(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.oldScreenId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt))\n    });\n    return !res ? null : {\n        ...res,\n        fields: res.fields,\n        items: res.items,\n        image1: res.image1,\n        image2: res.image2,\n        image3: res.image3\n    };\n}\nasync function _getScreenWithDraft(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.oldScreenId, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt)),\n        with: {\n            draft: true\n        }\n    });\n    return !res ? null : {\n        ...res,\n        fields: res.fields,\n        items: res.items,\n        image1: res.image1,\n        image2: res.image2,\n        image3: res.image3,\n        prePopulate: res.prePopulate,\n        draft: !res.draft ? null : {\n            ...res.draft,\n            data: {\n                ...res.draft.data,\n                fields: res.draft.data.fields,\n                items: res.draft.data.items,\n                image1: res.draft.data.image1,\n                image2: res.draft.data.image2,\n                image3: res.draft.data.image3,\n                prePopulate: res.draft.data.prePopulate\n            }\n        }\n    };\n}\nasync function _getScreenMini(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.oldScreenId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt)),\n        columns: {\n            screenId: true,\n            oldScreenId: true,\n            version: true,\n            type: true,\n            title: true\n        }\n    });\n}\nasync function _getFullScreen(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.oldScreenId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.screens.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt))\n    });\n}\nasync function __getScreens({ limit, page = 1, screenIds, searchValue, archived, scriptsIds }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (archived) {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt));\n    } else {\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt));\n    }\n    if (screenIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, screenIds));\n    if (scriptsIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.scriptId, scriptsIds));\n    searchValue = `${searchValue || \"\"}`.trim();\n    if (searchValue) {\n        const search = [\n            \"%\",\n            searchValue,\n            \"%\"\n        ].join(\"\");\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.sql)`LOWER(screens.name) like LOWER(${search})`);\n    }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        id: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.id,\n        screenId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId,\n        oldScreenId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.oldScreenId,\n        version: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.version,\n        scriptId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.scriptId,\n        type: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.type,\n        position: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.position,\n        sectionTitle: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.sectionTitle,\n        condition: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.condition,\n        epicId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.epicId,\n        storyId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.storyId,\n        refId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.refId,\n        step: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.step,\n        actionText: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.actionText,\n        contentText: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.contentText,\n        title: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.title,\n        title1: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.title1,\n        title2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.title2,\n        title3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.title3,\n        title4: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.title4,\n        instructions: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.instructions,\n        instructions2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.instructions2,\n        instructions3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.instructions3,\n        instructions4: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.instructions4,\n        text1: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.text1,\n        text2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.text2,\n        text3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.text3,\n        image1: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.image1,\n        image2: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.image2,\n        image3: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.image3,\n        hcwDiagnosesInstructions: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.hcwDiagnosesInstructions,\n        suggestedDiagnosesInstructions: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.suggestedDiagnosesInstructions,\n        notes: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.notes,\n        dataType: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.dataType,\n        confidential: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.confidential,\n        key: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.key,\n        label: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.label,\n        negativeLabel: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.negativeLabel,\n        positiveLabel: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.positiveLabel,\n        timerValue: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.timerValue,\n        multiplier: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.multiplier,\n        minValue: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.minValue,\n        maxValue: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.maxValue,\n        exportable: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.exportable,\n        skippable: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.skippable,\n        prePopulate: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.prePopulate,\n        fields: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.fields,\n        items: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.items,\n        publishDate: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.publishDate,\n        createdAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.createdAt,\n        updatedAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.updatedAt,\n        deletedAt: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.deletedAt,\n        screenDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenDraftId,\n        scriptDraftId: _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.scriptDraftId\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens).leftJoin(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.screenId, _pg_schema__WEBPACK_IMPORTED_MODULE_2__.screensDrafts.screenId)).orderBy((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.screens.position));\n    if (!(0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit)) q.limit(limit);\n    if (offset) q.offset(offset);\n    if (conditions.length) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.and)(...conditions));\n    const data = await q.execute();\n    return {\n        page,\n        limit,\n        data: data.map((s)=>({\n                ...s,\n                publishedVersion: s.version,\n                isDraft: false,\n                screenDraftId: s.screenDraftId,\n                scriptDraftId: s.scriptDraftId\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getScreensDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getScreens(params) {\n    let rslts = _getScreensDefaultResults;\n    try {\n        rslts = await __getScreens({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getScreens ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUMrQixLQUFLLENBQUMscUJBQXFCRDtRQUNsQzRGLE1BQU0zRixLQUFLLEdBQUdELEVBQUVFLE9BQU87SUFDM0IsU0FBVTtRQUNOLE9BQU8wRjtJQUNYO0FBQ0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy9xdWVyaWVzL3NjcmVlbnMudHM/MmU4MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcSwgYW5kLCBpc051bGwsIFNRTCwgY291bnQsIGluQXJyYXksIGRlc2MsIHNxbCwgaXNOb3ROdWxsLCBub3RJbkFycmF5LCBvciB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0ICogYXMgdXVpZCBmcm9tICd1dWlkJztcblxuaW1wb3J0IHsgU2NyaXB0RmllbGQsIFNjcmlwdEltYWdlLCBTY3JpcHRJdGVtIH0gZnJvbSBcIkAvdHlwZXNcIjtcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tIFwiQC9saWIvaXNFbXB0eVwiO1xuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBzY3JlZW5zLCBzY3JlZW5zRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfbGlzdFNjcmVlbnMob3B0cz86IHtcbiAgICBzY3JlZW5zUmVmZXJlbmNlcz86IHN0cmluZ1tdXG4gICAgc2NyaXB0c1JlZmVyZW5jZXM/OiBzdHJpbmdbXVxufSkge1xuICAgIGNvbnN0IHsgc2NyZWVuc1JlZmVyZW5jZXMsIHNjcmlwdHNSZWZlcmVuY2VzIH0gPSB7IC4uLm9wdHMgfTtcblxuICAgIGNvbnN0IHJlc3VsdHM6IHtcbiAgICAgICAgZXJyb3I/OiBzdHJpbmc7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHNjcmVlblJlZmVyZW5jZTogc3RyaW5nO1xuICAgICAgICAgICAgc2NyZWVuSWQ/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgICAgICAgc2NyZWVuRHJhZnRJZD86IHN0cmluZyB8IG51bGw7XG4gICAgICAgICAgICBzY3JpcHRJZD86IHN0cmluZyB8IG51bGw7XG4gICAgICAgICAgICBzY3JpcHREcmFmdElkPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICAgIGlzRHJhZnQ6IGJvb2xlYW47XG4gICAgICAgICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgICAgICAgcG9zaXRpb246IG51bWJlcjtcbiAgICAgICAgfVtdO1xuICAgIH0gPSB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB3aGVyZSA9ICFzY3JlZW5zUmVmZXJlbmNlcz8ubGVuZ3RoID8gW10gOiBbb3IoXG4gICAgICAgICAgICBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyZWVuSWQsIHNjcmVlbnNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgIGluQXJyYXkoc2NyZWVuc0RyYWZ0cy5zY3JlZW5EcmFmdElkLCBzY3JlZW5zUmVmZXJlbmNlcyksXG4gICAgICAgICldO1xuICAgICAgICBpZiAoc2NyaXB0c1JlZmVyZW5jZXM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgd2hlcmUucHVzaChvcihcbiAgICAgICAgICAgICAgICBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyaXB0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICAgICBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgc2NyaXB0c1JlZmVyZW5jZXMpLFxuICAgICAgICAgICAgKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkcmFmdHMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zRHJhZnRzLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiAhd2hlcmUubGVuZ3RoID8gdW5kZWZpbmVkIDogYW5kKC4uLndoZXJlKSxcbiAgICAgICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgICAgICBzY3JlZW5JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzY3JlZW5EcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi5bXG4gICAgICAgICAgICAgICAgaXNOdWxsKHNjcmVlbnMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuc2NyZWVuSWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICAgICAgc2NyZWVuSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5kcmFmdHMubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIHNjcmVlblJlZmVyZW5jZTogcy5zY3JlZW5EcmFmdElkLFxuICAgICAgICAgICAgc2NyZWVuSWQ6IHMuc2NyZWVuSWQsXG4gICAgICAgICAgICBzY3JlZW5EcmFmdElkOiBzLnNjcmVlbkRyYWZ0SWQsXG4gICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCxcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHMuc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgICAgIGlzRHJhZnQ6IHRydWUsXG4gICAgICAgICAgICB0aXRsZTogcy5kYXRhLnRpdGxlLFxuICAgICAgICAgICAgcG9zaXRpb246IHMuZGF0YS5wb3NpdGlvbixcbiAgICAgICAgfSkpXTtcblxuICAgICAgICByZXN1bHRzLmRhdGEgPSBbLi4ucmVzdWx0cy5kYXRhLCAuLi5wdWJsaXNoZWQubWFwKHMgPT4gKHtcbiAgICAgICAgICAgIHNjcmVlblJlZmVyZW5jZTogcy5zY3JlZW5JZCxcbiAgICAgICAgICAgIHNjcmVlbklkOiBzLnNjcmVlbklkLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHMuc2NyaXB0SWQsXG4gICAgICAgICAgICBpc0RyYWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIHRpdGxlOiBzLnRpdGxlLFxuICAgICAgICAgICAgcG9zaXRpb246IHMucG9zaXRpb24sXG4gICAgICAgIH0pKV0uc29ydCgoYSwgYikgPT4gYS5wb3NpdGlvbiAtIGIucG9zaXRpb24pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0gY2F0Y2goZTogYW55KSB7XG4gICAgICAgIHJlc3VsdHMuZXJyb3IgPSBlLm1lc3NhZ2U7XG4gICAgICAgIGxvZ2dlci5lcnJvcignX2xpc3RTY3JlZW5zIEVSUk9SJywgZS5tZXNzYWdlKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfbGlzdFJhd1NjcmVlbnMob3B0cz86IHtcbiAgICBzY3JlZW5zUmVmZXJlbmNlcz86IHN0cmluZ1tdO1xuICAgIHNjcmlwdHNSZWZlcmVuY2VzPzogc3RyaW5nW107XG59KSB7XG4gICAgY29uc3QgeyBzY3JlZW5zUmVmZXJlbmNlcywgc2NyaXB0c1JlZmVyZW5jZXMgfSA9IHsgLi4ub3B0cyB9O1xuXG4gICAgY29uc3QgcmVzdWx0czoge1xuICAgICAgICBlcnJvcj86IHN0cmluZztcbiAgICAgICAgZGF0YTogKHR5cGVvZiBzY3JlZW5zLiRpbmZlclNlbGVjdCAmIHtcbiAgICAgICAgICAgIHNjcmVlblJlZmVyZW5jZTogc3RyaW5nO1xuICAgICAgICAgICAgc2NyZWVuSWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzY3JlZW5EcmFmdElkPzogc3RyaW5nO1xuICAgICAgICAgICAgc2NyaXB0SWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzY3JpcHREcmFmdElkPzogc3RyaW5nO1xuICAgICAgICAgICAgaXNEcmFmdDogYm9vbGVhbjtcbiAgICAgICAgfSlbXTtcbiAgICB9ID0ge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgd2hlcmUgPSAhc2NyZWVuc1JlZmVyZW5jZXM/Lmxlbmd0aCA/IFtdIDogW29yKFxuICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmVlbklkLCBzY3JlZW5zUmVmZXJlbmNlcyksXG4gICAgICAgICAgICBpbkFycmF5KHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCwgc2NyZWVuc1JlZmVyZW5jZXMpLFxuICAgICAgICApXTtcbiAgICAgICAgaWYgKHNjcmlwdHNSZWZlcmVuY2VzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHdoZXJlLnB1c2gob3IoXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmlwdElkLCBzY3JpcHRzUmVmZXJlbmNlcyksXG4gICAgICAgICAgICAgICAgaW5BcnJheShzY3JlZW5zRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHNjcmlwdHNSZWZlcmVuY2VzKSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZHJhZnRzID0gYXdhaXQgZGIucXVlcnkuc2NyZWVuc0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogIXdoZXJlLmxlbmd0aCA/IHVuZGVmaW5lZCA6IGFuZCguLi53aGVyZSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHB1Ymxpc2hlZCA9IGF3YWl0IGRiLnF1ZXJ5LnNjcmVlbnMuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IGFuZCguLi5bXG4gICAgICAgICAgICAgICAgaXNOdWxsKHNjcmVlbnMuZGVsZXRlZEF0KSxcbiAgICAgICAgICAgICAgICAuLi4oIWRyYWZ0cy5sZW5ndGggPyBbXSA6IFtub3RJbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIGRyYWZ0cy5tYXAocyA9PiBzLmRhdGEuc2NyZWVuSWQhKSldKVxuICAgICAgICAgICAgXSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IFsuLi5yZXN1bHRzLmRhdGEsIC4uLmRyYWZ0cy5tYXAocyA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnMuZGF0YSxcbiAgICAgICAgICAgICAgICBzY3JlZW5SZWZlcmVuY2U6IHMuc2NyZWVuRHJhZnRJZCxcbiAgICAgICAgICAgICAgICBzY3JlZW5JZDogcy5zY3JlZW5JZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc2NyZWVuRHJhZnRJZDogcy5zY3JlZW5EcmFmdElkLFxuICAgICAgICAgICAgICAgIHNjcmlwdElkOiBzLnNjcmlwdElkLFxuICAgICAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHMuc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgICAgICAgICBpc0RyYWZ0OiB0cnVlLFxuICAgICAgICAgICAgfSBhcyB0eXBlb2YgcmVzdWx0cy5kYXRhWzBdO1xuICAgICAgICB9KV07XG5cbiAgICAgICAgcmVzdWx0cy5kYXRhID0gWy4uLnJlc3VsdHMuZGF0YSwgLi4ucHVibGlzaGVkLm1hcChzID0+ICh7XG4gICAgICAgICAgICAuLi5zLFxuICAgICAgICAgICAgc2NyZWVuUmVmZXJlbmNlOiBzLnNjcmVlbklkLFxuICAgICAgICAgICAgc2NyZWVuSWQ6IHMuc2NyZWVuSWQsXG4gICAgICAgICAgICBzY3JpcHRJZDogcy5zY3JpcHRJZCxcbiAgICAgICAgICAgIGlzRHJhZnQ6IGZhbHNlLFxuICAgICAgICB9KSldLnNvcnQoKGEsIGIpID0+IGEucG9zaXRpb24gLSBiLnBvc2l0aW9uKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICByZXN1bHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19saXN0UmF3U2NyZWVucyBFUlJPUicsIGUubWVzc2FnZSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldExhc3RTY3JlZW5Qb3NpdGlvbigpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgcG9zaXRpb246IHNjcmVlbnMucG9zaXRpb24sIH0pXG4gICAgICAgIC5mcm9tKHNjcmVlbnMpXG4gICAgICAgIC53aGVyZShpc051bGwoc2NyZWVucy5kZWxldGVkQXQpKVxuICAgICAgICAubGltaXQoMSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhzY3JlZW5zLnBvc2l0aW9uKSk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8ucG9zaXRpb24gfHwgMDtcbn0gXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY291bnRTY3JlZW5zKG9wdHM/OiB7XG4gICAgd2l0aEFyY2hpdmVkPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB7IHdpdGhBcmNoaXZlZCB9ID0geyAuLi5vcHRzIH07XG5cbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShzY3JlZW5zKTtcblxuICAgIGlmICghd2l0aEFyY2hpdmVkKSBxLndoZXJlKGlzTnVsbChzY3JlZW5zLmRlbGV0ZWRBdCkpO1xuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcS5leGVjdXRlKCk7XG4gICAgXG4gICAgcmV0dXJuIHJlc1swXT8uY291bnQ7XG59IFxuXG5leHBvcnQgdHlwZSBHZXRTY3JlZW5QYXJhbXMgPSBzdHJpbmc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyZWVuKHBhcmFtczogR2V0U2NyZWVuUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShzY3JlZW5zLnNjcmVlbklkLCBwYXJhbXMpIDogZXEoc2NyZWVucy5vbGRTY3JlZW5JZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIGlzTnVsbChzY3JlZW5zLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gIXJlcyA/IG51bGwgOiB7XG4gICAgICAgIC4uLnJlcyxcbiAgICAgICAgZmllbGRzOiByZXMuZmllbGRzIGFzIFNjcmlwdEZpZWxkW10sXG4gICAgICAgIGl0ZW1zOiByZXMuaXRlbXMgYXMgU2NyaXB0SXRlbVtdLFxuICAgICAgICBpbWFnZTE6IHJlcy5pbWFnZTEgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICBpbWFnZTI6IHJlcy5pbWFnZTIgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICBpbWFnZTM6IHJlcy5pbWFnZTMgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0U2NyZWVuV2l0aERyYWZ0KHBhcmFtczogR2V0U2NyZWVuUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShzY3JlZW5zLnNjcmVlbklkLCBwYXJhbXMpIDogZXEoc2NyZWVucy5vbGRTY3JlZW5JZCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS5zY3JlZW5zLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiBhbmQoXG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIGlzTnVsbChzY3JlZW5zLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgICAgIHdpdGg6IHtcbiAgICAgICAgICAgIGRyYWZ0OiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xuICAgIHJldHVybiAhcmVzID8gbnVsbCA6IHtcbiAgICAgICAgLi4ucmVzLFxuICAgICAgICBmaWVsZHM6IHJlcy5maWVsZHMgYXMgU2NyaXB0RmllbGRbXSxcbiAgICAgICAgaXRlbXM6IHJlcy5pdGVtcyBhcyBTY3JpcHRJdGVtW10sXG4gICAgICAgIGltYWdlMTogcmVzLmltYWdlMSBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMjogcmVzLmltYWdlMiBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIGltYWdlMzogcmVzLmltYWdlMyBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgIHByZVBvcHVsYXRlOiByZXMucHJlUG9wdWxhdGUgYXMgc3RyaW5nW10sXG4gICAgICAgIGRyYWZ0OiAhcmVzLmRyYWZ0ID8gbnVsbCEgOiB7XG4gICAgICAgICAgICAuLi5yZXMuZHJhZnQsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzLmRyYWZ0LmRhdGEsXG4gICAgICAgICAgICAgICAgZmllbGRzOiByZXMuZHJhZnQuZGF0YS5maWVsZHMgYXMgU2NyaXB0RmllbGRbXSxcbiAgICAgICAgICAgICAgICBpdGVtczogcmVzLmRyYWZ0LmRhdGEuaXRlbXMgYXMgU2NyaXB0SXRlbVtdLFxuICAgICAgICAgICAgICAgIGltYWdlMTogcmVzLmRyYWZ0LmRhdGEuaW1hZ2UxIGFzIG51bGwgfCBTY3JpcHRJbWFnZSxcbiAgICAgICAgICAgICAgICBpbWFnZTI6IHJlcy5kcmFmdC5kYXRhLmltYWdlMiBhcyBudWxsIHwgU2NyaXB0SW1hZ2UsXG4gICAgICAgICAgICAgICAgaW1hZ2UzOiByZXMuZHJhZnQuZGF0YS5pbWFnZTMgYXMgbnVsbCB8IFNjcmlwdEltYWdlLFxuICAgICAgICAgICAgICAgIHByZVBvcHVsYXRlOiByZXMuZHJhZnQuZGF0YS5wcmVQb3B1bGF0ZSBhcyBzdHJpbmdbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRTY3JlZW5NaW5pKHBhcmFtczogR2V0U2NyZWVuUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShzY3JlZW5zLnNjcmVlbklkLCBwYXJhbXMpIDogZXEoc2NyZWVucy5vbGRTY3JlZW5JZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuc2NyZWVucy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoc2NyZWVucy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgICAgICBjb2x1bW5zOiB7XG4gICAgICAgICAgICBzY3JlZW5JZDogdHJ1ZSxcbiAgICAgICAgICAgIG9sZFNjcmVlbklkOiB0cnVlLFxuICAgICAgICAgICAgdmVyc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6IHRydWUsXG4gICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRGdWxsU2NyZWVuKHBhcmFtczogR2V0U2NyZWVuUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcShzY3JlZW5zLnNjcmVlbklkLCBwYXJhbXMpIDogZXEoc2NyZWVucy5vbGRTY3JlZW5JZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuc2NyZWVucy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwoc2NyZWVucy5kZWxldGVkQXQpLFxuICAgICAgICApLFxuICAgIH0pO1xufVxuXG5leHBvcnQgdHlwZSBHZXRTY3JlZW5zUGFyYW1zID0ge1xuICAgIGxpbWl0PzogbnVtYmVyO1xuICAgIG9mZnNldD86IG51bWJlcjtcbiAgICBwYWdlPzogbnVtYmVyO1xuICAgIHNjcmVlbklkcz86IHN0cmluZ1tdO1xuICAgIHNlYXJjaFZhbHVlPzogc3RyaW5nO1xuICAgIGFyY2hpdmVkPzogYm9vbGVhbjtcbiAgICBzY3JpcHRzSWRzPzogc3RyaW5nW107XG59O1xuXG5hc3luYyBmdW5jdGlvbiBfX2dldFNjcmVlbnMoe1xuICAgIGxpbWl0LFxuICAgIHBhZ2UgPSAxLFxuICAgIHNjcmVlbklkcyxcbiAgICBzZWFyY2hWYWx1ZSxcbiAgICBhcmNoaXZlZCxcbiAgICBzY3JpcHRzSWRzLFxufTogR2V0U2NyZWVuc1BhcmFtcykge1xuICAgIHBhZ2UgPSBNYXRoLm1heCgwLCBwYWdlKTtcblxuICAgIGNvbnN0IGNvbmRpdGlvbnM6IFNRTFtdID0gW107XG5cbiAgICBpZiAoYXJjaGl2ZWQpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGlzTm90TnVsbChzY3JlZW5zLmRlbGV0ZWRBdCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChpc051bGwoc2NyZWVucy5kZWxldGVkQXQpKTtcbiAgICB9XG5cbiAgICBpZiAoc2NyZWVuSWRzPy5sZW5ndGgpIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KHNjcmVlbnMuc2NyZWVuSWQsIHNjcmVlbklkcykpO1xuXG4gICAgaWYgKHNjcmlwdHNJZHM/Lmxlbmd0aCkgY29uZGl0aW9ucy5wdXNoKGluQXJyYXkoc2NyZWVucy5zY3JpcHRJZCwgc2NyaXB0c0lkcykpO1xuXG4gICAgc2VhcmNoVmFsdWUgPSBgJHtzZWFyY2hWYWx1ZSB8fCAnJ31gLnRyaW0oKTtcbiAgICBpZiAoc2VhcmNoVmFsdWUpIHtcbiAgICAgICAgY29uc3Qgc2VhcmNoID0gWyclJywgc2VhcmNoVmFsdWUsICclJ10uam9pbignJyk7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChzcWxgTE9XRVIoc2NyZWVucy5uYW1lKSBsaWtlIExPV0VSKCR7c2VhcmNofSlgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb3VudFF1ZXJ5ID0gZGIuc2VsZWN0KHsgY291bnQ6IGNvdW50KCksIH0pLmZyb20oc2NyZWVucyk7XG4gICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoKSBjb3VudFF1ZXJ5LndoZXJlKGFuZCguLi5jb25kaXRpb25zKSk7XG5cbiAgICBjb25zdCBbeyBjb3VudDogdG90YWxSb3dzLCB9XSA9IGF3YWl0IGNvdW50UXVlcnkuZXhlY3V0ZSgpO1xuXG4gICAgbGV0IHRvdGFsUGFnZXMgPSAxO1xuICAgIGlmICh0b3RhbFJvd3Mpe1xuICAgICAgICB0b3RhbFBhZ2VzID0gaXNFbXB0eShsaW1pdCkgPyAxIDogTWF0aC5jZWlsKHRvdGFsUm93cyAvIGxpbWl0ISk7XG4gICAgICAgIHBhZ2UgPSBNYXRoLm1pbihwYWdlLCB0b3RhbFBhZ2VzKTtcbiAgICB9XG5cbiAgICBjb25zdCBvZmZzZXQgPSBpc0VtcHR5KGxpbWl0KSA/IHVuZGVmaW5lZCA6IE1hdGgubWF4KDAsIChwYWdlIC0gMSkgKiBsaW1pdCEpO1xuXG4gICAgY29uc3QgcSA9IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHNjcmVlbnMuaWQsXG4gICAgICAgICAgICBzY3JlZW5JZDogc2NyZWVucy5zY3JlZW5JZCxcbiAgICAgICAgICAgIG9sZFNjcmVlbklkOiBzY3JlZW5zLm9sZFNjcmVlbklkLFxuICAgICAgICAgICAgdmVyc2lvbjogc2NyZWVucy52ZXJzaW9uLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHNjcmVlbnMuc2NyaXB0SWQsXG4gICAgICAgICAgICB0eXBlOiBzY3JlZW5zLnR5cGUsXG4gICAgICAgICAgICBwb3NpdGlvbjogc2NyZWVucy5wb3NpdGlvbixcbiAgICAgICAgICAgIHNlY3Rpb25UaXRsZTogc2NyZWVucy5zZWN0aW9uVGl0bGUsXG4gICAgICAgICAgICBjb25kaXRpb246IHNjcmVlbnMuY29uZGl0aW9uLFxuICAgICAgICAgICAgZXBpY0lkOiBzY3JlZW5zLmVwaWNJZCxcbiAgICAgICAgICAgIHN0b3J5SWQ6IHNjcmVlbnMuc3RvcnlJZCxcbiAgICAgICAgICAgIHJlZklkOiBzY3JlZW5zLnJlZklkLFxuICAgICAgICAgICAgc3RlcDogc2NyZWVucy5zdGVwLFxuICAgICAgICAgICAgYWN0aW9uVGV4dDogc2NyZWVucy5hY3Rpb25UZXh0LFxuICAgICAgICAgICAgY29udGVudFRleHQ6IHNjcmVlbnMuY29udGVudFRleHQsXG4gICAgICAgICAgICB0aXRsZTogc2NyZWVucy50aXRsZSxcbiAgICAgICAgICAgIHRpdGxlMTogc2NyZWVucy50aXRsZTEsXG4gICAgICAgICAgICB0aXRsZTI6IHNjcmVlbnMudGl0bGUyLFxuICAgICAgICAgICAgdGl0bGUzOiBzY3JlZW5zLnRpdGxlMyxcbiAgICAgICAgICAgIHRpdGxlNDogc2NyZWVucy50aXRsZTQsXG4gICAgICAgICAgICBpbnN0cnVjdGlvbnM6IHNjcmVlbnMuaW5zdHJ1Y3Rpb25zLFxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zMjogc2NyZWVucy5pbnN0cnVjdGlvbnMyLFxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zMzogc2NyZWVucy5pbnN0cnVjdGlvbnMzLFxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zNDogc2NyZWVucy5pbnN0cnVjdGlvbnM0LFxuICAgICAgICAgICAgdGV4dDE6IHNjcmVlbnMudGV4dDEsXG4gICAgICAgICAgICB0ZXh0Mjogc2NyZWVucy50ZXh0MixcbiAgICAgICAgICAgIHRleHQzOiBzY3JlZW5zLnRleHQzLFxuICAgICAgICAgICAgaW1hZ2UxOiBzY3JlZW5zLmltYWdlMSxcbiAgICAgICAgICAgIGltYWdlMjogc2NyZWVucy5pbWFnZTIsXG4gICAgICAgICAgICBpbWFnZTM6IHNjcmVlbnMuaW1hZ2UzLFxuICAgICAgICAgICAgaGN3RGlhZ25vc2VzSW5zdHJ1Y3Rpb25zOiBzY3JlZW5zLmhjd0RpYWdub3Nlc0luc3RydWN0aW9ucyxcbiAgICAgICAgICAgIHN1Z2dlc3RlZERpYWdub3Nlc0luc3RydWN0aW9uczogc2NyZWVucy5zdWdnZXN0ZWREaWFnbm9zZXNJbnN0cnVjdGlvbnMsXG4gICAgICAgICAgICBub3Rlczogc2NyZWVucy5ub3RlcyxcbiAgICAgICAgICAgIGRhdGFUeXBlOiBzY3JlZW5zLmRhdGFUeXBlLFxuICAgICAgICAgICAgY29uZmlkZW50aWFsOiBzY3JlZW5zLmNvbmZpZGVudGlhbCxcbiAgICAgICAgICAgIGtleTogc2NyZWVucy5rZXksXG4gICAgICAgICAgICBsYWJlbDogc2NyZWVucy5sYWJlbCxcbiAgICAgICAgICAgIG5lZ2F0aXZlTGFiZWw6IHNjcmVlbnMubmVnYXRpdmVMYWJlbCxcbiAgICAgICAgICAgIHBvc2l0aXZlTGFiZWw6IHNjcmVlbnMucG9zaXRpdmVMYWJlbCxcbiAgICAgICAgICAgIHRpbWVyVmFsdWU6IHNjcmVlbnMudGltZXJWYWx1ZSxcbiAgICAgICAgICAgIG11bHRpcGxpZXI6IHNjcmVlbnMubXVsdGlwbGllcixcbiAgICAgICAgICAgIG1pblZhbHVlOiBzY3JlZW5zLm1pblZhbHVlLFxuICAgICAgICAgICAgbWF4VmFsdWU6IHNjcmVlbnMubWF4VmFsdWUsXG4gICAgICAgICAgICBleHBvcnRhYmxlOiBzY3JlZW5zLmV4cG9ydGFibGUsXG4gICAgICAgICAgICBza2lwcGFibGU6IHNjcmVlbnMuc2tpcHBhYmxlLFxuICAgICAgICAgICAgcHJlUG9wdWxhdGU6IHNjcmVlbnMucHJlUG9wdWxhdGUsXG4gICAgICAgICAgICBmaWVsZHM6IHNjcmVlbnMuZmllbGRzLFxuICAgICAgICAgICAgaXRlbXM6IHNjcmVlbnMuaXRlbXMsXG4gICAgICAgICAgICBwdWJsaXNoRGF0ZTogc2NyZWVucy5wdWJsaXNoRGF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2NyZWVucy5jcmVhdGVkQXQsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHNjcmVlbnMudXBkYXRlZEF0LFxuICAgICAgICAgICAgZGVsZXRlZEF0OiBzY3JlZW5zLmRlbGV0ZWRBdCxcbiAgICAgICAgICAgIHNjcmVlbkRyYWZ0SWQ6IHNjcmVlbnNEcmFmdHMuc2NyZWVuRHJhZnRJZCxcbiAgICAgICAgICAgIHNjcmlwdERyYWZ0SWQ6IHNjcmVlbnNEcmFmdHMuc2NyaXB0RHJhZnRJZCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oc2NyZWVucylcbiAgICAgICAgLmxlZnRKb2luKHNjcmVlbnNEcmFmdHMsIGVxKHNjcmVlbnMuc2NyZWVuSWQsIHNjcmVlbnNEcmFmdHMuc2NyZWVuSWQpKVxuICAgICAgICAub3JkZXJCeShkZXNjKHNjcmVlbnMucG9zaXRpb24pKTtcblxuICAgIGlmICghaXNFbXB0eShsaW1pdCkpIHEubGltaXQobGltaXQhKTtcblxuICAgIGlmIChvZmZzZXQpIHEub2Zmc2V0KG9mZnNldCk7XG5cbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGgpIHEud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBxLmV4ZWN1dGUoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBkYXRhOiBkYXRhLm1hcChzID0+ICh7XG4gICAgICAgICAgICAuLi5zLFxuICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogcy52ZXJzaW9uLFxuICAgICAgICAgICAgaXNEcmFmdDogZmFsc2UsXG4gICAgICAgICAgICBzY3JlZW5EcmFmdElkOiBzLnNjcmVlbkRyYWZ0SWQgYXMgdHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVyU2VsZWN0WydzY3JlZW5EcmFmdElkJ10gfCB1bmRlZmluZWQsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkOiBzLnNjcmlwdERyYWZ0SWQgYXMgdHlwZW9mIHNjcmVlbnNEcmFmdHMuJGluZmVyU2VsZWN0WydzY3JpcHREcmFmdElkJ10gfCB1bmRlZmluZWQsXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWxSb3dzLFxuICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICB9O1xufVxuXG5leHBvcnQgY29uc3QgX2dldFNjcmVlbnNEZWZhdWx0UmVzdWx0cyA9IHtcbiAgICBwYWdlOiAxLFxuICAgIGxpbWl0OiB1bmRlZmluZWQsXG4gICAgdG90YWxSb3dzOiAwLFxuICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgZGF0YTogW10sXG4gICAgc2VhcmNoVmFsdWU6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbiAgICBlcnJvcjogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxufSBhcyBBd2FpdGVkPFJldHVyblR5cGU8dHlwZW9mIF9fZ2V0U2NyZWVucz4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmVlbnMocGFyYW1zPzogR2V0U2NyZWVuc1BhcmFtcykge1xuICAgIGxldCByc2x0cyA9IF9nZXRTY3JlZW5zRGVmYXVsdFJlc3VsdHM7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgICAgcnNsdHMgPSBhd2FpdCBfX2dldFNjcmVlbnMoeyAuLi5wYXJhbXMgfSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfZ2V0U2NyZWVucyBFUlJPUicsIGUpO1xuICAgICAgICByc2x0cy5lcnJvciA9IGUubWVzc2FnZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcnNsdHM7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImVxIiwiYW5kIiwiaXNOdWxsIiwiY291bnQiLCJpbkFycmF5IiwiZGVzYyIsInNxbCIsImlzTm90TnVsbCIsIm5vdEluQXJyYXkiLCJvciIsInV1aWQiLCJpc0VtcHR5IiwiZGIiLCJzY3JlZW5zIiwic2NyZWVuc0RyYWZ0cyIsImxvZ2dlciIsIl9saXN0U2NyZWVucyIsIm9wdHMiLCJzY3JlZW5zUmVmZXJlbmNlcyIsInNjcmlwdHNSZWZlcmVuY2VzIiwicmVzdWx0cyIsImRhdGEiLCJ3aGVyZSIsImxlbmd0aCIsInNjcmVlbklkIiwic2NyZWVuRHJhZnRJZCIsInB1c2giLCJzY3JpcHRJZCIsInNjcmlwdERyYWZ0SWQiLCJkcmFmdHMiLCJxdWVyeSIsImZpbmRNYW55IiwidW5kZWZpbmVkIiwiY29sdW1ucyIsInB1Ymxpc2hlZCIsImRlbGV0ZWRBdCIsIm1hcCIsInMiLCJwb3NpdGlvbiIsInRpdGxlIiwic2NyZWVuUmVmZXJlbmNlIiwiaXNEcmFmdCIsInNvcnQiLCJhIiwiYiIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJfbGlzdFJhd1NjcmVlbnMiLCJfZ2V0TGFzdFNjcmVlblBvc2l0aW9uIiwicmVzIiwic2VsZWN0IiwiZnJvbSIsImxpbWl0Iiwib3JkZXJCeSIsIl9jb3VudFNjcmVlbnMiLCJ3aXRoQXJjaGl2ZWQiLCJxIiwiZXhlY3V0ZSIsIl9nZXRTY3JlZW4iLCJwYXJhbXMiLCJ2YWxpZGF0ZSIsIm9sZFNjcmVlbklkIiwiZmluZEZpcnN0IiwiZmllbGRzIiwiaXRlbXMiLCJpbWFnZTEiLCJpbWFnZTIiLCJpbWFnZTMiLCJfZ2V0U2NyZWVuV2l0aERyYWZ0Iiwid2l0aCIsImRyYWZ0IiwicHJlUG9wdWxhdGUiLCJfZ2V0U2NyZWVuTWluaSIsInZlcnNpb24iLCJ0eXBlIiwiX2dldEZ1bGxTY3JlZW4iLCJfX2dldFNjcmVlbnMiLCJwYWdlIiwic2NyZWVuSWRzIiwic2VhcmNoVmFsdWUiLCJhcmNoaXZlZCIsInNjcmlwdHNJZHMiLCJNYXRoIiwibWF4IiwiY29uZGl0aW9ucyIsInRyaW0iLCJzZWFyY2giLCJqb2luIiwiY291bnRRdWVyeSIsInRvdGFsUm93cyIsInRvdGFsUGFnZXMiLCJjZWlsIiwibWluIiwib2Zmc2V0IiwiaWQiLCJzZWN0aW9uVGl0bGUiLCJjb25kaXRpb24iLCJlcGljSWQiLCJzdG9yeUlkIiwicmVmSWQiLCJzdGVwIiwiYWN0aW9uVGV4dCIsImNvbnRlbnRUZXh0IiwidGl0bGUxIiwidGl0bGUyIiwidGl0bGUzIiwidGl0bGU0IiwiaW5zdHJ1Y3Rpb25zIiwiaW5zdHJ1Y3Rpb25zMiIsImluc3RydWN0aW9uczMiLCJpbnN0cnVjdGlvbnM0IiwidGV4dDEiLCJ0ZXh0MiIsInRleHQzIiwiaGN3RGlhZ25vc2VzSW5zdHJ1Y3Rpb25zIiwic3VnZ2VzdGVkRGlhZ25vc2VzSW5zdHJ1Y3Rpb25zIiwibm90ZXMiLCJkYXRhVHlwZSIsImNvbmZpZGVudGlhbCIsImtleSIsImxhYmVsIiwibmVnYXRpdmVMYWJlbCIsInBvc2l0aXZlTGFiZWwiLCJ0aW1lclZhbHVlIiwibXVsdGlwbGllciIsIm1pblZhbHVlIiwibWF4VmFsdWUiLCJleHBvcnRhYmxlIiwic2tpcHBhYmxlIiwicHVibGlzaERhdGUiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJsZWZ0Sm9pbiIsInB1Ymxpc2hlZFZlcnNpb24iLCJfZ2V0U2NyZWVuc0RlZmF1bHRSZXN1bHRzIiwiX2dldFNjcmVlbnMiLCJyc2x0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/screens.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/scripts-drafts.ts":
/*!*********************************************!*\
  !*** ./databases/queries/scripts-drafts.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _countScriptsDrafts: () => (/* binding */ _countScriptsDrafts),\n/* harmony export */   _getFullScriptDraft: () => (/* binding */ _getFullScriptDraft),\n/* harmony export */   _getScriptDraft: () => (/* binding */ _getScriptDraft),\n/* harmony export */   _getScriptDraftMini: () => (/* binding */ _getScriptDraftMini),\n/* harmony export */   _getScriptsDrafts: () => (/* binding */ _getScriptsDrafts),\n/* harmony export */   _getScriptsDraftsDefaultResults: () => (/* binding */ _getScriptsDraftsDefaultResults)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\nasync function _countScriptsDrafts(opts) {\n    const q = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts);\n    if (opts?.firstVersion) q.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptId));\n    const res = await q.execute();\n    return res[0]?.count || 0;\n}\nasync function _getScriptDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            scriptDraftId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n}\nasync function _getScriptDraftMini(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findFirst({\n        where,\n        columns: {\n            id: true,\n            scriptDraftId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n}\nasync function _getFullScriptDraft(params) {\n    const where = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findFirst({\n        where\n    });\n}\nasync function __getScriptsDrafts({ limit, page = 1, scriptDraftIds, searchValue, withoutScriptId }) {\n    page = Math.max(0, page);\n    const conditions = [];\n    if (scriptDraftIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptDraftId, scriptDraftIds));\n    if (withoutScriptId) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.scriptId));\n    searchValue = `${searchValue || \"\"}`.trim();\n    // if (searchValue) {\n    //     const search = ['%', searchValue, '%'].join('');\n    //     conditions.push(sql`json_array_elements(content->data) like LOWER(${search})`);\n    // }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const data = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_1__[\"default\"].query.scriptsDrafts.findMany({\n        where: conditions.length ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)(...conditions) : undefined,\n        limit: (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(limit) ? undefined : limit,\n        orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_2__.scriptsDrafts.id),\n        offset,\n        columns: {\n            id: true,\n            scriptDraftId: true,\n            scriptId: true,\n            data: true\n        }\n    });\n    return {\n        page,\n        limit,\n        data: data.map(({ data, id, scriptDraftId, scriptId })=>({\n                ...data,\n                id,\n                scriptDraftId,\n                publishedVersion: !scriptId ? null : Math.max(1, data.version - 1)\n            })),\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getScriptsDraftsDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getScriptsDrafts(params) {\n    let rslts = _getScriptsDraftsDefaultResults;\n    try {\n        rslts = await __getScriptsDrafts({\n            ...params\n        });\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getScriptDrafts ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvcXVlcmllcy9zY3JpcHRzLWRyYWZ0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQTBFO0FBRWxDO0FBQ1Q7QUFDYztBQUNYO0FBRTNCLGVBQWVVLG9CQUFvQkMsSUFFekM7SUFDRyxNQUFNQyxJQUFJTCxtREFBRUEsQ0FDUE0sTUFBTSxDQUFDO1FBQUVYLE9BQU9BLGtEQUFLQTtJQUFJLEdBQ3pCWSxJQUFJLENBQUNOLHFEQUFhQTtJQUV2QixJQUFJRyxNQUFNSSxjQUFjSCxFQUFFSSxLQUFLLENBQUNYLG1EQUFNQSxDQUFDRyxxREFBYUEsQ0FBQ1MsUUFBUTtJQUU3RCxNQUFNQyxNQUFNLE1BQU1OLEVBQUVPLE9BQU87SUFFM0IsT0FBT0QsR0FBRyxDQUFDLEVBQUUsRUFBRWhCLFNBQVM7QUFDNUI7QUFJTyxlQUFla0IsZ0JBQWdCQyxNQUE0QjtJQUM5RCxNQUFNTCxRQUFRaEIsK0NBQUVBLENBQUNRLHFEQUFhQSxDQUFDYyxhQUFhLEVBQUVEO0lBQzlDLE9BQU8sTUFBTWQsbURBQUVBLENBQUNnQixLQUFLLENBQUNmLGFBQWEsQ0FBQ2dCLFNBQVMsQ0FBQztRQUMxQ1I7UUFDQVMsU0FBUztZQUNMQyxJQUFJO1lBQ0pKLGVBQWU7WUFDZkwsVUFBVTtZQUNWVSxNQUFNO1FBQ1Y7SUFDSjtBQUNKO0FBRU8sZUFBZUMsb0JBQW9CUCxNQUE0QjtJQUNsRSxNQUFNTCxRQUFRaEIsK0NBQUVBLENBQUNRLHFEQUFhQSxDQUFDYyxhQUFhLEVBQUVEO0lBQzlDLE9BQU8sTUFBTWQsbURBQUVBLENBQUNnQixLQUFLLENBQUNmLGFBQWEsQ0FBQ2dCLFNBQVMsQ0FBQztRQUMxQ1I7UUFDQVMsU0FBUztZQUNMQyxJQUFJO1lBQ0pKLGVBQWU7WUFDZkwsVUFBVTtZQUNWVSxNQUFNO1FBQ1Y7SUFDSjtBQUNKO0FBRU8sZUFBZUUsb0JBQW9CUixNQUE0QjtJQUNsRSxNQUFNTCxRQUFRaEIsK0NBQUVBLENBQUNRLHFEQUFhQSxDQUFD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U0FBVTtRQUNOLE9BQU9GO0lBQ1g7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vZGF0YWJhc2VzL3F1ZXJpZXMvc2NyaXB0cy1kcmFmdHMudHM/YjNhNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcSwgYW5kLCBTUUwsIGNvdW50LCBpbkFycmF5LCBkZXNjLCBpc051bGwsIH0gZnJvbSBcImRyaXp6bGUtb3JtXCI7XG5cbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tIFwiQC9saWIvaXNFbXB0eVwiO1xuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyBzY3JpcHRzRHJhZnRzIH0gZnJvbSBcIi4uL3BnL3NjaGVtYVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfY291bnRTY3JpcHRzRHJhZnRzKG9wdHM/OiB7XG4gICAgZmlyc3RWZXJzaW9uPzogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCBxID0gZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KVxuICAgICAgICAuZnJvbShzY3JpcHRzRHJhZnRzKTtcblxuICAgIGlmIChvcHRzPy5maXJzdFZlcnNpb24pIHEud2hlcmUoaXNOdWxsKHNjcmlwdHNEcmFmdHMuc2NyaXB0SWQpKTtcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHEuZXhlY3V0ZSgpO1xuICAgIFxuICAgIHJldHVybiByZXNbMF0/LmNvdW50IHx8IDA7XG59XG5cbmV4cG9ydCB0eXBlIEdldFNjcmlwdERyYWZ0UGFyYW1zID0gc3RyaW5nO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmlwdERyYWZ0KHBhcmFtczogR2V0U2NyaXB0RHJhZnRQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IGVxKHNjcmlwdHNEcmFmdHMuc2NyaXB0RHJhZnRJZCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkuc2NyaXB0c0RyYWZ0cy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0SWQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFNjcmlwdERyYWZ0TWluaShwYXJhbXM6IEdldFNjcmlwdERyYWZ0UGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSBlcShzY3JpcHRzRHJhZnRzLnNjcmlwdERyYWZ0SWQsIHBhcmFtcyk7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnF1ZXJ5LnNjcmlwdHNEcmFmdHMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRGdWxsU2NyaXB0RHJhZnQocGFyYW1zOiBHZXRTY3JpcHREcmFmdFBhcmFtcykge1xuICAgIGNvbnN0IHdoZXJlID0gZXEoc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkLCBwYXJhbXMpO1xuICAgIHJldHVybiBhd2FpdCBkYi5xdWVyeS5zY3JpcHRzRHJhZnRzLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlLFxuICAgIH0pO1xufVxuXG5leHBvcnQgdHlwZSBHZXRTY3JpcHRzRHJhZnRzUGFyYW1zID0ge1xuICAgIGxpbWl0PzogbnVtYmVyO1xuICAgIG9mZnNldD86IG51bWJlcjtcbiAgICBwYWdlPzogbnVtYmVyO1xuICAgIHNjcmlwdERyYWZ0SWRzPzogc3RyaW5nW107XG4gICAgc2VhcmNoVmFsdWU/OiBzdHJpbmc7XG4gICAgd2l0aG91dFNjcmlwdElkPzogYm9vbGVhbjtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIF9fZ2V0U2NyaXB0c0RyYWZ0cyh7XG4gICAgbGltaXQsXG4gICAgcGFnZSA9IDEsXG4gICAgc2NyaXB0RHJhZnRJZHMsXG4gICAgc2VhcmNoVmFsdWUsXG4gICAgd2l0aG91dFNjcmlwdElkLFxufTogR2V0U2NyaXB0c0RyYWZ0c1BhcmFtcykge1xuICAgIHBhZ2UgPSBNYXRoLm1heCgwLCBwYWdlKTtcblxuICAgIGNvbnN0IGNvbmRpdGlvbnM6IFNRTFtdID0gW107XG5cbiAgICBpZiAoc2NyaXB0RHJhZnRJZHM/Lmxlbmd0aCkgY29uZGl0aW9ucy5wdXNoKGluQXJyYXkoc2NyaXB0c0RyYWZ0cy5zY3JpcHREcmFmdElkLCBzY3JpcHREcmFmdElkcykpO1xuXG4gICAgaWYgKHdpdGhvdXRTY3JpcHRJZCkgY29uZGl0aW9ucy5wdXNoKGlzTnVsbChzY3JpcHRzRHJhZnRzLnNjcmlwdElkKSk7XG5cbiAgICBzZWFyY2hWYWx1ZSA9IGAke3NlYXJjaFZhbHVlIHx8ICcnfWAudHJpbSgpO1xuICAgIC8vIGlmIChzZWFyY2hWYWx1ZSkge1xuICAgIC8vICAgICBjb25zdCBzZWFyY2ggPSBbJyUnLCBzZWFyY2hWYWx1ZSwgJyUnXS5qb2luKCcnKTtcbiAgICAvLyAgICAgY29uZGl0aW9ucy5wdXNoKHNxbGBqc29uX2FycmF5X2VsZW1lbnRzKGNvbnRlbnQtPmRhdGEpIGxpa2UgTE9XRVIoJHtzZWFyY2h9KWApO1xuICAgIC8vIH1cblxuICAgIGNvbnN0IGNvdW50UXVlcnkgPSBkYi5zZWxlY3QoeyBjb3VudDogY291bnQoKSwgfSkuZnJvbShzY3JpcHRzRHJhZnRzKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbFJvd3MsIH1dID0gYXdhaXQgY291bnRRdWVyeS5leGVjdXRlKCk7XG5cbiAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG4gICAgaWYgKHRvdGFsUm93cyl7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBpc0VtcHR5KGxpbWl0KSA/IDEgOiBNYXRoLmNlaWwodG90YWxSb3dzIC8gbGltaXQhKTtcbiAgICAgICAgcGFnZSA9IE1hdGgubWluKHBhZ2UsIHRvdGFsUGFnZXMpO1xuICAgIH1cblxuICAgIGNvbnN0IG9mZnNldCA9IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogTWF0aC5tYXgoMCwgKHBhZ2UgLSAxKSAqIGxpbWl0ISk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZGIucXVlcnkuc2NyaXB0c0RyYWZ0cy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiBjb25kaXRpb25zLmxlbmd0aCA/IGFuZCguLi5jb25kaXRpb25zKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgbGltaXQ6IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogbGltaXQhLFxuICAgICAgICBvcmRlckJ5OiBkZXNjKHNjcmlwdHNEcmFmdHMuaWQpLFxuICAgICAgICBvZmZzZXQsXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgc2NyaXB0RHJhZnRJZDogdHJ1ZSxcbiAgICAgICAgICAgIHNjcmlwdElkOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBkYXRhOiBkYXRhLm1hcCgoeyBkYXRhLCBpZCwgc2NyaXB0RHJhZnRJZCwgc2NyaXB0SWQsIH0pID0+ICh7XG4gICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBzY3JpcHREcmFmdElkLFxuICAgICAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogIXNjcmlwdElkID8gbnVsbCA6IE1hdGgubWF4KDEsIGRhdGEudmVyc2lvbiAtIDEpLFxuICAgICAgICB9KSksXG4gICAgICAgIHRvdGFsUm93cyxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgc2VhcmNoVmFsdWUsXG4gICAgICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IF9nZXRTY3JpcHRzRHJhZnRzRGVmYXVsdFJlc3VsdHMgPSB7XG4gICAgcGFnZTogMSxcbiAgICBsaW1pdDogdW5kZWZpbmVkLFxuICAgIHRvdGFsUm93czogMCxcbiAgICB0b3RhbFBhZ2VzOiAxLFxuICAgIGRhdGE6IFtdLFxuICAgIHNlYXJjaFZhbHVlOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgZXJyb3I6IHVuZGVmaW5lZCBhcyAodW5kZWZpbmVkIHwgc3RyaW5nKSxcbn0gYXMgQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBfX2dldFNjcmlwdHNEcmFmdHM+PjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRTY3JpcHRzRHJhZnRzKHBhcmFtcz86IEdldFNjcmlwdHNEcmFmdHNQYXJhbXMpIHtcbiAgICBsZXQgcnNsdHMgPSBfZ2V0U2NyaXB0c0RyYWZ0c0RlZmF1bHRSZXN1bHRzO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgcnNsdHMgPSBhd2FpdCBfX2dldFNjcmlwdHNEcmFmdHMoeyAuLi5wYXJhbXMgfSk7XG4gICAgfSBjYXRjaChlOiBhbnkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdfZ2V0U2NyaXB0RHJhZnRzIEVSUk9SJywgZSk7XG4gICAgICAgIHJzbHRzLmVycm9yID0gZS5tZXNzYWdlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAgIHJldHVybiByc2x0cztcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiZXEiLCJhbmQiLCJjb3VudCIsImluQXJyYXkiLCJkZXNjIiwiaXNOdWxsIiwiaXNFbXB0eSIsImRiIiwic2NyaXB0c0RyYWZ0cyIsImxvZ2dlciIsIl9jb3VudFNjcmlwdHNEcmFmdHMiLCJvcHRzIiwicSIsInNlbGVjdCIsImZyb20iLCJmaXJzdFZlcnNpb24iLCJ3aGVyZSIsInNjcmlwdElkIiwicmVzIiwiZXhlY3V0ZSIsIl9nZXRTY3JpcHREcmFmdCIsInBhcmFtcyIsInNjcmlwdERyYWZ0SWQiLCJxdWVyeSIsImZpbmRGaXJzdCIsImNvbHVtbnMiLCJpZCIsImRhdGEiLCJfZ2V0U2NyaXB0RHJhZnRNaW5pIiwiX2dldEZ1bGxTY3JpcHREcmFmdCIsIl9fZ2V0U2NyaXB0c0RyYWZ0cyIsImxpbWl0IiwicGFnZSIsInNjcmlwdERyYWZ0SWRzIiwic2VhcmNoVmFsdWUiLCJ3aXRob3V0U2NyaXB0SWQiLCJNYXRoIiwibWF4IiwiY29uZGl0aW9ucyIsImxlbmd0aCIsInB1c2giLCJ0cmltIiwiY291bnRRdWVyeSIsInRvdGFsUm93cyIsInRvdGFsUGFnZXMiLCJjZWlsIiwibWluIiwib2Zmc2V0IiwidW5kZWZpbmVkIiwiZmluZE1hbnkiLCJvcmRlckJ5IiwibWFwIiwicHVibGlzaGVkVmVyc2lvbiIsInZlcnNpb24iLCJlcnJvciIsIl9nZXRTY3JpcHRzRHJhZnRzRGVmYXVsdFJlc3VsdHMiLCJfZ2V0U2NyaXB0c0RyYWZ0cyIsInJzbHRzIiwiZSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/scripts-drafts.ts\n");

/***/ }),

/***/ "(rsc)/./databases/queries/users.ts":
/*!************************************!*\
  !*** ./databases/queries/users.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   _getFullUser: () => (/* binding */ _getFullUser),\n/* harmony export */   _getUser: () => (/* binding */ _getUser),\n/* harmony export */   _getUserMini: () => (/* binding */ _getUserMini),\n/* harmony export */   _getUsers: () => (/* binding */ _getUsers),\n/* harmony export */   _getUsersDefaultResults: () => (/* binding */ _getUsersDefaultResults),\n/* harmony export */   _searchUsers: () => (/* binding */ _searchUsers)\n/* harmony export */ });\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/sql.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/select.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/functions/aggregate.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/validate.js\");\n/* harmony import */ var _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _pg_schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n/* harmony import */ var _lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/isEmpty */ \"(rsc)/./lib/isEmpty.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/logger */ \"(rsc)/./lib/logger.ts\");\n\n\n\n\n\n\nasync function _searchUsers(searchValue) {\n    let search = searchValue.split(\" \").join(\":* | \");\n    search = [\n        search,\n        \":*\"\n    ].join(\"\");\n    const matchQuery = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.sql)`(\n        setweight(to_tsvector('english', ${_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email}), 'A') ||\n        setweight(to_tsvector('english', ${_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.displayName}), 'B')\n    ), to_tsquery('english', ${search})`;\n    const whereMatchQuery = (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.sql)`(\n        setweight(to_tsvector('english', ${_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email}), 'A') ||\n        setweight(to_tsvector('english', ${_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.displayName}), 'B')\n    ) @@ to_tsquery('english', ${search})`;\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        //   ...getTableColumns(users),\n        userId: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.userId,\n        email: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email,\n        displayName: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.displayName,\n        firstName: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.firstName,\n        lastName: _pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.lastName,\n        rank: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.sql)`ts_rank(${matchQuery})`,\n        rankCd: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.sql)`ts_rank_cd(${matchQuery})`\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users).where(whereMatchQuery).orderBy((t)=>(0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(t.rank));\n}\nasync function _getUser(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.userId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email, params);\n    const res = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.users.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.deletedAt)),\n        columns: {\n            id: true,\n            userId: true,\n            displayName: true,\n            firstName: true,\n            lastName: true,\n            avatar: true,\n            avatar_md: true,\n            avatar_sm: true,\n            activationDate: true,\n            email: true,\n            role: true,\n            createdAt: true,\n            lastLoginDate: true,\n            password: true\n        }\n    });\n    return {\n        ...res,\n        isActive: !!res?.password\n    };\n}\nasync function _getUserMini(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.userId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.users.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.deletedAt)),\n        columns: {\n            id: true,\n            userId: true,\n            email: true,\n            role: true,\n            lastLoginDate: true\n        }\n    });\n}\nasync function _getFullUser(params) {\n    const where = uuid__WEBPACK_IMPORTED_MODULE_6__[\"default\"](params) ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.userId, params) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.eq)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.email, params);\n    return await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.users.findFirst({\n        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(where, (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.deletedAt))\n    });\n}\nasync function __getUsers({ limit, roles, page = 1, userIds, status, searchValue }) {\n    page = Math.max(0, page);\n    const conditions = [\n        (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.deletedAt)\n    ];\n    if (userIds?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.userId, userIds));\n    if (roles?.length) conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.inArray)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.role, roles));\n    if (status === \"active\") conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNotNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.activationDate));\n    if (status === \"inactive\") conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.isNull)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.activationDate));\n    searchValue = `${searchValue || \"\"}`.trim();\n    if (searchValue) {\n        const search = [\n            \"%\",\n            searchValue,\n            \"%\"\n        ].join(\"\");\n        conditions.push((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_4__.sql)`(LOWER(users.email) like LOWER(${search}) OR LOWER(users.display_name) like LOWER(${search}) OR LOWER(users.first_name) like LOWER(${search}) OR LOWER(users.last_name) like LOWER(${search}))`);\n    }\n    const countQuery = _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].select({\n        count: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_8__.count)()\n    }).from(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users);\n    if (conditions.length) countQuery.where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(...conditions));\n    const [{ count: totalRows }] = await countQuery.execute();\n    let totalPages = 1;\n    if (totalRows) {\n        totalPages = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit) ? 1 : Math.ceil(totalRows / limit);\n        page = Math.min(page, totalPages);\n    }\n    const offset = (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit) ? undefined : Math.max(0, (page - 1) * limit);\n    const data = await _pg_drizzle__WEBPACK_IMPORTED_MODULE_0__[\"default\"].query.users.findMany({\n        where: conditions.length ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_7__.and)(...conditions) : undefined,\n        limit: (0,_lib_isEmpty__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(limit) ? undefined : limit,\n        orderBy: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.desc)(_pg_schema__WEBPACK_IMPORTED_MODULE_1__.users.id),\n        offset,\n        columns: {\n            id: true,\n            userId: true,\n            displayName: true,\n            firstName: true,\n            lastName: true,\n            avatar: true,\n            avatar_md: true,\n            avatar_sm: true,\n            activationDate: true,\n            email: true,\n            role: true,\n            createdAt: true,\n            lastLoginDate: true\n        }\n    });\n    return {\n        page,\n        limit,\n        data,\n        totalRows,\n        totalPages,\n        searchValue,\n        error: undefined\n    };\n}\nconst _getUsersDefaultResults = {\n    page: 1,\n    limit: undefined,\n    totalRows: 0,\n    totalPages: 1,\n    data: [],\n    searchValue: undefined,\n    error: undefined\n};\nasync function _getUsers(params) {\n    let rslts = _getUsersDefaultResults;\n    try {\n        rslts = await __getUsers(params);\n    } catch (e) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"].error(\"_getUsers ERROR\", e);\n        rslts.error = e.message;\n    } finally{\n        return rslts;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFdBQVc7WUFDWEMsZ0JBQWdCO1lBQ2hCekIsT0FBTztZQUNQMEIsTUFBTTtZQUNOQyxXQUFXO1lBQ1hDLGVBQWU7UUFDbkI7SUFDSjtJQUVBLE9BQU87UUFDSFE7UUFDQUY7UUFDQW1CO1FBQ0FQO1FBQ0FFO1FBQ0FyRDtRQUNBNEQsT0FBT0g7SUFDWDtBQUNKO0FBRU8sTUFBTUksMEJBQTBCO0lBQ25DcEIsTUFBTTtJQUNORixPQUFPa0I7SUFDUE4sV0FBVztJQUNYRSxZQUFZO0lBQ1pLLE1BQU0sRUFBRTtJQUNSMUQsYUFBYXlEO0lBQ2JHLE9BQU9IO0FBQ1gsRUFBNEM7QUFFckMsZUFBZUssVUFBVTNDLE1BQXNCO0lBQ2xELElBQUk0QyxRQUFRRjtJQUNaLElBQUk7UUFDQUUsUUFBUSxNQUFNekIsV0FBV25CO0lBQzdCLEVBQUUsT0FBTTZDLEdBQVE7UUFDWmxFLG1EQUFNQSxDQUFDOEQsS0FBSyxDQUFDLG1CQUFtQkk7UUFDaENELE1BQU1ILEtBQUssR0FBR0ksRUFBRUMsT0FBTztJQUMzQixTQUFVO1FBQ04sT0FBT0Y7SUFDWDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmVvdHJlZS13ZWJlZGl0b3IvLi9kYXRhYmFzZXMvcXVlcmllcy91c2Vycy50cz9kYWY2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVxLCBhbmQsIGlzTnVsbCwgU1FMLCBjb3VudCwgaW5BcnJheSwgaXNOb3ROdWxsLCBkZXNjLCBzcWwsIGdldFRhYmxlQ29sdW1ucyB9IGZyb20gXCJkcml6emxlLW9ybVwiO1xuaW1wb3J0ICogYXMgdXVpZCBmcm9tICd1dWlkJztcblxuaW1wb3J0IGRiIGZyb20gXCIuLi9wZy9kcml6emxlXCI7XG5pbXBvcnQgeyB1c2VycyB9IGZyb20gXCIuLi9wZy9zY2hlbWFcIjtcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tIFwiQC9saWIvaXNFbXB0eVwiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwiQC9saWIvbG9nZ2VyXCI7XG5cbmV4cG9ydCB0eXBlIEdldFVzZXJQYXJhbXMgPSBzdHJpbmc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfc2VhcmNoVXNlcnMoc2VhcmNoVmFsdWU6IHN0cmluZykge1xuICAgIGxldCBzZWFyY2ggPSBzZWFyY2hWYWx1ZS5zcGxpdCgnICcpLmpvaW4oJzoqIHwgJyk7XG4gICAgc2VhcmNoID0gW3NlYXJjaCwgJzoqJ10uam9pbignJyk7XG5cbiAgICBjb25zdCBtYXRjaFF1ZXJ5ID0gc3FsYChcbiAgICAgICAgc2V0d2VpZ2h0KHRvX3RzdmVjdG9yKCdlbmdsaXNoJywgJHt1c2Vycy5lbWFpbH0pLCAnQScpIHx8XG4gICAgICAgIHNldHdlaWdodCh0b190c3ZlY3RvcignZW5nbGlzaCcsICR7dXNlcnMuZGlzcGxheU5hbWV9KSwgJ0InKVxuICAgICksIHRvX3RzcXVlcnkoJ2VuZ2xpc2gnLCAke3NlYXJjaH0pYDtcblxuICAgIGNvbnN0IHdoZXJlTWF0Y2hRdWVyeSA9IHNxbGAoXG4gICAgICAgIHNldHdlaWdodCh0b190c3ZlY3RvcignZW5nbGlzaCcsICR7dXNlcnMuZW1haWx9KSwgJ0EnKSB8fFxuICAgICAgICBzZXR3ZWlnaHQodG9fdHN2ZWN0b3IoJ2VuZ2xpc2gnLCAke3VzZXJzLmRpc3BsYXlOYW1lfSksICdCJylcbiAgICApIEBAIHRvX3RzcXVlcnkoJ2VuZ2xpc2gnLCAke3NlYXJjaH0pYDtcblxuICAgIHJldHVybiBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIC8vICAgLi4uZ2V0VGFibGVDb2x1bW5zKHVzZXJzKSxcbiAgICAgICAgICAgIHVzZXJJZDogdXNlcnMudXNlcklkLFxuICAgICAgICAgICAgZW1haWw6IHVzZXJzLmVtYWlsLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHVzZXJzLmRpc3BsYXlOYW1lLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB1c2Vycy5maXJzdE5hbWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdXNlcnMubGFzdE5hbWUsXG4gICAgICAgICAgICByYW5rOiBzcWxgdHNfcmFuaygke21hdGNoUXVlcnl9KWAsXG4gICAgICAgICAgICByYW5rQ2Q6IHNxbGB0c19yYW5rX2NkKCR7bWF0Y2hRdWVyeX0pYCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgIC53aGVyZSh3aGVyZU1hdGNoUXVlcnkpXG4gICAgICAgIC5vcmRlckJ5KCh0KSA9PiBkZXNjKHQucmFuaykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFVzZXIocGFyYW1zOiBHZXRVc2VyUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcSh1c2Vycy51c2VySWQsIHBhcmFtcykgOiBlcSh1c2Vycy5lbWFpbCwgcGFyYW1zKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBkYi5xdWVyeS51c2Vycy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwodXNlcnMuZGVsZXRlZEF0KSxcbiAgICAgICAgKSxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyX21kOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyX3NtOiB0cnVlLFxuICAgICAgICAgICAgYWN0aXZhdGlvbkRhdGU6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICBsYXN0TG9naW5EYXRlOiB0cnVlLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyAuLi5yZXMsIGlzQWN0aXZlOiAhIXJlcz8ucGFzc3dvcmQsIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBfZ2V0VXNlck1pbmkocGFyYW1zOiBHZXRVc2VyUGFyYW1zKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB1dWlkLnZhbGlkYXRlKHBhcmFtcykgPyBlcSh1c2Vycy51c2VySWQsIHBhcmFtcykgOiBlcSh1c2Vycy5lbWFpbCwgcGFyYW1zKTtcbiAgICByZXR1cm4gYXdhaXQgZGIucXVlcnkudXNlcnMuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgaXNOdWxsKHVzZXJzLmRlbGV0ZWRBdCksXG4gICAgICAgICksXG4gICAgICAgIGNvbHVtbnM6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgdXNlcklkOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgICAgbGFzdExvZ2luRGF0ZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9nZXRGdWxsVXNlcihwYXJhbXM6IEdldFVzZXJQYXJhbXMpIHtcbiAgICBjb25zdCB3aGVyZSA9IHV1aWQudmFsaWRhdGUocGFyYW1zKSA/IGVxKHVzZXJzLnVzZXJJZCwgcGFyYW1zKSA6IGVxKHVzZXJzLmVtYWlsLCBwYXJhbXMpO1xuICAgIHJldHVybiBhd2FpdCBkYi5xdWVyeS51c2Vycy5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpc051bGwodXNlcnMuZGVsZXRlZEF0KSxcbiAgICAgICAgKSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IHR5cGUgR2V0VXNlcnNQYXJhbXMgPSB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgdXNlcklkcz86IHN0cmluZ1tdO1xuICAgIHJvbGVzPzogc3RyaW5nW107XG4gICAgc3RhdHVzPzogc3RyaW5nO1xuICAgIHNlYXJjaFZhbHVlPzogc3RyaW5nO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gX19nZXRVc2Vycyh7XG4gICAgbGltaXQsXG4gICAgcm9sZXMsXG4gICAgcGFnZSA9IDEsXG4gICAgdXNlcklkcyxcbiAgICBzdGF0dXMsXG4gICAgc2VhcmNoVmFsdWUsXG59OiBHZXRVc2Vyc1BhcmFtcykge1xuICAgIHBhZ2UgPSBNYXRoLm1heCgwLCBwYWdlKTtcblxuICAgIGNvbnN0IGNvbmRpdGlvbnM6IFNRTFtdID0gW2lzTnVsbCh1c2Vycy5kZWxldGVkQXQpXTtcblxuICAgIGlmICh1c2VySWRzPy5sZW5ndGgpIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KHVzZXJzLnVzZXJJZCwgdXNlcklkcykpO1xuXG4gICAgaWYgKHJvbGVzPy5sZW5ndGgpIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KHVzZXJzLnJvbGUsIHJvbGVzIGFzICh0eXBlb2YgdXNlcnMuJGluZmVyU2VsZWN0Wydyb2xlJ10pW10pKTtcblxuICAgIGlmIChzdGF0dXMgPT09ICdhY3RpdmUnKSBjb25kaXRpb25zLnB1c2goaXNOb3ROdWxsKHVzZXJzLmFjdGl2YXRpb25EYXRlKSk7XG5cbiAgICBpZiAoc3RhdHVzID09PSAnaW5hY3RpdmUnKSBjb25kaXRpb25zLnB1c2goaXNOdWxsKHVzZXJzLmFjdGl2YXRpb25EYXRlKSk7XG5cbiAgICBzZWFyY2hWYWx1ZSA9IGAke3NlYXJjaFZhbHVlIHx8ICcnfWAudHJpbSgpO1xuICAgIGlmIChzZWFyY2hWYWx1ZSkge1xuICAgICAgICBjb25zdCBzZWFyY2ggPSBbJyUnLCBzZWFyY2hWYWx1ZSwgJyUnXS5qb2luKCcnKTtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKHNxbGAoTE9XRVIodXNlcnMuZW1haWwpIGxpa2UgTE9XRVIoJHtzZWFyY2h9KSBPUiBMT1dFUih1c2Vycy5kaXNwbGF5X25hbWUpIGxpa2UgTE9XRVIoJHtzZWFyY2h9KSBPUiBMT1dFUih1c2Vycy5maXJzdF9uYW1lKSBsaWtlIExPV0VSKCR7c2VhcmNofSkgT1IgTE9XRVIodXNlcnMubGFzdF9uYW1lKSBsaWtlIExPV0VSKCR7c2VhcmNofSkpYCk7XG4gICAgfVxuXG4gICAgY29uc3QgY291bnRRdWVyeSA9IGRiLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpLCB9KS5mcm9tKHVzZXJzKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGgpIGNvdW50UXVlcnkud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbFJvd3MsIH1dID0gYXdhaXQgY291bnRRdWVyeS5leGVjdXRlKCk7XG5cbiAgICBsZXQgdG90YWxQYWdlcyA9IDE7XG4gICAgaWYgKHRvdGFsUm93cyl7XG4gICAgICAgIHRvdGFsUGFnZXMgPSBpc0VtcHR5KGxpbWl0KSA/IDEgOiBNYXRoLmNlaWwodG90YWxSb3dzIC8gbGltaXQhKTtcbiAgICAgICAgcGFnZSA9IE1hdGgubWluKHBhZ2UsIHRvdGFsUGFnZXMpO1xuICAgIH1cblxuICAgIGNvbnN0IG9mZnNldCA9IGlzRW1wdHkobGltaXQpID8gdW5kZWZpbmVkIDogTWF0aC5tYXgoMCwgKHBhZ2UgLSAxKSAqIGxpbWl0ISk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZGIucXVlcnkudXNlcnMuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogY29uZGl0aW9ucy5sZW5ndGggPyBhbmQoLi4uY29uZGl0aW9ucykgOiB1bmRlZmluZWQsXG4gICAgICAgIGxpbWl0OiBpc0VtcHR5KGxpbWl0KSA/IHVuZGVmaW5lZCA6IGxpbWl0ISxcbiAgICAgICAgb3JkZXJCeTogZGVzYyh1c2Vycy5pZCksXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgY29sdW1uczoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyX21kOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyX3NtOiB0cnVlLFxuICAgICAgICAgICAgYWN0aXZhdGlvbkRhdGU6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICBsYXN0TG9naW5EYXRlOiB0cnVlLFxuICAgICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHRvdGFsUm93cyxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgc2VhcmNoVmFsdWUsXG4gICAgICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG4gICAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IF9nZXRVc2Vyc0RlZmF1bHRSZXN1bHRzID0ge1xuICAgIHBhZ2U6IDEsXG4gICAgbGltaXQ6IHVuZGVmaW5lZCxcbiAgICB0b3RhbFJvd3M6IDAsXG4gICAgdG90YWxQYWdlczogMSxcbiAgICBkYXRhOiBbXSxcbiAgICBzZWFyY2hWYWx1ZTogdW5kZWZpbmVkIGFzICh1bmRlZmluZWQgfCBzdHJpbmcpLFxuICAgIGVycm9yOiB1bmRlZmluZWQgYXMgKHVuZGVmaW5lZCB8IHN0cmluZyksXG59IGFzIEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgX19nZXRVc2Vycz4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gX2dldFVzZXJzKHBhcmFtczogR2V0VXNlcnNQYXJhbXMpIHtcbiAgICBsZXQgcnNsdHMgPSBfZ2V0VXNlcnNEZWZhdWx0UmVzdWx0cztcbiAgICB0cnkge1xuICAgICAgICByc2x0cyA9IGF3YWl0IF9fZ2V0VXNlcnMocGFyYW1zKTtcbiAgICB9IGNhdGNoKGU6IGFueSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ19nZXRVc2VycyBFUlJPUicsIGUpO1xuICAgICAgICByc2x0cy5lcnJvciA9IGUubWVzc2FnZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgICByZXR1cm4gcnNsdHM7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbImVxIiwiYW5kIiwiaXNOdWxsIiwiY291bnQiLCJpbkFycmF5IiwiaXNOb3ROdWxsIiwiZGVzYyIsInNxbCIsInV1aWQiLCJkYiIsInVzZXJzIiwiaXNFbXB0eSIsImxvZ2dlciIsIl9zZWFyY2hVc2VycyIsInNlYXJjaFZhbHVlIiwic2VhcmNoIiwic3BsaXQiLCJqb2luIiwibWF0Y2hRdWVyeSIsImVtYWlsIiwiZGlzcGxheU5hbWUiLCJ3aGVyZU1hdGNoUXVlcnkiLCJzZWxlY3QiLCJ1c2VySWQiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInJhbmsiLCJyYW5rQ2QiLCJmcm9tIiwid2hlcmUiLCJvcmRlckJ5IiwidCIsIl9nZXRVc2VyIiwicGFyYW1zIiwidmFsaWRhdGUiLCJyZXMiLCJxdWVyeSIsImZpbmRGaXJzdCIsImRlbGV0ZWRBdCIsImNvbHVtbnMiLCJpZCIsImF2YXRhciIsImF2YXRhcl9tZCIsImF2YXRhcl9zbSIsImFjdGl2YXRpb25EYXRlIiwicm9sZSIsImNyZWF0ZWRBdCIsImxhc3RMb2dpbkRhdGUiLCJwYXNzd29yZCIsImlzQWN0aXZlIiwiX2dldFVzZXJNaW5pIiwiX2dldEZ1bGxVc2VyIiwiX19nZXRVc2VycyIsImxpbWl0Iiwicm9sZXMiLCJwYWdlIiwidXNlcklkcyIsInN0YXR1cyIsIk1hdGgiLCJtYXgiLCJjb25kaXRpb25zIiwibGVuZ3RoIiwicHVzaCIsInRyaW0iLCJjb3VudFF1ZXJ5IiwidG90YWxSb3dzIiwiZXhlY3V0ZSIsInRvdGFsUGFnZXMiLCJjZWlsIiwibWluIiwib2Zmc2V0IiwidW5kZWZpbmVkIiwiZGF0YSIsImZpbmRNYW55IiwiZXJyb3IiLCJfZ2V0VXNlcnNEZWZhdWx0UmVzdWx0cyIsIl9nZXRVc2VycyIsInJzbHRzIiwiZSIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/queries/users.ts\n");

/***/ }),

/***/ "(rsc)/./databases/utils.ts":
/*!****************************!*\
  !*** ./databases/utils.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   diagnosisToDraftInsertData: () => (/* binding */ diagnosisToDraftInsertData),\n/* harmony export */   screenToDraftInsertData: () => (/* binding */ screenToDraftInsertData),\n/* harmony export */   scriptToDraftInsertData: () => (/* binding */ scriptToDraftInsertData)\n/* harmony export */ });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! uuid */ \"(rsc)/./node_modules/uuid/dist/esm-node/v4.js\");\n\nfunction screenToDraftInsertData(s) {\n    const screenId = (0,uuid__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n    const data = {\n        ...s,\n        screenId,\n        version: 1\n    };\n    [\n        \"id\",\n        \"scriptId\",\n        \"oldScreenId\",\n        \"oldScriptId\",\n        \"publishDate\",\n        \"createdAt\",\n        \"deletedAt\",\n        \"updatedAt\",\n        \"isDraft\",\n        \"publishedVersion\",\n        \"draft\"\n    ].forEach((key)=>{\n        delete data[key];\n    });\n    return data;\n}\nfunction scriptToDraftInsertData(s) {\n    const scriptId = (0,uuid__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n    const data = {\n        ...s,\n        scriptId,\n        version: 1,\n        oldScriptId: undefined,\n        publishDate: undefined,\n        createdAt: undefined,\n        deletedAt: undefined,\n        updatedAt: undefined,\n        isDraft: undefined,\n        publishedVersion: undefined\n    };\n    [\n        \"id\",\n        \"oldScriptId\",\n        \"publishDate\",\n        \"createdAt\",\n        \"deletedAt\",\n        \"updatedAt\",\n        \"isDraft\",\n        \"publishedVersion\",\n        \"draft\"\n    ].forEach((key)=>{\n        delete data[key];\n    });\n    return data;\n}\nfunction diagnosisToDraftInsertData(s) {\n    const diagnosisId = (0,uuid__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n    const data = {\n        ...s,\n        diagnosisId,\n        version: 1\n    };\n    [\n        \"id\",\n        \"scriptId\",\n        \"oldDiagnosisId\",\n        \"oldScriptId\",\n        \"publishDate\",\n        \"createdAt\",\n        \"deletedAt\",\n        \"updatedAt\",\n        \"isDraft\",\n        \"publishedVersion\",\n        \"draft\"\n    ].forEach((key)=>{\n        delete data[key];\n    });\n    return data;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9kYXRhYmFzZXMvdXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEwQjtBQUtuQixTQUFTQyx3QkFBcURDLENBQWlDO0lBQ2xHLE1BQU1DLFdBQVdILGdEQUFFQTtJQUNuQixNQUFNSSxPQUFtQztRQUNyQyxHQUFHRixDQUFDO1FBQ0pDO1FBQ0FFLFNBQVM7SUFDYjtJQUVBO1FBQ0k7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUVILENBQUNDLE9BQU8sQ0FBQ0MsQ0FBQUE7UUFBUyxPQUFPSCxJQUFJLENBQUNHLElBQUk7SUFBRTtJQUVyQyxPQUFPSDtBQUNYO0FBRU8sU0FBU0ksd0JBQXFETixDQUFpQztJQUNsRyxNQUFNTyxXQUFXVCxnREFBRUE7SUFDbkIsTUFBTUksT0FBbUM7UUFDckMsR0FBR0YsQ0FBQztRQUNKTztRQUNBSixTQUFTO1FBQ1RLLGFBQWFDO1FBQ2JDLGFBQWFEO1FBQ2JFLFdBQVdGO1FBQ1hHLFdBQVdIO1FBQ1hJLFdBQVdKO1FBQ1hLLFNBQVNMO1FBQ1RNLGtCQUFrQk47SUFDdEI7SUFFQTtRQUNJO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUVILENBQUNMLE9BQU8sQ0FBQ0MsQ0FBQUE7UUFBUyxPQUFPSCxJQUFJLENBQUNHLElBQUk7SUFBRTtJQUVyQyxPQUFPSDtBQUNYO0FBRU8sU0FBU2MsMkJBQTJEaEIsQ0FBdUM7SUFDOUcsTUFBTWlCLGNBQWNuQixnREFBRUE7SUFDdEIsTUFBTUksT0FBc0M7UUFDeEMsR0FBR0YsQ0FBQztRQUNKaUI7UUFDQWQsU0FBUztJQUNiO0lBRUE7UUFDSTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0tBRUgsQ0FBQ0MsT0FBTyxDQUFDQyxDQUFBQTtRQUFTLE9BQU9ILElBQUksQ0FBQ0csSUFBSTtJQUFFO0lBRXJDLE9BQU9IO0FBQ1giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2RhdGFiYXNlcy91dGlscy50cz9iYjE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHY0IH0gZnJvbSBcInV1aWRcIjtcblxuaW1wb3J0IHsgU2NyZWVuRHJhZnRJbmZlckluc2VydERhdGEsIFNjcmlwdCwgU2NyaXB0RHJhZnRJbmZlckluc2VydERhdGEsIERpYWdub3Npc0RyYWZ0SW5mZXJJbnNlcnREYXRhLCBEaWFnbm9zaXMgfSBmcm9tIFwiQC9kYXRhYmFzZXMvdHlwZXNcIjtcbmltcG9ydCB7IFNjcmVlbiB9IGZyb20gXCJAL2RhdGFiYXNlcy90eXBlc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gc2NyZWVuVG9EcmFmdEluc2VydERhdGE8QWRkaXRpb25hbFNjcmVlbkZpZWxkcyA9IHt9PihzOiBTY3JlZW48QWRkaXRpb25hbFNjcmVlbkZpZWxkcz4pIHtcbiAgICBjb25zdCBzY3JlZW5JZCA9IHY0KCk7XG4gICAgY29uc3QgZGF0YTogU2NyZWVuRHJhZnRJbmZlckluc2VydERhdGEgPSB7XG4gICAgICAgIC4uLnMsXG4gICAgICAgIHNjcmVlbklkLFxuICAgICAgICB2ZXJzaW9uOiAxLFxuICAgIH07XG5cbiAgICBbXG4gICAgICAgICdpZCcsXG4gICAgICAgICdzY3JpcHRJZCcsXG4gICAgICAgICdvbGRTY3JlZW5JZCcsXG4gICAgICAgICdvbGRTY3JpcHRJZCcsXG4gICAgICAgICdwdWJsaXNoRGF0ZScsXG4gICAgICAgICdjcmVhdGVkQXQnLFxuICAgICAgICAnZGVsZXRlZEF0JyxcbiAgICAgICAgJ3VwZGF0ZWRBdCcsXG4gICAgICAgICdpc0RyYWZ0JyxcbiAgICAgICAgJ3B1Ymxpc2hlZFZlcnNpb24nLFxuICAgICAgICAnZHJhZnQnLFxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgXS5mb3JFYWNoKGtleSA9PiB7IGRlbGV0ZSBkYXRhW2tleV07IH0pO1xuXG4gICAgcmV0dXJuIGRhdGE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzY3JpcHRUb0RyYWZ0SW5zZXJ0RGF0YTxBZGRpdGlvbmFsU2NyaXB0RmllbGRzID0ge30+KHM6IFNjcmlwdDxBZGRpdGlvbmFsU2NyaXB0RmllbGRzPikge1xuICAgIGNvbnN0IHNjcmlwdElkID0gdjQoKTtcbiAgICBjb25zdCBkYXRhOiBTY3JpcHREcmFmdEluZmVySW5zZXJ0RGF0YSA9IHtcbiAgICAgICAgLi4ucyxcbiAgICAgICAgc2NyaXB0SWQsXG4gICAgICAgIHZlcnNpb246IDEsXG4gICAgICAgIG9sZFNjcmlwdElkOiB1bmRlZmluZWQsXG4gICAgICAgIHB1Ymxpc2hEYXRlOiB1bmRlZmluZWQsXG4gICAgICAgIGNyZWF0ZWRBdDogdW5kZWZpbmVkLFxuICAgICAgICBkZWxldGVkQXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdXBkYXRlZEF0OiB1bmRlZmluZWQsXG4gICAgICAgIGlzRHJhZnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgcHVibGlzaGVkVmVyc2lvbjogdW5kZWZpbmVkLFxuICAgIH07XG5cbiAgICBbXG4gICAgICAgICdpZCcsXG4gICAgICAgICdvbGRTY3JpcHRJZCcsXG4gICAgICAgICdwdWJsaXNoRGF0ZScsXG4gICAgICAgICdjcmVhdGVkQXQnLFxuICAgICAgICAnZGVsZXRlZEF0JyxcbiAgICAgICAgJ3VwZGF0ZWRBdCcsXG4gICAgICAgICdpc0RyYWZ0JyxcbiAgICAgICAgJ3B1Ymxpc2hlZFZlcnNpb24nLFxuICAgICAgICAnZHJhZnQnLFxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgXS5mb3JFYWNoKGtleSA9PiB7IGRlbGV0ZSBkYXRhW2tleV07IH0pO1xuXG4gICAgcmV0dXJuIGRhdGE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaWFnbm9zaXNUb0RyYWZ0SW5zZXJ0RGF0YTxBZGRpdGlvbmFsRGlhZ25vc2lzRmllbGRzID0ge30+KHM6IERpYWdub3NpczxBZGRpdGlvbmFsRGlhZ25vc2lzRmllbGRzPikge1xuICAgIGNvbnN0IGRpYWdub3Npc0lkID0gdjQoKTtcbiAgICBjb25zdCBkYXRhOiBEaWFnbm9zaXNEcmFmdEluZmVySW5zZXJ0RGF0YSA9IHtcbiAgICAgICAgLi4ucyxcbiAgICAgICAgZGlhZ25vc2lzSWQsXG4gICAgICAgIHZlcnNpb246IDEsXG4gICAgfTtcblxuICAgIFtcbiAgICAgICAgJ2lkJyxcbiAgICAgICAgJ3NjcmlwdElkJyxcbiAgICAgICAgJ29sZERpYWdub3Npc0lkJyxcbiAgICAgICAgJ29sZFNjcmlwdElkJyxcbiAgICAgICAgJ3B1Ymxpc2hEYXRlJyxcbiAgICAgICAgJ2NyZWF0ZWRBdCcsXG4gICAgICAgICdkZWxldGVkQXQnLFxuICAgICAgICAndXBkYXRlZEF0JyxcbiAgICAgICAgJ2lzRHJhZnQnLFxuICAgICAgICAncHVibGlzaGVkVmVyc2lvbicsXG4gICAgICAgICdkcmFmdCcsXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICBdLmZvckVhY2goa2V5ID0+IHsgZGVsZXRlIGRhdGFba2V5XTsgfSk7XG5cbiAgICByZXR1cm4gZGF0YTtcbn1cbiJdLCJuYW1lcyI6WyJ2NCIsInNjcmVlblRvRHJhZnRJbnNlcnREYXRhIiwicyIsInNjcmVlbklkIiwiZGF0YSIsInZlcnNpb24iLCJmb3JFYWNoIiwia2V5Iiwic2NyaXB0VG9EcmFmdEluc2VydERhdGEiLCJzY3JpcHRJZCIsIm9sZFNjcmlwdElkIiwidW5kZWZpbmVkIiwicHVibGlzaERhdGUiLCJjcmVhdGVkQXQiLCJkZWxldGVkQXQiLCJ1cGRhdGVkQXQiLCJpc0RyYWZ0IiwicHVibGlzaGVkVmVyc2lvbiIsImRpYWdub3Npc1RvRHJhZnRJbnNlcnREYXRhIiwiZGlhZ25vc2lzSWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./databases/utils.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/authOptions.ts":
/*!*********************************!*\
  !*** ./lib/auth/authOptions.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/google */ \"(rsc)/./node_modules/next-auth/providers/google.js\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! drizzle-orm */ \"(rsc)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @auth/drizzle-adapter */ \"(rsc)/./node_modules/@auth/drizzle-adapter/index.js\");\n/* harmony import */ var _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/databases/pg/drizzle */ \"(rsc)/./databases/pg/drizzle.ts\");\n/* harmony import */ var _databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/databases/pg/schema */ \"(rsc)/./databases/pg/schema/index.ts\");\n\n\n\n\n\n\n\nconst authOptions = {\n    // @ts-ignore\n    adapter: (0,_auth_drizzle_adapter__WEBPACK_IMPORTED_MODULE_3__.DrizzleAdapter)(_databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__[\"default\"]),\n    providers: [\n        (0,next_auth_providers_google__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n            clientId: process.env.GOOGLE_CLIENT_ID,\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET\n        }),\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"email\",\n                    type: \"text\"\n                },\n                password: {\n                    label: \"email\",\n                    type: \"text\"\n                },\n                code: {\n                    label: \"code\",\n                    type: \"text\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !(credentials?.password || credentials?.code)) {\n                    throw new Error(\"Missing credentials\");\n                }\n                const user = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__[\"default\"].query.users.findFirst({\n                    where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.users.email, credentials.email))\n                });\n                if (!user) throw new Error(\"Invalid credentials\");\n                if (credentials.code) {\n                    const token = await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__[\"default\"].query.tokens.findFirst({\n                        where: (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.tokens.token, Number(credentials.code)), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.tokens.userId, user.userId))\n                    });\n                    if (!token) throw new Error(\"That code wasn&apos;t valid. Have another go!\");\n                    await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__[\"default\"].delete(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.tokens).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.tokens.id, token.id));\n                } else if (credentials.password) {\n                    const isCorrectPassword = await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().compare(credentials.password, `${user.password}`);\n                    if (!isCorrectPassword) throw new Error(\"Invalid credentials\");\n                } else {\n                    if (!user) throw new Error(\"Invalid credentials\");\n                }\n                const updateFields = {\n                    lastLoginDate: new Date()\n                };\n                if (!user.activationDate) updateFields.activationDate = new Date();\n                await _databases_pg_drizzle__WEBPACK_IMPORTED_MODULE_4__[\"default\"].update(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.users).set(updateFields).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_6__.eq)(_databases_pg_schema__WEBPACK_IMPORTED_MODULE_5__.users.userId, user.userId));\n                return {\n                    id: user.userId,\n                    email: user.email,\n                    emailVerified: user.activationDate || updateFields.activationDate,\n                    name: user.displayName,\n                    image: null\n                };\n            }\n        })\n    ],\n    debug: \"development\" !== \"production\",\n    session: {\n        strategy: \"jwt\"\n    },\n    secret: process.env.NEXTAUTH_SECRET,\n    callbacks: {\n        async redirect ({ baseUrl, url }) {\n            // Allows relative callback URLs\n            if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n            else if (new URL(url).origin === baseUrl) return url;\n            return baseUrl;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBeUI7SUFDaENxQyxTQUFTO1FBQ0xDLFVBQVU7SUFDZDtJQUNBQyxRQUFRdkMsUUFBUUMsR0FBRyxDQUFDdUMsZUFBZTtJQUNuQ0MsV0FBVztRQUNQLE1BQU1DLFVBQVMsRUFBRUMsT0FBTyxFQUFFQyxHQUFHLEVBQUU7WUFDM0IsZ0NBQWdDO1lBQ2hDLElBQUlBLElBQUlDLFVBQVUsQ0FBQyxNQUFNLE9BQU8sQ0FBQyxFQUFFRixRQUFRLEVBQUVDLElBQUksQ0FBQztpQkFFN0MsSUFBSSxJQUFJRSxJQUFJRixLQUFLRyxNQUFNLEtBQUtKLFNBQVMsT0FBT0M7WUFDakQsT0FBT0Q7UUFDWDtJQUNKO0FBQ0osRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vbGliL2F1dGgvYXV0aE9wdGlvbnMudHM/YzUwYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XG5pbXBvcnQgeyBBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCc7XG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJztcbmltcG9ydCBHb29nbGVQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2dvb2dsZSc7XG5pbXBvcnQgeyBhbmQsIGVxIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IHsgRHJpenpsZUFkYXB0ZXIgfSBmcm9tIFwiQGF1dGgvZHJpenpsZS1hZGFwdGVyXCI7XG5cbmltcG9ydCBkYiBmcm9tIFwiQC9kYXRhYmFzZXMvcGcvZHJpenpsZVwiO1xuaW1wb3J0ICogYXMgc2NoZW1hIGZyb20gJ0AvZGF0YWJhc2VzL3BnL3NjaGVtYSc7XG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogQXV0aE9wdGlvbnMgPSB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGFkYXB0ZXI6IERyaXp6bGVBZGFwdGVyKGRiKSxcblxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICBHb29nbGVQcm92aWRlcih7XG4gICAgICAgICAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCBhcyBzdHJpbmcsXG4gICAgICAgICAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUIGFzIHN0cmluZyxcbiAgICAgICAgfSksXG5cbiAgICAgICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICAgICAgICBuYW1lOiAnY3JlZGVudGlhbHMnLFxuICAgICAgICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ2VtYWlsJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdjb2RlJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIShjcmVkZW50aWFscz8ucGFzc3dvcmQgfHwgY3JlZGVudGlhbHM/LmNvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBjcmVkZW50aWFscycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5xdWVyeS51c2Vycy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogYW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCBjcmVkZW50aWFscy5lbWFpbCksXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpc05vdE51bGwoc2NoZW1hLnVzZXJzLmFjdGl2YXRpb25EYXRlKSxcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY3JlZGVudGlhbHMuY29kZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGRiLnF1ZXJ5LnRva2Vucy5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IGFuZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcShzY2hlbWEudG9rZW5zLnRva2VuLCBOdW1iZXIoY3JlZGVudGlhbHMuY29kZSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS50b2tlbnMudXNlcklkLCB1c2VyLnVzZXJJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRva2VuKSB0aHJvdyBuZXcgRXJyb3IoJ1RoYXQgY29kZSB3YXNuJmFwb3M7dCB2YWxpZC4gSGF2ZSBhbm90aGVyIGdvIScpO1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudG9rZW5zKS53aGVyZShlcShzY2hlbWEudG9rZW5zLmlkLCB0b2tlbi5pZCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3JlZGVudGlhbHMucGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDb3JyZWN0UGFzc3dvcmQ6IGJvb2xlYW4gPSBhd2FpdCBiY3J5cHQuY29tcGFyZShjcmVkZW50aWFscy5wYXNzd29yZCwgYCR7dXNlci5wYXNzd29yZH1gKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQ29ycmVjdFBhc3N3b3JkKSB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUZpZWxkczogUGFydGlhbDx0eXBlb2Ygc2NoZW1hLnVzZXJzLiRpbmZlclNlbGVjdD4gPSB7IGxhc3RMb2dpbkRhdGU6IG5ldyBEYXRlKCkgfTtcbiAgICAgICAgICAgICAgICBpZiAoIXVzZXIuYWN0aXZhdGlvbkRhdGUpIHVwZGF0ZUZpZWxkcy5hY3RpdmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgICAgICAgICAgICAudXBkYXRlKHNjaGVtYS51c2VycylcbiAgICAgICAgICAgICAgICAgICAgLnNldCh1cGRhdGVGaWVsZHMpXG4gICAgICAgICAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMudXNlcklkLCB1c2VyLnVzZXJJZCkpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHVzZXIudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgZW1haWxWZXJpZmllZDogdXNlci5hY3RpdmF0aW9uRGF0ZSB8fCB1cGRhdGVGaWVsZHMuYWN0aXZhdGlvbkRhdGUsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHVzZXIuZGlzcGxheU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgIF0sXG4gICAgZGVidWc6IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicsXG4gICAgc2Vzc2lvbjoge1xuICAgICAgICBzdHJhdGVneTogJ2p3dCcsXG4gICAgfSxcbiAgICBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCxcbiAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgYXN5bmMgcmVkaXJlY3QoeyBiYXNlVXJsLCB1cmwgfSkge1xuICAgICAgICAgICAgLy8gQWxsb3dzIHJlbGF0aXZlIGNhbGxiYWNrIFVSTHNcbiAgICAgICAgICAgIGlmICh1cmwuc3RhcnRzV2l0aChcIi9cIikpIHJldHVybiBgJHtiYXNlVXJsfSR7dXJsfWA7XG4gICAgICAgICAgICAvLyBBbGxvd3MgY2FsbGJhY2sgVVJMcyBvbiB0aGUgc2FtZSBvcmlnaW5cbiAgICAgICAgICAgIGVsc2UgaWYgKG5ldyBVUkwodXJsKS5vcmlnaW4gPT09IGJhc2VVcmwpIHJldHVybiB1cmw7XG4gICAgICAgICAgICByZXR1cm4gYmFzZVVybDtcbiAgICAgICAgfVxuICAgIH0sXG59O1xuIl0sIm5hbWVzIjpbImJjcnlwdCIsIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJHb29nbGVQcm92aWRlciIsImFuZCIsImVxIiwiRHJpenpsZUFkYXB0ZXIiLCJkYiIsInNjaGVtYSIsImF1dGhPcHRpb25zIiwiYWRhcHRlciIsInByb3ZpZGVycyIsImNsaWVudElkIiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9DTElFTlRfSUQiLCJjbGllbnRTZWNyZXQiLCJHT09HTEVfQ0xJRU5UX1NFQ1JFVCIsIm5hbWUiLCJjcmVkZW50aWFscyIsImVtYWlsIiwibGFiZWwiLCJ0eXBlIiwicGFzc3dvcmQiLCJjb2RlIiwiYXV0aG9yaXplIiwiRXJyb3IiLCJ1c2VyIiwicXVlcnkiLCJ1c2VycyIsImZpbmRGaXJzdCIsIndoZXJlIiwidG9rZW4iLCJ0b2tlbnMiLCJOdW1iZXIiLCJ1c2VySWQiLCJkZWxldGUiLCJpZCIsImlzQ29ycmVjdFBhc3N3b3JkIiwiY29tcGFyZSIsInVwZGF0ZUZpZWxkcyIsImxhc3RMb2dpbkRhdGUiLCJEYXRlIiwiYWN0aXZhdGlvbkRhdGUiLCJ1cGRhdGUiLCJzZXQiLCJlbWFpbFZlcmlmaWVkIiwiZGlzcGxheU5hbWUiLCJpbWFnZSIsImRlYnVnIiwic2Vzc2lvbiIsInN0cmF0ZWd5Iiwic2VjcmV0IiwiTkVYVEFVVEhfU0VDUkVUIiwiY2FsbGJhY2tzIiwicmVkaXJlY3QiLCJiYXNlVXJsIiwidXJsIiwic3RhcnRzV2l0aCIsIlVSTCIsIm9yaWdpbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/authOptions.ts\n");

/***/ }),

/***/ "(rsc)/./lib/isEmpty.ts":
/*!************************!*\
  !*** ./lib/isEmpty.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isEmpty: () => (/* binding */ isEmpty)\n/* harmony export */ });\nfunction isEmpty(value) {\n    return value === null || value === undefined || value === \"\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvaXNFbXB0eS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQU8sU0FBU0EsUUFBUUMsS0FBVTtJQUM5QixPQUFPLFVBQVcsUUFBVUEsVUFBVUMsYUFBZUQsVUFBVTtBQUNuRSIsInNvdXJjZXMiOlsid2VicGFjazovL25lb3RyZWUtd2ViZWRpdG9yLy4vbGliL2lzRW1wdHkudHM/YzI4ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZTogYW55KSB7XG4gICAgcmV0dXJuICh2YWx1ZSA9PT0gbnVsbCkgfHwgKHZhbHVlID09PSB1bmRlZmluZWQpIHx8ICh2YWx1ZSA9PT0gJycpO1xufVxuIl0sIm5hbWVzIjpbImlzRW1wdHkiLCJ2YWx1ZSIsInVuZGVmaW5lZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/isEmpty.ts\n");

/***/ }),

/***/ "(rsc)/./lib/logger.ts":
/*!***********************!*\
  !*** ./lib/logger.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! moment */ \"(rsc)/./node_modules/moment/moment.js\");\n/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nfunction writeLogsToFile(filename, ...args) {\n    const date = moment__WEBPACK_IMPORTED_MODULE_2___default()(new Date()).format(\"YYYYMMDD\");\n    const dir = node_path__WEBPACK_IMPORTED_MODULE_1___default().resolve(`logs/${date}`);\n    if (!node_fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(dir)) node_fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(dir);\n    const data = `${new Date().toUTCString()} ${JSON.stringify([\n        ...args\n    ])}\\n`;\n    const filePath = `${dir}/${filename}`;\n    node_fs__WEBPACK_IMPORTED_MODULE_0___default().appendFileSync(filePath, data);\n}\nconst log = (...args)=>{\n    if (true) {\n        console.log(...args, __filename);\n    }\n    writeLogsToFile(\"logs.txt\", ...args);\n};\nconst error = (...args)=>{\n    if (true) {\n        console.error(...args, __filename);\n    }\n    writeLogsToFile(\"errors.txt\", ...args);\n};\nconst appError = (...args)=>{\n    if (true) {\n        console.error(...args, __filename);\n    }\n    writeLogsToFile(\"app_errors.txt\", ...args);\n};\nconst logger = {\n    log,\n    error,\n    appError\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (logger);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBeUI7QUFDSTtBQUNEO0FBRTVCLFNBQVNHLGdCQUFnQkMsUUFBZ0IsRUFBRSxHQUFHQyxJQUFXO0lBQ3JELE1BQU1DLE9BQU9KLDZDQUFNQSxDQUFDLElBQUlLLFFBQVFDLE1BQU0sQ0FBQztJQUN2QyxNQUFNQyxNQUFNUix3REFBWSxDQUFDLENBQUMsS0FBSyxFQUFFSyxLQUFLLENBQUM7SUFDdkMsSUFBSSxDQUFDTix5REFBYSxDQUFDUyxNQUFNVCx3REFBWSxDQUFDUztJQUN0QyxNQUFNSSxPQUFPLENBQUMsRUFBRSxJQUFJTixPQUFPTyxXQUFXLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxTQUFTLENBQUM7V0FBSVg7S0FBSyxFQUFFLEVBQUUsQ0FBQztJQUN6RSxNQUFNWSxXQUFXLENBQUMsRUFBRVIsSUFBSSxDQUFDLEVBQUVMLFNBQVMsQ0FBQztJQUNyQ0osNkRBQWlCLENBQUNpQixVQUFVSjtBQUNoQztBQUVBLE1BQU1NLE1BQTBCLENBQUMsR0FBR2Q7SUFDaEMsSUFBSWUsSUFBeUIsRUFBYztRQUN2Q0MsUUFBUUYsR0FBRyxJQUFJZCxNQUFNaUI7SUFDekI7SUFDQW5CLGdCQUFnQixlQUFlRTtBQUNuQztBQUVBLE1BQU1rQixRQUE4QixDQUFDLEdBQUdsQjtJQUNwQyxJQUFJZSxJQUF5QixFQUFjO1FBQ3ZDQyxRQUFRRSxLQUFLLElBQUlsQixNQUFNaUI7SUFDM0I7SUFDQW5CLGdCQUFnQixpQkFBaUJFO0FBQ3JDO0FBRUEsTUFBTW1CLFdBQWlDLENBQUMsR0FBR25CO0lBQ3ZDLElBQUllLElBQXlCLEVBQWM7UUFDdkNDLFFBQVFFLEtBQUssSUFBSWxCLE1BQU1pQjtJQUMzQjtJQUNBbkIsZ0JBQWdCLHFCQUFxQkU7QUFDekM7QUFFQSxNQUFNb0IsU0FBUztJQUNYTjtJQUNBSTtJQUNBQztBQUNKO0FBRUEsaUVBQWVDLE1BQU1BLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2xpYi9sb2dnZXIudHM/ZmQ1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdub2RlOnBhdGgnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5mdW5jdGlvbiB3cml0ZUxvZ3NUb0ZpbGUoZmlsZW5hbWU6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcbiAgICBjb25zdCBkYXRlID0gbW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgnWVlZWU1NREQnKTtcbiAgICBjb25zdCBkaXIgPSBwYXRoLnJlc29sdmUoYGxvZ3MvJHtkYXRlfWApO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSBmcy5ta2RpclN5bmMoZGlyKTtcbiAgICBjb25zdCBkYXRhID0gYCR7bmV3IERhdGUoKS50b1VUQ1N0cmluZygpfSAke0pTT04uc3RyaW5naWZ5KFsuLi5hcmdzXSl9XFxuYDtcbiAgICBjb25zdCBmaWxlUGF0aCA9IGAke2Rpcn0vJHtmaWxlbmFtZX1gO1xuICAgIGZzLmFwcGVuZEZpbGVTeW5jKGZpbGVQYXRoLCBkYXRhKTtcbn1cblxuY29uc3QgbG9nOiB0eXBlb2YgY29uc29sZS5sb2cgPSAoLi4uYXJncykgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MsIF9fZmlsZW5hbWUpO1xuICAgIH1cbiAgICB3cml0ZUxvZ3NUb0ZpbGUoJ2xvZ3MudHh0JywgLi4uYXJncyk7XG59O1xuXG5jb25zdCBlcnJvcjogdHlwZW9mIGNvbnNvbGUuZXJyb3IgPSAoLi4uYXJncykgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoLi4uYXJncywgX19maWxlbmFtZSk7XG4gICAgfVxuICAgIHdyaXRlTG9nc1RvRmlsZSgnZXJyb3JzLnR4dCcsIC4uLmFyZ3MpO1xufTtcblxuY29uc3QgYXBwRXJyb3I6IHR5cGVvZiBjb25zb2xlLmVycm9yID0gKC4uLmFyZ3MpID0+IHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgICBjb25zb2xlLmVycm9yKC4uLmFyZ3MsIF9fZmlsZW5hbWUpO1xuICAgIH1cbiAgICB3cml0ZUxvZ3NUb0ZpbGUoJ2FwcF9lcnJvcnMudHh0JywgLi4uYXJncyk7XG59O1xuXG5jb25zdCBsb2dnZXIgPSB7XG4gICAgbG9nLFxuICAgIGVycm9yLFxuICAgIGFwcEVycm9yLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgbG9nZ2VyO1xuIl0sIm5hbWVzIjpbImZzIiwicGF0aCIsIm1vbWVudCIsIndyaXRlTG9nc1RvRmlsZSIsImZpbGVuYW1lIiwiYXJncyIsImRhdGUiLCJEYXRlIiwiZm9ybWF0IiwiZGlyIiwicmVzb2x2ZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJkYXRhIiwidG9VVENTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiZmlsZVBhdGgiLCJhcHBlbmRGaWxlU3luYyIsImxvZyIsInByb2Nlc3MiLCJjb25zb2xlIiwiX19maWxlbmFtZSIsImVycm9yIiwiYXBwRXJyb3IiLCJsb2dnZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/logger.ts\n");

/***/ }),

/***/ "(rsc)/./lib/socket.ts":
/*!***********************!*\
  !*** ./lib/socket.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! socket.io-client */ \"(rsc)/./node_modules/socket.io-client/build/esm-debug/index.js\");\n\nconst socket = (0,socket_io_client__WEBPACK_IMPORTED_MODULE_0__.io)(\"http://localhost:85\");\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (socket);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc29ja2V0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLFNBQVNELG9EQUFFQSxDQUFDRSxxQkFBK0I7QUFFakQsaUVBQWVELE1BQU1BLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW90cmVlLXdlYmVkaXRvci8uL2xpYi9zb2NrZXQudHM/ODU5ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbyB9IGZyb20gJ3NvY2tldC5pby1jbGllbnQnO1xuXG5jb25zdCBzb2NrZXQgPSBpbyhwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMKTtcblxuZXhwb3J0IGRlZmF1bHQgc29ja2V0O1xuIl0sIm5hbWVzIjpbImlvIiwic29ja2V0IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0FQUF9VUkwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/socket.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/drizzle-orm","vendor-chunks/next-auth","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/postgres","vendor-chunks/@babel","vendor-chunks/oauth","vendor-chunks/@auth","vendor-chunks/yallist","vendor-chunks/lru-cache","vendor-chunks/uuid","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/moment","vendor-chunks/ws","vendor-chunks/engine.io-client","vendor-chunks/socket.io-client","vendor-chunks/debug","vendor-chunks/xmlhttprequest-ssl","vendor-chunks/socket.io-parser","vendor-chunks/engine.io-parser","vendor-chunks/@socket.io","vendor-chunks/supports-color","vendor-chunks/has-flag"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fops%2Fdiscard-drafts%2Froute&page=%2Fapi%2Fops%2Fdiscard-drafts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fops%2Fdiscard-drafts%2Froute.ts&appDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flafarai%2FWerq%2FBWS%2FNeoTree%2Fneotree-webeditor&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();