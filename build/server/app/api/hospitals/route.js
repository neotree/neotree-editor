"use strict";(()=>{var e={};e.id=23,e.ids=[23],e.modules={67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},81282:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{DELETE:()=>c,GET:()=>u});var s=r(49303),o=r(88716),i=r(60670),l=r(87070),n=r(57435),p=r(72761),d=r(5973);async function u(e){try{if(!(await (0,p.$)()).yes)return l.NextResponse.json({errors:["Unauthorised"]});let t=JSON.parse(e.nextUrl.searchParams.get("data")||"{}"),r=await (0,d.getHospitals)(t);return l.NextResponse.json(r)}catch(e){return n.Z.error("[GET] /api/hospitals",e.message),l.NextResponse.json({errors:["Internal Error"]})}}async function c(e){try{if(!(await (0,p.$)()).yes)return l.NextResponse.json({errors:["Unauthorised"]});let t=JSON.parse(e.nextUrl.searchParams.get("data")||"{}"),r=await (0,d.deleteHospitals)(t);return l.NextResponse.json(r)}catch(e){return n.Z.error("[GET] /api/hospitals",e.message),l.NextResponse.json({errors:["Internal Error"]})}}let h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/hospitals/route",pathname:"/api/hospitals",filename:"route",bundlePath:"app/api/hospitals/route"},resolvedPagePath:"/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/api/hospitals/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:w}=h,y="/api/hospitals/route";function g(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}},5973:(e,t,r)=>{r.r(t),r.d(t,{$$ACTION_0:()=>H,$$ACTION_1:()=>E,$$ACTION_2:()=>N,$$ACTION_3:()=>T,createHospitals:()=>_,deleteHospitals:()=>O,getFullHospital:()=>v,getHospital:()=>I,getHospitals:()=>A,searchHospitals:()=>Z,updateHospitals:()=>$});var a=r(24330);r(60166);var s=r(57745),o=r(9576),i=r(10413),l=r(57418),n=r(34149),p=r(60938),d=r(81445),u=r(30900),c=r(41502),h=r(57435);async function f(e){let t=u.Z(e)?(0,s.eq)(l.hospitals.hospitalId,e):(0,s.eq)(l.hospitals.oldHospitalId,e);return await i.Z.query.hospitals.findFirst({where:(0,s.xD)(t,(0,s.Ft)(l.hospitals.deletedAt)),columns:{id:!0,hospitalId:!0,name:!0,oldHospitalId:!0}})}async function x(e){let t=u.Z(e)?(0,s.eq)(l.hospitals.hospitalId,e):(0,s.eq)(l.hospitals.oldHospitalId,e);return await i.Z.query.hospitals.findFirst({where:(0,s.xD)(t,(0,s.Ft)(l.hospitals.deletedAt))})}async function w({limit:e,archived:t,page:r=1,hospitalIds:a,searchValue:o}){r=Math.max(0,r);let u=[];if(t?u.push((0,s.K0)(l.hospitals.deletedAt)):u.push((0,s.Ft)(l.hospitals.deletedAt)),a?.length&&u.push((0,s.d3)(l.hospitals.hospitalId,a)),o=`${o||""}`.trim()){let e=["%",o,"%"].join("");u.push((0,n.i6)`LOWER(hospitals.name) like LOWER(${e})`)}let h=i.Z.select({count:(0,p.QX)()}).from(l.hospitals);u.length&&h.where((0,s.xD)(...u));let[{count:f}]=await h.execute(),x=1;f&&(r=Math.min(r,x=(0,c.x)(e)?1:Math.ceil(f/e)));let w=(0,c.x)(e)?void 0:Math.max(0,(r-1)*e),y=await i.Z.query.hospitals.findMany({where:u.length?(0,s.xD)(...u):void 0,limit:(0,c.x)(e)?void 0:e,orderBy:(0,d.C)(l.hospitals.id),offset:w,columns:{id:!0,hospitalId:!0,name:!0,oldHospitalId:!0}});return{page:r,limit:e,data:y,totalRows:f,totalPages:x,searchValue:o,error:void 0}}let y={page:1,limit:void 0,totalRows:0,totalPages:1,data:[],searchValue:void 0,error:void 0};async function g(e){let t=y;try{t=await w(e)}catch(e){h.Z.error("_getHospitals ERROR",e),t.error=e.message}finally{return t}}async function q(e){if(e.length){let t=(0,s.d3)(l.hospitals.hospitalId,e),r=new Date;await i.Z.update(l.hospitals).set({deletedAt:r}).where(t)}return!0}async function m(e,t){let r=[];for(let t of e)r.push({...t,hospitalId:t.hospitalId||(0,o.Z)()});let a={inserted:[],success:!1};try{if(await i.Z.insert(l.hospitals).values(r),t?.returnInserted){let e=await g({hospitalIds:r.map(e=>e.hospitalId)});a.inserted=e.data}a.success=!0}catch(e){a.error=e.message}finally{return a}}async function b(e,t){let r=[];for(let{hospitalId:a,data:o}of e)try{delete o.id,delete o.createdAt,delete o.updatedAt,delete o.oldHospitalId,delete o.hospitalId,await i.Z.update(l.hospitals).set(o).where((0,s.eq)(l.hospitals.hospitalId,a));let e=t?.returnUpdated?await f(a):void 0;r.push({hospitalId:a,hospital:e})}catch(e){r.push({hospitalId:a,error:e.message})}return r}var R=r(66267),j=r(40618);async function I(e){try{return await (0,R.isAllowed)("get_hospital"),await f(e)||null}catch(e){return h.Z.error("getHospital ERROR:",e),null}}async function v(e){try{return await (0,R.isAllowed)("get_hospital"),await x(e)||null}catch(e){return h.Z.error("getFullHospital ERROR:",e),null}}let A=(0,a.j)("722df2eb81d6901644ad9eadd578284b693e02df",H);async function H(...e){try{return await (0,R.isAllowed)("get_hospitals"),await g(...e)}catch(e){return{...y,error:e.message}}}let Z=(0,a.j)("7badc5813153ab449d43a950ee717949bee4b73f",E);async function E(...e){try{return await (0,R.isAllowed)("search_hospitals"),await g(...e)}catch(e){return{...y,error:e.message}}}async function O(e){return await (0,R.isAllowed)("delete_hospitals"),e.length&&await q(e),!0}let _=(0,a.j)("0e3c0ad7f0b4a17c9ea85569d6f68d67646b35e7",N);async function N(...e){try{return await (0,R.isAllowed)("create_hospitals"),await m(...e)}catch(e){throw h.Z.error("createHospitals ERROR",e),e}}let $=(0,a.j)("ad451422ee0e8d7be85f07dd8f65cc186afee186",T);async function T(...e){try{return await (0,R.isAllowed)("update_hospitals"),await b(...e)}catch(e){throw h.Z.error("updateHospitals ERROR",e),e}}(0,j.h)([I,v,A,Z,O,_,$]),(0,a.j)("6cb2303157c9ed693f7ae3c03b0c029c027238e6",I),(0,a.j)("cfc91cdfe0ca46d2ac7380d818a5b5b06b272f50",v),(0,a.j)("7ddbd6d73a428b212e13712785bbe2a47dba0f7e",A),(0,a.j)("0fdec2a36177cba16f69e460c423861bbf404e5b",Z),(0,a.j)("4e8ea467f6e3c24a6d19367ff4f150839963fa5c",O),(0,a.j)("8d0e8853fd9e4c89d36268a7f266efbb50bdf11c",_),(0,a.j)("58d233f62675141721c552c27bec89c6ba4be640",$)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5822,1744,3788,1490,5059,413,6267],()=>r(81282));module.exports=a})();