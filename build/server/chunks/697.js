exports.id=697,exports.ids=[697],exports.modules={74393:(e,t,a)=>{Promise.resolve().then(a.bind(a,7636))},23973:(e,t,a)=>{Promise.resolve().then(a.bind(a,10827)),Promise.resolve().then(a.bind(a,49596)),Promise.resolve().then(a.bind(a,82617))},96948:(e,t,a)=>{"use strict";a.d(t,{Alert:()=>i});var r=a(96221),s=a(35047);function i(e){(0,s.useRouter)();let{alert:t}=(0,r.s)();return null}a(17577)},16722:(e,t,a)=>{"use strict";a.d(t,{Uv:()=>i,VO:()=>s,d4:()=>r,fR:()=>n});let r=[{value:"allSearches",label:"Found in all searches"},{value:"admissionSearches",label:"Found in admission searches"},{value:"twinSearches",label:"Found in twin searches"}],s=[{label:"Days & hours",value:"days_hours"},{label:"Years & Months",value:"years_months"}],i=[{name:"date",label:"Date"},{name:"datetime",label:"Date + Time"},{name:"dropdown",label:"Dropdown"},{name:"multi_select",label:"Multiple choice list"},{name:"number",label:"Number"},{name:"text",label:"Text"},{name:"time",label:"Time"},{name:"period",label:"Time period"}],l={calculation:null,condition:"",confidential:!1,dataType:null,defaultValue:null,format:null,type:null,key:null,refKey:null,label:null,minValue:null,maxValue:null,optional:!1,minDate:null,maxDate:null,minTime:null,maxTime:null,minDateKey:"",maxDateKey:"",minTimeKey:"",maxTimeKey:"",values:"",editable:!1},n={admission:[{...l,type:"dropdown",key:"BabyTransfered",values:"Y,Yes\nN,No",label:"Has the baby been transfered from another facility"},{...l,type:"text",key:"patientNUID",label:"Search patient's NUID",condition:"$BabyTransfered = 'Y'"},{...l,type:"dropdown",key:"BabyTwin",values:"Y,Yes\nN,No",label:"Does the baby have a twin?"},{...l,type:"text",key:"BabyTwinNUID",label:"Search twin's NUID",condition:"$BabyTwin = 'Y'"}],other:[{...l,type:"text",key:"patientNUID",values:"Y,Yes\nN,No",label:"Search patient's NUID"}]}},58464:(e,t,a)=>{"use strict";a.d(t,{$7:()=>o,F4:()=>p,PU:()=>l,Tf:()=>u,UQ:()=>y,_S:()=>n,m1:()=>c,ph:()=>h,uh:()=>d,y0:()=>f});var r=a(16722),s=a(75743),i=a(20698);let l={headerFormat:"",headerFields:[],footerFields:[],sections:[]},n="Example: ($key = true and $key2 = false) or $key3 = 'HD'",o={fontSize:{},fontWeight:{},fontStyle:{},textColor:{},backgroundColor:{},highlight:{}},d=[{value:"screens",label:"Screens"},{value:"diagnoses",label:"Diagnoses"},{value:"print",label:"Print"}],c=[{label:"Admission",value:"admission"},{label:"Discharge",value:"discharge"},{label:"Neolab",value:"neolab"},{label:"Daily Record",value:"drecord"}],u=[{value:"checklist",label:"Checklist"},{value:"form",label:"Form"},{value:"management",label:"Management"},{value:"multi_select",label:"Multiple choice list"},{value:"single_select",label:"Single choice list"},{value:"progress",label:"Progress"},{value:"timer",label:"Timer"},{value:"yesno",label:"Yes/No"},{value:"drugs",label:"Drugs"},{value:"fluids",label:"Fluids"},{value:"zw_edliz_summary_table",label:"EDLIZ summary table (ZW)"},{value:"mwi_edliz_summary_table",label:"EDLIZ summary table (MWI)"},{value:"diagnosis",label:"Diagnosis"}],h=[{value:"risk",label:"Risk factor"},{value:"sign",label:"Sign/Symptom"}];({...u.reduce((e,t)=>{let a=t.value,r=t.value,s=[r,`${r}_option`];return"single_select"===a&&(s=[...s,"dropdown","dropdown_option"]),{...e,[r]:s}},{}),...r.Uv.reduce((e,t)=>{let a=t.name,r=t.name,s=[r,`${r}_option`];return"dropdown"===a&&(s=[...s,"single_select","single_select_option"]),{...e,[r]:s}},{})});let f=[{value:"checklist",label:"checklist",hasChildren:!0},{value:"checklist_option",label:"checklist_option",hasChildren:!1},{value:"multi_select",label:"multi_select",hasChildren:!0},{value:"multi_select_option",label:"multi_select_option",hasChildren:!1},{value:"single_select",label:"single_select",hasChildren:!0},{value:"single_select_option",label:"single_select_option",hasChildren:!1},{value:"yesno",label:"yesno",hasChildren:!1},{value:"zw_edliz_summary_table",label:"zw_edliz_summary_table",hasChildren:!0},{value:"zw_edliz_summary_table_option",label:"zw_edliz_summary_table_option",hasChildren:!1},{value:"mwi_edliz_summary_table",label:"mwi_edliz_summary_table",hasChildren:!0},{value:"mwi_edliz_summary_table_option",label:"mwi_edliz_summary_table_option",hasChildren:!1},{value:"diagnosis",label:"diagnosis",hasChildren:!0},{value:"diagnosis_symptom_sign",label:"diagnosis_symptom_sign",hasChildren:!1},{value:"diagnosis_symptom_risk",label:"diagnosis_symptom_risk",hasChildren:!1},{value:"date",label:"date",hasChildren:!1},{value:"datetime",label:"datetime",hasChildren:!1},{value:"dropdown",label:"dropdown",hasChildren:!0},{value:"dropdown_option",label:"dropdown_option",hasChildren:!1},{value:"number",label:"number",hasChildren:!1},{value:"text",label:"text",hasChildren:!1},{value:"timer",label:"timer",hasChildren:!1},{value:"period",label:"period",hasChildren:!1}],p=[{value:"label.asc",label:"Label (asc)",Icon:s.Z},{value:"label.desc",label:"Label (desc)",Icon:i.Z},{value:"key.asc",label:"Key (asc)",Icon:s.Z},{value:"key.desc",label:"Key (desc)",Icon:i.Z},{value:"type.asc",label:"Type (asc)",Icon:s.Z},{value:"type.desc",label:"Type (desc)",Icon:i.Z},{value:"refId.asc",label:"Ref ID (asc)",Icon:s.Z},{value:"refId.desc",label:"Ref ID (desc)",Icon:i.Z},{value:"createdAt.asc",label:"Creation date (asc)",Icon:s.Z},{value:"createdAt.desc",label:"Creation date (desc)",Icon:i.Z},{value:"updatedAt.asc",label:"Update date (asc)",Icon:s.Z},{value:"updatedAt.desc",label:"Update date (desc)",Icon:i.Z}],y=[{label:"Published",value:"published"},{label:"Drafts",value:"drafts"}]},49596:(e,t,a)=>{"use strict";a.d(t,{DataKeysCtxProvider:()=>b,M:()=>g});var r=a(10326),s=a(17577),i=a(44099),l=a(93396),n=a(35047),o=a(96221),d=a(96948),c=a(58464),u=a(37530),h=a(3529),f=a(11877);let p=e=>e?.name||e?.label||e?.uniqueKey||"Data key",y=e=>e?{uuid:e.uuid||"",uniqueKey:e.uniqueKey||"",name:e.name||"",refId:e.refId||"",dataType:e.dataType||"",label:e.label||"",options:Array.isArray(e.options)?e.options:[],metadata:e.metadata||{},version:"number"==typeof e.version?e.version:Number(e.version||0)||0}:null,m=(0,s.createContext)(null),g=()=>{let e=(0,s.useContext)(m);if(!e)throw Error("useChart must be used within a <DataKeysCtxProvider />");return e};function b({children:e,prefetchDataKeys:t=!0}){(0,s.useRef)(!1);let a=(0,n.useRouter)(),{alert:g}=(0,o.s)(),{authenticatedUser:b}=(0,h.b)(),[w,v]=(0,l.v1)("uuid",{clearOnDefault:!0,shallow:!0,history:"push",defaultValue:""}),[x,k]=(0,s.useState)([]),[I,S]=(0,s.useState)(c.F4[0].value),[_,C]=(0,s.useState)(""),[N,D]=(0,s.useState)(""),[R,T]=(0,s.useState)(1),[A]=(0,s.useState)(100),[Z,E]=(0,s.useState)(!1),[j,$]=(0,s.useState)([]),[O,P]=(0,s.useState)(),K=(0,s.useCallback)(async e=>{E(!0);try{let t=new URLSearchParams;e?.names?.length&&t.set("names",JSON.stringify(e.names)),e?.uniqueKeys?.length&&t.set("uniqueKeys",JSON.stringify(e.uniqueKeys)),e?.dataKeysIds?.length&&t.set("dataKeysIds",JSON.stringify(e.dataKeysIds));let a=await i.Z.get(`/api/data-keys?${t.toString()}`),r=function(e,t=c.F4[0].value){let a=[...e],r=({key1:e,key2:t,sortDirection:a})=>{e=(e||"").trim().toLowerCase(),t=(t||"").trim().toLowerCase();let r=0;return"asc"===a?(e<t&&(r=-1),e>t&&(r=1)):(e>t&&(r=-1),e<t&&(r=1)),r};switch(t){case"refId.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.refId||"").trim(),key2:(t.refId||"").trim()}));break;case"refId.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.refId||"").trim(),key2:(t.refId||"").trim()}));break;case"key.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:e.name,key2:t.name}));break;case"label.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"label.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"type.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"type.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"createdAt.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;case"createdAt.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;case"updatedAt.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:new Date(e.updatedAt||"").getTime().toString(),key2:new Date(t.updatedAt||"").getTime().toString()}));break;case"updatedAt.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:new Date(e.updatedAt||"").getTime().toString(),key2:new Date(t.updatedAt||"").getTime().toString()}));break;default:a=e.sort((e,t)=>r({sortDirection:"asc",key1:e.name,key2:t.name}))}return a}(a.data.data,I);$(r),P(a.data.errors),T(1)}catch(e){$([]),P([e.message])}finally{E(!1)}},[I]),F=(0,s.useMemo)(()=>{let e=[...j];if(_&&(e="published"===_?e.filter(e=>!e?.isDraft):"draft"===_?e.filter(e=>!!e?.isDraft):e.filter(e=>e?.dataType===_)),N){let{normalizedValue:t,isExactMatch:a}=(0,f.l)(N);t&&(e=e.filter(e=>[e.name||"",e.label||""].map(e=>e.toLowerCase()).some(e=>a?e===t:e.includes(t))))}return e},[j,_,N]),{dataKeys:z,pagination:V}=(0,s.useMemo)(()=>{if(!F.length)return{dataKeys:[],pagination:void 0};let e=function(e,t,a){let r=e.length,s=(t-1)*a;return{data:e.slice(s,s+a),pagination:{page:t,limit:a,total:r,totalPages:Math.ceil(r/a)}}}(F,R,A);return{dataKeys:e.data,pagination:e.pagination}},[F,R,A]),[M,U]=(0,s.useState)(!1),L=(0,s.useCallback)(async(e,t)=>{try{U(!0);let r=e.map(e=>({...e,version:"string"==typeof e.version?Number(e.version):e.version})),s=(await i.Z.post("/api/data-keys/save",{data:r,broadcastAction:!0})).data;s.errors?.length?g({title:"Error",message:s.errors.join(", "),variant:"error"}):(await K(),a.refresh(),g({message:"Data key saved!",variant:"success",onClose:()=>t?.()}))}catch(e){g({title:"Error",message:"Failed to save data key: "+e.message,onClose:()=>t?.(e.message)})}finally{U(!1)}},[g,a.refresh,K]),[H,q]=(0,s.useState)(!1),W=(0,s.useCallback)(async e=>{if(!e.length)return;let t=b?.userId,a=b?.displayName;for(let r of e){if(!r?.uuid)continue;let e=y(r);if(!e)continue;let s=p(r);await (0,u.KL)({entityId:r.uuid,entityType:"dataKey",entityTitle:s,snapshot:e,userId:t,userName:a,description:`Marked "${s}" for deletion`})}},[b?.userId,b?.displayName]),B=(0,s.useCallback)(async e=>{let t=j.filter(t=>t?.uuid&&e.includes(t.uuid));try{q(!0);let r=(await i.Z.delete("/api/data-keys?data="+JSON.stringify({dataKeysIds:e,broadcastAction:!0}))).data;if(r.errors?.length)throw Error(r.errors[0]);await W(t),k([]),await K(),a.refresh(),g({title:"Success",message:"Data keys deleted successfully!",variant:"success"})}catch(e){g({title:"Error",message:e.message,variant:"error"})}finally{q(!1)}},[a.refresh,g,K,j,W]),[Y,J]=(0,s.useState)(!1),G=(0,s.useCallback)(async e=>{try{J(!0);let t=(await i.Z.post("/api/data-keys/export",e)).data;if(t.errors?.length)throw Error(t.errors[0]);await K(),k([]),g({title:"Success",message:"Data exported successfully!",variant:"success"})}catch(e){g({title:"Error",message:e.message,variant:"error"})}finally{J(!1)}},[K,g]),Q=(0,s.useCallback)((e=c.F4[0].value)=>{S(e),k([]),T(1)},[]),X=(0,s.useCallback)((e,t)=>{let a=e.map(e=>j.find(t=>t.uniqueKey===e||t.uuid===e)).filter(e=>e);return t?.withNested&&a.filter(e=>e.options.length).forEach(e=>{let r=X(e.options,t);a=[...a,...r]}),a.filter((e,t)=>a.map(e=>e.uniqueKey).indexOf(e.uniqueKey)===t)},[j]);return O?.length?r.jsx(d.Alert,{title:"Error",message:"Failed to load data keys: "+O.join(", "),buttonLabel:"Try again",onClose:()=>K()}):r.jsx(r.Fragment,{children:r.jsx(m.Provider,{value:{loadingDataKeys:Z,saving:M,exporting:Y,deleting:H,dataKeys:z,allDataKeys:j,errors:O,selected:x,currentDataKeyUuid:w,sort:I,filter:_,searchValue:N,pagination:V,currentPage:R,itemsPerPage:A,setCurrentPage:T,setSearchValue:D,extractDataKeys:X,deleteDataKeys:B,saveDataKeys:L,exportDataKeys:G,setCurrentDataKeyUuid:v,loadDataKeys:K,setSelected:k,setSort:S,onSort:Q,setFilter:C},children:e})})}},82617:(e,t,a)=>{"use strict";a.d(t,{ScriptsContextProvider:()=>u,h:()=>c});var r=a(10326),s=a(17577),i=a(35047),l=a(15491),n=a(44099),o=a(12260);let d=(0,s.createContext)(null),c=()=>(0,s.useContext)(d);function u({children:e,...t}){let a=function({}){let e=(0,i.useRouter)(),{scriptId:t}=(0,i.useParams)(),{parsed:a}=(0,o.l)(),[r,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)({data:[]}),[h,f]=(0,s.useState)(!1),[p,y]=(0,s.useState)([]),m=(0,s.useCallback)(()=>{e.push("/")},[e]),g=(0,s.useCallback)(()=>{e.push(`/script/${t}?${l.Z.stringify({...a,section:"screens"})}`)},[e,a,t]),b=(0,s.useCallback)(()=>{e.push(`/script/${t}?${l.Z.stringify({...a,section:"diagnoses"})}`)},[e,a,t]),w=(0,s.useCallback)(async()=>{try{d(!0);let e=await n.Z.get("/api/screens/list?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[t]}));if(e.data?.errors?.length)throw Error(e.data.errors.join(", "));u(e.data)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{d(!1)}},[t,open,alert]);return{screens:c,screensLoading:r,keys:p,keysLoading:h,loadKeys:(0,s.useCallback)(async()=>{try{f(!0);let{data:e}=await n.Z.get("/api/scripts/keys?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[t]}));if(e?.errors?.length)throw Error(e.errors.join(", "));let a=e.data.reduce((e,t)=>[...e,...t.dataKeys],[]);y(a)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{f(!1)}},[t,open,alert]),loadScreens:w,onCancelDiagnosisForm:b,onCancelScreenForm:g,onCancelScriptForm:m}}(t);return r.jsx(d.Provider,{value:{...t,...a},children:e})}},12260:(e,t,a)=>{"use strict";a.d(t,{l:()=>l});var r=a(35047),s=a(15491),i=a(17577);function l(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),a=(0,i.useMemo)(()=>t.toString(),[t]),l=(0,i.useMemo)(()=>s.Z.parse(t.toString()),[t]),n=(0,i.useCallback)(e=>s.Z.stringify({...l,...e}),[l]),o=(0,i.useCallback)(t=>{e.push(`?${n(t)}`)},[n,e]);return{parsed:l,stringified:a,replace:(0,i.useCallback)(t=>{e.replace(`?${n(t)}`)},[n,e]),push:o,toSearchParams:n}}},37530:(e,t,a)=>{"use strict";a.d(t,{$u:()=>l,KL:()=>o});var r=a(24875);let s=new Set(["id","createdAt","updatedAt","deletedAt","oldScriptId","oldScreenId","oldDiagnosisId","oldConfigKeyId","version","publishDate","isDraft","isDeleted","draftCreatedByUserId","createdByUserId","updatedByUserId","createdBy","updatedBy"]);class i{constructor(e){this.originalSnapshot=null,this.isInitialized=!1,this.options=e}setSnapshot(e){if(this.isInitialized){console.warn("Snapshot already initialized, ignoring subsequent calls");return}this.originalSnapshot=JSON.parse(JSON.stringify(e)),this.isInitialized=!0,console.log("Initial snapshot set for entity:",this.options.entityId)}async trackChanges(e,t){if(!this.isInitialized||!this.originalSnapshot){console.warn("Snapshot not initialized, initializing now"),this.setSnapshot(e);return}console.log("Tracking changes for entity:",this.options.entityId);let a=this.detectChanges(this.originalSnapshot,e);console.log("Detected changes:",a.length);let s=new Map((await r.pb.getEntityChanges(this.options.entityId,this.options.entityType)).map(e=>[e.fieldPath,e])),i=this.resolveEntityTitle(e);for(let l of a){let a=s.get(l.path);a?(await r.pb.updateChange(a.id,{newValue:l.newValue,timestamp:Date.now(),description:t,fullSnapshot:e,entityTitle:i}),console.log("Updated change for field:",l.path)):(await r.pb.addChange({entityId:this.options.entityId,entityType:this.options.entityType,action:"update",fieldPath:l.path,fieldName:l.name,oldValue:l.oldValue,newValue:l.newValue,userId:this.options.userId,userName:this.options.userName,description:t,fullSnapshot:e,entityTitle:i}),console.log("Added new change for field:",l.path))}for(let[e,t]of Array.from(s))a.some(t=>t.path===e)||(await r.pb.deleteChange(t.id),console.log("Removed reverted change for field:",e));0===a.length&&(await r.pb.clearEntityChanges(this.options.entityId,this.options.entityType),console.log("All changes cleared - form back to original state"))}resolveEntityTitle(e){if(this.options.resolveEntityTitle){let t=this.options.resolveEntityTitle(e);if(t&&t.toString().trim().length)return t.toString().trim()}let t=this.extractTitle(e);return t?t:"string"==typeof this.options.entityTitle&&this.options.entityTitle.trim().length?this.options.entityTitle.trim():this.extractTitle(this.originalSnapshot)||`${this.options.entityType} ${this.options.entityId}`}extractTitle(e){if(!e||"object"!=typeof e)return null;for(let t of["title","name","label","key","printTitle","displayName","sectionTitle","collectionLabel"]){let a=e[t];if("string"==typeof a&&a.trim().length)return a.trim()}return null}isMeaningfulValue(e){return null!=e&&("string"!=typeof e||""!==e.trim())}detectChanges(e,t,a=""){let r=[];return null==e?null!=t&&this.isMeaningfulValue(t)&&r.push({path:a||"root",name:a.split(".").pop()||"root",oldValue:e,newValue:t}):null==t?this.isMeaningfulValue(e)&&r.push({path:a||"root",name:a.split(".").pop()||"root",oldValue:e,newValue:t}):"object"!=typeof e||"object"!=typeof t?e!==t&&this.isMeaningfulValue(t)&&r.push({path:a||"root",name:a.split(".").pop()||"root",oldValue:e,newValue:t}):Array.isArray(e)&&Array.isArray(t)?JSON.stringify(e)!==JSON.stringify(t)&&r.push({path:a||"root",name:a.split(".").pop()||"root",oldValue:e,newValue:t}):Array.from(new Set([...Object.keys(e),...Object.keys(t)])).forEach(i=>{if(s.has(i))return;let l=a?`${a}.${i}`:i,n=e[i],o=t[i];(this.isMeaningfulValue(n)||this.isMeaningfulValue(o))&&("object"!=typeof n||"object"!=typeof o||null===n||null===o||Array.isArray(n)||Array.isArray(o)?JSON.stringify(n)!==JSON.stringify(o)&&this.isMeaningfulValue(o)&&r.push({path:l,name:i,oldValue:n,newValue:o}):r.push(...this.detectChanges(n,o,l)))}),r}async clearChanges(){await r.pb.clearEntityChanges(this.options.entityId,this.options.entityType),this.originalSnapshot=null,this.isInitialized=!1,console.log("Change tracker reset for entity:",this.options.entityId)}async getPendingChanges(){return await r.pb.getEntityChanges(this.options.entityId,this.options.entityType)}}function l(e){return new i(e)}let n=["title","name","label","key","printTitle","sectionTitle","collectionLabel","drug","fluid","feed"];async function o({entityId:e,entityType:t,entityTitle:a,snapshot:s,userId:i,userName:l,description:o}){if(!e)return;let d=a?.trim()||function(e){if(!e||"object"!=typeof e)return null;for(let t of n){let a=e[t];if("string"==typeof a&&a.trim().length)return a.trim()}return null}(s)||`${t} ${e}`;await r.pb.clearEntityChanges(e,t),await r.pb.addChange({entityId:e,entityType:t,entityTitle:d,action:"delete",fieldPath:"entity",fieldName:d,oldValue:s??null,newValue:null,userId:i||void 0,userName:l||void 0,description:o||`Marked "${d}" for deletion`,fullSnapshot:s??null})}},11877:(e,t,a)=>{"use strict";a.d(t,{l:()=>i});let r=['"',"“"],s=['"',"”"];function i(e){let t=`${e??""}`.trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let a=r.includes(t[0]),i=s.includes(t[t.length-1]),l=t.length>1&&a&&i;return{normalizedValue:(l?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:l}}},95602:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var r=a(19510),s=a(58585),i=a(85576),l=a(47080),n=a(2111),o=a(68570);let d=(0,o.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/scripts/index.tsx`),{__esModule:c,$$typeof:u}=d;d.default,(0,o.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/scripts/index.tsx#ScriptsContext`),(0,o.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/scripts/index.tsx#useScriptsContext`);let h=(0,o.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/scripts/index.tsx#ScriptsContextProvider`);var f=a(85431),p=a(66267),y=a(24569),m=a(46697),g=a(75644);async function b({children:e}){let{user:t,yes:a}=await (0,p.canAccessPage)();if(t||(0,s.redirect)("/login"),!a)return r.jsx(y.V,{children:r.jsx(m.Zb,{children:r.jsx(m.aY,{className:"p-4 text-xl text-center text-danger bg-danger/10",children:"You don't have sufficient rights to access this page!"})})});let[o]=await Promise.all([(0,n.getHospitals)()]);return(0,r.jsxs)(r.Fragment,{children:[r.jsx(f.D,{children:"Scripts"}),r.jsx(g.g2,{children:r.jsx(h,{...i,...l,hospitals:o,getHospitals:n.getHospitals,children:e})})]})}},17162:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var r=a(19510),s=a(21113),i=a(24569),l=a(46697);function n(){return r.jsx(i.V,{children:r.jsx(l.Zb,{children:r.jsx(l.aY,{className:"p-0",children:r.jsx(s.w,{loading:!0,maxRows:25,columns:[{name:"Key"},{name:"Label"},{name:"Description"},{name:"Action",align:"right",cellClassName:"w-20"}],data:[]})})})})}},47080:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getFiles:()=>p,uploadFile:()=>y,uploadFileFromSite:()=>m});var r=a(24330);a(60166);var s=a(9576),i=a(61460),l=a(89114),n=a(57435),o=a(44652),d=a(66267),c=a(59271),u=a(49530),h=a(20123),f=a(40618);let p=l.Re;async function y(e,t){let a={success:!1,data:null};try{for(let r of(await (0,d.isAllowed)(["upload_files"]),Array.from(e.entries()))){let[l,n]=r;if("object"==typeof n){let r=Buffer.from(await n.arrayBuffer()),l=e.get("fileId")?.toString()||(0,s.Z)(),d={...(0,o.R)(e.get("metadata")?.toString()||"{}")},c=(e.get("size")?function(e,t){if("0"==`${e}`)return 0;let a=`${e||""}`.replaceAll(" ",""),[r,s]=(a=a.includes(".")?a.replaceAll(",",""):a.split(",").length>2?a.replaceAll(",",""):a.replaceAll(",",".")).split("."),i=!r||isNaN(Number(r))?"":r;return""==(i+=!s||isNaN(Number(s))?"":`.${s}`)||void 0===i||isNaN(Number(i))?t?.notNull?0:null:Number(i)}((0,o.R)(e.get("size")?.toString())):0)||n.size,u=e.get("filename")?.toString()||n.name,h=[l,u].filter(e=>e).join("__");(d.width||d.height)&&(h=`${h}?w=${d.width}&h=${d.height}`),a=await (0,i.G)({fileId:l,data:r,filename:h,size:c,contentType:e.get("contentType")?.toString()||n.type,metadata:d},t)}}}catch(e){a.success=!1,a.errors=[e.message],n.Z.error("uploadFile ERROR",e.message)}finally{return a}}async function m({fileId:e,siteURL:t}){try{let a=await (0,h.QF)({links:[t]});if(a.errors)throw Error(a.errors.join(", "));let{data:[r]}=a;if(!r)throw Error(`Site (${t}) was not found!`);let s=await (0,c.U)({baseURL:r.link,apiKey:r.apiKey}),n=await (0,l._I)(e);if(n.errors)throw Error(n.errors.join(", "));if(n?.data){let t=u.Z.stringify({...n.data.metadata});return t=t?`?${t}`:"",{data:{fileId:e,fileURL:[process.env.NEXT_PUBLIC_APP_URL,`/files/${e}${t}`].join("")}}}let o=(await s.get(`/api/files/${e}/download`)).data;if(o.errors)throw Error(o.errors.join(", "));if(!o.data)return{errors:["File not found"],data:null};await (0,i.G)({fileId:e,data:o.data.data,filename:o.data.filename,size:o.data.size,contentType:o.data.contentType,metadata:{...o.data.metadata}});let d=u.Z.stringify({...o.data.metadata});return d=d?`?${d}`:"",{data:{fileId:e,fileURL:[r.link,`/files/${e}${d}`].join("")}}}catch(e){return n.Z.error("downloadFileFromSite ERROR",e.message),{data:null,errors:[e.message]}}}(0,f.h)([p,y,m]),(0,r.j)("33f7ec365e69486d849f3f98709dcbf216d851bc",p),(0,r.j)("488c9e37b52de03428b134f457aa4ea8ece4fe52",y),(0,r.j)("e31b76e619726a21814cc43436f8b721d6f473e3",m)},2111:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$ACTION_0:()=>y,$$ACTION_1:()=>g,$$ACTION_2:()=>w,$$ACTION_3:()=>x,$$ACTION_4:()=>I,countHospitals:()=>m,deleteHospitals:()=>p,getHospital:()=>v,getHospitals:()=>b,saveHospitals:()=>k});var r=a(24330);a(60166);var s=a(57745),i=a(57435),l=a(10413),n=a(93567),o=a(88317);async function d(e){let t={success:!1};try{let a=e.filter(e=>e.id),r=e.filter(e=>!e.id),i=[];for(let e of a)try{await l.Z.update(n.hospitals).set(e).where((0,s.eq)(n.hospitals.id,e.id))}catch(e){i.push(e.message)}r.length&&await l.Z.insert(n.hospitals).values(r),i.length?t.errors=i:t.success=!0}catch(e){t.success=!1,t.errors=[e.message],i.Z.error("_saveHospitals ERROR",e.message)}finally{return t?.errors?.length||o.Z.emit("data_changed","save_hospitals"),t}}async function c(e){let t={success:!1},{ids:a,hospitalsIds:r,confirmDeleteAll:d}={...e};try{let e=[a?.length?(0,s.d3)(n.hospitals.id,a):void 0,r?.length?(0,s.d3)(n.hospitals.hospitalId,r):void 0].filter(e=>e);if(!e.length&&!d)throw Error("Please confirm that you want to delete all the hospitals!");await l.Z.delete(n.hospitals).where((0,s.xD)(...e)),t.success=!0}catch(e){t.success=!1,t.errors=[e.message],i.Z.error("_deleteHospitals ERROR",e.message)}finally{return t?.errors?.length||o.Z.emit("data_changed","delete_hospitals"),t}}var u=a(88453),h=a(66267),f=a(40618);let p=(0,r.j)("6de319d88ede8d5835179324860b5e1ff73d9704",y);async function y(...e){try{return await (0,h.isAllowed)(),await c(...e)}catch(e){return i.Z.error("deleteHospitals ERROR",e.message),{errors:[e.message],success:!1}}}let m=(0,r.j)("71e5d401b0a17ddbc2421e65bac974cca1b7c7a7",g);async function g(...e){try{return await (0,h.isAllowed)(),await (0,u.Py)(...e)}catch(e){return i.Z.error("countHospitals ERROR",e.message),{errors:[e.message],data:0}}}let b=(0,r.j)("154f78406dd26c01e23c8e2ef62c68bdf4e1abcf",w);async function w(...e){try{return await (0,h.isAllowed)(),await (0,u.O8)(...e)}catch(e){return i.Z.error("getHospitals ERROR",e.message),{errors:[e.message],data:[]}}}let v=(0,r.j)("543eca7d1d5d6f1f356da58f10c82babfdbf02f6",x);async function x(...e){return await (0,h.isAllowed)(),await (0,u.C9)(...e)}let k=(0,r.j)("5d9cef658a17d9e70bae50010807b43db6139a16",I);async function I(...e){try{return await (0,h.isAllowed)(),await d(...e)}catch(e){return i.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}(0,f.h)([p,m,b,v,k]),(0,r.j)("e7b323b5a91d3ba50c223a3ebae732dba4578b76",p),(0,r.j)("a73b0dc955eb46a83ccb322ce8d75df54bb64801",m),(0,r.j)("f7c1f5ff22d757d951b19ffc8a35ce8b645bb416",b),(0,r.j)("38b982b33c6c0b287d82028b1f16e51b649bb0d8",v),(0,r.j)("bacdad7028d175f340f534690829ca2e20a8ccf5",k)},24569:(e,t,a)=>{"use strict";a.d(t,{V:()=>i});var r=a(19510),s=a(50650);function i({className:e,...t}){return r.jsx("div",{...t,className:(0,s.cn)("w-full max-w-screen-xl mx-auto p-5",e)})}},21113:(e,t,a)=>{"use strict";a.d(t,{w:()=>n});var r=a(68570);let s=(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/components/data-table/index.tsx`),{__esModule:i,$$typeof:l}=s;s.default;let n=(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/components/data-table/index.tsx#DataTable`)},46697:(e,t,a)=>{"use strict";a.d(t,{Ol:()=>n,Zb:()=>l,aY:()=>d,ll:()=>o});var r=a(19510),s=a(71159),i=a(50650);let l=s.forwardRef(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));l.displayName="Card";let n=s.forwardRef(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let o=s.forwardRef(({className:e,...t},a)=>r.jsx("h3",{ref:a,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));o.displayName="CardTitle",s.forwardRef(({className:e,...t},a)=>r.jsx("p",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let d=s.forwardRef(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,i.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",s.forwardRef(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},75644:(e,t,a)=>{"use strict";a.d(t,{g2:()=>n});var r=a(68570);let s=(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/data-keys/index.tsx`),{__esModule:i,$$typeof:l}=s;s.default,(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/data-keys/index.tsx#DataKeysCtx`),(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/data-keys/index.tsx#useDataKeysCtx`);let n=(0,r.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/contexts/data-keys/index.tsx#DataKeysCtxProvider`)},61460:(e,t,a)=>{"use strict";a.d(t,{G:()=>o});var r=a(88317),s=a(57435),i=a(10413),l=a(93567),n=a(89114);async function o(e,t){let a={success:!1,data:null};try{if(!e.fileId)throw Error("Missing fileId");if(!e.data)throw Error("No file uploaded");await i.Z.insert(l.files).values(e);let s=await (0,n._I)(e.fileId);if(!s)throw Error("Failed to upload file");a.success=!0,a.data=s.data,s.data&&t?.broadcastAction!==!1&&r.Z.emit("file_uploaded")}catch(e){a.success=!1,a.errors=[e.message],s.Z.error("_uploadFile ERROR",e.message)}finally{return a}}},89114:(e,t,a)=>{"use strict";a.d(t,{_I:()=>d,Re:()=>p,KU:()=>o});var r=a(57745),s=a(10413),i=a(93567),l=a(57435),n=a(44380);async function o(e){try{let t=await s.Z.query.files.findFirst({where:(0,r.eq)(i.files.fileId,e)});return{data:t?{...t,url:(0,n.TI)(`/files/${t.fileId}`)}:null}}catch(e){return l.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}async function d(e){try{let t=await s.Z.query.files.findFirst({where:(0,r.eq)(i.files.fileId,e),columns:{contentType:!0,fileId:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}});return{data:t?{...t,url:(0,n.TI)(`/files/${t.fileId}`)}:null}}catch(e){return l.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:null}}}var c=a(34149),u=a(60938),h=a(81445),f=a(41502);async function p(e){try{let{filesIds:t,archived:a,searchValue:l,limit:o,page:d=1,uploadDateGTE:p,uploadDateLTE:y}={...e},m=Math.max(0,d),g=l?["%",l,"%"].join(""):"",b=[a?(0,r.K0)(i.files.deletedAt):(0,r.Ft)(i.files.deletedAt),...t?.length?[(0,r.d3)(i.files.fileId,t)]:[],...g?[(0,c.i6)`LOWER(screens.name) like LOWER(${g})`]:[],p?(0,r.eg)(i.files.createdAt,"string"==typeof p?new Date(p):p):void 0,y?(0,r.G)(i.files.createdAt,"string"==typeof y?new Date(y):y):void 0],w=s.Z.select({count:(0,u.QX)()}).from(i.files);b.length&&w.where((0,r.xD)(...b));let[{count:v}]=await w.execute(),x=1;v&&(x=(0,f.x)(o)?1:Math.ceil(v/o),m=Math.min(m,x));let k=(0,f.x)(o)?void 0:Math.max(0,(m-1)*o);return{data:(await s.Z.query.files.findMany({where:b.length?(0,r.xD)(...b):void 0,limit:o,offset:k,orderBy:(0,h.C)(i.files.createdAt),columns:{fileId:!0,contentType:!0,filename:!0,size:!0,metadata:!0,createdAt:!0}})).map(e=>({...e,url:(0,n.TI)(`/files/${e.fileId}`)})),searchValue:l,totalPages:x,totalRows:v,page:m,limit:o}}catch(e){return l.Z.error("_getFiles ERROR",e.message),{errors:[e.message],data:[],totalPages:0,totalRows:0,page:1}}}},88453:(e,t,a)=>{"use strict";a.d(t,{Py:()=>u,C9:()=>d,O8:()=>o});var r=a(57745),s=a(30900),i=a(10413),l=a(93567),n=a(57435);async function o(e){try{let{hospitalsIds:t}={...e},a=t||[],n=a?.length?(0,r.d3)(l.hospitals.hospitalId,a.filter(e=>s.Z(e))):void 0,o=a?.length?(0,r.d3)(l.hospitals.oldHospitalId,a.filter(e=>!s.Z(e))):void 0,d=[(0,r.Ft)(l.hospitals.deletedAt),...n&&o?[(0,r.or)(n,o)]:[]];return{data:(await i.Z.select({hospital:l.hospitals}).from(l.hospitals).where(d.length?(0,r.xD)(...d):void 0)).map(e=>e.hospital)}}catch(e){return n.Z.error("_getHospitals ERROR",e.message),{data:[],errors:[e.message]}}}async function d(e){let{hospitalId:t}={...e};try{if(!t)throw Error("Missing hospitalId");let e=s.Z(t)?(0,r.eq)(l.hospitals.hospitalId,t):void 0,a=s.Z(t)?void 0:(0,r.eq)(l.hospitals.oldHospitalId,t);return{data:await i.Z.query.hospitals.findFirst({where:(0,r.xD)((0,r.Ft)(l.hospitals.deletedAt),e||a)})}}catch(e){return n.Z.error("_getHospital ERROR",e.message),{errors:[e.message]}}}var c=a(60938);async function u(){try{let[{count:e}]=await i.Z.select({count:(0,c.QX)()}).from(l.hospitals);return{data:e}}catch(e){return n.Z.error("_getHospitals ERROR",e.message),{data:0,errors:[e.message]}}}},44652:(e,t,a)=>{"use strict";function r(e){try{return JSON.parse(e)}catch(e){return null}}a.d(t,{R:()=>r})}};