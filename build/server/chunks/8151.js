exports.id=8151,exports.ids=[8151],exports.modules={58359:()=>{},93739:()=>{},18100:(e,s,t)=>{"use strict";t.d(s,{j:()=>c});var r=t(57745),i=t(88317),a=t(10413),d=t(57435),n=t(57418);async function c({restoreKeys:e},s){let t={success:!1};try{let d=e.length?await a.Z.query.screensHistory.findMany({where:(0,r.d3)(n.screensHistory.restoreKey,e),columns:{id:!0,screenId:!0}}):[],c=d.map(e=>e.screenId);c.length&&(await a.Z.update(n.screens).set({deletedAt:null}).where((0,r.d3)(n.screens.screenId,c)),await a.Z.delete(n.screensHistory).where((0,r.d3)(n.screensHistory.id,d.map(e=>e.id)))),!t.errors?.length&&(t.success=!0,c.length&&s?.broadcastAction&&s?.broadcastAction&&i.Z.emit("data_changed","update_screens"))}catch(e){t.success=!1,t.errors=[e.message],d.Z.error("_restoreScreens ERROR",e.message)}finally{return t}}},20706:(e,s,t)=>{"use strict";t.d(s,{gX:()=>I,Ls:()=>h});var r=t(57745),i=t(9576),a=t(88317),d=t(57435),n=t(10413),c=t(57418),o=t(57040),l=t(28422),p=t(18100),f=t(28585);async function g(e,s){let t={success:!1};try{let{diagnosisIds:i,scriptsIds:d,restoreKey:o,force:l}={...e},p=[...i||d?[(0,r.or)(i?.filter(e=>e)?.length?(0,r.d3)(c.diagnoses.diagnosisId,i):void 0,d?.filter(e=>e)?.length?(0,r.d3)(c.diagnoses.scriptId,d):void 0)]:[]];if(!p.length&&!l)throw Error("You&apos;re trying to delete all the diagnoses, please provide a force parameter.");let f=await n.Z.query.diagnoses.findMany({where:(0,r.xD)(...p)}),g=new Date;await n.Z.update(c.diagnoses).set({deletedAt:g}).where((0,r.xD)(...p)),f.length&&await n.Z.delete(c.diagnosesDrafts).where((0,r.xD)((0,r.K0)(c.diagnosesDrafts.diagnosisId),(0,r.d3)(c.diagnosesDrafts.diagnosisId,f.map(e=>e.diagnosisId)))),await n.Z.insert(c.diagnosesHistory).values(f.map(e=>({version:e.version,diagnosisId:e.diagnosisId,scriptId:e.scriptId,restoreKey:o,changes:{action:"delete_diagnosis",dediagnosision:"Delete diagnosis",oldValues:[{deletedAt:null}],newValues:[{deletedAt:g}]}}))),!t.errors?.length&&(t.success=!0,s?.broadcastAction&&a.Z.emit("data_changed","delete_diagnoses"))}catch(e){d.Z.error("_deleteDiagnoses ERROR",e.message),t.success=!1,t.errors=[e.message]}finally{return t}}async function u(e,s){let t={success:!1};try{let{screenIds:i,scriptsIds:d,restoreKey:o,force:l}={...e},p=[...i||d?[(0,r.or)(i?.filter(e=>e)?.length?(0,r.d3)(c.screens.screenId,i):void 0,d?.filter(e=>e)?.length?(0,r.d3)(c.screens.scriptId,d):void 0)]:[]];if(!p.length&&!l)throw Error("You&apos;re trying to delete all the screens, please provide a force parameter.");let f=await n.Z.query.screens.findMany({where:(0,r.xD)(...p)}),g=new Date;await n.Z.update(c.screens).set({deletedAt:g}).where((0,r.xD)(...p)),f.length&&await n.Z.delete(c.screensDrafts).where((0,r.xD)((0,r.K0)(c.screensDrafts.screenId),(0,r.d3)(c.screensDrafts.screenId,f.map(e=>e.screenId)))),await n.Z.insert(c.screensHistory).values(f.map(e=>({version:e.version,screenId:e.screenId,scriptId:e.scriptId,restoreKey:o,changes:{action:"delete_screen",descreenion:"Delete screen",oldValues:[{deletedAt:null}],newValues:[{deletedAt:g}]}}))),!t.errors?.length&&(t.success=!0,s?.broadcastAction&&a.Z.emit("data_changed","delete_screens"))}catch(e){d.Z.error("_deleteScreens ERROR",e.message),t.success=!1,t.errors=[e.message]}finally{return t}}async function I(e,s){let t={success:!1};try{let d=s?.overWriteScriptId===void 0||s.overWriteScriptId,l=await (0,o.Tx)(),p=(l.data.length?Math.max(...l.data.map(e=>e.position)):0)+1;for(let{screens:s=[],diagnoses:a=[],...o}of e)try{let e=await (d?null:n.Z.query.scripts.findFirst({where:(0,r.eq)(c.scripts.scriptId,o.scriptId),with:{draft:!0}})),l=await (d?null:e?.draft||n.Z.query.scriptsDrafts.findFirst({where:(0,r.eq)(c.scriptsDrafts.scriptDraftId,o.scriptId)})),f={...function(e){let s=(0,i.Z)(),t={...e,scriptId:s,version:1,oldScriptId:void 0,publishDate:void 0,createdAt:void 0,deletedAt:void 0,updatedAt:void 0,isDraft:void 0,publishedVersion:void 0};return["id","oldScriptId","publishDate","createdAt","deletedAt","updatedAt","isDraft","publishedVersion","draft"].forEach(e=>{delete t[e]}),t}(o),position:p};for(let a of(p++,f.scriptId=l?.scriptDraftId||e?.scriptId||f.scriptId,f.position=l?.data?.position||e?.position||p,f.version=l?.data?.version||(e?.version?e.version+1:f.version),l?await n.Z.update(c.scriptsDrafts).set({data:f}).where((0,r.eq)(c.scriptsDrafts.scriptDraftId,l.scriptDraftId)):await n.Z.insert(c.scriptsDrafts).values([{data:f,scriptDraftId:f.scriptId,scriptId:e?.scriptId,position:f.position}]),(l||e)&&(await u({scriptsIds:[f.scriptId],restoreKey:`script_draft_${f.scriptId}`}),await n.Z.delete(c.screensDrafts).where((0,r.eq)(c.screensDrafts.scriptDraftId,f.scriptId))),s)){let e=function(e){let s=(0,i.Z)(),t={...e,screenId:s,version:1};return["id","scriptId","oldScreenId","oldScriptId","publishDate","createdAt","deletedAt","updatedAt","isDraft","publishedVersion","draft"].forEach(e=>{delete t[e]}),t}(a);try{await n.Z.insert(c.screensDrafts).values([{data:e,position:e.position,screenDraftId:e.screenId,scriptDraftId:f.scriptId,type:e.type}])}catch(e){t.success=!1,t.errors=t.errors||[],t.errors.push(`Failed to save script: ${o.title} (${e.message})`)}}for(let s of((l||e)&&(await g({scriptsIds:[f.scriptId],restoreKey:`script_draft_${f.scriptId}`}),await n.Z.delete(c.diagnosesDrafts).where((0,r.eq)(c.diagnosesDrafts.scriptDraftId,f.scriptId))),a)){let e=function(e){let s=(0,i.Z)(),t={...e,diagnosisId:s,version:1};return["id","scriptId","oldDiagnosisId","oldScriptId","publishDate","createdAt","deletedAt","updatedAt","isDraft","publishedVersion","draft"].forEach(e=>{delete t[e]}),t}(s);try{await n.Z.insert(c.diagnosesDrafts).values([{data:e,position:e.position,diagnosisDraftId:e.diagnosisId,scriptDraftId:f.scriptId}])}catch(e){t.success=!1,t.errors=t.errors||[],t.errors.push(`Failed to save script: ${o.title} (${e.message})`)}}}catch(e){t.success=!1,t.errors=t.errors||[],t.errors.push(`Failed to save script: ${o.title} (${e.message})`)}!t.errors?.length&&(t.success=!0,s?.broadcastAction&&a.Z.emit("data_changed","create_scripts_drafts"))}catch(s){let e=s.response?.data?.message||s.response?.data||s.message;t.success=!1,t.errors=[e],d.Z.error("importScripts ERROR",e)}finally{return t}}async function h(){let e={success:!0};try{let s=await n.Z.query.scriptsDrafts.findMany({columns:{scriptDraftId:!0,scriptId:!0}}),t=s.filter(e=>!e.scriptId).map(e=>({scriptDraftId:e.scriptDraftId})),r=s.filter(e=>e.scriptId).map(e=>({scriptId:e.scriptId})),i=[];if(r.length){let e=await m(r);e.data.forEach(e=>e.errors?.forEach(e=>i.push(e))),e.errors?.forEach(e=>i.push(e))}if(t.length){let e=await D(t);e.errors?.forEach(e=>i.push(e))}i.length&&(e.success=!1,e.errors=i)}catch(s){e.success=!1,e.errors=[s.message],d.Z.error("_publishScripts ERROR",s.message)}finally{return e}}async function D(e,s){let t={inserted:[],success:!1};try{let d=[],g=e.length?await n.Z.query.scriptsDrafts.findMany({where:(0,r.d3)(c.scriptsDrafts.scriptDraftId,e.map(e=>e.scriptDraftId))}):[],u=[];for(let{id:e,data:s}of(g.filter(e=>e.scriptId).length&&(u=await n.Z.query.scripts.findMany({where:(0,r.d3)(c.scripts.scriptId,g.filter(e=>e.scriptId).map(e=>e.scriptId))})),g)){let t=s.scriptId||(0,i.Z)();d.push({...s,scriptId:t}),g=g.map(s=>(s.id===e&&(s.data.scriptId=t),s))}await n.Z.insert(c.scripts).values(d);let I=await (0,o.Tw)({scriptIds:d.map(e=>e.scriptId)});for(let{scriptId:e}of I.data){let s=g.filter(s=>s.data.scriptId===e)[0];await n.Z.update(c.screensDrafts).set({scriptId:e}).where((0,r.eq)(c.screensDrafts.scriptDraftId,s.scriptDraftId)),await n.Z.update(c.diagnosesDrafts).set({scriptId:e}).where((0,r.eq)(c.diagnosesDrafts.scriptDraftId,s.scriptDraftId))}let h=await (0,l.Ry)({scriptsReferences:e.map(e=>e.scriptDraftId)});h.errors&&(t.errors=[...t.errors||[],...h.errors]);let D=await (0,f.gv)({scriptsReferences:e.map(e=>e.scriptDraftId)});D.errors&&(t.errors=[...t.errors||[],...D.errors]),t.inserted=s?.returnInserted?I.data:[],t.success=!0,await y({drafts:g,previous:u}),g.length&&(await n.Z.delete(c.scriptsDrafts).where((0,r.d3)(c.scriptsDrafts.id,g.map(e=>e.id))),g.length&&(await (0,p.j)({restoreKeys:g.map(e=>`script_draft_${e.scriptDraftId}`)}),await n.Z.update(c.screensHistory).set({restoreKey:null}).where((0,r.d3)(c.screensHistory.restoreKey,g.map(e=>`script_draft_${e.scriptDraftId}`))))),s?.broadcastAction&&a.Z.emit("data_changed","create_scripts")}catch(e){t.errors=[e.message],d.Z.error("_createScripts ERROR",e.message)}finally{return t}}async function m(e,s){let t={data:[]};try{let i=e.length?await n.Z.query.scriptsDrafts.findMany({where:(0,r.d3)(c.scriptsDrafts.scriptId,e.map(e=>e.scriptId))}):[],f=[];for(let{scriptId:e,data:a}of(i.filter(e=>e.scriptId).length&&(f=await n.Z.query.scripts.findMany({where:(0,r.d3)(c.scripts.scriptId,i.filter(e=>e.scriptId).map(e=>e.scriptId))})),i)){let l=e,{scriptId:p,id:f,oldScriptId:g,createdAt:u,updatedAt:I,deletedAt:h,...D}=a;try{let e={...D,publishDate:new Date};await n.Z.update(c.scripts).set(e).where((0,r.eq)(c.scripts.scriptId,l));let i=s?.returnUpdated?await (0,o.bK)(l):void 0;t.data.push({scriptId:l,script:i})}catch(e){d.Z.error(`_updateScripts scriptId=${l}`,e.message),t.data.push({scriptId:l,errors:[e.message]}),i=i.filter(e=>e.data.scriptId!==l)}}await y({drafts:i,previous:f});let g=await (0,l.Ry)({scriptsReferences:e.map(e=>e.scriptId)});g.errors&&(t.errors=[...t.errors||[],...g.errors]),i.length&&(await n.Z.delete(c.scriptsDrafts).where((0,r.d3)(c.scriptsDrafts.id,i.map(e=>e.id))),i.length&&(await (0,p.j)({restoreKeys:i.map(e=>`script_draft_${e.scriptDraftId}`)}),await n.Z.update(c.screensHistory).set({restoreKey:null}).where((0,r.d3)(c.screensHistory.restoreKey,i.map(e=>`script_draft_${e.scriptDraftId}`))))),s?.broadcastAction&&a.Z.emit("data_changed","update_scripts")}catch(e){d.Z.error("_updateScripts ERROR",e),t.errors=[e.message,...t.errors||[]]}finally{return t}}async function y({previous:e,drafts:s}){try{let t=[];for(let r of s){let s={version:r?.data?.version||1,scriptId:r?.data?.scriptId,changes:{}};if(r?.data?.version===1)s.changes={action:"create_script",description:"Create script",oldValues:[],newValues:[]};else{let t=e.filter(e=>e.scriptId===r?.data?.scriptId)[0],i=[],a=[];Object.keys({...r?.data}).filter(e=>!["version","draft"].includes(e)).forEach(e=>{let s=r.data[e],d={...t}[e];JSON.stringify(s)!==JSON.stringify(d)&&(i.push({[e]:d}),a.push({[e]:s}))}),s.changes={action:"update_script",description:"Update script",oldValues:i,newValues:a}}t.push(s)}await n.Z.insert(c.scriptsHistory).values(t)}catch(e){d.Z.error(e.message)}}},28585:(e,s,t)=>{"use strict";t.d(s,{gv:()=>l});var r=t(57745),i=t(9576),a=t(57435),d=t(88317),n=t(10413),c=t(57418),o=t(85336);async function l(e){let{scriptsReferences:s,diagnosesReferences:t}={...e},i={success:!0},d=[];try{let e=[],o=[];if(s?.length||t?.length){let i=await n.Z.query.diagnosesDrafts.findMany({where:(0,r.or)(s?.length?(0,r.d3)(c.diagnosesDrafts.scriptId,s):void 0,s?.length?(0,r.d3)(c.diagnosesDrafts.scriptDraftId,s):void 0,t?.length?(0,r.d3)(c.diagnosesDrafts.diagnosisId,t):void 0,t?.length?(0,r.d3)(c.diagnosesDrafts.diagnosisDraftId,t):void 0),columns:{diagnosisId:!0,diagnosisDraftId:!0}});e=i.filter(e=>e.diagnosisId).map(e=>({diagnosisId:e.diagnosisId})),o=i.filter(e=>!e.diagnosisId).map(e=>({diagnosisDraftId:e.diagnosisDraftId}))}else{let s=await n.Z.query.diagnosesDrafts.findMany({where:(0,r.K0)(c.diagnosesDrafts.scriptId),columns:{diagnosisId:!0,diagnosisDraftId:!0}});e=s.filter(e=>e.diagnosisId).map(e=>({diagnosisId:e.diagnosisId})),o=s.filter(e=>!e.diagnosisId).map(e=>({diagnosisDraftId:e.diagnosisDraftId}))}if(e.length&&(await f(e)).forEach(e=>e.error&&d.push(e.error)),o.length){let e=await p(o);e.errors?.forEach(e=>d.push(e))}d.length&&(i.success=!1,i.errors=d,a.Z.error("_publishDiagnoses ERRORS",d))}catch(e){i.success=!1,i.errors=[e.message],a.Z.error("_publishDiagnoses ERROR",e)}finally{return i}}async function p(e,s){let t={inserted:[],success:!1};try{let a=[],l=e.length?await n.Z.query.diagnosesDrafts.findMany({where:(0,r.d3)(c.diagnosesDrafts.diagnosisDraftId,e.map(e=>e.diagnosisDraftId))}):[],p=[];for(let{id:e,scriptId:s,data:d}of(l.filter(e=>e.diagnosisId).length&&(p=await n.Z.query.diagnoses.findMany({where:(0,r.d3)(c.diagnoses.diagnosisId,l.filter(e=>e.diagnosisId).map(e=>e.diagnosisId))})),l)){let r=d.diagnosisId||(0,i.Z)(),o=d.scriptId||s,p={...d,diagnosisId:r,scriptId:o};a.push(p),l=l.map(s=>(s.id===e&&(s.data.diagnosisId=r),s));try{await n.Z.insert(c.diagnoses).values(p)}catch(e){t.errors=[...t.errors||[],`Error inserting ${d.name} - ${e.message}`]}}let f=await (0,o.XA)({diagnosisIds:a.map(e=>e.diagnosisId)});t.inserted=s?.returnInserted?f.data:[],t.success=!0,await g({drafts:l,previous:p}),l.length&&await n.Z.delete(c.diagnosesDrafts).where((0,r.d3)(c.diagnosesDrafts.id,l.map(e=>e.id))),s?.broadcastAction&&d.Z.emit("data_changed","create_diagnoses")}catch(e){t.errors=[e.message],a.Z.error("_createDiagnoses ERROR",e.message)}finally{return t}}async function f(e,s){let t=[],i=e.length?await n.Z.query.diagnosesDrafts.findMany({where:(0,r.d3)(c.diagnosesDrafts.diagnosisId,e.map(e=>e.diagnosisId))}):[],l=[];for(let{diagnosisId:e,data:d}of(i.filter(e=>e.diagnosisId).length&&(l=await n.Z.query.diagnoses.findMany({where:(0,r.d3)(c.diagnoses.diagnosisId,i.filter(e=>e.diagnosisId).map(e=>e.diagnosisId))})),i)){let l=e,{diagnosisId:p,id:f,oldDiagnosisId:g,createdAt:u,updatedAt:I,deletedAt:h,...D}=d;try{let e={...D,publishDate:new Date};await n.Z.update(c.diagnoses).set(e).where((0,r.eq)(c.diagnoses.diagnosisId,l));let i=s?.returnUpdated?await (0,o.Ew)(l):void 0;t.push({diagnosisId:l,diagnosis:i})}catch(e){a.Z.error(`_updateDiagnoses diagnosisId=${l}`,e.message),t.push({diagnosisId:l,error:e.message}),i=i.filter(e=>e.data.diagnosisId!==l)}}return await g({drafts:i,previous:l}),i.length&&await n.Z.delete(c.diagnosesDrafts).where((0,r.d3)(c.diagnosesDrafts.id,i.map(e=>e.id))),s?.broadcastAction&&d.Z.emit("data_changed","create_diagnoses"),t}async function g({previous:e,drafts:s}){try{let t=[];for(let r of s){let s={version:r?.data?.version||1,diagnosisId:r?.data?.diagnosisId,scriptId:r?.data?.scriptId,changes:{}};if(r?.data?.version===1)s.changes={action:"create_diagnosis",dediagnosision:"Create diagnosis",oldValues:[],newValues:[]};else{let t=e.filter(e=>e.diagnosisId===r?.data?.diagnosisId)[0],i=[],a=[];Object.keys({...r?.data}).filter(e=>!["version","draft"].includes(e)).forEach(e=>{let s=r.data[e],d={...t}[e];JSON.stringify(s)!==JSON.stringify(d)&&(i.push({[e]:d}),a.push({[e]:s}))}),s.changes={action:"update_diagnosis",dediagnosision:"Update diagnosis",oldValues:i,newValues:a}}t.push(s)}await n.Z.insert(c.diagnosesHistory).values(t)}catch(e){a.Z.error(e.message)}}t(57040)},28422:(e,s,t)=>{"use strict";t.d(s,{Ry:()=>l});var r=t(57745),i=t(9576),a=t(57435),d=t(88317),n=t(10413),c=t(57418),o=t(27457);async function l(e){let{scriptsReferences:s,screensReferences:t}={...e},i={success:!0},d=[];try{let e=[],o=[];if(s?.length||t?.length){let i=await n.Z.query.screensDrafts.findMany({where:(0,r.or)(s?.length?(0,r.d3)(c.screensDrafts.scriptId,s):void 0,s?.length?(0,r.d3)(c.screensDrafts.scriptDraftId,s):void 0,t?.length?(0,r.d3)(c.screensDrafts.screenId,t):void 0,t?.length?(0,r.d3)(c.screensDrafts.screenDraftId,t):void 0),columns:{screenId:!0,screenDraftId:!0}});e=i.filter(e=>e.screenId).map(e=>({screenId:e.screenId})),o=i.filter(e=>!e.screenId).map(e=>({screenDraftId:e.screenDraftId}))}else{let s=await n.Z.query.screensDrafts.findMany({where:(0,r.K0)(c.screensDrafts.scriptId),columns:{screenId:!0,screenDraftId:!0}});e=s.filter(e=>e.screenId).map(e=>({screenId:e.screenId})),o=s.filter(e=>!e.screenId).map(e=>({screenDraftId:e.screenDraftId}))}if(e.length&&(await f(e)).forEach(e=>e.error&&d.push(e.error)),o.length){let e=await p(o);e.errors?.forEach(e=>d.push(e))}d.length&&(i.success=!1,i.errors=d,a.Z.error("_publishScreens ERRORS",d))}catch(e){i.success=!1,i.errors=[e.message],a.Z.error("_publishScreens ERROR",e)}finally{return i}}async function p(e,s){let t={inserted:[],success:!1};try{let a=[],l=e.length?await n.Z.query.screensDrafts.findMany({where:(0,r.d3)(c.screensDrafts.screenDraftId,e.map(e=>e.screenDraftId))}):[],p=[];for(let{id:e,scriptId:s,data:d}of(l.filter(e=>e.screenId).length&&(p=await n.Z.query.screens.findMany({where:(0,r.d3)(c.screens.screenId,l.filter(e=>e.screenId).map(e=>e.screenId))})),l)){let r=d.screenId||(0,i.Z)(),o=d.scriptId||s,p={...d,screenId:r,scriptId:o};a.push(p),l=l.map(s=>(s.id===e&&(s.data.screenId=r),s));try{await n.Z.insert(c.screens).values(p)}catch(e){t.errors=[...t.errors||[],`Error inserting ${d.title} - ${e.message}`]}}let f=await (0,o.uK)({screenIds:a.map(e=>e.screenId)});t.inserted=s?.returnInserted?f.data:[],t.success=!0,await g({drafts:l,previous:p}),l.length&&await n.Z.delete(c.screensDrafts).where((0,r.d3)(c.screensDrafts.id,l.map(e=>e.id))),s?.broadcastAction&&d.Z.emit("data_changed","create_screens")}catch(e){t.errors=[e.message],a.Z.error("_createScreens ERROR",e.message)}finally{return t}}async function f(e,s){let t=[],i=e.length?await n.Z.query.screensDrafts.findMany({where:(0,r.d3)(c.screensDrafts.screenId,e.map(e=>e.screenId))}):[],l=[];for(let{screenId:e,data:d}of(i.filter(e=>e.screenId).length&&(l=await n.Z.query.screens.findMany({where:(0,r.d3)(c.screens.screenId,i.filter(e=>e.screenId).map(e=>e.screenId))})),i)){let l=e,{screenId:p,id:f,oldScreenId:g,createdAt:u,updatedAt:I,deletedAt:h,...D}=d;try{let e={...D,publishDate:new Date};await n.Z.update(c.screens).set(e).where((0,r.eq)(c.screens.screenId,l));let i=s?.returnUpdated?await (0,o.NB)(l):void 0;t.push({screenId:l,screen:i})}catch(e){a.Z.error(`_updateScreens screenId=${l}`,e.message),t.push({screenId:l,error:e.message}),i=i.filter(e=>e.data.screenId!==l)}}return await g({drafts:i,previous:l}),i.length&&await n.Z.delete(c.screensDrafts).where((0,r.d3)(c.screensDrafts.id,i.map(e=>e.id))),s?.broadcastAction&&d.Z.emit("data_changed","create_screens"),t}async function g({previous:e,drafts:s}){try{let t=[];for(let r of s){let s={version:r?.data?.version||1,screenId:r?.data?.screenId,scriptId:r?.data?.scriptId,changes:{}};if(r?.data?.version===1)s.changes={action:"create_screen",descreenion:"Create screen",oldValues:[],newValues:[]};else{let t=e.filter(e=>e.screenId===r?.data?.screenId)[0],i=[],a=[];Object.keys({...r?.data}).filter(e=>!["version","draft"].includes(e)).forEach(e=>{let s=r.data[e],d={...t}[e];JSON.stringify(s)!==JSON.stringify(d)&&(i.push({[e]:d}),a.push({[e]:s}))}),s.changes={action:"update_screen",descreenion:"Update screen",oldValues:i,newValues:a}}t.push(s)}await n.Z.insert(c.screensHistory).values(t)}catch(e){a.Z.error(e.message)}}t(57040)},57040:(e,s,t)=>{"use strict";t.d(s,{bK:()=>g,Tw:()=>h,Tx:()=>f});var r=t(57745),i=t(34149),a=t(60938),d=t(81445),n=t(30900),c=t(57435),o=t(41502),l=t(10413),p=t(57418);async function f(e){let s={data:[]};try{let t=await l.Z.query.scriptsDrafts.findMany({where:e?.length?(0,r.or)((0,r.d3)(p.scriptsDrafts.scriptId,e),(0,r.d3)(p.scriptsDrafts.scriptDraftId,e)):void 0,columns:{scriptId:!0,scriptDraftId:!0,data:!0}}),i=await l.Z.query.scripts.findMany({where:(0,r.xD)((0,r.Ft)(p.scripts.deletedAt),...t.length?[(0,r.Nl)(p.scripts.scriptId,t.map(e=>e.data.scriptId))]:[]),columns:{scriptId:!0,position:!0,title:!0}});return s.data=[...s.data,...t.map(e=>({scriptReference:e.scriptDraftId,scriptId:e.scriptId||void 0,scriptDraftId:e.scriptDraftId,isDraft:!0,title:e.data.title,position:e.data.position}))],s.data=[...s.data,...i.map(e=>({scriptReference:e.scriptId,scriptId:e.scriptId,isDraft:!1,title:e.title,position:e.position}))].sort((e,s)=>e.position-s.position),s}catch(e){s.error=e.message,c.Z.error("_listScripts ERROR",e.message)}finally{return s}}async function g(e){let s=n.Z(e)?(0,r.eq)(p.scripts.scriptId,e):(0,r.eq)(p.scripts.oldScriptId,e),t=await l.Z.query.scripts.findFirst({where:(0,r.xD)(s,(0,r.Ft)(p.scripts.deletedAt)),columns:{id:!0,scriptId:!0,oldScriptId:!0,publishDate:!0,createdAt:!0,updatedAt:!0,version:!0,type:!0,position:!0,title:!0,printTitle:!0,description:!0,hospitalId:!0,exportable:!0,nuidSearchEnabled:!0,nuidSearchFields:!0}});return t?{...t,nuidSearchFields:t.nuidSearchFields}:null}async function u({limit:e,page:s=1,scriptIds:t,searchValue:n,archived:c}){s=Math.max(0,s);let f=[];if(c?f.push((0,r.K0)(p.scripts.deletedAt)):f.push((0,r.Ft)(p.scripts.deletedAt)),t?.length&&f.push((0,r.d3)(p.scripts.scriptId,t)),n=`${n||""}`.trim()){let e=["%",n,"%"].join("");f.push((0,i.i6)`LOWER(scripts.name) like LOWER(${e})`)}let g=l.Z.select({count:(0,a.QX)()}).from(p.scripts);f.length&&g.where((0,r.xD)(...f));let[{count:u}]=await g.execute(),I=1;u&&(s=Math.min(s,I=(0,o.x)(e)?1:Math.ceil(u/e)));let h=(0,o.x)(e)?void 0:Math.max(0,(s-1)*e),D=l.Z.select({id:p.scripts.id,scriptId:p.scripts.scriptId,oldScriptId:p.scripts.oldScriptId,publishDate:p.scripts.publishDate,createdAt:p.scripts.createdAt,updatedAt:p.scripts.updatedAt,version:p.scripts.version,type:p.scripts.type,position:p.scripts.position,title:p.scripts.title,printTitle:p.scripts.printTitle,description:p.scripts.description,hospitalId:p.scripts.hospitalId,exportable:p.scripts.exportable,nuidSearchEnabled:p.scripts.nuidSearchEnabled,scriptDraftId:p.scriptsDrafts.scriptDraftId}).from(p.scripts).leftJoin(p.scriptsDrafts,(0,r.eq)(p.scripts.scriptId,p.scriptsDrafts.scriptId)).orderBy((0,d.C)(p.scripts.position));return(0,o.x)(e)||D.limit(e),h&&D.offset(h),f.length&&D.where((0,r.xD)(...f)),{page:s,limit:e,data:(await D.execute()).map(e=>({...e,publishedVersion:e.version})),totalRows:u,totalPages:I,searchValue:n,error:void 0}}let I={page:1,limit:void 0,totalRows:0,totalPages:1,data:[],searchValue:void 0,error:void 0};async function h(e){let s=I;try{s=await u({...e})}catch(e){c.Z.error("_getScripts ERROR",e),s.error=e.message}finally{return s}}},85336:(e,s,t)=>{"use strict";t.d(s,{Ew:()=>f,XA:()=>I});var r=t(57745),i=t(34149),a=t(60938),d=t(81445),n=t(30900),c=t(41502),o=t(10413),l=t(57418),p=t(57435);async function f(e){let s=n.Z(e)?(0,r.eq)(l.diagnoses.diagnosisId,e):(0,r.eq)(l.diagnoses.oldDiagnosisId,e),t=await o.Z.query.diagnoses.findFirst({where:(0,r.xD)(s,(0,r.Ft)(l.diagnoses.deletedAt))});return t?{...t,symptoms:t.symptoms,image1:t.image1,image2:t.image2,image3:t.image3}:null}async function g({limit:e,page:s=1,diagnosisIds:t,searchValue:n,archived:p,scriptsIds:f}){s=Math.max(0,s);let g=[];if(p?g.push((0,r.K0)(l.diagnoses.deletedAt)):g.push((0,r.Ft)(l.diagnoses.deletedAt)),t?.length&&g.push((0,r.d3)(l.diagnoses.diagnosisId,t)),f?.length&&g.push((0,r.d3)(l.diagnoses.scriptId,f)),n=`${n||""}`.trim()){let e=["%",n,"%"].join("");g.push((0,i.i6)`LOWER(diagnoses.name) like LOWER(${e})`)}let u=o.Z.select({count:(0,a.QX)()}).from(l.diagnoses);g.length&&u.where((0,r.xD)(...g));let[{count:I}]=await u.execute(),h=1;I&&(s=Math.min(s,h=(0,c.x)(e)?1:Math.ceil(I/e)));let D=(0,c.x)(e)?void 0:Math.max(0,(s-1)*e),m=o.Z.select({id:l.diagnoses.id,diagnosisId:l.diagnoses.diagnosisId,oldDiagnosisId:l.diagnoses.oldDiagnosisId,version:l.diagnoses.version,scriptId:l.diagnoses.scriptId,key:l.diagnoses.key,position:l.diagnoses.position,name:l.diagnoses.name,description:l.diagnoses.description,source:l.diagnoses.source,expression:l.diagnoses.expression,severityOrder:l.diagnoses.severityOrder,expressionMeaning:l.diagnoses.expressionMeaning,text1:l.diagnoses.text1,text2:l.diagnoses.text2,text3:l.diagnoses.text3,image1:l.diagnoses.image1,image2:l.diagnoses.image2,image3:l.diagnoses.image3,symptoms:l.diagnoses.symptoms,publishDate:l.diagnoses.publishDate,createdAt:l.diagnoses.createdAt,updatedAt:l.diagnoses.updatedAt,deletedAt:l.diagnoses.deletedAt,diagnosisDraftId:l.diagnosesDrafts.diagnosisDraftId,scriptDraftId:l.diagnosesDrafts.scriptDraftId}).from(l.diagnoses).leftJoin(l.diagnosesDrafts,(0,r.eq)(l.diagnoses.diagnosisId,l.diagnosesDrafts.diagnosisId)).orderBy((0,d.C)(l.diagnoses.position));return(0,c.x)(e)||m.limit(e),D&&m.offset(D),g.length&&m.where((0,r.xD)(...g)),{page:s,limit:e,data:(await m.execute()).map(e=>({...e,publishedVersion:e.version,isDraft:!1,diagnosisDraftId:e.diagnosisDraftId,scriptDraftId:e.scriptDraftId})),totalRows:I,totalPages:h,searchValue:n,error:void 0}}let u={page:1,limit:void 0,totalRows:0,totalPages:1,data:[],searchValue:void 0,error:void 0};async function I(e){let s=u;try{s=await g({...e})}catch(e){p.Z.error("_getDiagnoses ERROR",e),s.error=e.message}finally{return s}}},27457:(e,s,t)=>{"use strict";t.d(s,{NB:()=>f,uK:()=>I});var r=t(57745),i=t(34149),a=t(60938),d=t(81445),n=t(30900),c=t(41502),o=t(10413),l=t(57418),p=t(57435);async function f(e){let s=n.Z(e)?(0,r.eq)(l.screens.screenId,e):(0,r.eq)(l.screens.oldScreenId,e),t=await o.Z.query.screens.findFirst({where:(0,r.xD)(s,(0,r.Ft)(l.screens.deletedAt))});return t?{...t,fields:t.fields,items:t.items,image1:t.image1,image2:t.image2,image3:t.image3}:null}async function g({limit:e,page:s=1,screenIds:t,searchValue:n,archived:p,scriptsIds:f}){s=Math.max(0,s);let g=[];if(p?g.push((0,r.K0)(l.screens.deletedAt)):g.push((0,r.Ft)(l.screens.deletedAt)),t?.length&&g.push((0,r.d3)(l.screens.screenId,t)),f?.length&&g.push((0,r.d3)(l.screens.scriptId,f)),n=`${n||""}`.trim()){let e=["%",n,"%"].join("");g.push((0,i.i6)`LOWER(screens.name) like LOWER(${e})`)}let u=o.Z.select({count:(0,a.QX)()}).from(l.screens);g.length&&u.where((0,r.xD)(...g));let[{count:I}]=await u.execute(),h=1;I&&(s=Math.min(s,h=(0,c.x)(e)?1:Math.ceil(I/e)));let D=(0,c.x)(e)?void 0:Math.max(0,(s-1)*e),m=o.Z.select({id:l.screens.id,screenId:l.screens.screenId,oldScreenId:l.screens.oldScreenId,version:l.screens.version,scriptId:l.screens.scriptId,type:l.screens.type,position:l.screens.position,sectionTitle:l.screens.sectionTitle,condition:l.screens.condition,epicId:l.screens.epicId,storyId:l.screens.storyId,refId:l.screens.refId,step:l.screens.step,actionText:l.screens.actionText,contentText:l.screens.contentText,title:l.screens.title,title1:l.screens.title1,title2:l.screens.title2,title3:l.screens.title3,title4:l.screens.title4,instructions:l.screens.instructions,instructions2:l.screens.instructions2,instructions3:l.screens.instructions3,instructions4:l.screens.instructions4,text1:l.screens.text1,text2:l.screens.text2,text3:l.screens.text3,image1:l.screens.image1,image2:l.screens.image2,image3:l.screens.image3,hcwDiagnosesInstructions:l.screens.hcwDiagnosesInstructions,suggestedDiagnosesInstructions:l.screens.suggestedDiagnosesInstructions,notes:l.screens.notes,dataType:l.screens.dataType,confidential:l.screens.confidential,key:l.screens.key,label:l.screens.label,negativeLabel:l.screens.negativeLabel,positiveLabel:l.screens.positiveLabel,timerValue:l.screens.timerValue,multiplier:l.screens.multiplier,minValue:l.screens.minValue,maxValue:l.screens.maxValue,exportable:l.screens.exportable,skippable:l.screens.skippable,prePopulate:l.screens.prePopulate,fields:l.screens.fields,items:l.screens.items,publishDate:l.screens.publishDate,createdAt:l.screens.createdAt,updatedAt:l.screens.updatedAt,deletedAt:l.screens.deletedAt,screenDraftId:l.screensDrafts.screenDraftId,scriptDraftId:l.screensDrafts.scriptDraftId}).from(l.screens).leftJoin(l.screensDrafts,(0,r.eq)(l.screens.screenId,l.screensDrafts.screenId)).orderBy((0,d.C)(l.screens.position));return(0,c.x)(e)||m.limit(e),D&&m.offset(D),g.length&&m.where((0,r.xD)(...g)),{page:s,limit:e,data:(await m.execute()).map(e=>({...e,publishedVersion:e.version,isDraft:!1,screenDraftId:e.screenDraftId,scriptDraftId:e.scriptDraftId})),totalRows:I,totalPages:h,searchValue:n,error:void 0}}let u={page:1,limit:void 0,totalRows:0,totalPages:1,data:[],searchValue:void 0,error:void 0};async function I(e){let s=u;try{s=await g({...e})}catch(e){p.Z.error("_getScreens ERROR",e),s.error=e.message}finally{return s}}},88317:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(55802).io)(process.env.NEXT_PUBLIC_APP_URL)}};