exports.id=6504,exports.ids=[6504],exports.modules={64365:(e,s,t)=>{Promise.resolve().then(t.bind(t,79530)),Promise.resolve().then(t.bind(t,96948)),Promise.resolve().then(t.bind(t,10827)),Promise.resolve().then(t.t.bind(t,79404,23))},79530:(e,s,t)=>{"use strict";t.d(s,{DiagnosisForm:()=>A});var i=t(10326),a=t(17577),r=t(35047),l=t(90772),n=t(54432),d=t(87673),o=t(31048),c=t(8281),m=t(11870),h=t(77863),x=t(99463),p=t(74723),u=t(47463),g=t(44099),f=t(82617),j=t(96221),y=t(3529),v=t(58464),b=t(42954),w=t(61541),N=t(83855),C=t(39447),k=t(69508),D=t(47035),F=t(77228),$=t(62288),I=t(60097),S=t(46670),z=t(29354);function R({disabled:e,selected:s,onDelete:t,onCopy:a}){return i.jsx(i.Fragment,{children:!!s.length&&i.jsx(z.h,{children:(0,i.jsxs)(l.z,{variant:"destructive",className:"h-auto w-auto",disabled:e,onClick:()=>t(),children:[i.jsx(D.Z,{className:"h-4 w-4 mr-1"}),i.jsx("span",{children:s.length>1?`Delete ${s.length} symptoms`:"Delete symptom"})]})})})}var Z=t(2025),T=t(88846),P=t(53313),_=t(61892),O=t(69486);function U({children:e,symptom:s,form:t,disabled:r,...d}){let{data:c,index:m}={...s},[x,g]=(0,a.useState)(!1),f=(0,a.useCallback)(()=>({symptomId:c?.symptomId||(0,u.Z)(),expression:c?.expression||"",name:c?.name||"",weight:c?.weight||null,type:c?.type||v.ph[0].value,position:c?.position||1,printable:c?.printable||!0,...c}),[c]),{reset:j,watch:y,register:b,handleSubmit:w,setValue:N}=(0,p.cI)({defaultValues:f()}),C=y("type"),k=y("name"),D=y("printable"),F=(0,a.useMemo)(()=>!!r,[r]),I=w(e=>{!(0,_.x)(m)&&c?t.setValue("symptoms",t.getValues("symptoms").map((s,t)=>({...s,...t===m?e:null}))):t.setValue("symptoms",[...t.getValues("symptoms"),e],{shouldDirty:!0}),g(!1)});return i.jsx(i.Fragment,{children:i.jsx(Z.u,{open:x,title:c?"Add symptom":"Edit symptom",trigger:"function"==typeof e?e({extraProps:d}):e,onOpenChange:e=>{g(e),j(f())},actions:(0,i.jsxs)(i.Fragment,{children:[i.jsx("span",{className:(0,h.cn)("text-danger text-xs",F&&"hidden"),children:"* Required"}),i.jsx("div",{className:"flex-1"}),i.jsx($.GG,{asChild:!0,children:i.jsx(l.z,{variant:"ghost",children:"Cancel"})}),i.jsx(l.z,{disabled:F,onClick:()=>I(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[i.jsx(O.D,{children:"Type"}),i.jsx("div",{children:i.jsx(T.E,{disabled:F,defaultValue:C,onValueChange:e=>N("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:v.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[i.jsx(T.m,{value:e.value,id:e.value}),i.jsx(o._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),i.jsx(O.D,{children:"Properties"}),(0,i.jsxs)("div",{children:[i.jsx(o._,{error:!F&&!k,htmlFor:"name",children:"Name *"}),i.jsx(n.I,{...b("name",{disabled:F,required:!0}),name:"name",error:!F&&!k})]}),(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"weight",children:"Weight "}),i.jsx(n.I,{...b("weight",{disabled:F}),name:"label",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",i.jsx("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"expression",children:"Sign/Risk expression "}),i.jsx(n.I,{...b("expression",{disabled:F}),name:"label"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",i.jsx("b",{children:"($key = true and $key2 = false) or $key3 = 'HD'"})]})]}),i.jsx(O.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[i.jsx(P.X,{id:"printable",disabled:F,checked:D,onCheckedChange:()=>N("printable",!D,{shouldDirty:!0})}),i.jsx(o._,{htmlFor:"printable",children:"Print"})]}),i.jsx("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function W({form:e,disabled:s}){let[t,r]=(0,a.useState)([]),{confirm:n}=(0,S.t)(),d=e.watch("symptoms"),o=(0,a.useCallback)((s,t)=>{let i=(0,w.q)([...d],s,t);e.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[e,d]),c=(0,a.useCallback)(s=>{let t=d.filter((e,t)=>s.includes(t)).map(e=>`<div class="font-bold text-danger">${e.name}</div>`).join("");n(()=>{let t=d.filter((e,t)=>!s.includes(t));e.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),r([])},{title:"Delete",message:`<p>Are you sure you want to delete ${s.length>1?`${s.length} symptoms: `:"symptom: "}</p> ${t}`,danger:!0,positiveLabel:"Delete"})},[e,d,n]),m=(0,a.useCallback)(s=>{let t=d.filter((e,t)=>s.includes(t)).map(e=>`<div class="font-bold">${e.name}</div>`).join("");n(()=>{let t=[...d,...d.filter((e,t)=>s.includes(t)).map((e,s)=>({...e,position:d.length+1+s}))];e.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),r([])},{title:"Duplicate",message:`<p>Are you sure you want to duplicate ${s.length>1?`${s.length} symptoms: `:"symptom: "}</p> ${t}`,positiveLabel:"Duplicate"})},[e,d,n]);return(0,i.jsxs)(i.Fragment,{children:[i.jsx(F.DataTable,{title:"Symptoms",sortable:!s,selectable:!s,onSort:o,selectedIndexes:t,onSelect:r,search:{inputPlaceholder:"Search symptoms"},headerActions:i.jsx(i.Fragment,{children:i.jsx(U,{form:e,disabled:s,children:!s&&i.jsx($.hg,{asChild:!0,children:(0,i.jsxs)(l.z,{className:"text-primary border-primary",variant:"outline",children:[i.jsx(N.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer({rowIndex:t}){let a=d[t];return(0,i.jsxs)(I.h_,{children:[i.jsx(I.$F,{asChild:!0,children:i.jsx(l.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:i.jsx(C.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(I.AW,{children:[i.jsx(I.Xi,{asChild:!0,children:i.jsx(U,{disabled:s,form:e,symptom:{data:a,index:t},children:({extraProps:e})=>(0,i.jsxs)($.hg,{...e,className:(0,h.cn)(e?.className,"w-full"),children:[i.jsx(k.Z,{className:"w-4 h-4 mr-2"}),i.jsx("span",{children:s?"View":"Edit"})]})})}),(0,i.jsxs)(I.Xi,{onClick:()=>c([t]),className:(0,h.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:s,children:[i.jsx(D.Z,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Delete"})]})]})]})}}],data:d.map(e=>[e.type,e.name,""])}),!s&&i.jsx(R,{disabled:s,selected:t,onDelete:()=>c(t),onCopy:()=>m(t)})]})}function A(e){let s=(0,r.useRouter)(),t=function({formData:e,scriptId:s}){let t=(0,r.useRouter)(),[i,l]=(0,a.useState)(!1),{saveDiagnoses:n}=(0,f.h)(),{alert:d}=(0,j.s)(),{viewOnly:o}=(0,y.b)(),c=(0,a.useMemo)(()=>`/script/${s}?section=diagnoses`,[s]),m=(0,a.useCallback)(()=>({version:e?.version||1,scriptId:e?.scriptId||s,diagnosisId:e?.diagnosisId||(0,u.Z)(),name:e?.name||"",description:e?.description||"",key:e?.key||"",expression:e?.expression||"",expressionMeaning:e?.expressionMeaning||"",severityOrder:e?.severityOrder||null,symptoms:e?.symptoms||[],text1:e?.text1||"",text2:e?.text2||"",text3:e?.text3||"",image1:e?.image1||null,image2:e?.image2||null,image3:e?.image3||null,preferences:e?.preferences||v.$7}),[e,s]),h=(0,p.cI)({defaultValues:m()}),{formState:{dirtyFields:x},handleSubmit:b}=h,w=(0,a.useMemo)(()=>!!Object.keys(x).length,[x]),N=b(async e=>{try{l(!0);let s={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!s.scriptId)throw Error("Diagnosis is missing script reference!");let i=(await g.Z.post("/api/diagnoses/save",{data:[s],broadcastAction:!0})).data;if(i.errors?.length)throw Error(i.errors.join(", "));t.refresh(),d({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>t.push(c)})}catch(e){d({variant:"error",message:"Failed to save draft: "+e.message})}finally{l(!1)}}),C=(0,a.useMemo)(()=>i||o,[i,o]);return{...h,formIsDirty:w,saving:i,scriptPageHref:c,disabled:C,save:N,getDefaultValues:m}}(e),{formIsDirty:w,saving:N,scriptPageHref:C,disabled:k,register:D,watch:F,setValue:$,save:I}=t,S=F("name"),z=F("key"),R=F("image1"),Z=F("image2"),T=F("image3"),P=F("preferences"),_=(0,a.useCallback)(()=>{s.push(C)},[s,C]);return(0,i.jsxs)(i.Fragment,{children:[N&&i.jsx(m.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"name",error:!k&&!S,children:"Name *"}),i.jsx(n.I,{...D("name",{disabled:k,required:!0}),name:"name",noRing:!1,error:!k&&!S})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"severityOrder",children:"Severity order"}),i.jsx(n.I,{...D("severityOrder",{disabled:k}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[i.jsx(o._,{htmlFor:"key",error:!k&&!z,children:"Key *"}),i.jsx(n.I,{...D("key",{disabled:k,required:!0}),name:"key",noRing:!1,error:!k&&!z})]})]}),(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"description",children:"Description"}),i.jsx(n.I,{...D("description",{disabled:k}),name:"description",noRing:!1}),i.jsx(x.w,{id:"description",title:"Description",disabled:k,data:P,onSave:e=>$("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),i.jsx(n.I,{...D("expression",{disabled:k}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[i.jsx(o._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),i.jsx(n.I,{...D("expressionMeaning",{disabled:k}),name:"expressionMeaning",noRing:!1})]}),[["text1",R],["text2",Z],["text3",T]].map(([e,s],t)=>{let r=`image${t+1}`;return i.jsx(a.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(o._,{htmlFor:`imageTextFields.${t}.text`,children:["Text ",t+1]}),i.jsx(d.g,{...D(e,{disabled:k}),name:`text${t}`,noRing:!1,rows:5}),i.jsx(x.w,{id:e,title:`Text ${t+1}`,disabled:k,data:P,onSave:e=>$("preferences",e,{shouldDirty:!0})})]}),i.jsx(b.M,{disabled:k,image:s,onChange:e=>$(r,e,{shouldDirty:!0})})]})},`imageTextFields.${t}`)})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[i.jsx("span",{className:(0,h.cn)("text-danger text-xs",k&&"hidden"),children:"* Required"}),i.jsx("div",{className:"flex-1"}),i.jsx(l.z,{variant:"ghost",onClick:()=>_(),children:"Cancel"}),i.jsx(l.z,{disabled:k,onClick:()=>I(),children:"Save Draft"})]}),i.jsx(c.Z,{className:"my-20"}),i.jsx("div",{children:i.jsx(W,{disabled:k,form:t})})]})}},42954:(e,s,t)=>{"use strict";t.d(s,{M:()=>k});var i=t(10326),a=t(17577),r=t(83855),l=t(47035),n=t(2165),d=t(15491),o=t(44099),c=t(90772),m=t(46670),h=t(47463),x=t(63685),p=t(39572),u=t(2025),g=t(77863),f=t(11870),j=t(96221);async function y(e){return new Promise((s,t)=>{let i=new Image;i.onload=function(){s({width:i.width,height:i.height})},i.onerror=function(e,s,i,a,r){t(r||Error("Failed to load image"))},i.src=e})}var v=t(46226);function b({width:e=0,height:s=0,containerWidth:t,...a}){let r=a.sizes||"100vw",l={width:"100%",height:"auto"};if(s&&e&&t){r=void 0;let i=function({imageWidth:e,imageHeight:s,containerWidth:t}){return e>t&&(s=t/e*s,e=t),{imageWidth:e,imageHeight:s}}({imageWidth:e,imageHeight:s,containerWidth:t});l.width=i.imageWidth,l.height=i.imageHeight}return i.jsx(v.default,{...a,width:e,height:s,sizes:r,style:{...l,...a.style}})}function w({type:e,children:s,inputProps:t,fileDetails:r,onUpload:l,...d}){let[o,{width:m}]=(0,n.Z)(),[v,w]=(0,a.useState)(!1),[N,C]=(0,a.useState)([]),[k,D]=(0,a.useState)(!1),{alert:F}=(0,j.s)(),$=(0,a.useCallback)(async()=>{let e=t?.multiple?N:[N[0]];try{for(let{file:s,metadata:t,fileId:i}of(D(!0),e)){let e=new FormData;e.append("file",s),e.append("fileId",i||(0,h.Z)()),e.append("filename",s.name),e.append("contentType",s.type),e.append("size",`${s.size}`),e.append("metadata",JSON.stringify({...t})),r&&Object.keys(r).forEach(s=>{let t=r[s];e.append(s,JSON.stringify(t))}),await l(e)}w(!1),C([]),F({title:"Success",message:`File${e.length>1?"s":""} uploaded successfully!`,variant:"success"})}catch(s){F({title:"Error",message:`Failed to upload file${e.length>1?"s":""}: ${s.message}`,variant:"error"})}finally{D(!1)}},[l,F,N,t?.multiple,r]),I=(0,a.useCallback)(async e=>{try{let s=[];if(e.target.files?.length)for(let t=0;t<e.target.files.length;t++)s.push(e.target.files[t]);let t=[];for(let e of s){let s,i;let a=URL.createObjectURL(e),r={};if(`${e.type}`.includes("image"))try{let e=await y(a);r={...r,...e},s=a}catch(e){}t.push({fileId:(0,h.Z)(),file:e,url:a,imageURL:s,videoURL:i,metadata:r})}C(t)}catch(e){F({title:"Error",message:e.message})}},[F]);return(0,i.jsxs)(i.Fragment,{children:[k&&i.jsx(f.a,{overlay:!0}),i.jsx(u.u,{open:v,onOpenChange:e=>{w(e),C([])},title:"Upload file",trigger:s,...d,actions:(0,i.jsxs)(i.Fragment,{children:[!N.length&&i.jsx("div",{className:"flex-1"}),i.jsx(c.z,{variant:"ghost",onClick:()=>w(!1),children:"Cancel"}),!!N.length&&(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{className:"flex-1"}),i.jsx(c.z,{variant:"destructive",onClick:()=>C([]),children:"Clear"}),(0,i.jsxs)(c.z,{disabled:!N.length,onClick:()=>$(),className:(0,g.cn)(!N.length&&"hidden"),children:[i.jsx(x.Z,{className:"h-4 w-4 mr-2"}),i.jsx("span",{children:"Upload"})]})]})]}),children:(0,i.jsxs)("div",{ref:o,children:[1===N.length&&N.map(e=>{let s=i.jsx(p.Z,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(s=i.jsx(b,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:m,src:e.imageURL||"/images/placeholder.png"})),(0,i.jsxs)("div",{className:(0,g.cn)(`
                                        flex
                                        flex-col
                                        gap-y-2
                                        w-full
                                        items-center
                                        justify-center
                                        text-xs
                                    `,!(e.imageURL||e.videoURL)&&""),children:[s,i.jsx("span",{children:e.file.name})]},e.fileId)}),!N.length&&(0,i.jsxs)("div",{className:(0,g.cn)(`
                                    relative
                                    w-full
                                    h-36
                                    bg-primary/20
                                    flex
                                    flex-col
                                    items-center
                                    justify-center
                                    text-primary
                                    uppercase
                                    font-bold
                                    rounded-md
                                    transition-colors
                                    hover:bg-primary/30
                                `,!!N.length&&"hidden"),children:[i.jsx("div",{children:t?.placeholder||"Choose file"}),i.jsx("input",{...t,type:"file",accept:e,value:"",className:(0,g.cn)(`
                                        absolute
                                        left-0
                                        top-0
                                        w-full
                                        h-full
                                        opacity-0
                                    `),onChange:I})]})]})})]})}var N=t(62288),C=t(82617);function k({image:e,disabled:s,onChange:t}){let[h,{width:x}]=(0,n.Z)(),{confirm:p}=(0,m.t)(),{uploadFile:u}=(0,C.h)(),g=(0,a.useCallback)(async e=>{let{file:s,errors:i}=(await o.Z.post("/api/files/upload",e)).data;if(i?.length)throw Error(i.join(", "));if(s){let e=d.Z.stringify({...s.metadata});e=e?`?${e}`:"",t({data:[process.env.NEXT_PUBLIC_APP_URL,`/files/${s.fileId}${e}`].join(""),fileId:s.fileId,filename:s.filename,size:s.size,contentType:s.contentType})}},[u,t]),f=`${e?.data||""}`.split("?").filter((e,s)=>s).join(""),{width:j,height:y}=d.Z.parse(f);return i.jsx(i.Fragment,{children:(0,i.jsxs)("div",{ref:h,className:"flex flex-col gap-y-2 min-w-60 max-w-60",children:[i.jsx("div",{className:"w-full flex flex-col items-center justify-center min-h-28",children:i.jsx(b,{alt:"",width:Number(j||"0"),height:Number(y||"0"),containerWidth:x,src:e?.data||"/images/placeholder.png"})}),(0,i.jsxs)("div",{className:"flex items-center justify-center gap-x-4",children:[i.jsx(w,{type:"image/*",onUpload:g,children:i.jsx(N.hg,{asChild:!0,children:i.jsx(c.z,{size:"icon",className:"w-8 h-8 rounded-full",disabled:s,children:i.jsx(r.Z,{className:"h-4 w-4"})})})}),!!e&&i.jsx(c.z,{variant:"destructive",size:"icon",className:"w-8 h-8 rounded-full",disabled:s,onClick:()=>p(()=>t(null),{title:"Delete image",message:"Are you sure you want to delete this image?",danger:!0}),children:i.jsx(l.Z,{className:"h-4 w-4"})})]})]})})}},96948:(e,s,t)=>{"use strict";t.d(s,{Alert:()=>r});var i=t(96221),a=t(35047);function r(e){(0,a.useRouter)();let{alert:s}=(0,i.s)();return null}t(17577)},8281:(e,s,t)=>{"use strict";t.d(s,{Z:()=>n});var i=t(10326),a=t(17577),r=t(90220),l=t(77863);let n=a.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...a},n)=>i.jsx(r.f,{ref:n,decorative:t,orientation:s,className:(0,l.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...a}));n.displayName=r.f.displayName},89503:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var i=t(68570);let a=(0,i.createProxy)(String.raw`/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/(dashboard)/(scripts)/components/diagnoses/form.tsx`),{__esModule:r,$$typeof:l}=a;a.default;let n=(0,i.createProxy)(String.raw`/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/app/(dashboard)/(scripts)/components/diagnoses/form.tsx#DiagnosisForm`)},49246:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var i=t(19510),a=t(62553);function r(){return i.jsx(a.a,{overlay:!0})}},57890:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var i=t(19510),a=t(62553);function r(){return i.jsx(a.a,{overlay:!0})}},86098:(e,s,t)=>{"use strict";t.d(s,{b:()=>n});var i=t(68570);let a=(0,i.createProxy)(String.raw`/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/components/alert.tsx`),{__esModule:r,$$typeof:l}=a;a.default;let n=(0,i.createProxy)(String.raw`/Users/lafarai/Werq/BWS/NeoTree/neotree-webeditor/components/alert.tsx#Alert`)}};