"use strict";exports.id=1478,exports.ids=[1478],exports.modules={41478:(e,a,t)=>{t.r(a),t.d(a,{$$ACTION_0:()=>x,$$ACTION_1:()=>S,$$ACTION_10:()=>er,$$ACTION_11:()=>en,$$ACTION_12:()=>ei,$$ACTION_13:()=>ec,$$ACTION_14:()=>eh,$$ACTION_15:()=>el,$$ACTION_16:()=>ey,$$ACTION_17:()=>em,$$ACTION_18:()=>eI,$$ACTION_19:()=>eR,$$ACTION_2:()=>k,$$ACTION_20:()=>ep,$$ACTION_3:()=>J,$$ACTION_4:()=>M,$$ACTION_5:()=>X,$$ACTION_6:()=>P,$$ACTION_7:()=>z,$$ACTION_8:()=>Y,$$ACTION_9:()=>ea,countChangeLogs:()=>Q,countChangeLogsByAction:()=>G,countChangeLogsByEntity:()=>W,countChangeLogsByUser:()=>ee,countEntityVersions:()=>et,findRelatedChanges:()=>eu,getActiveVersion:()=>U,getChangeLog:()=>D,getChangeLogStats:()=>H,getChangeLogs:()=>B,getEntityHistory:()=>F,getVersionChain:()=>K,markVersionAsSuperseded:()=>eb,rollbackChangeLog:()=>ew,saveChangeLog:()=>ef,saveChangeLogs:()=>eL,searchChangeLogs:()=>es,searchChangeLogsByDateRange:()=>ed,searchChangeLogsByUser:()=>eg,searchChangesByField:()=>eo,updateChangeLog:()=>ev});var r=t(24330);t(60166);var s=t(36864),n=t(57745),o=t(30900),i=t(57435),g=t(10413),c=t(93567),d=t(88317);async function h({data:e,broadcastAction:a}){let t={success:!1};try{if(!e.changeLogId&&(!e.entityId||void 0===e.version))throw Error("Either changeLogId or entityId+version is required");let r=e.changeLogId&&o.Z(e.changeLogId)?(0,n.eq)(c.changeLogs.changeLogId,e.changeLogId):(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e.entityId),(0,n.eq)(c.changeLogs.version,e.version)),s={};void 0!==e.isActive&&(s.isActive=e.isActive),void 0!==e.supersededBy&&(s.supersededBy=e.supersededBy),void 0!==e.supersededAt&&(s.supersededAt=e.supersededAt),void 0!==e.description&&(s.description=e.description),void 0!==e.changeReason&&(s.changeReason=e.changeReason);let[i]=await g.Z.update(c.changeLogs).set(s).where(r).returning();if(!i)throw Error("Change log not found");return t.success=!0,t.data=i,a&&d.Z.emit("data_changed","update_change_log"),t}catch(e){return t.success=!1,t.errors=[e.message],i.Z.error("_updateChangeLog ERROR",e.message),t}}async function u({entityId:e,version:a,supersededBy:t,broadcastAction:r}){return h({data:{entityId:e,version:a,isActive:!1,supersededBy:t,supersededAt:new Date},broadcastAction:r})}async function l({entityId:e,toVersion:a,userId:t,changeReason:r,broadcastAction:d}){let u={success:!1};try{if(!e||!o.Z(e))throw Error("Invalid entityId");let i=await g.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e),(0,n.eq)(c.changeLogs.version,a))});if(!i)throw Error(`Version ${a} not found for entity ${e}`);let l=await g.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e),(0,n.eq)(c.changeLogs.isActive,!0)),orderBy:(e,{desc:a})=>[a(e.version)]});if(!l)throw Error("No active version found");let f=l.version+1;await h({data:{entityId:e,version:l.version,isActive:!1,supersededBy:f,supersededAt:new Date}});let y={entityId:e,entityType:i.entityType,action:"rollback",version:f,changes:[{action:"rollback",description:`Rolled back to version ${a}`,fromVersion:l.version,toVersion:a}],fullSnapshot:i.fullSnapshot,description:`Rollback to version ${a}`,changeReason:r||`Rolled back from version ${l.version} to version ${a}`,parentVersion:l.version,isActive:!0,userId:t,scriptId:i.scriptId,screenId:i.screenId,diagnosisId:i.diagnosisId,configKeyId:i.configKeyId,drugsLibraryItemId:i.drugsLibraryItemId,dataKeyId:i.dataKeyId,aliasId:i.aliasId},L=await (0,s.C)({data:y,broadcastAction:d});if(L.errors?.length)throw Error(L.errors.join(", "));return u.success=!0,u.newVersion=f,u.data=L.data,u}catch(e){return u.success=!1,u.errors=[e.message],i.Z.error("_rollbackChangeLog ERROR",e.message),u}}var f=t(81445),y=t(34149);async function L(e){try{let{changeLogIds:a=[],entityIds:t=[],entityTypes:r=[],userIds:s=[],actions:i=[],isActiveOnly:d=!1,versions:h=[],dataVersions:u=[],scriptIds:l=[],screenIds:y=[],diagnosisIds:L=[],limit:v,offset:I,sortBy:b="dateOfChange",sortOrder:R="desc"}={...e};a=a.filter(e=>o.Z(e)),t=t.filter(e=>o.Z(e)),s=s.filter(e=>o.Z(e)),l=l.filter(e=>o.Z(e)),y=y.filter(e=>o.Z(e)),L=L.filter(e=>o.Z(e)),u=u.filter(e=>Number.isFinite(e)).map(e=>Number(e));let w=(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(a.length?(0,n.d3)(c.changeLogs.changeLogId,a):void 0,t.length?(0,n.d3)(c.changeLogs.entityId,t):void 0,r.length?(0,n.d3)(c.changeLogs.entityType,r):void 0,s.length?(0,n.d3)(c.changeLogs.userId,s):void 0,i.length?(0,n.d3)(c.changeLogs.action,i):void 0,h.length?(0,n.d3)(c.changeLogs.version,h):void 0,u.length?(0,n.d3)(c.changeLogs.dataVersion,u):void 0,l.length?(0,n.d3)(c.changeLogs.scriptId,l):void 0,y.length?(0,n.d3)(c.changeLogs.screenId,y):void 0,L.length?(0,n.d3)(c.changeLogs.diagnosisId,L):void 0,d?(0,n.eq)(c.changeLogs.isActive,!0):void 0)).orderBy("desc"===R?(0,f.C)(c.changeLogs[b]):(0,f.d)(c.changeLogs[b])).limit(v||1e3).offset(I||0)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||"",entityName:function(e){let a=e.fullSnapshot||{};for(let e of["title","name","label","printTitle","sectionTitle","collectionLabel","key"]){let t=a[e];if("string"==typeof t&&t.trim().length)return t.trim()}if("string"==typeof e.description&&e.description.trim().length)return e.description.trim()}(e.changeLog)}));return await m(w),{data:w,total:w.length}}catch(e){return i.Z.error("_getChangeLogs ERROR",e.message),{data:[],errors:[e.message]}}}async function m(e){if(!e.length)return;let a=new Map;for(let t of e)t.entityId&&(a.has(t.entityType)||a.set(t.entityType,new Set),a.get(t.entityType).add(t.entityId));if(!a.size)return;let t=new Map;for(let[e,r]of Array.from(a.entries())){let a=Array.from(r);if(a.length)for(let r of(await g.Z.select({entityId:c.changeLogs.entityId,latestVersion:(0,y.i6)`max(${c.changeLogs.version})`}).from(c.changeLogs).where((0,n.xD)((0,n.eq)(c.changeLogs.entityType,e),(0,n.d3)(c.changeLogs.entityId,a))).groupBy(c.changeLogs.entityId)))null!==r.latestVersion&&void 0!==r.latestVersion&&t.set(`${e}:${r.entityId}`,Number(r.latestVersion))}for(let a of e){let e=t.get(`${a.entityType}:${a.entityId}`);void 0!==e&&(a.isActive=a.isActive&&a.version===e)}}async function v(e){let{changeLogId:a,entityId:t,version:r}={...e};try{if(!a&&(!t||void 0===r))throw Error("Missing changeLogId or entityId+version");let e=a&&o.Z(a)?(0,n.eq)(c.changeLogs.changeLogId,a):void 0,s=t&&void 0!==r?(0,n.xD)((0,n.eq)(c.changeLogs.entityId,t),(0,n.eq)(c.changeLogs.version,r)):void 0,i=await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where(e||s).limit(1);if(!i[0])return{data:null};return{data:{...i[0].changeLog,userName:i[0].user?.name||"",userEmail:i[0].user?.email||""}}}catch(e){return i.Z.error("_getChangeLog ERROR",e.message),{errors:[e.message]}}}async function I(e){let{entityId:a,entityType:t,includeInactive:r=!1,limit:s}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),t?(0,n.eq)(c.changeLogs.entityType,t):void 0,r?void 0:(0,n.eq)(c.changeLogs.isActive,!0))).orderBy((0,f.C)(c.changeLogs.version)).limit(s||100)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""})),i=e.length>0?Math.max(...e.map(e=>e.version)):void 0;return{data:e,currentVersion:i}}catch(e){return i.Z.error("_getEntityHistory ERROR",e.message),{data:[],errors:[e.message]}}}async function b(e){let{entityId:a,entityType:t}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),(0,n.eq)(c.changeLogs.isActive,!0),t?(0,n.eq)(c.changeLogs.entityType,t):void 0)).orderBy((0,f.C)(c.changeLogs.version)).limit(1);if(!e[0])return{data:null};return{data:{...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""}}}catch(e){return i.Z.error("_getActiveVersion ERROR",e.message),{errors:[e.message]}}}async function R(e){let{entityId:a,fromVersion:t,includeInactive:r=!1}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=t;if(!e){let t=await g.Z.select({version:c.changeLogs.version}).from(c.changeLogs).where((0,n.eq)(c.changeLogs.entityId,a)).orderBy((0,f.C)(c.changeLogs.version)).limit(1);e=t[0]?.version}if(!e)return{data:[]};let s=[],i=e;for(;null!==i;){let e=await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),(0,n.eq)(c.changeLogs.version,i),r?void 0:(0,n.eq)(c.changeLogs.isActive,!0))).limit(1);if(!e[0])break;s.push({...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""}),i=e[0].changeLog.parentVersion}return{data:s}}catch(e){return i.Z.error("_getVersionChain ERROR",e.message),{data:[],errors:[e.message]}}}async function w(e){try{let{entityId:a,entityType:t,userId:r,startDate:s,endDate:o}={...e},i=await g.Z.select({action:c.changeLogs.action,entityType:c.changeLogs.entityType,userId:c.changeLogs.userId,count:(0,y.i6)`count(*)::int`}).from(c.changeLogs).where((0,n.xD)(a?(0,n.eq)(c.changeLogs.entityId,a):void 0,t?(0,n.eq)(c.changeLogs.entityType,t):void 0,r?(0,n.eq)(c.changeLogs.userId,r):void 0,s?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${s}`:void 0,o?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${o}`:void 0)).groupBy(c.changeLogs.action,c.changeLogs.entityType,c.changeLogs.userId),d={totalChanges:0,byAction:{},byUser:{},byEntityType:{}};return i.forEach(e=>{d.totalChanges+=e.count,d.byAction[e.action]=(d.byAction[e.action]||0)+e.count,d.byEntityType[e.entityType]=(d.byEntityType[e.entityType]||0)+e.count,d.byUser[e.userId]=(d.byUser[e.userId]||0)+e.count}),{data:d}}catch(e){return i.Z.error("_getChangeLogStats ERROR",e.message),{data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}},errors:[e.message]}}}var p=t(60938);async function C(e){try{let{entityIds:a=[],entityTypes:t=[],userIds:r=[],actions:s=[],isActiveOnly:i=!1,scriptIds:d=[],screenIds:h=[],diagnosisIds:u=[],startDate:l,endDate:f}={...e};a=a.filter(e=>o.Z(e)),r=r.filter(e=>o.Z(e)),d=d.filter(e=>o.Z(e)),h=h.filter(e=>o.Z(e)),u=u.filter(e=>o.Z(e));let L=await g.Z.select({count:(0,p.QX)()}).from(c.changeLogs).where((0,n.xD)(a.length?(0,n.d3)(c.changeLogs.entityId,a):void 0,t.length?(0,n.d3)(c.changeLogs.entityType,t):void 0,r.length?(0,n.d3)(c.changeLogs.userId,r):void 0,s.length?(0,n.d3)(c.changeLogs.action,s):void 0,d.length?(0,n.d3)(c.changeLogs.scriptId,d):void 0,h.length?(0,n.d3)(c.changeLogs.screenId,h):void 0,u.length?(0,n.d3)(c.changeLogs.diagnosisId,u):void 0,i?(0,n.eq)(c.changeLogs.isActive,!0):void 0,l?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${l}`:void 0,f?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${f}`:void 0));return{count:L[0]?.count||0}}catch(e){return i.Z.error("_countChangeLogs ERROR",e.message),{count:0,errors:[e.message]}}}async function $(e){try{let{entityType:a,isActiveOnly:t=!1,startDate:r,endDate:s}={...e};return{data:await g.Z.select({entityId:c.changeLogs.entityId,entityType:c.changeLogs.entityType,totalVersions:(0,p.QX)(),activeVersions:(0,y.i6)`
                    count(*) FILTER (WHERE ${c.changeLogs.isActive} = true)::int
                `}).from(c.changeLogs).where((0,n.xD)(a?(0,n.eq)(c.changeLogs.entityType,a):void 0,t?(0,n.eq)(c.changeLogs.isActive,!0):void 0,r?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${r}`:void 0,s?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${s}`:void 0)).groupBy(c.changeLogs.entityId,c.changeLogs.entityType)}}catch(e){return i.Z.error("_countChangeLogsByEntity ERROR",e.message),{data:[],errors:[e.message]}}}async function E(e){try{let{entityId:a,entityType:t,userId:r,startDate:s,endDate:i}={...e};return{data:await g.Z.select({action:c.changeLogs.action,count:(0,p.QX)()}).from(c.changeLogs).where((0,n.xD)(a&&o.Z(a)?(0,n.eq)(c.changeLogs.entityId,a):void 0,t?(0,n.eq)(c.changeLogs.entityType,t):void 0,r&&o.Z(r)?(0,n.eq)(c.changeLogs.userId,r):void 0,s?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${s}`:void 0,i?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${i}`:void 0)).groupBy(c.changeLogs.action)}}catch(e){return i.Z.error("_countChangeLogsByAction ERROR",e.message),{data:[],errors:[e.message]}}}async function Z(e){try{let{entityId:a,entityType:t,action:r,startDate:s,endDate:i}={...e};return{data:await g.Z.select({userId:c.changeLogs.userId,count:(0,p.QX)()}).from(c.changeLogs).where((0,n.xD)(a&&o.Z(a)?(0,n.eq)(c.changeLogs.entityId,a):void 0,t?(0,n.eq)(c.changeLogs.entityType,t):void 0,r?(0,n.eq)(c.changeLogs.action,r):void 0,s?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${s}`:void 0,i?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${i}`:void 0)).groupBy(c.changeLogs.userId)}}catch(e){return i.Z.error("_countChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function O(e){try{let{entityId:a,includeInactive:t=!0}={...e};if(!a||!o.Z(a))throw Error("Invalid entityId");let r=await g.Z.select({totalVersions:(0,p.QX)(),activeVersions:(0,y.i6)`
                    count(*) FILTER (WHERE ${c.changeLogs.isActive} = true)::int
                `}).from(c.changeLogs).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),t?void 0:(0,n.eq)(c.changeLogs.isActive,!0)));return{totalVersions:r[0]?.totalVersions||0,activeVersions:r[0]?.activeVersions||0}}catch(e){return i.Z.error("_countEntityVersions ERROR",e.message),{totalVersions:0,activeVersions:0,errors:[e.message]}}}async function A(e){try{let{searchTerm:a,entityTypes:t=[],actions:r=[],userIds:s=[],startDate:i,endDate:d,isActiveOnly:h=!1,limit:u=50,offset:l=0}={...e};s=s.filter(e=>o.Z(e));let L=a?(0,n.or)((0,n.o$)(c.changeLogs.description,`%${a}%`),(0,n.o$)(c.changeLogs.changeReason,`%${a}%`),(0,y.i6)`${c.changeLogs.changes}::text ILIKE ${"%"+a+"%"}`,(0,y.i6)`${c.changeLogs.fullSnapshot}::text ILIKE ${"%"+a+"%"}`):void 0,m=(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(L,t.length?(0,n.d3)(c.changeLogs.entityType,t):void 0,r.length?(0,n.d3)(c.changeLogs.action,r):void 0,s.length?(0,n.d3)(c.changeLogs.userId,s):void 0,h?(0,n.eq)(c.changeLogs.isActive,!0):void 0,i?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${i}`:void 0,d?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${d}`:void 0)).orderBy((0,f.C)(c.changeLogs.dateOfChange)).limit(u).offset(l)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}));return{data:m,total:m.length}}catch(e){return i.Z.error("_searchChangeLogs ERROR",e.message),{data:[],total:0,errors:[e.message]}}}async function q(e){try{let{fieldName:a,searchValue:t,entityId:r,entityType:s,limit:i=50}={...e};if(!a)throw Error("fieldName is required");let d=t?(0,y.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${c.changeLogs.changes}) AS change
                WHERE (change->>'field' = ${a} OR change->>'fieldPath' = ${a})
                AND (
                    change->>'previousValue' ILIKE ${"%"+t+"%"}
                    OR change->>'newValue' ILIKE ${"%"+t+"%"}
                )
            )`:(0,y.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${c.changeLogs.changes}) AS change
                WHERE change->>'field' = ${a} OR change->>'fieldPath' = ${a}
            )`;return{data:(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(d,r&&o.Z(r)?(0,n.eq)(c.changeLogs.entityId,r):void 0,s?(0,n.eq)(c.changeLogs.entityType,s):void 0)).orderBy((0,f.C)(c.changeLogs.dateOfChange)).limit(i)).map(e=>{let t=(e.changeLog.changes||[]).find(e=>e.field===a||e.fieldPath===a);return{version:e.changeLog.version,entityId:e.changeLog.entityId,entityType:e.changeLog.entityType,action:e.changeLog.action,field:t?.field||t?.fieldPath||a,previousValue:t?.previousValue,newValue:t?.newValue,dateOfChange:e.changeLog.dateOfChange,userId:e.changeLog.userId,userName:e.user?.name||""}})}}catch(e){return i.Z.error("_searchChangesByField ERROR",e.message),{data:[],errors:[e.message]}}}async function T(e){try{let{userId:a,userName:t,entityType:r,action:s,startDate:i,endDate:d,limit:h=50,offset:u=0}={...e};if(!a&&!t)throw Error("Either userId or userName is required");let l=t?(0,n.o$)(c.users.displayName,`%${t}%`):a&&o.Z(a)?(0,n.eq)(c.changeLogs.userId,a):void 0;return{data:(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(l,r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s?(0,n.eq)(c.changeLogs.action,s):void 0,i?(0,y.i6)`${c.changeLogs.dateOfChange} >= ${i}`:void 0,d?(0,y.i6)`${c.changeLogs.dateOfChange} <= ${d}`:void 0)).orderBy((0,f.C)(c.changeLogs.dateOfChange)).limit(h).offset(u)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}))}}catch(e){return i.Z.error("_searchChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function V(e){try{let{startDate:a,endDate:t,entityType:r,action:s,limit:o=100}={...e},i=(await g.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,y.i6)`${c.changeLogs.dateOfChange} >= ${a}`,(0,y.i6)`${c.changeLogs.dateOfChange} <= ${t}`,r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s?(0,n.eq)(c.changeLogs.action,s):void 0)).orderBy((0,f.C)(c.changeLogs.dateOfChange)).limit(o)).map(e=>({...e.changeLog,userName:e.user?.name||""})),d={totalChanges:i.length,byAction:{},byEntityType:{}};return i.forEach(e=>{d.byAction[e.action]=(d.byAction[e.action]||0)+1,d.byEntityType[e.entityType]=(d.byEntityType[e.entityType]||0)+1}),{data:i,summary:d}}catch(e){return i.Z.error("_searchChangeLogsByDateRange ERROR",e.message),{data:[],errors:[e.message]}}}async function N(e){try{let a;let{changeLogId:t,includeParentChain:r=!0,includeMergedVersions:s=!0}={...e};if(!t||!o.Z(t))throw Error("Invalid changeLogId");let i=await g.Z.query.changeLogs.findFirst({where:(0,n.eq)(c.changeLogs.changeLogId,t)});if(!i)throw Error("Change log not found");r&&null!==i.parentVersion&&(a=await g.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,i.entityId),(0,n.eq)(c.changeLogs.version,i.parentVersion))}));let d=await g.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,i.entityId),(0,n.eq)(c.changeLogs.parentVersion,i.version)),orderBy:[(0,f.C)(c.changeLogs.version)]}),h=[];if(s&&null!==i.mergedFromVersion){let e=await g.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,i.entityId),(0,n.eq)(c.changeLogs.version,i.mergedFromVersion))});e&&(h=[e])}let u=await g.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,i.entityId),(0,n.eq)(c.changeLogs.supersededBy,i.version)),orderBy:[(0,f.C)(c.changeLogs.version)]});return{data:{current:i,parent:a,children:d,mergedVersions:h,supersededVersions:u}}}catch(e){return i.Z.error("_findRelatedChanges ERROR",e.message),{data:{current:{},children:[],mergedVersions:[],supersededVersions:[]},errors:[e.message]}}}var _=t(66267),j=t(40618);let B=(0,r.j)("8da9082f799215b21cd829454ba8f388fd4133c0",x);async function x(...e){try{return await (0,_.isAllowed)(),await L(...e)}catch(e){return i.Z.error("getChangeLogs ERROR",e.message),{errors:[e.message],data:[]}}}let D=(0,r.j)("e4ba7cb2aae277e7d75968794429e92dc58d76cc",S);async function S(...e){try{return await (0,_.isAllowed)(),await v(...e)}catch(e){return i.Z.error("getChangeLog ERROR",e.message),{errors:[e.message]}}}let F=(0,r.j)("ca80da3afba590dfd9d4262e688a2f8f029b1b09",k);async function k(...e){try{return await (0,_.isAllowed)(),await I(...e)}catch(e){return i.Z.error("getEntityHistory ERROR",e.message),{errors:[e.message],data:[]}}}let U=(0,r.j)("336131fdd35c9d8697e0016bf5c9f29765769236",J);async function J(...e){try{return await (0,_.isAllowed)(),await b(...e)}catch(e){return i.Z.error("getActiveVersion ERROR",e.message),{errors:[e.message]}}}let K=(0,r.j)("5c75d4d958f38b54bfa2fa861d3b368b8317ece4",M);async function M(...e){try{return await (0,_.isAllowed)(),await R(...e)}catch(e){return i.Z.error("getVersionChain ERROR",e.message),{errors:[e.message],data:[]}}}let H=(0,r.j)("94dcf00258df6aad11e6c4a434abfb4d08ae9a4b",X);async function X(...e){try{return await (0,_.isAllowed)(),await w(...e)}catch(e){return i.Z.error("getChangeLogStats ERROR",e.message),{errors:[e.message],data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}}}}}let Q=(0,r.j)("97ff78fb05cd37d95e97550e7b19da15daff71f0",P);async function P(...e){try{return await (0,_.isAllowed)(),await C(...e)}catch(e){return i.Z.error("countChangeLogs ERROR",e.message),{errors:[e.message],count:0}}}let W=(0,r.j)("4f31a8a845d0dd3d6db012c90ae6e1ba748822d7",z);async function z(...e){try{return await (0,_.isAllowed)(),await $(...e)}catch(e){return i.Z.error("countChangeLogsByEntity ERROR",e.message),{errors:[e.message],data:[]}}}let G=(0,r.j)("d965405f6dff2b6824ffe5a4c89f4b890ff770a8",Y);async function Y(...e){try{return await (0,_.isAllowed)(),await E(...e)}catch(e){return i.Z.error("countChangeLogsByAction ERROR",e.message),{errors:[e.message],data:[]}}}let ee=(0,r.j)("0328a7cd9460fc38df68e5e8353eaa2e72f6155b",ea);async function ea(...e){try{return await (0,_.isAllowed)(),await Z(...e)}catch(e){return i.Z.error("countChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let et=(0,r.j)("d4f6e7d3c55c76cf973e700c2754795d3779de2f",er);async function er(...e){try{return await (0,_.isAllowed)(),await O(...e)}catch(e){return i.Z.error("countEntityVersions ERROR",e.message),{errors:[e.message],totalVersions:0,activeVersions:0}}}let es=(0,r.j)("ada702ea360239c0162cb6b67567a286a52f05e3",en);async function en(...e){try{return await (0,_.isAllowed)(),await A(...e)}catch(e){return i.Z.error("searchChangeLogs ERROR",e.message),{errors:[e.message],data:[],total:0}}}let eo=(0,r.j)("960c140a03ff5693d2eb6b2713b93783fbeb79b4",ei);async function ei(...e){try{return await (0,_.isAllowed)(),await q(...e)}catch(e){return i.Z.error("searchChangesByField ERROR",e.message),{errors:[e.message],data:[]}}}let eg=(0,r.j)("a94a7dc48e11b9e8d02fce50b4c617b741b437c0",ec);async function ec(...e){try{return await (0,_.isAllowed)(),await T(...e)}catch(e){return i.Z.error("searchChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let ed=(0,r.j)("4322bd5ab176a575ad38e864dcc537845548e4a7",eh);async function eh(...e){try{return await (0,_.isAllowed)(),await V(...e)}catch(e){return i.Z.error("searchChangeLogsByDateRange ERROR",e.message),{errors:[e.message],data:[]}}}let eu=(0,r.j)("ca4fbb0d07a8cec65620c8be66a8ea4e8dcc32aa",el);async function el(...e){try{return await (0,_.isAllowed)(),await N(...e)}catch(e){return i.Z.error("findRelatedChanges ERROR",e.message),{errors:[e.message],data:{current:{},children:[],mergedVersions:[],supersededVersions:[]}}}}let ef=(0,r.j)("fd0c2a1e05f708e6e8f1e474d35c307f2c5056ba",ey);async function ey(e){try{let a=await (0,_.isAllowed)();return await s.C({...e,data:{...e.data,userId:a.user?.userId}})}catch(e){return i.Z.error("saveChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let eL=(0,r.j)("eae74167b19df3b58b2fead75dfc62de749560b3",em);async function em(e){try{let a=await (0,_.isAllowed)();return await s.F({...e,data:e.data.map(e=>({...e,userId:a.user?.userId}))})}catch(e){return i.Z.error("saveChangeLogs ERROR",e.message),{errors:[e.message],success:!1,saved:0}}}let ev=(0,r.j)("c9153339ae3fe2b220cecde185d1e37b5efcf29e",eI);async function eI(e){try{return await (0,_.isAllowed)(),await h(e)}catch(e){return i.Z.error("updateChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let eb=(0,r.j)("6a2c8493cc6577d4a998e40a65456b6aff03f070",eR);async function eR(e){try{return await (0,_.isAllowed)(),await u(e)}catch(e){return i.Z.error("markVersionAsSuperseded ERROR",e.message),{errors:[e.message],success:!1}}}let ew=(0,r.j)("4ea892e98644fd77f230b5847ce46a5fbced9ecf",ep);async function ep(e){try{let a=await (0,_.isAllowed)();return await l({...e,userId:a.user?.userId})}catch(e){return i.Z.error("rollbackChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}(0,j.h)([B,D,F,U,K,H,Q,W,G,ee,et,es,eo,eg,ed,eu,ef,eL,ev,eb,ew]),(0,r.j)("39603dc25392591cfaeb2a23a14d258c58065cd4",B),(0,r.j)("2fc7eaf22b9df332e706412ff3205f70b2c9a15f",D),(0,r.j)("b8c72164c866ae4ebbab5ff1ec15b939f84c7e71",F),(0,r.j)("f202658d53f8310068bfb22742d28e4009b6fe79",U),(0,r.j)("16f3f39a3da55ca79adc926d5400e09d5ee717af",K),(0,r.j)("f32612a85c69af731cbd162229d3869e65233679",H),(0,r.j)("c1f23e920adb7f9d841c6f4cb00d754bf7311054",Q),(0,r.j)("72ac90be74400adb58f536e69b3ed27485acb552",W),(0,r.j)("acffff5904e4518a941c36a501f3deba35da68d6",G),(0,r.j)("91af84490078439654c791faf1f41716b8fcd8e1",ee),(0,r.j)("3bcc3f076fe9322463b8496b0a7e9d851f79a8b7",et),(0,r.j)("6bb6bb8a8bcfc15b5fe174956d27b5cfecf2e6d2",es),(0,r.j)("40bb9bf6246c2895e45843061668c16bf859fe42",eo),(0,r.j)("09420933c26c22c846afc28b6f2b1d1de5dea8ee",eg),(0,r.j)("79255768294f069d824805fcdcfc38c051d77f14",ed),(0,r.j)("f1df933c8d32273a034e2426c1c9cdd88bab39e0",eu),(0,r.j)("50522c6fbfc0dc8156df4cff8bb0e7bbfcc04dbb",ef),(0,r.j)("e56797185be2e503ac6c17a8f96c5ddea894e0be",eL),(0,r.j)("5b1a8f2dfb1fbfbed7bbecf73de92c2712b618e1",ev),(0,r.j)("c04b37f76cfe872642f8d9fe32fb8c77a5d695ff",eb),(0,r.j)("1b8276eef92547166cfb7c3510bfbdbbe8f97538",ew)}};