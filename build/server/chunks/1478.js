"use strict";exports.id=1478,exports.ids=[1478],exports.modules={41478:(e,a,r)=>{r.r(a),r.d(a,{$$ACTION_0:()=>B,$$ACTION_1:()=>D,$$ACTION_10:()=>er,$$ACTION_11:()=>et,$$ACTION_12:()=>eo,$$ACTION_13:()=>ei,$$ACTION_14:()=>ed,$$ACTION_15:()=>eu,$$ACTION_16:()=>ey,$$ACTION_17:()=>eL,$$ACTION_18:()=>eb,$$ACTION_19:()=>eI,$$ACTION_2:()=>F,$$ACTION_20:()=>ew,$$ACTION_3:()=>U,$$ACTION_4:()=>K,$$ACTION_5:()=>X,$$ACTION_6:()=>Q,$$ACTION_7:()=>W,$$ACTION_8:()=>G,$$ACTION_9:()=>ee,countChangeLogs:()=>M,countChangeLogsByAction:()=>z,countChangeLogsByEntity:()=>P,countChangeLogsByUser:()=>Y,countEntityVersions:()=>ea,findRelatedChanges:()=>eh,getActiveVersion:()=>k,getChangeLog:()=>x,getChangeLogStats:()=>H,getChangeLogs:()=>V,getEntityHistory:()=>S,getVersionChain:()=>J,markVersionAsSuperseded:()=>ev,rollbackChangeLog:()=>eR,saveChangeLog:()=>el,saveChangeLogs:()=>ef,searchChangeLogs:()=>es,searchChangeLogsByDateRange:()=>ec,searchChangeLogsByUser:()=>eg,searchChangesByField:()=>en,updateChangeLog:()=>em});var s=r(24330);r(60166);var t=r(36864),n=r(57745),o=r(30900),g=r(57435),i=r(10413),c=r(93567),d=r(88317);async function h({data:e,broadcastAction:a}){let r={success:!1};try{if(!e.changeLogId&&(!e.entityId||void 0===e.version))throw Error("Either changeLogId or entityId+version is required");let s=e.changeLogId&&o.Z(e.changeLogId)?(0,n.eq)(c.changeLogs.changeLogId,e.changeLogId):(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e.entityId),(0,n.eq)(c.changeLogs.version,e.version)),t={};void 0!==e.isActive&&(t.isActive=e.isActive),void 0!==e.supersededBy&&(t.supersededBy=e.supersededBy),void 0!==e.supersededAt&&(t.supersededAt=e.supersededAt),void 0!==e.description&&(t.description=e.description),void 0!==e.changeReason&&(t.changeReason=e.changeReason);let[g]=await i.Z.update(c.changeLogs).set(t).where(s).returning();if(!g)throw Error("Change log not found");return r.success=!0,r.data=g,a&&d.Z.emit("data_changed","update_change_log"),r}catch(e){return r.success=!1,r.errors=[e.message],g.Z.error("_updateChangeLog ERROR",e.message),r}}async function u({entityId:e,version:a,supersededBy:r,broadcastAction:s}){return h({data:{entityId:e,version:a,isActive:!1,supersededBy:r,supersededAt:new Date},broadcastAction:s})}async function l({entityId:e,toVersion:a,userId:r,changeReason:s,broadcastAction:d}){let u={success:!1};try{if(!e||!o.Z(e))throw Error("Invalid entityId");let g=await i.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e),(0,n.eq)(c.changeLogs.version,a))});if(!g)throw Error(`Version ${a} not found for entity ${e}`);let l=await i.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,e),(0,n.eq)(c.changeLogs.isActive,!0)),orderBy:(e,{desc:a})=>[a(e.version)]});if(!l)throw Error("No active version found");let y=l.version+1;await h({data:{entityId:e,version:l.version,isActive:!1,supersededBy:y,supersededAt:new Date}});let f={entityId:e,entityType:g.entityType,action:"rollback",version:y,changes:[{action:"rollback",description:`Rolled back to version ${a}`,fromVersion:l.version,toVersion:a}],fullSnapshot:g.fullSnapshot,description:`Rollback to version ${a}`,changeReason:s||`Rolled back from version ${l.version} to version ${a}`,parentVersion:l.version,isActive:!0,userId:r,scriptId:g.scriptId,screenId:g.screenId,diagnosisId:g.diagnosisId,configKeyId:g.configKeyId,drugsLibraryItemId:g.drugsLibraryItemId,dataKeyId:g.dataKeyId,aliasId:g.aliasId},L=await (0,t.C)({data:f,broadcastAction:d});if(L.errors?.length)throw Error(L.errors.join(", "));return u.success=!0,u.newVersion=y,u.data=L.data,u}catch(e){return u.success=!1,u.errors=[e.message],g.Z.error("_rollbackChangeLog ERROR",e.message),u}}var y=r(81445),f=r(34149);async function L(e){try{let{changeLogIds:a=[],entityIds:r=[],entityTypes:s=[],userIds:t=[],actions:g=[],isActiveOnly:d=!1,versions:h=[],dataVersions:u=[],scriptIds:l=[],screenIds:f=[],diagnosisIds:L=[],limit:m,offset:b,sortBy:v="dateOfChange",sortOrder:I="desc"}={...e};a=a.filter(e=>o.Z(e)),r=r.filter(e=>o.Z(e)),t=t.filter(e=>o.Z(e)),l=l.filter(e=>o.Z(e)),f=f.filter(e=>o.Z(e)),L=L.filter(e=>o.Z(e)),u=u.filter(e=>Number.isFinite(e)).map(e=>Number(e));let R=(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(a.length?(0,n.d3)(c.changeLogs.changeLogId,a):void 0,r.length?(0,n.d3)(c.changeLogs.entityId,r):void 0,s.length?(0,n.d3)(c.changeLogs.entityType,s):void 0,t.length?(0,n.d3)(c.changeLogs.userId,t):void 0,g.length?(0,n.d3)(c.changeLogs.action,g):void 0,h.length?(0,n.d3)(c.changeLogs.version,h):void 0,u.length?(0,n.d3)(c.changeLogs.dataVersion,u):void 0,l.length?(0,n.d3)(c.changeLogs.scriptId,l):void 0,f.length?(0,n.d3)(c.changeLogs.screenId,f):void 0,L.length?(0,n.d3)(c.changeLogs.diagnosisId,L):void 0,d?(0,n.eq)(c.changeLogs.isActive,!0):void 0)).orderBy("desc"===I?(0,y.C)(c.changeLogs[v]):(0,y.d)(c.changeLogs[v])).limit(m||1e3).offset(b||0)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||"",entityName:function(e){let a=e.fullSnapshot||{};for(let e of["title","name","label","printTitle","sectionTitle","collectionLabel","key"]){let r=a[e];if("string"==typeof r&&r.trim().length)return r.trim()}if("string"==typeof e.description&&e.description.trim().length)return e.description.trim()}(e.changeLog)}));return{data:R,total:R.length}}catch(e){return g.Z.error("_getChangeLogs ERROR",e.message),{data:[],errors:[e.message]}}}async function m(e){let{changeLogId:a,entityId:r,version:s}={...e};try{if(!a&&(!r||void 0===s))throw Error("Missing changeLogId or entityId+version");let e=a&&o.Z(a)?(0,n.eq)(c.changeLogs.changeLogId,a):void 0,t=r&&void 0!==s?(0,n.xD)((0,n.eq)(c.changeLogs.entityId,r),(0,n.eq)(c.changeLogs.version,s)):void 0,g=await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where(e||t).limit(1);if(!g[0])return{data:null};return{data:{...g[0].changeLog,userName:g[0].user?.name||"",userEmail:g[0].user?.email||""}}}catch(e){return g.Z.error("_getChangeLog ERROR",e.message),{errors:[e.message]}}}async function b(e){let{entityId:a,entityType:r,includeInactive:s=!1,limit:t}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s?void 0:(0,n.eq)(c.changeLogs.isActive,!0))).orderBy((0,y.C)(c.changeLogs.version)).limit(t||100)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""})),g=e.length>0?Math.max(...e.map(e=>e.version)):void 0;return{data:e,currentVersion:g}}catch(e){return g.Z.error("_getEntityHistory ERROR",e.message),{data:[],errors:[e.message]}}}async function v(e){let{entityId:a,entityType:r}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),(0,n.eq)(c.changeLogs.isActive,!0),r?(0,n.eq)(c.changeLogs.entityType,r):void 0)).orderBy((0,y.C)(c.changeLogs.version)).limit(1);if(!e[0])return{data:null};return{data:{...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""}}}catch(e){return g.Z.error("_getActiveVersion ERROR",e.message),{errors:[e.message]}}}async function I(e){let{entityId:a,fromVersion:r,includeInactive:s=!1}={...e};try{if(!a||!o.Z(a))throw Error("Invalid entityId");let e=r;if(!e){let r=await i.Z.select({version:c.changeLogs.version}).from(c.changeLogs).where((0,n.eq)(c.changeLogs.entityId,a)).orderBy((0,y.C)(c.changeLogs.version)).limit(1);e=r[0]?.version}if(!e)return{data:[]};let t=[],g=e;for(;null!==g;){let e=await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),(0,n.eq)(c.changeLogs.version,g),s?void 0:(0,n.eq)(c.changeLogs.isActive,!0))).limit(1);if(!e[0])break;t.push({...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""}),g=e[0].changeLog.parentVersion}return{data:t}}catch(e){return g.Z.error("_getVersionChain ERROR",e.message),{data:[],errors:[e.message]}}}async function R(e){try{let{entityId:a,entityType:r,userId:s,startDate:t,endDate:o}={...e},g=await i.Z.select({action:c.changeLogs.action,entityType:c.changeLogs.entityType,userId:c.changeLogs.userId,count:(0,f.i6)`count(*)::int`}).from(c.changeLogs).where((0,n.xD)(a?(0,n.eq)(c.changeLogs.entityId,a):void 0,r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s?(0,n.eq)(c.changeLogs.userId,s):void 0,t?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${t}`:void 0,o?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${o}`:void 0)).groupBy(c.changeLogs.action,c.changeLogs.entityType,c.changeLogs.userId),d={totalChanges:0,byAction:{},byUser:{},byEntityType:{}};return g.forEach(e=>{d.totalChanges+=e.count,d.byAction[e.action]=(d.byAction[e.action]||0)+e.count,d.byEntityType[e.entityType]=(d.byEntityType[e.entityType]||0)+e.count,d.byUser[e.userId]=(d.byUser[e.userId]||0)+e.count}),{data:d}}catch(e){return g.Z.error("_getChangeLogStats ERROR",e.message),{data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}},errors:[e.message]}}}var w=r(60938);async function C(e){try{let{entityIds:a=[],entityTypes:r=[],userIds:s=[],actions:t=[],isActiveOnly:g=!1,scriptIds:d=[],screenIds:h=[],diagnosisIds:u=[],startDate:l,endDate:y}={...e};a=a.filter(e=>o.Z(e)),s=s.filter(e=>o.Z(e)),d=d.filter(e=>o.Z(e)),h=h.filter(e=>o.Z(e)),u=u.filter(e=>o.Z(e));let L=await i.Z.select({count:(0,w.QX)()}).from(c.changeLogs).where((0,n.xD)(a.length?(0,n.d3)(c.changeLogs.entityId,a):void 0,r.length?(0,n.d3)(c.changeLogs.entityType,r):void 0,s.length?(0,n.d3)(c.changeLogs.userId,s):void 0,t.length?(0,n.d3)(c.changeLogs.action,t):void 0,d.length?(0,n.d3)(c.changeLogs.scriptId,d):void 0,h.length?(0,n.d3)(c.changeLogs.screenId,h):void 0,u.length?(0,n.d3)(c.changeLogs.diagnosisId,u):void 0,g?(0,n.eq)(c.changeLogs.isActive,!0):void 0,l?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${l}`:void 0,y?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${y}`:void 0));return{count:L[0]?.count||0}}catch(e){return g.Z.error("_countChangeLogs ERROR",e.message),{count:0,errors:[e.message]}}}async function p(e){try{let{entityType:a,isActiveOnly:r=!1,startDate:s,endDate:t}={...e};return{data:await i.Z.select({entityId:c.changeLogs.entityId,entityType:c.changeLogs.entityType,totalVersions:(0,w.QX)(),activeVersions:(0,f.i6)`
                    count(*) FILTER (WHERE ${c.changeLogs.isActive} = true)::int
                `}).from(c.changeLogs).where((0,n.xD)(a?(0,n.eq)(c.changeLogs.entityType,a):void 0,r?(0,n.eq)(c.changeLogs.isActive,!0):void 0,s?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${s}`:void 0,t?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${t}`:void 0)).groupBy(c.changeLogs.entityId,c.changeLogs.entityType)}}catch(e){return g.Z.error("_countChangeLogsByEntity ERROR",e.message),{data:[],errors:[e.message]}}}async function E(e){try{let{entityId:a,entityType:r,userId:s,startDate:t,endDate:g}={...e};return{data:await i.Z.select({action:c.changeLogs.action,count:(0,w.QX)()}).from(c.changeLogs).where((0,n.xD)(a&&o.Z(a)?(0,n.eq)(c.changeLogs.entityId,a):void 0,r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s&&o.Z(s)?(0,n.eq)(c.changeLogs.userId,s):void 0,t?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${t}`:void 0,g?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${g}`:void 0)).groupBy(c.changeLogs.action)}}catch(e){return g.Z.error("_countChangeLogsByAction ERROR",e.message),{data:[],errors:[e.message]}}}async function $(e){try{let{entityId:a,entityType:r,action:s,startDate:t,endDate:g}={...e};return{data:await i.Z.select({userId:c.changeLogs.userId,count:(0,w.QX)()}).from(c.changeLogs).where((0,n.xD)(a&&o.Z(a)?(0,n.eq)(c.changeLogs.entityId,a):void 0,r?(0,n.eq)(c.changeLogs.entityType,r):void 0,s?(0,n.eq)(c.changeLogs.action,s):void 0,t?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${t}`:void 0,g?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${g}`:void 0)).groupBy(c.changeLogs.userId)}}catch(e){return g.Z.error("_countChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function Z(e){try{let{entityId:a,includeInactive:r=!0}={...e};if(!a||!o.Z(a))throw Error("Invalid entityId");let s=await i.Z.select({totalVersions:(0,w.QX)(),activeVersions:(0,f.i6)`
                    count(*) FILTER (WHERE ${c.changeLogs.isActive} = true)::int
                `}).from(c.changeLogs).where((0,n.xD)((0,n.eq)(c.changeLogs.entityId,a),r?void 0:(0,n.eq)(c.changeLogs.isActive,!0)));return{totalVersions:s[0]?.totalVersions||0,activeVersions:s[0]?.activeVersions||0}}catch(e){return g.Z.error("_countEntityVersions ERROR",e.message),{totalVersions:0,activeVersions:0,errors:[e.message]}}}async function O(e){try{let{searchTerm:a,entityTypes:r=[],actions:s=[],userIds:t=[],startDate:g,endDate:d,isActiveOnly:h=!1,limit:u=50,offset:l=0}={...e};t=t.filter(e=>o.Z(e));let L=a?(0,n.or)((0,n.o$)(c.changeLogs.description,`%${a}%`),(0,n.o$)(c.changeLogs.changeReason,`%${a}%`),(0,f.i6)`${c.changeLogs.changes}::text ILIKE ${"%"+a+"%"}`,(0,f.i6)`${c.changeLogs.fullSnapshot}::text ILIKE ${"%"+a+"%"}`):void 0,m=(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(L,r.length?(0,n.d3)(c.changeLogs.entityType,r):void 0,s.length?(0,n.d3)(c.changeLogs.action,s):void 0,t.length?(0,n.d3)(c.changeLogs.userId,t):void 0,h?(0,n.eq)(c.changeLogs.isActive,!0):void 0,g?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${g}`:void 0,d?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${d}`:void 0)).orderBy((0,y.C)(c.changeLogs.dateOfChange)).limit(u).offset(l)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}));return{data:m,total:m.length}}catch(e){return g.Z.error("_searchChangeLogs ERROR",e.message),{data:[],total:0,errors:[e.message]}}}async function A(e){try{let{fieldName:a,searchValue:r,entityId:s,entityType:t,limit:g=50}={...e};if(!a)throw Error("fieldName is required");let d=r?(0,f.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${c.changeLogs.changes}) AS change
                WHERE (change->>'field' = ${a} OR change->>'fieldPath' = ${a})
                AND (
                    change->>'previousValue' ILIKE ${"%"+r+"%"}
                    OR change->>'newValue' ILIKE ${"%"+r+"%"}
                )
            )`:(0,f.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${c.changeLogs.changes}) AS change
                WHERE change->>'field' = ${a} OR change->>'fieldPath' = ${a}
            )`;return{data:(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(d,s&&o.Z(s)?(0,n.eq)(c.changeLogs.entityId,s):void 0,t?(0,n.eq)(c.changeLogs.entityType,t):void 0)).orderBy((0,y.C)(c.changeLogs.dateOfChange)).limit(g)).map(e=>{let r=(e.changeLog.changes||[]).find(e=>e.field===a||e.fieldPath===a);return{version:e.changeLog.version,entityId:e.changeLog.entityId,entityType:e.changeLog.entityType,action:e.changeLog.action,field:r?.field||r?.fieldPath||a,previousValue:r?.previousValue,newValue:r?.newValue,dateOfChange:e.changeLog.dateOfChange,userId:e.changeLog.userId,userName:e.user?.name||""}})}}catch(e){return g.Z.error("_searchChangesByField ERROR",e.message),{data:[],errors:[e.message]}}}async function q(e){try{let{userId:a,userName:r,entityType:s,action:t,startDate:g,endDate:d,limit:h=50,offset:u=0}={...e};if(!a&&!r)throw Error("Either userId or userName is required");let l=r?(0,n.o$)(c.users.displayName,`%${r}%`):a&&o.Z(a)?(0,n.eq)(c.changeLogs.userId,a):void 0;return{data:(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName,email:c.users.email}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)(l,s?(0,n.eq)(c.changeLogs.entityType,s):void 0,t?(0,n.eq)(c.changeLogs.action,t):void 0,g?(0,f.i6)`${c.changeLogs.dateOfChange} >= ${g}`:void 0,d?(0,f.i6)`${c.changeLogs.dateOfChange} <= ${d}`:void 0)).orderBy((0,y.C)(c.changeLogs.dateOfChange)).limit(h).offset(u)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}))}}catch(e){return g.Z.error("_searchChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function T(e){try{let{startDate:a,endDate:r,entityType:s,action:t,limit:o=100}={...e},g=(await i.Z.select({changeLog:c.changeLogs,user:{name:c.users.displayName}}).from(c.changeLogs).leftJoin(c.users,(0,n.eq)(c.users.userId,c.changeLogs.userId)).where((0,n.xD)((0,f.i6)`${c.changeLogs.dateOfChange} >= ${a}`,(0,f.i6)`${c.changeLogs.dateOfChange} <= ${r}`,s?(0,n.eq)(c.changeLogs.entityType,s):void 0,t?(0,n.eq)(c.changeLogs.action,t):void 0)).orderBy((0,y.C)(c.changeLogs.dateOfChange)).limit(o)).map(e=>({...e.changeLog,userName:e.user?.name||""})),d={totalChanges:g.length,byAction:{},byEntityType:{}};return g.forEach(e=>{d.byAction[e.action]=(d.byAction[e.action]||0)+1,d.byEntityType[e.entityType]=(d.byEntityType[e.entityType]||0)+1}),{data:g,summary:d}}catch(e){return g.Z.error("_searchChangeLogsByDateRange ERROR",e.message),{data:[],errors:[e.message]}}}async function N(e){try{let a;let{changeLogId:r,includeParentChain:s=!0,includeMergedVersions:t=!0}={...e};if(!r||!o.Z(r))throw Error("Invalid changeLogId");let g=await i.Z.query.changeLogs.findFirst({where:(0,n.eq)(c.changeLogs.changeLogId,r)});if(!g)throw Error("Change log not found");s&&null!==g.parentVersion&&(a=await i.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,g.entityId),(0,n.eq)(c.changeLogs.version,g.parentVersion))}));let d=await i.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,g.entityId),(0,n.eq)(c.changeLogs.parentVersion,g.version)),orderBy:[(0,y.C)(c.changeLogs.version)]}),h=[];if(t&&null!==g.mergedFromVersion){let e=await i.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,g.entityId),(0,n.eq)(c.changeLogs.version,g.mergedFromVersion))});e&&(h=[e])}let u=await i.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(c.changeLogs.entityId,g.entityId),(0,n.eq)(c.changeLogs.supersededBy,g.version)),orderBy:[(0,y.C)(c.changeLogs.version)]});return{data:{current:g,parent:a,children:d,mergedVersions:h,supersededVersions:u}}}catch(e){return g.Z.error("_findRelatedChanges ERROR",e.message),{data:{current:{},children:[],mergedVersions:[],supersededVersions:[]},errors:[e.message]}}}var _=r(66267),j=r(40618);let V=(0,s.j)("a902df9faab74c5b5a9b1dd1c73288b304b0ab0b",B);async function B(...e){try{return await (0,_.isAllowed)(),await L(...e)}catch(e){return g.Z.error("getChangeLogs ERROR",e.message),{errors:[e.message],data:[]}}}let x=(0,s.j)("92bceb62288b969c041121123b39e70a7d40d997",D);async function D(...e){try{return await (0,_.isAllowed)(),await m(...e)}catch(e){return g.Z.error("getChangeLog ERROR",e.message),{errors:[e.message]}}}let S=(0,s.j)("84a484b8e1d39eceff0ed792a2d832a5d1aa8330",F);async function F(...e){try{return await (0,_.isAllowed)(),await b(...e)}catch(e){return g.Z.error("getEntityHistory ERROR",e.message),{errors:[e.message],data:[]}}}let k=(0,s.j)("125164335e42eb4a3b09e583d074bdcf310851df",U);async function U(...e){try{return await (0,_.isAllowed)(),await v(...e)}catch(e){return g.Z.error("getActiveVersion ERROR",e.message),{errors:[e.message]}}}let J=(0,s.j)("a64950b1b42963c067da2e56ef0bc7f4af23bda1",K);async function K(...e){try{return await (0,_.isAllowed)(),await I(...e)}catch(e){return g.Z.error("getVersionChain ERROR",e.message),{errors:[e.message],data:[]}}}let H=(0,s.j)("ae21bb834e675b72fbc6c0eb9bb93baea32d4c57",X);async function X(...e){try{return await (0,_.isAllowed)(),await R(...e)}catch(e){return g.Z.error("getChangeLogStats ERROR",e.message),{errors:[e.message],data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}}}}}let M=(0,s.j)("66bca1cb99d1aeec83c3e2b37b905dccad972ab8",Q);async function Q(...e){try{return await (0,_.isAllowed)(),await C(...e)}catch(e){return g.Z.error("countChangeLogs ERROR",e.message),{errors:[e.message],count:0}}}let P=(0,s.j)("97b08537e4975129c96ab1d3724628bb71bc91b2",W);async function W(...e){try{return await (0,_.isAllowed)(),await p(...e)}catch(e){return g.Z.error("countChangeLogsByEntity ERROR",e.message),{errors:[e.message],data:[]}}}let z=(0,s.j)("a4e90a3c53972c934686c1df394d8dbbbb8f8c69",G);async function G(...e){try{return await (0,_.isAllowed)(),await E(...e)}catch(e){return g.Z.error("countChangeLogsByAction ERROR",e.message),{errors:[e.message],data:[]}}}let Y=(0,s.j)("4bbf602c0546f72efeb8bbb76176aa661aab9637",ee);async function ee(...e){try{return await (0,_.isAllowed)(),await $(...e)}catch(e){return g.Z.error("countChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let ea=(0,s.j)("48b89775a3f663bb23b3aa87d93d631abbc3b708",er);async function er(...e){try{return await (0,_.isAllowed)(),await Z(...e)}catch(e){return g.Z.error("countEntityVersions ERROR",e.message),{errors:[e.message],totalVersions:0,activeVersions:0}}}let es=(0,s.j)("f286cd9a86ddb18d9159fbe749a70f2510667cda",et);async function et(...e){try{return await (0,_.isAllowed)(),await O(...e)}catch(e){return g.Z.error("searchChangeLogs ERROR",e.message),{errors:[e.message],data:[],total:0}}}let en=(0,s.j)("77b9e563d8d496f390ca9dfa478f4f26c5c055c3",eo);async function eo(...e){try{return await (0,_.isAllowed)(),await A(...e)}catch(e){return g.Z.error("searchChangesByField ERROR",e.message),{errors:[e.message],data:[]}}}let eg=(0,s.j)("ed9535da4a8d1b8783ea3a678a7e78bbf004476f",ei);async function ei(...e){try{return await (0,_.isAllowed)(),await q(...e)}catch(e){return g.Z.error("searchChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let ec=(0,s.j)("0c665dbbfe4dce7bb36578fb97d9eafcd42a443e",ed);async function ed(...e){try{return await (0,_.isAllowed)(),await T(...e)}catch(e){return g.Z.error("searchChangeLogsByDateRange ERROR",e.message),{errors:[e.message],data:[]}}}let eh=(0,s.j)("448d1940a0b47660d634aa535a8dd6a2f3a58ab9",eu);async function eu(...e){try{return await (0,_.isAllowed)(),await N(...e)}catch(e){return g.Z.error("findRelatedChanges ERROR",e.message),{errors:[e.message],data:{current:{},children:[],mergedVersions:[],supersededVersions:[]}}}}let el=(0,s.j)("2c5b3d325b591dfcb81df207ae2232e9fc693ad4",ey);async function ey(e){try{let a=await (0,_.isAllowed)();return await t.C({...e,data:{...e.data,userId:a.user?.userId}})}catch(e){return g.Z.error("saveChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let ef=(0,s.j)("fa79ad974602b65967706eb4f39771d2c6ef2274",eL);async function eL(e){try{let a=await (0,_.isAllowed)();return await t.F({...e,data:e.data.map(e=>({...e,userId:a.user?.userId}))})}catch(e){return g.Z.error("saveChangeLogs ERROR",e.message),{errors:[e.message],success:!1,saved:0}}}let em=(0,s.j)("603da7829e6940e8b6cfcd0df00acfb3d5406e02",eb);async function eb(e){try{return await (0,_.isAllowed)(),await h(e)}catch(e){return g.Z.error("updateChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let ev=(0,s.j)("42c4ca3cdcd829c265167e1649266c3a28ab1b8e",eI);async function eI(e){try{return await (0,_.isAllowed)(),await u(e)}catch(e){return g.Z.error("markVersionAsSuperseded ERROR",e.message),{errors:[e.message],success:!1}}}let eR=(0,s.j)("76efc23e67a3284ed6117163ac159c837fe7f69c",ew);async function ew(e){try{let a=await (0,_.isAllowed)();return await l({...e,userId:a.user?.userId})}catch(e){return g.Z.error("rollbackChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}(0,j.h)([V,x,S,k,J,H,M,P,z,Y,ea,es,en,eg,ec,eh,el,ef,em,ev,eR]),(0,s.j)("22faa74a8a23a5ce9d7a377fa2ba69870ad4e746",V),(0,s.j)("ef0ac3645fc26a32f2a1c948dc946e34b9cebb1b",x),(0,s.j)("f252230dcdf0288570e6b33425289816f809edc6",S),(0,s.j)("800e16ca05753b7b62791e4c773a278a0180e9e4",k),(0,s.j)("8cb720a5fd215c273e20910affee6c55ccaaf78b",J),(0,s.j)("99cf91db2d4bdb755f41d5133a2495865984c9dd",H),(0,s.j)("7d7b9dea32b050424231640e680c079453ba7853",M),(0,s.j)("3e9f4478c3f4074f6681dc3704681ef07be1a5e4",P),(0,s.j)("65f6a6b1d958bbf1ba209aa896e811009ee298f5",z),(0,s.j)("b10b98bfc23d466db7e72d8e045dce63f5dc7412",Y),(0,s.j)("37aeef9efd03ba9075db8d167757531e8b1119ae",ea),(0,s.j)("90dcb87bc5c90c021a01b90d1be503b4e239b63d",es),(0,s.j)("10d0ccf569a527083494b7ad64099f2b9b7d67f0",en),(0,s.j)("261f88b2f7fd8ef7156adc4b9702228b41559567",eg),(0,s.j)("da3bbee85c7bd1031463fde9276d4ce308100b12",ec),(0,s.j)("6669d18c1bcce631e7fe44c02a2e93581620d58d",eh),(0,s.j)("bf2bf90ca9e5024b8bd8a164cb432151a6685530",el),(0,s.j)("80287c6301547e3621b32486b16651a209165557",ef),(0,s.j)("cd3262786c56b25dcaf7e64f9fc42cfaf61878b5",em),(0,s.j)("1d109ab498e932569f2388818d28e2b976d9b757",ev),(0,s.j)("5a20ad455f915799b78441e9fd0847fdb9232d96",eR)}};