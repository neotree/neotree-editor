exports.id=8549,exports.ids=[8549],exports.modules={81221:(e,s,t)=>{Promise.resolve().then(t.bind(t,79530)),Promise.resolve().then(t.bind(t,96948)),Promise.resolve().then(t.bind(t,10827)),Promise.resolve().then(t.t.bind(t,79404,23))},79530:(e,s,t)=>{"use strict";t.d(s,{DiagnosisForm:()=>A});var a=t(10326),i=t(17577),r=t(35047),n=t(90772),l=t(54432),d=t(87673),o=t(31048),c=t(8281),m=t(11870),h=t(77863),x=t(99463),p=t(74723),u=t(47463),g=t(44099),f=t(82617),j=t(96221),y=t(3529),v=t(58464),b=t(13936),w=t(61541),N=t(83855),k=t(39447),C=t(69508),F=t(47035),D=t(77228),$=t(62288),I=t(60097),z=t(46670),S=t(29354);function R({disabled:e,selected:s,onDelete:t,onCopy:i}){return a.jsx(a.Fragment,{children:!!s.length&&a.jsx(S.h,{children:(0,a.jsxs)(n.z,{variant:"destructive",className:"h-auto w-auto",disabled:e,onClick:()=>t(),children:[a.jsx(F.Z,{className:"h-4 w-4 mr-1"}),a.jsx("span",{children:s.length>1?`Delete ${s.length} symptoms`:"Delete symptom"})]})})})}var Z=t(2025),P=t(88846),_=t(53313),O=t(61892),M=t(69486);function V({children:e,symptom:s,form:t,disabled:r,...d}){let{data:c,index:m}={...s},[x,g]=(0,i.useState)(!1),f=(0,i.useCallback)(()=>({symptomId:c?.symptomId||(0,u.Z)(),expression:c?.expression||"",name:c?.name||"",weight:c?.weight||null,type:c?.type||v.ph[0].value,position:c?.position||1,printable:c?.printable||!0,...c}),[c]),{reset:j,watch:y,register:b,handleSubmit:w,setValue:N}=(0,p.cI)({defaultValues:f()}),k=y("type"),C=y("name"),F=y("printable"),D=(0,i.useMemo)(()=>!!r,[r]),I=w(e=>{!(0,O.x)(m)&&c?t.setValue("symptoms",t.getValues("symptoms").map((s,t)=>({...s,...t===m?e:null}))):t.setValue("symptoms",[...t.getValues("symptoms"),e],{shouldDirty:!0}),g(!1)});return a.jsx(a.Fragment,{children:a.jsx(Z.u,{open:x,title:c?"Add symptom":"Edit symptom",trigger:"function"==typeof e?e({extraProps:d}):e,onOpenChange:e=>{g(e),j(f())},actions:(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{className:(0,h.cn)("text-danger text-xs",D&&"hidden"),children:"* Required"}),a.jsx("div",{className:"flex-1"}),a.jsx($.GG,{asChild:!0,children:a.jsx(n.z,{variant:"ghost",children:"Cancel"})}),a.jsx(n.z,{disabled:D,onClick:()=>I(),children:"Save"})]}),children:(0,a.jsxs)("div",{className:"flex flex-col gap-y-5",children:[a.jsx(M.D,{children:"Type"}),a.jsx("div",{children:a.jsx(P.E,{disabled:D,defaultValue:k,onValueChange:e=>N("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:v.ph.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(P.m,{value:e.value,id:e.value}),a.jsx(o._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),a.jsx(M.D,{children:"Properties"}),(0,a.jsxs)("div",{children:[a.jsx(o._,{error:!D&&!C,htmlFor:"name",children:"Name *"}),a.jsx(l.I,{...b("name",{disabled:D,required:!0}),name:"name",error:!D&&!C})]}),(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"weight",children:"Weight "}),a.jsx(l.I,{...b("weight",{disabled:D}),name:"label",type:"number"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",a.jsx("b",{children:"default 1.0"}),")"]})]}),(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"expression",children:"Sign/Risk expression "}),a.jsx(l.I,{...b("expression",{disabled:D}),name:"label"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",a.jsx("b",{children:"($key = true and $key2 = false) or $key3 = 'HD'"})]})]}),a.jsx(M.D,{children:"Print"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[a.jsx(_.X,{id:"printable",disabled:D,checked:F,onCheckedChange:()=>N("printable",!F,{shouldDirty:!0})}),a.jsx(o._,{htmlFor:"printable",children:"Print"})]}),a.jsx("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function T({form:e,disabled:s}){let[t,r]=(0,i.useState)([]),{confirm:l}=(0,z.t)(),d=e.watch("symptoms"),o=(0,i.useCallback)((s,t)=>{let a=(0,w.q)([...d],s,t);e.setValue("symptoms",a.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[e,d]),c=(0,i.useCallback)(s=>{let t=d.filter((e,t)=>s.includes(t)).map(e=>`<div class="font-bold text-danger">${e.name}</div>`).join("");l(()=>{let t=d.filter((e,t)=>!s.includes(t));e.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),r([])},{title:"Delete",message:`<p>Are you sure you want to delete ${s.length>1?`${s.length} symptoms: `:"symptom: "}</p> ${t}`,danger:!0,positiveLabel:"Delete"})},[e,d,l]),m=(0,i.useCallback)(s=>{let t=d.filter((e,t)=>s.includes(t)).map(e=>`<div class="font-bold">${e.name}</div>`).join("");l(()=>{let t=[...d,...d.filter((e,t)=>s.includes(t)).map((e,s)=>({...e,position:d.length+1+s}))];e.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),r([])},{title:"Duplicate",message:`<p>Are you sure you want to duplicate ${s.length>1?`${s.length} symptoms: `:"symptom: "}</p> ${t}`,positiveLabel:"Duplicate"})},[e,d,l]);return(0,a.jsxs)(a.Fragment,{children:[a.jsx(D.DataTable,{title:"Symptoms",sortable:!s,selectable:!s,onSort:o,selectedIndexes:t,onSelect:r,search:{inputPlaceholder:"Search symptoms"},headerActions:a.jsx(a.Fragment,{children:a.jsx(V,{form:e,disabled:s,children:!s&&a.jsx($.hg,{asChild:!0,children:(0,a.jsxs)(n.z,{className:"text-primary border-primary",variant:"outline",children:[a.jsx(N.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer({rowIndex:t}){let i=d[t];return(0,a.jsxs)(I.h_,{children:[a.jsx(I.$F,{asChild:!0,children:a.jsx(n.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:a.jsx(k.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(I.AW,{children:[a.jsx(I.Xi,{asChild:!0,children:a.jsx(V,{disabled:s,form:e,symptom:{data:i,index:t},children:({extraProps:e})=>(0,a.jsxs)($.hg,{...e,className:(0,h.cn)(e?.className,"w-full"),children:[a.jsx(C.Z,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:s?"View":"Edit"})]})})}),(0,a.jsxs)(I.Xi,{onClick:()=>c([t]),className:(0,h.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:s,children:[a.jsx(F.Z,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Delete"})]})]})]})}}],data:d.map(e=>[e.type,e.name,""])}),!s&&a.jsx(R,{disabled:s,selected:t,onDelete:()=>c(t),onCopy:()=>m(t)})]})}function A(e){let s=(0,r.useRouter)(),t=function({formData:e,scriptId:s}){let t=(0,r.useRouter)(),[a,n]=(0,i.useState)(!1),{saveDiagnoses:l}=(0,f.h)(),{alert:d}=(0,j.s)(),{viewOnly:o}=(0,y.b)(),c=(0,i.useMemo)(()=>`/script/${s}?section=diagnoses`,[s]),m=(0,i.useCallback)(()=>({version:e?.version||1,scriptId:e?.scriptId||s,diagnosisId:e?.diagnosisId||(0,u.Z)(),name:e?.name||"",description:e?.description||"",key:e?.key||"",expression:e?.expression||"",expressionMeaning:e?.expressionMeaning||"",severityOrder:e?.severityOrder||null,symptoms:e?.symptoms||[],text1:e?.text1||"",text2:e?.text2||"",text3:e?.text3||"",image1:e?.image1||null,image2:e?.image2||null,image3:e?.image3||null,preferences:e?.preferences||v.$7}),[e,s]),h=(0,p.cI)({defaultValues:m()}),{formState:{dirtyFields:x},handleSubmit:b}=h,w=(0,i.useMemo)(()=>!!Object.keys(x).length,[x]),N=b(async e=>{try{n(!0);let s={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!s.scriptId)throw Error("Diagnosis is missing script reference!");let a=(await g.Z.post("/api/diagnoses/save",{data:[s],broadcastAction:!0})).data;if(a.errors?.length)throw Error(a.errors.join(", "));t.refresh(),d({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>t.push(c)})}catch(e){d({variant:"error",message:"Failed to save draft: "+e.message})}finally{n(!1)}}),k=(0,i.useMemo)(()=>a||o,[a,o]);return{...h,formIsDirty:w,saving:a,scriptPageHref:c,disabled:k,save:N,getDefaultValues:m}}(e),{formIsDirty:w,saving:N,scriptPageHref:k,disabled:C,register:F,watch:D,setValue:$,save:I}=t,z=D("name"),S=D("key"),R=D("image1"),Z=D("image2"),P=D("image3"),_=D("preferences"),O=(0,i.useCallback)(()=>{s.push(k)},[s,k]);return(0,a.jsxs)(a.Fragment,{children:[N&&a.jsx(m.a,{overlay:!0}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"name",error:!C&&!z,children:"Name *"}),a.jsx(l.I,{...F("name",{disabled:C,required:!0}),name:"name",noRing:!1,error:!C&&!z})]}),(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"severityOrder",children:"Severity order"}),a.jsx(l.I,{...F("severityOrder",{disabled:C}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx(o._,{htmlFor:"key",error:!C&&!S,children:"Key *"}),a.jsx(l.I,{...F("key",{disabled:C,required:!0}),name:"key",noRing:!1,error:!C&&!S})]})]}),(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"description",children:"Description"}),a.jsx(l.I,{...F("description",{disabled:C}),name:"description",noRing:!1}),a.jsx(x.w,{id:"description",title:"Description",disabled:C,data:_,onSave:e=>$("preferences",e,{shouldDirty:!0})})]}),(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),a.jsx(l.I,{...F("expression",{disabled:C}),name:"expression",noRing:!1})]}),(0,a.jsxs)("div",{children:[a.jsx(o._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),a.jsx(l.I,{...F("expressionMeaning",{disabled:C}),name:"expressionMeaning",noRing:!1})]}),[["text1",R],["text2",Z],["text3",P]].map(([e,s],t)=>{let r=`image${t+1}`;return a.jsx(i.Fragment,{children:(0,a.jsxs)("div",{className:"flex gap-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(o._,{htmlFor:`imageTextFields.${t}.text`,children:["Text ",t+1]}),a.jsx(d.g,{...F(e,{disabled:C}),name:`text${t}`,noRing:!1,rows:5}),a.jsx(x.w,{id:e,title:`Text ${t+1}`,disabled:C,data:_,onSave:e=>$("preferences",e,{shouldDirty:!0})})]}),a.jsx(b.M,{disabled:C,image:s,onChange:e=>$(r,e,{shouldDirty:!0})})]})},`imageTextFields.${t}`)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[a.jsx("span",{className:(0,h.cn)("text-danger text-xs",C&&"hidden"),children:"* Required"}),a.jsx("div",{className:"flex-1"}),a.jsx(n.z,{variant:"ghost",onClick:()=>O(),children:"Cancel"}),a.jsx(n.z,{disabled:C,onClick:()=>I(),children:"Save Draft"})]}),a.jsx(c.Z,{className:"my-20"}),a.jsx("div",{children:a.jsx(T,{disabled:C,form:t})})]})}},13936:(e,s,t)=>{"use strict";t.d(s,{M:()=>k});var a=t(10326),i=t(17577),r=t(83855),n=t(47035),l=t(2165),d=t(15491),o=t(44099),c=t(90772),m=t(46670),h=t(47463),x=t(63685);/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,t(62881).Z)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var u=t(2025),g=t(77863),f=t(11870),j=t(96221);async function y(e){return new Promise((s,t)=>{let a=new Image;a.onload=function(){s({width:a.width,height:a.height})},a.onerror=function(e,s,a,i,r){t(r||Error("Failed to load image"))},a.src=e})}function v({width:e=0,height:s=0,containerWidth:t,...i}){i.sizes;let r={width:"100%",height:"auto"};if(s&&e&&t){let a=function({imageWidth:e,imageHeight:s,containerWidth:t}){return e>t&&(s=t/e*s,e=t),{imageWidth:e,imageHeight:s}}({imageWidth:e,imageHeight:s,containerWidth:t});r.width=a.imageWidth,r.height=a.imageHeight}return a.jsx("img",{...i,src:i.src,style:{...r,...i.style}})}function b({type:e,children:s,inputProps:t,fileDetails:r,onUpload:n,...d}){let[o,{width:m}]=(0,l.Z)(),[b,w]=(0,i.useState)(!1),[N,k]=(0,i.useState)([]),[C,F]=(0,i.useState)(!1),{alert:D}=(0,j.s)(),$=(0,i.useCallback)(async()=>{let e=t?.multiple?N:[N[0]];try{for(let{file:s,metadata:t,fileId:a}of(F(!0),e)){let e=new FormData;e.append("file",s),e.append("fileId",a||(0,h.Z)()),e.append("filename",s.name),e.append("contentType",s.type),e.append("size",`${s.size}`),e.append("metadata",JSON.stringify({...t})),r&&Object.keys(r).forEach(s=>{let t=r[s];e.append(s,JSON.stringify(t))}),await n(e)}w(!1),k([]),D({title:"Success",message:`File${e.length>1?"s":""} uploaded successfully!`,variant:"success"})}catch(s){D({title:"Error",message:`Failed to upload file${e.length>1?"s":""}: ${s.message}`,variant:"error"})}finally{F(!1)}},[n,D,N,t?.multiple,r]),I=(0,i.useCallback)(async e=>{try{let s=[];if(e.target.files?.length)for(let t=0;t<e.target.files.length;t++)s.push(e.target.files[t]);let t=[];for(let e of s){let s,a;let i=URL.createObjectURL(e),r={};if(`${e.type}`.includes("image"))try{let e=await y(i);r={...r,...e},s=i}catch(e){}t.push({fileId:(0,h.Z)(),file:e,url:i,imageURL:s,videoURL:a,metadata:r})}k(t)}catch(e){D({title:"Error",message:e.message})}},[D]);return(0,a.jsxs)(a.Fragment,{children:[C&&a.jsx(f.a,{overlay:!0}),a.jsx(u.u,{open:b,onOpenChange:e=>{w(e),k([])},title:"Upload file",trigger:s,...d,actions:(0,a.jsxs)(a.Fragment,{children:[!N.length&&a.jsx("div",{className:"flex-1"}),a.jsx(c.z,{variant:"ghost",onClick:()=>w(!1),children:"Cancel"}),!!N.length&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"flex-1"}),a.jsx(c.z,{variant:"destructive",onClick:()=>k([]),children:"Clear"}),(0,a.jsxs)(c.z,{disabled:!N.length,onClick:()=>$(),className:(0,g.cn)(!N.length&&"hidden"),children:[a.jsx(x.Z,{className:"h-4 w-4 mr-2"}),a.jsx("span",{children:"Upload"})]})]})]}),children:(0,a.jsxs)("div",{ref:o,children:[1===N.length&&N.map(e=>{let s=a.jsx(p,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(s=a.jsx(v,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:m,src:e.imageURL||"/images/placeholder.png"})),(0,a.jsxs)("div",{className:(0,g.cn)(`
                                        flex
                                        flex-col
                                        gap-y-2
                                        w-full
                                        items-center
                                        justify-center
                                        text-xs
                                    `,!(e.imageURL||e.videoURL)&&""),children:[s,a.jsx("span",{children:e.file.name})]},e.fileId)}),!N.length&&(0,a.jsxs)("div",{className:(0,g.cn)(`
                                    relative
                                    w-full
                                    h-36
                                    bg-primary/20
                                    flex
                                    flex-col
                                    items-center
                                    justify-center
                                    text-primary
                                    uppercase
                                    font-bold
                                    rounded-md
                                    transition-colors
                                    hover:bg-primary/30
                                `,!!N.length&&"hidden"),children:[a.jsx("div",{children:t?.placeholder||"Choose file"}),a.jsx("input",{...t,type:"file",accept:e,value:"",className:(0,g.cn)(`
                                        absolute
                                        left-0
                                        top-0
                                        w-full
                                        h-full
                                        opacity-0
                                    `),onChange:I})]})]})})]})}var w=t(62288),N=t(82617);function k({image:e,disabled:s,onChange:t}){let[h,{width:x}]=(0,l.Z)(),{confirm:p}=(0,m.t)(),{uploadFile:u}=(0,N.h)(),g=(0,i.useCallback)(async e=>{let{file:s,errors:a}=(await o.Z.post("/api/files/upload",e)).data;if(a?.length)throw Error(a.join(", "));if(s){let e=d.Z.stringify({...s.metadata});e=e?`?${e}`:"",t({data:[process.env.NEXT_PUBLIC_APP_URL,`/files/${s.fileId}${e}`].join(""),fileId:s.fileId,filename:s.filename,size:s.size,contentType:s.contentType})}},[u,t]),f=`${e?.data||""}`.split("?").filter((e,s)=>s).join(""),{width:j,height:y}=d.Z.parse(f);return a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{ref:h,className:"flex flex-col gap-y-2 min-w-60 max-w-60",children:[a.jsx("div",{className:"w-full flex flex-col items-center justify-center min-h-28",children:a.jsx(v,{alt:"",width:Number(j||"0"),height:Number(y||"0"),containerWidth:x,src:e?.data||"/images/placeholder.png"})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-x-4",children:[a.jsx(b,{type:"image/*",onUpload:g,children:a.jsx(w.hg,{asChild:!0,children:a.jsx(c.z,{size:"icon",className:"w-8 h-8 rounded-full",disabled:s,children:a.jsx(r.Z,{className:"h-4 w-4"})})})}),!!e&&a.jsx(c.z,{variant:"destructive",size:"icon",className:"w-8 h-8 rounded-full",disabled:s,onClick:()=>p(()=>t(null),{title:"Delete image",message:"Are you sure you want to delete this image?",danger:!0}),children:a.jsx(n.Z,{className:"h-4 w-4"})})]})]})})}},96948:(e,s,t)=>{"use strict";t.d(s,{Alert:()=>r});var a=t(96221),i=t(35047);function r(e){(0,i.useRouter)();let{alert:s}=(0,a.s)();return null}t(17577)},8281:(e,s,t)=>{"use strict";t.d(s,{Z:()=>l});var a=t(10326),i=t(17577),r=t(90220),n=t(77863);let l=i.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...i},l)=>a.jsx(r.f,{ref:l,decorative:t,orientation:s,className:(0,n.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...i}));l.displayName=r.f.displayName},89503:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var a=t(68570);let i=(0,a.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/(scripts)/components/diagnoses/form.tsx`),{__esModule:r,$$typeof:n}=i;i.default;let l=(0,a.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/app/(dashboard)/(scripts)/components/diagnoses/form.tsx#DiagnosisForm`)},49246:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(19510),i=t(62553);function r(){return a.jsx(i.a,{overlay:!0})}},57890:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(19510),i=t(62553);function r(){return a.jsx(i.a,{overlay:!0})}},86098:(e,s,t)=>{"use strict";t.d(s,{b:()=>l});var a=t(68570);let i=(0,a.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/components/alert.tsx`),{__esModule:r,$$typeof:n}=i;i.default;let l=(0,a.createProxy)(String.raw`/home/farai/Workbench/Neotree/neotree-editor/components/alert.tsx#Alert`)},90220:(e,s,t)=>{"use strict";t.d(s,{f:()=>o});var a=t(17577),i=t(45226),r=t(10326),n="horizontal",l=["horizontal","vertical"],d=a.forwardRef((e,s)=>{let{decorative:t,orientation:a=n,...d}=e,o=l.includes(a)?a:n;return(0,r.jsx)(i.WV.div,{"data-orientation":o,...t?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...d,ref:s})});d.displayName="Separator";var o=d}};