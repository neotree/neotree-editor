"use strict";exports.id=5576,exports.ids=[5576],exports.modules={85576:(e,a,r)=>{r.r(a),r.d(a,{$$ACTION_0:()=>S,$$ACTION_1:()=>O,$$ACTION_10:()=>B,$$ACTION_11:()=>J,$$ACTION_12:()=>Y,$$ACTION_13:()=>z,$$ACTION_14:()=>Q,$$ACTION_15:()=>ee,$$ACTION_2:()=>$,$$ACTION_3:()=>_,$$ACTION_4:()=>N,$$ACTION_5:()=>D,$$ACTION_6:()=>C,$$ACTION_7:()=>U,$$ACTION_8:()=>P,$$ACTION_9:()=>W,copyDiagnoses:()=>el,copyScreens:()=>eo,copyScripts:()=>ed,countDiagnoses:()=>K,countScreens:()=>j,countScripts:()=>G,deleteDiagnoses:()=>q,deleteScreens:()=>T,deleteScripts:()=>H,deleteScriptsItems:()=>ei,getDiagnoses:()=>L,getDiagnosis:()=>x,getScreen:()=>Z,getScreens:()=>v,getScript:()=>F,getScripts:()=>M,getScriptsKeys:()=>er,getScriptsMetadata:()=>E,getScriptsWithItems:()=>ea,listScreens:()=>A,saveDiagnoses:()=>X,saveScreens:()=>k,saveScriptDiagnoses:()=>es,saveScriptScreens:()=>et,saveScripts:()=>V,saveScriptsWithItems:()=>en});var t=r(24330);r(60166);var s=r(9576),i=r(49530),c=r(10970),n=r(927),d=r(22418),o=r(44997),l=r(57435),f=r(88317),u=r(5286),g=r(66267),p=r(44380),h=r(29712),m=r(59271),b=r(20123);let y=async(e,a)=>{let r=h.Z.create({baseURL:process.env.NEXT_PUBLIC_APP_URL});if(a){let{data:e,errors:t}=await (0,b.QF)({links:[a]});if(t?.length)throw Error(t.join(", "));if(!e[0])throw Error(`Failed to download images. Site (${a}) not found.`);r=await (0,m.U)({baseURL:a,apiKey:e[0].apiKey})}a=process.env.NEXT_PUBLIC_APP_URL;let t=e.data.split("/").filter((e,a)=>a<3).join("/"),s=[],i=!1;if(t!==a&&(0,p.jv)(t)&&e.fileId){let{errors:a,data:c}=(await r.post("/api/files/upload/from-site",{siteURL:t,fileId:e.fileId})).data;a?.length&&(s=a),c&&(e.data=c.fileURL,i=!0)}return{image:e,updated:i,errors:s}};var w=r(16916);let I=r(39566).y0.map(e=>e.value);var R=r(40618);let E=n.Sc,j=(0,t.j)("87e857cf3ff6395b6e2b0930ad3f852a82015e2f",S);async function S(...e){try{return await (0,g.isAllowed)(),await n.co(...e)}catch(e){return l.Z.error("countScreens ERROR",e.message),{errors:[e.message],data:n.W0}}}let v=(0,t.j)("4a894795d6b5cf7cc1b14b7c98dd07f683844ee4",O);async function O(...e){try{return await (0,g.isAllowed)(),await n.uK(...e)}catch(e){return l.Z.error("getScreens ERROR",e.message),{errors:[e.message],data:[]}}}let A=(0,t.j)("3aa0d4b564ff3dbb11cb61a669f66142ba12a143",$);async function $(...e){try{return await (0,g.isAllowed)(),await n.f(...e)}catch(e){return l.Z.error("listScreens ERROR",e.message),{errors:[e.message],data:[]}}}let Z=(0,t.j)("d5e73aed69146feafc514cdc1db03d07428838d3",_);async function _(...e){return await (0,g.isAllowed)(),await n.NB(...e)}let T=(0,t.j)("571731a47b0bd5f8c21bbb3918be027b7d89353a",N);async function N(...e){try{return await (0,g.isAllowed)(),await c.GH(...e)}catch(e){return l.Z.error("deleteScreens ERROR",e.message),{errors:[e.message],success:!1}}}let k=(0,t.j)("cf54aed3f76af353b32cd33448010c74826dd22f",D);async function D(...e){try{return await (0,g.isAllowed)(),await c.uD(...e)}catch(e){return l.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}let K=(0,t.j)("d9e27ef3b98ce1fa44c4ce962444115dab201438",C);async function C(...e){try{return await (0,g.isAllowed)(),await n.tW(...e)}catch(e){return l.Z.error("countDiagnoses ERROR",e.message),{errors:[e.message],data:n.GM}}}let L=(0,t.j)("088fa19297738e17a7ed36990d12307af0c86a1f",U);async function U(...e){try{return await (0,g.isAllowed)(),await n.XA(...e)}catch(e){return l.Z.error("getDiagnoses ERROR",e.message),{errors:[e.message],data:[]}}}let x=(0,t.j)("87ddbbf6cd0f1083bf65f89106c3f148043529fc",P);async function P(...e){return await (0,g.isAllowed)(),await n.Ew(...e)}let q=(0,t.j)("bb7aa47cfc098c92b59003ff9c78c51723cfc66a",W);async function W(...e){try{return await (0,g.isAllowed)(),await c.Bx(...e)}catch(e){return l.Z.error("deleteDiagnoses ERROR",e.message),{errors:[e.message],success:!1}}}let X=(0,t.j)("05e8ab2c1eb2ea66ff9bc82f207492cbd8f5533a",B);async function B(...e){try{return await (0,g.isAllowed)(),await c.Pk(...e)}catch(e){return l.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}let G=(0,t.j)("42b6ca705452858f68242195eb1f03faae894d74",J);async function J(...e){try{return await (0,g.isAllowed)(),await n.ix(...e)}catch(e){return l.Z.error("countScripts ERROR",e.message),{errors:[e.message],data:n.Zu}}}let M=(0,t.j)("6288bb4804a3de82eaace6181af69c05430b78d8",Y);async function Y(...e){try{return await (0,g.isAllowed)(),await n.Tw(...e)}catch(e){return l.Z.error("getScripts ERROR",e.message),{errors:[e.message],data:[]}}}let F=(0,t.j)("8d2e12b35a9b12947084a1f31cefeebcbace0cc1",z);async function z(...e){return await (0,g.isAllowed)(),await n.bK(...e)}let H=(0,t.j)("48cb3ad31d91b7da73f77bfa04744c1052bcfb9d",Q);async function Q(...e){try{return await (0,g.isAllowed)(),await c.Es(...e)}catch(e){return l.Z.error("deleteScripts ERROR",e.message),{errors:[e.message],success:!1}}}let V=(0,t.j)("1511c19ef4513922414003d6b9fb4bc42877a7d9",ee);async function ee(...e){try{return await (0,g.isAllowed)(),await c.Or(...e)}catch(e){return l.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}async function ea(e){let a=[],r=[],t=[];try{let s=e?.returnDraftsIfExist!==!1,i=await n.Tw({...e,returnDraftsIfExist:s});for(let e of(i.errors?.forEach(e=>r.push(e)),i.data)){let t=await n.uK({scriptsIds:[e.scriptId],returnDraftsIfExist:s}),i=await n.XA({scriptsIds:[e.scriptId],returnDraftsIfExist:s}),c=await n.pd({scriptsIds:[e.scriptId],returnDraftsIfExist:s});t.errors?.forEach(e=>r.push(e)),i.errors?.forEach(e=>r.push(e)),a.push({...e,screens:t.data,diagnoses:i.data,drugsLibrary:c.data})}let{keys:c}=function({screens:e,diagnoses:a,drugsLibrary:r}){let t=[],s=e.map(e=>{let a={uniqueKey:"",name:e.key||"",label:e.label||"",refId:e.refId||"",dataType:e.type,children:[]};return I.filter(e=>!e.includes("edliz")).includes(a.dataType)&&(a.label=a.label||e.title,a.name=a.name||a.label),["diagnosis","checklist"].includes(e.type)&&(a.dataType=`${e.type}_screen`),e.items.forEach(r=>{let t=`${e.type}_option`;"diagnosis"===e.type&&(t=e.type);let s={uniqueKey:"",name:r.key||r.id||"",label:r.label||"",dataType:t,children:[]};a.children.push(s)}),e.fields.forEach(e=>{a.children.push({uniqueKey:"",name:e.key||"",label:e.label||"",dataType:e.type,children:(e.items||[]).map(a=>({uniqueKey:"",name:a.value||"",label:a.label||"",children:[],dataType:`${e.type}_option`}))})}),t.push(a),{screenId:e.screenId,key:a}}),i=a.map(e=>{let a={uniqueKey:"",name:e.key||e.name||"",label:e.name||"",dataType:"diagnosis",children:[]};return(e.symptoms||[]).forEach(e=>{a.children.push({uniqueKey:"",name:e.name||"",label:"",dataType:`diagnosis_symptom_${e.type}`,children:[]})}),t.push(a),{screenId:e.diagnosisId,key:a}}),c=r.map(e=>{let a={uniqueKey:"",name:e.key||"",label:e.drug||"",dataType:e.type,children:[]};return t.push(a),{screenId:e.itemId,key:a}});return{keys:t,screensKeys:s,diagnosesKeys:i,drugsLibraryKeys:c}}({screens:a.reduce((e,a)=>[...e,...a.screens],[]),diagnoses:a.reduce((e,a)=>[...e,...a.diagnoses],[]),drugsLibrary:a.reduce((e,a)=>[...e,...a.drugsLibrary],[])});if(c.length&&(t=(await w.aW({names:c.map(e=>e.name)}))?.data||[]),r.length)return{errors:r,data:[],dataKeys:t};return{data:a,dataKeys:t}}catch(e){return l.Z.error("getScriptsWithItems ERROR",e.message),{data:[],dataKeys:t,errors:[e.message]}}}async function er(e){let{errors:a,data:r}=await ea(e);return{errors:a,data:r.map(e=>{let a=[];return e.screens.forEach(e=>{e.fields?.forEach?.(e=>{if(e.key){let r=e.key;a.push({key:r,label:e.label||r})}}),e.items?.forEach?.(e=>{if(e.key){let r=e.id||e.key;a.push({key:r,label:e.label||r})}}),e.key&&a.push({key:e.key,label:e.label||e.key})}),a=a.filter((e,r)=>a.map(e=>JSON.stringify(e)).indexOf(JSON.stringify(e))===r),{title:e.title,hospitalId:e.hospitalId,hospitalName:e.hospitalName,keys:a}})}}async function et({screens:e,scriptId:a,preserveScreensIds:r}){try{let t=0,i=[],c=await n.bK({scriptId:a,returnDraftIfExists:!0});if(c.errors?.length)throw Error(c.errors.join(", "));if(!c.data)throw Error("Script not found");for(let n of e){let{id:e,publishDate:d,createdAt:o,updatedAt:f,isDraft:u,deletedAt:g,version:p,oldScriptId:h,oldScreenId:m,screenId:b,scriptId:w,position:I,...R}=n,E=(0,s.Z)();r&&b&&(E=b);try{if(R.image1){let e=await y(R.image1);R.image1=e.image}if(R.image2){let e=await y(R.image2);R.image2=e.image}if(R.image3){let e=await y(R.image3);R.image3=e.image}}catch(e){l.Z.error("process image",e.message)}let j=await k({data:[{...R,scriptId:a,oldScriptId:c.data.oldScriptId,screenId:E,version:1}]});j.errors?.forEach(e=>i.push(`(screenId=${b}) ${e||""}`)),!j.errors?.length&&t++}if(i.length)return{errors:i,saved:t,success:!1};return{saved:t,success:!0}}catch(e){return l.Z.error("saveScriptScreens ERROR",e.message),{saved:0,success:!1,errors:[e.message]}}}async function es({diagnoses:e,scriptId:a,preserveDiagnosesIds:r}){try{let t=0,i=[],c=await n.bK({scriptId:a,returnDraftIfExists:!0});if(c.errors?.length)throw Error(c.errors.join(", "));if(!c.data)throw Error("Script not found");for(let n of e){let{id:e,publishDate:d,createdAt:o,updatedAt:f,isDraft:u,deletedAt:g,version:p,oldDiagnosisId:h,diagnosisId:m,scriptId:b,position:w,...I}=n,R=(0,s.Z)();r&&m&&(R=m);try{if(I.image1){let e=await y(I.image1);I.image1=e.image}if(I.image2){let e=await y(I.image2);I.image2=e.image}if(I.image3){let e=await y(I.image3);I.image3=e.image}}catch(e){l.Z.error("process image",e.message)}let E=await X({data:[{...I,scriptId:a,oldScriptId:c.data.oldScriptId,diagnosisId:R,version:1}]});E.errors?.forEach(e=>i.push(`(diagnosisId=${m}) ${e||""}`)),!E.errors?.length&&t++}if(i.length)return{errors:i,saved:t,success:!1};return{saved:t,success:!0}}catch(e){return l.Z.error("saveScriptDiagnoses ERROR",e.message),{saved:0,success:!1,errors:[e.message]}}}async function ei({scriptsIds:e}){try{let a=[],r=await T({scriptsIds:e});r.errors?.forEach(e=>a.push(e));let t=await q({scriptsIds:e});if(t.errors?.forEach(e=>a.push(e)),a.length)return{errors:a,success:!1};return{success:!0}}catch(e){return l.Z.error("deleteScriptsItems ERROR",e.message),{success:!1,errors:[e.message]}}}let ec={scripts:0,screens:0,diagnoses:0,drugsLibrary:0};async function en({data:e,dataKeys:a}){let r={...ec};try{let t=[];for(let{overWriteScriptWithId:a,...i}of e){let e=a?await F({scriptId:a,returnDraftIfExists:!0}):{data:null};if(e.errors?.forEach(e=>t.push(e)),t.length)continue;if(a&&!e?.data){t.push("Overwrite script was not found");continue}if(e?.data){let a=await ei({scriptsIds:[e.data.scriptId]});if(a.errors?.forEach(e=>t.push(e)),t.length)continue}let{id:c,screens:n=[],diagnoses:o=[],drugsLibrary:l=[],publishDate:f,createdAt:u,updatedAt:g,isDraft:p,deletedAt:h,version:m,oldScriptId:b,scriptId:y,position:w,printSections:I=[],reviewConfigurations:R=[],...E}=i,j={},S={},v=n.map(e=>{let a=(0,s.Z)();return j[e.screenId]=a,e.oldScreenId&&(j[e.oldScreenId]=a),{...e,screenId:a}});v=v.map(e=>({...e,skipToScreenId:(e.skipToScreenId?j[e.skipToScreenId]:null)||null}));let O=o.map(e=>{let a=(0,s.Z)();return S[e.diagnosisId]=a,e.oldDiagnosisId&&(S[e.oldDiagnosisId]=a),{...e,diagnosisId:a}}),A=e?.data?.scriptId||(0,s.Z)(),$=await V({data:[{...E,scriptId:A,version:1,printSections:I.map(e=>({...e,screensIds:e.screensIds.map(e=>j[e]).filter(e=>e)})),reviewConfigurations:R.map(e=>({...e,screen:j[e.screen]})).filter(e=>e.screen)}]});if($.errors?.forEach(e=>t.push(e)),t.length)continue;r.scripts++;let Z=await et({preserveScreensIds:!0,scriptId:A,screens:v});r.screens+=Z.saved;let _=await es({preserveDiagnosesIds:!0,scriptId:A,diagnoses:O});r.diagnoses+=_.saved,l.length&&(await d.cj({data:l.map(e=>({...e,itemId:(0,s.Z)(),createdAt:void 0,updatedAt:void 0,deletedAt:void 0,publishDate:void 0,id:void 0,position:void 0}))}),r.drugsLibrary+=l.length)}if(a.length&&await (0,o.Jv)({data:a}),t.length)return{success:!1,errors:t,info:r};return{success:!0,info:r}}catch(e){return l.Z.error("saveScriptsWithItems ERROR",e.message),{success:!1,errors:[e.message],info:r}}}async function ed(e){let a={...ec},{scriptsIds:r=[],confirmCopyAll:t,toRemoteSiteId:s,fromRemoteSiteId:c,broadcastAction:n,overWriteScriptWithId:d}={...e};try{if(!r.length&&!t)throw Error("You&apos;re about copy all the scripts, please confirm this action!");let e=c?{data:[],dataKeys:[]}:await ea({scriptsIds:r});if(e.errors)return{success:!1,errors:e.errors,info:a};if(c){let t=await (0,u.U)(c),s=await t.get("/api/scripts/with-items?"+i.Z.stringify({scriptsIds:JSON.stringify(r)})),n=s.data;if(n.errors)return{success:!1,errors:n.errors,info:a};e=n,console.log("axiosClient",s.config.baseURL),e.data.forEach(({screens:a,diagnoses:r},t)=>{let i=e=>{let a=s.config.baseURL||"";return"/"===a.substring(a.length-1,a.length)&&(a=a.substring(0,a.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[a,e].filter(e=>e).join("/")};a.forEach((a,r)=>{a.image1?.data&&a.image1?.fileId&&!(0,p.jv)(a.image1.data)&&(e.data[t].screens[r].image1.data=i(a.image1.data)),a.image2?.data&&a.image2?.fileId&&!(0,p.jv)(a.image2.data)&&(e.data[t].screens[r].image2.data=i(a.image2.data)),a.image3?.data&&a.image3?.fileId&&!(0,p.jv)(a.image3.data)&&(e.data[t].screens[r].image3.data=i(a.image3.data))}),r.forEach((a,r)=>{a.image1?.data&&a.image1?.fileId&&!(0,p.jv)(a.image1.data)&&(e.data[t].diagnoses[r].image1.data=i(a.image1.data)),a.image2?.data&&a.image2?.fileId&&!(0,p.jv)(a.image2.data)&&(e.data[t].diagnoses[r].image2.data=i(a.image2.data)),a.image3?.data&&a.image3?.fileId&&!(0,p.jv)(a.image3.data)&&(e.data[t].diagnoses[r].image3.data=i(a.image3.data))})})}let o={success:!0,info:a};if(e.data.length){if(s){let a=await (0,u.U)(s);o=(await a.post("/api/scripts/with-items?",{data:e.data.map(e=>({...e,hospitalId:void 0,hospitalName:void 0}))})).data}else o=await en({dataKeys:e.dataKeys,data:e.data.map(e=>({...e,overWriteScriptWithId:d,hospitalId:void 0,hospitalName:void 0}))})}return n&&!o?.errors?.length&&f.Z.emit("data_changed","copy_scripts"),o}catch(e){return l.Z.error("copyScripts ERROR",e.response?.data?.errors?.join(", ")||e.message),{errors:e.response?.data?.errors||[e.message],success:!1,info:a}}}async function eo(e){let a=0,{screensIds:r=[],fromScriptsIds:t=[],toScriptsIds:s=[],confirmCopyAll:i,broadcastAction:c}={...e};try{let e=[];if(!t.length&&!r.length&&!i)throw Error("You&apos;re about to copy all the screens, please confirm this action!");let d=await n.uK({scriptsIds:t,screensIds:r,returnDraftsIfExist:!0});if(d.errors?.length)throw Error(d.errors.join(", "));if(s.length)for(let r of s){let t=await et({scriptId:r,screens:d.data});t.errors?.forEach(a=>e.push(a)),!e.length&&a++}else{let r=d.data.reduce((e,a)=>({...e,[a.scriptId]:[...e[a.scriptId]||[],a]}),{});for(let t of Object.keys(r)){let s=await et({scriptId:t,screens:r[t]});s.errors?.forEach(a=>e.push(a)),e.length||(a+=s.saved)}}return c&&!e.length&&f.Z.emit("data_changed","copy_scripts"),{copied:a,success:!e.length,errors:e.length?e:void 0}}catch(e){return l.Z.error("copyScreens ERROR",e.message),{errors:[e.message],success:!1,copied:a}}}async function el(e){let a=0,{diagnosesIds:r=[],fromScriptsIds:t=[],toScriptsIds:s=[],confirmCopyAll:i,broadcastAction:c}={...e};try{let e=[];if(!t.length&&!r.length&&!i)throw Error("You&apos;re about to copy all the diagnoses, please confirm this action!");let d=await n.XA({scriptsIds:t,diagnosesIds:r,returnDraftsIfExist:!0});if(d.errors?.length)throw Error(d.errors.join(", "));if(s.length)for(let r of s){let t=await es({scriptId:r,diagnoses:d.data});t.errors?.forEach(a=>e.push(a)),!e.length&&a++}else{let r=d.data.reduce((e,a)=>({...e,[a.scriptId]:[...e[a.scriptId]||[],a]}),{});for(let t of Object.keys(r)){let s=await es({scriptId:t,diagnoses:r[t]});s.errors?.forEach(a=>e.push(a)),e.length||(a+=s.saved)}}return c&&!e.length&&f.Z.emit("data_changed","copy_scripts"),{copied:a,success:!e.length,errors:e.length?e:void 0}}catch(e){return l.Z.error("copyDiagnoses ERROR",e.message),{errors:[e.message],success:!1,copied:a}}}(0,R.h)([E,j,v,A,Z,T,k,K,L,x,q,X,G,M,F,H,V,ea,er,et,es,ei,en,ed,eo,el]),(0,t.j)("99af8c523cb129f7e27f77c5b13c3f95db4aa48b",E),(0,t.j)("d3dfb05b6962621e399227ba261983f9495fb5a5",j),(0,t.j)("d3ac4d264976b14d511e92b98e57e5020674ccae",v),(0,t.j)("44cb4379b90fc45300db3daa2b58f5659b2229fd",A),(0,t.j)("a5f91b7007fbfa597dab1634587268a6df569273",Z),(0,t.j)("a7ca28e7614edaf2e6b5ccee56d7164c19c41000",T),(0,t.j)("ecc69ba9880b93912552464ca23f9c9f62aa03a7",k),(0,t.j)("0e38be4b50836504c7f67b93fb7ae3cf5f2e9c22",K),(0,t.j)("3b62f127aaaccc86f5c11a9cee428c085206a5bb",L),(0,t.j)("28f338ad272f084dccac4a17a825071030625cf4",x),(0,t.j)("41bf61e6499b298b6d973285db88ca8adb7ea40a",q),(0,t.j)("baaaf52a0b382f1efd6d584fc61203bd8b88d2b3",X),(0,t.j)("c423e270d97a3bdc414a4b6af94f0da37244d751",G),(0,t.j)("6e6440b75e5eca1d3f2e9eea168a2def1055ff65",M),(0,t.j)("81d6ee191490d4c72c2a4fbc7ff2d66823517be9",F),(0,t.j)("6d5f825048092bdc85e12871d189e55584a9bd66",H),(0,t.j)("947e034f370ce58f143d0f5b4bdc00d9d653e029",V),(0,t.j)("797262d27036c70ce881164328adcd6c008a8872",ea),(0,t.j)("fffc9e530901341fa16098dcbb72fbf420b43c4e",er),(0,t.j)("02daafb4339f92c64aab36b56610977e13635f0f",et),(0,t.j)("e95ca417790d107bc4d49b348f1c83b1955f0c9a",es),(0,t.j)("df94185aaee131de90c17c7b082714e1f780f1c1",ei),(0,t.j)("40e010843f3a8ebeab26c3e97be909c476c8560a",en),(0,t.j)("d85d59b51ce7aeff48d5f7157a5de30f048c58ef",ed),(0,t.j)("09a000ab8c4a9178389156b1588727a549373f45",eo),(0,t.j)("4d3829ca121a05e07de85632383e564f5826b579",el)},59271:(e,a,r)=>{r.d(a,{U:()=>s});var t=r(29712);async function s(e){let a=e.baseURL,r=e.apiKey;if(!a)throw Error("MISSING: link");if(!r)throw Error("MISSING: apiKey");let s=t.Z.create({baseURL:a});return s.interceptors.request.use(async e=>(e.headers&&(e.headers["x-api-key"]=r),e)),s.interceptors.response.use(e=>e,e=>new Promise((a,r)=>r(e))),s}},44380:(e,a,r)=>{function t(e=""){let a=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===a.substring(a.length-1,a.length)&&(a=a.substring(0,a.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[a,e].filter(e=>e).join("/")}function s(e=""){try{return new URL(e),!0}catch(e){return!1}}r.d(a,{TI:()=>t,jv:()=>s})}};