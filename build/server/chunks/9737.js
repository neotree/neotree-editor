"use strict";exports.id=9737,exports.ids=[9737],exports.modules={69088:(e,s,l)=>{l.d(s,{d:()=>b});var t=l(10326),a=l(17577),i=l(35047),r=l(74723),d=l(44099),n=l(34474),c=l(62288),o=l(53313),h=l(96221),m=l(82617),f=l(90772),p=l(11870),u=l(31048),x=l(18048),g=l(54432),y=l(77863),v=l(37340),j=l(63148);let w=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b({open:e,overWriteScriptWithId:s,onOpenChange:l,onImportSuccess:b}){let I=(0,i.useRouter)(),k=(0,i.useParams)();s=s||k.scriptId;let{copyScripts:C}=(0,m.h)(),{alert:_}=(0,h.s)(),[V,N]=(0,a.useState)(!1),{sites:L,loading:S}=(0,v.k)({onLoadSitesError:()=>l(!1)}),$=S||V,{formState:{errors:D},reset:E,watch:F,setValue:T,register:z,handleSubmit:R}=(0,r.cI)({defaultValues:w(s)}),P=F("confirmed"),O=F("overwriteDataKeys"),A=F("overwriteDrugsLibraryItems"),K=R(async e=>{try{if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(s&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");N(!0);let t=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:s,broadcastAction:!0})).data;if(t.errors?.length)throw Error(t.errors.join(", "));I.refresh(),_({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{b?.(),E(w(s)),l(!1)}})}catch(e){_({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{N(!1)}});return(0,t.jsxs)(t.Fragment,{children:[$&&t.jsx(p.a,{overlay:!0}),t.jsx(x.u,{open:e,onOpenChange:()=>{l(!1),E(w(s))},title:"Import script",actions:(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{className:"text-xs text-danger",children:"* Required"}),t.jsx("div",{className:"flex-1"}),t.jsx(c.GG,{asChild:!0,children:t.jsx(f.z,{variant:"ghost",disabled:$,onClick:()=>l(!1),children:"Cancel"})}),t.jsx(f.z,{onClick:()=>K(),disabled:$,children:"Import"})]}),children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-5",children:[t.jsx(j._,{children:(0,t.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",t.jsx("b",{children:"will be appended"})," to the library"]})}),(0,t.jsxs)("div",{children:[t.jsx(u._,{htmlFor:"siteId",children:"Site *"}),(0,t.jsxs)(n.Ph,{name:"siteId",disabled:$,onValueChange:e=>T("siteId",e,{shouldDirty:!0}),children:[t.jsx(n.i4,{children:t.jsx(n.ki,{placeholder:"Select site"})}),t.jsx(n.Bw,{children:(0,t.jsxs)(n.DI,{children:[t.jsx(n.n5,{children:"Sites"}),L.map(({siteId:e,name:s})=>t.jsx(n.Ql,{value:e,children:s},e))]})})]}),!!D.siteId?.message&&t.jsx("div",{className:"text-xs text-danger mt-1",children:D.siteId.message})]}),(0,t.jsxs)("div",{children:[t.jsx(u._,{htmlFor:"scriptId",children:"Script ID *"}),t.jsx(g.I,{...z("scriptId",{disabled:$,required:!0}),name:"scriptId"}),!!D.scriptId?.message&&t.jsx("div",{className:"text-xs text-danger mt-1",children:D.scriptId.message})]}),(0,t.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[t.jsx(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:$,checked:O,onCheckedChange:()=>T("overwriteDataKeys",!O,{shouldDirty:!0})}),t.jsx(u._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,t.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[t.jsx(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:$,checked:A,onCheckedChange:()=>T("overwriteDrugsLibraryItems",!A,{shouldDirty:!0})}),t.jsx(u._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,t.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!s&&"hidden"),children:[t.jsx(o.X,{name:"confirmed",id:"confirmed",disabled:$,checked:P,onCheckedChange:()=>T("confirmed",!P,{shouldDirty:!0})}),t.jsx(u._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},89544:(e,s,l)=>{l.d(s,{f:()=>_});var t=l(10326),a=l(11870),i=l(37792),r=l(34474),d=l(30794),n=l(17577),c=l(94019),o=l(44099),h=l(77863),m=l(61198),f=l(54432),p=l(31048),u=l(33071),x=l(90772),g=l(18048),y=l(79131),v=l(68232),j=l(62288),w=l(96221),b=l(46670);function I({scriptsSearchResults:e=[]}){let s=[];return e.forEach(e=>{s.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:""}))}),e.diagnoses.forEach(l=>{s.push({type:"diagnosis",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.diagnosisId,matches:l.matches.map(e=>({...e,newValue:""}))})}),e.screens.forEach(l=>{s.push({type:"screen",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.screenId,matches:l.matches.map(e=>({...e,newValue:""}))})})}),s.filter(e=>!!e.matches.length)}let k=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function C(e){let{searchValue:s="",scriptsSearchResults:l=[]}=e,[i,d]=(0,n.useState)(!1),[C,_]=(0,n.useState)(k[0].value),[V,N]=(0,n.useState)(function(e=""){return e.replace(/\"(.*?)\"/,"$1")}(s)),[L,S]=(0,n.useState)([]),[$,D]=(0,n.useState)(""),E=(0,m.N)($),F=(0,n.useRef)(E),{confirm:T}=(0,b.t)(),{alert:z}=(0,w.s)(),R=(0,n.useCallback)(()=>{_(k[0].value),N(V),S(I(e)),D(""),F.current=""},[e]),P=!L.length||!$,O=(0,n.useCallback)(s=>{F.current="",_(s),S(I(e).filter(e=>{switch(s){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[C,e]),A=(0,n.useCallback)(async()=>{try{d(!0);let e=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:L.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,s)=>({...e,[s.field]:s.newValue}),{})})),screens:L.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,s)=>{let l=e._fields||[],t=e._items||[];if(void 0===s.fieldIndex)e[s.field]=s.newValue;else if(s.field.includes("field_item_")){let e=l.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=l.length),l[e]={index:s.fieldIndex,data:{...l[e],[s.field.substring(11)]:s.newValue}}}else{let e=t.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=t.length),t[e]={index:s.fieldIndex,data:{...t[e],[s.field.substring(5)]:s.newValue}}}return{...e,_fields:l,_items:t}},{})}})),diagnoses:L.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,s)=>{let l=e._fields||[];if(void 0===s.fieldIndex)e[s.field]=s.newValue;else{let e=l.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=l.length),l[e]={index:s.fieldIndex,data:{...l[e],[s.field]:s.newValue}}}return{...e,_fields:l}},{})}}))})).data;e.errors?z({title:"Error",message:e.errors.join(", "),variant:"error"}):z({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){z({title:"Error",message:e.message,variant:"error"})}finally{d(!1)}},[L]);return t.jsx(t.Fragment,{children:t.jsx(g.u,{onOpenChange:()=>{R()},title:(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,t.jsxs)("div",{children:[t.jsx(p._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),t.jsx(f.I,{disabled:!0,name:"searchValue",value:V,onChange:e=>N(e.target.value)})]}),(0,t.jsxs)("div",{children:[t.jsx(p._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),t.jsx(f.I,{name:"replaceWith",value:$,onChange:e=>D(e.target.value)})]})]}),t.jsx("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:(0,t.jsxs)("div",{children:[t.jsx(p._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),t.jsx("div",{className:"w-[120px]",children:(0,t.jsxs)(r.Ph,{value:C,onValueChange:O,children:[t.jsx(r.i4,{children:t.jsx(r.ki,{placeholder:"All matches"})}),t.jsx(r.Bw,{children:k.map(e=>t.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})})]})})]}),trigger:t.jsx(j.hg,{asChild:!0,children:t.jsx(x.z,{children:"Replace"})}),actions:(0,t.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[t.jsx(j.GG,{asChild:!0,children:t.jsx(x.z,{variant:"ghost",children:"Cancel"})}),t.jsx(x.z,{disabled:P,onClick:()=>T(A,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-6",children:[!L.length&&t.jsx("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),L.map(e=>(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[i&&t.jsx(a.a,{overlay:!0,transparent:!0}),(0,t.jsxs)("div",{className:"text-sm",children:[e.parent?(0,t.jsxs)("div",{children:[(0,t.jsxs)("b",{children:[(0,y.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,t.jsxs)("div",{children:[(0,t.jsxs)("b",{children:[(0,y.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((s,l)=>{let a=e.id+`_match${l}`;return t.jsx(u.Zb,{children:(0,t.jsxs)(u.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,t.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[t.jsx("div",{children:(0,t.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[s.field,"number"==typeof s.fieldIndex&&(0,t.jsxs)(t.Fragment,{children:["\xa0(",t.jsx("b",{children:"position"})," = ",s.fieldIndex+1,")"]})]})}),t.jsx("code",{className:(0,h.cn)("block",s.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:s.fieldValue.replaceAll(V,`<mark>${V}</mark>`)}}),s.newValue&&t.jsx("code",{className:(0,h.cn)("block",$&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:s.newValue.replaceAll(E,`<mark>${E}</mark>`)}})]}),t.jsx("div",{children:t.jsx(v.pn,{delayDuration:0,children:(0,t.jsxs)(v.u,{children:[t.jsx(v.aJ,{children:t.jsx(x.z,{variant:"ghost",onClick:()=>S(e=>e.filter((e,s)=>s!==l)),children:t.jsx(c.Z,{className:"size-4"})})}),t.jsx(v._v,{children:"Remove"})]})})})]})},a)})]},e.id))]})})})}function _({search:e,setSearch:s,onSearch:l}){return(0,t.jsxs)(t.Fragment,{children:[e.searching&&t.jsx(a.a,{overlay:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(i.M,{placeholder:"Search",onSearch:l})}),!!e.value&&t.jsx("div",{className:"w-[120px]",children:(0,t.jsxs)(r.Ph,{value:e.filter,onValueChange:e=>s(s=>({...s,filter:e,results:(0,d._n)({results:s.unfilteredResults,filter:e,searchValue:s.value})})),children:[t.jsx(r.i4,{children:t.jsx(r.ki,{placeholder:"All matches"})}),t.jsx(r.Bw,{children:d.Hc.map(e=>t.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!e.results?.length&&t.jsx(t.Fragment,{children:t.jsx(C,{searchValue:e.value,scriptsSearchResults:e.results})})]})]})}},37792:(e,s,l)=>{l.d(s,{M:()=>r});var t=l(10326),a=l(17577),i=l(77863);let r=(0,a.forwardRef)(({searchButton:e,hideSearchButton:s,onSearch:l,...r},d)=>{let[n,c]=(0,a.useState)("");return t.jsx("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),l?.(n)},children:(0,t.jsxs)("div",{className:(0,i.cn)("flex w-full"),children:[t.jsx("div",{className:(0,i.cn)("relative w-full"),children:t.jsx("input",{ref:d,type:"search",placeholder:"Search",value:n,...r,onChange:e=>{let s=e.target.value;c(s),r.onChange?.(e),s||l?.(s)},className:(0,i.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",r.className)})}),!s&&t.jsx("button",{type:"submit",className:(0,i.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",e?.className),...e,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},68232:(e,s,l)=>{l.d(s,{_v:()=>o,aJ:()=>c,pn:()=>d,u:()=>n});var t=l(10326),a=l(17577),i=l(39313),r=l(77863);let d=i.zt,n=i.fC,c=i.xz,o=a.forwardRef(({className:e,sideOffset:s=4,...l},a)=>t.jsx(i.VY,{ref:a,sideOffset:s,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...l}));o.displayName=i.VY.displayName},37340:(e,s,l)=>{l.d(s,{k:()=>d});var t=l(17577),a=l(44099),i=l(3529),r=l(96221);function d(e){let{loadOnMount:s=!0,onLoadSitesError:l}={...e},[d,n]=(0,t.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,i.b)(),[h,m]=(0,t.useState)([]);return{loading:d,sites:h,loadSites:(0,t.useCallback)(async()=>{try{n(!0);let e=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(e.errors?.length)throw Error(e.errors.join(", "));m(e.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>l?.()})}finally{n(!1)}},[o,c,l])}}},30794:(e,s,l)=>{l.d(s,{GB:()=>a,Hc:()=>i,_n:()=>d});var t=l(11877);function a({searchValue:e,scripts:s,screens:l,diagnoses:a}){let{normalizedValue:i,isExactMatch:r}=(0,t.l)(e);if(!i)return[];let d=(0,t.y)(i),n=new RegExp(r?`^${d}$`:d),c={};return s.forEach(e=>{let s=[];`${e.title||""}`.toLowerCase().match(n)&&s.push({field:"title",fieldValue:e.title}),`${e.printTitle||""}`.toLowerCase().match(n)&&s.push({field:"printTitle",fieldValue:e.printTitle}),s.length&&(c[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:s})}),l.forEach(e=>{let s=[];`${e.title||""}`.toLowerCase().match(n)&&s.push({field:"title",fieldValue:e.title}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"key",fieldValue:e.key}),`${e.refId||""}`.toLowerCase().match(n)&&s.push({field:"refId",fieldValue:`${e.refId||""}`}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"label",fieldValue:e.label}),`${e.sectionTitle||""}`.toLowerCase().match(n)&&s.push({field:"sectionTitle",fieldValue:e.sectionTitle}),`${e.previewTitle||""}`.toLowerCase().match(n)&&s.push({field:"previewTitle",fieldValue:e.previewTitle}),`${e.previewPrintTitle||""}`.toLowerCase().match(n)&&s.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),`${e.condition||""}`.toLowerCase().match(n)&&s.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"field_key",fieldIndex:l,fieldValue:e.key}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"field_label",fieldIndex:l,fieldValue:e.label}),`${e.condition||""}`.toLowerCase().match(n)&&s.push({field:"field_condition",fieldIndex:l,fieldValue:e.condition}),(e.items||[]).map((e,t)=>{`${e.value||""}`.toLowerCase().match(n)&&s.push({field:"field_item_key",fieldIndex:l,fieldItemIndex:t,fieldValue:e.value}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"field_item_label",fieldIndex:l,fieldItemIndex:t,fieldValue:e.label})})}),(e.items||[]).map((e,l)=>{`${e.id||""}`.toLowerCase().match(n)&&s.push({field:"item_id",fieldIndex:l,fieldValue:e.id}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"item_key",fieldIndex:l,fieldValue:e.key}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"item_label",fieldIndex:l,fieldValue:e.label})}),(e.drugs||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"drug",fieldIndex:l,fieldValue:e.key})}),(e.fluids||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"fluid",fieldIndex:l,fieldValue:e.key})}),(e.feeds||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"feed",fieldIndex:l,fieldValue:e.key})}),s.length&&(c[e.scriptId]=c[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},c[e.scriptId].title=c[e.scriptId].title||e.scriptTitle,c[e.scriptId].screens.push({title:e.title,matches:s,screenId:e.screenId,isDraft:e.isDraft,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),a.forEach(e=>{let s=[];`${e.name||""}`.toLowerCase().match(n)&&s.push({field:"name",fieldValue:e.name}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"key",fieldValue:e.key}),`${e.expression||""}`.toLowerCase().match(n)&&s.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_key",fieldIndex:l,fieldValue:e.key}),`${e.name||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_name",fieldIndex:l,fieldValue:e.name}),`${e.expression||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_expression",fieldIndex:l,fieldValue:e.expression})}),s.length&&(c[e.scriptId]=c[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},c[e.scriptId].title=c[e.scriptId].title||e.scriptTitle,c[e.scriptId].diagnoses.push({title:e.name||"",matches:s,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(c)}let i=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function d({searchValue:e,filter:s,results:l}){if("all"===s)return l;let t=e=>r[e.field]===s;return l.map(e=>s?{...e,matches:e.matches.filter(e=>t(e)),screens:e.screens.filter(e=>e.matches.find(e=>t(e))).map(e=>({...e,matches:e.matches.filter(e=>t(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>t(e))).map(e=>({...e,matches:e.matches.filter(e=>t(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}};