"use strict";exports.id=9737,exports.ids=[9737],exports.modules={69088:(e,l,i)=>{i.d(l,{d:()=>I});var a=i(10326),s=i(17577),t=i(35047),r=i(74723),d=i(94464),n=i(34474),c=i(62288),o=i(53313),m=i(96221),h=i(82617),u=i(90772),f=i(11870),p=i(31048),x=i(18048),y=i(54432),g=i(77863),v=i(37340),b=i(63148);let j=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function I({open:e,overWriteScriptWithId:l,onOpenChange:i,onImportSuccess:I}){let _=(0,t.useRouter)(),w=(0,t.useParams)();l=l||w.scriptId;let{copyScripts:k}=(0,h.h)(),{alert:V}=(0,m.s)(),[N,C]=(0,s.useState)(!1),{sites:S,loading:$}=(0,v.k)({onLoadSitesError:()=>i(!1)}),D=$||N,{formState:{errors:E},reset:F,watch:L,setValue:T,register:R,handleSubmit:P}=(0,r.cI)({defaultValues:j(l)}),z=L("confirmed"),M=L("overwriteDataKeys"),O=L("overwriteDrugsLibraryItems"),A=P(async e=>{try{if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(l&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");C(!0);let a=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:l,broadcastAction:!0})).data;if(a.errors?.length)throw Error(a.errors.join(", "));_.refresh(),V({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{I?.(),F(j(l)),i(!1)}})}catch(e){V({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{C(!1)}});return(0,a.jsxs)(a.Fragment,{children:[D&&a.jsx(f.a,{overlay:!0}),a.jsx(x.u,{open:e,onOpenChange:()=>{i(!1),F(j(l))},title:"Import script",actions:(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{className:"text-xs text-danger",children:"* Required"}),a.jsx("div",{className:"flex-1"}),a.jsx(c.GG,{asChild:!0,children:a.jsx(u.z,{variant:"ghost",disabled:D,onClick:()=>i(!1),children:"Cancel"})}),a.jsx(u.z,{onClick:()=>A(),disabled:D,children:"Import"})]}),children:(0,a.jsxs)("div",{className:"flex flex-col gap-y-5",children:[a.jsx(b._,{children:(0,a.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",a.jsx("b",{children:"will be appended"})," to the library"]})}),(0,a.jsxs)("div",{children:[a.jsx(p._,{htmlFor:"siteId",children:"Site *"}),(0,a.jsxs)(n.Ph,{name:"siteId",disabled:D,onValueChange:e=>T("siteId",e,{shouldDirty:!0}),children:[a.jsx(n.i4,{children:a.jsx(n.ki,{placeholder:"Select site"})}),a.jsx(n.Bw,{children:(0,a.jsxs)(n.DI,{children:[a.jsx(n.n5,{children:"Sites"}),S.map(({siteId:e,name:l})=>a.jsx(n.Ql,{value:e,children:l},e))]})})]}),!!E.siteId?.message&&a.jsx("div",{className:"text-xs text-danger mt-1",children:E.siteId.message})]}),(0,a.jsxs)("div",{children:[a.jsx(p._,{htmlFor:"scriptId",children:"Script ID *"}),a.jsx(y.I,{...R("scriptId",{disabled:D,required:!0}),name:"scriptId"}),!!E.scriptId?.message&&a.jsx("div",{className:"text-xs text-danger mt-1",children:E.scriptId.message})]}),(0,a.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[a.jsx(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:D,checked:M,onCheckedChange:()=>T("overwriteDataKeys",!M,{shouldDirty:!0})}),a.jsx(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,a.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[a.jsx(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:D,checked:O,onCheckedChange:()=>T("overwriteDrugsLibraryItems",!O,{shouldDirty:!0})}),a.jsx(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,a.jsxs)("div",{className:(0,g.cn)("flex gap-x-2",!l&&"hidden"),children:[a.jsx(o.X,{name:"confirmed",id:"confirmed",disabled:D,checked:z,onCheckedChange:()=>T("confirmed",!z,{shouldDirty:!0})}),a.jsx(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},89544:(e,l,i)=>{i.d(l,{f:()=>S});var a=i(10326),s=i(11870),t=i(37792),r=i(34474),d=i(30794),n=i(17577),c=i(94019),o=i(94464),m=i(77863),h=i(61198),u=i(54432),f=i(31048),p=i(33071),x=i(90772),y=i(53313),g=i(18048),v=i(79131),b=i(68232),j=i(62288),I=i(96221),_=i(46670),w=i(3529),k=i(63148);function V({scriptsSearchResults:e=[]}){let l=[];return e.sort((e,l)=>e.position-l.position).forEach(e=>{l.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:"",exclude:!1}))}),e.diagnoses.forEach(i=>{l.push({type:"diagnosis",title:i.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:i.diagnosisId,matches:i.matches.map(e=>({...e,newValue:"",exclude:!1}))})}),e.screens.forEach(i=>{l.push({type:"screen",title:i.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:i.screenId,matches:i.matches.map(e=>({...e,newValue:"",exclude:!1}))})})}),l.map(e=>({...e,matches:e.matches.filter(e=>!["key","id","field_key","field_id","item_id","item_key","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let N=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function C(e){let{searchValue:l="",scriptsSearchResults:i=[]}=e,[t,d]=(0,n.useState)(!1),[C,S]=(0,n.useState)(N[0].value),[$,D]=(0,n.useState)(function(e=""){return e.replace(/\"(.*?)\"/,"$1")}(l)),[E,F]=(0,n.useState)([]),[L,T]=(0,n.useState)(!1),[R,P]=(0,n.useState)(""),z=(0,h.N)(R),M=(0,n.useRef)(z);(0,n.useRef)(L);let{confirm:O}=(0,_.t)(),{alert:A}=(0,I.s)(),{isAdmin:K,isSuperUser:Z,viewOnly:B}=(0,w.b)(),G=(0,n.useCallback)(()=>{S(N[0].value),D($),F(V(e)),P(""),M.current="",T(!1)},[e]),W=!E.length||!R,H=(0,n.useCallback)(l=>{M.current="",S(l),F(V(e).filter(e=>{switch(l){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[C,e,L]),X=(0,n.useCallback)(async()=>{try{d(!0);let e=E.map(e=>({...e,matches:e.matches.filter(e=>!e.exclude)})).filter(e=>e.matches.length),l=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:e.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,l)=>({...e,[l.field]:l.newValue}),{})})),screens:e.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,l)=>{let i=e._fields||[],a=e._items||[];if(void 0===l.fieldIndex)e[l.field]=l.newValue;else if(l.field.includes("field_item_")){let e=i.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=i.length),i[e]={index:l.fieldIndex,data:{...i[e],[l.field.substring(11)]:l.newValue}}}else if(l.field.includes("field_")){let e=i.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=i.length),i[e]={index:l.fieldIndex,data:{...i[e],[l.field.substring(6)]:l.newValue}}}else{let e=a.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=a.length),a[e]={index:l.fieldIndex,data:{...a[e],[l.field.substring(5)]:l.newValue}}}return{...e,_fields:i,_items:a}},{})}})),diagnoses:e.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,l)=>{let i=e._fields||[];if(void 0===l.fieldIndex)e[l.field]=l.newValue;else{let e=i.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=i.length),i[e]={index:l.fieldIndex,data:{...i[e],[l.field]:l.newValue}}}return{...e,_fields:i}},{})}}))})).data;l.errors?A({title:"Error",message:l.errors.join(", "),variant:"error"}):A({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){A({title:"Error",message:e.message,variant:"error"})}finally{d(!1)}},[E]);return B||!(Z||K)?null:a.jsx(a.Fragment,{children:a.jsx(g.u,{onOpenChange:()=>{G()},title:(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,a.jsxs)("div",{children:[a.jsx(f._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),a.jsx(u.I,{disabled:!0,name:"searchValue",value:$,onChange:e=>D(e.target.value)})]}),(0,a.jsxs)("div",{children:[a.jsx(f._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),a.jsx(u.I,{name:"replaceWith",value:R,onChange:e=>P(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,a.jsxs)("div",{children:[a.jsx(f._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),a.jsx("div",{className:"w-[120px]",children:(0,a.jsxs)(r.Ph,{value:C,onValueChange:H,children:[a.jsx(r.i4,{children:a.jsx(r.ki,{placeholder:"All matches"})}),a.jsx(r.Bw,{children:N.map(e=>a.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})})]}),(0,a.jsxs)("div",{className:"flex gap-x-2 items-center",children:[a.jsx(y.X,{id:"caseSensitive",name:"caseSensitive",checked:L,onCheckedChange:()=>{T(!L)}}),a.jsx(f._,{htmlFor:"caseSensitive",children:"Case sensitive"})]})]})]}),trigger:a.jsx(j.hg,{asChild:!0,children:a.jsx(x.z,{children:"Replace"})}),actions:(0,a.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[a.jsx(j.GG,{asChild:!0,children:a.jsx(x.z,{variant:"ghost",children:"Cancel"})}),a.jsx(x.z,{disabled:W,onClick:()=>O(X,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,a.jsxs)("div",{className:"flex flex-col gap-y-6",children:[a.jsx(k._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!E.length&&a.jsx("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),E.map((e,l)=>e.matches.filter(e=>!e.exclude).length?(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[t&&a.jsx(s.a,{overlay:!0,transparent:!0}),(0,a.jsxs)("div",{className:"text-sm",children:[e.parent?(0,a.jsxs)("div",{children:[(0,a.jsxs)("b",{children:[(0,v.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,a.jsxs)("div",{children:[(0,a.jsxs)("b",{children:[(0,v.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((i,s)=>{let t=e.id+`_match${s}`;return i.exclude?null:a.jsx(p.Zb,{children:(0,a.jsxs)(p.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[a.jsx("div",{children:(0,a.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[i.field,"number"==typeof i.fieldIndex&&(0,a.jsxs)(a.Fragment,{children:["\xa0(",a.jsx("b",{children:"position"})," = ",i.fieldIndex+1,")"]})]})}),a.jsx("code",{className:(0,m.cn)("block",i.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:i.fieldValue.replace(RegExp(`(${RegExp.escape($)})`,L?"g":"gi"),"<mark>$1</mark>")}}),i.newValue&&a.jsx("code",{className:(0,m.cn)("block",R&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:i.newValue.replaceAll(z,`<mark>${z}</mark>`)}})]}),a.jsx("div",{children:a.jsx(b.pn,{delayDuration:0,children:(0,a.jsxs)(b.u,{children:[a.jsx(b.aJ,{children:a.jsx(x.z,{variant:"ghost",onClick:()=>F(e=>e.map((e,i)=>i!==l?e:{...e,matches:e.matches.filter((e,l)=>s!==l)}).filter(e=>e.matches.length)),children:a.jsx(c.Z,{className:"size-4"})})}),a.jsx(b._v,{children:"Remove"})]})})})]})},t)})]},e.id):null)]})})})}function S({search:e,setSearch:l,onSearch:i}){return(0,a.jsxs)(a.Fragment,{children:[e.searching&&a.jsx(s.a,{overlay:!0}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx(t.M,{placeholder:"Search",onSearch:i})}),!!e.value&&a.jsx("div",{className:"w-[120px]",children:(0,a.jsxs)(r.Ph,{value:e.filter,onValueChange:e=>l(l=>({...l,filter:e,results:(0,d._n)({results:l.unfilteredResults,filter:e,searchValue:l.value})})),children:[a.jsx(r.i4,{children:a.jsx(r.ki,{placeholder:"All matches"})}),a.jsx(r.Bw,{children:d.Hc.map(e=>a.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!e.results?.length&&a.jsx(a.Fragment,{children:a.jsx(C,{searchValue:e.value,scriptsSearchResults:e.results})})]})]})}},37792:(e,l,i)=>{i.d(l,{M:()=>r});var a=i(10326),s=i(17577),t=i(77863);let r=(0,s.forwardRef)(({searchButton:e,hideSearchButton:l,onSearch:i,...r},d)=>{let[n,c]=(0,s.useState)("");return a.jsx("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),i?.(n)},children:(0,a.jsxs)("div",{className:(0,t.cn)("flex w-full"),children:[a.jsx("div",{className:(0,t.cn)("relative w-full"),children:a.jsx("input",{ref:d,type:"search",placeholder:"Search",value:n,...r,onChange:e=>{let l=e.target.value;c(l),r.onChange?.(e),l||i?.(l)},className:(0,t.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",r.className)})}),!l&&a.jsx("button",{type:"submit",className:(0,t.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",e?.className),...e,children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},68232:(e,l,i)=>{i.d(l,{_v:()=>o,aJ:()=>c,pn:()=>d,u:()=>n});var a=i(10326),s=i(17577),t=i(6218),r=i(77863);let d=t.zt,n=t.fC,c=t.xz,o=s.forwardRef(({className:e,sideOffset:l=4,...i},s)=>a.jsx(t.VY,{ref:s,sideOffset:l,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));o.displayName=t.VY.displayName},37340:(e,l,i)=>{i.d(l,{k:()=>d});var a=i(17577),s=i(94464),t=i(3529),r=i(96221);function d(e){let{loadOnMount:l=!0,onLoadSitesError:i}={...e},[d,n]=(0,a.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,t.b)(),[m,h]=(0,a.useState)([]);return{loading:d,sites:m,loadSites:(0,a.useCallback)(async()=>{try{n(!0);let e=(await s.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(e.errors?.length)throw Error(e.errors.join(", "));h(e.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>i?.()})}finally{n(!1)}},[o,c,i])}}},30794:(e,l,i)=>{i.d(l,{GB:()=>s,Hc:()=>t,_n:()=>d});var a=i(11877);function s({searchValue:e,scripts:l,screens:i,diagnoses:s}){let{normalizedValue:t,isExactMatch:r}=(0,a.l)(e);if(!t)return[];let d=(0,a.y)(t),n=new RegExp(r?`^${d}$`:d,r?"":"i"),c="manual entry enter value manually custom value other specify",o={};return l.forEach(e=>{let l=[];`${e.title||""}`.match(n)&&l.push({field:"title",fieldValue:e.title}),`${e.printTitle||""}`.match(n)&&l.push({field:"printTitle",fieldValue:e.printTitle}),l.length&&(o[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:l})}),i.forEach(e=>{let l=[];`${e.title||""}`.match(n)&&l.push({field:"title",fieldValue:e.title}),`${e.key||""}`.match(n)&&l.push({field:"key",fieldValue:e.key}),`${e.refId||""}`.match(n)&&l.push({field:"refId",fieldValue:`${e.refId||""}`}),`${e.label||""}`.match(n)&&l.push({field:"label",fieldValue:e.label}),`${e.sectionTitle||""}`.match(n)&&l.push({field:"sectionTitle",fieldValue:e.sectionTitle}),`${e.previewTitle||""}`.match(n)&&l.push({field:"previewTitle",fieldValue:e.previewTitle}),`${e.previewPrintTitle||""}`.match(n)&&l.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),`${e.condition||""}`.match(n)&&l.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,i)=>{`${e.key||""}`.match(n)&&l.push({field:"field_key",fieldIndex:i,fieldValue:e.key}),`${e.label||""}`.match(n)&&l.push({field:"field_label",fieldIndex:i,fieldValue:e.label}),`${e.condition||""}`.match(n)&&l.push({field:"field_condition",fieldIndex:i,fieldValue:e.condition}),(e.items||[]).map((e,a)=>{`${e.value||""}`.match(n)&&l.push({field:"field_item_key",fieldIndex:i,fieldItemIndex:a,fieldValue:e.value}),`${e.label||""}`.match(n)&&l.push({field:"field_item_label",fieldIndex:i,fieldItemIndex:a,fieldValue:e.label}),e.enterValueManually&&c.match(n)&&l.push({field:"field_item_manual_entry",fieldIndex:i,fieldItemIndex:a,fieldValue:"Enter value manually"}),`${e.enterValueManuallyLabel||""}`.match(n)&&l.push({field:"field_item_manual_label",fieldIndex:i,fieldItemIndex:a,fieldValue:`${e.enterValueManuallyLabel||""}`})})}),(e.items||[]).map((e,i)=>{`${e.id||""}`.match(n)&&l.push({field:"item_id",fieldIndex:i,fieldValue:e.id}),`${e.key||""}`.match(n)&&l.push({field:"item_key",fieldIndex:i,fieldValue:e.key}),`${e.label||""}`.match(n)&&l.push({field:"item_label",fieldIndex:i,fieldValue:e.label}),e.enterValueManually&&c.match(n)&&l.push({field:"item_manual_entry",fieldIndex:i,fieldValue:"Enter value manually"}),`${e.enterValueManuallyLabel||""}`.match(n)&&l.push({field:"item_manual_label",fieldIndex:i,fieldValue:`${e.enterValueManuallyLabel||""}`})}),(e.drugs||[]).map((e,i)=>{`${e.key||""}`.match(n)&&l.push({field:"drug",fieldIndex:i,fieldValue:e.key})}),(e.fluids||[]).map((e,i)=>{`${e.key||""}`.match(n)&&l.push({field:"fluid",fieldIndex:i,fieldValue:e.key})}),(e.feeds||[]).map((e,i)=>{`${e.key||""}`.match(n)&&l.push({field:"feed",fieldIndex:i,fieldValue:e.key})}),l.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].screens.push({title:e.title,matches:l,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),s.forEach(e=>{let l=[];`${e.name||""}`.match(n)&&l.push({field:"name",fieldValue:e.name}),`${e.key||""}`.match(n)&&l.push({field:"key",fieldValue:e.key}),`${e.expression||""}`.match(n)&&l.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,i)=>{`${e.key||""}`.match(n)&&l.push({field:"diagnosis_symptom_key",fieldIndex:i,fieldValue:e.key}),`${e.name||""}`.match(n)&&l.push({field:"diagnosis_symptom_name",fieldIndex:i,fieldValue:e.name}),`${e.expression||""}`.match(n)&&l.push({field:"diagnosis_symptom_expression",fieldIndex:i,fieldValue:e.expression})}),l.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:l,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(o)}let t=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"},{value:"manual_entry",label:"Manual entry only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition",field_item_manual_entry:"manual_entry",item_manual_entry:"manual_entry",field_item_manual_label:"manual_entry",item_manual_label:"manual_entry"};function d({searchValue:e,filter:l,results:i}){if("all"===l)return i;let a=e=>r[e.field]===l;return i.map(e=>l?{...e,matches:e.matches.filter(e=>a(e)),screens:e.screens.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}};