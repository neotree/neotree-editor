"use strict";exports.id=9737,exports.ids=[9737],exports.modules={69088:(e,s,l)=>{l.d(s,{d:()=>b});var i=l(10326),t=l(17577),a=l(35047),r=l(74723),d=l(94464),n=l(34474),c=l(62288),o=l(53313),h=l(96221),m=l(82617),f=l(90772),p=l(11870),u=l(31048),x=l(18048),g=l(54432),y=l(77863),v=l(37340),j=l(63148);let w=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b({open:e,overWriteScriptWithId:s,onOpenChange:l,onImportSuccess:b}){let I=(0,a.useRouter)(),k=(0,a.useParams)();s=s||k.scriptId;let{copyScripts:_}=(0,m.h)(),{alert:C}=(0,h.s)(),[V,N]=(0,t.useState)(!1),{sites:L,loading:S}=(0,v.k)({onLoadSitesError:()=>l(!1)}),$=S||V,{formState:{errors:D},reset:E,watch:F,setValue:T,register:R,handleSubmit:P}=(0,r.cI)({defaultValues:w(s)}),z=F("confirmed"),O=F("overwriteDataKeys"),A=F("overwriteDrugsLibraryItems"),K=P(async e=>{try{if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(s&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");N(!0);let i=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:s,broadcastAction:!0})).data;if(i.errors?.length)throw Error(i.errors.join(", "));I.refresh(),C({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{b?.(),E(w(s)),l(!1)}})}catch(e){C({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{N(!1)}});return(0,i.jsxs)(i.Fragment,{children:[$&&i.jsx(p.a,{overlay:!0}),i.jsx(x.u,{open:e,onOpenChange:()=>{l(!1),E(w(s))},title:"Import script",actions:(0,i.jsxs)(i.Fragment,{children:[i.jsx("span",{className:"text-xs text-danger",children:"* Required"}),i.jsx("div",{className:"flex-1"}),i.jsx(c.GG,{asChild:!0,children:i.jsx(f.z,{variant:"ghost",disabled:$,onClick:()=>l(!1),children:"Cancel"})}),i.jsx(f.z,{onClick:()=>K(),disabled:$,children:"Import"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[i.jsx(j._,{children:(0,i.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",i.jsx("b",{children:"will be appended"})," to the library"]})}),(0,i.jsxs)("div",{children:[i.jsx(u._,{htmlFor:"siteId",children:"Site *"}),(0,i.jsxs)(n.Ph,{name:"siteId",disabled:$,onValueChange:e=>T("siteId",e,{shouldDirty:!0}),children:[i.jsx(n.i4,{children:i.jsx(n.ki,{placeholder:"Select site"})}),i.jsx(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[i.jsx(n.n5,{children:"Sites"}),L.map(({siteId:e,name:s})=>i.jsx(n.Ql,{value:e,children:s},e))]})})]}),!!D.siteId?.message&&i.jsx("div",{className:"text-xs text-danger mt-1",children:D.siteId.message})]}),(0,i.jsxs)("div",{children:[i.jsx(u._,{htmlFor:"scriptId",children:"Script ID *"}),i.jsx(g.I,{...R("scriptId",{disabled:$,required:!0}),name:"scriptId"}),!!D.scriptId?.message&&i.jsx("div",{className:"text-xs text-danger mt-1",children:D.scriptId.message})]}),(0,i.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[i.jsx(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:$,checked:O,onCheckedChange:()=>T("overwriteDataKeys",!O,{shouldDirty:!0})}),i.jsx(u._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,i.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[i.jsx(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:$,checked:A,onCheckedChange:()=>T("overwriteDrugsLibraryItems",!A,{shouldDirty:!0})}),i.jsx(u._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,i.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!s&&"hidden"),children:[i.jsx(o.X,{name:"confirmed",id:"confirmed",disabled:$,checked:z,onCheckedChange:()=>T("confirmed",!z,{shouldDirty:!0})}),i.jsx(u._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},89544:(e,s,l)=>{l.d(s,{f:()=>L});var i=l(10326),t=l(11870),a=l(37792),r=l(34474),d=l(30794),n=l(17577),c=l(94019),o=l(94464),h=l(77863),m=l(61198),f=l(54432),p=l(31048),u=l(33071),x=l(90772),g=l(53313),y=l(18048),v=l(79131),j=l(68232),w=l(62288),b=l(96221),I=l(46670),k=l(3529),_=l(63148);function C({scriptsSearchResults:e=[]}){let s=[];return e.sort((e,s)=>e.position-s.position).forEach(e=>{s.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:"",exclude:!1}))}),e.diagnoses.forEach(l=>{s.push({type:"diagnosis",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.diagnosisId,matches:l.matches.map(e=>({...e,newValue:"",exclude:!1}))})}),e.screens.forEach(l=>{s.push({type:"screen",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.screenId,matches:l.matches.map(e=>({...e,newValue:"",exclude:!1}))})})}),s.map(e=>({...e,matches:e.matches.filter(e=>!["key","id","field_key","field_id","item_id","item_key","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let V=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function N(e){let{searchValue:s="",scriptsSearchResults:l=[]}=e,[a,d]=(0,n.useState)(!1),[N,L]=(0,n.useState)(V[0].value),[S,$]=(0,n.useState)(function(e=""){return e.replace(/\"(.*?)\"/,"$1")}(s)),[D,E]=(0,n.useState)([]),[F,T]=(0,n.useState)(!1),[R,P]=(0,n.useState)(""),z=(0,m.N)(R),O=(0,n.useRef)(z);(0,n.useRef)(F);let{confirm:A}=(0,I.t)(),{alert:K}=(0,b.s)(),{isAdmin:Z,isSuperUser:B,viewOnly:G}=(0,k.b)(),W=(0,n.useCallback)(()=>{L(V[0].value),$(S),E(C(e)),P(""),O.current="",T(!1)},[e]),H=!D.length||!R,M=(0,n.useCallback)(s=>{O.current="",L(s),E(C(e).filter(e=>{switch(s){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[N,e,F]),X=(0,n.useCallback)(async()=>{try{d(!0);let e=D.map(e=>({...e,matches:e.matches.filter(e=>!e.exclude)})).filter(e=>e.matches.length),s=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:e.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,s)=>({...e,[s.field]:s.newValue}),{})})),screens:e.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,s)=>{let l=e._fields||[],i=e._items||[];if(void 0===s.fieldIndex)e[s.field]=s.newValue;else if(s.field.includes("field_item_")){let e=l.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=l.length),l[e]={index:s.fieldIndex,data:{...l[e],[s.field.substring(11)]:s.newValue}}}else if(s.field.includes("field_")){let e=l.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=l.length),l[e]={index:s.fieldIndex,data:{...l[e],[s.field.substring(6)]:s.newValue}}}else{let e=i.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=i.length),i[e]={index:s.fieldIndex,data:{...i[e],[s.field.substring(5)]:s.newValue}}}return{...e,_fields:l,_items:i}},{})}})),diagnoses:e.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,s)=>{let l=e._fields||[];if(void 0===s.fieldIndex)e[s.field]=s.newValue;else{let e=l.map(e=>e.index).indexOf(s.fieldIndex);-1===e&&(e=l.length),l[e]={index:s.fieldIndex,data:{...l[e],[s.field]:s.newValue}}}return{...e,_fields:l}},{})}}))})).data;s.errors?K({title:"Error",message:s.errors.join(", "),variant:"error"}):K({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){K({title:"Error",message:e.message,variant:"error"})}finally{d(!1)}},[D]);return G||!(B||Z)?null:i.jsx(i.Fragment,{children:i.jsx(y.u,{onOpenChange:()=>{W()},title:(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,i.jsxs)("div",{children:[i.jsx(p._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),i.jsx(f.I,{disabled:!0,name:"searchValue",value:S,onChange:e=>$(e.target.value)})]}),(0,i.jsxs)("div",{children:[i.jsx(p._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),i.jsx(f.I,{name:"replaceWith",value:R,onChange:e=>P(e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,i.jsxs)("div",{children:[i.jsx(p._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),i.jsx("div",{className:"w-[120px]",children:(0,i.jsxs)(r.Ph,{value:N,onValueChange:M,children:[i.jsx(r.i4,{children:i.jsx(r.ki,{placeholder:"All matches"})}),i.jsx(r.Bw,{children:V.map(e=>i.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})})]}),(0,i.jsxs)("div",{className:"flex gap-x-2 items-center",children:[i.jsx(g.X,{id:"caseSensitive",name:"caseSensitive",checked:F,onCheckedChange:()=>{T(!F)}}),i.jsx(p._,{htmlFor:"caseSensitive",children:"Case sensitive"})]})]})]}),trigger:i.jsx(w.hg,{asChild:!0,children:i.jsx(x.z,{children:"Replace"})}),actions:(0,i.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[i.jsx(w.GG,{asChild:!0,children:i.jsx(x.z,{variant:"ghost",children:"Cancel"})}),i.jsx(x.z,{disabled:H,onClick:()=>A(X,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-6",children:[i.jsx(_._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!D.length&&i.jsx("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),D.map((e,s)=>e.matches.filter(e=>!e.exclude).length?(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[a&&i.jsx(t.a,{overlay:!0,transparent:!0}),(0,i.jsxs)("div",{className:"text-sm",children:[e.parent?(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,v.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,v.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((l,t)=>{let a=e.id+`_match${t}`;return l.exclude?null:i.jsx(u.Zb,{children:(0,i.jsxs)(u.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,i.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[i.jsx("div",{children:(0,i.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[l.field,"number"==typeof l.fieldIndex&&(0,i.jsxs)(i.Fragment,{children:["\xa0(",i.jsx("b",{children:"position"})," = ",l.fieldIndex+1,")"]})]})}),i.jsx("code",{className:(0,h.cn)("block",l.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:l.fieldValue.replace(RegExp(`(${RegExp.escape(S)})`,F?"g":"gi"),"<mark>$1</mark>")}}),l.newValue&&i.jsx("code",{className:(0,h.cn)("block",R&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:l.newValue.replaceAll(z,`<mark>${z}</mark>`)}})]}),i.jsx("div",{children:i.jsx(j.pn,{delayDuration:0,children:(0,i.jsxs)(j.u,{children:[i.jsx(j.aJ,{children:i.jsx(x.z,{variant:"ghost",onClick:()=>E(e=>e.map((e,l)=>l!==s?e:{...e,matches:e.matches.filter((e,s)=>t!==s)}).filter(e=>e.matches.length)),children:i.jsx(c.Z,{className:"size-4"})})}),i.jsx(j._v,{children:"Remove"})]})})})]})},a)})]},e.id):null)]})})})}function L({search:e,setSearch:s,onSearch:l}){return(0,i.jsxs)(i.Fragment,{children:[e.searching&&i.jsx(t.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[i.jsx("div",{className:"flex-1",children:i.jsx(a.M,{placeholder:"Search",onSearch:l})}),!!e.value&&i.jsx("div",{className:"w-[120px]",children:(0,i.jsxs)(r.Ph,{value:e.filter,onValueChange:e=>s(s=>({...s,filter:e,results:(0,d._n)({results:s.unfilteredResults,filter:e,searchValue:s.value})})),children:[i.jsx(r.i4,{children:i.jsx(r.ki,{placeholder:"All matches"})}),i.jsx(r.Bw,{children:d.Hc.map(e=>i.jsx(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!e.results?.length&&i.jsx(i.Fragment,{children:i.jsx(N,{searchValue:e.value,scriptsSearchResults:e.results})})]})]})}},37792:(e,s,l)=>{l.d(s,{M:()=>r});var i=l(10326),t=l(17577),a=l(77863);let r=(0,t.forwardRef)(({searchButton:e,hideSearchButton:s,onSearch:l,...r},d)=>{let[n,c]=(0,t.useState)("");return i.jsx("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),l?.(n)},children:(0,i.jsxs)("div",{className:(0,a.cn)("flex w-full"),children:[i.jsx("div",{className:(0,a.cn)("relative w-full"),children:i.jsx("input",{ref:d,type:"search",placeholder:"Search",value:n,...r,onChange:e=>{let s=e.target.value;c(s),r.onChange?.(e),s||l?.(s)},className:(0,a.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",r.className)})}),!s&&i.jsx("button",{type:"submit",className:(0,a.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",e?.className),...e,children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},68232:(e,s,l)=>{l.d(s,{_v:()=>o,aJ:()=>c,pn:()=>d,u:()=>n});var i=l(10326),t=l(17577),a=l(6218),r=l(77863);let d=a.zt,n=a.fC,c=a.xz,o=t.forwardRef(({className:e,sideOffset:s=4,...l},t)=>i.jsx(a.VY,{ref:t,sideOffset:s,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...l}));o.displayName=a.VY.displayName},37340:(e,s,l)=>{l.d(s,{k:()=>d});var i=l(17577),t=l(94464),a=l(3529),r=l(96221);function d(e){let{loadOnMount:s=!0,onLoadSitesError:l}={...e},[d,n]=(0,i.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,a.b)(),[h,m]=(0,i.useState)([]);return{loading:d,sites:h,loadSites:(0,i.useCallback)(async()=>{try{n(!0);let e=(await t.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(e.errors?.length)throw Error(e.errors.join(", "));m(e.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>l?.()})}finally{n(!1)}},[o,c,l])}}},30794:(e,s,l)=>{l.d(s,{GB:()=>t,Hc:()=>a,_n:()=>d});var i=l(11877);function t({searchValue:e,scripts:s,screens:l,diagnoses:t}){let{normalizedValue:a,isExactMatch:r}=(0,i.l)(e);if(!a)return[];let d=(0,i.y)(a),n=new RegExp(r?`^${d}$`:d),c={};return s.forEach(e=>{let s=[];`${e.title||""}`.toLowerCase().match(n)&&s.push({field:"title",fieldValue:e.title}),`${e.printTitle||""}`.toLowerCase().match(n)&&s.push({field:"printTitle",fieldValue:e.printTitle}),s.length&&(c[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:s})}),l.forEach(e=>{let s=[];`${e.title||""}`.toLowerCase().match(n)&&s.push({field:"title",fieldValue:e.title}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"key",fieldValue:e.key}),`${e.refId||""}`.toLowerCase().match(n)&&s.push({field:"refId",fieldValue:`${e.refId||""}`}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"label",fieldValue:e.label}),`${e.sectionTitle||""}`.toLowerCase().match(n)&&s.push({field:"sectionTitle",fieldValue:e.sectionTitle}),`${e.previewTitle||""}`.toLowerCase().match(n)&&s.push({field:"previewTitle",fieldValue:e.previewTitle}),`${e.previewPrintTitle||""}`.toLowerCase().match(n)&&s.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),`${e.condition||""}`.toLowerCase().match(n)&&s.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"field_key",fieldIndex:l,fieldValue:e.key}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"field_label",fieldIndex:l,fieldValue:e.label}),`${e.condition||""}`.toLowerCase().match(n)&&s.push({field:"field_condition",fieldIndex:l,fieldValue:e.condition}),(e.items||[]).map((e,i)=>{`${e.value||""}`.toLowerCase().match(n)&&s.push({field:"field_item_key",fieldIndex:l,fieldItemIndex:i,fieldValue:e.value}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"field_item_label",fieldIndex:l,fieldItemIndex:i,fieldValue:e.label})})}),(e.items||[]).map((e,l)=>{`${e.id||""}`.toLowerCase().match(n)&&s.push({field:"item_id",fieldIndex:l,fieldValue:e.id}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"item_key",fieldIndex:l,fieldValue:e.key}),`${e.label||""}`.toLowerCase().match(n)&&s.push({field:"item_label",fieldIndex:l,fieldValue:e.label})}),(e.drugs||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"drug",fieldIndex:l,fieldValue:e.key})}),(e.fluids||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"fluid",fieldIndex:l,fieldValue:e.key})}),(e.feeds||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"feed",fieldIndex:l,fieldValue:e.key})}),s.length&&(c[e.scriptId]=c[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},c[e.scriptId].title=c[e.scriptId].title||e.scriptTitle,c[e.scriptId].screens.push({title:e.title,matches:s,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),t.forEach(e=>{let s=[];`${e.name||""}`.toLowerCase().match(n)&&s.push({field:"name",fieldValue:e.name}),`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"key",fieldValue:e.key}),`${e.expression||""}`.toLowerCase().match(n)&&s.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,l)=>{`${e.key||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_key",fieldIndex:l,fieldValue:e.key}),`${e.name||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_name",fieldIndex:l,fieldValue:e.name}),`${e.expression||""}`.toLowerCase().match(n)&&s.push({field:"diagnosis_symptom_expression",fieldIndex:l,fieldValue:e.expression})}),s.length&&(c[e.scriptId]=c[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},c[e.scriptId].title=c[e.scriptId].title||e.scriptTitle,c[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:s,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(c)}let a=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function d({searchValue:e,filter:s,results:l}){if("all"===s)return l;let i=e=>r[e.field]===s;return l.map(e=>s?{...e,matches:e.matches.filter(e=>i(e)),screens:e.screens.filter(e=>e.matches.find(e=>i(e))).map(e=>({...e,matches:e.matches.filter(e=>i(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>i(e))).map(e=>({...e,matches:e.matches.filter(e=>i(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}};