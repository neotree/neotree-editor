exports.id=4515,exports.ids=[4515],exports.modules={58359:()=>{},93739:()=>{},9501:(e,t,s)=>{"use strict";s.d(t,{tW:()=>w,co:()=>m,ix:()=>u,GM:()=>b,W0:()=>g,Zu:()=>f,XA:()=>S,Ew:()=>v,NB:()=>D,uK:()=>h,bK:()=>p,Tw:()=>o,Sc:()=>Z,f:()=>I});var i=s(57745),a=s(30900),r=s(9576),n=s(10413),l=s(43509),d=s(57435);async function o(e){try{let{scriptsIds:t=[],hospitalIds:s=[],returnDraftsIfExist:d}={...e},o=t.filter(e=>!a.Z(e));t=t.filter(e=>a.Z(e));let p=s.filter(e=>!a.Z(e));if(s=s.filter(e=>a.Z(e)),o.length){let e=await n.Z.query.scripts.findMany({where:(0,i.d3)(l.scripts.oldScriptId,o),columns:{scriptId:!0,oldScriptId:!0}});o.forEach(s=>{let i=e.filter(e=>e.oldScriptId===s)[0];t.push(i?.scriptId||r.Z())})}if(p.length){let e=await n.Z.query.hospitals.findMany({where:(0,i.d3)(l.hospitals.oldHospitalId,p),columns:{hospitalId:!0,oldHospitalId:!0}});p.forEach(t=>{let i=e.filter(e=>e.oldHospitalId===t)[0];s.push(i?.hospitalId||r.Z())})}let c=(d?await n.Z.select({scriptDraft:l.scriptsDrafts,hospitalName:l.hospitals.name}).from(l.scriptsDrafts).leftJoin(l.hospitals,(0,i.eq)(l.hospitals.hospitalId,l.scriptsDrafts.hospitalId)).where((0,i.xD)(t?.length?(0,i.d3)(l.scriptsDrafts.scriptDraftId,t):void 0,s.length?(0,i.d3)(l.scriptsDrafts.hospitalId,s):void 0)):[]).map(e=>({...e.scriptDraft,hospitalName:e.hospitalName})),f=(await n.Z.select({script:l.scripts,pendingDeletion:l.pendingDeletion,hospitalName:l.hospitals.name}).from(l.scripts).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.scriptId,l.scripts.scriptId)).leftJoin(l.scriptsDrafts,(0,i.eq)(l.scriptsDrafts.scriptId,l.scripts.scriptId)).leftJoin(l.hospitals,(0,i.xD)((0,i.eq)(l.hospitals.hospitalId,l.scripts.hospitalId),(0,i.Ft)(l.hospitals.deletedAt))).where((0,i.xD)((0,i.Ft)(l.scripts.deletedAt),(0,i.Ft)(l.pendingDeletion),d?(0,i.Ft)(l.scriptsDrafts.scriptId):void 0,t.length?(0,i.d3)(l.scripts.scriptId,t):void 0,s.length?(0,i.d3)(l.scripts.hospitalId,s):void 0))).map(e=>({...e.script,hospitalName:e.hospitalName})),u=f.length?await n.Z.query.pendingDeletion.findMany({where:(0,i.d3)(l.pendingDeletion.scriptId,f.map(e=>e.scriptId)),columns:{scriptId:!0}}):[];return{data:[...f.map(e=>({...e,isDraft:!1,isDeleted:!1})),...c.map(e=>({...e.data,hospitalName:e.hospitalName,isDraft:!0,isDeleted:!1}))].sort((e,t)=>e.position-t.position).filter(e=>!u.map(e=>e.scriptId).includes(e.scriptId)).map(e=>({...e,hospitalId:e.hospitalName?e.hospitalId:null}))}}catch(e){return d.Z.error("_getScripts ERROR",e.message),{data:[],errors:[e.message]}}}async function p(e){let{scriptId:t,returnDraftIfExists:s}={...e};try{if(!t)throw Error("Missing scriptId");let e=a.Z(t)?(0,i.eq)(l.scripts.scriptId,t):void 0,r=a.Z(t)?void 0:(0,i.eq)(l.scripts.oldScriptId,t),d=e?(0,i.eq)(l.scriptsDrafts.scriptDraftId,t):void 0,o=s&&d?await n.Z.query.scriptsDrafts.findFirst({where:d}):void 0,p=o?{...o.data,isDraft:!1,isDeleted:!1}:null;if(p)return{data:p};let c=await n.Z.select({script:l.scripts,pendingDeletion:l.pendingDeletion,draft:l.scriptsDrafts,hospitalName:l.hospitals.name}).from(l.scripts).leftJoin(l.hospitals,(0,i.xD)((0,i.eq)(l.hospitals.hospitalId,l.scripts.hospitalId),(0,i.Ft)(l.hospitals.deletedAt))).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.scriptId,l.scripts.scriptId)).leftJoin(l.scriptsDrafts,(0,i.eq)(l.scripts.scriptId,l.scriptsDrafts.scriptDraftId)).where((0,i.xD)((0,i.Ft)(l.scripts.deletedAt),(0,i.Ft)(l.pendingDeletion),(0,i.or)(e,r))),f=c[0]?{...c[0].script,draft:c[0].draft||void 0,hospitalName:c[0].hospitalName||""}:null;o=s?f?.draft:void 0;let u=o?.data||f;if(!(p=u?{...u,isDraft:!1,isDeleted:!1,hospitalId:u.hospitalName?u.hospitalId:null}:null))return{data:null};return{data:p}}catch(e){return d.Z.error("_getScript ERROR",e.message),{errors:[e.message]}}}var c=s(60938);let f={allPublished:0,publishedWithDrafts:0,allDrafts:0,newDrafts:0,pendingDeletion:0};async function u(){try{let[{count:e}]=await n.Z.select({count:(0,c.QX)()}).from(l.scriptsDrafts),[{count:t}]=await n.Z.select({count:(0,c.QX)()}).from(l.scriptsDrafts).where((0,i.Ft)(l.scriptsDrafts.scriptId)),[{count:s}]=await n.Z.select({count:(0,c.QX)()}).from(l.scriptsDrafts).where((0,i.K0)(l.scriptsDrafts.scriptId)),[{count:a}]=await n.Z.select({count:(0,c.QX)()}).from(l.pendingDeletion).where((0,i.K0)(l.pendingDeletion.scriptId)),[{count:r}]=await n.Z.select({count:(0,c.QX)()}).from(l.scripts);return{data:{allPublished:r,publishedWithDrafts:s,allDrafts:e,newDrafts:t,pendingDeletion:a}}}catch(e){return d.Z.error("_getScripts ERROR",e.message),{data:f,errors:[e.message]}}}let g={allPublished:0,publishedWithDrafts:0,allDrafts:0,newDrafts:0,pendingDeletion:0};async function m(e){let{scriptsIds:t=[],types:s=[]}={...e};try{let e=t.length?(0,i.d3)(l.screens.scriptId,t):void 0,a=t.length?(0,i.d3)(l.screensDrafts.scriptId,t):void 0,r=s.length?(0,i.d3)(l.screens.type,s):void 0,d=s.length?(0,i.d3)(l.screensDrafts.type,s):void 0,[{count:o}]=await n.Z.select({count:(0,c.QX)()}).from(l.screensDrafts).where((0,i.xD)(a,d)),[{count:p}]=await n.Z.select({count:(0,c.QX)()}).from(l.screensDrafts).where((0,i.xD)(a,d,(0,i.Ft)(l.screensDrafts.screenId))),[{count:f}]=await n.Z.select({count:(0,c.QX)()}).from(l.screensDrafts).where((0,i.xD)(a,d,(0,i.K0)(l.screensDrafts.screenId))),[{count:u}]=await n.Z.select({count:(0,c.QX)()}).from(l.pendingDeletion).where((0,i.xD)(t.length?(0,i.or)((0,i.d3)(l.pendingDeletion.screenScriptId,t)):void 0,(0,i.K0)(l.pendingDeletion.screenId))),[{count:g}]=await n.Z.select({count:(0,c.QX)()}).from(l.screens).where((0,i.xD)(e,r));return{data:{allPublished:g,publishedWithDrafts:f,allDrafts:o,newDrafts:p,pendingDeletion:u}}}catch(e){return d.Z.error("_getScreens ERROR",e.message),{data:g,errors:[e.message]}}}let y={zw_edliz_summary_table:[{label:"Confirmed sepsis or chorioamnionitis in mother",type:"Major criteria",subType:"Antenatal",id:"MAJC1"},{label:"Confirmed or suspected sepsis in twin",type:"Major criteria",subType:"Antenatal",id:"MAJC2"},{label:"Seizures",type:"Major criteria",subType:"Antenatal",id:"MAJC3"},{label:"Severe Respiratory Distress in a term infant",type:"Major criteria",subType:"Antenatal",id:"MAJC4"},{label:"Signs of shock",type:"Major criteria",subType:"Natal",id:"MAJC5"},{label:"ROM >18h",type:"Minor criteria",subType:"Antenatal",id:"MINC1"},{label:"Spontaneous Preterm Birth",type:"Minor criteria",subType:"Antenatal",id:"MINC2"},{label:"GBS sepsis in previous baby or documented GBS carriage in this pregnancy (urine or vaginal swab)",type:"Minor criteria",subType:"Antenatal",id:"MINC3"},{label:"Born Before Arrival",type:"Minor criteria",subType:"Natal",id:"MINC4"},{label:"Meconium Stained Liquor",type:"Minor criteria",subType:"Natal",id:"MINC5"},{label:"Respiratory distress that is not obviously related to:\n1. environmental hypothermia \n2. “delayed transition to extra-uterine life” i.e. mild to moderate respiratory distress apparent soon after birth that is improving with time. ",type:"Minor criteria",subType:"Postnatal",id:"MINC6"},{label:"Hypoxia",type:"Minor criteria",subType:"Postnatal",id:"MINC7"},{label:"Apnoea",type:"Minor criteria",subType:"Postnatal",id:"MINC8"},{label:"Hypoglycaemia/Hyperglycaemia not otherwise explained",type:"Minor criteria",subType:"Postnatal",id:"MINC9"},{label:"Temperature instability not explained by environmental factors",type:"Minor criteria",subType:"Postnatal",id:"MINC10"},{label:"Acidosis not obviously related to HIE",type:"Minor criteria",subType:"Postnatal",id:"MINC11"},{label:"Unexplained bleeding or thrombocytopenia",type:"Minor criteria",subType:"Postnatal",id:"MINC12"},{label:"Mild encephalopathy/Altered responsiveness",type:"Minor criteria",subType:"Postnatal",id:"MINC13"},{label:"Altered tone not otherwise explained",type:"Minor criteria",subType:"Postnatal",id:"MINC14"},{label:"Feed intolerance/feeding difficulty",type:"Minor criteria",subType:"Postnatal",id:"MINC15"},{label:"Abnormal heart rate (<90 or >160)",type:"Minor criteria",subType:"Postnatal",id:"MINC16"},{label:"Jaundice in first 24h",type:"Minor criteria",subType:"Postnatal",id:"MINC17"}],mwi_edliz_summary_table:[{label:"Fever >38 in mother",type:"Antenatal risk factors",subType:"",id:"ARF1"},{label:"Rupture of membranes >18h",type:"Antenatal risk factors",subType:"",id:"ARF2"},{label:"Offensive Liquor",type:"Antenatal risk factors",subType:"",id:"ARF3"},{label:"Suspected or confirmed sepsis in a twin”",type:"Antenatal risk factors",subType:"",id:"ARF4"},{label:"Temperature <35.5 or >37.5",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS1"},{label:"Bulging Fontanelle",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS2"},{label:"chest indrawing",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS6"},{label:"Umbilical redness extending to the periumbilical skin or umbilicus draining pus",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS8"},{label:"reduced movement of limbs",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS9"},{label:"Many skin pustules/big boil (abscess)",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS10"},{label:"Painful joint/swelling, reduced movement and irritability if these parts are handled",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS11"},{label:"Drowsiness",type:"Signs/symptoms of meningitis",subType:"",id:"SM1"},{label:"Lethargy/unconscious",type:"Signs/symptoms of meningitis",subType:"",id:"SM2"},{label:"Persistent irritability",type:"Signs/symptoms of meningitis",subType:"",id:"SM3"},{label:"High pitched cry",type:"Signs/symptoms of meningitis",subType:"",id:"SM4"},{label:"Convulsions",type:"Signs/symptoms of meningitis",subType:"",id:"SM5"},{label:"Apnoeic episode",type:"Signs/symptoms of meningitis",subType:"",id:"SM6"},{label:"Cold hands and feet",type:"Shock (Danger signs)",subType:"",id:"SDS1"},{label:"Capillary refill time > 3 seconds",type:"Shock (Danger signs)",subType:"",id:"SDS2"},{label:"Fast and weak pulse",type:"Shock (Danger signs)",subType:"",id:"SDS3"}]};async function h(e){try{let{scriptsIds:t=[],screensIds:s=[],returnDraftsIfExist:d,withImagesOnly:o}={...e},p=s.filter(e=>!a.Z(e));if(s=s.filter(e=>a.Z(e)),p.length){let e=await n.Z.query.screens.findMany({where:(0,i.d3)(l.screens.oldScreenId,p),columns:{screenId:!0,oldScreenId:!0}});p.forEach(t=>{let i=e.filter(e=>e.oldScreenId===t)[0];s.push(i?.screenId||r.Z())})}let c=(t=t.filter(e=>a.Z(e))).filter(e=>!a.Z(e));if(c.length){let e=await n.Z.query.scripts.findMany({where:(0,i.d3)(l.scripts.oldScriptId,c),columns:{scriptId:!0,oldScriptId:!0}});c.forEach(s=>{let i=e.filter(e=>e.oldScriptId===s)[0];t.push(i?.scriptId||r.Z())})}let f=d?await n.Z.query.screensDrafts.findMany({where:(0,i.xD)(t?.length?(0,i.or)((0,i.d3)(l.screensDrafts.scriptId,t),(0,i.d3)(l.screensDrafts.scriptDraftId,t)):void 0,s?.length?(0,i.d3)(l.screensDrafts.screenDraftId,s):void 0)}):[],u=(await n.Z.select({screen:l.screens,pendingDeletion:l.pendingDeletion,script:{title:l.scripts.title,hospitalId:l.scripts.hospitalId},hospital:{name:l.hospitals.name}}).from(l.screens).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.screenId,l.screens.screenId)).leftJoin(l.screensDrafts,(0,i.eq)(l.screensDrafts.screenId,l.screens.screenId)).leftJoin(l.scripts,(0,i.eq)(l.scripts.scriptId,l.screens.scriptId)).leftJoin(l.hospitals,(0,i.xD)((0,i.eq)(l.scripts.scriptId,l.screens.scriptId),(0,i.eq)(l.scripts.hospitalId,l.hospitals.hospitalId))).where((0,i.xD)((0,i.Ft)(l.screens.deletedAt),(0,i.Ft)(l.pendingDeletion),d?(0,i.Ft)(l.screensDrafts.screenId):void 0,t?.length?(0,i.d3)(l.screens.scriptId,t):void 0,s?.length?(0,i.d3)(l.screens.screenId,s):void 0,o?(0,i.or)((0,i.K0)(l.screens.image1),(0,i.K0)(l.screens.image2),(0,i.K0)(l.screens.image3)):void 0))).map(e=>({...e.screen,scriptTitle:e.script?.title||"",hospitalName:e.hospital?.name||""})),g=u.length?await n.Z.query.pendingDeletion.findMany({where:(0,i.d3)(l.pendingDeletion.screenId,u.map(e=>e.screenId)),columns:{screenId:!0}}):[];return{data:[...u.map(e=>({...e,isDraft:!1,isDeleted:!1})),...f.map(e=>({...e.data,isDraft:!0,isDeleted:!1}))].sort((e,t)=>e.position-t.position).filter(e=>!g.map(e=>e.screenId).includes(e.screenId)).map(e=>("mwi_edliz_summary_table"===e.type&&(e.items=y.mwi_edliz_summary_table),"zw_edliz_summary_table"===e.type&&(e.items=y.zw_edliz_summary_table),{...e,scriptTitle:e.scriptTitle||"",hospitalName:e.hospitalName||""}))}}catch(e){return d.Z.error("_getScreens ERROR",e.message),{data:[],errors:[e.message]}}}async function D(e){let{screenId:t,returnDraftIfExists:s}={...e};try{if(!t)throw Error("Missing screenId");let e=a.Z(t)?(0,i.eq)(l.screens.screenId,t):void 0,r=a.Z(t)?void 0:(0,i.eq)(l.screens.oldScreenId,t),d=e?(0,i.eq)(l.screensDrafts.screenDraftId,t):void 0,o=s&&d?await n.Z.query.screensDrafts.findFirst({where:d}):void 0,p=o?{...o.data,isDraft:!1,isDeleted:!1}:null;if(p)return{data:p};let c=await n.Z.select({screen:l.screens,pendingDeletion:l.pendingDeletion,draft:l.screensDrafts}).from(l.screens).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.screenId,l.screens.screenId)).leftJoin(l.screensDrafts,(0,i.eq)(l.screens.screenId,l.screensDrafts.screenDraftId)).where((0,i.xD)((0,i.Ft)(l.screens.deletedAt),(0,i.Ft)(l.pendingDeletion),(0,i.or)(e,r))),f=c[0]?{...c[0].screen,draft:c[0].draft||void 0}:null;o=s?f?.draft:void 0;let u=o?.data||f;if(u?.type==="mwi_edliz_summary_table"&&(u.items=y.mwi_edliz_summary_table),u?.type==="zw_edliz_summary_table"&&(u.items=y.zw_edliz_summary_table),!(p=u?{...u,isDraft:!1,isDeleted:!1}:null))return{data:null};return{data:p}}catch(e){return d.Z.error("_getScreen ERROR",e.message),{errors:[e.message]}}}async function I(e){try{let{scriptsIds:t=[],screensIds:s=[],returnDraftsIfExist:d}={...e},o=s.filter(e=>!a.Z(e));if(s=s.filter(e=>a.Z(e)),o.length){let e=await n.Z.query.screens.findMany({where:(0,i.d3)(l.screens.oldScreenId,o),columns:{screenId:!0,oldScreenId:!0}});o.forEach(t=>{let i=e.filter(e=>e.oldScreenId===t)[0];s.push(i?.screenId||r.Z())})}let p=(t=t.filter(e=>a.Z(e))).filter(e=>!a.Z(e));if(p.length){let e=await n.Z.query.scripts.findMany({where:(0,i.d3)(l.scripts.oldScriptId,p),columns:{scriptId:!0,oldScriptId:!0}});p.forEach(s=>{let i=e.filter(e=>e.oldScriptId===s)[0];t.push(i?.scriptId||r.Z())})}let c=d?await n.Z.query.screensDrafts.findMany({where:(0,i.xD)(t?.length?(0,i.or)((0,i.d3)(l.screensDrafts.scriptId,t),(0,i.d3)(l.screensDrafts.scriptDraftId,t)):void 0,s?.length?(0,i.d3)(l.screensDrafts.screenDraftId,s):void 0)}):[],f=(await n.Z.select({screen:{title:l.screens.title,screenId:l.screens.screenId,oldScreenId:l.screens.oldScreenId,position:l.screens.position,type:l.screens.type,refId:l.screens.refId},pendingDeletion:l.pendingDeletion}).from(l.screens).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.screenId,l.screens.screenId)).leftJoin(l.screensDrafts,(0,i.eq)(l.screensDrafts.screenId,l.screens.screenId)).where((0,i.xD)((0,i.Ft)(l.screens.deletedAt),(0,i.Ft)(l.pendingDeletion),d?(0,i.Ft)(l.screensDrafts.screenId):void 0,t?.length?(0,i.d3)(l.screens.scriptId,t):void 0,s?.length?(0,i.d3)(l.screens.screenId,s):void 0))).map(e=>e.screen),u=f.length?await n.Z.query.pendingDeletion.findMany({where:(0,i.d3)(l.pendingDeletion.screenId,f.map(e=>e.screenId)),columns:{screenId:!0}}):[];return{data:[...f.map(e=>({...e,isDraft:!1,isDeleted:!1})),...c.map(e=>({...e.data,isDraft:!0,isDeleted:!1}))].sort((e,t)=>e.position-t.position).filter(e=>!u.map(e=>e.screenId).includes(e.screenId)).map((e,t)=>({...e,position:t+1}))}}catch(e){return d.Z.error("_listScreens ERROR",e.message),{data:[],errors:[e.message]}}}let b={allPublished:0,publishedWithDrafts:0,allDrafts:0,newDrafts:0,pendingDeletion:0};async function w(e){let{scriptsIds:t=[]}={...e};try{let e=t.length?(0,i.d3)(l.diagnoses.scriptId,t):void 0,s=t.length?(0,i.d3)(l.diagnosesDrafts.scriptId,t):void 0,[{count:a}]=await n.Z.select({count:(0,c.QX)()}).from(l.diagnosesDrafts).where(s),[{count:r}]=await n.Z.select({count:(0,c.QX)()}).from(l.diagnosesDrafts).where((0,i.xD)(s,(0,i.Ft)(l.diagnosesDrafts.diagnosisId))),[{count:d}]=await n.Z.select({count:(0,c.QX)()}).from(l.diagnosesDrafts).where((0,i.xD)(s,(0,i.K0)(l.diagnosesDrafts.diagnosisId))),[{count:o}]=await n.Z.select({count:(0,c.QX)()}).from(l.pendingDeletion).where((0,i.xD)(t.length?(0,i.or)((0,i.d3)(l.pendingDeletion.diagnosisScriptId,t)):void 0,(0,i.K0)(l.pendingDeletion.diagnosisId))),[{count:p}]=await n.Z.select({count:(0,c.QX)()}).from(l.diagnoses).where(e);return{data:{allPublished:p,publishedWithDrafts:d,allDrafts:a,newDrafts:r,pendingDeletion:o}}}catch(e){return d.Z.error("_getDiagnoses ERROR",e.message),{data:b,errors:[e.message]}}}async function S(e){try{let{scriptsIds:t=[],diagnosesIds:s=[],returnDraftsIfExist:d,withImagesOnly:o}={...e},p=s.filter(e=>!a.Z(e));if(s=s.filter(e=>a.Z(e)),p.length){let e=await n.Z.query.diagnoses.findMany({where:(0,i.d3)(l.diagnoses.oldDiagnosisId,p),columns:{diagnosisId:!0,oldDiagnosisId:!0}});p.forEach(t=>{let i=e.filter(e=>e.oldDiagnosisId===t)[0];s.push(i?.diagnosisId||r.Z())})}let c=(t=t.filter(e=>a.Z(e))).filter(e=>!a.Z(e));if(c.length){let e=await n.Z.query.scripts.findMany({where:(0,i.d3)(l.scripts.oldScriptId,c),columns:{scriptId:!0,oldScriptId:!0}});c.forEach(s=>{let i=e.filter(e=>e.oldScriptId===s)[0];t.push(i?.scriptId||r.Z())})}let f=d?await n.Z.query.diagnosesDrafts.findMany({where:(0,i.xD)(t?.length?(0,i.or)((0,i.d3)(l.diagnosesDrafts.scriptId,t),(0,i.d3)(l.diagnosesDrafts.scriptDraftId,t)):void 0,s?.length?(0,i.d3)(l.diagnosesDrafts.diagnosisDraftId,s):void 0)}):[],u=(await n.Z.select({diagnosis:l.diagnoses,pendingDeletion:l.pendingDeletion,script:{title:l.scripts.title,hospitalId:l.scripts.hospitalId},hospital:{name:l.hospitals.name}}).from(l.diagnoses).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.diagnosisId,l.diagnoses.diagnosisId)).leftJoin(l.diagnosesDrafts,(0,i.eq)(l.diagnosesDrafts.diagnosisId,l.diagnoses.diagnosisId)).leftJoin(l.scripts,(0,i.eq)(l.scripts.scriptId,l.diagnoses.scriptId)).leftJoin(l.hospitals,(0,i.xD)((0,i.eq)(l.scripts.scriptId,l.diagnoses.scriptId),(0,i.eq)(l.scripts.hospitalId,l.hospitals.hospitalId))).where((0,i.xD)((0,i.Ft)(l.diagnoses.deletedAt),(0,i.Ft)(l.pendingDeletion),d?(0,i.Ft)(l.diagnosesDrafts.diagnosisId):void 0,t?.length?(0,i.d3)(l.diagnoses.scriptId,t):void 0,s?.length?(0,i.d3)(l.diagnoses.diagnosisId,s):void 0,o?(0,i.or)((0,i.K0)(l.diagnoses.image1),(0,i.K0)(l.diagnoses.image2),(0,i.K0)(l.diagnoses.image3)):void 0))).map(e=>({...e.diagnosis,scriptTitle:e.script?.title||"",hospitalName:e.hospital?.name||""})),g=u.length?await n.Z.query.pendingDeletion.findMany({where:(0,i.d3)(l.pendingDeletion.diagnosisId,u.map(e=>e.diagnosisId)),columns:{diagnosisId:!0}}):[];return{data:[...u.map(e=>({...e,isDraft:!1,isDeleted:!1})),...f.map(e=>({...e.data,isDraft:!0,isDeleted:!1}))].sort((e,t)=>e.position-t.position).filter(e=>!g.map(e=>e.diagnosisId).includes(e.diagnosisId)).map(e=>({...e,scriptTitle:e.scriptTitle||"",hospitalName:e.hospitalName||""}))}}catch(e){return d.Z.error("_getDiagnoses ERROR",e.message),{data:[],errors:[e.message]}}}async function v(e){let{diagnosisId:t,returnDraftIfExists:s}={...e};try{if(!t)throw Error("Missing diagnosisId");let e=a.Z(t)?(0,i.eq)(l.diagnoses.diagnosisId,t):void 0,r=a.Z(t)?void 0:(0,i.eq)(l.diagnoses.oldDiagnosisId,t),d=e?(0,i.eq)(l.diagnosesDrafts.diagnosisDraftId,t):void 0,o=s&&d?await n.Z.query.diagnosesDrafts.findFirst({where:d}):void 0,p=o?{...o.data,isDraft:!1,isDeleted:!1}:null;if(p)return{data:p};let c=await n.Z.select({diagnosis:l.diagnoses,pendingDeletion:l.pendingDeletion,draft:l.diagnosesDrafts}).from(l.diagnoses).leftJoin(l.pendingDeletion,(0,i.eq)(l.pendingDeletion.diagnosisId,l.diagnoses.diagnosisId)).leftJoin(l.diagnosesDrafts,(0,i.eq)(l.diagnoses.diagnosisId,l.diagnosesDrafts.diagnosisDraftId)).where((0,i.xD)((0,i.Ft)(l.diagnoses.deletedAt),(0,i.Ft)(l.pendingDeletion),(0,i.or)(e,r))),f=c[0]?{...c[0].diagnosis,draft:c[0].draft||void 0}:null;o=s?f?.draft:void 0;let u=o?.data||f;if(!(p=u?{...u,isDraft:!1,isDeleted:!1}:null))return{data:null};return{data:p}}catch(e){return d.Z.error("_getDiagnosis ERROR",e.message),{errors:[e.message]}}}async function Z(e){try{let{scriptsIds:t=[],hospitalsIds:s=[],returnDraftsIfExist:a}={...e},r=await n.Z.query.hospitals.findMany({where:(0,i.xD)((0,i.Ft)(l.hospitals.deletedAt))}),d=t.length?(0,i.d3)(l.scripts.scriptId,t):void 0,o=s.length?(0,i.d3)(l.scripts.hospitalId,s):void 0,p=[d,o],c=await n.Z.query.scripts.findMany({where:p.length?(0,i.xD)(...p):void 0,with:{draft:!!a||void 0,screens:{with:{draft:!!a||void 0}}}});c=c.map(e=>({...e,...a&&e.draft?e.draft.data:null,screens:e.screens.map(e=>{let t={...e,...a&&e.draft?e.draft.data:null};return"mwi_edliz_summary_table"===t.type&&(t.items=y.mwi_edliz_summary_table),"zw_edliz_summary_table"===t.type&&(t.items=y.zw_edliz_summary_table),t}).sort((e,t)=>e.position-t.position)})).sort((e,t)=>e.position-t.position);let f=[];return c.forEach(e=>{let t=r.filter(t=>t.hospitalId===e.hospitalId)[0];f.push({scriptId:e.scriptId,title:e.title,hospitalName:t?.name||"",screens:e.screens.map(e=>{let t=e.items,s=e.fields,i=[{label:e.label,key:e.key,type:e.type,..."single_select"===e.type?{dataType:"single_select_option",value:null,valueLabel:null}:{dataType:e.dataType,value:null,valueLabel:null}}];switch(e.type){case"progress":case"edliz_summary_table":case"mwi_edliz_summary_table":case"zw_edliz_summary_table":case"management":i=[];break;case"yesno":i=[{value:"true",label:e.positiveLabel||"Yes"},{value:"false",label:e.negativeLabel||"Yes"}].map(t=>({label:e.label,key:e.key,type:e.type,dataType:"boolean",value:t.value,valueLabel:t.label}));break;case"diagnosis":i=t.map(t=>({value:t.id,valueLabel:t.label,label:t.label,key:t.id,type:e.type,dataType:"diagnosis"}));break;case"checklist":i=t.map(t=>({value:t.id,valueLabel:t.label,label:t.label,key:t.key,type:e.type,dataType:null}));break;case"form":i=s.map(e=>{let t=e.dataType;switch(e.type){case"datetime":t="datetime";break;case"date":t="date";break;case"time":t="time";break;case"dropdown":t="dropdown";break;case"number":t="number";break;case"text":t="string",("uid"===`${e.key}`.toLowerCase()||`${e.key}`.toLowerCase().includes("nuid"))&&(t="uid");break;default:t=e.dataType}return"dropdown"===e.type?(e.values||"").split("\n").map((e="")=>e.trim()).filter(e=>e).map(e=>({value:(e=e.split(","))[0],label:e[1]})).map(t=>({label:e.label,key:e.key,type:e.type,dataType:"dropdown",value:t.value,valueLabel:t.label})):[{label:e.label,key:e.key,type:e.type,dataType:t,value:null,valueLabel:null}]}).reduce((e,t)=>[...e,...t],[]);break;case"multi_select":i=t.map(t=>({label:t.label,key:t.id,type:e.type,dataType:"multi_select_option",value:t.id,valueLabel:t.label}))}return{screenId:e.screenId,type:e.type,title:e.title,ref:e.refId,fields:i}})})}),{data:f}}catch(e){return{errors:[e.message],data:[]}}}},88317:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});let i=(0,s(55802).io)(process.env.NEXT_PUBLIC_APP_URL)}};