"use strict";exports.id=2179,exports.ids=[2179],exports.modules={82179:(e,i,s)=>{s.d(i,{A:()=>I});var a=s(10326),t=s(17577),r=s(35047),n=s(15491),l=s(47463),o=s(2165),d=s(7890),g=s(34474),u=s(81646),m=s(53313),c=s(90772),h=s(54432),y=s(87673),x=s(31048),v=s(11870),f=s(75172),b=s(58464),p=s(46670),j=s(79131),N=s(51605);let F=[{value:"drug",label:"Drug"},{value:"fluid",label:"Fluid"}],A=(e,i="drug")=>({itemId:`${e?.itemId||(0,l.Z)()}`,type:`${e?.type||i}`,key:`${e?.key||""}`,keyId:`${e?.keyId||""}`,drug:`${e?.drug||""}`,minGestation:`${e?.minGestation===null?"":e?.minGestation}`,maxGestation:`${e?.maxGestation===null?"":e?.maxGestation}`,minWeight:`${e?.minWeight===null?"":e?.minWeight}`,maxWeight:`${e?.maxWeight===null?"":e?.maxWeight}`,minAge:`${e?.minAge===null?"":e?.minAge}`,maxAge:`${e?.maxAge===null?"":e?.maxAge}`,dosage:`${e?.dosage===null?"":e?.dosage}`,dosageMultiplier:`${e?.dosageMultiplier===null?"":e?.dosageMultiplier}`,hourlyFeed:`${e?.hourlyFeed===null?"":e?.hourlyFeed}`,hourlyFeedDivider:`${e?.hourlyFeedDivider===null?"":e?.hourlyFeedDivider}`,dayOfLife:`${e?.dayOfLife||""}`,dosageText:`${e?.dosageText||""}`,managementText:`${e?.managementText||""}`,gestationKey:`${e?.gestationKey||""}`,weightKey:`${e?.weightKey||""}`,diagnosisKey:`${e?.diagnosisKey||""}`,gestationKeyId:`${e?.gestationKeyId||""}`,weightKeyId:`${e?.weightKeyId||""}`,diagnosisKeyId:`${e?.diagnosisKeyId||""}`,condition:`${e?.condition||""}`,administrationFrequency:`${e?.administrationFrequency||""}`,drugUnit:`${e?.drugUnit||""}`,routeOfAdministration:`${e?.routeOfAdministration||""}`,ageKey:`${e?.ageKey||""}`,ageKeyId:`${e?.ageKeyId||""}`,validationType:`${e?.validationType||"default"}`});function I({disabled:e,item:i,floating:s,onChange:l}){let I=(0,N.v)({isDraft:!!i?.isDraft,userId:i?.draftCreatedByUserId});e=e||I;let k=(0,r.useRouter)(),C=(0,r.useSearchParams)(),w=(0,t.useMemo)(()=>n.Z.parse(C.toString()),[C]),{itemId:K,addItem:$}=w,[D,G]=(0,o.Z)(),[W,T]=(0,o.Z)(),[S,_]=(0,t.useState)(!1),[M,L]=(0,t.useState)(A(i,$)),{keys:q,loading:O}=(0,f.a)(),{confirm:Z}=(0,p.t)(),E=(0,t.useCallback)(()=>{let e=()=>{l({...M,minWeight:M.minWeight?Number(M.minWeight):null,maxWeight:M.maxWeight?Number(M.maxWeight):null,minGestation:M.minGestation?Number(M.minGestation):null,maxGestation:M.maxGestation?Number(M.maxGestation):null,hourlyFeed:M.hourlyFeed?Number(M.hourlyFeed):null,hourlyFeedDivider:M.hourlyFeedDivider?Number(M.hourlyFeedDivider):null,minAge:M.minAge?Number(M.minAge):null,maxAge:M.maxAge?Number(M.maxAge):null,dosage:M.dosage?Number(M.dosage):null,dosageMultiplier:M.dosageMultiplier?Number(M.dosageMultiplier):null,type:M.type}),_(!1)};i&&M.key!==i?.key?Z(e,{danger:!0,title:"Confirm key change",message:`
                    <p class="text-xl">Are you sure you want to change key?</p>
                    <p>All references to the old key (${i.key}) will also be updated to: ${M.key}</p>
                `,positiveLabel:"Yes, keep changes",negativeLabel:"No, do not save"}):e()},[M,i,l]),U=(0,t.useCallback)(()=>{_(!1),L(A(void 0,$)),k.push(`?${n.Z.stringify({...w,itemId:void 0,addItem:void 0})}`);let e=G?.top||0;setTimeout(()=>window.scrollTo({top:e}),500)},[w,G,k.push]),{isFormComplete:R,isDrug:P,isFluid:B,validateWithCondition:J}=(0,t.useMemo)(()=>{let e="drug"===M.type,i="fluid"===M.type,s="condition"===M.validationType,a=!!(M.type&&M.key&&M.drug&&M.managementText&&M.dosageText&&M.administrationFrequency&&M.drugUnit&&M.routeOfAdministration&&M.dosage&&s?M.condition:M.weightKey&&M.minWeight&&M.maxWeight&&M.gestationKey&&M.minGestation&&M.maxGestation&&M.ageKey&&M.minAge&&M.maxAge&&Number(M.minGestation||"0")<=Number(M.maxGestation||"0")&&Number(M.minWeight||"0")<=Number(M.maxWeight||"0")&&Number(M.minAge||"0")<=Number(M.maxAge||"0")&&(!e||M.diagnosisKey)&&(!i||M.condition&&M.hourlyFeed&&M.hourlyFeedDivider&&Number(M.hourlyFeed||"0")<=Number(M.hourlyFeed||"0")&&Number(M.hourlyFeedDivider||"0")<=Number(M.hourlyFeedDivider||"0")));return{isDrug:e,isFluid:i,isFormComplete:a,validateWithCondition:s}},[M,$]),z=(0,t.useCallback)(()=>!R||O||e,[R,O,e]),H=(0,a.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"type",children:"Type *"}),(0,a.jsxs)(g.Ph,{value:M.type,required:!0,name:"type",disabled:e,onValueChange:e=>{let s=A(i?.type===e?i:void 0,$);Z(()=>L(i=>({...i,type:e,hourlyFeed:s.hourlyFeed,hourlyFeedDivider:s.hourlyFeedDivider,condition:s.condition,diagnosisKey:s.diagnosisKey,drugUnit:s.drugUnit})),{danger:!0,title:"Confirm type change",message:`
                                <p class="text-xl">Are you sure you want to change type?</p>
                                <ol style="list-style:auto;margin:10px;">
                                    <li>Some fields will be cleared as they do not apply on all types!</li>
                                    <li>All references to this ${M.type} will be removed.</li>
                                </ol>
                            `,positiveLabel:"Yes, change type",negativeLabel:"No, keep the current type"})},children:[a.jsx(g.i4,{children:a.jsx(g.ki,{placeholder:"Select type"})}),a.jsx(g.Bw,{children:a.jsx(g.DI,{children:F.map(e=>a.jsx(g.Ql,{value:e.value,children:e.label},e.value))})})]})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"key",children:"Key *"}),a.jsx(h.I,{name:"key",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.key,disabled:e,onChange:e=>L(i=>({...i,key:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"drug",children:[(0,j.Z)(M.type)," *"]}),a.jsx(h.I,{name:"drug",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.drug,disabled:e,onChange:e=>L(i=>({...i,drug:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"condition",children:["Condition ",J?"*":""]}),a.jsx(y.g,{rows:3,name:"condition",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.condition,disabled:e,onChange:e=>L(i=>({...i,condition:e.target.value}))}),(0,a.jsxs)("span",{className:"font-bold opacity-50 text-xs",children:["e.g ",b._S]})]}),(0,a.jsxs)("div",{className:"flex gap-x-2",children:[a.jsx(m.X,{name:"validationType",id:"validationType",disabled:e,checked:"condition"===M.validationType,onCheckedChange:e=>L(e=>({...e,validationType:"condition"===e.validationType?"default":"condition"}))}),a.jsx(x._,{secondary:!0,htmlFor:"validationType",children:"Validate with conditional expression only"})]}),P&&(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"diagnosisKey",children:["Diagnosis Key ",J?"":"*"]}),a.jsx(y.g,{rows:3,name:"gestationKey",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.diagnosisKey,disabled:e,onChange:e=>L(i=>({...i,diagnosisKey:e.target.value}))}),a.jsx("span",{className:"font-bold opacity-50 text-xs",children:"e.g NSep,Premature,Dehyd"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"gestationKey",children:["Gestation Key ",J?"":"*"]}),a.jsx(u.L,{modal:!0,value:`${M.gestationKey||""}`,disabled:e,onChange:([e])=>{L(i=>({...i,gestationKey:e.name,gestationKeyId:e?.uniqueKey}))}})]}),(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"minGestation",children:["Min Gestation (weeks) ",J?"":"*"]}),a.jsx(h.I,{name:"minGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.minGestation,type:"number",disabled:e,onChange:e=>{let i=e.target.value,s=M.maxGestation;i||(s=""),L(e=>({...e,minGestation:i,maxGestation:s}))}})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"maxGestation",error:Number(M.minGestation||"0")>Number(M.maxGestation||"0"),children:["Max Gestation (weeks) ",J?"":"*"]}),a.jsx(h.I,{name:"maxGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.maxGestation,type:"number",disabled:e||!M.minGestation,min:M.minGestation,error:Number(M.minGestation||"0")>Number(M.maxGestation||"0"),onChange:e=>L(i=>({...i,maxGestation:e.target.value}))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"weightKey",children:["Weight Key ",J?"":"*"]}),a.jsx(u.L,{modal:!0,value:`${M.weightKey||""}`,disabled:e,onChange:([e])=>{L(i=>({...i,weightKey:e.name,weightKeyId:e?.uniqueKey}))}})]}),(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"minWeight",children:["Min Weight (grams) ",J?"":"*"]}),a.jsx(h.I,{name:"minWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.minWeight,type:"number",disabled:e,onChange:e=>{let i=e.target.value,s=M.maxWeight;i||(s=""),L(e=>({...e,minWeight:i,maxWeight:s}))}})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"maxWeight",error:Number(M.minWeight||"0")>Number(M.maxWeight||"0"),children:["Max Weight (grams) ",J?"":"*"]}),a.jsx(h.I,{name:"maxWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.maxWeight,type:"number",disabled:e||!M.minWeight,min:M.minWeight,error:Number(M.minWeight||"0")>Number(M.maxWeight||"0"),onChange:e=>L(i=>({...i,maxWeight:e.target.value}))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"ageKey",children:["Day of Life (Age) Key ",J?"":"*"]}),a.jsx(u.L,{modal:!0,value:`${M.ageKey||""}`,disabled:e,onChange:([e])=>{L(i=>({...i,ageKey:e.name,ageKeyId:e?.uniqueKey}))}})]}),(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"minAge",children:["Min Day of Life (Age - hours) ",J?"":"*"]}),a.jsx(h.I,{name:"minAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.minAge,type:"number",disabled:e,onChange:e=>{let i=e.target.value,s=M.maxAge;i||(s=""),L(e=>({...e,minAge:i,maxAge:s}))}})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"maxAge",error:Number(M.minAge||"0")>Number(M.maxAge||"0"),children:["Max Day of Life (Age - hours) ",J?"":"*"]}),a.jsx(h.I,{name:"maxAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.maxAge,type:"number",disabled:e||!M.minAge,min:M.minAge,error:Number(M.minAge||"0")>Number(M.maxAge||"0"),onChange:e=>L(i=>({...i,maxAge:e.target.value}))})]})]}),B&&a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx(x._,{secondary:!0,htmlFor:"hourlyFeed",children:"Hourly feed *"}),a.jsx(h.I,{name:"hourlyFeed",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.hourlyFeed,type:"number",disabled:e,onChange:e=>L(i=>({...i,hourlyFeed:e.target.value}))})]}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx(x._,{secondary:!0,htmlFor:"hourlyFeedDivider",children:"Hourly feed divider *"}),a.jsx(h.I,{name:"hourlyFeedDivider",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.hourlyFeedDivider,type:"number",disabled:e,onChange:e=>L(i=>({...i,hourlyFeedDivider:e.target.value}))})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(x._,{secondary:!0,htmlFor:"dosage",children:["Dose (e.g. ",B?"ml/kg/24hrs":"mg/kg",") *"]}),a.jsx(h.I,{name:"dosage",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.dosage,disabled:e,onChange:e=>L(i=>({...i,dosage:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"dosageMultiplier",children:"Drug Dose Multiplier *"}),a.jsx(h.I,{name:"dosageMultiplier",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.dosageMultiplier,disabled:e,onChange:e=>L(i=>({...i,dosageMultiplier:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"drugUnit",children:"Drug Unit *"}),a.jsx(h.I,{name:"drugUnit",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.drugUnit,disabled:e,onChange:e=>L(i=>({...i,drugUnit:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"administrationFrequency",children:"Administration Frequency *"}),a.jsx(h.I,{name:"administrationFrequency",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.administrationFrequency,disabled:e,onChange:e=>L(i=>({...i,administrationFrequency:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"routeOfAdministration",children:"Route of Administration *"}),a.jsx(h.I,{name:"routeOfAdministration",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.routeOfAdministration,disabled:e,onChange:e=>L(i=>({...i,routeOfAdministration:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"managementText",children:"Management text *"}),a.jsx(h.I,{name:"managementText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.managementText,disabled:e,onChange:e=>L(i=>({...i,managementText:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx(x._,{secondary:!0,htmlFor:"weight",children:"Dosage text *"}),a.jsx(h.I,{name:"dosageText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:M.dosageText,disabled:e,onChange:e=>L(i=>({...i,dosageText:e.target.value}))})]})]});return(0,a.jsxs)(a.Fragment,{children:[O&&a.jsx(v.a,{overlay:!0}),a.jsx("div",{ref:D,children:!1===s?H:a.jsx(d.yo,{open:S,onOpenChange:e=>{e||U()},children:(0,a.jsxs)(d.ue,{hideCloseButton:!0,side:"right",className:"p-0 m-0 flex flex-col w-full max-w-full sm:max-w-[80%] md:max-w-[80%] lg:max-w-[50%]",children:[(0,a.jsxs)(d.Tu,{className:"flex flex-row items-center py-2 px-4 border-b border-b-border text-left sm:text-left",children:[(0,a.jsxs)(d.bC,{children:[$?"Add":"",K?"Edit":""," ",i?.type||$]}),a.jsx(d.Ei,{className:"hidden"})]}),a.jsx("div",{ref:W,className:"flex-1 py-2 px-0 overflow-y-auto",children:a.jsx("div",{className:"px-4",children:H})}),(0,a.jsxs)("div",{className:"border-t border-t-border px-4 py-2 flex gap-x-2",children:[a.jsx("span",{className:"text-danger text-xs my-auto",children:"* Required"}),a.jsx("div",{className:"ml-auto"}),a.jsx(d.sw,{asChild:!0,children:a.jsx(c.z,{variant:"ghost",onClick:()=>{},children:"Cancel"})}),a.jsx(c.z,{onClick:()=>E(),disabled:z(),children:"Save"})]})]})})})]})}},75172:(e,i,s)=>{s.d(i,{a:()=>m});var a=s(17577),t=s(35047),r=s(15491),n=s(44099),l=s(60114),o=s(96221);s(63697);var d=s(61198);let g={initialised:!1,loading:!1,keys:[],drugs:[]},u=(0,l.Ue)(e=>g);function m(){let[e,i]=(0,a.useState)(""),s=(0,d.N)(e),l=u(),{drugs:m}=l,c=(0,t.useRouter)(),h=(0,t.useSearchParams)(),y=(0,a.useMemo)(()=>r.Z.parse(h.toString()),[h]),{itemId:x}=y,v=(0,a.useMemo)(()=>m.filter(e=>e.itemId===x||e.key===x)[0]?.itemId,[x,m]),{alert:f}=(0,o.s)(),b=(0,a.useCallback)(()=>{let e=[],i=m.map(e=>[e.drug||"",e.type||"",e.key||"",e.dosageText||"",e.itemId]);return{tableData:i=i.filter((i,a)=>{let t=!s||JSON.stringify(i).toLowerCase().includes(s.toLowerCase());return t&&e.push(m[a]),t}),filteredDrugs:e}},[m,s]),{tableData:p,filteredDrugs:j}=(0,a.useMemo)(()=>b(),[b]),N=(0,a.useCallback)(async()=>{try{i(""),u.setState({loading:!0});let e=await n.Z.get("/api/drugs-library?data="+JSON.stringify({returnDraftsIfExist:!0}));if(e.data.errors?.length)throw Error(e.data.errors?.join(", "));u.setState({drugs:e.data.data})}catch(e){f({title:"Error",message:e.message,variant:"error"})}finally{u.setState({loading:!1})}},[f]);!function({events:e}){(0,a.useMemo)(()=>e,[e]),(0,a.useRef)({eventsTimeouts:{},eventsTimestamps:{}}),(0,a.useRef)(new Date().getTime()),(0,t.useRouter)()}({events:[{name:"data_changed",onEvent:{callback:async()=>{await N(),c.refresh()}}}]});let F=(0,a.useCallback)(async e=>{try{u.setState(i=>({loading:!0,drugs:i.drugs.filter(i=>!e.includes(i.itemId))}));let i=await n.Z.delete("/api/drugs-library?data="+JSON.stringify({itemsIds:e}));if(i.data.errors?.length)throw Error(i.data.errors?.join(", "));c.refresh(),f({title:"",message:"Drug deleted successfully!",variant:"success"})}catch(e){f({title:"Error",message:e.message,variant:"error"})}finally{u.setState({loading:!1})}},[f,c.refresh]),A=(0,a.useCallback)(async e=>{try{u.setState({loading:!0});let i=[],s=[],a=m;u.setState(t=>(a=!v&&e?[...t.drugs,e]:t.drugs.map(a=>a.itemId!==e?.itemId?a:(e&&(a.key!==e.key&&s.push({old:a.key,new:e.key}),a.type!==e.type&&i.push(a.key)),{...a,...e})),{loading:!0,drugs:a}));let t={data:e?[e]:a,broadcastAction:!0},r=await n.Z.post("/api/drugs-library/save",t);if(r.data.errors?.length)throw Error(r.data.errors?.join(", "));await N(),c.refresh(),f({title:"",message:`Drug${e?"":"s"} saved successfully!`,variant:"success"})}catch(e){f({title:"Error",message:e.message,variant:"error"})}finally{u.setState({loading:!1})}},[m,v,c.refresh]),I=(0,a.useCallback)(async e=>{try{u.setState({loading:!0});let i={data:e.map(e=>({itemId:e})),broadcastAction:!0},s=await n.Z.post("/api/drugs-library/copy",i);if(s.data.errors?.length)throw Error(s.data.errors?.join(", "));await N(),c.refresh(),f({title:"",message:`Drug${e.length<2?"":"s"} copied successfully!`,variant:"success"})}catch(e){f({title:"Error",message:e.message,variant:"error"})}finally{u.setState({loading:!1})}},[c.refresh]);return(0,a.useCallback)(()=>{u.setState(g)},[]),{...l,filteredDrugs:j,tableData:p,selectedItemId:v,searchValue:s,setSearchValue:i,addLink:e=>`?${r.Z.stringify({...y,addItem:e})}`,editLink:e=>`?${r.Z.stringify({...y,itemId:e})}`,getDrugs:N,deleteDrugs:F,saveDrugs:A,copyDrugs:I}}}};