"use strict";exports.id=7090,exports.ids=[7090],exports.modules={82179:(e,a,i)=>{i.d(a,{A:()=>A});var s=i(10326),t=i(17577),r=i(35047),l=i(15491),n=i(47463),d=i(2165),o=i(7890),u=i(34474),c=i(81646),m=i(53313),g=i(90772),y=i(54432),h=i(87673),x=i(31048),f=i(11870),v=i(75172),p=i(58464),b=i(46670),j=i(79131),N=i(51605),k=i(3529);i(37530);var I=i(24875);let w=e=>{if(e)return e?.key||e?.drug||e?.feed||e?.fluid||e?.name||e?.title||void 0},C=[{value:"drug",label:"Drug"},{value:"fluid",label:"Fluid"}],F=(e,a="drug")=>({itemId:`${e?.itemId||(0,n.Z)()}`,type:`${e?.type||a}`,key:`${e?.key||""}`,keyId:`${e?.keyId||""}`,drug:`${e?.drug||""}`,minGestation:`${e?.minGestation===null?"":e?.minGestation}`,maxGestation:`${e?.maxGestation===null?"":e?.maxGestation}`,minWeight:`${e?.minWeight===null?"":e?.minWeight}`,maxWeight:`${e?.maxWeight===null?"":e?.maxWeight}`,minAge:`${e?.minAge===null?"":e?.minAge}`,maxAge:`${e?.maxAge===null?"":e?.maxAge}`,dosage:`${e?.dosage===null?"":e?.dosage}`,dosageMultiplier:`${e?.dosageMultiplier===null?"":e?.dosageMultiplier}`,hourlyFeed:`${e?.hourlyFeed===null?"":e?.hourlyFeed}`,hourlyFeedDivider:`${e?.hourlyFeedDivider===null?"":e?.hourlyFeedDivider}`,dayOfLife:`${e?.dayOfLife||""}`,dosageText:`${e?.dosageText||""}`,managementText:`${e?.managementText||""}`,gestationKey:`${e?.gestationKey||""}`,weightKey:`${e?.weightKey||""}`,diagnosisKey:`${e?.diagnosisKey||""}`,gestationKeyId:`${e?.gestationKeyId||""}`,weightKeyId:`${e?.weightKeyId||""}`,diagnosisKeyId:`${e?.diagnosisKeyId||""}`,condition:`${e?.condition||""}`,administrationFrequency:`${e?.administrationFrequency||""}`,drugUnit:`${e?.drugUnit||""}`,routeOfAdministration:`${e?.routeOfAdministration||""}`,ageKey:`${e?.ageKey||""}`,ageKeyId:`${e?.ageKeyId||""}`,validationType:`${e?.validationType||"default"}`}),K=e=>{if(!e)return null;let{isDraft:a,draftCreatedByUserId:i,isDeleted:s,preferences:t,...r}=e;return{...r}};function A({disabled:e,item:a,floating:i,onChange:n}){let A=(0,N.v)({isDraft:!!a?.isDraft,userId:a?.draftCreatedByUserId});e=e||A;let $=(0,r.useRouter)(),S=(0,r.useSearchParams)(),D=(0,t.useMemo)(()=>l.Z.parse(S.toString()),[S]),{itemId:_,addItem:G}=D,[T,M]=(0,d.Z)(),[W,L]=(0,d.Z)(),[Z,q]=(0,t.useState)(!1),[O,U]=(0,t.useState)(F(a,G)),{keys:E,loading:R}=(0,v.a)(),{authenticatedUser:V}=(0,k.b)(),{confirm:z}=(0,b.t)(),B=(0,t.useRef)(null),P=(0,t.useRef)(null);(0,t.useRef)(null);let H=(0,t.useCallback)(async()=>{let e={...O,minWeight:O.minWeight?Number(O.minWeight):null,maxWeight:O.maxWeight?Number(O.maxWeight):null,minGestation:O.minGestation?Number(O.minGestation):null,maxGestation:O.maxGestation?Number(O.maxGestation):null,hourlyFeed:O.hourlyFeed?Number(O.hourlyFeed):null,hourlyFeedDivider:O.hourlyFeedDivider?Number(O.hourlyFeedDivider):null,minAge:O.minAge?Number(O.minAge):null,maxAge:O.maxAge?Number(O.maxAge):null,dosage:O.dosage?Number(O.dosage):null,dosageMultiplier:O.dosageMultiplier?Number(O.dosageMultiplier):null,type:O.type},i=K(e),s=e.itemId,t=async()=>{try{if(!a&&i&&s){let a=(await I.pb.getEntityChanges(s,"drugsLibraryItem")).find(e=>"create"===e.action),t=w(e)||"Drugs Library Item",r=w(e)||"New Library Item";a?.id?await I.pb.updateChange(a.id,{fieldName:r,newValue:i,timestamp:Date.now(),userId:V?.userId,userName:V?.displayName,entityTitle:t,fullSnapshot:i}):await I.pb.addChange({entityType:"drugsLibraryItem",entityId:s,entityTitle:t,action:"create",fieldPath:"drugsLibraryItem",fieldName:r,oldValue:null,newValue:i,userId:V?.userId,userName:V?.displayName,fullSnapshot:i})}else B.current&&P.current&&i&&await B.current.trackChanges(i,"Drugs library item saved")}catch(e){console.error("Failed to track drugs library changes",e)}await n(e),q(!1)};a&&O.key!==a?.key?z(()=>{t()},{danger:!0,title:"Confirm key change",message:`
                    <p class="text-xl">Are you sure you want to change key?</p>
                    <p>All references to the old key (${a.key}) will also be updated to: ${O.key}</p>
                `,positiveLabel:"Yes, keep changes",negativeLabel:"No, do not save"}):await t()},[O,a,n,z,V?.userId,V?.displayName]),J=(0,t.useCallback)(()=>{q(!1),U(F(void 0,G)),$.push(`?${l.Z.stringify({...D,itemId:void 0,addItem:void 0})}`);let e=M?.top||0;setTimeout(()=>window.scrollTo({top:e}),500)},[D,M,$,G]),{isFormComplete:Y,isDrug:Q,isFluid:X,validateWithCondition:ee}=(0,t.useMemo)(()=>{let e="drug"===O.type,a="fluid"===O.type,i="condition"===O.validationType,s=!!(O.type&&O.key&&O.drug&&O.managementText&&O.dosageText&&O.administrationFrequency&&O.drugUnit&&O.routeOfAdministration&&O.dosage&&i?O.condition:O.weightKey&&O.minWeight&&O.maxWeight&&O.gestationKey&&O.minGestation&&O.maxGestation&&O.ageKey&&O.minAge&&O.maxAge&&Number(O.minGestation||"0")<=Number(O.maxGestation||"0")&&Number(O.minWeight||"0")<=Number(O.maxWeight||"0")&&Number(O.minAge||"0")<=Number(O.maxAge||"0")&&(!e||O.diagnosisKey)&&(!a||O.condition&&O.hourlyFeed&&O.hourlyFeedDivider&&Number(O.hourlyFeed||"0")<=Number(O.hourlyFeed||"0")&&Number(O.hourlyFeedDivider||"0")<=Number(O.hourlyFeedDivider||"0")));return{isDrug:e,isFluid:a,isFormComplete:s,validateWithCondition:i}},[O]),ea=(0,t.useCallback)(()=>!Y||R||e,[Y,R,e]),ei=(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"type",children:"Type *"}),(0,s.jsxs)(u.Ph,{value:O.type,required:!0,name:"type",disabled:e,onValueChange:e=>{let i=F(a?.type===e?a:void 0,G);z(()=>U(a=>({...a,type:e,hourlyFeed:i.hourlyFeed,hourlyFeedDivider:i.hourlyFeedDivider,condition:i.condition,diagnosisKey:i.diagnosisKey,drugUnit:i.drugUnit})),{danger:!0,title:"Confirm type change",message:`
                                <p class="text-xl">Are you sure you want to change type?</p>
                                <ol style="list-style:auto;margin:10px;">
                                    <li>Some fields will be cleared as they do not apply on all types!</li>
                                    <li>All references to this ${O.type} will be removed.</li>
                                </ol>
                            `,positiveLabel:"Yes, change type",negativeLabel:"No, keep the current type"})},children:[s.jsx(u.i4,{children:s.jsx(u.ki,{placeholder:"Select type"})}),s.jsx(u.Bw,{children:s.jsx(u.DI,{children:C.map(e=>s.jsx(u.Ql,{value:e.value,children:e.label},e.value))})})]})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"key",children:"Key *"}),s.jsx(y.I,{name:"key",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.key,disabled:e,onChange:e=>U(a=>({...a,key:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"drug",children:[(0,j.Z)(O.type)," *"]}),s.jsx(y.I,{name:"drug",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.drug,disabled:e,onChange:e=>U(a=>({...a,drug:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"condition",children:["Condition ",ee?"*":""]}),s.jsx(h.g,{rows:3,name:"condition",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.condition,disabled:e,onChange:e=>U(a=>({...a,condition:e.target.value}))}),(0,s.jsxs)("span",{className:"font-bold opacity-50 text-xs",children:["e.g ",p._S]})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[s.jsx(m.X,{name:"validationType",id:"validationType",disabled:e,checked:"condition"===O.validationType,onCheckedChange:e=>U(e=>({...e,validationType:"condition"===e.validationType?"default":"condition"}))}),s.jsx(x._,{secondary:!0,htmlFor:"validationType",children:"Validate with conditional expression only"})]}),Q&&(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"diagnosisKey",children:["Diagnosis Key ",ee?"":"*"]}),s.jsx(h.g,{rows:3,name:"gestationKey",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.diagnosisKey,disabled:e,onChange:e=>U(a=>({...a,diagnosisKey:e.target.value}))}),s.jsx("span",{className:"font-bold opacity-50 text-xs",children:"e.g NSep,Premature,Dehyd"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"gestationKey",children:["Gestation Key ",ee?"":"*"]}),s.jsx(c.L,{modal:!0,value:`${O.gestationKey||""}`,disabled:e,onChange:([e])=>{U(a=>({...a,gestationKey:e.name,gestationKeyId:e?.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"minGestation",children:["Min Gestation (weeks) ",ee?"":"*"]}),s.jsx(y.I,{name:"minGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.minGestation,type:"number",disabled:e,onChange:e=>{let a=e.target.value,i=O.maxGestation;a||(i=""),U(e=>({...e,minGestation:a,maxGestation:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"maxGestation",error:Number(O.minGestation||"0")>Number(O.maxGestation||"0"),children:["Max Gestation (weeks) ",ee?"":"*"]}),s.jsx(y.I,{name:"maxGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.maxGestation,type:"number",disabled:e||!O.minGestation,min:O.minGestation,error:Number(O.minGestation||"0")>Number(O.maxGestation||"0"),onChange:e=>U(a=>({...a,maxGestation:e.target.value}))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"weightKey",children:["Weight Key ",ee?"":"*"]}),s.jsx(c.L,{modal:!0,value:`${O.weightKey||""}`,disabled:e,onChange:([e])=>{U(a=>({...a,weightKey:e.name,weightKeyId:e?.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"minWeight",children:["Min Weight (grams) ",ee?"":"*"]}),s.jsx(y.I,{name:"minWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.minWeight,type:"number",disabled:e,onChange:e=>{let a=e.target.value,i=O.maxWeight;a||(i=""),U(e=>({...e,minWeight:a,maxWeight:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"maxWeight",error:Number(O.minWeight||"0")>Number(O.maxWeight||"0"),children:["Max Weight (grams) ",ee?"":"*"]}),s.jsx(y.I,{name:"maxWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.maxWeight,type:"number",disabled:e||!O.minWeight,min:O.minWeight,error:Number(O.minWeight||"0")>Number(O.maxWeight||"0"),onChange:e=>U(a=>({...a,maxWeight:e.target.value}))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"ageKey",children:["Day of Life (Age) Key ",ee?"":"*"]}),s.jsx(c.L,{modal:!0,value:`${O.ageKey||""}`,disabled:e,onChange:([e])=>{U(a=>({...a,ageKey:e.name,ageKeyId:e?.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"minAge",children:["Min Day of Life (Age - hours) ",ee?"":"*"]}),s.jsx(y.I,{name:"minAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.minAge,type:"number",disabled:e,onChange:e=>{let a=e.target.value,i=O.maxAge;a||(i=""),U(e=>({...e,minAge:a,maxAge:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"maxAge",error:Number(O.minAge||"0")>Number(O.maxAge||"0"),children:["Max Day of Life (Age - hours) ",ee?"":"*"]}),s.jsx(y.I,{name:"maxAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.maxAge,type:"number",disabled:e||!O.minAge,min:O.minAge,error:Number(O.minAge||"0")>Number(O.maxAge||"0"),onChange:e=>U(a=>({...a,maxAge:e.target.value}))})]})]}),X&&s.jsx(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx(x._,{secondary:!0,htmlFor:"hourlyFeed",children:"Hourly feed *"}),s.jsx(y.I,{name:"hourlyFeed",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.hourlyFeed,type:"number",disabled:e,onChange:e=>U(a=>({...a,hourlyFeed:e.target.value}))})]}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx(x._,{secondary:!0,htmlFor:"hourlyFeedDivider",children:"Hourly feed divider *"}),s.jsx(y.I,{name:"hourlyFeedDivider",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.hourlyFeedDivider,type:"number",disabled:e,onChange:e=>U(a=>({...a,hourlyFeedDivider:e.target.value}))})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(x._,{secondary:!0,htmlFor:"dosage",children:["Dose (e.g. ",X?"ml/kg/24hrs":"mg/kg",") *"]}),s.jsx(y.I,{name:"dosage",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.dosage,disabled:e,onChange:e=>U(a=>({...a,dosage:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"dosageMultiplier",children:"Drug Dose Multiplier *"}),s.jsx(y.I,{name:"dosageMultiplier",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.dosageMultiplier,disabled:e,onChange:e=>U(a=>({...a,dosageMultiplier:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"drugUnit",children:"Drug Unit *"}),s.jsx(y.I,{name:"drugUnit",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.drugUnit,disabled:e,onChange:e=>U(a=>({...a,drugUnit:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"administrationFrequency",children:"Administration Frequency *"}),s.jsx(y.I,{name:"administrationFrequency",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.administrationFrequency,disabled:e,onChange:e=>U(a=>({...a,administrationFrequency:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"routeOfAdministration",children:"Route of Administration *"}),s.jsx(y.I,{name:"routeOfAdministration",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.routeOfAdministration,disabled:e,onChange:e=>U(a=>({...a,routeOfAdministration:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"managementText",children:"Management text *"}),s.jsx(y.I,{name:"managementText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.managementText,disabled:e,onChange:e=>U(a=>({...a,managementText:e.target.value}))})]}),(0,s.jsxs)("div",{children:[s.jsx(x._,{secondary:!0,htmlFor:"weight",children:"Dosage text *"}),s.jsx(y.I,{name:"dosageText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:O.dosageText,disabled:e,onChange:e=>U(a=>({...a,dosageText:e.target.value}))})]})]});return(0,s.jsxs)(s.Fragment,{children:[R&&s.jsx(f.a,{overlay:!0}),s.jsx("div",{ref:T,children:!1===i?ei:s.jsx(o.yo,{open:Z,onOpenChange:e=>{e||J()},children:(0,s.jsxs)(o.ue,{hideCloseButton:!0,side:"right",className:"p-0 m-0 flex flex-col w-full max-w-full sm:max-w-[80%] md:max-w-[80%] lg:max-w-[50%]",children:[(0,s.jsxs)(o.Tu,{className:"flex flex-row items-center py-2 px-4 border-b border-b-border text-left sm:text-left",children:[(0,s.jsxs)(o.bC,{children:[G?"Add":"",_?"Edit":""," ",a?.type||G]}),s.jsx(o.Ei,{className:"hidden"})]}),s.jsx("div",{ref:W,className:"flex-1 py-2 px-0 overflow-y-auto",children:s.jsx("div",{className:"px-4",children:ei})}),(0,s.jsxs)("div",{className:"border-t border-t-border px-4 py-2 flex gap-x-2",children:[s.jsx("span",{className:"text-danger text-xs my-auto",children:"* Required"}),s.jsx("div",{className:"ml-auto"}),s.jsx(o.sw,{asChild:!0,children:s.jsx(g.z,{variant:"ghost",onClick:()=>{},children:"Cancel"})}),s.jsx(g.z,{onClick:()=>H(),disabled:ea(),children:"Save"})]})]})})})]})}},81646:(e,a,i)=>{i.d(a,{L:()=>n});var s=i(10326),t=i(17577),r=i(35392),l=i(49596);function n({value:e,type:a,disabled:i,modal:n,multiple:d,placeholder:o,error:u,onChange:c,filterDataKeys:m}){let{allDataKeys:g,extractDataKeys:y}=(0,l.M)(),h=(0,t.useMemo)(()=>{let e=g;return a&&""!==a.trim()&&(e=e.filter(e=>e.dataType===a)),m&&(e=e.filter(m)),e.map(e=>({label:e.name,value:e.uniqueKey,caption:e.dataType||"",description:e.label}))},[g,a,m]);return s.jsx(s.Fragment,{children:s.jsx(r.V,{multiple:d,modal:n,error:u,placeholder:`${e||""}`||o||"Select key",search:{placeholder:"Search data keys"},options:h,onSelect:e=>{let a=y(e.map(e=>e.value)).map(e=>({...e,children:y(e.options)}));c?.(a)}})})}},35392:(e,a,i)=>{i.d(a,{V:()=>m});var s=i(10326),t=i(17577),r=i(47206),l=i(32933),n=i(90772),d=i(54432),o=i(62288),u=i(77863),c=i(61198);function m({options:e,selected:a,...i}){a=Array.isArray(a)?a:a?[a]:[];let t=e.map(e=>({...e,value:`${e.value}`})),r=a.map(e=>`${e}`);if(!i.multiple){let[e]=Array.isArray(r)?r:[r];e&&t.find(a=>a.value===e)}return s.jsx(g,{...i,options:t,selected:r})}function g({modal:e,header:a,placeholder:i,search:m,multiple:g=!1,error:y=!1,disabled:h=!1,selected:x,options:f=[],trigger:v,onTrigger:p,onSelect:b}){let[j,N]=(0,t.useState)(""),k=(0,c.N)(j),[I,w]=(0,t.useState)([]),C=(0,t.useMemo)(()=>x?Array.isArray(x)?x.map(e=>f.find(a=>a?.value===e)).map(e=>e):f.filter(e=>e?.value===x)||[]:[],[x,f]),F=(0,t.useMemo)(()=>f.map(e=>{let a=C.map(e=>e?.value).map(e=>`${e||""}`).filter(e=>e).includes(`${e?.value}`);return a=a||I.includes(e.value),{...e,isSelected:a}}).sort((e,a)=>(e.disabled?1:0)-(a.disabled?1:0)).sort((e,a)=>{let i=e.isSelected?1:0;return(a.isSelected?1:0)-i}).filter(e=>JSON.stringify([e.value||"",e.label||"",e.description||""]).toLowerCase().match(k.toLowerCase())),[f,k,C,I]);return s.jsx(s.Fragment,{children:(0,s.jsxs)(o.Vq,{modal:e,onOpenChange:()=>{N(""),w([])},children:[s.jsx(o.hg,{asChild:!0,children:v||(0,s.jsxs)(n.z,{disabled:h,variant:"outline",className:(0,u.cn)("justify-between w-full",y&&"border border-destructive hover:bg-destructive/10"),onClick:p,children:[s.jsx("span",{className:C.length?"":"opacity-50",children:C[0]?.label||i||""}),s.jsx(r.Z,{className:"size-4 opacity-50"})]})}),(0,s.jsxs)(o.cZ,{hideCloseButton:!0,className:"flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",children:[(0,s.jsxs)(o.fK,{className:"border-b border-b-border px-4 py-4",children:[s.jsx(o.$N,{className:"hidden",children:""}),s.jsx(o.Be,{className:"hidden",children:""}),(0,s.jsxs)("div",{className:"flex items-center gap-x-4",children:[m?s.jsx("div",{className:"flex-1",children:s.jsx(d.I,{type:"search",placeholder:m.placeholder||"",value:j,onChange:e=>N(e.target.value)})}):null,a]})]}),s.jsx("div",{className:"flex-1 flex flex-col gap-y-1 overflow-y-auto px-4 py-2 overflow-x-hidden",children:F.map(e=>{let a=g?"button":o.GG;return s.jsx(t.Fragment,{children:s.jsx(a,{onClick:()=>{e.disabled||(e.isSelected?g?w(a=>a.filter(a=>a!==e.value)):b?.(C.filter(a=>a.value!==e.value)):g?w(a=>[...a,e.value]):b?.([e]))},className:(0,u.cn)("flex flex-col gap-y-1 border border-border p-2 rounded-md items-start text-left",e.disabled?"opacity-50 cursor-not-allowed":"transition-colors hover:bg-primary/20",e.isSelected&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),children:(0,s.jsxs)("div",{className:"flex items-center",children:[e.isSelected?s.jsx(l.Z,{className:"size-4 mr-2"}):null,(0,s.jsxs)("div",{children:[e.caption?s.jsx("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.caption||""}}):null,s.jsx("p",{children:e.label}),e.description?s.jsx("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.description||""}}):null]})]})})},e.value)})}),(0,s.jsxs)(o.cN,{className:"border-t border-t-border px-4 py-2 items-center w-full gap-x-2",children:[s.jsx(o.GG,{asChild:!0,children:s.jsx(n.z,{variant:"ghost",children:"Close"})}),!!I.length&&s.jsx(o.GG,{asChild:!0,children:s.jsx(n.z,{onClick:()=>{b?.(I.map(e=>F.find(a=>a.value===e)).filter(e=>e))},children:"Save"})})]})]})]})})}},75172:(e,a,i)=>{i.d(a,{a:()=>h});var s=i(17577),t=i(35047),r=i(15491),l=i(44099),n=i(60114),d=i(96221);i(63697);var o=i(11825),u=i(3529),c=i(37530);let m={value:"",filter:"all",searching:!1,results:[],unfilteredResults:[]},g={initialised:!1,loading:!1,keys:[],drugs:[],typeFilter:"",statusFilter:"",sortBy:"name-asc"},y=(0,n.Ue)(e=>g);function h(){let e=y(),{drugs:a,typeFilter:i,statusFilter:n,sortBy:h}=e,{authenticatedUser:x}=(0,u.b)(),f=(0,t.useRouter)(),v=(0,t.useSearchParams)(),p=(0,s.useMemo)(()=>r.Z.parse(v.toString()),[v]),{itemId:b}=p,j=(0,s.useMemo)(()=>a.filter(e=>e.itemId===b||e.key===b)[0]?.itemId,[b,a]),{alert:N}=(0,d.s)(),[k,I]=(0,s.useState)(m),w=(0,s.useCallback)(()=>I(m),[]),C=(0,s.useCallback)(()=>{let e=[],s=k.value?new Set(k.results.map(e=>e.itemId)):void 0,t=a.map(e=>[e.drug||"",e.type||"",e.key||"",e.dosageText||"",e.itemId]),r=[...t=t.filter((t,r)=>{let l=a[r];if(!l)return!1;let d=!0;return s&&(d=s.has(l.itemId)),d&&i&&"all"!==i&&(d=(l.type||"").toLowerCase()===i.toLowerCase()),d&&n&&"all"!==n&&("draft"===n?d=!0===l.isDraft:"published"===n&&(d=!l.isDraft)),d&&e.push(a[r]),d})],l=[...e],d=r.map((e,a)=>({row:e,drug:l[a]}));switch(h){case"name-asc":d.sort((e,a)=>(e.drug.drug||"").localeCompare(a.drug.drug||""));break;case"name-desc":d.sort((e,a)=>(a.drug.drug||"").localeCompare(e.drug.drug||""));break;case"type-asc":d.sort((e,a)=>(e.drug.type||"").localeCompare(a.drug.type||""));break;case"type-desc":d.sort((e,a)=>(a.drug.type||"").localeCompare(e.drug.type||""));break;case"key-asc":d.sort((e,a)=>(e.drug.key||"").localeCompare(a.drug.key||""));break;case"key-desc":d.sort((e,a)=>(a.drug.key||"").localeCompare(e.drug.key||""))}return{tableData:d.map(e=>e.row),filteredDrugs:d.map(e=>e.drug)}},[a,k,i,n,h]),F=(0,s.useCallback)(async e=>{try{w();let a=`${e||""}`.trim();if(!a)return;I(e=>({...e,value:a,searching:!0}));let{data:i}=await l.Z.get(`/api/drugs-library/search?searchValue=${encodeURIComponent(a)}`);if(i.errors?.length)throw Error(i.errors.join(", "));I(e=>{let s=i.data||[];return{value:a,filter:e.filter,searching:!1,results:(0,o.UZ)({searchValue:a,filter:e.filter,results:s}),unfilteredResults:s}})}catch{w()}},[w]),{tableData:K,filteredDrugs:A}=(0,s.useMemo)(()=>C(),[C]),$=(0,s.useCallback)(async()=>{try{y.setState({loading:!0});let e=await l.Z.get("/api/drugs-library?data="+JSON.stringify({returnDraftsIfExist:!0}));if(e.data.errors?.length)throw Error(e.data.errors?.join(", "));y.setState({drugs:e.data.data})}catch(e){N({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[N]);!function({events:e}){(0,s.useMemo)(()=>e,[e]),(0,s.useRef)({eventsTimeouts:{},eventsTimestamps:{}}),(0,s.useRef)(new Date().getTime()),(0,t.useRouter)()}({events:[{name:"data_changed",onEvent:{callback:async()=>{await $(),f.refresh()}}}]});let S=(0,s.useCallback)(async e=>{let i=a.filter(a=>a.itemId&&e.includes(a.itemId));try{y.setState(a=>({loading:!0,drugs:a.drugs.filter(a=>!e.includes(a.itemId))}));let a=await l.Z.delete("/api/drugs-library?data="+JSON.stringify({itemsIds:e}));if(a.data.errors?.length)throw Error(a.data.errors?.join(", "));await Promise.all(i.map(async e=>{if(!e?.itemId)return;let{isDraft:a,draftCreatedByUserId:i,...s}=e,t=e.drug||e.key||"Drugs Library Item";await (0,c.KL)({entityId:e.itemId,entityType:"drugsLibraryItem",entityTitle:t,snapshot:s,userId:x?.userId,userName:x?.displayName,description:`Marked "${t}" for deletion`})})),f.refresh(),N({title:"",message:"Drug deleted successfully!",variant:"success"})}catch(e){N({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[N,f.refresh,a,x?.userId,x?.displayName]),D=(0,s.useCallback)(async e=>{try{y.setState({loading:!0});let i=[],s=[],t=a;y.setState(a=>(t=!j&&e?[...a.drugs,e]:a.drugs.map(a=>a.itemId!==e?.itemId?a:(e&&(a.key!==e.key&&s.push({old:a.key,new:e.key}),a.type!==e.type&&i.push(a.key)),{...a,...e})),{loading:!0,drugs:t}));let r={data:e?[e]:t,broadcastAction:!0},n=await l.Z.post("/api/drugs-library/save",r);if(n.data.errors?.length)throw Error(n.data.errors?.join(", "));await $(),f.refresh(),N({title:"",message:`Drug${e?"":"s"} saved successfully!`,variant:"success"})}catch(e){N({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[a,j,f.refresh]),_=(0,s.useCallback)(async e=>{try{y.setState({loading:!0});let a={data:e.map(e=>({itemId:e})),broadcastAction:!0},i=await l.Z.post("/api/drugs-library/copy",a);if(i.data.errors?.length)throw Error(i.data.errors?.join(", "));await $(),f.refresh(),N({title:"",message:`Drug${e.length<2?"":"s"} copied successfully!`,variant:"success"})}catch(e){N({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[f.refresh]);(0,s.useCallback)(()=>{y.setState(g)},[]);let G=(0,s.useCallback)(e=>{y.setState({typeFilter:e})},[]),T=(0,s.useCallback)(e=>{y.setState({statusFilter:e})},[]),M=(0,s.useCallback)(e=>{y.setState({sortBy:e})},[]);return{...e,search:k,filteredDrugs:A,tableData:K,selectedItemId:j,addLink:e=>`?${r.Z.stringify({...p,addItem:e})}`,editLink:e=>`?${r.Z.stringify({...p,itemId:e})}`,getDrugs:$,deleteDrugs:S,saveDrugs:D,copyDrugs:_,setSearch:I,clearSearch:w,onSearch:F,setTypeFilter:G,setStatusFilter:T,setSortBy:M}}},11825:(e,a,i)=>{i.d(a,{UZ:()=>l,kv:()=>t});var s=i(11877);let t=[{value:"all",label:"All matches"},{value:"data_key",label:"Data keys only"},{value:"key_id",label:"Key IDs only"},{value:"label",label:"Label text only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",gestationKey:"data_key",weightKey:"data_key",diagnosisKey:"data_key",ageKey:"data_key",preferenceKey:"data_key",keyId:"key_id",gestationKeyId:"key_id",weightKeyId:"key_id",diagnosisKeyId:"key_id",ageKeyId:"key_id",title:"title",dosageText:"label",managementText:"label",administrationFrequency:"label",routeOfAdministration:"label",type:"label",preferenceValue:"label",condition:"condition"};function l({searchValue:e,filter:a,results:i}){if("all"===a)return i;let{normalizedValue:t,isExactMatch:l}=(0,s.l)(e);return t?i.map(e=>{let i=e.matches.filter(e=>{if(!a)return!0;if(r[e.field]!==a)return!1;let i=`${e.fieldValue}`.toLowerCase();return l?i===t:!!i.includes(t)});return{...e,matches:i}}).filter(e=>e.matches.length):i}},9015:(e,a,i)=>{i.d(a,{Z:()=>s});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,i(62881).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},69508:(e,a,i)=>{i.d(a,{Z:()=>s});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,i(62881).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])}};