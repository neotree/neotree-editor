"use strict";exports.id=8781,exports.ids=[8781],exports.modules={88781:(e,t,r)=>{r.d(t,{G$:()=>m,s:()=>u,t3:()=>g,fP:()=>l,Eg:()=>h,HF:()=>p});var i=r(57745),a=r(30900),d=r(9576),n=r(10413),s=r(93567),o=r(57435);async function l(e){try{let{itemsIds:t,keys:r,returnDraftsIfExist:o=!0}={...e},l=(t||[]).map(e=>a.Z(e)?e:d.Z()),g=r||[],y=g?.length?(0,i.d3)(s.drugsLibraryDrafts.key,g):void 0,u=l?.length?(0,i.d3)(s.drugsLibraryDrafts.itemDraftId,l):void 0,m=[...y?[y]:[],...u?[u]:[]],f=o?await n.Z.query.drugsLibraryDrafts.findMany({where:(0,i.xD)(...m)}):[],c=f.map(e=>e.itemDraftId);l=l.map(e=>c.includes(e)?d.Z():e),g=g.map(e=>f.map(e=>e.key).includes(e)?d.Z():e);let I=g?.length?(0,i.d3)(s.drugsLibrary.key,g):void 0,p=l?.length?(0,i.d3)(s.drugsLibrary.itemId,l):void 0,h=[(0,i.Ft)(s.drugsLibrary.deletedAt),(0,i.Ft)(s.pendingDeletion),p,I,c.length?(0,i.Nl)(s.drugsLibrary.itemId,c):void 0],D=(await n.Z.select({drugsLibraryItem:s.drugsLibrary,pendingDeletion:s.pendingDeletion}).from(s.drugsLibrary).leftJoin(s.pendingDeletion,(0,i.eq)(s.pendingDeletion.drugsLibraryItemId,s.drugsLibrary.itemId)).where(h.length?(0,i.xD)(...h):void 0)).map(e=>e.drugsLibraryItem),b=D.length?await n.Z.query.pendingDeletion.findMany({where:(0,i.d3)(s.pendingDeletion.drugsLibraryItemId,D.map(e=>e.itemId)),columns:{drugsLibraryItemId:!0}}):[];return{data:[...D.map(e=>({...e,isDraft:!1,isDeleted:!1})),...f.map(e=>({...e.data,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,t)=>e.position-t.position).filter(e=>!b.map(e=>e.drugsLibraryItemId).includes(e.itemId))}}catch(e){return o.Z.error("_getDrugsLibraryItems ERROR",e.message),{data:[],errors:[e.message]}}}async function g(e){let{itemId:t,returnDraftIfExists:r}={...e};try{if(!t)throw Error("Missing itemId");let e=a.Z(t)?(0,i.eq)(s.drugsLibrary.itemId,t):void 0,d=e?(0,i.eq)(s.drugsLibraryDrafts.itemDraftId,t):void 0,o=r&&d?await n.Z.query.drugsLibraryDrafts.findFirst({where:e}):void 0,l=o?{...o.data,draftCreatedByUserId:o.createdByUserId,isDraft:!0,isDeleted:!1}:null;if(l)return{data:l};let g=await n.Z.query.drugsLibrary.findFirst({where:(0,i.xD)((0,i.Ft)(s.drugsLibrary.deletedAt)),with:{draft:!0}});o=r?g?.draft:void 0;let y=o?.data||g;if(!(l=y?{...y,draftCreatedByUserId:o?.createdByUserId,isDraft:!!o?.data,isDeleted:!1}:null))return{data:null};return{data:l}}catch(e){return o.Z.error("_getDrugsLibraryItem ERROR",e.message),{errors:[e.message]}}}var y=r(60938);let u={allPublished:0,publishedWithDrafts:0,allDrafts:0,newDrafts:0,pendingDeletion:0};async function m(){try{let[{count:e}]=await n.Z.select({count:(0,y.QX)()}).from(s.drugsLibraryDrafts),[{count:t}]=await n.Z.select({count:(0,y.QX)()}).from(s.drugsLibraryDrafts).where((0,i.Ft)(s.drugsLibraryDrafts.itemId)),[{count:r}]=await n.Z.select({count:(0,y.QX)()}).from(s.drugsLibraryDrafts).where((0,i.K0)(s.drugsLibraryDrafts.itemId)),[{count:a}]=await n.Z.select({count:(0,y.QX)()}).from(s.pendingDeletion).where((0,i.K0)(s.pendingDeletion.drugsLibraryItemId)),[{count:d}]=await n.Z.select({count:(0,y.QX)()}).from(s.drugsLibrary);return{data:{allPublished:d,publishedWithDrafts:r,allDrafts:e,newDrafts:t,pendingDeletion:a}}}catch(e){return o.Z.error("_getDrugsLibraryItems ERROR",e.message),{data:u,errors:[e.message]}}}var f=r(34149),c=r(67785);let I={title:"Title",type:"Type",key:"Key",keyId:"Key ID",gestationKey:"Gestation key",gestationKeyId:"Gestation key ID",weightKey:"Weight key",weightKeyId:"Weight key ID",diagnosisKey:"Diagnosis key",diagnosisKeyId:"Diagnosis key ID",ageKey:"Age key",ageKeyId:"Age key ID",dosageText:"Dosage text",managementText:"Management text",administrationFrequency:"Administration frequency",routeOfAdministration:"Route of administration",condition:"Conditional expression",preferenceKey:"Preference key",preferenceValue:"Preference value"};async function p({searchValue:e,returnDraftsIfExist:t=!0}){try{let r=`${e||""}`,{normalizedValue:a}=(0,c.l)(r);if(!a)return{data:[]};let d=`%${a}%`,o=t?await n.Z.query.drugsLibraryDrafts.findMany({where:(0,f.i6)`lower(${s.drugsLibraryDrafts.data}::text) like ${d}`}):[],l=o.map(e=>e.itemId||e.data.itemId||null).filter(e=>!!e),g=await n.Z.select({item:s.drugsLibrary,pendingDeletion:s.pendingDeletion}).from(s.drugsLibrary).leftJoin(s.pendingDeletion,(0,i.eq)(s.pendingDeletion.drugsLibraryItemId,s.drugsLibrary.itemId)).where((0,i.xD)((0,i.Ft)(s.pendingDeletion),(0,i.Ft)(s.drugsLibrary.deletedAt),l.length?(0,i.Nl)(s.drugsLibrary.itemId,l):void 0,(0,i.or)((0,f.i6)`lower(${s.drugsLibrary.key}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.keyId}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.gestationKey}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.gestationKeyId}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.weightKey}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.weightKeyId}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.diagnosisKey}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.diagnosisKeyId}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.ageKey}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.ageKeyId}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.drug}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.type}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.dosageText}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.managementText}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.administrationFrequency}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.routeOfAdministration}::text) like ${d}`,(0,f.i6)`lower(${s.drugsLibrary.condition}::text) like ${d}`))),y=(e,t)=>{if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){let t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return t},u=o.map(e=>{let t=e.data,r=t.itemId??e.itemId??e.itemDraftId;return r?{id:t.id??0,itemId:r,key:t.key??e.key,keyId:t.keyId??"",type:t.type??e.type,drug:t.drug??"",minGestation:t.minGestation??null,maxGestation:t.maxGestation??null,minWeight:t.minWeight??null,maxWeight:t.maxWeight??null,minAge:t.minAge??null,maxAge:t.maxAge??null,hourlyFeed:t.hourlyFeed??null,hourlyFeedDivider:t.hourlyFeedDivider??null,dosage:t.dosage??null,dosageMultiplier:t.dosageMultiplier??null,dayOfLife:t.dayOfLife??"",dosageText:t.dosageText??"",managementText:t.managementText??"",gestationKey:t.gestationKey??"",weightKey:t.weightKey??"",diagnosisKey:t.diagnosisKey??"",ageKey:t.ageKey??"",ageKeyId:t.ageKeyId??"",gestationKeyId:t.gestationKeyId??"",weightKeyId:t.weightKeyId??"",diagnosisKeyId:t.diagnosisKeyId??"",administrationFrequency:t.administrationFrequency??"",drugUnit:t.drugUnit??"",routeOfAdministration:t.routeOfAdministration??"",position:t.position??e.position,condition:t.condition??"",validationType:t.validationType??"default",version:t.version??0,publishDate:y(t.publishDate,new Date),createdAt:y(t.createdAt,e.createdAt),updatedAt:y(t.updatedAt,e.updatedAt),deletedAt:t.deletedAt?y(t.deletedAt,e.updatedAt):null,itemId:r,isDraft:!0,draftCreatedByUserId:e.createdByUserId,preferences:t.preferences??null}:null}).filter(e=>!!e),m=g.map(({item:e})=>e).filter(e=>!!e).map(e=>({...e,itemId:e.itemId,isDraft:!1})),p=[...u,...m].sort((e,t)=>(e.position??0)-(t.position??0));return{data:function({searchValue:e,items:t}){let{normalizedValue:r,isExactMatch:i}=(0,c.l)(e);if(!r)return[];let a=e=>{let t=e.toLowerCase();return i?t===r:t.includes(r)};return t.reduce((e,t)=>{let r=[],i=new Set,d=(e,t,d)=>{let n=`${t??""}`.trim();if(!n||!a(n))return;let s=`${e}:${n}:${d||""}`;i.has(s)||(i.add(s),r.push({field:e,fieldLabel:I[e],fieldValue:n,...d?{context:d}:{}}))};[["title",t.drug],["type",t.type],["key",t.key],["keyId",t.keyId],["gestationKey",t.gestationKey],["gestationKeyId",t.gestationKeyId],["weightKey",t.weightKey],["weightKeyId",t.weightKeyId],["diagnosisKey",t.diagnosisKey],["diagnosisKeyId",t.diagnosisKeyId],["ageKey",t.ageKey],["ageKeyId",t.ageKeyId],["dosageText",t.dosageText],["managementText",t.managementText],["administrationFrequency",t.administrationFrequency],["routeOfAdministration",t.routeOfAdministration],["condition",t.condition]].forEach(([e,t])=>d(e,t));let n=t.preferences;return n&&Object.entries(n).forEach(([e,t])=>{t&&Object.entries(t).forEach(([t,r])=>{d("preferenceKey",t,e),"string"==typeof r||"number"==typeof r?d("preferenceValue",r,e):Array.isArray(r)&&d("preferenceValue",r.join(", "),e)})}),r.length&&t.itemId&&e.push({itemId:t.itemId,title:`${t.drug||""}`,type:`${t.type||""}`,isDraft:!!t.isDraft,matches:r}),e},[])}({searchValue:r,items:p})}}catch(e){return o.Z.error("_searchDrugsLibrary ERROR",e.message),{errors:[e.message],data:[]}}}async function h(e){try{let{itemsIds:t,keys:r,returnDraftsIfExist:i=!0}={...e},a=await l({itemsIds:t,keys:r,returnDraftsIfExist:i});if(a.errors?.length)return{data:[],errors:a.errors};return{data:a.data.map(e=>({itemId:e.itemId,key:e.key||"",keyId:e.keyId||"",type:e.type||"",drug:e.drug||"",gestationKey:e.gestationKey||"",gestationKeyId:e.gestationKeyId||"",weightKey:e.weightKey||"",weightKeyId:e.weightKeyId||"",diagnosisKey:e.diagnosisKey||"",diagnosisKeyId:e.diagnosisKeyId||"",ageKey:e.ageKey||"",ageKeyId:e.ageKeyId||"",dosageText:e.dosageText||"",managementText:e.managementText||"",administrationFrequency:e.administrationFrequency||"",routeOfAdministration:e.routeOfAdministration||"",condition:e.condition||"",preferences:e.preferences??null,validationType:e.validationType||null,minGestation:e.minGestation??null,maxGestation:e.maxGestation??null,minWeight:e.minWeight??null,maxWeight:e.maxWeight??null,minAge:e.minAge??null,maxAge:e.maxAge??null,drugUnit:e.drugUnit??null,dosage:e.dosage??null,dosageMultiplier:e.dosageMultiplier??null,hourlyFeed:e.hourlyFeed??null,hourlyFeedDivider:e.hourlyFeedDivider??null,dayOfLife:e.dayOfLife??null,publishDate:e.publishDate??null,createdAt:e.createdAt??null,updatedAt:e.updatedAt??null,isDraft:!!e.isDraft,isDeleted:!!e.isDeleted,version:Number(e.version??0)}))}}catch(e){return o.Z.error("_getDrugsLibraryMetadata ERROR",e.message),{data:[],errors:[e.message]}}}},67785:(e,t,r)=>{r.d(t,{l:()=>n,y:()=>d});let i=['"',"“"],a=['"',"”"];function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){let t=`${e??""}`.trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let r=i.includes(t[0]),d=a.includes(t[t.length-1]),n=t.length>1&&r&&d;return{normalizedValue:(n?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:n}}}};