"use strict";exports.id=7939,exports.ids=[7939],exports.modules={94081:(s,e,t)=>{t.d(e,{P:()=>f});var i=t(57745),r=t(81445),a=t(9576),n=t(57435),o=t(10413),c=t(93567),d=t(88317),p=t(66776);async function f({data:s,broadcastAction:e,syncSilently:t,userId:f}){let l={success:!1};s=(0,p.VL)(s);let u=[],h={};try{let e=0;for(let{diagnosisId:t,...d}of s)try{e++;let s=t||a.Z();if(!u.length){let a=o.Z.query.diagnosesDrafts.findFirst({where:(0,i.eq)(c.diagnosesDrafts.diagnosisDraftId,s)});h[`${s} - getDiagnosisDraftQuery`]=a.toSQL();let n=t?await a.execute():null,p=o.Z.query.diagnoses.findFirst({where:(0,i.eq)(c.diagnoses.diagnosisId,s)});h[`${s} - getPublishedDiagnosisQuery`]=p.toSQL();let l=n||!t?null:await p.execute();if(n){let e={...n.data,...d},t=o.Z.update(c.diagnosesDrafts).set({data:e,position:e.position}).where((0,i.eq)(c.diagnosesDrafts.diagnosisDraftId,s));h[`${s} - updateDiagnosisDraft`]=t.toSQL(),await t.execute()}else{let t=d.position||l?.position;if(!t){let s=await o.Z.query.diagnoses.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.diagnoses.position)}),e=await o.Z.query.diagnosesDrafts.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.diagnosesDrafts.position)});t=Math.max(0,s?.position||0,e?.position||0)+1}let a={...l,...d,diagnosisId:s,version:l?.version?l.version+1:1,position:t};if(a.scriptId){let t=await o.Z.query.scriptsDrafts.findFirst({where:(0,i.eq)(c.scriptsDrafts.scriptDraftId,a.scriptId),columns:{scriptDraftId:!0}}),r=await o.Z.query.scripts.findFirst({where:(0,i.eq)(c.scripts.scriptId,a.scriptId),columns:{scriptId:!0}});if(t||r){let e=o.Z.insert(c.diagnosesDrafts).values({data:a,scriptId:r?.scriptId,scriptDraftId:t?.scriptDraftId,diagnosisDraftId:s,position:a.position,diagnosisId:l?.diagnosisId,createdByUserId:f});h[`${s} - createDiagnosisDraft`]=e.toSQL(),await e.execute()}else u.push(`Could not save diagnosis ${e}: ${a.name}, because script was not found`)}else u.push(`Could not save diagnosis ${e}: ${a.name}, because scriptId was not specified`)}}}catch(s){u.push(s.message),n.Z.error("saveDiagnosis SQL (FAILED)",JSON.stringify(h))}u.length?l.errors=u:l.success=!0}catch(s){l.success=!1,l.errors=[s.message],n.Z.error("_saveDiagnoses ERROR",s.message)}finally{return l?.errors?.length||!e||t||d.Z.emit("data_changed","save_diagnoses"),l}}},55090:(s,e,t)=>{t.d(e,{u:()=>l});var i=t(57745),r=t(81445),a=t(9576),n=t(57435),o=t(10413),c=t(93567),d=t(88317),p=t(66776);function f(s,e){let t=[],i=new Set;return s.forEach((s,r)=>{let a=`${s.itemId||""}`.trim();if(!a){t.push(`${e}: item at index ${r} is missing itemId`);return}if(i.has(a)){t.push(`${e}: duplicate itemId ${a}`);return}i.add(a)}),s.forEach(s=>{let r=`${s.itemId||""}`.trim();r&&(s.forbidWith||[]).map(s=>`${s}`.trim()).filter(Boolean).forEach(s=>{if(s===r){t.push(`${e}: item ${r} cannot forbid itself`);return}i.has(s)||t.push(`${e}: item ${r} forbids unknown itemId ${s}`)})}),t}async function l({data:s,broadcastAction:e,userId:t}){let l={success:!1};s=(0,p.VL)(s);let u=[],h={};try{let e=0;for(let{screenId:n,...d}of s)try{e++;let s=n||a.Z(),p=d.title||d.label||n||`screen ${e}`,l=[...f(d.items||[],`Screen "${p}" items`),...(d.fields||[]).flatMap((s,e)=>f(s.items||[],`Screen "${p}" field "${s.label||s.key||e}" items`))];if(l.length&&u.push(...l),!u.length){let a=n?await o.Z.query.screensDrafts.findFirst({where:(0,i.eq)(c.screensDrafts.screenDraftId,s)}):null,p=a||!n?null:await o.Z.query.screens.findFirst({where:(0,i.eq)(c.screens.screenId,s)});if(a){let e={...a.data,...d},t=o.Z.update(c.screensDrafts).set({data:e,position:e.position}).where((0,i.eq)(c.screensDrafts.screenDraftId,s));h.query=t.toSQL(),await t.execute()}else{let a=d.position||p?.position;if(!a){let s=await o.Z.query.screens.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.screens.position)}),e=await o.Z.query.screensDrafts.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.screensDrafts.position)});a=Math.max(0,s?.position||0,e?.position||0)+1}let n={...p,...d,screenId:s,version:p?.version?p.version+1:1,position:a};if(n.scriptId){let r=await o.Z.query.scriptsDrafts.findFirst({where:(0,i.eq)(c.scriptsDrafts.scriptDraftId,n.scriptId),columns:{scriptDraftId:!0}}),a=await o.Z.query.scripts.findFirst({where:(0,i.eq)(c.scripts.scriptId,n.scriptId),columns:{scriptId:!0}});if(r||a){let e=o.Z.insert(c.screensDrafts).values({data:n,type:n.type,scriptId:a?.scriptId,scriptDraftId:r?.scriptDraftId,screenDraftId:s,position:n.position,screenId:p?.screenId,createdByUserId:t});h.query=e.toSQL(),await e.execute()}else u.push(`Could not save screen ${e}: ${n.title}, because script was not found`)}else u.push(`Could not save screen ${e}: ${n.title}, because scriptId was not specified`)}}}catch(s){u.push(s.message)}u.length?(l.errors=u,l.info=h):l.success=!0}catch(s){l.success=!1,l.errors=[s.message],l.info=h,n.Z.error("_saveScreens ERROR",s.message)}finally{return!l?.errors?.length&&e&&d.Z.emit("data_changed","save_screens"),l}}},4454:(s,e,t)=>{t.d(e,{O:()=>f});var i=t(57745),r=t(81445),a=t(9576),n=t(57435),o=t(10413),c=t(93567),d=t(88317),p=t(66776);async function f({data:s,broadcastAction:e,syncSilently:t,userId:f}){let l={success:!1},u=[],h={};s=(0,p.VL)(s);try{for(let{scriptId:e,...t}of s)try{let s=e||a.Z();if(!u.length){let a=e?await o.Z.query.scriptsDrafts.findFirst({where:(0,i.eq)(c.scriptsDrafts.scriptDraftId,s)}):null,n=a||!e?null:await o.Z.query.scripts.findFirst({where:(0,i.eq)(c.scripts.scriptId,s)});if(a){let e={...a.data,...t},r=o.Z.update(c.scriptsDrafts).set({data:e,position:e.position,hospitalId:e.hospitalId}).where((0,i.eq)(c.scriptsDrafts.scriptDraftId,s));h.query=r.toSQL(),await r.execute()}else{let e=t.position||n?.position;if(!e){let s=await o.Z.query.scripts.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.scripts.position)}),t=await o.Z.query.scriptsDrafts.findFirst({columns:{position:!0},orderBy:(0,r.C)(c.scriptsDrafts.position)});e=Math.max(0,s?.position||0,t?.position||0)+1}let i={...n,...t,scriptId:s,version:n?.version?n.version+1:1,position:e},a=o.Z.insert(c.scriptsDrafts).values({data:i,scriptDraftId:s,position:i.position,hospitalId:i.hospitalId,scriptId:n?.scriptId,createdByUserId:f});h.query=a.toSQL(),await a.execute()}}}catch(s){u.push(s.message)}u.length?(l.errors=u,l.info=h):l.success=!0}catch(s){l.success=!1,l.errors=[s.message],l.info=h,n.Z.error("_saveScripts ERROR",s.message)}finally{return l?.errors?.length||!e||t||d.Z.emit("data_changed","save_scripts"),l}}},66776:(s,e,t)=>{t.d(e,{VL:()=>function s(e){if("string"==typeof e)return e.replace(/0x[0-9A-Fa-f]+/g,"");if(Array.isArray(e))return e.map(s);if("object"==typeof e&&null!==e){let t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=s(e[i]));return t}return e}})}};