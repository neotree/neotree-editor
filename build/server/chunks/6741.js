"use strict";exports.id=6741,exports.ids=[6741],exports.modules={31300:(e,s,t)=>{t.d(s,{E:()=>c,X:()=>l});var r=t(57745),i=t(30900),d=t(9576),a=t(10413),n=t(93567),o=t(57435);async function l(e){try{let{scriptsIds:s=[],diagnosesIds:t=[],returnDraftsIfExist:o=!0,withImagesOnly:l}={...e},c=t.filter(e=>!i.Z(e));if(t=t.filter(e=>i.Z(e)),c.length){let e=await a.Z.query.diagnoses.findMany({where:(0,r.d3)(n.diagnoses.oldDiagnosisId,c),columns:{diagnosisId:!0,oldDiagnosisId:!0}});c.forEach(s=>{let r=e.filter(e=>e.oldDiagnosisId===s)[0];t.push(r?.diagnosisId||d.Z())})}let p=(s=s.filter(e=>i.Z(e))).filter(e=>!i.Z(e));if(p.length){let e=await a.Z.query.scripts.findMany({where:(0,r.d3)(n.scripts.oldScriptId,p),columns:{scriptId:!0,oldScriptId:!0}});p.forEach(t=>{let r=e.filter(e=>e.oldScriptId===t)[0];s.push(r?.scriptId||d.Z())})}let f=o?await a.Z.query.diagnosesDrafts.findMany({where:(0,r.xD)(s?.length?(0,r.or)((0,r.d3)(n.diagnosesDrafts.scriptId,s),(0,r.d3)(n.diagnosesDrafts.scriptDraftId,s)):void 0,t?.length?(0,r.d3)(n.diagnosesDrafts.diagnosisDraftId,t):void 0)}):[],I=(await a.Z.select({diagnosis:n.diagnoses,pendingDeletion:n.pendingDeletion,script:{title:n.scripts.title,hospitalId:n.scripts.hospitalId},hospital:{name:n.hospitals.name}}).from(n.diagnoses).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.diagnosisId,n.diagnoses.diagnosisId)).leftJoin(n.diagnosesDrafts,(0,r.eq)(n.diagnosesDrafts.diagnosisId,n.diagnoses.diagnosisId)).leftJoin(n.scripts,(0,r.eq)(n.scripts.scriptId,n.diagnoses.scriptId)).leftJoin(n.hospitals,(0,r.xD)((0,r.eq)(n.scripts.scriptId,n.diagnoses.scriptId),(0,r.eq)(n.scripts.hospitalId,n.hospitals.hospitalId))).where((0,r.xD)((0,r.Ft)(n.diagnoses.deletedAt),(0,r.Ft)(n.pendingDeletion),o?(0,r.Ft)(n.diagnosesDrafts.diagnosisId):void 0,s?.length?(0,r.d3)(n.diagnoses.scriptId,s):void 0,t?.length?(0,r.d3)(n.diagnoses.diagnosisId,t):void 0,l?(0,r.or)((0,r.K0)(n.diagnoses.image1),(0,r.K0)(n.diagnoses.image2),(0,r.K0)(n.diagnoses.image3)):void 0))).map(e=>({...e.diagnosis,scriptTitle:e.script?.title||"",hospitalName:e.hospital?.name||""})),g=I.length?await a.Z.query.pendingDeletion.findMany({where:(0,r.d3)(n.pendingDeletion.diagnosisId,I.map(e=>e.diagnosisId)),columns:{diagnosisId:!0}}):[];return{data:[...I.map(e=>({...e,isDraft:!1,isDeleted:!1})),...f.map(e=>({...e.data,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,s)=>e.position-s.position).filter(e=>!g.map(e=>e.diagnosisId).includes(e.diagnosisId)).map(e=>({...e,scriptTitle:e.scriptTitle||"",hospitalName:e.hospitalName||""}))}}catch(e){return o.Z.error("_getDiagnoses ERROR",e.message),{data:[],errors:[e.message]}}}async function c(e){let{diagnosisId:s,returnDraftIfExists:t}={...e};try{if(!s)throw Error("Missing diagnosisId");let e=i.Z(s)?(0,r.eq)(n.diagnoses.diagnosisId,s):void 0,d=i.Z(s)?void 0:(0,r.eq)(n.diagnoses.oldDiagnosisId,s),o=e?(0,r.eq)(n.diagnosesDrafts.diagnosisDraftId,s):void 0,l=t&&o?await a.Z.query.diagnosesDrafts.findFirst({where:o}):void 0,c=l?{...l.data,draftCreatedByUserId:l.createdByUserId,isDraft:!0,isDeleted:!1}:null;if(c)return{data:c};let p=await a.Z.select({diagnosis:n.diagnoses,pendingDeletion:n.pendingDeletion,draft:n.diagnosesDrafts}).from(n.diagnoses).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.diagnosisId,n.diagnoses.diagnosisId)).leftJoin(n.diagnosesDrafts,(0,r.eq)(n.diagnoses.diagnosisId,n.diagnosesDrafts.diagnosisDraftId)).where((0,r.xD)((0,r.Ft)(n.diagnoses.deletedAt),(0,r.Ft)(n.pendingDeletion),(0,r.or)(e,d))),f=p[0]?{...p[0].diagnosis,draft:p[0].draft||void 0}:null;l=t?f?.draft:void 0;let I=l?.data||f;if(!(c=I?{...I,draftCreatedByUserId:l?.createdByUserId,isDraft:!!l?.data,isDeleted:!1}:null))return{data:null};return{data:c}}catch(e){return o.Z.error("_getDiagnosis ERROR",e.message),{errors:[e.message]}}}},62345:(e,s,t)=>{t.d(s,{NB:()=>c,f:()=>p,uK:()=>l});var r=t(57745),i=t(30900),d=t(9576),a=t(10413),n=t(93567),o=t(57435);async function l(e){try{let{scriptsIds:s=[],screensIds:t=[],types:o=[],returnDraftsIfExist:l=!0,withImagesOnly:c}={...e},p=t.filter(e=>!i.Z(e));if(t=t.filter(e=>i.Z(e)),p.length){let e=await a.Z.query.screens.findMany({where:(0,r.d3)(n.screens.oldScreenId,p),columns:{screenId:!0,oldScreenId:!0}});p.forEach(s=>{let r=e.filter(e=>e.oldScreenId===s)[0];t.push(r?.screenId||d.Z())})}let f=(s=s.filter(e=>i.Z(e))).filter(e=>!i.Z(e));if(f.length){let e=await a.Z.query.scripts.findMany({where:(0,r.d3)(n.scripts.oldScriptId,f),columns:{scriptId:!0,oldScriptId:!0}});f.forEach(t=>{let r=e.filter(e=>e.oldScriptId===t)[0];s.push(r?.scriptId||d.Z())})}let I=l?await a.Z.query.screensDrafts.findMany({where:(0,r.xD)(s?.length?(0,r.or)((0,r.d3)(n.screensDrafts.scriptId,s),(0,r.d3)(n.screensDrafts.scriptDraftId,s)):void 0,t?.length?(0,r.d3)(n.screensDrafts.screenDraftId,t):void 0,o?.length?(0,r.d3)(n.screensDrafts.type,o):void 0)}):[],g=(await a.Z.select({screen:n.screens,pendingDeletion:n.pendingDeletion,script:{title:n.scripts.title,hospitalId:n.scripts.hospitalId},hospital:{name:n.hospitals.name}}).from(n.screens).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.screenId,n.screens.screenId)).leftJoin(n.screensDrafts,(0,r.eq)(n.screensDrafts.screenId,n.screens.screenId)).leftJoin(n.scripts,(0,r.eq)(n.scripts.scriptId,n.screens.scriptId)).leftJoin(n.hospitals,(0,r.xD)((0,r.eq)(n.scripts.scriptId,n.screens.scriptId),(0,r.eq)(n.scripts.hospitalId,n.hospitals.hospitalId))).where((0,r.xD)((0,r.Ft)(n.screens.deletedAt),(0,r.Ft)(n.pendingDeletion),l?(0,r.Ft)(n.screensDrafts.screenId):void 0,s?.length?(0,r.d3)(n.screens.scriptId,s):void 0,t?.length?(0,r.d3)(n.screens.screenId,t):void 0,o?.length?(0,r.d3)(n.screens.type,o):void 0,c?(0,r.or)((0,r.K0)(n.screens.image1),(0,r.K0)(n.screens.image2),(0,r.K0)(n.screens.image3)):void 0))).map(e=>({...e.screen,scriptTitle:e.script?.title||"",hospitalName:e.hospital?.name||""})),h=g.length?await a.Z.query.pendingDeletion.findMany({where:(0,r.d3)(n.pendingDeletion.screenId,g.map(e=>e.screenId)),columns:{screenId:!0}}):[];return{data:[...g.map(e=>({...e,isDraft:!1,isDeleted:!1})),...I.map(e=>({...e.data,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,s)=>e.position-s.position).filter(e=>!h.map(e=>e.screenId).includes(e.screenId))}}catch(e){return o.Z.error("_getScreens ERROR",e.message),{data:[],errors:[e.message]}}}async function c(e){let{screenId:s,returnDraftIfExists:t}={...e};try{if(!s)throw Error("Missing screenId");let e=i.Z(s)?(0,r.eq)(n.screens.screenId,s):void 0,d=i.Z(s)?void 0:(0,r.eq)(n.screens.oldScreenId,s),o=e?(0,r.eq)(n.screensDrafts.screenDraftId,s):void 0,l=t&&o?await a.Z.query.screensDrafts.findFirst({where:o}):void 0,c=l?{...l.data,draftCreatedByUserId:l.createdByUserId,isDraft:!0,isDeleted:!1}:null;if(c)return{data:c};let p=await a.Z.select({screen:n.screens,pendingDeletion:n.pendingDeletion,draft:n.screensDrafts}).from(n.screens).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.screenId,n.screens.screenId)).leftJoin(n.screensDrafts,(0,r.eq)(n.screens.screenId,n.screensDrafts.screenDraftId)).where((0,r.xD)((0,r.Ft)(n.screens.deletedAt),(0,r.Ft)(n.pendingDeletion),(0,r.or)(e,d))),f=p[0]?{...p[0].screen,draft:p[0].draft||void 0}:null;l=t?f?.draft:void 0;let I=l?.data||f;if(!(c=I?{...I,draftCreatedByUserId:l?.createdByUserId,isDraft:!!l?.data,isDeleted:!1}:null))return{data:null};return{data:c}}catch(e){return o.Z.error("_getScreen ERROR",e.message),{errors:[e.message]}}}async function p(e){try{let{scriptsIds:s=[],screensIds:t=[],returnDraftsIfExist:o}={...e},l=t.filter(e=>!i.Z(e));if(t=t.filter(e=>i.Z(e)),l.length){let e=await a.Z.query.screens.findMany({where:(0,r.d3)(n.screens.oldScreenId,l),columns:{screenId:!0,oldScreenId:!0}});l.forEach(s=>{let r=e.filter(e=>e.oldScreenId===s)[0];t.push(r?.screenId||d.Z())})}let c=(s=s.filter(e=>i.Z(e))).filter(e=>!i.Z(e));if(c.length){let e=await a.Z.query.scripts.findMany({where:(0,r.d3)(n.scripts.oldScriptId,c),columns:{scriptId:!0,oldScriptId:!0}});c.forEach(t=>{let r=e.filter(e=>e.oldScriptId===t)[0];s.push(r?.scriptId||d.Z())})}let p=o?await a.Z.query.screensDrafts.findMany({where:(0,r.xD)(s?.length?(0,r.or)((0,r.d3)(n.screensDrafts.scriptId,s),(0,r.d3)(n.screensDrafts.scriptDraftId,s)):void 0,t?.length?(0,r.d3)(n.screensDrafts.screenDraftId,t):void 0)}):[],f=(await a.Z.select({screen:{title:n.screens.title,screenId:n.screens.screenId,oldScreenId:n.screens.oldScreenId,position:n.screens.position,type:n.screens.type,refId:n.screens.refId},pendingDeletion:n.pendingDeletion}).from(n.screens).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.screenId,n.screens.screenId)).leftJoin(n.screensDrafts,(0,r.eq)(n.screensDrafts.screenId,n.screens.screenId)).where((0,r.xD)((0,r.Ft)(n.screens.deletedAt),(0,r.Ft)(n.pendingDeletion),o?(0,r.Ft)(n.screensDrafts.screenId):void 0,s?.length?(0,r.d3)(n.screens.scriptId,s):void 0,t?.length?(0,r.d3)(n.screens.screenId,t):void 0))).map(e=>e.screen),I=f.length?await a.Z.query.pendingDeletion.findMany({where:(0,r.d3)(n.pendingDeletion.screenId,f.map(e=>e.screenId)),columns:{screenId:!0}}):[];return{data:[...f.map(e=>({...e,isDraft:!1,isDeleted:!1})),...p.map(e=>({...e.data,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,s)=>e.position-s.position).filter(e=>!I.map(e=>e.screenId).includes(e.screenId)).map((e,s)=>({...e,position:s+1}))}}catch(e){return o.Z.error("_listScreens ERROR",e.message),{data:[],errors:[e.message]}}}},49815:(e,s,t)=>{t.d(s,{A0:()=>c,Tw:()=>p,bK:()=>f,eh:()=>l});var r=t(57745),i=t(30900),d=t(9576),a=t(10413),n=t(93567),o=t(57435);async function l(){let e=await a.Z.select({scriptId:n.scripts.scriptId}).from(n.scripts).where((0,r.Ft)(n.scripts.deletedAt));return e?.map(e=>e.scriptId)??[]}async function c(e){let s=await a.Z.select({oldScript:n.scripts.oldScriptId}).from(n.scripts).where((0,r.eq)(n.scripts.scriptId,e));return s?.map(e=>e.oldScript)??[]}async function p(e){try{let{scriptsIds:s=[],hospitalIds:t=[],returnDraftsIfExist:o=!0}={...e},l=s.filter(e=>!i.Z(e));s=s.filter(e=>i.Z(e));let c=t.filter(e=>!i.Z(e));if(t=t.filter(e=>i.Z(e)),l.length){let e=await a.Z.query.scripts.findMany({where:(0,r.d3)(n.scripts.oldScriptId,l),columns:{scriptId:!0,oldScriptId:!0}});l.forEach(t=>{let r=e.filter(e=>e.oldScriptId===t)[0];s.push(r?.scriptId||d.Z())})}if(c.length){let e=await a.Z.query.hospitals.findMany({where:(0,r.d3)(n.hospitals.oldHospitalId,c),columns:{hospitalId:!0,oldHospitalId:!0}});c.forEach(s=>{let r=e.filter(e=>e.oldHospitalId===s)[0];t.push(r?.hospitalId||d.Z())})}let p=(o?await a.Z.select({scriptDraft:n.scriptsDrafts,hospitalName:n.hospitals.name}).from(n.scriptsDrafts).leftJoin(n.hospitals,(0,r.eq)(n.hospitals.hospitalId,n.scriptsDrafts.hospitalId)).where((0,r.xD)(s?.length?(0,r.d3)(n.scriptsDrafts.scriptDraftId,s):void 0,t.length?(0,r.d3)(n.scriptsDrafts.hospitalId,t):void 0)):[]).map(e=>({...e.scriptDraft,hospitalName:e.hospitalName})),f=(await a.Z.select({script:n.scripts,pendingDeletion:n.pendingDeletion,hospitalName:n.hospitals.name}).from(n.scripts).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.scriptId,n.scripts.scriptId)).leftJoin(n.scriptsDrafts,(0,r.eq)(n.scriptsDrafts.scriptId,n.scripts.scriptId)).leftJoin(n.hospitals,(0,r.xD)((0,r.eq)(n.hospitals.hospitalId,n.scripts.hospitalId),(0,r.Ft)(n.hospitals.deletedAt))).where((0,r.xD)((0,r.Ft)(n.scripts.deletedAt),(0,r.Ft)(n.pendingDeletion),o?(0,r.Ft)(n.scriptsDrafts.scriptId):void 0,s.length?(0,r.d3)(n.scripts.scriptId,s):void 0,t.length?(0,r.d3)(n.scripts.hospitalId,t):void 0))).map(e=>({...e.script,hospitalName:e.hospitalName})),g=f.length?await a.Z.query.pendingDeletion.findMany({where:(0,r.d3)(n.pendingDeletion.scriptId,f.map(e=>e.scriptId)),columns:{scriptId:!0}}):[],h=[...f.map(e=>({...e,isDraft:!1,isDeleted:!1})),...p.map(e=>({...e.data,hospitalName:e.hospitalName,isDraft:!0,isDeleted:!1,draftCreatedByUserId:e.createdByUserId}))].sort((e,s)=>e.position-s.position).filter(e=>!g.map(e=>e.scriptId).includes(e.scriptId)).map(e=>({...e,hospitalId:e.hospitalName?e.hospitalId:null})),D=0;for(let e of h){let{data:[s]}=await I({scriptsIds:[e.scriptId]});h[D].hasChangedItems=!!s?.hasChangedItems,h[D].itemsChangedByUserId=s?.itemsChangedByUserId||null,D++}return{data:h}}catch(e){return o.Z.error("_getScripts ERROR",e.message),{data:[],errors:[e.message]}}}async function f(e){let{scriptId:s,returnDraftIfExists:t}={...e};try{if(!s)throw Error("Missing scriptId");let e=i.Z(s)?(0,r.eq)(n.scripts.scriptId,s):void 0,d=i.Z(s)?void 0:(0,r.eq)(n.scripts.oldScriptId,s),o=e?(0,r.eq)(n.scriptsDrafts.scriptDraftId,s):void 0,l=t&&o?await a.Z.query.scriptsDrafts.findFirst({where:o}):void 0,c=l?{...l.data,draftCreatedByUserId:l.createdByUserId,isDraft:!0,isDeleted:!1}:null;if(c){let{data:[e]}=await I({scriptsIds:[c.scriptId]});return c.hasChangedItems=!!e?.hasChangedItems,c.itemsChangedByUserId=e.itemsChangedByUserId||null,{data:c}}let p=await a.Z.select({script:n.scripts,pendingDeletion:n.pendingDeletion,draft:n.scriptsDrafts,hospitalName:n.hospitals.name}).from(n.scripts).leftJoin(n.hospitals,(0,r.xD)((0,r.eq)(n.hospitals.hospitalId,n.scripts.hospitalId),(0,r.Ft)(n.hospitals.deletedAt))).leftJoin(n.pendingDeletion,(0,r.eq)(n.pendingDeletion.scriptId,n.scripts.scriptId)).leftJoin(n.scriptsDrafts,(0,r.eq)(n.scripts.scriptId,n.scriptsDrafts.scriptDraftId)).where((0,r.xD)((0,r.Ft)(n.scripts.deletedAt),(0,r.Ft)(n.pendingDeletion),(0,r.or)(e,d))),f=p[0]?{...p[0].script,draft:p[0].draft||void 0,hospitalName:p[0].hospitalName||""}:null;l=t?f?.draft:void 0;let g=l?.data||f;if(!(c=g?{...g,draftCreatedByUserId:l?.createdByUserId,isDraft:!!l?.data,isDeleted:!1,hospitalId:g.hospitalName?g.hospitalId:null}:null))return{data:null};let{data:[h]}=await I({scriptsIds:[c.scriptId]});return c.hasChangedItems=!!h?.hasChangedItems,c.itemsChangedByUserId=h.itemsChangedByUserId||null,{data:c}}catch(e){return o.Z.error("_getScript ERROR",e.message),{errors:[e.message]}}}async function I({scriptsIds:e=[],userId:s}){let t=[];try{for(let s of e){let e=await a.Z.query.screensDrafts.findFirst({where:(0,r.or)((0,r.eq)(n.screensDrafts.scriptDraftId,s),(0,r.eq)(n.screensDrafts.scriptId,s)),columns:{createdByUserId:!0}}),i=await a.Z.query.diagnosesDrafts.findFirst({where:(0,r.or)((0,r.eq)(n.diagnosesDrafts.scriptDraftId,s),(0,r.eq)(n.diagnosesDrafts.scriptId,s)),columns:{createdByUserId:!0}}),d=await a.Z.query.pendingDeletion.findMany({where:(0,r.or)((0,r.eq)(n.pendingDeletion.scriptDraftId,s),(0,r.eq)(n.pendingDeletion.screenScriptId,s),(0,r.eq)(n.pendingDeletion.diagnosisScriptId,s)),columns:{createdByUserId:!0}}),o=d.find(e=>e.createdByUserId),l={hasDraftedScreens:!!e?.createdByUserId,hasDraftedDiagnoses:!!i?.createdByUserId,hasDeletedItems:!!d?.length,hasChangedItems:!!e?.createdByUserId||!!i?.createdByUserId||!!d?.length,screensDraftsCreatedByUserId:e?.createdByUserId,diagnosesDraftsCreatedByUserId:i?.createdByUserId,itemsDeletedByUserId:o?.createdByUserId,itemsChangedByUserId:e?.createdByUserId||i?.createdByUserId||o?.createdByUserId};t.push(l)}return{data:t}}catch(e){return o.Z.error("_getScriptsRelationsChanges ERROR",e.message),{errors:[e.message],data:t}}}}};