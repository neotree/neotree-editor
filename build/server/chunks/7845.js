"use strict";exports.id=7845,exports.ids=[7845],exports.modules={87845:(e,a,r)=>{r.r(a),r.d(a,{$$ACTION_0:()=>R,$$ACTION_1:()=>j,$$ACTION_10:()=>k,$$ACTION_11:()=>B,$$ACTION_12:()=>M,$$ACTION_13:()=>q,$$ACTION_14:()=>H,$$ACTION_15:()=>Q,$$ACTION_2:()=>v,$$ACTION_3:()=>A,$$ACTION_4:()=>Z,$$ACTION_5:()=>N,$$ACTION_6:()=>C,$$ACTION_7:()=>L,$$ACTION_8:()=>x,$$ACTION_9:()=>K,copyDiagnoses:()=>ec,copyScreens:()=>ei,copyScripts:()=>es,countDiagnoses:()=>T,countScreens:()=>I,countScripts:()=>W,deleteDiagnoses:()=>P,deleteScreens:()=>$,deleteScripts:()=>F,deleteScriptsItems:()=>ea,getDiagnoses:()=>D,getDiagnosis:()=>U,getScreen:()=>O,getScreens:()=>E,getScript:()=>Y,getScripts:()=>G,getScriptsMetadata:()=>y,getScriptsWithItems:()=>z,listScreens:()=>S,saveDiagnoses:()=>X,saveScreens:()=>_,saveScriptDiagnoses:()=>ee,saveScriptScreens:()=>V,saveScripts:()=>J,saveScriptsWithItems:()=>et});var t=r(24330);r(60166);var s=r(9576),i=r(49530),c=r(10970),o=r(17065),n=r(22418),d=r(57435),f=r(88317),l=r(29712),g=r(20123);async function u(e,a){let r=a?.link,t=a?.baseURL;if(!e)throw Error("AXIOS init error: missing siteId");if(!a){let a=await (0,g._U)(e);if(a.errors?.length)throw Error("AXIOS init error: "+a.errors.join(", "));if(!a.data)throw Error("AXIOS init error: site not found");r=a.data.link,t=a.data.apiKey}let s=l.Z.create({baseURL:r});return s.interceptors.request.use(async e=>(e.headers&&(e.headers["x-api-key"]=t),d.Z.log(`AXIOS [${e.method}]`,[`${r}/api`,e.url].join("")),e)),s.interceptors.response.use(e=>e,e=>new Promise((a,r)=>r(e))),s}var h=r(66267),b=r(44380),p=r(59271);let m=async(e,a)=>{let r=l.Z.create({baseURL:process.env.NEXT_PUBLIC_APP_URL});if(a){let{data:e,errors:t}=await (0,g.QF)({links:[a]});if(t?.length)throw Error(t.join(", "));if(!e[0])throw Error(`Failed to download images. Site (${a}) not found.`);r=await (0,p.U)({baseURL:a,apiKey:e[0].apiKey})}a=process.env.NEXT_PUBLIC_APP_URL;let t=e.data.split("/").filter((e,a)=>a<3).join("/"),s=[],i=!1;if(t!==a&&(0,b.jv)(t)&&e.fileId){let{errors:a,data:c}=(await r.post("/api/files/upload/from-site",{siteURL:t,fileId:e.fileId})).data;a?.length&&(s=a),c&&(e.data=c.fileURL,i=!0)}return{image:e,updated:i,errors:s}};var w=r(40618);let y=o.Sc,I=(0,t.j)("d7c0cbe41650d8c5302c24cdd8c4180e5ffe6cb1",R);async function R(...e){try{return await (0,h.isAllowed)(),await o.co(...e)}catch(e){return d.Z.error("countScreens ERROR",e.message),{errors:[e.message],data:o.W0}}}let E=(0,t.j)("1459ac5b011f85ceaea1e2a4b4228b78d5e73417",j);async function j(...e){try{return await (0,h.isAllowed)(),await o.uK(...e)}catch(e){return d.Z.error("getScreens ERROR",e.message),{errors:[e.message],data:[]}}}let S=(0,t.j)("dbfdd1f62781a165c6af638c7369535297c80222",v);async function v(...e){try{return await (0,h.isAllowed)(),await o.f(...e)}catch(e){return d.Z.error("listScreens ERROR",e.message),{errors:[e.message],data:[]}}}let O=(0,t.j)("b2441f14471fd9efb1ed906a5a12eb15e7019145",A);async function A(...e){return await (0,h.isAllowed)(),await o.NB(...e)}let $=(0,t.j)("ee3fbb6190109382559bad8ad90efa4e33be4cd1",Z);async function Z(...e){try{return await (0,h.isAllowed)(),await c.GH(...e)}catch(e){return d.Z.error("deleteScreens ERROR",e.message),{errors:[e.message],success:!1}}}let _=(0,t.j)("d199c948319bd436089153f1f51b2dbcebd28b7f",N);async function N(...e){try{return await (0,h.isAllowed)(),await c.uD(...e)}catch(e){return d.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}let T=(0,t.j)("3966fd2162a0d44fb3cdb6eb461c74adf4bf4cd2",C);async function C(...e){try{return await (0,h.isAllowed)(),await o.tW(...e)}catch(e){return d.Z.error("countDiagnoses ERROR",e.message),{errors:[e.message],data:o.GM}}}let D=(0,t.j)("86e719fdb55bac7e0a3469d11672697ee1da284c",L);async function L(...e){try{return await (0,h.isAllowed)(),await o.XA(...e)}catch(e){return d.Z.error("getDiagnoses ERROR",e.message),{errors:[e.message],data:[]}}}let U=(0,t.j)("0e115891a6462e0736b1a3bb6b9c6b0728d82b90",x);async function x(...e){return await (0,h.isAllowed)(),await o.Ew(...e)}let P=(0,t.j)("b7b52e21eef6674ab44aef03a5fbbc951b5de40d",K);async function K(...e){try{return await (0,h.isAllowed)(),await c.Bx(...e)}catch(e){return d.Z.error("deleteDiagnoses ERROR",e.message),{errors:[e.message],success:!1}}}let X=(0,t.j)("ff66b2e9780d4a73b86e6b46a6b937191f255c8e",k);async function k(...e){try{return await (0,h.isAllowed)(),await c.Pk(...e)}catch(e){return d.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}let W=(0,t.j)("c718092e564090a098b77ac5f4e051b5b4614e6a",B);async function B(...e){try{return await (0,h.isAllowed)(),await o.ix(...e)}catch(e){return d.Z.error("countScripts ERROR",e.message),{errors:[e.message],data:o.Zu}}}let G=(0,t.j)("91517bb61be10d0cd147e86b39c460e2f7c2f784",M);async function M(...e){try{return await (0,h.isAllowed)(),await o.Tw(...e)}catch(e){return d.Z.error("getScripts ERROR",e.message),{errors:[e.message],data:[]}}}let Y=(0,t.j)("38a30b75b93dc770039654a08b8ee89888debb85",q);async function q(...e){return await (0,h.isAllowed)(),await o.bK(...e)}let F=(0,t.j)("8f7d8970c6678f2eb1f017be8fc828abd5350270",H);async function H(...e){try{return await (0,h.isAllowed)(),await c.Es(...e)}catch(e){return d.Z.error("deleteScripts ERROR",e.message),{errors:[e.message],success:!1}}}let J=(0,t.j)("3de437defa544a289973490b01301b74b96dfb99",Q);async function Q(...e){try{return await (0,h.isAllowed)(),await c.Or(...e)}catch(e){return d.Z.error("getSys ERROR",e.message),{errors:[e.message],data:void 0,success:!1}}}async function z(e){let a=[],r=[];try{let t=e?.returnDraftsIfExist!==!1,s=await o.Tw({...e,returnDraftsIfExist:t});for(let e of(s.errors?.forEach(e=>r.push(e)),s.data)){let s=await o.uK({scriptsIds:[e.scriptId],returnDraftsIfExist:t}),i=await o.XA({scriptsIds:[e.scriptId],returnDraftsIfExist:t}),c=await o.pd({scriptsIds:[e.scriptId],returnDraftsIfExist:t});s.errors?.forEach(e=>r.push(e)),i.errors?.forEach(e=>r.push(e)),a.push({...e,screens:s.data,diagnoses:i.data,drugsLibrary:c.data})}if(r.length)return{errors:r,data:[]};return{data:a}}catch(e){return d.Z.error("getScriptsWithItems ERROR",e.message),{data:[],errors:[e.message]}}}async function V({screens:e,scriptId:a}){try{let r=0,t=[],i=await o.bK({scriptId:a,returnDraftIfExists:!0});if(i.errors?.length)throw Error(i.errors.join(", "));if(!i.data)throw Error("Script not found");for(let c of e){let{id:e,publishDate:o,createdAt:n,updatedAt:f,isDraft:l,deletedAt:g,version:u,oldScriptId:h,oldScreenId:b,screenId:p,scriptId:w,position:y,...I}=c,R=(0,s.Z)();try{if(I.image1){let e=await m(I.image1);I.image1=e.image}if(I.image2){let e=await m(I.image2);I.image2=e.image}if(I.image3){let e=await m(I.image3);I.image3=e.image}}catch(e){d.Z.error("process image",e.message)}let E=await _({data:[{...I,scriptId:a,oldScriptId:i.data.oldScriptId,screenId:R,version:1}]});E.errors?.forEach(e=>t.push(`(screenId=${p}) ${e||""}`)),!E.errors?.length&&r++}if(t.length)return{errors:t,saved:r,success:!1};return{saved:r,success:!0}}catch(e){return d.Z.error("saveScriptScreens ERROR",e.message),{saved:0,success:!1,errors:[e.message]}}}async function ee({diagnoses:e,scriptId:a}){try{let r=0,t=[],i=await o.bK({scriptId:a,returnDraftIfExists:!0});if(i.errors?.length)throw Error(i.errors.join(", "));if(!i.data)throw Error("Script not found");for(let c of e){let{id:e,publishDate:o,createdAt:n,updatedAt:f,isDraft:l,deletedAt:g,version:u,oldDiagnosisId:h,diagnosisId:b,scriptId:p,position:w,...y}=c,I=(0,s.Z)();try{if(y.image1){let e=await m(y.image1);y.image1=e.image}if(y.image2){let e=await m(y.image2);y.image2=e.image}if(y.image3){let e=await m(y.image3);y.image3=e.image}}catch(e){d.Z.error("process image",e.message)}let R=await X({data:[{...y,scriptId:a,oldScriptId:i.data.oldScriptId,diagnosisId:I,version:1}]});R.errors?.forEach(e=>t.push(`(diagnosisId=${b}) ${e||""}`)),!R.errors?.length&&r++}if(t.length)return{errors:t,saved:r,success:!1};return{saved:r,success:!0}}catch(e){return d.Z.error("saveScriptDiagnoses ERROR",e.message),{saved:0,success:!1,errors:[e.message]}}}async function ea({scriptsIds:e}){try{let a=[],r=await $({scriptsIds:e});r.errors?.forEach(e=>a.push(e));let t=await P({scriptsIds:e});if(t.errors?.forEach(e=>a.push(e)),a.length)return{errors:a,success:!1};return{success:!0}}catch(e){return d.Z.error("deleteScriptsItems ERROR",e.message),{success:!1,errors:[e.message]}}}let er={scripts:0,screens:0,diagnoses:0,drugsLibrary:0};async function et({data:e}){let a={...er};try{let r=[];for(let{overWriteScriptWithId:t,...i}of e){let e=t?await Y({scriptId:t,returnDraftIfExists:!0}):{data:null};if(e.errors?.forEach(e=>r.push(e)),r.length)continue;if(t&&!e?.data){r.push("Overwrite script was not found");continue}if(e?.data){let a=await ea({scriptsIds:[e.data.scriptId]});if(a.errors?.forEach(e=>r.push(e)),r.length)continue}let{id:c,screens:o=[],diagnoses:d=[],drugsLibrary:f=[],publishDate:l,createdAt:g,updatedAt:u,isDraft:h,deletedAt:b,version:p,oldScriptId:m,scriptId:w,position:y,...I}=i,R=e?.data?.scriptId||(0,s.Z)(),E=await J({data:[{...I,scriptId:R,version:1}]});if(E.errors?.forEach(e=>r.push(e)),r.length)continue;a.scripts++;let j=await V({scriptId:R,screens:o});a.screens+=j.saved;let S=await ee({scriptId:R,diagnoses:d});a.diagnoses+=S.saved,f.length&&(await n.cj({data:f.map(e=>({...e,itemId:(0,s.Z)(),createdAt:void 0,updatedAt:void 0,deletedAt:void 0,publishDate:void 0,id:void 0,position:void 0}))}),a.drugsLibrary+=f.length)}if(r.length)return{success:!1,errors:r,info:a};return{success:!0,info:a}}catch(e){return d.Z.error("saveScriptsWithItems ERROR",e.message),{success:!1,errors:[e.message],info:a}}}async function es(e){let a={...er},{scriptsIds:r=[],confirmCopyAll:t,toRemoteSiteId:s,fromRemoteSiteId:c,broadcastAction:o,overWriteScriptWithId:n}={...e};try{if(!r.length&&!t)throw Error("You&apos;re about copy all the scripts, please confirm this action!");let e=c?{data:[]}:await z({scriptsIds:r});if(e.errors)return{success:!1,errors:e.errors,info:a};if(c){let t=await u(c),s=await t.get("/api/scripts/with-items?"+i.Z.stringify({scriptsIds:JSON.stringify(r)})),o=s.data;if(o.errors)return{success:!1,errors:o.errors,info:a};e=o,console.log("axiosClient",s.config.baseURL),e.data.forEach(({screens:a,diagnoses:r},t)=>{let i=e=>{let a=s.config.baseURL||"";return"/"===a.substring(a.length-1,a.length)&&(a=a.substring(0,a.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[a,e].filter(e=>e).join("/")};a.forEach((a,r)=>{a.image1?.data&&a.image1?.fileId&&!(0,b.jv)(a.image1.data)&&(e.data[t].screens[r].image1.data=i(a.image1.data)),a.image2?.data&&a.image2?.fileId&&!(0,b.jv)(a.image2.data)&&(e.data[t].screens[r].image2.data=i(a.image2.data)),a.image3?.data&&a.image3?.fileId&&!(0,b.jv)(a.image3.data)&&(e.data[t].screens[r].image3.data=i(a.image3.data))}),r.forEach((a,r)=>{a.image1?.data&&a.image1?.fileId&&!(0,b.jv)(a.image1.data)&&(e.data[t].diagnoses[r].image1.data=i(a.image1.data)),a.image2?.data&&a.image2?.fileId&&!(0,b.jv)(a.image2.data)&&(e.data[t].diagnoses[r].image2.data=i(a.image2.data)),a.image3?.data&&a.image3?.fileId&&!(0,b.jv)(a.image3.data)&&(e.data[t].diagnoses[r].image3.data=i(a.image3.data))})})}let d={success:!0,info:a};if(e.data.length){if(s){let a=await u(s);d=(await a.post("/api/scripts/with-items?",{data:e.data.map(e=>({...e,hospitalId:void 0,hospitalName:void 0}))})).data}else d=await et({data:e.data.map(e=>({...e,overWriteScriptWithId:n,hospitalId:void 0,hospitalName:void 0}))})}return o&&!d?.errors?.length&&f.Z.emit("data_changed","copy_scripts"),d}catch(e){return d.Z.error("copyScripts ERROR",e.response?.data?.errors?.join(", ")||e.message),{errors:e.response?.data?.errors||[e.message],success:!1,info:a}}}async function ei(e){let a=0,{screensIds:r=[],fromScriptsIds:t=[],toScriptsIds:s=[],confirmCopyAll:i,broadcastAction:c}={...e};try{let e=[];if(!t.length&&!r.length&&!i)throw Error("You&apos;re about to copy all the screens, please confirm this action!");let n=await o.uK({scriptsIds:t,screensIds:r,returnDraftsIfExist:!0});if(n.errors?.length)throw Error(n.errors.join(", "));if(s.length)for(let r of s){let t=await V({scriptId:r,screens:n.data});t.errors?.forEach(a=>e.push(a)),!e.length&&a++}else{let r=n.data.reduce((e,a)=>({...e,[a.scriptId]:[...e[a.scriptId]||[],a]}),{});for(let t of Object.keys(r)){let s=await V({scriptId:t,screens:r[t]});s.errors?.forEach(a=>e.push(a)),e.length||(a+=s.saved)}}return c&&!e.length&&f.Z.emit("data_changed","copy_scripts"),{copied:a,success:!e.length,errors:e.length?e:void 0}}catch(e){return d.Z.error("copyScreens ERROR",e.message),{errors:[e.message],success:!1,copied:a}}}async function ec(e){let a=0,{diagnosesIds:r=[],fromScriptsIds:t=[],toScriptsIds:s=[],confirmCopyAll:i,broadcastAction:c}={...e};try{let e=[];if(!t.length&&!r.length&&!i)throw Error("You&apos;re about to copy all the diagnoses, please confirm this action!");let n=await o.XA({scriptsIds:t,diagnosesIds:r,returnDraftsIfExist:!0});if(n.errors?.length)throw Error(n.errors.join(", "));if(s.length)for(let r of s){let t=await ee({scriptId:r,diagnoses:n.data});t.errors?.forEach(a=>e.push(a)),!e.length&&a++}else{let r=n.data.reduce((e,a)=>({...e,[a.scriptId]:[...e[a.scriptId]||[],a]}),{});for(let t of Object.keys(r)){let s=await ee({scriptId:t,diagnoses:r[t]});s.errors?.forEach(a=>e.push(a)),e.length||(a+=s.saved)}}return c&&!e.length&&f.Z.emit("data_changed","copy_scripts"),{copied:a,success:!e.length,errors:e.length?e:void 0}}catch(e){return d.Z.error("copyDiagnoses ERROR",e.message),{errors:[e.message],success:!1,copied:a}}}(0,w.h)([y,I,E,S,O,$,_,T,D,U,P,X,W,G,Y,F,J,z,V,ee,ea,et,es,ei,ec]),(0,t.j)("9a6a909aea201a3e389e033334aa90ae45572811",y),(0,t.j)("63f50f41b0aa62343992780e7b64dde83962cd64",I),(0,t.j)("7414f092d8f2499b161e86d3a880c17e3e74d23c",E),(0,t.j)("b6ff9eca72fdb2ee4cdf34484cbb6d4a2bfb970e",S),(0,t.j)("db23447c0015dfcd4309c4336817bd72f9599b39",O),(0,t.j)("14d34e1c0c882c9fd087d8d06a92f04094770ea1",$),(0,t.j)("9f92a4479d7b4f074c1b77f5b636ba500f8b5cba",_),(0,t.j)("fd9a102246ae22deccc63c848622d80df4f37082",T),(0,t.j)("314a30391b2fbf691307f01815780f012ea95f8e",D),(0,t.j)("4e20d50be239f27a16c9c331e7333015bd9bed01",U),(0,t.j)("0fa5e0275b185c84a48b9542a1989310066b9c8e",P),(0,t.j)("e35392511610eb5ae02ddcd428a86f15a12e75b9",X),(0,t.j)("3849efdf2a1a3be2962c675dadcdad1a55b86b48",W),(0,t.j)("e066b05dba55dd73c37606000fbc180ec64a302a",G),(0,t.j)("c04a25309c959b9ad875b1cd87f25862465a6e7c",Y),(0,t.j)("69c6df8b5a73625910b016cc1bfe280bb0dae798",F),(0,t.j)("897053b4cc16f7468a332b84384181da2eb0eaf9",J),(0,t.j)("ae6873f570925637243de00701a10d8f62da8c08",z),(0,t.j)("543ce34e9f51d9fbc074ad5aab74e4b24743b77a",V),(0,t.j)("fb0339562942d139b15fa1f0d8727a08d754e6cb",ee),(0,t.j)("beeca34fd60d5ff83230eff232347f6c612273d3",ea),(0,t.j)("a84c14c5096579caee1a1e51cd3e70d170112dd1",et),(0,t.j)("4a787bce494dd708383ab762ce12c81c94e0f3c6",es),(0,t.j)("1357118a3e778d4b52adf784d1690626620829e8",ei),(0,t.j)("b7d818a87d965b8dc0d0f51b4ff648f769790f19",ec)},59271:(e,a,r)=>{r.d(a,{U:()=>s});var t=r(29712);async function s(e){let a=e.baseURL,r=e.apiKey;if(!a)throw Error("MISSING: link");if(!r)throw Error("MISSING: apiKey");let s=t.Z.create({baseURL:a});return s.interceptors.request.use(async e=>(e.headers&&(e.headers["x-api-key"]=r),e)),s.interceptors.response.use(e=>e,e=>new Promise((a,r)=>r(e))),s}},44380:(e,a,r)=>{function t(e=""){let a=process.env.NEXT_PUBLIC_APP_URL||"";return"/"===a.substring(a.length-1,a.length)&&(a=a.substring(0,a.length-1)),"/"===e[0]&&(e=e.substring(1,e.length)),[a,e].filter(e=>e).join("/")}function s(e=""){try{return new URL(e),!0}catch(e){return!1}}r.d(a,{TI:()=>t,jv:()=>s})}};