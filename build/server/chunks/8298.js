"use strict";exports.id=8298,exports.ids=[8298],exports.modules={48298:(e,t,a)=>{a.r(t),a.d(t,{$$ACTION_0:()=>ee,$$ACTION_1:()=>ea,$$ACTION_10:()=>ev,$$ACTION_11:()=>ew,$$ACTION_12:()=>e$,$$ACTION_13:()=>eA,$$ACTION_14:()=>eK,$$ACTION_15:()=>eO,$$ACTION_16:()=>eT,$$ACTION_17:()=>eV,$$ACTION_18:()=>e_,$$ACTION_19:()=>ej,$$ACTION_2:()=>es,$$ACTION_20:()=>eB,$$ACTION_21:()=>eF,$$ACTION_3:()=>ei,$$ACTION_4:()=>ec,$$ACTION_5:()=>eg,$$ACTION_6:()=>el,$$ACTION_7:()=>ey,$$ACTION_8:()=>ep,$$ACTION_9:()=>eb,countChangeLogs:()=>eh,countChangeLogsByAction:()=>ef,countChangeLogsByEntity:()=>eu,countChangeLogsByUser:()=>eL,countEntityVersions:()=>em,findRelatedChanges:()=>eq,getActiveVersion:()=>en,getChangeLog:()=>et,getChangeLogStats:()=>ed,getChangeLogs:()=>Y,getEntityHistory:()=>er,getVersionChain:()=>eo,markVersionAsSuperseded:()=>eN,rollbackChangeLog:()=>ex,rollbackDataVersion:()=>eS,saveChangeLog:()=>eD,saveChangeLogs:()=>eZ,searchChangeLogs:()=>eI,searchChangeLogsByDateRange:()=>eC,searchChangeLogsByUser:()=>eE,searchChangesByField:()=>eR,updateChangeLog:()=>ek});var r=a(24330);a(60166);var s=a(36864),n=a(57745),i=a(30900),o=a(57435),c=a(10413),d=a(93567),g=a(88317);async function h({data:e,broadcastAction:t}){let a={success:!1};try{if(!e.changeLogId&&(!e.entityId||void 0===e.version))throw Error("Either changeLogId or entityId+version is required");let r=e.changeLogId&&i.Z(e.changeLogId)?(0,n.eq)(d.changeLogs.changeLogId,e.changeLogId):(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e.entityId),(0,n.eq)(d.changeLogs.version,e.version)),s={};void 0!==e.isActive&&(s.isActive=e.isActive),void 0!==e.supersededBy&&(s.supersededBy=e.supersededBy),void 0!==e.supersededAt&&(s.supersededAt=e.supersededAt),void 0!==e.description&&(s.description=e.description),void 0!==e.changeReason&&(s.changeReason=e.changeReason);let[o]=await c.Z.update(d.changeLogs).set(s).where(r).returning();if(!o)throw Error("Change log not found");return a.success=!0,a.data=o,t&&g.Z.emit("data_changed","update_change_log"),a}catch(e){return a.success=!1,a.errors=[e.message],o.Z.error("_updateChangeLog ERROR",e.message),a}}async function l({entityId:e,version:t,supersededBy:a,broadcastAction:r}){return h({data:{entityId:e,version:t,isActive:!1,supersededBy:a,supersededAt:new Date},broadcastAction:r})}let u={script:{table:d.scripts,pk:d.scripts.scriptId,pkKey:"scriptId",versionKey:"version",publishDateKey:"publishDate"},screen:{table:d.screens,pk:d.screens.screenId,pkKey:"screenId",versionKey:"version",publishDateKey:"publishDate"},diagnosis:{table:d.diagnoses,pk:d.diagnoses.diagnosisId,pkKey:"diagnosisId",versionKey:"version",publishDateKey:"publishDate"},config_key:{table:d.configKeys,pk:d.configKeys.configKeyId,pkKey:"configKeyId",versionKey:"version",publishDateKey:"publishDate"},drugs_library:{table:d.drugsLibrary,pk:d.drugsLibrary.itemId,pkKey:"itemId",versionKey:"version",publishDateKey:"publishDate"},data_key:{table:d.dataKeys,pk:d.dataKeys.uuid,pkKey:"uuid",versionKey:"version",publishDateKey:"publishDate"},alias:{table:d.aliases,pk:d.aliases.uuid,pkKey:"uuid",publishDateKey:"publishDate"},hospital:{table:d.hospitals,pk:d.hospitals.hospitalId,pkKey:"hospitalId",versionKey:"version",publishDateKey:"publishDate"}};function y(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch{return{}}return e??{}}async function f({tx:e,binding:t,entityId:a,snapshot:r,newVersion:s}){var i,o;let c=new Date,d=(i=r??{},Object.keys(o=t.table).filter(e=>{let t=o[e];return t&&"object"==typeof t&&"name"in t}).reduce((e,t)=>(void 0!==i[t]&&(e[t]=i[t]),e),{}));d[t.pkKey]=a,t.versionKey&&(d[t.versionKey]=s),t.publishDateKey&&(d[t.publishDateKey]=c),"updatedAt"in t.table&&(d.updatedAt=c);let[g]=await e.update(t.table).set(d).where((0,n.eq)(t.pk,a)).returning();if(g)return g;let h={...d};delete h.id;let[l]=await e.insert(t.table).values(h).returning();return l}async function p({entityId:e,toVersion:t,userId:a,changeReason:r,broadcastAction:h}){let l={success:!1};try{if(!e||!i.Z(e))throw Error("Invalid entityId");let o=await c.Z.transaction(async i=>{let o=await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e),(0,n.eq)(d.changeLogs.isActive,!0)),orderBy:(e,{desc:t})=>[t(e.version)]});if(!o)throw Error("No active version found for entity");let c=Number.isFinite(o.parentVersion)?o.parentVersion:void 0,g=(void 0!==c?await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e),(0,n.eq)(d.changeLogs.version,c))}):await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e),(0,n.lt)(d.changeLogs.version,o.version)),orderBy:(e,{desc:t})=>[t(e.version)]}))??null;if(!g)throw Error("No previous version available to restore");let h=g.version;if(void 0!==t&&t!==h)throw Error(`Can only restore to immediate previous version (${h})`);if(!g)throw Error(`Previous version ${h} not found for entity`);if(g.entityType!==o.entityType)throw Error("Entity type mismatch between current and previous versions");if(!g.fullSnapshot)throw Error(`Previous version ${h} is missing a full snapshot`);let l=u[o.entityType];if(!l)throw Error(`Unsupported entity type ${o.entityType}`);let p=await i.query.editorInfo.findFirst(),L=(p?.dataVersion??o.dataVersion??0)+1,b=`Rollback to version ${g.version}`,m=y(g.fullSnapshot),v=y(o.fullSnapshot),I={entityId:e,entityType:o.entityType,action:"rollback",changes:[{action:"rollback",description:b,fromVersion:o.version,toVersion:g.version}],fullSnapshot:m,previousSnapshot:v,description:b,changeReason:r||b,parentVersion:o.version,dataVersion:L,isActive:!0,userId:a,scriptId:g.scriptId,screenId:g.screenId,diagnosisId:g.diagnosisId,configKeyId:g.configKeyId,hospitalId:g.hospitalId,drugsLibraryItemId:g.drugsLibraryItemId,dataKeyId:g.dataKeyId,aliasId:g.aliasId},w=await (0,s.C)({data:I,broadcastAction:!1,client:i});if(!w.success||!w.data)throw Error(w.errors?.join(", ")||"Failed to save rollback changelog");if(!await f({tx:i,binding:l,entityId:e,snapshot:m,newVersion:w.data.version}))throw Error("Failed to apply snapshot to entity");return p&&await i.update(d.editorInfo).set({dataVersion:L,lastPublishDate:new Date}).where((0,n.eq)(d.editorInfo.id,p.id)),w.data});return l.success=!0,l.newVersion=o?.version,l.data=o,h&&g.Z.emit("data_changed","rollback_change_log"),l}catch(e){return l.success=!1,l.errors=[e.message],o.Z.error("_rollbackChangeLog ERROR",e.message),l}}var L=a(34149),b=a(84770);let m={script:{table:d.scripts,pk:d.scripts.scriptId,pkKey:"scriptId",versionKey:"version",publishDateKey:"publishDate",numericKeys:["position"],timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},screen:{table:d.screens,pk:d.screens.screenId,pkKey:"screenId",versionKey:"version",publishDateKey:"publishDate",numericKeys:["position","timerValue","multiplier","minValue","maxValue"],timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},diagnosis:{table:d.diagnoses,pk:d.diagnoses.diagnosisId,pkKey:"diagnosisId",versionKey:"version",publishDateKey:"publishDate",numericKeys:["position","severityOrder"],timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},config_key:{table:d.configKeys,pk:d.configKeys.configKeyId,pkKey:"configKeyId",versionKey:"version",publishDateKey:"publishDate",numericKeys:["position"],timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},drugs_library:{table:d.drugsLibrary,pk:d.drugsLibrary.itemId,pkKey:"itemId",versionKey:"version",publishDateKey:"publishDate",numericKeys:["minGestation","maxGestation","minWeight","maxWeight","minAge","maxAge","hourlyFeed","hourlyFeedDivider","dosage","dosageMultiplier"],timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},data_key:{table:d.dataKeys,pk:d.dataKeys.uuid,pkKey:"uuid",versionKey:"version",publishDateKey:"publishDate",timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},alias:{table:d.aliases,pk:d.aliases.uuid,pkKey:"uuid",publishDateKey:"publishDate",timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]},hospital:{table:d.hospitals,pk:d.hospitals.hospitalId,pkKey:"hospitalId",versionKey:"version",publishDateKey:"publishDate",timestampKeys:["publishDate","createdAt","updatedAt","deletedAt"]}};function v(e){return(0,b.createHash)("sha256").update(JSON.stringify(e??{})).digest("hex")}async function I(e,t){if(t.snapshotHash)return t.snapshotHash;let a=v(t.fullSnapshot);return t.id&&await e.update(d.changeLogs).set({snapshotHash:a}).where((0,n.eq)(d.changeLogs.id,t.id)),a}function w(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch{return{}}return e??{}}async function R({tx:e,binding:t,entityId:a}){await e.select({lock:(0,L.i6)`1`}).from(t.table).where((0,n.eq)(t.pk,a)).for("update")}async function $({tx:e,binding:t,entityId:a,snapshot:r,newVersion:s}){var i,o;let c=new Date,d=(i=r??{},Object.keys(o=t.table).filter(e=>{let t=o[e];return t&&"object"==typeof t&&"name"in t}).reduce((e,t)=>(void 0!==i[t]&&(e[t]=i[t]),e),{}));(function(e){let t=/(_at|_on|_date|_time|Date$|Time$)/i;for(let a of Object.keys(e).filter(e=>t.test(e))){let t=e[a];if(!(t instanceof Date)){if(t&&("string"==typeof t||"number"==typeof t)){let r=new Date(t);if(!isNaN(r.valueOf())){e[a]=r;continue}}e[a]=null}}})(d),t.numericKeys?.length&&function(e,t){for(let a of t){if(!(a in e))continue;let t=e[a],r="number"==typeof t?t:Number(t);e[a]=Number.isFinite(r)?r:null}}(d,t.numericKeys),t.timestampKeys?.length&&function(e,t){for(let a of t){if(!(a in e))continue;let t=e[a];if(!(t instanceof Date)){if(t&&("string"==typeof t||"number"==typeof t)){let r=new Date(t);if(!isNaN(r.valueOf())){e[a]=r;continue}}e[a]=null}}}(d,t.timestampKeys),t.forceNullKeys?.length&&function(e,t){for(let a of t)a in e&&(e[a]=null)}(d,t.forceNullKeys),d[t.pkKey]=a,t.versionKey&&(d[t.versionKey]=s),t.publishDateKey&&(d[t.publishDateKey]=c),"updatedAt"in t.table&&(d.updatedAt=c),"createdAt"in t.table&&(null===d.createdAt||void 0===d.createdAt)&&(d.createdAt=c);let[g]=await e.update(t.table).set(d).where((0,n.eq)(t.pk,a)).returning();if(g)return g;let h={...d};delete h.id;let[l]=await e.insert(t.table).values(h).returning();return l}async function E(e,t,a){return await e.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,t.entityId),(0,n.eq)(d.changeLogs.entityType,t.entityType),(0,n.lt)(d.changeLogs.dataVersion,a)),orderBy:(e,{desc:t})=>[t(e.dataVersion),t(e.version)]})||(await e.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,t.entityId),(0,n.eq)(d.changeLogs.entityType,t.entityType),(0,n.lt)(d.changeLogs.version,t.version)),orderBy:(e,{desc:t})=>[t(e.version)]})??t)}async function A({dataVersion:e,userId:t,changeReason:a}){let r;let g={success:!1};try{if(!i.Z(t))throw Error("Invalid userId");return await c.Z.transaction(async i=>{let o=await i.execute((0,L.i6)`select id, data_version as "dataVersion" from nt_editor_info limit 1 for update`),c=o?.[0],g=e??c?.dataVersion;if(!g||g<2)throw Error("No data version to rollback or already at initial version");if(!c||c.dataVersion!==g)throw Error("Data version drift detected; reload and try again");let h=g-1;if(h<1)throw Error("No previous data version available to restore");let l=g+1;r=l,await i.execute((0,L.i6)`select id from nt_change_logs where data_version = ${g} and is_active = true for update`);let u=await i.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(d.changeLogs.dataVersion,g),(0,n.eq)(d.changeLogs.isActive,!0)),orderBy:(e,{asc:t})=>[t(e.entityType),t(e.entityId)]});if(!u.length)throw Error(`No active changes found for data version v${g}`);for(let e of u){let t=await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e.entityId),(0,n.eq)(d.changeLogs.entityType,e.entityType),(0,n.lt)(d.changeLogs.dataVersion,g)),orderBy:(e,{desc:t})=>[t(e.dataVersion),t(e.version)]})??e;if(!t.fullSnapshot)throw Error(`Previous snapshot missing for ${e.entityId}`);if(t.entityType!==e.entityType)throw Error(`Entity type mismatch for ${e.entityId}`);let a=v(t.fullSnapshot);if(await I(i,t)!==a)throw Error(`Snapshot hash mismatch for ${e.entityId} v${t.version}`);let r=await I(i,e),s=v(e.fullSnapshot);if(r!==s)throw Error(`Snapshot hash mismatch for current ${e.entityId} v${e.version}`)}let y=u.filter(e=>"script"===e.entityType),f=u.filter(e=>"script"!==e.entityType);for(let e of y){let r=m[e.entityType];await R({tx:i,binding:r,entityId:e.entityId});let o=await E(i,e,g);if(!o.fullSnapshot)throw Error(`Missing previous script snapshot ${e.entityId}`);let c=[];for(let t of(c.push({current:e,target:o,binding:r}),["screen","diagnosis"]))for(let a of u.filter(a=>a.entityType===t&&a.scriptId===e.scriptId)){let e=m[t];await R({tx:i,binding:e,entityId:a.entityId});let r=await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,a.entityId),(0,n.eq)(d.changeLogs.entityType,a.entityType),(0,n.lt)(d.changeLogs.dataVersion,g)),orderBy:(e,{desc:t})=>[t(e.dataVersion),t(e.version)]}),s=await E(i,a,g),o=r??s;if(!o||!o.fullSnapshot)throw Error(`Missing previous snapshot for child entity ${a.entityId}`);c.push({current:a,target:o,binding:e})}for(let{current:e,target:r,binding:n}of c){let o=r??e,c=`Rollback release v${g} -> v${l} (state of v${h})`,d=w(o.fullSnapshot),u=w(e.fullSnapshot),y={entityId:e.entityId,entityType:e.entityType,action:"rollback",changes:[{action:"rollback",description:c,fromVersion:e.version,toVersion:o.version??e.version,fromDataVersion:g,toDataVersion:h}],fullSnapshot:d,previousSnapshot:u,description:c,changeReason:a||c,parentVersion:e.version,dataVersion:l,isActive:!0,userId:t,scriptId:e.scriptId,screenId:e.screenId,diagnosisId:e.diagnosisId,configKeyId:e.configKeyId,drugsLibraryItemId:e.drugsLibraryItemId,dataKeyId:e.dataKeyId,aliasId:e.aliasId},f=await (0,s.C)({data:y,client:i});if(!f.success||!f.data)throw Error(f.errors?.join(", ")||`Failed to rollback ${e.entityId}`);if(!await $({tx:i,binding:n,entityId:e.entityId,snapshot:d,newVersion:o.version??f.data.version}))throw Error(`Failed to apply snapshot for ${e.entityId}`)}}for(let e of f){let r=m[e.entityType];if(!r)throw Error(`Unsupported entity type ${e.entityType}`);await R({tx:i,binding:r,entityId:e.entityId});let o=await i.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,e.entityId),(0,n.eq)(d.changeLogs.entityType,e.entityType),(0,n.lt)(d.changeLogs.dataVersion,g)),orderBy:(e,{desc:t})=>[t(e.dataVersion),t(e.version)]}),c=await E(i,e,g),u=o??c;if(!u||!u.fullSnapshot)throw Error(`Previous snapshot missing for ${e.entityId}`);let y=`Rollback release v${g} -> v${l} (state of v${h})`,f=w(u.fullSnapshot),p=w(e.fullSnapshot),L={entityId:e.entityId,entityType:e.entityType,action:"rollback",changes:[{action:"rollback",description:y,fromVersion:e.version,toVersion:u.version??e.version,fromDataVersion:g,toDataVersion:h}],fullSnapshot:f,previousSnapshot:p,description:y,changeReason:a||y,parentVersion:e.version,dataVersion:l,isActive:!0,userId:t,scriptId:e.scriptId,screenId:e.screenId,diagnosisId:e.diagnosisId,configKeyId:e.configKeyId,drugsLibraryItemId:e.drugsLibraryItemId,dataKeyId:e.dataKeyId,aliasId:e.aliasId},b=await (0,s.C)({data:L,client:i});if(!b.success||!b.data)throw Error(b.errors?.join(", ")||`Failed to rollback ${e.entityId}`);if(!await $({tx:i,binding:r,entityId:e.entityId,snapshot:f,newVersion:u.version??b.data.version}))throw Error(`Failed to apply snapshot for ${e.entityId}`)}c&&await i.update(d.editorInfo).set({dataVersion:l,lastPublishDate:new Date}).where((0,n.eq)(d.editorInfo.id,c.id))}),g.success=!0,g.restoredVersion=r,g}catch(e){return o.Z.error("_rollbackDataVersion ERROR",e.message),g.errors=[e.message],g}}var C=a(81445),K=a(60938);let q=["password","secret","token","credential","auth","privatekey","apikey","salt"];function O(e){return Array.isArray(e)?e.map(O):e&&"object"==typeof e?Object.entries(e).reduce((e,[t,a])=>{let r=t.toLowerCase();return q.some(e=>r.includes(e))||(e[t]=O(a)),e},{}):e}function D(e){return{...e,fullSnapshot:O(e.fullSnapshot),previousSnapshot:O(e.previousSnapshot)}}async function T(e){try{let{changeLogIds:t=[],entityIds:a=[],entityTypes:r=[],userIds:s=[],actions:o=[],isActiveOnly:g=!1,versions:h=[],dataVersions:l=[],scriptIds:u=[],screenIds:y=[],diagnosisIds:f=[],limit:p=1e3,offset:L=0,sortBy:b="dateOfChange",sortOrder:m="desc"}={...e};t=t.filter(e=>i.Z(e)),a=a.filter(e=>i.Z(e)),s=s.filter(e=>i.Z(e)),u=u.filter(e=>i.Z(e)),y=y.filter(e=>i.Z(e)),f=f.filter(e=>i.Z(e)),l=l.filter(e=>Number.isFinite(e)).map(e=>Number(e));let v=(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)(t.length?(0,n.d3)(d.changeLogs.changeLogId,t):void 0,a.length?(0,n.d3)(d.changeLogs.entityId,a):void 0,r.length?(0,n.d3)(d.changeLogs.entityType,r):void 0,s.length?(0,n.d3)(d.changeLogs.userId,s):void 0,o.length?(0,n.d3)(d.changeLogs.action,o):void 0,h.length?(0,n.d3)(d.changeLogs.version,h):void 0,l.length?(0,n.d3)(d.changeLogs.dataVersion,l):void 0,u.length?(0,n.d3)(d.changeLogs.scriptId,u):void 0,y.length?(0,n.d3)(d.changeLogs.screenId,y):void 0,f.length?(0,n.d3)(d.changeLogs.diagnosisId,f):void 0,g?(0,n.eq)(d.changeLogs.isActive,!0):void 0)).orderBy("desc"===m?(0,C.C)(d.changeLogs[b]):(0,C.d)(d.changeLogs[b])).limit(Math.max(1,Math.min(p,2e3))).offset(Math.max(0,L||0))).map(e=>D({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||"",entityName:function(e){let t=e.fullSnapshot||{};for(let e of["title","name","label","printTitle","sectionTitle","collectionLabel","key"]){let a=t[e];if("string"==typeof a&&a.trim().length)return a.trim()}if("string"==typeof e.description&&e.description.trim().length)return e.description.trim()}(e.changeLog)})),I=await c.Z.select({total:(0,K.QX)()}).from(d.changeLogs).where((0,n.xD)(t.length?(0,n.d3)(d.changeLogs.changeLogId,t):void 0,a.length?(0,n.d3)(d.changeLogs.entityId,a):void 0,r.length?(0,n.d3)(d.changeLogs.entityType,r):void 0,s.length?(0,n.d3)(d.changeLogs.userId,s):void 0,o.length?(0,n.d3)(d.changeLogs.action,o):void 0,h.length?(0,n.d3)(d.changeLogs.version,h):void 0,l.length?(0,n.d3)(d.changeLogs.dataVersion,l):void 0,u.length?(0,n.d3)(d.changeLogs.scriptId,u):void 0,y.length?(0,n.d3)(d.changeLogs.screenId,y):void 0,f.length?(0,n.d3)(d.changeLogs.diagnosisId,f):void 0,g?(0,n.eq)(d.changeLogs.isActive,!0):void 0));return await Z(v),{data:v,total:I?.[0]?.total??v.length}}catch(e){return o.Z.error("_getChangeLogs ERROR",e.message),{data:[],errors:[e.message]}}}async function Z(e){if(!e.length)return;let t=new Map;for(let a of e)a.entityId&&(t.has(a.entityType)||t.set(a.entityType,new Set),t.get(a.entityType).add(a.entityId));if(!t.size)return;let a=new Map;for(let[e,r]of Array.from(t.entries())){let t=Array.from(r);if(t.length)for(let r of(await c.Z.select({entityId:d.changeLogs.entityId,latestVersion:(0,L.i6)`max(${d.changeLogs.version})`}).from(d.changeLogs).where((0,n.xD)((0,n.eq)(d.changeLogs.entityType,e),(0,n.d3)(d.changeLogs.entityId,t))).groupBy(d.changeLogs.entityId)))null!==r.latestVersion&&void 0!==r.latestVersion&&a.set(`${e}:${r.entityId}`,Number(r.latestVersion))}for(let t of e){let e=a.get(`${t.entityType}:${t.entityId}`);void 0!==e&&(t.isActive=t.isActive&&t.version===e)}}async function V(e){let{changeLogId:t,entityId:a,version:r}={...e};try{if(!t&&(!a||void 0===r))throw Error("Missing changeLogId or entityId+version");let e=t&&i.Z(t)?(0,n.eq)(d.changeLogs.changeLogId,t):void 0,s=a&&void 0!==r?(0,n.xD)((0,n.eq)(d.changeLogs.entityId,a),(0,n.eq)(d.changeLogs.version,r)):void 0,o=await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where(e||s).limit(1);if(!o[0])return{data:null};return{data:D({...o[0].changeLog,userName:o[0].user?.name||"",userEmail:o[0].user?.email||""})}}catch(e){return o.Z.error("_getChangeLog ERROR",e.message),{errors:[e.message]}}}async function k(e){let{entityId:t,entityType:a,includeInactive:r=!1,limit:s}={...e};try{if(!t||!i.Z(t))throw Error("Invalid entityId");let e=(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)((0,n.eq)(d.changeLogs.entityId,t),a?(0,n.eq)(d.changeLogs.entityType,a):void 0,r?void 0:(0,n.eq)(d.changeLogs.isActive,!0))).orderBy((0,C.C)(d.changeLogs.version)).limit(s||100)).map(e=>D({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""})),o=e.length>0?Math.max(...e.map(e=>e.version)):void 0;return{data:e,currentVersion:o}}catch(e){return o.Z.error("_getEntityHistory ERROR",e.message),{data:[],errors:[e.message]}}}async function _(e){let{entityId:t,entityType:a}={...e};try{if(!t||!i.Z(t))throw Error("Invalid entityId");let e=await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)((0,n.eq)(d.changeLogs.entityId,t),(0,n.eq)(d.changeLogs.isActive,!0),a?(0,n.eq)(d.changeLogs.entityType,a):void 0)).orderBy((0,C.C)(d.changeLogs.version)).limit(1);if(!e[0])return{data:null};return{data:D({...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""})}}catch(e){return o.Z.error("_getActiveVersion ERROR",e.message),{errors:[e.message]}}}async function N(e){let{entityId:t,fromVersion:a,includeInactive:r=!1}={...e};try{if(!t||!i.Z(t))throw Error("Invalid entityId");let e=a;if(!e){let a=await c.Z.select({version:d.changeLogs.version}).from(d.changeLogs).where((0,n.eq)(d.changeLogs.entityId,t)).orderBy((0,C.C)(d.changeLogs.version)).limit(1);e=a[0]?.version}if(!e)return{data:[]};let s=[],o=e;for(;null!==o;){let e=await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)((0,n.eq)(d.changeLogs.entityId,t),(0,n.eq)(d.changeLogs.version,o),r?void 0:(0,n.eq)(d.changeLogs.isActive,!0))).limit(1);if(!e[0])break;s.push(D({...e[0].changeLog,userName:e[0].user?.name||"",userEmail:e[0].user?.email||""})),o=e[0].changeLog.parentVersion}return{data:s}}catch(e){return o.Z.error("_getVersionChain ERROR",e.message),{data:[],errors:[e.message]}}}async function j(e){try{let{entityId:t,entityType:a,userId:r,startDate:s,endDate:i}={...e},o=await c.Z.select({action:d.changeLogs.action,entityType:d.changeLogs.entityType,userId:d.changeLogs.userId,count:(0,L.i6)`count(*)::int`}).from(d.changeLogs).where((0,n.xD)(t?(0,n.eq)(d.changeLogs.entityId,t):void 0,a?(0,n.eq)(d.changeLogs.entityType,a):void 0,r?(0,n.eq)(d.changeLogs.userId,r):void 0,s?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${s}`:void 0,i?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${i}`:void 0)).groupBy(d.changeLogs.action,d.changeLogs.entityType,d.changeLogs.userId),g={totalChanges:0,byAction:{},byUser:{},byEntityType:{}};return o.forEach(e=>{g.totalChanges+=e.count,g.byAction[e.action]=(g.byAction[e.action]||0)+e.count,g.byEntityType[e.entityType]=(g.byEntityType[e.entityType]||0)+e.count,g.byUser[e.userId]=(g.byUser[e.userId]||0)+e.count}),{data:g}}catch(e){return o.Z.error("_getChangeLogStats ERROR",e.message),{data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}},errors:[e.message]}}}async function x(e){try{let{entityIds:t=[],entityTypes:a=[],userIds:r=[],actions:s=[],isActiveOnly:o=!1,scriptIds:g=[],screenIds:h=[],diagnosisIds:l=[],startDate:u,endDate:y}={...e};t=t.filter(e=>i.Z(e)),r=r.filter(e=>i.Z(e)),g=g.filter(e=>i.Z(e)),h=h.filter(e=>i.Z(e)),l=l.filter(e=>i.Z(e));let f=await c.Z.select({count:(0,K.QX)()}).from(d.changeLogs).where((0,n.xD)(t.length?(0,n.d3)(d.changeLogs.entityId,t):void 0,a.length?(0,n.d3)(d.changeLogs.entityType,a):void 0,r.length?(0,n.d3)(d.changeLogs.userId,r):void 0,s.length?(0,n.d3)(d.changeLogs.action,s):void 0,g.length?(0,n.d3)(d.changeLogs.scriptId,g):void 0,h.length?(0,n.d3)(d.changeLogs.screenId,h):void 0,l.length?(0,n.d3)(d.changeLogs.diagnosisId,l):void 0,o?(0,n.eq)(d.changeLogs.isActive,!0):void 0,u?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${u}`:void 0,y?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${y}`:void 0));return{count:f[0]?.count||0}}catch(e){return o.Z.error("_countChangeLogs ERROR",e.message),{count:0,errors:[e.message]}}}async function B(e){try{let{entityType:t,isActiveOnly:a=!1,startDate:r,endDate:s}={...e};return{data:await c.Z.select({entityId:d.changeLogs.entityId,entityType:d.changeLogs.entityType,totalVersions:(0,K.QX)(),activeVersions:(0,L.i6)`
                    count(*) FILTER (WHERE ${d.changeLogs.isActive} = true)::int
                `}).from(d.changeLogs).where((0,n.xD)(t?(0,n.eq)(d.changeLogs.entityType,t):void 0,a?(0,n.eq)(d.changeLogs.isActive,!0):void 0,r?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${r}`:void 0,s?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${s}`:void 0)).groupBy(d.changeLogs.entityId,d.changeLogs.entityType)}}catch(e){return o.Z.error("_countChangeLogsByEntity ERROR",e.message),{data:[],errors:[e.message]}}}async function S(e){try{let{entityId:t,entityType:a,userId:r,startDate:s,endDate:o}={...e};return{data:await c.Z.select({action:d.changeLogs.action,count:(0,K.QX)()}).from(d.changeLogs).where((0,n.xD)(t&&i.Z(t)?(0,n.eq)(d.changeLogs.entityId,t):void 0,a?(0,n.eq)(d.changeLogs.entityType,a):void 0,r&&i.Z(r)?(0,n.eq)(d.changeLogs.userId,r):void 0,s?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${s}`:void 0,o?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${o}`:void 0)).groupBy(d.changeLogs.action)}}catch(e){return o.Z.error("_countChangeLogsByAction ERROR",e.message),{data:[],errors:[e.message]}}}async function F(e){try{let{entityId:t,entityType:a,action:r,startDate:s,endDate:o}={...e};return{data:await c.Z.select({userId:d.changeLogs.userId,count:(0,K.QX)()}).from(d.changeLogs).where((0,n.xD)(t&&i.Z(t)?(0,n.eq)(d.changeLogs.entityId,t):void 0,a?(0,n.eq)(d.changeLogs.entityType,a):void 0,r?(0,n.eq)(d.changeLogs.action,r):void 0,s?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${s}`:void 0,o?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${o}`:void 0)).groupBy(d.changeLogs.userId)}}catch(e){return o.Z.error("_countChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function M(e){try{let{entityId:t,includeInactive:a=!0}={...e};if(!t||!i.Z(t))throw Error("Invalid entityId");let r=await c.Z.select({totalVersions:(0,K.QX)(),activeVersions:(0,L.i6)`
                    count(*) FILTER (WHERE ${d.changeLogs.isActive} = true)::int
                `}).from(d.changeLogs).where((0,n.xD)((0,n.eq)(d.changeLogs.entityId,t),a?void 0:(0,n.eq)(d.changeLogs.isActive,!0)));return{totalVersions:r[0]?.totalVersions||0,activeVersions:r[0]?.activeVersions||0}}catch(e){return o.Z.error("_countEntityVersions ERROR",e.message),{totalVersions:0,activeVersions:0,errors:[e.message]}}}async function U(e){try{let{searchTerm:t,entityTypes:a=[],actions:r=[],userIds:s=[],startDate:o,endDate:g,isActiveOnly:h=!1,limit:l=50,offset:u=0}={...e};s=s.filter(e=>i.Z(e));let y=t?(0,n.or)((0,n.o$)(d.changeLogs.description,`%${t}%`),(0,n.o$)(d.changeLogs.changeReason,`%${t}%`),(0,L.i6)`${d.changeLogs.changes}::text ILIKE ${"%"+t+"%"}`,(0,L.i6)`${d.changeLogs.fullSnapshot}::text ILIKE ${"%"+t+"%"}`):void 0,f=(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)(y,a.length?(0,n.d3)(d.changeLogs.entityType,a):void 0,r.length?(0,n.d3)(d.changeLogs.action,r):void 0,s.length?(0,n.d3)(d.changeLogs.userId,s):void 0,h?(0,n.eq)(d.changeLogs.isActive,!0):void 0,o?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${o}`:void 0,g?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${g}`:void 0)).orderBy((0,C.C)(d.changeLogs.dateOfChange)).limit(l).offset(u)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}));return{data:f,total:f.length}}catch(e){return o.Z.error("_searchChangeLogs ERROR",e.message),{data:[],total:0,errors:[e.message]}}}async function J(e){try{let{fieldName:t,searchValue:a,entityId:r,entityType:s,limit:o=50}={...e};if(!t)throw Error("fieldName is required");let g=a?(0,L.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${d.changeLogs.changes}) AS change
                WHERE (change->>'field' = ${t} OR change->>'fieldPath' = ${t})
                AND (
                    change->>'previousValue' ILIKE ${"%"+a+"%"}
                    OR change->>'newValue' ILIKE ${"%"+a+"%"}
                )
            )`:(0,L.i6)`EXISTS (
                SELECT 1 FROM jsonb_array_elements(${d.changeLogs.changes}) AS change
                WHERE change->>'field' = ${t} OR change->>'fieldPath' = ${t}
            )`;return{data:(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)(g,r&&i.Z(r)?(0,n.eq)(d.changeLogs.entityId,r):void 0,s?(0,n.eq)(d.changeLogs.entityType,s):void 0)).orderBy((0,C.C)(d.changeLogs.dateOfChange)).limit(o)).map(e=>{let a=(e.changeLog.changes||[]).find(e=>e.field===t||e.fieldPath===t);return{version:e.changeLog.version,entityId:e.changeLog.entityId,entityType:e.changeLog.entityType,action:e.changeLog.action,field:a?.field||a?.fieldPath||t,previousValue:a?.previousValue,newValue:a?.newValue,dateOfChange:e.changeLog.dateOfChange,userId:e.changeLog.userId,userName:e.user?.name||""}})}}catch(e){return o.Z.error("_searchChangesByField ERROR",e.message),{data:[],errors:[e.message]}}}async function H(e){try{let{userId:t,userName:a,entityType:r,action:s,startDate:o,endDate:g,limit:h=50,offset:l=0}={...e};if(!t&&!a)throw Error("Either userId or userName is required");let u=a?(0,n.o$)(d.users.displayName,`%${a}%`):t&&i.Z(t)?(0,n.eq)(d.changeLogs.userId,t):void 0;return{data:(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName,email:d.users.email}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)(u,r?(0,n.eq)(d.changeLogs.entityType,r):void 0,s?(0,n.eq)(d.changeLogs.action,s):void 0,o?(0,L.i6)`${d.changeLogs.dateOfChange} >= ${o}`:void 0,g?(0,L.i6)`${d.changeLogs.dateOfChange} <= ${g}`:void 0)).orderBy((0,C.C)(d.changeLogs.dateOfChange)).limit(h).offset(l)).map(e=>({...e.changeLog,userName:e.user?.name||"",userEmail:e.user?.email||""}))}}catch(e){return o.Z.error("_searchChangeLogsByUser ERROR",e.message),{data:[],errors:[e.message]}}}async function P(e){try{let{startDate:t,endDate:a,entityType:r,action:s,limit:i=100}={...e},o=(await c.Z.select({changeLog:d.changeLogs,user:{name:d.users.displayName}}).from(d.changeLogs).leftJoin(d.users,(0,n.eq)(d.users.userId,d.changeLogs.userId)).where((0,n.xD)((0,L.i6)`${d.changeLogs.dateOfChange} >= ${t}`,(0,L.i6)`${d.changeLogs.dateOfChange} <= ${a}`,r?(0,n.eq)(d.changeLogs.entityType,r):void 0,s?(0,n.eq)(d.changeLogs.action,s):void 0)).orderBy((0,C.C)(d.changeLogs.dateOfChange)).limit(i)).map(e=>({...e.changeLog,userName:e.user?.name||""})),g={totalChanges:o.length,byAction:{},byEntityType:{}};return o.forEach(e=>{g.byAction[e.action]=(g.byAction[e.action]||0)+1,g.byEntityType[e.entityType]=(g.byEntityType[e.entityType]||0)+1}),{data:o,summary:g}}catch(e){return o.Z.error("_searchChangeLogsByDateRange ERROR",e.message),{data:[],errors:[e.message]}}}async function X(e){try{let t;let{changeLogId:a,includeParentChain:r=!0,includeMergedVersions:s=!0}={...e};if(!a||!i.Z(a))throw Error("Invalid changeLogId");let o=await c.Z.query.changeLogs.findFirst({where:(0,n.eq)(d.changeLogs.changeLogId,a)});if(!o)throw Error("Change log not found");r&&null!==o.parentVersion&&(t=await c.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,o.entityId),(0,n.eq)(d.changeLogs.version,o.parentVersion))}));let g=await c.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,o.entityId),(0,n.eq)(d.changeLogs.parentVersion,o.version)),orderBy:[(0,C.C)(d.changeLogs.version)]}),h=[];if(s&&null!==o.mergedFromVersion){let e=await c.Z.query.changeLogs.findFirst({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,o.entityId),(0,n.eq)(d.changeLogs.version,o.mergedFromVersion))});e&&(h=[e])}let l=await c.Z.query.changeLogs.findMany({where:(0,n.xD)((0,n.eq)(d.changeLogs.entityId,o.entityId),(0,n.eq)(d.changeLogs.supersededBy,o.version)),orderBy:[(0,C.C)(d.changeLogs.version)]});return{data:{current:o,parent:t,children:g,mergedVersions:h,supersededVersions:l}}}catch(e){return o.Z.error("_findRelatedChanges ERROR",e.message),{data:{current:{},children:[],mergedVersions:[],supersededVersions:[]},errors:[e.message]}}}var Q=a(66267),W=a(72761),G=a(40618);async function z(){let e=await (0,W.$)();if(!e.yes||e.user?.role!=="super_user")throw Error("Forbidden: superuser required");return e}let Y=(0,r.j)("a902df9faab74c5b5a9b1dd1c73288b304b0ab0b",ee);async function ee(...e){try{return await (0,Q.isAllowed)(),await T(...e)}catch(e){return o.Z.error("getChangeLogs ERROR",e.message),{errors:[e.message],data:[]}}}let et=(0,r.j)("92bceb62288b969c041121123b39e70a7d40d997",ea);async function ea(...e){try{return await (0,Q.isAllowed)(),await V(...e)}catch(e){return o.Z.error("getChangeLog ERROR",e.message),{errors:[e.message]}}}let er=(0,r.j)("84a484b8e1d39eceff0ed792a2d832a5d1aa8330",es);async function es(...e){try{return await (0,Q.isAllowed)(),await k(...e)}catch(e){return o.Z.error("getEntityHistory ERROR",e.message),{errors:[e.message],data:[]}}}let en=(0,r.j)("125164335e42eb4a3b09e583d074bdcf310851df",ei);async function ei(...e){try{return await (0,Q.isAllowed)(),await _(...e)}catch(e){return o.Z.error("getActiveVersion ERROR",e.message),{errors:[e.message]}}}let eo=(0,r.j)("a64950b1b42963c067da2e56ef0bc7f4af23bda1",ec);async function ec(...e){try{return await (0,Q.isAllowed)(),await N(...e)}catch(e){return o.Z.error("getVersionChain ERROR",e.message),{errors:[e.message],data:[]}}}let ed=(0,r.j)("ae21bb834e675b72fbc6c0eb9bb93baea32d4c57",eg);async function eg(...e){try{return await (0,Q.isAllowed)(),await j(...e)}catch(e){return o.Z.error("getChangeLogStats ERROR",e.message),{errors:[e.message],data:{totalChanges:0,byAction:{},byUser:{},byEntityType:{}}}}}let eh=(0,r.j)("66bca1cb99d1aeec83c3e2b37b905dccad972ab8",el);async function el(...e){try{return await (0,Q.isAllowed)(),await x(...e)}catch(e){return o.Z.error("countChangeLogs ERROR",e.message),{errors:[e.message],count:0}}}let eu=(0,r.j)("97b08537e4975129c96ab1d3724628bb71bc91b2",ey);async function ey(...e){try{return await (0,Q.isAllowed)(),await B(...e)}catch(e){return o.Z.error("countChangeLogsByEntity ERROR",e.message),{errors:[e.message],data:[]}}}let ef=(0,r.j)("a4e90a3c53972c934686c1df394d8dbbbb8f8c69",ep);async function ep(...e){try{return await (0,Q.isAllowed)(),await S(...e)}catch(e){return o.Z.error("countChangeLogsByAction ERROR",e.message),{errors:[e.message],data:[]}}}let eL=(0,r.j)("4bbf602c0546f72efeb8bbb76176aa661aab9637",eb);async function eb(...e){try{return await (0,Q.isAllowed)(),await F(...e)}catch(e){return o.Z.error("countChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let em=(0,r.j)("48b89775a3f663bb23b3aa87d93d631abbc3b708",ev);async function ev(...e){try{return await (0,Q.isAllowed)(),await M(...e)}catch(e){return o.Z.error("countEntityVersions ERROR",e.message),{errors:[e.message],totalVersions:0,activeVersions:0}}}let eI=(0,r.j)("f286cd9a86ddb18d9159fbe749a70f2510667cda",ew);async function ew(...e){try{return await (0,Q.isAllowed)(),await U(...e)}catch(e){return o.Z.error("searchChangeLogs ERROR",e.message),{errors:[e.message],data:[],total:0}}}let eR=(0,r.j)("77b9e563d8d496f390ca9dfa478f4f26c5c055c3",e$);async function e$(...e){try{return await (0,Q.isAllowed)(),await J(...e)}catch(e){return o.Z.error("searchChangesByField ERROR",e.message),{errors:[e.message],data:[]}}}let eE=(0,r.j)("ed9535da4a8d1b8783ea3a678a7e78bbf004476f",eA);async function eA(...e){try{return await (0,Q.isAllowed)(),await H(...e)}catch(e){return o.Z.error("searchChangeLogsByUser ERROR",e.message),{errors:[e.message],data:[]}}}let eC=(0,r.j)("0c665dbbfe4dce7bb36578fb97d9eafcd42a443e",eK);async function eK(...e){try{return await (0,Q.isAllowed)(),await P(...e)}catch(e){return o.Z.error("searchChangeLogsByDateRange ERROR",e.message),{errors:[e.message],data:[]}}}let eq=(0,r.j)("448d1940a0b47660d634aa535a8dd6a2f3a58ab9",eO);async function eO(...e){try{return await (0,Q.isAllowed)(),await X(...e)}catch(e){return o.Z.error("findRelatedChanges ERROR",e.message),{errors:[e.message],data:{current:{},children:[],mergedVersions:[],supersededVersions:[]}}}}let eD=(0,r.j)("2c5b3d325b591dfcb81df207ae2232e9fc693ad4",eT);async function eT(e){try{let t=await (0,Q.isAllowed)();return await s.C({...e,data:{...e.data,userId:t.user?.userId}})}catch(e){return o.Z.error("saveChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let eZ=(0,r.j)("fa79ad974602b65967706eb4f39771d2c6ef2274",eV);async function eV(e){try{let t=await (0,Q.isAllowed)();return await s.F({...e,data:e.data.map(e=>({...e,userId:t.user?.userId}))})}catch(e){return o.Z.error("saveChangeLogs ERROR",e.message),{errors:[e.message],success:!1,saved:0}}}let ek=(0,r.j)("603da7829e6940e8b6cfcd0df00acfb3d5406e02",e_);async function e_(e){try{return await (0,Q.isAllowed)(),await h(e)}catch(e){return o.Z.error("updateChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let eN=(0,r.j)("42c4ca3cdcd829c265167e1649266c3a28ab1b8e",ej);async function ej(e){try{return await (0,Q.isAllowed)(),await l(e)}catch(e){return o.Z.error("markVersionAsSuperseded ERROR",e.message),{errors:[e.message],success:!1}}}let ex=(0,r.j)("76efc23e67a3284ed6117163ac159c837fe7f69c",eB);async function eB(e){try{let t=await z();return await p({...e,userId:t.user?.userId})}catch(e){return o.Z.error("rollbackChangeLog ERROR",e.message),{errors:[e.message],success:!1}}}let eS=(0,r.j)("eb9c5db229fd9debdbc245fbeaa4d865c89cc5ba",eF);async function eF(e){try{let t=await z();return await A({...e,userId:t.user?.userId})}catch(e){return o.Z.error("rollbackDataVersion ERROR",e.message),{errors:[e.message],success:!1}}}(0,G.h)([Y,et,er,en,eo,ed,eh,eu,ef,eL,em,eI,eR,eE,eC,eq,eD,eZ,ek,eN,ex,eS]),(0,r.j)("22faa74a8a23a5ce9d7a377fa2ba69870ad4e746",Y),(0,r.j)("ef0ac3645fc26a32f2a1c948dc946e34b9cebb1b",et),(0,r.j)("f252230dcdf0288570e6b33425289816f809edc6",er),(0,r.j)("800e16ca05753b7b62791e4c773a278a0180e9e4",en),(0,r.j)("8cb720a5fd215c273e20910affee6c55ccaaf78b",eo),(0,r.j)("99cf91db2d4bdb755f41d5133a2495865984c9dd",ed),(0,r.j)("7d7b9dea32b050424231640e680c079453ba7853",eh),(0,r.j)("3e9f4478c3f4074f6681dc3704681ef07be1a5e4",eu),(0,r.j)("65f6a6b1d958bbf1ba209aa896e811009ee298f5",ef),(0,r.j)("b10b98bfc23d466db7e72d8e045dce63f5dc7412",eL),(0,r.j)("37aeef9efd03ba9075db8d167757531e8b1119ae",em),(0,r.j)("90dcb87bc5c90c021a01b90d1be503b4e239b63d",eI),(0,r.j)("10d0ccf569a527083494b7ad64099f2b9b7d67f0",eR),(0,r.j)("261f88b2f7fd8ef7156adc4b9702228b41559567",eE),(0,r.j)("da3bbee85c7bd1031463fde9276d4ce308100b12",eC),(0,r.j)("6669d18c1bcce631e7fe44c02a2e93581620d58d",eq),(0,r.j)("bf2bf90ca9e5024b8bd8a164cb432151a6685530",eD),(0,r.j)("80287c6301547e3621b32486b16651a209165557",eZ),(0,r.j)("cd3262786c56b25dcaf7e64f9fc42cfaf61878b5",ek),(0,r.j)("1d109ab498e932569f2388818d28e2b976d9b757",eN),(0,r.j)("5a20ad455f915799b78441e9fd0847fdb9232d96",ex),(0,r.j)("7f66dd94383b4b265431f37f3092890fc2bdad2e",eS)}};