"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8668],{74149:function(e,t,r){r.d(t,{d:function(){return b}});var s=r(57437),i=r(2265),l=r(16463),a=r(39343),d=r(38472),n=r(46294),c=r(90837),o=r(86466),f=r(53699),u=r(15701),h=r(50495),m=r(39661),p=r(67135),x=r(74709),v=r(83102),y=r(37440),g=r(53853),w=r(36013);function j(e){let{children:t,errors:r=[]}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(w.Zb,{className:"bg-destructive/20 border-destructive text-destructive",children:(0,s.jsxs)(w.aY,{className:"flex flex-col gap-y-4 px-4 py-2",children:[t,!!r.length&&(0,s.jsx)("div",{children:r.map((e,t)=>(0,s.jsx)("p",{children:e},"".concat(t)))})]})})})}let I=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b(e){var t,r;let{open:w,overWriteScriptWithId:b,onOpenChange:C,onImportSuccess:k}=e,N=(0,l.useRouter)(),L=(0,l.useParams)();b=b||L.scriptId;let{copyScripts:D}=(0,u.h)(),{alert:_}=(0,f.s)(),[V,S]=(0,i.useState)(!1),{sites:E,loading:T}=(0,g.k)({onLoadSitesError:()=>C(!1)}),F=T||V,{formState:{errors:R},reset:O,watch:P,setValue:K,register:Z,handleSubmit:A}=(0,a.cI)({defaultValues:I(b)}),B=P("confirmed"),W=P("overwriteDataKeys"),z=P("overwriteDrugsLibraryItems"),G=A(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(b&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");S(!0);let r=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:b,broadcastAction:!0})).data;if(null===(t=r.errors)||void 0===t?void 0:t.length)throw Error(r.errors.join(", "));N.refresh(),_({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==k||k(),O(I(b)),C(!1)}})}catch(e){_({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{S(!1)}});return(0,s.jsxs)(s.Fragment,{children:[F&&(0,s.jsx)(m.a,{overlay:!0}),(0,s.jsx)(x.u,{open:w,onOpenChange:()=>{C(!1),O(I(b))},title:"Import script",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(c.GG,{asChild:!0,children:(0,s.jsx)(h.z,{variant:"ghost",disabled:F,onClick:()=>C(!1),children:"Cancel"})}),(0,s.jsx)(h.z,{onClick:()=>G(),disabled:F,children:"Import"})]}),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsx)(j,{children:(0,s.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,s.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,s.jsxs)(n.Ph,{name:"siteId",disabled:F,onValueChange:e=>K("siteId",e,{shouldDirty:!0}),children:[(0,s.jsx)(n.i4,{children:(0,s.jsx)(n.ki,{placeholder:"Select site"})}),(0,s.jsx)(n.Bw,{children:(0,s.jsxs)(n.DI,{children:[(0,s.jsx)(n.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:r}=e;return(0,s.jsx)(n.Ql,{value:t,children:r},t)})]})})]}),!!(null===(t=R.siteId)||void 0===t?void 0:t.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:R.siteId.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,s.jsx)(v.I,{...Z("scriptId",{disabled:F,required:!0}),name:"scriptId"}),!!(null===(r=R.scriptId)||void 0===r?void 0:r.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:R.scriptId.message})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:F,checked:W,onCheckedChange:()=>K("overwriteDataKeys",!W,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:F,checked:z,onCheckedChange:()=>K("overwriteDrugsLibraryItems",!z,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!b&&"hidden"),children:[(0,s.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:F,checked:B,onCheckedChange:()=>K("confirmed",!B,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},9769:function(e,t,r){r.d(t,{f:function(){return o}});var s=r(57437),i=r(39661),l=r(2265),a=r(37440);let d=(0,l.forwardRef)((e,t)=>{let{searchButton:r,hideSearchButton:i,onSearch:d,...n}=e,[c,o]=(0,l.useState)("");return(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==d||d(c)},children:(0,s.jsxs)("div",{className:(0,a.cn)("flex w-full"),children:[(0,s.jsx)("div",{className:(0,a.cn)("relative w-full"),children:(0,s.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:c,...n,onChange:e=>{var t;let r=e.target.value;o(r),null===(t=n.onChange)||void 0===t||t.call(n,e),r||null==d||d(r)},className:(0,a.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",n.className)})}),!i&&(0,s.jsx)("button",{type:"submit",className:(0,a.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==r?void 0:r.className),...r,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});d.displayName="SearchInput";var n=r(46294),c=r(44709);function o(e){let{search:t,setSearch:r,onSearch:l}=e;return(0,s.jsxs)(s.Fragment,{children:[t.searching&&(0,s.jsx)(i.a,{overlay:!0}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(d,{placeholder:"Search",onSearch:l})}),!!t.value&&(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(n.Ph,{value:t.filter,onValueChange:e=>r(t=>({...t,filter:e})),children:[(0,s.jsx)(n.i4,{children:(0,s.jsx)(n.ki,{placeholder:"All matches"})}),(0,s.jsx)(n.Bw,{children:c.Hc.map(e=>(0,s.jsx)(n.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}},36013:function(e,t,r){r.d(t,{Ol:function(){return d},SZ:function(){return c},Zb:function(){return a},aY:function(){return o},eW:function(){return f},ll:function(){return n}});var s=r(57437),i=r(2265),l=r(37440);let a=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i})});a.displayName="Card";let d=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...i})});d.displayName="CardHeader";let n=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});n.displayName="CardTitle";let c=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...i})});c.displayName="CardDescription";let o=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...i})});o.displayName="CardContent";let f=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...i})});f.displayName="CardFooter"},53699:function(e,t,r){r.d(t,{s:function(){return l}});var s=r(39099);let i={title:"",message:"",buttonLabel:"Ok",variant:"info",onClose:void 0},l=(0,s.Ue)(e=>({isOpen:!1,...i,alert:t=>e({isOpen:!0,...i,...t}),close:()=>e({isOpen:!1,onClose:void 0,...i})}))},53853:function(e,t,r){r.d(t,{k:function(){return d}});var s=r(2265),i=r(38472),l=r(17647),a=r(53699);function d(e){let{loadOnMount:t=!0,onLoadSitesError:r}={...e},[d,n]=(0,s.useState)(!1),{alert:c}=(0,a.s)(),{getSites:o}=(0,l.b)(),[f,u]=(0,s.useState)([]),h=(0,s.useCallback)(async()=>{try{var e;n(!0);let t=(await i.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));u(t.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==r?void 0:r()})}finally{n(!1)}},[o,c,r]);return(0,s.useEffect)(()=>{t&&!f.length&&h()},[f,t,h]),{loading:d,sites:f,loadSites:h}}},44709:function(e,t,r){function s(e){let{searchValue:t,scripts:r,screens:s,diagnoses:i}=e;t="".concat(t||"").trim().toLowerCase();let l={};return r.forEach(e=>{let r=[];"".concat(e.title||"").toLowerCase().match(t)&&r.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(t)&&r.push({field:"printTitle",fieldValue:e.printTitle}),r.length&&(l[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:r})}),s.forEach(e=>{let r=[];"".concat(e.title||"").toLowerCase().match(t)&&r.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(t)&&r.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(t)&&r.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(t)&&r.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(t)&&r.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(t)&&r.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),(e.fields||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"field_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&r.push({field:"field_label",fieldIndex:s,fieldValue:e.label})}),(e.items||[]).map((e,s)=>{"".concat(e.id||"").toLowerCase().match(t)&&r.push({field:"item_id",fieldIndex:s,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"item_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&r.push({field:"item_label",fieldIndex:s,fieldValue:e.label})}),(e.drugs||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"drug",fieldIndex:s,fieldValue:e.key})}),(e.fluids||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"fluid",fieldIndex:s,fieldValue:e.key})}),(e.feeds||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"feed",fieldIndex:s,fieldValue:e.key})}),r.length&&(l[e.scriptId]=l[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},l[e.scriptId].screens.push({title:e.title,matches:r,screenId:e.screenId,isDraft:e.isDraft}))}),i.forEach(e=>{let r=[];"".concat(e.name||"").toLowerCase().match(t)&&r.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"key",fieldValue:e.key}),(e.symptoms||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&r.push({field:"diagnosis_symptom_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(t)&&r.push({field:"diagnosis_symptom_name",fieldIndex:s,fieldValue:e.name})}),r.length&&(l[e.scriptId]=l[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},l[e.scriptId].diagnoses.push({title:e.name||"",matches:r,diagnosisId:e.diagnosisId,isDraft:e.isDraft}))}),Object.values(l)}r.d(t,{GB:function(){return s},Hc:function(){return i},_n:function(){return l}});let i=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"}];function l(e,t){if("all"===e)return t;let r=t=>"data_key"===e?"key"===t.field||"field_key"===t.field||"field_id"===t.field||"item_id"===t.field||"item_key"===t.field:"ref_id"===e?"refId"===t.field:"title"===e?"title"===t.field:"label"===e?"label"===t.field:void 0;return t.map(t=>e?{...t,matches:t.matches.filter(e=>r(e)),screens:t.screens.filter(e=>e.matches.find(e=>r(e))),diagnoses:t.diagnoses.filter(e=>e.matches.find(e=>r(e)))}:t).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}}]);