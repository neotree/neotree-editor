"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2465],{53850:function(e,t,l){l.d(t,{d:function(){return b}});var s=l(57437),a=l(2265),i=l(99376),r=l(29501),n=l(83464),d=l(53647),c=l(26110),o=l(19060),u=l(98656),h=l(79976),f=l(62869),m=l(69711),p=l(26815),x=l(9699),v=l(95186),g=l(94508),y=l(71706),j=l(60657);let w=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b(e){var t,l;let{open:b,overWriteScriptWithId:I,onOpenChange:k,onImportSuccess:C}=e,_=(0,i.useRouter)(),V=(0,i.useParams)();I=I||V.scriptId;let{copyScripts:N}=(0,h.h)(),{alert:L}=(0,u.s)(),[S,D]=(0,a.useState)(!1),{sites:E,loading:F}=(0,y.k)({onLoadSitesError:()=>k(!1)}),T=F||S,{formState:{errors:z},reset:R,watch:P,setValue:A,register:O,handleSubmit:K}=(0,r.cI)({defaultValues:w(I)}),Z=P("confirmed"),M=P("overwriteDataKeys"),B=P("overwriteDrugsLibraryItems"),G=K(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(I&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");D(!0);let l=(await n.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:I,broadcastAction:!0})).data;if(null===(t=l.errors)||void 0===t?void 0:t.length)throw Error(l.errors.join(", "));_.refresh(),L({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==C||C(),R(w(I)),k(!1)}})}catch(e){L({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{D(!1)}});return(0,s.jsxs)(s.Fragment,{children:[T&&(0,s.jsx)(m.a,{overlay:!0}),(0,s.jsx)(x.u,{open:b,onOpenChange:()=>{k(!1),R(w(I))},title:"Import script",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(c.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",disabled:T,onClick:()=>k(!1),children:"Cancel"})}),(0,s.jsx)(f.z,{onClick:()=>G(),disabled:T,children:"Import"})]}),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsx)(j._,{children:(0,s.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,s.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,s.jsxs)(d.Ph,{name:"siteId",disabled:T,onValueChange:e=>A("siteId",e,{shouldDirty:!0}),children:[(0,s.jsx)(d.i4,{children:(0,s.jsx)(d.ki,{placeholder:"Select site"})}),(0,s.jsx)(d.Bw,{children:(0,s.jsxs)(d.DI,{children:[(0,s.jsx)(d.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:l}=e;return(0,s.jsx)(d.Ql,{value:t,children:l},t)})]})})]}),!!(null===(t=z.siteId)||void 0===t?void 0:t.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:z.siteId.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,s.jsx)(v.I,{...O("scriptId",{disabled:T,required:!0}),name:"scriptId"}),!!(null===(l=z.scriptId)||void 0===l?void 0:l.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:z.scriptId.message})]}),(0,s.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:T,checked:M,onCheckedChange:()=>A("overwriteDataKeys",!M,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,s.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:T,checked:B,onCheckedChange:()=>A("overwriteDrugsLibraryItems",!B,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,s.jsxs)("div",{className:(0,g.cn)("flex gap-x-2",!I&&"hidden"),children:[(0,s.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:T,checked:Z,onCheckedChange:()=>A("confirmed",!Z,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},38789:function(e,t,l){l.d(t,{f:function(){return _}});var s=l(57437),a=l(69711),i=l(81066),r=l(53647),n=l(97930),d=l(2265),c=l(32489),o=l(83464),u=l(94508),h=l(16850),f=l(95186),m=l(26815),p=l(66070),x=l(62869),v=l(9699),g=l(8272),y=l(81103),j=l(26110),w=l(98656),b=l(86180);function I(e){let{scriptsSearchResults:t=[]}=e,l=[];return t.forEach(e=>{l.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:""}))}),e.diagnoses.forEach(t=>{l.push({type:"diagnosis",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.diagnosisId,matches:t.matches.map(e=>({...e,newValue:""}))})}),e.screens.forEach(t=>{l.push({type:"screen",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.screenId,matches:t.matches.map(e=>({...e,newValue:""}))})})}),l.filter(e=>!!e.matches.length)}let k=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function C(e){let{searchValue:t="",scriptsSearchResults:l=[]}=e,[i,n]=(0,d.useState)(!1),[C,_]=(0,d.useState)(k[0].value),[V,N]=(0,d.useState)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\"(.*?)\"/,"$1")}(t)),[L,S]=(0,d.useState)([]),[D,E]=(0,d.useState)(""),F=(0,h.N)(D),T=(0,d.useRef)(F),{confirm:z}=(0,b.t)(),{alert:R}=(0,w.s)();(0,d.useEffect)(()=>{T.current!==F&&(T.current=F,S(e=>e.map(e=>({...e,matches:e.matches.map(e=>({...e,newValue:F?e.fieldValue.replaceAll(V,F):""}))}))))},[V,F,L]);let P=(0,d.useCallback)(()=>{_(k[0].value),N(V),S(I(e)),E(""),T.current=""},[e]),A=!L.length||!D,O=(0,d.useCallback)(t=>{T.current="",_(t),S(I(e).filter(e=>{switch(t){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[C,e]),K=(0,d.useCallback)(async()=>{try{n(!0);let e=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:L.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,t)=>({...e,[t.field]:t.newValue}),{})})),screens:L.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,t)=>{let l=e._fields||[],s=e._items||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else if(t.field.includes("field_item_")){let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field.substring(11)]:t.newValue}}}else{let e=s.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=s.length),s[e]={index:t.fieldIndex,data:{...s[e],[t.field.substring(5)]:t.newValue}}}return{...e,_fields:l,_items:s}},{})}})),diagnoses:L.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,t)=>{let l=e._fields||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else{let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field]:t.newValue}}}return{...e,_fields:l}},{})}}))})).data;e.errors?R({title:"Error",message:e.errors.join(", "),variant:"error"}):R({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){R({title:"Error",message:e.message,variant:"error"})}finally{n(!1)}},[L]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(v.u,{onOpenChange:()=>{P()},title:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),(0,s.jsx)(f.I,{disabled:!0,name:"searchValue",value:V,onChange:e=>N(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),(0,s.jsx)(f.I,{name:"replaceWith",value:D,onChange:e=>E(e.target.value)})]})]}),(0,s.jsx)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(r.Ph,{value:C,onValueChange:O,children:[(0,s.jsx)(r.i4,{children:(0,s.jsx)(r.ki,{placeholder:"All matches"})}),(0,s.jsx)(r.Bw,{children:k.map(e=>(0,s.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})})]})})]}),trigger:(0,s.jsx)(j.hg,{asChild:!0,children:(0,s.jsx)(x.z,{children:"Replace"})}),actions:(0,s.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[(0,s.jsx)(j.GG,{asChild:!0,children:(0,s.jsx)(x.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(x.z,{disabled:A,onClick:()=>z(K,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-6",children:[!L.length&&(0,s.jsx)("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),L.map(e=>(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[i&&(0,s.jsx)(a.a,{overlay:!0,transparent:!0}),(0,s.jsxs)("div",{className:"text-sm",children:[e.parent?(0,s.jsxs)("div",{children:[(0,s.jsxs)("b",{children:[(0,g.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,s.jsxs)("div",{children:[(0,s.jsxs)("b",{children:[(0,g.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((t,l)=>{let a=e.id+"_match".concat(l);return(0,s.jsx)(p.Zb,{children:(0,s.jsxs)(p.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[t.field,"number"==typeof t.fieldIndex&&(0,s.jsxs)(s.Fragment,{children:["\xa0(",(0,s.jsx)("b",{children:"position"})," = ",t.fieldIndex+1,")"]})]})}),(0,s.jsx)("code",{className:(0,u.cn)("block",t.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:t.fieldValue.replaceAll(V,"<mark>".concat(V,"</mark>"))}}),t.newValue&&(0,s.jsx)("code",{className:(0,u.cn)("block",D&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:t.newValue.replaceAll(F,"<mark>".concat(F,"</mark>"))}})]}),(0,s.jsx)("div",{children:(0,s.jsx)(y.pn,{delayDuration:0,children:(0,s.jsxs)(y.u,{children:[(0,s.jsx)(y.aJ,{children:(0,s.jsx)(x.z,{variant:"ghost",onClick:()=>S(e=>e.filter((e,t)=>t!==l)),children:(0,s.jsx)(c.Z,{className:"size-4"})})}),(0,s.jsx)(y._v,{children:"Remove"})]})})})]})},a)})]},e.id))]})})})}function _(e){var t;let{search:l,setSearch:d,onSearch:c}=e;return(0,s.jsxs)(s.Fragment,{children:[l.searching&&(0,s.jsx)(a.a,{overlay:!0}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(i.M,{placeholder:"Search",onSearch:c})}),!!l.value&&(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(r.Ph,{value:l.filter,onValueChange:e=>d(t=>({...t,filter:e,results:(0,n._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,s.jsx)(r.i4,{children:(0,s.jsx)(r.ki,{placeholder:"All matches"})}),(0,s.jsx)(r.Bw,{children:n.Hc.map(e=>(0,s.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!(null===(t=l.results)||void 0===t?void 0:t.length)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(C,{searchValue:l.value,scriptsSearchResults:l.results})})]})]})}},81066:function(e,t,l){l.d(t,{M:function(){return r}});var s=l(57437),a=l(2265),i=l(94508);let r=(0,a.forwardRef)((e,t)=>{let{searchButton:l,hideSearchButton:r,onSearch:n,...d}=e,[c,o]=(0,a.useState)("");return(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==n||n(c)},children:(0,s.jsxs)("div",{className:(0,i.cn)("flex w-full"),children:[(0,s.jsx)("div",{className:(0,i.cn)("relative w-full"),children:(0,s.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var t;let l=e.target.value;o(l),null===(t=d.onChange)||void 0===t||t.call(d,e),l||null==n||n(l)},className:(0,i.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!r&&(0,s.jsx)("button",{type:"submit",className:(0,i.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==l?void 0:l.className),...l,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},81103:function(e,t,l){l.d(t,{_v:function(){return o},aJ:function(){return c},pn:function(){return n},u:function(){return d}});var s=l(57437),a=l(2265),i=l(91668),r=l(94508);let n=i.zt,d=i.fC,c=i.xz,o=a.forwardRef((e,t)=>{let{className:l,sideOffset:a=4,...n}=e;return(0,s.jsx)(i.VY,{ref:t,sideOffset:a,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...n})});o.displayName=i.VY.displayName},71706:function(e,t,l){l.d(t,{k:function(){return n}});var s=l(2265),a=l(83464),i=l(67132),r=l(98656);function n(e){let{loadOnMount:t=!0,onLoadSitesError:l}={...e},[n,d]=(0,s.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,i.b)(),[u,h]=(0,s.useState)([]),f=(0,s.useCallback)(async()=>{try{var e;d(!0);let t=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));h(t.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==l?void 0:l()})}finally{d(!1)}},[o,c,l]);return(0,s.useEffect)(()=>{t&&!u.length&&f()},[u,t,f]),{loading:n,sites:u,loadSites:f}}},97930:function(e,t,l){l.d(t,{GB:function(){return a},Hc:function(){return i},_n:function(){return n}});var s=l(16548);function a(e){let{searchValue:t,scripts:l,screens:a,diagnoses:i}=e,{normalizedValue:r,isExactMatch:n}=(0,s.l)(t);if(!r)return[];let d=(0,s.y)(r),c=new RegExp(n?"^".concat(d,"$"):d),o={};return l.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(c)&&t.push({field:"printTitle",fieldValue:e.printTitle}),t.length&&(o[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:t})}),a.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(c)&&t.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(c)&&t.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(c)&&t.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(c)&&t.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"field_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_label",fieldIndex:l,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"field_condition",fieldIndex:l,fieldValue:e.condition}),(e.items||[]).map((e,s)=>{"".concat(e.value||"").toLowerCase().match(c)&&t.push({field:"field_item_key",fieldIndex:l,fieldItemIndex:s,fieldValue:e.value}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_item_label",fieldIndex:l,fieldItemIndex:s,fieldValue:e.label})})}),(e.items||[]).map((e,l)=>{"".concat(e.id||"").toLowerCase().match(c)&&t.push({field:"item_id",fieldIndex:l,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"item_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"item_label",fieldIndex:l,fieldValue:e.label})}),(e.drugs||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"drug",fieldIndex:l,fieldValue:e.key})}),(e.fluids||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"fluid",fieldIndex:l,fieldValue:e.key})}),(e.feeds||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"feed",fieldIndex:l,fieldValue:e.key})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].screens.push({title:e.title,matches:t,screenId:e.screenId,isDraft:e.isDraft,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),i.forEach(e=>{let t=[];"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_name",fieldIndex:l,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_expression",fieldIndex:l,fieldValue:e.expression})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].diagnoses.push({title:e.name||"",matches:t,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(o)}let i=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function n(e){let{searchValue:t,filter:l,results:s}=e;if("all"===l)return s;let a=e=>r[e.field]===l;return s.map(e=>l?{...e,matches:e.matches.filter(e=>a(e)),screens:e.screens.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},16548:function(e,t,l){l.d(t,{l:function(){return r},y:function(){return i}});let s=['"',"“"],a=['"',"”"];function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function r(e){let t="".concat(null!=e?e:"").trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let l=s.includes(t[0]),i=a.includes(t[t.length-1]),r=t.length>1&&l&&i;return{normalizedValue:(r?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:r}}}}]);