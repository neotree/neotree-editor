(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4632],{83898:function(e,s,n){Promise.resolve().then(n.bind(n,45427)),Promise.resolve().then(n.bind(n,95229)),Promise.resolve().then(n.bind(n,25704)),Promise.resolve().then(n.t.bind(n,231,23))},45427:function(e,s,n){"use strict";n.d(s,{DiagnosisForm:function(){return A}});var i=n(57437),t=n(2265),l=n(16463),r=n(50495),a=n(83102),o=n(93146),d=n(67135),c=n(64344),m=n(39661),x=n(37440),h=n(87861),u=n(39343),p=n(20920),j=n(38472),g=n(15701),v=n(53699),y=n(17647),f=n(83146),b=n(20021),N=n(12599),k=n(92513),w=n(45188),D=n(6649),C=n(90399),F=n(76942),I=n(90837),_=n(46910),S=n(76230),R=n(17501);function V(e){let{disabled:s,selected:n,onDelete:t,onCopy:l}=e;return(0,i.jsx)(i.Fragment,{children:!!n.length&&(0,i.jsx)(R.h,{children:(0,i.jsxs)(r.z,{variant:"destructive",className:"h-auto w-auto",disabled:s,onClick:()=>t(),children:[(0,i.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:n.length>1?"Delete ".concat(n.length," symptoms"):"Delete symptom"})]})})})}var M=n(9704),z=n(85070),O=n(86466),T=n(21453),Z=n(84760);function E(e){let{children:s,symptom:n,form:l,disabled:o,...c}=e,{data:m,index:h}={...n},[j,g]=(0,t.useState)(!1),v=(0,t.useCallback)(()=>({symptomId:(null==m?void 0:m.symptomId)||(0,p.Z)(),expression:(null==m?void 0:m.expression)||"",name:(null==m?void 0:m.name)||"",weight:(null==m?void 0:m.weight)||null,type:(null==m?void 0:m.type)||f.ph[0].value,position:(null==m?void 0:m.position)||1,printable:(null==m?void 0:m.printable)||!0,...m}),[m]),{reset:y,watch:b,register:N,handleSubmit:k,setValue:w}=(0,u.cI)({defaultValues:v()}),D=b("type"),C=b("name"),F=b("printable"),_=(0,t.useMemo)(()=>!!o,[o]),S=k(e=>{!(0,T.x)(h)&&m?l.setValue("symptoms",l.getValues("symptoms").map((s,n)=>({...s,...n===h?e:null}))):l.setValue("symptoms",[...l.getValues("symptoms"),e],{shouldDirty:!0}),g(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(M.u,{open:j,title:m?"Add symptom":"Edit symptom",trigger:"function"==typeof s?s({extraProps:c}):s,onOpenChange:e=>{g(e),y(v())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",_&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(I.GG,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(r.z,{disabled:_,onClick:()=>S(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(Z.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(z.E,{disabled:_,defaultValue:D,onValueChange:e=>w("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:f.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(z.m,{value:e.value,id:e.value}),(0,i.jsx)(d._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(Z.D,{children:"Properties"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{error:!_&&!C,htmlFor:"name",children:"Name *"}),(0,i.jsx)(a.I,{...N("name",{disabled:_,required:!0}),name:"name",error:!_&&!C})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(a.I,{...N("weight",{disabled:_}),name:"weight",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(a.I,{...N("expression",{disabled:_}),name:"expression"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:"($key = true and $key2 = false) or $key3 = 'HD'"})]})]}),(0,i.jsx)(Z.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(O.X,{id:"printable",disabled:_,checked:F,onCheckedChange:()=>w("printable",!F,{shouldDirty:!0})}),(0,i.jsx)(d._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function P(e){let{form:s,disabled:n}=e,[l,a]=(0,t.useState)([]),{confirm:o}=(0,S.t)(),d=s.watch("symptoms"),c=(0,t.useCallback)((e,n)=>{let i=(0,N.q)([...d],e,n);s.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[s,d]),m=(0,t.useCallback)(e=>{let n=d.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");o(()=>{let n=d.filter((s,n)=>!e.includes(n));s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),a([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),danger:!0,positiveLabel:"Delete"})},[s,d,o]),h=(0,t.useCallback)(e=>{let n=d.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");o(()=>{let n=[...d,...d.filter((s,n)=>e.includes(n)).map((e,s)=>({...e,position:d.length+1+s}))];s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),a([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),positiveLabel:"Duplicate"})},[s,d,o]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.DataTable,{title:"Symptoms",sortable:!n,selectable:!n,onSort:c,selectedIndexes:l,onSelect:a,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E,{form:s,disabled:n,children:!n&&(0,i.jsx)(I.hg,{asChild:!0,children:(0,i.jsxs)(r.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:t}=e,l=d[t];return(0,i.jsxs)(_.h_,{children:[(0,i.jsx)(_.$F,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(w.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(_.AW,{children:[(0,i.jsx)(_.Xi,{asChild:!0,children:(0,i.jsx)(E,{disabled:n,form:s,symptom:{data:l,index:t},children:e=>{let{extraProps:s}=e;return(0,i.jsxs)(I.hg,{...s,className:(0,x.cn)(null==s?void 0:s.className,"w-full"),children:[(0,i.jsx)(D.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:n?"View":"Edit"})]})}})}),(0,i.jsxs)(_.Xi,{onClick:()=>m([t]),className:(0,x.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:n,children:[(0,i.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:d.map(e=>[e.type,e.name,""])}),!n&&(0,i.jsx)(V,{disabled:n,selected:l,onDelete:()=>m(l),onCopy:()=>h(l)})]})}function A(e){let s=(0,l.useRouter)(),n=function(e){let{formData:s,scriptId:n}=e,i=(0,l.useRouter)(),[r,a]=(0,t.useState)(!1),{saveDiagnoses:o}=(0,g.h)(),{alert:d}=(0,v.s)(),{viewOnly:c}=(0,y.b)(),m=(0,t.useMemo)(()=>"/script/".concat(n,"?section=diagnoses"),[n]),x=(0,t.useCallback)(()=>({version:(null==s?void 0:s.version)||1,scriptId:(null==s?void 0:s.scriptId)||n,diagnosisId:(null==s?void 0:s.diagnosisId)||(0,p.Z)(),name:(null==s?void 0:s.name)||"",description:(null==s?void 0:s.description)||"",key:(null==s?void 0:s.key)||"",expression:(null==s?void 0:s.expression)||"",expressionMeaning:(null==s?void 0:s.expressionMeaning)||"",severityOrder:(null==s?void 0:s.severityOrder)||null,symptoms:(null==s?void 0:s.symptoms)||[],text1:(null==s?void 0:s.text1)||"",text2:(null==s?void 0:s.text2)||"",text3:(null==s?void 0:s.text3)||"",image1:(null==s?void 0:s.image1)||null,image2:(null==s?void 0:s.image2)||null,image3:(null==s?void 0:s.image3)||null,preferences:(null==s?void 0:s.preferences)||f.$7}),[s,n]),h=(0,u.cI)({defaultValues:x()}),{formState:{dirtyFields:b},handleSubmit:N}=h,k=(0,t.useMemo)(()=>!!Object.keys(b).length,[b]),w=N(async e=>{try{var s;a(!0);let n={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!n.scriptId)throw Error("Diagnosis is missing script reference!");let t=(await j.Z.post("/api/diagnoses/save",{data:[n],broadcastAction:!0})).data;if(null===(s=t.errors)||void 0===s?void 0:s.length)throw Error(t.errors.join(", "));i.refresh(),d({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>i.push(m)})}catch(e){d({variant:"error",message:"Failed to save draft: "+e.message})}finally{a(!1)}}),D=(0,t.useMemo)(()=>r||c,[r,c]);return{...h,formIsDirty:k,saving:r,scriptPageHref:m,disabled:D,save:w,getDefaultValues:x}}(e),{formIsDirty:N,saving:k,scriptPageHref:w,disabled:D,register:C,watch:F,setValue:I,save:_}=n,S=F("name"),R=F("key"),V=F("image1"),M=F("image2"),z=F("image3"),O=F("preferences"),T=(0,t.useCallback)(()=>{s.push(w)},[s,w]);return(0,i.jsxs)(i.Fragment,{children:[k&&(0,i.jsx)(m.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"name",error:!D&&!S,children:"Name *"}),(0,i.jsx)(a.I,{...C("name",{disabled:D,required:!0}),name:"name",noRing:!1,error:!D&&!S})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(a.I,{...C("severityOrder",{disabled:D}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(d._,{htmlFor:"key",error:!D&&!R,children:"Key *"}),(0,i.jsx)(a.I,{...C("key",{disabled:D,required:!0}),name:"key",noRing:!1,error:!D&&!R})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(a.I,{...C("description",{disabled:D}),name:"description",noRing:!1}),(0,i.jsx)(h.w,{id:"description",title:"Description",disabled:D,data:O,onSave:e=>I("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(a.I,{...C("expression",{disabled:D}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(a.I,{...C("expressionMeaning",{disabled:D}),name:"expressionMeaning",noRing:!1})]}),[["text1",V],["text2",M],["text3",z]].map((e,s)=>{let[n,l]=e,r="image".concat(s+1);return(0,i.jsx)(t.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(d._,{htmlFor:"imageTextFields.".concat(s,".text"),children:["Text ",s+1]}),(0,i.jsx)(o.g,{...C(n,{disabled:D}),name:"text".concat(s+1),noRing:!1,rows:5}),(0,i.jsx)(h.w,{id:n,title:"Text ".concat(s+1),disabled:D,data:O,onSave:e=>I("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(b.M,{disabled:D,image:l,onChange:e=>I(r,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(s))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",D&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(r.z,{variant:"ghost",onClick:()=>T(),children:"Cancel"}),(0,i.jsx)(r.z,{disabled:D,onClick:()=>_(),children:"Save Draft"})]}),(0,i.jsx)(c.Z,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)(P,{disabled:D,form:n})})]})}},48484:function(e,s,n){"use strict";n.d(s,{f:function(){return d}});var i=n(2265),t=n(25171),l=n(57437),r="horizontal",a=["horizontal","vertical"],o=i.forwardRef((e,s)=>{let{decorative:n,orientation:i=r,...o}=e,d=a.includes(i)?i:r;return(0,l.jsx)(t.WV.div,{"data-orientation":d,...n?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...o,ref:s})});o.displayName="Separator";var d=o}}]);