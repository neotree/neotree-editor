"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5216],{62618:function(e,t,a){a.d(t,{R:function(){return v},a:function(){return p}});var r=a(2265),l=a(99376),s=a(78062),i=a(83464),n=a(59625),o=a(98656),d=a(62265),u=a(42033),c=a(67132),y=a(22381);let g={value:"",filter:"all",searching:!1,results:[],unfilteredResults:[]},m={initialised:!1,loading:!1,keys:[],drugs:[],typeFilter:"",statusFilter:"",sortBy:"name-asc"},f=(0,n.Ue)(e=>m);function v(){f.setState(m)}function p(){let e=f(),{drugs:t,typeFilter:a,statusFilter:n,sortBy:v}=e,{authenticatedUser:p}=(0,c.b)(),k=(0,l.useRouter)(),h=(0,l.useSearchParams)(),b=(0,r.useMemo)(()=>s.Z.parse(h.toString()),[h]),{itemId:I}=b,w=(0,r.useMemo)(()=>{var e;return null===(e=t.filter(e=>e.itemId===I||e.key===I)[0])||void 0===e?void 0:e.itemId},[I,t]),{alert:C}=(0,o.s)(),[S,_]=(0,r.useState)(g),E=(0,r.useCallback)(()=>_(g),[]),T=(0,r.useCallback)(()=>{let e=[],r=S.value?new Set(S.results.map(e=>e.itemId)):void 0,l=t.map(e=>[e.drug||"",e.type||"",e.key||"",e.dosageText||"",e.itemId]),s=[...l=l.filter((l,s)=>{let i=t[s];if(!i)return!1;let o=!0;return r&&(o=r.has(i.itemId)),o&&a&&"all"!==a&&(o=(i.type||"").toLowerCase()===a.toLowerCase()),o&&n&&"all"!==n&&("draft"===n?o=!0===i.isDraft:"published"===n&&(o=!i.isDraft)),o&&e.push(t[s]),o})],i=[...e],o=s.map((e,t)=>({row:e,drug:i[t]}));switch(v){case"name-asc":o.sort((e,t)=>(e.drug.drug||"").localeCompare(t.drug.drug||""));break;case"name-desc":o.sort((e,t)=>(t.drug.drug||"").localeCompare(e.drug.drug||""));break;case"type-asc":o.sort((e,t)=>(e.drug.type||"").localeCompare(t.drug.type||""));break;case"type-desc":o.sort((e,t)=>(t.drug.type||"").localeCompare(e.drug.type||""));break;case"key-asc":o.sort((e,t)=>(e.drug.key||"").localeCompare(t.drug.key||""));break;case"key-desc":o.sort((e,t)=>(t.drug.key||"").localeCompare(e.drug.key||""))}return{tableData:o.map(e=>e.row),filteredDrugs:o.map(e=>e.drug)}},[t,S,a,n,v]),D=(0,r.useCallback)(async e=>{try{var t;E();let a="".concat(e||"").trim();if(!a)return;_(e=>({...e,value:a,searching:!0}));let{data:r}=await i.Z.get("/api/drugs-library/search?searchValue=".concat(encodeURIComponent(a)));if(null===(t=r.errors)||void 0===t?void 0:t.length)throw Error(r.errors.join(", "));_(e=>{let t=r.data||[];return{value:a,filter:e.filter,searching:!1,results:(0,u.UZ)({searchValue:a,filter:e.filter,results:t}),unfilteredResults:t}})}catch(e){E()}},[E]),{tableData:Z,filteredDrugs:K}=(0,r.useMemo)(()=>T(),[T]),L=(0,r.useCallback)(async()=>{try{var e,t;f.setState({loading:!0});let a=await i.Z.get("/api/drugs-library?data="+JSON.stringify({returnDraftsIfExist:!0}));if(null===(e=a.data.errors)||void 0===e?void 0:e.length)throw Error(null===(t=a.data.errors)||void 0===t?void 0:t.join(", "));f.setState({drugs:a.data.data})}catch(e){C({title:"Error",message:e.message,variant:"error"})}finally{f.setState({loading:!1})}},[C]);!function(e){let{events:t}=e,a=(0,r.useMemo)(()=>t,[t]),s=(0,r.useRef)({eventsTimeouts:{},eventsTimestamps:{}});(0,r.useRef)(new Date().getTime());let i=(0,l.useRouter)();(0,r.useEffect)(()=>{a.forEach(e=>{let{name:t,action:a,delay:r=100,onEvent:l}=e;d.Z.on(t,function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let d=()=>{var e,r;(!a||n[0]===a)&&(null===(e=l.callback)||void 0===e||e.call(l,...n),(null==l?void 0:l.refreshRouter)&&(console.log(t,"refreshing..."),i.refresh()),(null===(r=l.redirect)||void 0===r?void 0:r.to)&&(l.redirect.replace?i.replace(l.redirect.to):i.push(l.redirect.to)))},u=new Date().getTime();r?(clearTimeout(s.current.eventsTimeouts[t]),s.current.eventsTimeouts[t]=setTimeout(()=>{s.current.eventsTimestamps[t]=u,d()},r)):(s.current.eventsTimestamps[t]=new Date().getTime(),d())})})},[a,i])}({events:[{name:"data_changed",onEvent:{callback:async()=>{await L(),k.refresh()}}}]});let R=(0,r.useCallback)(async e=>{let a=t.filter(t=>t.itemId&&e.includes(t.itemId));try{var r,l;f.setState(t=>({loading:!0,drugs:t.drugs.filter(t=>!e.includes(t.itemId))}));let t=await i.Z.delete("/api/drugs-library?data="+JSON.stringify({itemsIds:e}));if(null===(r=t.data.errors)||void 0===r?void 0:r.length)throw Error(null===(l=t.data.errors)||void 0===l?void 0:l.join(", "));await Promise.all(a.map(async e=>{if(!(null==e?void 0:e.itemId))return;let{isDraft:t,draftCreatedByUserId:a,...r}=e,l=e.drug||e.key||"Drugs Library Item";await (0,y.KL)({entityId:e.itemId,entityType:"drugsLibraryItem",entityTitle:l,snapshot:r,userId:null==p?void 0:p.userId,userName:null==p?void 0:p.displayName,description:'Marked "'.concat(l,'" for deletion')})})),k.refresh(),C({title:"",message:"Drug deleted successfully!",variant:"success"})}catch(e){C({title:"Error",message:e.message,variant:"error"})}finally{f.setState({loading:!1})}},[C,k.refresh,t,null==p?void 0:p.userId,null==p?void 0:p.displayName]),N=(0,r.useCallback)(async e=>{try{var a,r;f.setState({loading:!0});let l=[],s=[],n=t;f.setState(t=>(n=!w&&e?[...t.drugs,e]:t.drugs.map(t=>t.itemId!==(null==e?void 0:e.itemId)?t:(e&&(t.key!==e.key&&s.push({old:t.key,new:e.key}),t.type!==e.type&&l.push(t.key)),{...t,...e})),{loading:!0,drugs:n}));let o={data:e?[e]:n,broadcastAction:!0},d=await i.Z.post("/api/drugs-library/save",o);if(null===(a=d.data.errors)||void 0===a?void 0:a.length)throw Error(null===(r=d.data.errors)||void 0===r?void 0:r.join(", "));await L(),k.refresh(),C({title:"",message:"Drug".concat(e?"":"s"," saved successfully!"),variant:"success"})}catch(e){C({title:"Error",message:e.message,variant:"error"})}finally{f.setState({loading:!1})}},[t,w,k.refresh]),x=(0,r.useCallback)(async e=>{try{var t,a;f.setState({loading:!0});let r={data:e.map(e=>({itemId:e})),broadcastAction:!0},l=await i.Z.post("/api/drugs-library/copy",r);if(null===(t=l.data.errors)||void 0===t?void 0:t.length)throw Error(null===(a=l.data.errors)||void 0===a?void 0:a.join(", "));await L(),k.refresh(),C({title:"",message:"Drug".concat(e.length<2?"":"s"," copied successfully!"),variant:"success"})}catch(e){C({title:"Error",message:e.message,variant:"error"})}finally{f.setState({loading:!1})}},[k.refresh]);(0,r.useEffect)(()=>{f.getState().initialised||(L(),f.setState({initialised:!0}))},[L]),(0,r.useCallback)(()=>{f.setState(m)},[]);let A=(0,r.useCallback)(e=>{f.setState({typeFilter:e})},[]),j=(0,r.useCallback)(e=>{f.setState({statusFilter:e})},[]),F=(0,r.useCallback)(e=>{f.setState({sortBy:e})},[]);return{...e,search:S,filteredDrugs:K,tableData:Z,selectedItemId:w,addLink:e=>"?".concat(s.Z.stringify({...b,addItem:e})),editLink:e=>"?".concat(s.Z.stringify({...b,itemId:e})),getDrugs:L,deleteDrugs:R,saveDrugs:N,copyDrugs:x,setSearch:_,clearSearch:E,onSearch:D,setTypeFilter:A,setStatusFilter:j,setSortBy:F}}},42033:function(e,t,a){a.d(t,{UZ:function(){return i},kv:function(){return l}});var r=a(16548);let l=[{value:"all",label:"All matches"},{value:"data_key",label:"Data keys only"},{value:"key_id",label:"Key IDs only"},{value:"label",label:"Label text only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],s={key:"data_key",gestationKey:"data_key",weightKey:"data_key",diagnosisKey:"data_key",ageKey:"data_key",preferenceKey:"data_key",keyId:"key_id",gestationKeyId:"key_id",weightKeyId:"key_id",diagnosisKeyId:"key_id",ageKeyId:"key_id",title:"title",dosageText:"label",managementText:"label",administrationFrequency:"label",routeOfAdministration:"label",type:"label",preferenceValue:"label",condition:"condition"};function i(e){let{searchValue:t,filter:a,results:l}=e;if("all"===a)return l;let{normalizedValue:i,isExactMatch:n}=(0,r.l)(t);return i?l.map(e=>{let t=e.matches.filter(e=>{if(!a)return!0;if(s[e.field]!==a)return!1;let t=n?"".concat(e.fieldValue):"".concat(e.fieldValue).toLowerCase();return n?t===i:!!t.includes(i)});return{...e,matches:t}}).filter(e=>e.matches.length):l}},8272:function(e,t){t.Z=e=>"".concat(e||"").charAt(0).toUpperCase()+"".concat(e||"").slice(1)}}]);