(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8430],{28430:function(e,s,n){Promise.resolve().then(n.bind(n,45427)),Promise.resolve().then(n.bind(n,95229)),Promise.resolve().then(n.bind(n,25704)),Promise.resolve().then(n.t.bind(n,231,23))},45427:function(e,s,n){"use strict";n.d(s,{DiagnosisForm:function(){return A}});var i=n(57437),l=n(2265),t=n(16463),r=n(50495),a=n(83102),d=n(93146),o=n(67135),c=n(64344),m=n(39661),x=n(37440),h=n(87861),u=n(39343),p=n(20920),j=n(38472),g=n(15701),v=n(53699),y=n(17647),f=n(83146),b=n(87973),N=n(12599),k=n(92513),D=n(45188),w=n(6649),C=n(90399),F=n(75944),I=n(90837),_=n(46910),S=n(76230),R=n(17501);function V(e){let{disabled:s,selected:n,onDelete:l,onCopy:t}=e;return(0,i.jsx)(i.Fragment,{children:!!n.length&&(0,i.jsx)(R.h,{children:(0,i.jsxs)(r.z,{variant:"destructive",className:"h-auto w-auto",disabled:s,onClick:()=>l(),children:[(0,i.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:n.length>1?"Delete ".concat(n.length," symptoms"):"Delete symptom"})]})})})}var M=n(9704),O=n(85070),T=n(86466),Z=n(21453),z=n(84760);function E(e){let{children:s,symptom:n,form:t,disabled:d,...c}=e,{data:m,index:h}={...n},[j,g]=(0,l.useState)(!1),v=(0,l.useCallback)(()=>({symptomId:(null==m?void 0:m.symptomId)||(0,p.Z)(),expression:(null==m?void 0:m.expression)||"",name:(null==m?void 0:m.name)||"",weight:(null==m?void 0:m.weight)||null,type:(null==m?void 0:m.type)||f.ph[0].value,position:(null==m?void 0:m.position)||1,printable:(null==m?void 0:m.printable)||!0,...m}),[m]),{reset:y,watch:b,register:N,handleSubmit:k,setValue:D}=(0,u.cI)({defaultValues:v()}),w=b("type"),C=b("name"),F=b("printable"),_=(0,l.useMemo)(()=>!!d,[d]),S=k(e=>{!(0,Z.x)(h)&&m?t.setValue("symptoms",t.getValues("symptoms").map((s,n)=>({...s,...n===h?e:null}))):t.setValue("symptoms",[...t.getValues("symptoms"),e],{shouldDirty:!0}),g(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(M.u,{open:j,title:m?"Add symptom":"Edit symptom",trigger:"function"==typeof s?s({extraProps:c}):s,onOpenChange:e=>{g(e),y(v())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",_&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(I.GG,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(r.z,{disabled:_,onClick:()=>S(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(z.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(O.E,{disabled:_,defaultValue:w,onValueChange:e=>D("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:f.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(O.m,{value:e.value,id:e.value}),(0,i.jsx)(o._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(z.D,{children:"Properties"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{error:!_&&!C,htmlFor:"name",children:"Name *"}),(0,i.jsx)(a.I,{...N("name",{disabled:_,required:!0}),name:"name",error:!_&&!C})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(a.I,{...N("weight",{disabled:_}),name:"label",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(a.I,{...N("expression",{disabled:_}),name:"label"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:"($key = true and $key2 = false) or $key3 = 'HD'"})]})]}),(0,i.jsx)(z.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(T.X,{id:"printable",disabled:_,checked:F,onCheckedChange:()=>D("printable",!F,{shouldDirty:!0})}),(0,i.jsx)(o._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function P(e){let{form:s,disabled:n}=e,[t,a]=(0,l.useState)([]),{confirm:d}=(0,S.t)(),o=s.watch("symptoms"),c=(0,l.useCallback)((e,n)=>{let i=(0,N.q)([...o],e,n);s.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[s,o]),m=(0,l.useCallback)(e=>{let n=o.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");d(()=>{let n=o.filter((s,n)=>!e.includes(n));s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),a([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),danger:!0,positiveLabel:"Delete"})},[s,o,d]),h=(0,l.useCallback)(e=>{let n=o.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");d(()=>{let n=[...o,...o.filter((s,n)=>e.includes(n)).map((e,s)=>({...e,position:o.length+1+s}))];s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),a([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),positiveLabel:"Duplicate"})},[s,o,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.DataTable,{title:"Symptoms",sortable:!n,selectable:!n,onSort:c,selectedIndexes:t,onSelect:a,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E,{form:s,disabled:n,children:!n&&(0,i.jsx)(I.hg,{asChild:!0,children:(0,i.jsxs)(r.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:l}=e,t=o[l];return(0,i.jsxs)(_.h_,{children:[(0,i.jsx)(_.$F,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(D.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(_.AW,{children:[(0,i.jsx)(_.Xi,{asChild:!0,children:(0,i.jsx)(E,{disabled:n,form:s,symptom:{data:t,index:l},children:e=>{let{extraProps:s}=e;return(0,i.jsxs)(I.hg,{...s,className:(0,x.cn)(null==s?void 0:s.className,"w-full"),children:[(0,i.jsx)(w.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:n?"View":"Edit"})]})}})}),(0,i.jsxs)(_.Xi,{onClick:()=>m([l]),className:(0,x.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:n,children:[(0,i.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:o.map(e=>[e.type,e.name,""])}),!n&&(0,i.jsx)(V,{disabled:n,selected:t,onDelete:()=>m(t),onCopy:()=>h(t)})]})}function A(e){let s=(0,t.useRouter)(),n=function(e){let{formData:s,scriptId:n}=e,i=(0,t.useRouter)(),[r,a]=(0,l.useState)(!1),{saveDiagnoses:d}=(0,g.h)(),{alert:o}=(0,v.s)(),{viewOnly:c}=(0,y.b)(),m=(0,l.useMemo)(()=>"/script/".concat(n,"?section=diagnoses"),[n]),x=(0,l.useCallback)(()=>({version:(null==s?void 0:s.version)||1,scriptId:(null==s?void 0:s.scriptId)||n,diagnosisId:(null==s?void 0:s.diagnosisId)||(0,p.Z)(),name:(null==s?void 0:s.name)||"",description:(null==s?void 0:s.description)||"",key:(null==s?void 0:s.key)||"",expression:(null==s?void 0:s.expression)||"",expressionMeaning:(null==s?void 0:s.expressionMeaning)||"",severityOrder:(null==s?void 0:s.severityOrder)||null,symptoms:(null==s?void 0:s.symptoms)||[],text1:(null==s?void 0:s.text1)||"",text2:(null==s?void 0:s.text2)||"",text3:(null==s?void 0:s.text3)||"",image1:(null==s?void 0:s.image1)||null,image2:(null==s?void 0:s.image2)||null,image3:(null==s?void 0:s.image3)||null,preferences:(null==s?void 0:s.preferences)||f.$7}),[s,n]),h=(0,u.cI)({defaultValues:x()}),{formState:{dirtyFields:b},handleSubmit:N}=h,k=(0,l.useMemo)(()=>!!Object.keys(b).length,[b]),D=N(async e=>{try{var s;a(!0);let n={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!n.scriptId)throw Error("Diagnosis is missing script reference!");let l=(await j.Z.post("/api/diagnoses/save",{data:[n],broadcastAction:!0})).data;if(null===(s=l.errors)||void 0===s?void 0:s.length)throw Error(l.errors.join(", "));i.refresh(),o({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>i.push(m)})}catch(e){o({variant:"error",message:"Failed to save draft: "+e.message})}finally{a(!1)}}),w=(0,l.useMemo)(()=>r||c,[r,c]);return{...h,formIsDirty:k,saving:r,scriptPageHref:m,disabled:w,save:D,getDefaultValues:x}}(e),{formIsDirty:N,saving:k,scriptPageHref:D,disabled:w,register:C,watch:F,setValue:I,save:_}=n,S=F("name"),R=F("key"),V=F("image1"),M=F("image2"),O=F("image3"),T=F("preferences"),Z=(0,l.useCallback)(()=>{s.push(D)},[s,D]);return(0,i.jsxs)(i.Fragment,{children:[k&&(0,i.jsx)(m.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"name",error:!w&&!S,children:"Name *"}),(0,i.jsx)(a.I,{...C("name",{disabled:w,required:!0}),name:"name",noRing:!1,error:!w&&!S})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(a.I,{...C("severityOrder",{disabled:w}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(o._,{htmlFor:"key",error:!w&&!R,children:"Key *"}),(0,i.jsx)(a.I,{...C("key",{disabled:w,required:!0}),name:"key",noRing:!1,error:!w&&!R})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(a.I,{...C("description",{disabled:w}),name:"description",noRing:!1}),(0,i.jsx)(h.w,{id:"description",title:"Description",disabled:w,data:T,onSave:e=>I("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(a.I,{...C("expression",{disabled:w}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(o._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(a.I,{...C("expressionMeaning",{disabled:w}),name:"expressionMeaning",noRing:!1})]}),[["text1",V],["text2",M],["text3",O]].map((e,s)=>{let[n,t]=e,r="image".concat(s+1);return(0,i.jsx)(l.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(o._,{htmlFor:"imageTextFields.".concat(s,".text"),children:["Text ",s+1]}),(0,i.jsx)(d.g,{...C(n,{disabled:w}),name:"text".concat(s),noRing:!1,rows:5}),(0,i.jsx)(h.w,{id:n,title:"Text ".concat(s+1),disabled:w,data:T,onSave:e=>I("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(b.M,{disabled:w,image:t,onChange:e=>I(r,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(s))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",w&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(r.z,{variant:"ghost",onClick:()=>Z(),children:"Cancel"}),(0,i.jsx)(r.z,{disabled:w,onClick:()=>_(),children:"Save Draft"})]}),(0,i.jsx)(c.Z,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)(P,{disabled:w,form:n})})]})}}}]);