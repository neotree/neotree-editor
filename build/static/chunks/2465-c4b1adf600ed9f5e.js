"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2465],{53850:function(e,l,t){t.d(l,{d:function(){return I}});var i=t(57437),a=t(2265),s=t(99376),n=t(29501),r=t(83464),d=t(53647),c=t(26110),o=t(19060),u=t(98656),m=t(79976),f=t(62869),h=t(69711),p=t(26815),x=t(9699),y=t(95186),g=t(94508),v=t(71706),b=t(60657);let j=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function I(e){var l,t;let{open:I,overWriteScriptWithId:_,onOpenChange:w,onImportSuccess:k}=e,V=(0,s.useRouter)(),N=(0,s.useParams)();_=_||N.scriptId;let{copyScripts:C}=(0,m.h)(),{alert:S}=(0,u.s)(),[D,E]=(0,a.useState)(!1),{sites:L,loading:F}=(0,v.k)({onLoadSitesError:()=>w(!1)}),R=F||D,{formState:{errors:T},reset:z,watch:P,setValue:M,register:O,handleSubmit:A}=(0,n.cI)({defaultValues:j(_)}),K=P("confirmed"),Z=P("overwriteDataKeys"),B=P("overwriteDrugsLibraryItems"),G=A(async e=>{try{var l;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(_&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");E(!0);let t=(await r.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:_,broadcastAction:!0})).data;if(null===(l=t.errors)||void 0===l?void 0:l.length)throw Error(t.errors.join(", "));V.refresh(),S({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==k||k(),z(j(_)),w(!1)}})}catch(e){S({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{E(!1)}});return(0,i.jsxs)(i.Fragment,{children:[R&&(0,i.jsx)(h.a,{overlay:!0}),(0,i.jsx)(x.u,{open:I,onOpenChange:()=>{w(!1),z(j(_))},title:"Import script",actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(c.GG,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",disabled:R,onClick:()=>w(!1),children:"Cancel"})}),(0,i.jsx)(f.z,{onClick:()=>G(),disabled:R,children:"Import"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(b._,{children:(0,i.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,i.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,i.jsxs)(d.Ph,{name:"siteId",disabled:R,onValueChange:e=>M("siteId",e,{shouldDirty:!0}),children:[(0,i.jsx)(d.i4,{children:(0,i.jsx)(d.ki,{placeholder:"Select site"})}),(0,i.jsx)(d.Bw,{children:(0,i.jsxs)(d.DI,{children:[(0,i.jsx)(d.n5,{children:"Sites"}),L.map(e=>{let{siteId:l,name:t}=e;return(0,i.jsx)(d.Ql,{value:l,children:t},l)})]})})]}),!!(null===(l=T.siteId)||void 0===l?void 0:l.message)&&(0,i.jsx)("div",{className:"text-xs text-danger mt-1",children:T.siteId.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,i.jsx)(y.I,{...O("scriptId",{disabled:R,required:!0}),name:"scriptId"}),!!(null===(t=T.scriptId)||void 0===t?void 0:t.message)&&(0,i.jsx)("div",{className:"text-xs text-danger mt-1",children:T.scriptId.message})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,i.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:R,checked:Z,onCheckedChange:()=>M("overwriteDataKeys",!Z,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,i.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:R,checked:B,onCheckedChange:()=>M("overwriteDrugsLibraryItems",!B,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2",!_&&"hidden"),children:[(0,i.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:R,checked:K,onCheckedChange:()=>M("confirmed",!K,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},38789:function(e,l,t){t.d(l,{f:function(){return D}});var i=t(57437),a=t(69711),s=t(81066),n=t(53647),r=t(97930),d=t(2265),c=t(32489),o=t(83464),u=t(94508),m=t(16850),f=t(95186),h=t(26815),p=t(66070),x=t(62869),y=t(19060),g=t(9699),v=t(8272),b=t(81103),j=t(26110),I=t(98656),_=t(86180),w=t(67132),k=t(60657);function V(e){return RegExp.escape(e)}function N(e){let{scriptsSearchResults:l=[]}=e,t=[];return l.sort((e,l)=>e.position-l.position).forEach(e=>{t.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:"",exclude:!1}))}),e.diagnoses.forEach(l=>{t.push({type:"diagnosis",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.diagnosisId,matches:l.matches.map(e=>({...e,newValue:"",exclude:!1}))})}),e.screens.forEach(l=>{t.push({type:"screen",title:l.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:l.screenId,matches:l.matches.map(e=>({...e,newValue:"",exclude:!1}))})})}),t.map(e=>({...e,matches:e.matches.filter(e=>!["key","id","field_key","field_id","item_id","item_key","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let C=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function S(e){let{searchValue:l="",scriptsSearchResults:t=[]}=e,[s,r]=(0,d.useState)(!1),[S,D]=(0,d.useState)(C[0].value),[E,L]=(0,d.useState)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\"(.*?)\"/,"$1")}(l)),[F,R]=(0,d.useState)([]),[T,z]=(0,d.useState)(!1),[P,M]=(0,d.useState)(""),O=(0,m.N)(P),A=(0,d.useRef)(O),K=(0,d.useRef)(T),{confirm:Z}=(0,_.t)(),{alert:B}=(0,I.s)(),{isAdmin:G,isSuperUser:W,viewOnly:$}=(0,w.b)();(0,d.useEffect)(()=>{(A.current!==O||K.current!==T)&&(A.current=O,K.current=T,R(e=>e.map(e=>({...e,matches:e.matches.map(e=>({...e,newValue:O?e.fieldValue.replace(new RegExp(V(E),T?"g":"gi"),O):"",exclude:!"".concat(e.fieldValue).match(new RegExp(V(E),T?"g":"gi"))}))}))))},[E,O,F,T]);let H=(0,d.useCallback)(()=>{D(C[0].value),L(E),R(N(e)),M(""),A.current="",z(!1)},[e]),X=!F.length||!P,J=(0,d.useCallback)(l=>{A.current="",D(l),R(N(e).filter(e=>{switch(l){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[S,e,T]),Q=(0,d.useCallback)(async()=>{try{r(!0);let e=F.map(e=>({...e,matches:e.matches.filter(e=>!e.exclude)})).filter(e=>e.matches.length),l=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:e.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,l)=>({...e,[l.field]:l.newValue}),{})})),screens:e.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,l)=>{let t=e._fields||[],i=e._items||[];if(void 0===l.fieldIndex)e[l.field]=l.newValue;else if(l.field.includes("field_item_")){let e=t.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=t.length),t[e]={index:l.fieldIndex,data:{...t[e],[l.field.substring(11)]:l.newValue}}}else if(l.field.includes("field_")){let e=t.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=t.length),t[e]={index:l.fieldIndex,data:{...t[e],[l.field.substring(6)]:l.newValue}}}else{let e=i.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=i.length),i[e]={index:l.fieldIndex,data:{...i[e],[l.field.substring(5)]:l.newValue}}}return{...e,_fields:t,_items:i}},{})}})),diagnoses:e.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,l)=>{let t=e._fields||[];if(void 0===l.fieldIndex)e[l.field]=l.newValue;else{let e=t.map(e=>e.index).indexOf(l.fieldIndex);-1===e&&(e=t.length),t[e]={index:l.fieldIndex,data:{...t[e],[l.field]:l.newValue}}}return{...e,_fields:t}},{})}}))})).data;l.errors?B({title:"Error",message:l.errors.join(", "),variant:"error"}):B({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){B({title:"Error",message:e.message,variant:"error"})}finally{r(!1)}},[F]);return $||!(W||G)?null:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(g.u,{onOpenChange:()=>{H()},title:(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(h._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),(0,i.jsx)(f.I,{disabled:!0,name:"searchValue",value:E,onChange:e=>L(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(h._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),(0,i.jsx)(f.I,{name:"replaceWith",value:P,onChange:e=>M(e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(h._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),(0,i.jsx)("div",{className:"w-[120px]",children:(0,i.jsxs)(n.Ph,{value:S,onValueChange:J,children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{placeholder:"All matches"})}),(0,i.jsx)(n.Bw,{children:C.map(e=>(0,i.jsx)(n.Ql,{value:e.value,children:e.label},e.value))})]})})]}),(0,i.jsxs)("div",{className:"flex gap-x-2 items-center",children:[(0,i.jsx)(y.X,{id:"caseSensitive",name:"caseSensitive",checked:T,onCheckedChange:()=>{z(!T)}}),(0,i.jsx)(h._,{htmlFor:"caseSensitive",children:"Case sensitive"})]})]})]}),trigger:(0,i.jsx)(j.hg,{asChild:!0,children:(0,i.jsx)(x.z,{children:"Replace"})}),actions:(0,i.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[(0,i.jsx)(j.GG,{asChild:!0,children:(0,i.jsx)(x.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(x.z,{disabled:X,onClick:()=>Z(Q,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-6",children:[(0,i.jsx)(k._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!F.length&&(0,i.jsx)("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),F.map((e,l)=>e.matches.filter(e=>!e.exclude).length?(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[s&&(0,i.jsx)(a.a,{overlay:!0,transparent:!0}),(0,i.jsxs)("div",{className:"text-sm",children:[e.parent?(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,v.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,v.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((t,a)=>{let s=e.id+"_match".concat(a);return t.exclude?null:(0,i.jsx)(p.Zb,{children:(0,i.jsxs)(p.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,i.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[t.field,"number"==typeof t.fieldIndex&&(0,i.jsxs)(i.Fragment,{children:["\xa0(",(0,i.jsx)("b",{children:"position"})," = ",t.fieldIndex+1,")"]})]})}),(0,i.jsx)("code",{className:(0,u.cn)("block",t.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:t.fieldValue.replace(new RegExp("(".concat(V(E),")"),T?"g":"gi"),"<mark>$1</mark>")}}),t.newValue&&(0,i.jsx)("code",{className:(0,u.cn)("block",P&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:t.newValue.replaceAll(O,"<mark>".concat(O,"</mark>"))}})]}),(0,i.jsx)("div",{children:(0,i.jsx)(b.pn,{delayDuration:0,children:(0,i.jsxs)(b.u,{children:[(0,i.jsx)(b.aJ,{children:(0,i.jsx)(x.z,{variant:"ghost",onClick:()=>R(e=>e.map((e,t)=>t!==l?e:{...e,matches:e.matches.filter((e,l)=>a!==l)}).filter(e=>e.matches.length)),children:(0,i.jsx)(c.Z,{className:"size-4"})})}),(0,i.jsx)(b._v,{children:"Remove"})]})})})]})},s)})]},e.id):null)]})})})}function D(e){var l;let{search:t,setSearch:d,onSearch:c}=e;return(0,i.jsxs)(i.Fragment,{children:[t.searching&&(0,i.jsx)(a.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(s.M,{placeholder:"Search",onSearch:c})}),!!t.value&&(0,i.jsx)("div",{className:"w-[120px]",children:(0,i.jsxs)(n.Ph,{value:t.filter,onValueChange:e=>d(l=>({...l,filter:e,results:(0,r._n)({results:l.unfilteredResults,filter:e,searchValue:l.value})})),children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{placeholder:"All matches"})}),(0,i.jsx)(n.Bw,{children:r.Hc.map(e=>(0,i.jsx)(n.Ql,{value:e.value,children:e.label},e.value))})]})}),!!(null===(l=t.results)||void 0===l?void 0:l.length)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(S,{searchValue:t.value,scriptsSearchResults:t.results})})]})]})}},81066:function(e,l,t){t.d(l,{M:function(){return n}});var i=t(57437),a=t(2265),s=t(94508);let n=(0,a.forwardRef)((e,l)=>{let{searchButton:t,hideSearchButton:n,onSearch:r,...d}=e,[c,o]=(0,a.useState)("");return(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==r||r(c)},children:(0,i.jsxs)("div",{className:(0,s.cn)("flex w-full"),children:[(0,i.jsx)("div",{className:(0,s.cn)("relative w-full"),children:(0,i.jsx)("input",{ref:l,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var l;let t=e.target.value;o(t),null===(l=d.onChange)||void 0===l||l.call(d,e),t||null==r||r(t)},className:(0,s.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!n&&(0,i.jsx)("button",{type:"submit",className:(0,s.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==t?void 0:t.className),...t,children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});n.displayName="SearchInput"},81103:function(e,l,t){t.d(l,{_v:function(){return o},aJ:function(){return c},pn:function(){return r},u:function(){return d}});var i=t(57437),a=t(2265),s=t(91668),n=t(94508);let r=s.zt,d=s.fC,c=s.xz,o=a.forwardRef((e,l)=>{let{className:t,sideOffset:a=4,...r}=e;return(0,i.jsx)(s.VY,{ref:l,sideOffset:a,className:(0,n.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})});o.displayName=s.VY.displayName},71706:function(e,l,t){t.d(l,{k:function(){return r}});var i=t(2265),a=t(83464),s=t(67132),n=t(98656);function r(e){let{loadOnMount:l=!0,onLoadSitesError:t}={...e},[r,d]=(0,i.useState)(!1),{alert:c}=(0,n.s)(),{getSites:o}=(0,s.b)(),[u,m]=(0,i.useState)([]),f=(0,i.useCallback)(async()=>{try{var e;d(!0);let l=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=l.errors)||void 0===e?void 0:e.length)throw Error(l.errors.join(", "));m(l.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==t?void 0:t()})}finally{d(!1)}},[o,c,t]);return(0,i.useEffect)(()=>{l&&!u.length&&f()},[u,l,f]),{loading:r,sites:u,loadSites:f}}},97930:function(e,l,t){t.d(l,{GB:function(){return a},Hc:function(){return s},_n:function(){return r}});var i=t(16548);function a(e){let{searchValue:l,scripts:t,screens:a,diagnoses:s}=e,{normalizedValue:n,isExactMatch:r}=(0,i.l)(l);if(!n)return[];let d=(0,i.y)(n),c=new RegExp(r?"^".concat(d,"$"):d,r?"":"i"),o="manual entry enter value manually custom value other specify",u={};return t.forEach(e=>{let l=[];"".concat(e.title||"").match(c)&&l.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").match(c)&&l.push({field:"printTitle",fieldValue:e.printTitle}),l.length&&(u[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:l})}),a.forEach(e=>{let l=[];"".concat(e.title||"").match(c)&&l.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").match(c)&&l.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").match(c)&&l.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").match(c)&&l.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").match(c)&&l.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").match(c)&&l.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").match(c)&&l.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").match(c)&&l.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,t)=>{"".concat(e.key||"").match(c)&&l.push({field:"field_key",fieldIndex:t,fieldValue:e.key}),"".concat(e.label||"").match(c)&&l.push({field:"field_label",fieldIndex:t,fieldValue:e.label}),"".concat(e.condition||"").match(c)&&l.push({field:"field_condition",fieldIndex:t,fieldValue:e.condition}),(e.items||[]).map((e,i)=>{"".concat(e.value||"").match(c)&&l.push({field:"field_item_key",fieldIndex:t,fieldItemIndex:i,fieldValue:e.value}),"".concat(e.label||"").match(c)&&l.push({field:"field_item_label",fieldIndex:t,fieldItemIndex:i,fieldValue:e.label}),e.enterValueManually&&o.match(c)&&l.push({field:"field_item_manual_entry",fieldIndex:t,fieldItemIndex:i,fieldValue:"Enter value manually"}),"".concat(e.enterValueManuallyLabel||"").match(c)&&l.push({field:"field_item_manual_label",fieldIndex:t,fieldItemIndex:i,fieldValue:"".concat(e.enterValueManuallyLabel||"")})})}),(e.items||[]).map((e,t)=>{"".concat(e.id||"").match(c)&&l.push({field:"item_id",fieldIndex:t,fieldValue:e.id}),"".concat(e.key||"").match(c)&&l.push({field:"item_key",fieldIndex:t,fieldValue:e.key}),"".concat(e.label||"").match(c)&&l.push({field:"item_label",fieldIndex:t,fieldValue:e.label}),e.enterValueManually&&o.match(c)&&l.push({field:"item_manual_entry",fieldIndex:t,fieldValue:"Enter value manually"}),"".concat(e.enterValueManuallyLabel||"").match(c)&&l.push({field:"item_manual_label",fieldIndex:t,fieldValue:"".concat(e.enterValueManuallyLabel||"")})}),(e.drugs||[]).map((e,t)=>{"".concat(e.key||"").match(c)&&l.push({field:"drug",fieldIndex:t,fieldValue:e.key})}),(e.fluids||[]).map((e,t)=>{"".concat(e.key||"").match(c)&&l.push({field:"fluid",fieldIndex:t,fieldValue:e.key})}),(e.feeds||[]).map((e,t)=>{"".concat(e.key||"").match(c)&&l.push({field:"feed",fieldIndex:t,fieldValue:e.key})}),l.length&&(u[e.scriptId]=u[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},u[e.scriptId].title=u[e.scriptId].title||e.scriptTitle,u[e.scriptId].screens.push({title:e.title,matches:l,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),s.forEach(e=>{let l=[];"".concat(e.name||"").match(c)&&l.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").match(c)&&l.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").match(c)&&l.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,t)=>{"".concat(e.key||"").match(c)&&l.push({field:"diagnosis_symptom_key",fieldIndex:t,fieldValue:e.key}),"".concat(e.name||"").match(c)&&l.push({field:"diagnosis_symptom_name",fieldIndex:t,fieldValue:e.name}),"".concat(e.expression||"").match(c)&&l.push({field:"diagnosis_symptom_expression",fieldIndex:t,fieldValue:e.expression})}),l.length&&(u[e.scriptId]=u[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},u[e.scriptId].title=u[e.scriptId].title||e.scriptTitle,u[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:l,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(u)}let s=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"},{value:"manual_entry",label:"Manual entry only"}],n={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition",field_item_manual_entry:"manual_entry",item_manual_entry:"manual_entry",field_item_manual_label:"manual_entry",item_manual_label:"manual_entry"};function r(e){let{searchValue:l,filter:t,results:i}=e;if("all"===t)return i;let a=e=>n[e.field]===t;return i.map(e=>t?{...e,matches:e.matches.filter(e=>a(e)),screens:e.screens.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},16548:function(e,l,t){t.d(l,{l:function(){return n},y:function(){return s}});let i=['"',"'","“","‘"],a=['"',"'","”","’"];function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){let l="".concat(null!=e?e:"").trim();if(!l)return{normalizedValue:"",isExactMatch:!1};let t=i.includes(l[0]),s=a.includes(l[l.length-1]),n=l.length>1&&t&&s,r=n?l.slice(1,-1):l;return{normalizedValue:n?r.trim():r.trim().toLowerCase(),isExactMatch:n}}}}]);