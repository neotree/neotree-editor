(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3495],{53495:function(e,l,i){Promise.resolve().then(i.bind(i,8134)),Promise.resolve().then(i.bind(i,95229)),Promise.resolve().then(i.bind(i,25704)),Promise.resolve().then(i.t.bind(i,231,23))},8134:function(e,l,i){"use strict";i.d(l,{ScreenForm:function(){return ek}});var s=i(57437),n=i(2265),t=i(16463),a=i(30690),r=i(39343),d=i(38472),o=i(37440),c=i(93146);let u=e=>e.reduce((l,i,s)=>(l+="".concat(i.key,",").concat(i.value),s<e.length-1&&(l+="\n"),l),""),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[];return e.split("\n").forEach(e=>{let[l,s]=e.split(",");i.push({key:l,value:s})}),i.map(e=>({...l.filter(l=>l.key===e.key)[0],...e}))};function x(e){let l=[],i=e.length?(e||"").split("\n").map(e=>{let l=e.split(",");return{value:l[0],label:l[1]}}):[],s=i.map(e=>e.value),n=i.map(e=>e.label),t=i.filter(e=>!e.value||!e.label),a=s.filter((e,l)=>s.indexOf(e)!==l);return(n.filter((e,l)=>n.indexOf(e)!==l).length||a.length)&&l.push("Dropdown values contain duplicate data"),t.length&&l.push("Incorrect dropdown values format"),l}function h(e){let{value:l,onChange:i,...t}=e,[a,r]=(0,n.useState)(u(l)),d=(0,n.useMemo)(()=>x(a),[a]),h=(0,n.useCallback)(e=>{r(e),x(e).length||i(m(e,l),e)},[l,i]);return(0,n.useEffect)(()=>{let e=u(l);r(l=>JSON.stringify(l)!==JSON.stringify(e)?e:l)},[l]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(c.g,{value:a,rows:5,noRing:!1,className:(0,o.cn)(t.className,d.length?"border-danger ring-danger focus-visible:ring-danger":""),onChange:e=>h(e.target.value),...t})})}var p=i(80852),y=i(46294),v=i(19573),g=i(85070),f=i(50495),j=i(83102),b=i(67135),N=i(74421),D=i(86466),w=i(39661),k=i(83146),I=i(76905),C=i(64344);let T={zw_edliz_summary_table:[{label:"Confirmed sepsis or chorioamnionitis in mother",type:"Major criteria",subType:"Antenatal",id:"MAJC1"},{label:"Confirmed or suspected sepsis in twin",type:"Major criteria",subType:"Antenatal",id:"MAJC2"},{label:"Seizures",type:"Major criteria",subType:"Antenatal",id:"MAJC3"},{label:"Severe Respiratory Distress in a term infant",type:"Major criteria",subType:"Antenatal",id:"MAJC4"},{label:"Signs of shock",type:"Major criteria",subType:"Natal",id:"MAJC5"},{label:"ROM >18h",type:"Minor criteria",subType:"Antenatal",id:"MINC1"},{label:"Spontaneous Preterm Birth",type:"Minor criteria",subType:"Antenatal",id:"MINC2"},{label:"GBS sepsis in previous baby or documented GBS carriage in this pregnancy (urine or vaginal swab)",type:"Minor criteria",subType:"Antenatal",id:"MINC3"},{label:"Born Before Arrival",type:"Minor criteria",subType:"Natal",id:"MINC4"},{label:"Meconium Stained Liquor",type:"Minor criteria",subType:"Natal",id:"MINC5"},{label:"Respiratory distress that is not obviously related to:\n1. environmental hypothermia \n2. “delayed transition to extra-uterine life” i.e. mild to moderate respiratory distress apparent soon after birth that is improving with time. ",type:"Minor criteria",subType:"Postnatal",id:"MINC6"},{label:"Hypoxia",type:"Minor criteria",subType:"Postnatal",id:"MINC7"},{label:"Apnoea",type:"Minor criteria",subType:"Postnatal",id:"MINC8"},{label:"Hypoglycaemia/Hyperglycaemia not otherwise explained",type:"Minor criteria",subType:"Postnatal",id:"MINC9"},{label:"Temperature instability not explained by environmental factors",type:"Minor criteria",subType:"Postnatal",id:"MINC10"},{label:"Acidosis not obviously related to HIE",type:"Minor criteria",subType:"Postnatal",id:"MINC11"},{label:"Unexplained bleeding or thrombocytopenia",type:"Minor criteria",subType:"Postnatal",id:"MINC12"},{label:"Mild encephalopathy/Altered responsiveness",type:"Minor criteria",subType:"Postnatal",id:"MINC13"},{label:"Altered tone not otherwise explained",type:"Minor criteria",subType:"Postnatal",id:"MINC14"},{label:"Feed intolerance/feeding difficulty",type:"Minor criteria",subType:"Postnatal",id:"MINC15"},{label:"Abnormal heart rate (<90 or >160)",type:"Minor criteria",subType:"Postnatal",id:"MINC16"},{label:"Jaundice in first 24h",type:"Minor criteria",subType:"Postnatal",id:"MINC17"}],mwi_edliz_summary_table:[{label:"Fever >38 in mother",type:"Antenatal risk factors",subType:"",id:"ARF1"},{label:"Rupture of membranes >18h",type:"Antenatal risk factors",subType:"",id:"ARF2"},{label:"Offensive Liquor",type:"Antenatal risk factors",subType:"",id:"ARF3"},{label:"Suspected or confirmed sepsis in a twin”",type:"Antenatal risk factors",subType:"",id:"ARF4"},{label:"Temperature <35.5 or >37.5",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS1"},{label:"Bulging Fontanelle",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS2"},{label:"chest indrawing",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS6"},{label:"Umbilical redness extending to the periumbilical skin or umbilicus draining pus",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS8"},{label:"reduced movement of limbs",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS9"},{label:"Many skin pustules/big boil (abscess)",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS10"},{label:"Painful joint/swelling, reduced movement and irritability if these parts are handled",type:"Symptoms and Signs of Sepsis",subType:"",id:"SSS11"},{label:"Drowsiness",type:"Signs/symptoms of meningitis",subType:"",id:"SM1"},{label:"Lethargy/unconscious",type:"Signs/symptoms of meningitis",subType:"",id:"SM2"},{label:"Persistent irritability",type:"Signs/symptoms of meningitis",subType:"",id:"SM3"},{label:"High pitched cry",type:"Signs/symptoms of meningitis",subType:"",id:"SM4"},{label:"Convulsions",type:"Signs/symptoms of meningitis",subType:"",id:"SM5"},{label:"Apnoeic episode",type:"Signs/symptoms of meningitis",subType:"",id:"SM6"},{label:"Cold hands and feet",type:"Shock (Danger signs)",subType:"",id:"SDS1"},{label:"Capillary refill time > 3 seconds",type:"Shock (Danger signs)",subType:"",id:"SDS2"},{label:"Fast and weak pulse",type:"Shock (Danger signs)",subType:"",id:"SDS3"}]},{types:F,subTypes:S}=Object.keys(T).reduce((e,l)=>(T[l].forEach(l=>{l.type&&(e.types[l.type]=l.type),l.subType&&(e.subTypes[l.subType]=l.subType)}),e),{types:{},subTypes:{}});Object.keys(F).map(e=>({value:e,label:F[e]})),Object.keys(S).map(e=>({value:e,label:S[e]}));var _=i(87861),M=i(84760),V=i(20920),A=i(15701),K=i(21453),R=i(53699),L=i(17647),P=i(71239),q=i(42314),z=i(72341),E=i(20021),O=i(12599),G=i(92513),Z=i(45188),W=i(6649),U=i(90399),Y=i(73741),B=i(44380),Q=i(46910),$=i(76230),X=i(17501);function H(e){let{disabled:l,selected:i,onDelete:n,onCopy:t}=e;return(0,s.jsx)(s.Fragment,{children:!!i.length&&(0,s.jsx)(X.h,{children:(0,s.jsxs)(f.z,{variant:"destructive",className:"h-auto w-auto",disabled:l,onClick:()=>n(),children:[(0,s.jsx)(U.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:i.length>1?"Delete ".concat(i.length," fields"):"Delete field"})]})})})}var J=i(23920),ee=i(90837),el=i(74709),ei=i(34303),es=i(78591),en=i(18934),et=i(95317);function ea(e){let{items:l=[],disabled:i,fieldType:t,dataKey:a,onChange:r,scriptId:d,screenId:o,fieldKey:c,screenTitle:u}=e,{confirm:m}=(0,$.t)(),[x,h]=(0,n.useState)(-1),[p,y]=(0,n.useState)(!1),v=p||x>=0;return(0,s.jsxs)(s.Fragment,{children:[v&&(0,s.jsx)(er,{fieldDataKey:a,fieldType:t,item:l[x]||null,onClose:()=>{h(-1),y(!1)},onChange:e=>{p?r([...l,e]):r(l.map((l,i)=>i!==x?l:{...l,...e}))},scriptId:d,screenId:o,fieldKey:c,itemIndex:x,isNew:p,screenTitle:u}),(0,s.jsx)("div",{children:(0,s.jsx)(B.DataTable,{sortable:!0,title:"Options",data:l.map(e=>[e.value,e.label,e.exclusive?"✓":"✕",e.enterValueManually?"✓":"✕",""]),onSort:(e,i)=>{r((0,O.q)([...l],e,i))},headerActions:i?null:(0,s.jsxs)(f.z,{variant:"ghost",onClick:()=>y(!0),children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-2"})," Add"]}),columns:[{name:"Key"},{name:"Label"},{name:"Exclusive",align:"center",cellClassName:"multi_select"!==t?"hidden":""},{name:"Enter Value Manually",align:"center"},{name:"",align:"right",cellRenderer(e){let{rowIndex:n}=e;return!l[n]||i?null:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsxs)(Q.Xi,{onClick:()=>setTimeout(()=>h(n),0),children:[(0,s.jsx)(W.Z,{className:"h-4 w-4 mr-2"})," Edit"]}),(0,s.jsxs)(Q.Xi,{className:"text-destructive",onClick:()=>setTimeout(()=>{m(()=>r(l.filter((e,l)=>l!==n)),{title:"Delete option",message:"Are you sure?"})},0),children:[(0,s.jsx)(U.Z,{className:"h-4 w-4 mr-2"})," Delete"]})]})]})})}}]})})]})}function er(e){let{item:l,fieldType:i,fieldDataKey:n,onClose:t,onChange:a,scriptId:d,screenId:o,fieldKey:c,itemIndex:u,isNew:m,screenTitle:x}=e,{dataKeys:h,extractDataKeys:y}=(0,J.M)(),{authenticatedUser:v}=(0,L.b)(),{control:g,register:D,handleSubmit:w,setValue:k}=(0,r.cI)({defaultValues:{...l,enterValueManually:(null==l?void 0:l.enterValueManually)||!1,exclusive:(null==l?void 0:l.exclusive)||!1,itemId:(null==l?void 0:l.itemId)||(0,V.Z)(),label:(null==l?void 0:l.label)||"",label2:(null==l?void 0:l.label2)||"",value:(null==l?void 0:l.value)||"",keyId:null==l?void 0:l.keyId}}),I=w(async e=>{if(d&&o&&c){let i=m?"fields.".concat(c,".items[new]"):"fields.".concat(c,".items[").concat(u,"]");await z.pb.addChange({entityType:"screen",entityId:o,entityTitle:x||"Screen",action:m?"create":"update",fieldPath:i,fieldName:"Field Item: ".concat(e.label),oldValue:l,newValue:e,userId:null==v?void 0:v.userId,userName:null==v?void 0:v.displayName})}a(e)});return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(et.yo,{open:!0,modal:!0,onOpenChange:t,children:(0,s.jsxs)(et.ue,{hideCloseButton:!0,side:"right",className:"p-0 m-0 flex flex-col",children:[(0,s.jsxs)(et.Tu,{className:"flex flex-row items-center py-2 px-4 border-b border-b-border text-left sm:text-left",children:[(0,s.jsxs)(et.bC,{children:[l?"Edit":"New"," option"]}),(0,s.jsx)(et.Ei,{className:"hidden"})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col py-2 px-0 gap-y-4 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)(b._,{htmlFor:"value",children:"Key *"}),(0,s.jsx)(r.Qr,{control:g,name:"value",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(p.L,{value:"".concat(l||""),disabled:!1,onChange:e=>{let[l]=e;i(l.name),k("keyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0}),k("label",l.label||"",{shouldDirty:!0})},filterDataKeys:e=>{let l=(null==n?void 0:n.options)||[];return!n||l.includes(e.uniqueKey)}})}})]}),(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)(b._,{htmlFor:"label",children:"Label *"}),(0,s.jsx)(j.I,{disabled:!1,...D("label",{required:!0,disabled:!1})})]}),"multi_select"===i&&(0,s.jsx)(r.Qr,{control:g,name:"exclusive",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsxs)("div",{className:"px-4 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"exclusive",checked:l,onCheckedChange:()=>i(!l)}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"exclusive",children:"Disable other items if selected"})]})}}),(0,s.jsx)(r.Qr,{control:g,name:"enterValueManually",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsxs)("div",{className:"px-4 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"enterValueManually",checked:l,onCheckedChange:()=>i(!l)}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"enterValueManually",children:"Enter value manually if selected"})]})}})]}),(0,s.jsxs)("div",{className:"border-t border-t-border px-4 py-2 flex gap-x-2 items-center",children:[(0,s.jsx)("i",{className:"text-sm text-destructive",children:"* Required"}),(0,s.jsx)("div",{className:"ml-auto"}),(0,s.jsx)(et.sw,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",onClick:()=>t(),children:"Cancel"})}),(0,s.jsx)(et.sw,{asChild:!0,children:(0,s.jsx)(f.z,{onClick:()=>I(),children:"Save"})})]})]})})})}function ed(e){let{open:l,field:i,form:t,scriptId:a,disabled:u,onClose:m}=e,{extractDataKeys:x}=(0,J.M)(),{data:h,index:v}={...i},[w,C]=(0,n.useState)(!!h),{getDefaultValues:T}=(0,en.U)(h?{...h}:void 0),F=t.watch("listStyle"),S=t.getValues("keyId"),_=t.getValues("refIdDataKey"),V=(0,n.useMemo)(()=>{let e=S||_,[l]=e?x([e]):[null];return l},[S,_,x]),{control:A,reset:R,register:L,getValues:P,watch:q,setValue:z,handleSubmit:E}=(0,r.cI)({defaultValues:T()}),[O,G]=(0,n.useState)(""),Z=q("type"),W=q("format"),U=q("key"),Y=q("keyId"),B=q("label"),Q=q("optional"),$=q("printable"),X=q("confidential"),H=q("maxDate"),et=q("minDate"),er=q("maxTime"),ed=q("minTime"),eo=q("prePopulate"),ec=q("defaultValue"),eu=q("values");q("items");let em=q("valuesOptions"),ex=q("editable"),eh=t.watch("screenId"),ep=t.watch("title")||t.watch("sectionTitle")||t.watch("label")||t.watch("previewTitle")||t.watch("collectionLabel")||"Screen";(0,n.useMemo)(()=>(0,es.s)(eu),[eu]);let ey=(0,n.useMemo)(()=>"date"===Z||"datetime"===Z,[Z]),ev=(0,n.useMemo)(()=>"time"===Z,[Z]),eg=(0,n.useMemo)(()=>"text"===Z,[Z]),ef=(0,n.useMemo)(()=>"period"===Z,[Z]),ej=(0,n.useMemo)(()=>"number"===Z,[Z]),eb=(0,n.useMemo)(()=>"dropdown"===Z,[Z]),eN=(0,n.useMemo)(()=>"multi_select"===Z,[Z]),eD=(0,n.useCallback)(async e=>{if(e)try{var l;let i=await d.Z.get("/api/aliases/lean?data="+JSON.stringify({script:a,name:e}));G((null==i?void 0:null===(l=i.data)||void 0===l?void 0:l.alias)||"")}catch(e){G("")}},[]);(0,n.useEffect)(()=>{eD(U)},[eD,U]);let ew=(0,n.useMemo)(()=>!!u,[u]),ek=E(async e=>{if(t.changeTracker){let l=t.getValues("fields"),i=!(0,K.x)(v)&&h?l.map((l,i)=>({...l,...i===v?e:null})):[...l,e];await t.changeTracker.trackChanges({...t.getValues(),fields:i},'Field "'.concat(e.label,'" ').concat(h?"updated":"added"))}!(0,K.x)(v)&&h?t.setValue("fields",t.getValues("fields").map((l,i)=>({...l,...i===v?e:null}))):t.setValue("fields",[...t.getValues("fields"),e],{shouldDirty:!0}),m()});(0,n.useMemo)(()=>(eu||"").split("\n").map(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim()}).map(e=>{let l=e.split(",");return{value:l[0],label:l[1]}}).filter(e=>e.value&&e.label),[eu]);let eI=(0,n.useMemo)(()=>{let[e]=Y?x([Y]):[null];return e},[Y,x]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(el.u,{open:l,onOpenChange:e=>{e||m(),R(T()),C(!!h)},title:h?"New field":"Edit field",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:(0,o.cn)("text-danger text-xs",ew&&"hidden"),children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(ee.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(f.z,{disabled:ew||!Z,onClick:()=>{w?(z("valuesOptions",em.filter(e=>e.optionLabel&&e.key),{shouldDirty:!0}),ek()):(C(!0),R({...T(),type:Z}))},children:w?"Save":"Continue"})]}),children:w?(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Field type"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"type",children:"Type *"}),(0,s.jsxs)(y.Ph,{value:Z,required:!0,name:"type",disabled:!0,onValueChange:e=>{z("type",e,{shouldDirty:!0})},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select type"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.n5,{children:"User role"}),I.Uv.map(e=>(0,s.jsx)(y.Ql,{value:e.name,children:e.label},e.name))]})})]})]})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Flow control"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"condition",children:"Conditional expression"}),(0,s.jsx)(c.g,{...L("condition",{disabled:ew}),name:"condition",noRing:!1,rows:5}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",k._S]})]})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Properties"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{error:!ew&&!U,htmlFor:"key",children:"Key *"}),(0,s.jsx)(p.L,{modal:!0,value:U,disabled:ew,type:Z,filterDataKeys:e=>{let l=(null==V?void 0:V.options)||[];return!V||l.includes(e.uniqueKey)},onChange:e=>{let[l]=e;z("key",null==l?void 0:l.name,{shouldDirty:!0}),z("keyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0}),z("label",null==l?void 0:l.label,{shouldDirty:!0})}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(b._,{error:!ew&&!B,htmlFor:"label",children:"Label *"}),(0,s.jsx)(j.I,{...L("label",{disabled:ew}),name:"label",error:!ew&&!B})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"refKey",children:"Reference Key"}),(0,s.jsx)(r.Qr,{control:A,name:"refKey",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(p.L,{value:"".concat(l||""),disabled:!1,onChange:e=>{let[l]=e;i(l.name),z("refKeyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0})}})}}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Link this field to ",(0,s.jsx)("b",{children:"another field with this key"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"confidential",disabled:ew,checked:X,onCheckedChange:e=>z("confidential",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"confidential",children:"Confidential"})]}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"optional",disabled:ew,checked:Q,onCheckedChange:e=>z("optional",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"optional",children:"Optional"})]})]}),(eb||eN)&&(0,s.jsxs)(s.Fragment,{children:[!!eN&&(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"listStyle",children:"List style"}),(0,s.jsxs)(y.Ph,{value:F,name:"listStyle",onValueChange:e=>{t.setValue("listStyle",e||"none")},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.Ql,{value:"none",children:"None"}),(0,s.jsx)(y.Ql,{value:"bullet",children:"Bullet"}),(0,s.jsx)(y.Ql,{value:"number",children:"Number"})]})})]})]}),(0,s.jsx)(r.Qr,{control:A,name:"items",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(ea,{disabled:ew,items:l,fieldType:Z,onChange:i,dataKey:eI,scriptId:a,screenId:eh,fieldKey:U,screenTitle:ep})}})]}),(ef||ej)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"calculation",children:"Reference expression"}),(0,s.jsx)(j.I,{...L("calculation",{disabled:ew}),name:"calculation",noRing:!1}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Example: $key or SUM($key1,$key2...) or DIVIDE($key1,$key2...) or MULTIPLY($key1,$key2...) or SUBTRACT($key1,$key2...)"})]})}),ef&&(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"periodFormart",children:"Format"}),(0,s.jsxs)(y.Ph,{value:W,required:!0,name:"format",onValueChange:e=>{z("format",e||"days_hours",{shouldDirty:!0})},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select type"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.n5,{children:"Formats"}),I.VO.map(e=>(0,s.jsx)(y.Ql,{value:e.value,children:e.label},e.value))]})})]})]}),ej&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{className:"sm:flex-1",children:[(0,s.jsx)(b._,{htmlFor:"minValue",children:"Min value"}),(0,s.jsx)(j.I,{...L("minValue",{disabled:ew}),name:"minValue",noRing:!1})]}),(0,s.jsxs)("div",{className:"sm:flex-1",children:[(0,s.jsx)(b._,{htmlFor:"maxValue",children:"Max value"}),(0,s.jsx)(j.I,{...L("maxValue",{disabled:ew}),name:"maxValue",noRing:!1})]}),(0,s.jsxs)("div",{className:"sm:flex-1",children:[(0,s.jsx)(b._,{htmlFor:"format",children:"Format"}),(0,s.jsx)(j.I,{...L("format",{disabled:ew}),name:"format",noRing:!1})]})]}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Format: Add as many # as the number of decimal digits or leave empty"})]})}),ey&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{children:"Min date"}),(0,s.jsx)(ei.x,{disabled:ew||"date_now"===et,type:"datetime",value:et,onChange:e=>{var l;let{date:i}=e,s=(null==i?void 0:null===(l=i.toISOString)||void 0===l?void 0:l.call(i))||"";"date_now"===et&&(s=et),z("minDate",s,{shouldDirty:!0})}})]}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"minDateCurrent",disabled:ew,checked:"date_now"===et,onCheckedChange:e=>z("minDate",e?"date_now":"",{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"minDateCurrent",children:"Current date"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"minDateKey",children:"Min Date Key e.g $DateOfBirth"}),(0,s.jsx)(r.Qr,{control:A,name:"minDateKey",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(p.L,{value:"".concat(l||""),disabled:!1,onChange:e=>{let[l]=e;i(l.name),z("minDateKeyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0})}})}})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{children:"Max date"}),(0,s.jsx)(ei.x,{disabled:ew||"date_now"===H,type:"datetime",value:H,onChange:e=>{var l;let{date:i}=e,s=(null==i?void 0:null===(l=i.toISOString)||void 0===l?void 0:l.call(i))||"";"date_now"===H&&(s=H),z("maxDate",s,{shouldDirty:!0})}})]}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"maxDateCurrent",disabled:ew,checked:"date_now"===H,onCheckedChange:e=>z("maxDate",e?"date_now":"",{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"maxDateCurrent",children:"Current date"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"maxDateKey",children:"Max Date Key e.g $DateOfBirth"}),(0,s.jsx)(r.Qr,{control:A,name:"maxDateKey",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(p.L,{value:"".concat(l||""),disabled:!1,onChange:e=>{let[l]=e;i(l.name),z("maxDateKeyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0})}})}})]})]})]}),(0,s.jsx)(M.D,{children:"Default"}),(0,s.jsx)(g.E,{disabled:ew,defaultValue:ec||"empty",onValueChange:e=>z("defaultValue",("empty"===e?"":e)||"",{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:[{label:"Empty",name:"empty"},{label:"Current time",name:"date_now"},{label:"Today at noon",name:"date_noon"},{label:"Today at midnight",name:"date_midnight"}].map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(g.m,{value:e.name,id:e.name}),(0,s.jsx)(b._,{htmlFor:e.name,children:e.label})]},e.name))})]}),ev&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{children:"Min time"}),"time_now"===ed?(0,s.jsx)(j.I,{disabled:!0,type:"time"}):(0,s.jsx)(ei.x,{disabled:ew,type:"time",value:ed,onChange:e=>{let{time:l}=e;return z("minTime",l||"",{shouldDirty:!0})}})]}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"minTime",disabled:ew,checked:"time_now"===ed,onCheckedChange:e=>z("minTime",e?"time_now":"",{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"minTime",children:"Current time"})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{children:"Max time"}),"time_now"===er?(0,s.jsx)(j.I,{disabled:!0,type:"time"}):(0,s.jsx)(ei.x,{disabled:ew,type:"time",value:er,onChange:e=>{let{time:l}=e;return z("maxTime",l||"",{shouldDirty:!0})}})]}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"maxTime",disabled:ew,checked:"time_now"===er,onCheckedChange:e=>z("maxTime",e?"time_now":"",{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"maxTime",children:"Current time"})]})]})]})})]}),eg&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Default"}),(0,s.jsx)(g.E,{disabled:ew,defaultValue:ec||"empty",onValueChange:e=>z("defaultValue",("empty"===e?"":e)||"",{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:[{label:"Empty",name:"empty"},{label:"Generated ID",name:"uid"}].map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(g.m,{value:e.name,id:e.name}),(0,s.jsx)(b._,{htmlFor:e.name,children:e.label})]},e.name))})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Neotree ID Search"}),(0,s.jsx)("div",{className:"flex flex-col gap-y-4",children:I.d4.map(e=>{let l="prePopulate_".concat(e.value),i=I.d4.filter(e=>e.value!==I.d4[0].value).map(e=>e.value),n=eo.includes(e.value)||eo.length===i.length;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:l,checked:n,disabled:ew,onCheckedChange:l=>{let s=[];l?(s=[...eo,e.value],e.value===I.d4[0].value&&(s=i)):(s=eo.filter(l=>l!==e.value),e.value===I.d4[0].value&&(s=[])),z("prePopulate",s,{shouldDirty:!0})}}),(0,s.jsx)(b._,{htmlFor:l,children:e.label})]},l)})}),(null==eo?void 0:eo.length)>0&&(0,s.jsxs)("div",{className:"max-w-64",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"alias",children:"ALIAS"}),(0,s.jsx)(j.I,{value:O,disabled:!0,name:"alias",placeholder:"",noRing:!1})]})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Print"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"printable",disabled:ew,checked:$,onCheckedChange:()=>z("printable",!$,{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"printable",children:"Print"})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Editable"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"editable",disabled:ew,checked:ex,onCheckedChange:()=>z("editable",!ex,{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"editable",children:"Editable"})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked,values on a form field,if auto populated will be read only."})]})]})]}):(0,s.jsx)(g.E,{defaultValue:Z,onValueChange:e=>z("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:I.Uv.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(g.m,{value:e.name,id:e.name}),(0,s.jsx)(b._,{htmlFor:e.name,children:e.label})]},e.name))})})})}function eo(e){let{form:l,disabled:i,scriptId:t}=e,a=(0,n.useRef)(null),[r,d]=(0,n.useState)([]),{confirm:c}=(0,$.t)(),u=l.watch("fields"),m=(0,n.useCallback)((e,i)=>{let s=(0,O.q)([...u],e,i);l.setValue("fields",s.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0})},[l,u]),x=(0,n.useCallback)(e=>{let i=u.filter((l,i)=>e.includes(i)).map(e=>'<div class="font-bold text-danger">'.concat(e.label,"</div>")).join("");c(()=>{let i=u.filter((l,i)=>!e.includes(i));l.setValue("fields",i.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0}),d([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," fields: "):"field: ","</p> ").concat(i),danger:!0,positiveLabel:"Delete"})},[l,u,c]),h=(0,n.useCallback)(e=>{let i=u.filter((l,i)=>e.includes(i)).map(e=>'<div class="font-bold">'.concat(e.label,"</div>")).join("");c(()=>{let i=[...u,...u.filter((l,i)=>e.includes(i)).map((e,l)=>({...e,position:u.length+1+l}))];l.setValue("fields",i.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0}),d([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," fields: "):"field: ","</p> ").concat(i),positiveLabel:"Duplicate"})},[l,u,c]),[p,y]=(0,Y.v1)("field",{defaultValue:"",clearOnDefault:!0});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{ref:a}),!!p&&(0,s.jsx)(ed,{open:!!p,onClose:()=>y(""),form:l,scriptId:t,disabled:i,field:u[Number(p)]?{data:u[Number(p)],index:Number(p)}:void 0}),(0,s.jsx)(B.DataTable,{title:"Fields",sortable:!i,selectable:!i,onSort:m,selectedIndexes:r,onSelect:d,search:{inputPlaceholder:"Search fields"},headerActions:i?void 0:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(f.z,{className:"text-primary border-primary",variant:"outline",onClick:()=>y("new"),children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"New field"]})}),columns:[{name:"Type"},{name:"Key"},{name:"Label"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:l}=e;return u[l],(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsxs)(Q.Xi,{onClick:()=>{setTimeout(()=>y("".concat(l)),0)},children:[(0,s.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:i?"View":"Edit"})]}),(0,s.jsxs)(Q.Xi,{onClick:()=>{var e,i;null===(i=a.current)||void 0===i||null===(e=i.click)||void 0===e||e.call(i),setTimeout(()=>x([l]),0)},className:(0,o.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:i,children:[(0,s.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Delete"})]})]})]})}}],data:u.map(e=>[e.type,e.key,e.label,""])}),!i&&(0,s.jsx)(H,{disabled:i,selected:r,onDelete:()=>x(r),onCopy:()=>h(r)})]})}function ec(e){let{disabled:l,selected:i,onDelete:n,onCopy:t}=e;return(0,s.jsx)(s.Fragment,{children:!!i.length&&(0,s.jsx)(X.h,{children:(0,s.jsxs)(f.z,{variant:"destructive",className:"h-auto w-auto",disabled:l,onClick:()=>setTimeout(()=>n(),0),children:[(0,s.jsx)(U.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:i.length>1?"Delete ".concat(i.length," items"):"Delete item"})]})})})}function eu(e){let{open:l,item:i,itemType:t,form:a,disabled:d,types:c=[],subTypes:u=[],onClose:m}=e,{extractDataKeys:x}=(0,J.M)(),h=a.getValues("type"),v=a.getValues("keyId"),g=a.getValues("refIdDataKey"),D="diagnosis"===h,w="progress"===h,k="checklist"===h,I="multi_select"===h,C="single_select"===h,T=["zw_edliz_summary_table","mwi_edliz_summary_table"].includes(h),F=(0,n.useMemo)(()=>{let e=v||g,[l]=e?x([e]):[null];return l},[v,g,x]),{data:S,index:_}={...i},[M,A]=(0,n.useState)(!1),[R,L]=(0,n.useState)(!1);(0,n.useEffect)(()=>{A(!c.length),L(!u.length)},[l,c,u]);let P=(0,n.useCallback)(()=>({itemId:(null==S?void 0:S.itemId)||(0,V.Z)(),id:(null==S?void 0:S.id)||"",label:(null==S?void 0:S.label)||"",position:(null==S?void 0:S.position)||1,subType:(null==S?void 0:S.subType)||"",type:(null==S?void 0:S.type)||t||"",exclusive:(null==S?void 0:S.exclusive)||!1,confidential:(null==S?void 0:S.confidential)||!1,checked:(null==S?void 0:S.checked)||!1,enterValueManually:(null==S?void 0:S.enterValueManually)||!1,severity_order:(null==S?void 0:S.severity_order)||"",summary:(null==S?void 0:S.summary)||"",key:(null==S?void 0:S.key)||"",score:(null==S?void 0:S.score)||"",dataType:(()=>{switch(h){case"checklist":return"boolean";case"single_select":return"id";case"diagnosis":return"diagnosis";default:return null}})(),...S}),[S,h,t]),{control:q,reset:z,watch:E,register:O,handleSubmit:G,setValue:Z}=(0,r.cI)({defaultValues:P()}),W=E("id"),U=E("subType"),Y=E("type"),B=E("label"),Q=E("key"),$=E("enterValueManually"),X=E("confidential"),H=E("exclusive"),ei=E("checked"),es=(0,n.useMemo)(()=>!!d,[d]),en=G(async e=>{if(a.changeTracker){let l=a.getValues("items"),i=!(0,K.x)(_)&&S?l.map((l,i)=>({...l,...i!==_?null:{...e,score:e.score?Number(e.score):null}})):[...l,e];await a.changeTracker.trackChanges({...a.getValues(),items:i},'Item "'.concat(e.label,'" ').concat(S?"updated":"added"))}!(0,K.x)(_)&&S?a.setValue("items",a.getValues("items").map((l,i)=>({...l,...i!==_?null:{...e,score:e.score?Number(e.score):null}}))):a.setValue("items",[...a.getValues("items"),e],{shouldDirty:!0}),m()}),et=e=>{let{value:l,label:i="Select key",variant:n="id"}=e;return(0,s.jsx)(p.L,{modal:!0,value:l,placeholder:i,disabled:!1,filterDataKeys:e=>{if(!k&&!I&&!C)return!0;{let l=(null==F?void 0:F.options)||[];return!F||l.includes(e.uniqueKey)}},onChange:e=>{let[l]=e,i=(null==l?void 0:l.label)||"";Z(n,(null==l?void 0:l.name)||"",{shouldDirty:!0}),Z("keyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0}),Z("label",i,{shouldDirty:!0})}})};return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(el.u,{open:l,title:S?"Edit item":"New item",onOpenChange:e=>{e||m(),z(P())},actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:(0,o.cn)("text-danger text-xs",es&&"hidden"),children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(ee.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(f.z,{disabled:es,onClick:()=>en(),children:"Save"})]}),children:(0,s.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,s.jsx)("div",{className:"flex flex-col gap-y-5",children:k?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{error:!es&&!B,htmlFor:"label",children:"Label *"}),(0,s.jsx)(j.I,{...O("label",{disabled:es,required:!0}),name:"label",error:!es&&!B})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{error:es?void 0:!Q,htmlFor:"key",children:"Key *"}),(0,s.jsx)(r.Qr,{control:q,name:"key",render:e=>{let{field:{value:l}}=e;return et({value:l,variant:"key",label:"Select key"})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"summary",children:"Summary"}),(0,s.jsx)(j.I,{...O("summary",{disabled:es,required:!1}),name:"summary"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"confidential",checked:X,disabled:es,onCheckedChange:e=>Z("confidential",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"confidential",children:"Confidential"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"exclusive",checked:H,disabled:es,onCheckedChange:e=>Z("exclusive",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"exclusive",children:"Disable other items if selected"})]})]}):w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{error:!es&&!B,htmlFor:"label",children:"Label *"}),(0,s.jsx)(j.I,{...O("label",{disabled:es,required:!0}),name:"label",error:!es&&!B})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"checked",checked:ei,disabled:es,onCheckedChange:e=>Z("checked",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"checked",children:"Mark as checked"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:gap-y-0 sm:flex-row sm:gap-x-2 sm:items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{error:es?void 0:!W,htmlFor:"id",children:"ID *"}),(0,s.jsx)(r.Qr,{control:q,name:"id",render:e=>{let{field:{value:l}}=e;return et({value:l,variant:"id",label:"Select id"})}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(b._,{error:!es&&!B,htmlFor:"label",children:"Label *"}),(0,s.jsx)(j.I,{...O("label",{disabled:es,required:!0}),name:"label",error:!es&&!B})]})]}),(I||D)&&(0,s.jsxs)(s.Fragment,{children:[D&&(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"severity_order",children:"Severity Order"}),(0,s.jsx)(j.I,{...O("severity_order",{disabled:es,required:!1}),name:"severity_order"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"exclusive",checked:H,disabled:es,onCheckedChange:e=>Z("exclusive",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"exclusive",children:"Disable other items if selected"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"enterValueManually",checked:$,disabled:es,onCheckedChange:e=>Z("enterValueManually",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"enterValueManually",children:"Enter value manually if selected"})]})]}),T&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"type",children:"Type"}),(0,s.jsxs)("div",{children:[M?(0,s.jsx)(j.I,{...O("type",{disabled:es,required:!0}),name:"type",error:!es&&!Y}):(0,s.jsxs)(y.Ph,{value:Y||"",disabled:es,name:"type",onValueChange:e=>{Z("type",e,{shouldDirty:!0})},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select type"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.n5,{children:"Types"}),c.map(e=>(0,s.jsx)(y.Ql,{value:e.value,children:e.label},e.value))]})})]}),!!c.length&&(0,s.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),Z("type",M&&(t||(null==S?void 0:S.type))||"",{shouldDirty:!0}),A(e=>!e)},className:"text-xs text-primary",children:M?"Select existing type":"Add new type"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"subType",children:"Sub type"}),(0,s.jsxs)("div",{children:[R?(0,s.jsx)(j.I,{...O("subType",{disabled:es,required:!1}),name:"subType"}):(0,s.jsxs)(y.Ph,{value:U||"",disabled:es,name:"subType",onValueChange:e=>{Z("subType",e,{shouldDirty:!0})},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select sub type"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.n5,{children:"Sub types"}),u.map(e=>(0,s.jsx)(y.Ql,{value:e.value,children:e.label},e.value))]})})]}),!!u.length&&(0,s.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),Z("subType",R&&(null==S?void 0:S.subType)||"",{shouldDirty:!0}),L(e=>!e)},className:"text-xs text-primary",children:R?"Select existing sub type":"Add new sub type"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{htmlFor:"label",children:"Score"}),(0,s.jsx)(j.I,{...O("score",{disabled:es,required:!1}),name:"score",type:"number"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"exclusive",checked:H,disabled:es,onCheckedChange:e=>Z("exclusive",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"exclusive",children:"Disable other items if selected"})]})]})]})})})})})}function em(e){let{form:l,disabled:i}=e,t=(0,n.useRef)(null),a="diagnosis"===l.getValues("type"),[r,d]=(0,n.useState)([]),{confirm:c}=(0,$.t)(),u=l.watch("items"),[m,x]=(0,n.useState)(!1),[h,p]=(0,n.useState)(null),y=(0,n.useCallback)((e,i)=>{let s=(0,O.q)([...u],e,i);l.setValue("items",s.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0})},[l,u]),v=(0,n.useCallback)(e=>{let i=u.filter((l,i)=>e.includes(i)).map(e=>'<div class="font-bold text-danger">'.concat(e.label,"</div>")).join("");c(()=>{let i=u.filter((l,i)=>!e.includes(i));l.setValue("items",i.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0}),d([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," items: "):"item: ","</p> ").concat(i),danger:!0,positiveLabel:"Delete"})},[l,u,c]),g=(0,n.useCallback)(e=>{let i=u.filter((l,i)=>e.includes(i)).map(e=>'<div class="font-bold">'.concat(e.label,"</div>")).join("");c(()=>{let i=[...u,...u.filter((l,i)=>e.includes(i)).map((e,l)=>({...e,position:u.length+1+l}))];l.setValue("items",i.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0}),d([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," items: "):"item: ","</p> ").concat(i),positiveLabel:"Duplicate"})},[l,u,c]),[j,b]=(0,Y.v1)("item",{defaultValue:"",clearOnDefault:!0});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{ref:t}),!!j&&(0,s.jsx)(eu,{open:!!j,onClose:()=>b(""),form:l,disabled:i,item:u[Number(j)]?{data:u[Number(j)],index:Number(j)}:void 0}),(0,s.jsx)(B.DataTable,{title:"Items",sortable:!i,selectable:!i,onSort:y,selectedIndexes:r,onSelect:d,search:{inputPlaceholder:"Search items"},headerActions:i?void 0:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(f.z,{className:"text-primary border-primary",variant:"outline",onClick:()=>b("new"),children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"New item"]})}),columns:[{name:"Key"},{name:"Label"},...a?[{name:"Severity order"}]:[],{name:"Action",align:"right",cellRenderer(e){let{rowIndex:l}=e;return u[l],(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsxs)(Q.Xi,{onClick:()=>{setTimeout(()=>b("".concat(l)),0)},children:[(0,s.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:i?"View":"Edit"})]}),(0,s.jsxs)(Q.Xi,{onClick:()=>{var e,i;null===(i=t.current)||void 0===i||null===(e=i.click)||void 0===e||e.call(i),setTimeout(()=>v([l]),0)},className:(0,o.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:i,children:[(0,s.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Delete"})]})]})]})}}],data:u.map(e=>[e.key||e.id,e.label,a?e.severity_order:"",""])}),!i&&(0,s.jsx)(ec,{disabled:i,selected:r,onDelete:()=>v(r),onCopy:()=>g(r)})]})}var ex=i(44371);function eh(e){let{disabled:l,selected:i,onDelete:n,onCopy:t}=e;return(0,s.jsx)(s.Fragment,{children:!!i.length&&(0,s.jsx)(X.h,{children:(0,s.jsxs)(f.z,{variant:"destructive",className:"h-auto w-auto",disabled:l,onClick:()=>n(),children:[(0,s.jsx)(U.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:i.length>1?"Delete ".concat(i.length," items"):"Delete item"})]})})})}var ep=i(18422),ey=i(87138),ev=i(80929),eg=i(74166);function ef(e){let{disabled:l,selected:i,unselectable:t=[],type:a="drug",onChange:r}=e,{loading:d,drugs:o,selectedItemId:c,addLink:u,editLink:m,saveDrugs:x}=(0,ex.a)(),h=(0,n.useMemo)(()=>o.filter(e=>e.type===a),[o,a]),[p,v]=(0,n.useState)(i||[]);return(0,n.useEffect)(()=>{v(i||[])},[i]),(0,s.jsxs)(s.Fragment,{children:[d&&(0,s.jsx)(w.a,{overlay:!0}),(0,s.jsx)(ev.A,{disabled:l,item:h.filter(e=>e.itemId===c)[0],onChange:x}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(b._,{htmlFor:"drug",children:["Select ",a," *"]}),(0,s.jsxs)(y.Ph,{value:p[0]||"",disabled:l,name:"drug",onValueChange:e=>{let l=e?[e]:[],i=h.filter(e=>l.includes(e.key));v(l),r(i.map(e=>({key:e.key,keyId:e.keyId})))},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select drug from library"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsxs)(y.n5,{children:[(0,eg.Z)(a),"s"]}),h.map(e=>(0,s.jsx)(y.Ql,{value:e.key,disabled:t.includes(e.key),children:e.drug},e.key))]})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-x-4 text-xs",children:[!!p[0]&&(0,s.jsxs)(ey.default,{href:m(p[0]),className:"flex items-center text-primary justify-center gap-x-1 opacity-70 hover:opacity-100",children:[(0,s.jsx)(ep.Z,{className:"size-4"}),(0,s.jsxs)("span",{children:["Edit selected ",a]})]}),(0,s.jsxs)(ey.default,{href:u(a),className:"flex items-center justify-center gap-x-1 opacity-70 hover:opacity-100",children:[(0,s.jsx)(G.Z,{className:"size-4"}),(0,s.jsxs)("span",{children:["Add ",a," to library"]})]})]}),!!p[0]&&(0,s.jsx)("div",{className:"opacity-80",children:(0,s.jsx)(ev.A,{disabled:!0,floating:!1,item:h.filter(e=>e.key===p[0])[0],onChange:x})})]})]})}function ej(e){let{children:l,item:i,itemTypeInfo:{formKey:t,type:a},form:r,disabled:d,types:c=[],subTypes:u=[],...m}=e;r.getValues("scriptId");let x=r.getValues("screenId"),{authenticatedUser:h}=(0,L.b)(),[p,y]=(0,n.useState)(null),[v,g]=(0,n.useState)(!1),j=(0,n.useMemo)(()=>!!d,[d]),b=(0,n.useCallback)(async()=>{if(p){let e=(null==i?void 0:i.index)===void 0,l=e?"".concat(t,"[new]"):"".concat(t,"[").concat(i.index,"]"),s=r.getValues("title")||r.getValues("sectionTitle")||r.getValues("label")||r.getValues("previewTitle")||"Screen";await z.pb.addChange({entityType:"screen",entityId:x,entityTitle:s,action:e?"create":"update",fieldPath:l,fieldName:"".concat(t,": ").concat(p.key),oldValue:(null==i?void 0:i.data)||null,newValue:p,userId:null==h?void 0:h.userId,userName:null==h?void 0:h.displayName}),e?r.setValue(t,[...r.getValues(t),p],{shouldDirty:!0}):r.setValue(t,r.getValues(t).map((e,l)=>({...e,...l!==i.index?null:{...p}})))}g(!1)},[p,i,t,x,r]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(el.u,{open:v,title:"Select ".concat(t),trigger:"function"==typeof l?l({extraProps:m}):l,onOpenChange:e=>{y((null==i?void 0:i.data)||null),g(e)},actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:(0,o.cn)("text-danger text-xs",j&&"hidden"),children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(ee.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(f.z,{disabled:j||!p,onClick:()=>b(),children:"Save"})]}),children:(0,s.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,s.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,s.jsx)(ef,{type:a,disabled:j,selected:(null==p?void 0:p.key)?[p.key]:[],unselectable:r.getValues(t).map(e=>e.key).filter(e=>e!==(null==p?void 0:p.key)),onChange:e=>{let[l]=e,s=r.getValues(t).length?1:Math.max(...r.getValues(t).map(e=>e.position))+1;(null==i?void 0:i.data)&&(s=i.data.position),y(l?{...null==i?void 0:i.data,key:l.key,position:s,keyId:l.keyId}:null)}})})})})})}function eb(e){let{form:l,disabled:i,type:t}=e,{drugs:a}=(0,ex.a)(),[r,d]=(0,n.useState)([]),{confirm:c}=(0,$.t)(),u=(0,n.useMemo)(()=>a.filter(e=>e.type===t),[a,t]),m=l.watch("drugs"),x=l.watch("fluids"),h=l.watch("feeds"),p=(0,n.useMemo)(()=>{let e=m,l="drugs",i="Drugs";return"feed"===t?(e=h,l="feeds",i="Feeds"):"fluid"===t&&(e=x,l="fluids",i="Fluids"),{screenDrugs:e,formKey:l,title:i,type:t}},[t,m,x,h]),{screenDrugs:y,formKey:v,title:g}=p,j=(0,n.useMemo)(()=>y.map(e=>{let l=u.filter(l=>l.key===e.key)[0];return{...e,data:l}}),[y,u]),b=(0,n.useCallback)(e=>{l.setValue(v,e,{shouldDirty:!0})},[l.setValue,v]),N=(0,n.useCallback)((e,l)=>{b((0,O.q)([...j],e,l).map((e,l)=>{let{data:i,...s}=e;return{...s,position:l+1}}))},[b,j]),D=(0,n.useCallback)(e=>{let l=j.filter((l,i)=>e.includes(i)).map(e=>{var l;return'<div class="font-bold text-danger">'.concat(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.drug,"</div>")}).join("");c(()=>{b(j.filter((l,i)=>!e.includes(i)).map((e,l)=>{let{data:i,...s}=e;return{...s,position:l+1}})),d([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," items: "):"item: ","</p> ").concat(l),danger:!0,positiveLabel:"Delete"})},[b,j,c]),w=(0,n.useCallback)(e=>{let l=j.filter((l,i)=>e.includes(i)).map(e=>{var l;return'<div class="font-bold">'.concat(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.drug,"</div>")}).join("");c(()=>{b([...j,...j.filter((l,i)=>e.includes(i)).map((e,l)=>({...e,position:j.length+1+l}))].map((e,l)=>{let{data:i,...s}=e;return{...s,position:l+1}})),d([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," items: "):"item: ","</p> ").concat(l),positiveLabel:"Duplicate"})},[b,j,c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.DataTable,{title:g,sortable:!i,selectable:!i,onSort:N,selectedIndexes:r,onSelect:d,noDataMessage:"No ".concat(v," to display."),search:{inputPlaceholder:"Search ".concat(v)},headerActions:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ej,{form:l,disabled:i,itemType:t,itemTypeInfo:p,children:!i&&(0,s.jsx)(ee.hg,{asChild:!0,children:(0,s.jsxs)(f.z,{className:"text-primary border-primary",variant:"outline",children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"Add ",t]})})})}),columns:[{name:"Drug / Fluid"},{name:"Type",cellClassName:"w-[80px]"},{name:"Key"},{name:"Dosage"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:n}=e,t=j[n];return(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsx)(Q.Xi,{asChild:!0,children:(0,s.jsx)(ej,{disabled:i,form:l,itemTypeInfo:p,item:{data:t,index:n},children:e=>{let{extraProps:l}=e;return(0,s.jsxs)(ee.hg,{...l,className:(0,o.cn)(null==l?void 0:l.className,"w-full"),children:[(0,s.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:i?"View":"Edit"})]})}})}),(0,s.jsxs)(Q.Xi,{onClick:()=>D([n]),className:(0,o.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:i,children:[(0,s.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Delete"})]})]})]})}}],data:j.map(e=>{var l,i,s;return[(null===(l=e.data)||void 0===l?void 0:l.drug)||"",(null===(i=e.data)||void 0===i?void 0:i.type)||"",e.key||"",(null===(s=e.data)||void 0===s?void 0:s.dosageText)||"",e.key]})}),!i&&(0,s.jsx)(eh,{disabled:i,selected:r,onDelete:()=>D(r),onCopy:()=>w(r)})]})}function eN(e){let{disabled:l,form:i}=e,{confirm:t}=(0,$.t)(),a=i.watch("items"),[r,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),h=(0,n.useMemo)(()=>a.reduce((e,l,i)=>(l.type&&(e[l.type]=e[l.type]||[],e[l.type].push({...l,index:i})),e),{}),[a]),p=(0,n.useCallback)(e=>{let l=a.filter((l,i)=>e.includes(i)).map(e=>'<div class="font-bold text-danger">'.concat(e.label,"</div>")).join("");t(()=>{let l=a.filter((l,i)=>!e.includes(i));i.setValue("items",l.map((e,l)=>({...e,position:l+1})),{shouldDirty:!0})},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," items: "):"item: ","</p> ").concat(l),danger:!0,positiveLabel:"Delete"})},[i,a,t]),y=(0,n.useCallback)(()=>{let{types:e,subTypes:l}=a.reduce((e,l)=>(l.type&&(e.types[l.type]=l.type),l.subType&&(e.subTypes[l.subType]=l.subType),e),{types:{},subTypes:{}});return{types:Object.keys(e).map(l=>({value:l,label:e[l]})),subTypes:Object.keys(l).map(e=>({value:e,label:l[e]}))}},[a]),[v,g]=(0,Y.v1)("item",{defaultValue:"",clearOnDefault:!0}),[j,b]=(0,Y.v1)("itemType",{defaultValue:"",clearOnDefault:!0});return(0,s.jsxs)(s.Fragment,{children:[!!v&&(0,s.jsx)(eu,{open:!!v,onClose:()=>{g(""),b("")},form:i,disabled:l,itemType:j||void 0,item:a[Number(v)]?{data:a[Number(v)],index:Number(v)}:void 0,...y()}),!a.length&&(0,s.jsxs)(f.z,{className:"text-primary border-primary",variant:"outline",onClick:()=>g("new"),children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"New item"]}),Object.keys(h).map(e=>{let n=h[e];return(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Separator,{}),(0,s.jsx)("div",{className:"mt-5",children:(0,s.jsx)(B.DataTable,{title:e,headerActions:(0,s.jsx)(s.Fragment,{children:!l&&(0,s.jsxs)("div",{className:"flex gap-x-4",children:[(0,s.jsxs)(f.z,{className:"text-primary border-primary",variant:"outline",onClick:()=>{g("new"),b(e)},children:[(0,s.jsx)(G.Z,{className:"h-4 w-4 mr-1"}),"New item"]}),(0,s.jsx)(eD,{form:i,title:e,open:r===e,onOpenChange:e=>!e&&d(null)}),(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsx)(Q.Xi,{asChild:!0,children:(0,s.jsxs)(f.z,{variant:"ghost",className:"justify-start w-full",onClick:l=>{setTimeout(()=>d(e),0)},children:[(0,s.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:"Edit section"})]})}),(0,s.jsxs)(Q.Xi,{onClick:()=>{p(n.map(e=>e.index))},className:(0,o.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),children:[(0,s.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Delete section"})]})]})]})]})}),columns:[{name:"ID",cellClassName:"w-[150px]"},{name:"Sub type",cellClassName:"w-[150px]"},{name:"Label"},{name:"Action",align:"right",cellRenderer(e){let{value:i}=e,n=Number(i);return a[n],(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(Q.h_,{children:[(0,s.jsx)(Q.$F,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Q.AW,{children:[(0,s.jsxs)(Q.Xi,{onClick:()=>{setTimeout(()=>g("".concat(n)),0)},children:[(0,s.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),(0,s.jsx)("span",{children:l?"View":"Edit"})]}),(0,s.jsxs)(Q.Xi,{onClick:()=>p([n]),className:(0,o.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:l,children:[(0,s.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Delete"})]})]})]})})}}],data:n.map(e=>[e.id||"",e.subType||"",e.label||"",e.index])})})]},e)})]})}function eD(e){let{open:l,title:i,form:t,onOpenChange:a,...r}=e,[d,o]=(0,n.useState)(i);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(ee.Vq,{open:l,onOpenChange:e=>{e||null==a||a(e)},children:(0,s.jsxs)(ee.cZ,{className:"p-0",children:[(0,s.jsxs)(ee.fK,{className:"px-4 py-4",children:[(0,s.jsx)(ee.$N,{children:"Edit section"}),(0,s.jsx)(ee.Be,{children:""})]}),(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)(b._,{htmlFor:"title",children:"Title"}),(0,s.jsx)(j.I,{name:"title",value:d,onChange:e=>o(e.target.value)})]}),(0,s.jsxs)(ee.cN,{className:"px-4 py-4",children:[(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(ee.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(ee.GG,{asChild:!0,children:(0,s.jsx)(f.z,{disabled:!d,onClick:()=>{let e=t.getValues("items");t.setValue("items",e.map(e=>({...e,type:e.type===i?d:e.type})))},children:"Save"})})]})]})})})}var ew=i(61386);function ek(e){var l,i;let{formData:u,scriptId:m,countDiagnosesScreens:x,screens:F}=e,S=(0,t.useRouter)(),[O,G]=(0,n.useState)(!!u),Z=function(e){let{formData:l,scriptId:i,script:s}=e,a=(0,t.useRouter)(),o=(0,n.useRef)(!1),[c,u]=(0,n.useState)(!1),{saveScreens:m}=(0,A.h)(),{alert:x}=(0,R.s)(),{viewOnly:h,authenticatedUser:p}=(0,L.b)(),y=(0,n.useMemo)(()=>"/script/".concat(i,"?section=screens"),[i]),v=!(null==l?void 0:l.screenId),g=(0,n.useCallback)(()=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():(0,V.Z)(),[]),f=(0,n.useRef)((null==l?void 0:l.screenId)?(0,q.$u)({entityId:l.screenId,entityType:"screen",userId:null==p?void 0:p.userId,userName:null==p?void 0:p.displayName,entityTitle:(null==l?void 0:l.title)||(null==l?void 0:l.sectionTitle)||(null==l?void 0:l.label)||"Screen",resolveEntityTitle:e=>(null==e?void 0:e.title)||(null==e?void 0:e.sectionTitle)||(null==e?void 0:e.label)||(null==e?void 0:e.previewTitle)}):null),j=(0,n.useRef)(null),b=(0,n.useCallback)(()=>({version:(null==l?void 0:l.version)||1,scriptId:(null==l?void 0:l.scriptId)||i,screenId:(null==l?void 0:l.screenId)||g(),type:(null==l?void 0:l.type)||"",sectionTitle:(null==l?void 0:l.sectionTitle)||"",previewTitle:(null==l?void 0:l.previewTitle)||"",previewPrintTitle:(null==l?void 0:l.previewPrintTitle)||"",condition:(null==l?void 0:l.condition)||"",skipToCondition:(null==l?void 0:l.skipToCondition)||"",skipToScreenId:(null==l?void 0:l.skipToScreenId)||"",epicId:(null==l?void 0:l.epicId)||"",storyId:(null==l?void 0:l.storyId)||"",refId:(null==l?void 0:l.refId)||"",refKey:(null==l?void 0:l.refKey)||"",refIdDataKey:(null==l?void 0:l.refIdDataKey)||"",refKeyDataKey:(null==l?void 0:l.refKeyDataKey)||"",step:(null==l?void 0:l.step)||"",actionText:(null==l?void 0:l.actionText)||"",contentText:(null==l?void 0:l.contentText)||"",contentTextImage:(null==l?void 0:l.contentTextImage)||null,title:(null==l?void 0:l.title)||"",title1:(null==l?void 0:l.title1)||"",title2:(null==l?void 0:l.title2)||"",title3:(null==l?void 0:l.title3)||"",title4:(null==l?void 0:l.title4)||"",text1:(null==l?void 0:l.text1)||"",text2:(null==l?void 0:l.text2)||"",text3:(null==l?void 0:l.text3)||"",image1:(null==l?void 0:l.image1)||null,image2:(null==l?void 0:l.image2)||null,image3:(null==l?void 0:l.image3)||null,instructions:(null==l?void 0:l.instructions)||"",instructions2:(null==l?void 0:l.instructions2)||"",instructions3:(null==l?void 0:l.instructions3)||"",instructions4:(null==l?void 0:l.instructions4)||"",hcwDiagnosesInstructions:(null==l?void 0:l.hcwDiagnosesInstructions)||"",suggestedDiagnosesInstructions:(null==l?void 0:l.suggestedDiagnosesInstructions)||"",notes:(null==l?void 0:l.notes)||"",dataType:(null==l?void 0:l.dataType)||"",key:(null==l?void 0:l.key)||"",keyId:(null==l?void 0:l.keyId)||"",label:(null==l?void 0:l.label)||"",negativeLabel:(null==l?void 0:l.negativeLabel)||"",positiveLabel:(null==l?void 0:l.positiveLabel)||"",timerValue:(null==l?void 0:l.timerValue)||"",multiplier:(null==l?void 0:l.multiplier)||"",minValue:(null==l?void 0:l.minValue)||"",maxValue:(null==l?void 0:l.maxValue)||"",exportable:!!(0,K.x)(null==l?void 0:l.exportable)||(null==l?void 0:l.exportable),skippable:!(0,K.x)(null==l?void 0:l.skippable)&&(null==l?void 0:l.skippable),confidential:!(0,K.x)(null==l?void 0:l.confidential)&&(null==l?void 0:l.confidential),printable:(0,K.x)(null==l?void 0:l.printable)?null:null==l?void 0:l.printable,prePopulate:(null==l?void 0:l.prePopulate)||[],fields:(null==l?void 0:l.fields)||[],items:(null==l?void 0:l.items)||[],drugs:(null==l?void 0:l.drugs)||[],feeds:(null==l?void 0:l.feeds)||[],fluids:(null==l?void 0:l.fluids)||[],reasons:(null==l?void 0:l.reasons)||[],preferences:(null==l?void 0:l.preferences)||k.$7,repeatable:(0,K.x)(null==l?void 0:l.repeatable)?null:null==l?void 0:l.repeatable,collectionName:(null==l?void 0:l.collectionName)||"",collectionLabel:(null==l?void 0:l.collectionLabel)||"",listStyle:(null==l?void 0:l.listStyle)||"none"}),[l,i,g]),N=(0,r.cI)({defaultValues:b()});(0,n.useEffect)(()=>{f.current&&l&&!j.current&&(console.log("Initializing original snapshot for screen:",l.screenId),j.current=l,f.current.setSnapshot(l))},[l]),(0,n.useEffect)(()=>{o.current?N.reset(b()):o.current=!0},[null==l?void 0:l.drugs,null==l?void 0:l.feeds,null==l?void 0:l.fluids,N.reset,b]);let{formState:{dirtyFields:D},handleSubmit:w}=N,I=(0,n.useMemo)(()=>!!Object.keys(D).length,[D]),C=w(async e=>{try{var l;u(!0);let i=e.screenId||g(),s={...e,screenId:i,timerValue:e.timerValue?Number(e.timerValue):null,multiplier:e.multiplier?Number(e.multiplier):null,minValue:e.minValue?Number(e.minValue):null,maxValue:e.maxValue?Number(e.maxValue):null};if(!s.scriptId)throw Error("Screen is missing script reference!");v?console.log("New screen will be tracked after creation"):f.current&&j.current&&(console.log("Tracking changes on save screen draft"),await f.current.trackChanges(s,"Screen draft saved"));let n=(await d.Z.post("/api/screens/save",{data:[s],broadcastAction:!0})).data;if(null===(l=n.errors)||void 0===l?void 0:l.length)throw Error(n.errors.join(", "));v&&(console.log("Tracking new screen creation:",i),await z.pb.addChange({entityType:"screen",entityId:i,entityTitle:s.title||s.sectionTitle||s.label||"Untitled Screen",action:"create",fieldPath:"screen",fieldName:"New Screen",oldValue:null,newValue:s.title||s.sectionTitle||s.label||"Untitled Screen",userId:null==p?void 0:p.userId,userName:null==p?void 0:p.displayName,fullSnapshot:s})),a.refresh(),x({variant:"success",message:"Screen draft was saved successfully!",onClose:()=>a.push(y)})}catch(e){x({title:"Error",variant:"error",message:"Failed to save draft: "+e.message})}finally{u(!1)}}),T=(0,P.v)({isDraft:!!(null==l?void 0:l.isDraft),userId:null==l?void 0:l.draftCreatedByUserId}),F=(null==s?void 0:s.draftCreatedByUserId)||(null==s?void 0:s.itemsChangedByUserId),S=(0,P.v)({isDraft:!!(null==s?void 0:s.isDraft)||!!(null==s?void 0:s.hasChangedItems),userId:F}),_=(0,n.useMemo)(()=>c||h||T||S,[c,h,T,S]);return{...N,formIsDirty:I,saving:c,scriptPageHref:y,disabled:_,isLocked:T,isScriptLocked:S,scriptLockedByUserId:F,save:C,getDefaultValues:b,changeTracker:f.current}}(e),{isLocked:W,control:U,formIsDirty:Y,saving:B,scriptPageHref:Q,disabled:$,isScriptLocked:X,scriptLockedByUserId:H,register:J,watch:ee,setValue:el,save:ei}=Z,[es,en]=(0,n.useState)(""),et=ee("type"),ea=ee("skippable"),er=ee("printable"),ed=ee("confidential"),ec=ee("prePopulate"),eu=ee("image1"),ex=ee("image2"),eh=ee("image3"),ep=ee("preferences"),ey=ee("skipToScreenId"),ev=ee("reasons"),eg=ee("repeatable"),ef=ee("collectionLabel"),ej=ee("key"),eD=Z.watch("listStyle"),ek=(0,n.useCallback)(()=>{S.push(Q)},[S,Q]),eI=(0,n.useCallback)(async e=>{if(e)try{var l;let i=await d.Z.get("/api/aliases/lean?data="+JSON.stringify({script:m,name:e}));en((null==i?void 0:null===(l=i.data)||void 0===l?void 0:l.alias)||"")}catch(e){en("")}},[]);(0,n.useEffect)(()=>{eI(ej)},[eI,ej]);let eC=W||X?(0,s.jsx)("div",{children:(0,s.jsx)(ew.O,{card:!0,isDraft:!!(null==u?void 0:u.isDraft)||X,userId:(null==u?void 0:u.draftCreatedByUserId)||H,dataType:"screen"})}):null;if(!O)return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-4 [&>*]:px-4",children:[(0,s.jsx)(M.D,{children:"Type"}),(0,s.jsx)("div",{children:(0,s.jsx)(g.E,{disabled:$,defaultValue:et,onValueChange:e=>{el("type",e,{shouldDirty:!0}),el("items",[],{shouldDirty:!0}),("mwi_edliz_summary_table"===e||"zw_edliz_summary_table"===e)&&el("items",T[e],{shouldDirty:!0})},className:"flex flex-col gap-y-4",children:k.Tf.map(e=>{let l=!1,i="";return"diagnosis"===e.value&&(i=(l=!!x)?"Diagnosis is disabled because this script already contains a diagnosis script (Script can only have one diagnosis screen).":""),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(g.m,{value:e.value,id:e.value,disabled:l}),(0,s.jsx)(b._,{secondary:!0,htmlFor:e.value,"aria-disabled":l,className:l?"opacity-70 cursor-not-allowed":"",children:e.label}),!!i&&(0,s.jsxs)(v.J2,{children:[(0,s.jsx)(v.xo,{children:(0,s.jsx)(a.Z,{className:"text-primary h-4 w-4"})}),(0,s.jsx)(v.yk,{className:"max-w-[200px] bg-primary text-primary-foreground",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})})]})]},e.value)})})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6",children:[(0,s.jsx)(f.z,{variant:"ghost",onClick:()=>ek(),children:"Cancel"}),(0,s.jsx)(f.z,{disabled:!et&&!Y||$,onClick:()=>{el("dataType",function(e){switch(e){case"yesno":return"boolean";case"timer":return"number";case"management":case"edliz_summary_table":case"mwi_edliz_summary_table":case"zw_edliz_summary_table":default:return"";case"multi_select":return"set<id>";case"single_select":return"id"}}(et)),"management"===et&&el("printable",!1),G(!0)},children:"Continue"})]})]})});let eT="diagnosis"===et,eF="progress"===et,eS="form"===et,e_="checklist"===et,eM="management"===et,eV="zw_edliz_summary_table"===et||"mwi_edliz_summary_table"===et,eA="yesno"===et,eK="timer"===et,eR="multi_select"===et,eL="single_select"===et,eP=eR||eL,eq="drugs"===et,ez="fluids"===et,eE=eA||eP||eK,eO=eA||eP||eK||eM||eT,eG=eL||eR||e_||eF||eT,eZ=e=>{let{value:l}=e;return(0,s.jsx)(p.L,{value:l,disabled:$,onChange:e=>{let[l]=e,i=(null==l?void 0:l.label)||"",s=(null==l?void 0:l.name)||"";null==l||l.children,el("key",s,{shouldDirty:!0}),el("keyId",null==l?void 0:l.uniqueKey,{shouldDirty:!0}),el("label",i,{shouldDirty:!0}),eG&&el("items",[],{shouldDirty:!0}),eS&&el("fields",[],{shouldDirty:!0})}})};return(0,s.jsxs)(s.Fragment,{children:[B&&(0,s.jsx)(w.a,{overlay:!0}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[eC,(0,s.jsx)(M.D,{children:"Type"}),(0,s.jsx)("div",{children:(0,s.jsxs)(y.Ph,{value:et||"",disabled:!0,name:"type",onValueChange:e=>{let l=e||k.Tf[0].value;el("type",l,{shouldDirty:!0}),el("items",[],{shouldDirty:!0}),("mwi_edliz_summary_table"===l||"zw_edliz_summary_table"===l)&&el("items",[],{shouldDirty:!0}),"management"===l&&el("printable",!1)},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select hospital"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.n5,{children:"Screen types"}),k.Tf.map(e=>(0,s.jsx)(y.Ql,{value:e.value,children:e.label},e.value))]})})]})}),(0,s.jsx)(M.D,{children:"Flow control"}),(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"skippable",checked:ea,disabled:$,onCheckedChange:e=>el("skippable",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"skippable",children:"Allow user to skip this screen"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"condition",children:"Conditional expression"}),(0,s.jsx)(c.g,{...J("condition",{disabled:$}),name:"condition",noRing:!1,rows:5}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",k._S]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:items-baseline",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"skipToCondition",children:"Skip to screen conditional expression"}),(0,s.jsx)(j.I,{...J("skipToCondition",{disabled:$}),name:"skipToCondition",noRing:!1}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",k._S]})]}),(0,s.jsxs)("div",{className:"min-w-[300px]",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"skipToScreenId",children:"Skip to screen"}),(0,s.jsxs)(y.Ph,{value:ey,name:"skipToScreenId",onValueChange:e=>{el("skipToScreenId","none"===e?"":e)},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select screen"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.Ql,{value:"none",children:"None"}),F.map(e=>(0,s.jsx)(y.Ql,{value:e.oldScreenId||e.screenId,children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:[e.position,e.title,'<span class="opacity-50">'.concat(e.refId||"","</span>")].join(" - ")}})},e.screenId))]})})]})]})]}),(0,s.jsx)(M.D,{children:"Properties"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"epicId",children:"Epic ID"}),(0,s.jsx)(j.I,{...J("epicId",{disabled:$}),name:"epicId",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"storyId",children:"Story ID"}),(0,s.jsx)(j.I,{...J("storyId",{disabled:$}),name:"storyId",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"refId",children:"Ref *"}),(0,s.jsx)(j.I,{...J("refId",{disabled:$,required:!0}),name:"refId",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"step",children:"Step"}),(0,s.jsx)(j.I,{...J("step",{disabled:$}),name:"step",noRing:!1})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"title",children:"Title *"}),(0,s.jsx)(j.I,{...J("title",{disabled:$,required:!0}),name:"title",noRing:!1}),(0,s.jsx)(_.w,{id:"title",title:"Title",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]}),eT&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"title2",children:"Title 2 *"}),(0,s.jsx)(j.I,{...J("title2",{disabled:$,required:!1}),name:"title2",noRing:!1}),(0,s.jsx)(_.w,{id:"title2",title:"Title 2",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"title3",children:"Title 3 *"}),(0,s.jsx)(j.I,{...J("title3",{disabled:$,required:!1}),name:"title3",noRing:!1}),(0,s.jsx)(_.w,{id:"title3",title:"Title 3",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"previewTitle",children:"Preview title *"}),(0,s.jsx)(j.I,{...J("previewTitle",{disabled:$,required:!1}),name:"previewTitle",noRing:!1}),(0,s.jsx)(_.w,{id:"previewTitle",title:"Preview title",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"previewPrintTitle",children:"Preview print title *"}),(0,s.jsx)(j.I,{...J("previewPrintTitle",{disabled:$,required:!1}),name:"previewPrintTitle",noRing:!1}),(0,s.jsx)(_.w,{id:"previewPrintTitle",title:"Preview print title",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"sectionTitle",children:"Print section title *"}),(0,s.jsx)(j.I,{...J("sectionTitle",{disabled:$,required:!1}),name:"sectionTitle",noRing:!1}),(0,s.jsx)(_.w,{id:"sectionTitle",title:"Print section title",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"actionText",children:"Action"}),(0,s.jsx)(j.I,{...J("actionText",{disabled:$}),name:"actionText",noRing:!1}),(0,s.jsx)(_.w,{id:"actionText",title:"Action",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsxs)("div",{className:"flex gap-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"contentText",children:"Content"}),(0,s.jsx)(c.g,{...J("contentText",{disabled:$}),name:"contentText",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"contentText",title:"Content",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsx)(r.Qr,{control:U,name:"contentTextImage",render:e=>{let{field:l}=e;return(0,s.jsx)(E.M,{disabled:$,image:l.value,onChange:e=>l.onChange(e)})}})]}),eM&&(0,s.jsx)(s.Fragment,{children:[["title1","text1",eu],["title2","text2",ex],["title3","text3",eh]].map((e,l)=>{let i=e[0],t=e[1],a=e[2],r="image".concat(l+1);return(0,s.jsxs)(n.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(b._,{secondary:!0,htmlFor:"imageTextFields.".concat(l,".title"),children:["Title ",l+1]}),(0,s.jsx)(j.I,{...J(i,{disabled:$}),name:i,noRing:!1}),(0,s.jsx)(_.w,{id:i,title:"Title ".concat(l+1),disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0}),hide:!0})]}),(0,s.jsxs)("div",{className:"flex gap-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(b._,{htmlFor:"imageTextFields.".concat(l,".text"),children:["Text ",l+1]}),(0,s.jsx)(c.g,{...J(t,{disabled:$}),name:t,noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:t,title:"Text ".concat(l+1),disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsx)(E.M,{disabled:$,image:a,onChange:e=>el(r,e,{shouldDirty:!0})})]})]},"imageTextFields.".concat(l))})}),(eK||eA||eP||e_)&&(0,s.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-y-5",eK&&"sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1"),children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(b._,{secondary:!0,htmlFor:"key",children:["Input key",eK?"":" *"]}),(0,s.jsx)(r.Qr,{name:"key",control:U,render:e=>{let{field:{value:l}}=e;return eZ({value:l})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(b._,{secondary:!0,htmlFor:"label",children:["Input label",eK?"":" *"]}),(0,s.jsx)(j.I,{...J("label",{disabled:$,required:!eK}),name:"label",noRing:!1})]})]}),eA&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"negativeLabel",children:"Negative label *"}),(0,s.jsx)(j.I,{...J("negativeLabel",{disabled:$,required:!0}),name:"negativeLabel",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"positiveLabel",children:"Positive label *"}),(0,s.jsx)(j.I,{...J("positiveLabel",{disabled:$,required:!0}),name:"positiveLabel",noRing:!1})]})]})}),eK&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"timerValue",children:"Timer value"}),(0,s.jsx)(j.I,{...J("timerValue",{disabled:$}),name:"timerValue",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"multiplier",children:"Multiplier"}),(0,s.jsx)(j.I,{...J("multiplier",{disabled:$}),name:"multiplier",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"minValue",children:"Input value min."}),(0,s.jsx)(j.I,{...J("minValue",{disabled:$}),name:"minValue",noRing:!1})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"maxValue",children:"Input value max."}),(0,s.jsx)(j.I,{...J("maxValue",{disabled:$}),name:"maxValue",noRing:!1})]})]})}),(eA||eK||eP)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(N.r,{id:"confidential",checked:ed,disabled:$,onCheckedChange:e=>el("confidential",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"confidential",children:"Confidential"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"instructions",children:"Instructions"}),(0,s.jsx)(c.g,{...J("instructions",{disabled:$}),name:"instructions",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"instructions",title:"Instructions",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),eT&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"instructions2",children:"Instructions 2"}),(0,s.jsx)(c.g,{...J("instructions2",{disabled:$}),name:"instructions2",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"instructions2",title:"Instructions 2",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"instructions3",children:"Instructions 3"}),(0,s.jsx)(c.g,{...J("instructions3",{disabled:$}),name:"instructions3",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"instructions3",title:"Instructions 3",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"hcwDiagnosesInstructions",children:"HCW diagnoses instructions"}),(0,s.jsx)(c.g,{...J("hcwDiagnosesInstructions",{disabled:$}),name:"hcwDiagnosesInstructions",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"hcwDiagnosesInstructions",title:"HCW diagnoses instructions",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"suggestedDiagnosesInstructions",children:"Suggested diagnoses instructions"}),(0,s.jsx)(c.g,{...J("suggestedDiagnosesInstructions",{disabled:$}),name:"suggestedDiagnosesInstructions",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"suggestedDiagnosesInstructions",title:"Suggested diagnoses instructions",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"notes",children:"Notes"}),(0,s.jsx)(c.g,{...J("notes",{disabled:$}),name:"notes",noRing:!1,rows:5}),(0,s.jsx)(_.w,{id:"notes",title:"Notes",disabled:$,data:ep,onSave:e=>el("preferences",e,{shouldDirty:!0})})]}),(eq||ez)&&(0,s.jsxs)("div",{children:[(0,s.jsxs)(b._,{secondary:!0,htmlFor:"reasons",children:["Reasons for not administering ",ez?"fluid":"drug"]}),(0,s.jsx)(h,{name:"reasons",noRing:!1,rows:5,value:ev,disabled:$,onChange:e=>el("reasons",e,{shouldDirty:!0})})]}),eE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Neotree ID Search"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[I.d4.map(e=>{let l="prePopulate_".concat(e.value),i=I.d4.filter(e=>e.value!==I.d4[0].value).map(e=>e.value),n=ec.includes(e.value)||ec.length===i.length;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:l,checked:n,disabled:$,onCheckedChange:l=>{let s=[];l?(s=[...ec,e.value],e.value===I.d4[0].value&&(s=i)):(s=ec.filter(l=>l!==e.value),e.value===I.d4[0].value&&(s=[])),el("prePopulate",s,{shouldDirty:!0})}}),(0,s.jsx)(b._,{htmlFor:l,children:e.label})]},l)}),(null==ec?void 0:ec.length)>0&&!!es&&(0,s.jsxs)("div",{className:"max-w-64",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"alias",children:"ALIAS"}),(0,s.jsx)(j.I,{value:es,disabled:!0,name:"alias",placeholder:"",noRing:!1})]})]})]}),eO&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.D,{children:"Print"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 items-end sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:[eM&&(0,s.jsxs)("div",{className:"max-w-64",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"refKey",children:"Reference key"}),(0,s.jsx)(r.Qr,{control:U,name:"refKey",render:e=>{let{field:{value:l,onChange:i}}=e;return(0,s.jsx)(p.L,{value:"".concat(l||""),disabled:!1,onChange:e=>{let[l]=e;i(l.name),el("refKeyDataKey",null==l?void 0:l.uniqueKey,{shouldDirty:!0})}})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,s.jsx)(D.X,{id:"printable",checked:er,disabled:$,onCheckedChange:()=>el("printable",!er,{shouldDirty:!0})}),(0,s.jsx)(b._,{htmlFor:"printable",children:"Print"})]}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})]}),(e_||eR||eV||eT)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"listStyle",children:"List style"}),(0,s.jsxs)(y.Ph,{value:eD,name:"listStyle",onValueChange:e=>{Z.setValue("listStyle",e||"none")},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.Ql,{value:"none",children:"None"}),(0,s.jsx)(y.Ql,{value:"bullet",children:"Bullet"}),(0,s.jsx)(y.Ql,{value:"number",children:"Number"})]})})]})]})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,s.jsx)("span",{className:(0,o.cn)("text-danger text-xs",$&&"hidden"),children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(f.z,{variant:"ghost",onClick:()=>ek(),children:"Cancel"}),(0,s.jsx)(f.z,{disabled:$,onClick:()=>ei(),children:"Save Draft"})]}),eV&&(0,s.jsx)(eN,{form:Z,disabled:$}),eS&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex flex-col gap-y-5 sm:flex-row sm:gap-y-0 sm:gap-x-2 sm:[&>*]:flex-1",children:(0,s.jsxs)("div",{className:"flex items-center justify-start gap-x-2 py-6 px-4",children:[(0,s.jsx)(N.r,{id:"repeatable",checked:eg,disabled:$,onCheckedChange:e=>el("repeatable",e,{shouldDirty:!0})}),(0,s.jsx)(b._,{secondary:!0,htmlFor:"repeatable",children:"Repeatable Form"})]})}),(0,s.jsx)(C.Separator,{className:"my-20"}),(0,s.jsx)(eo,{form:Z,disabled:$,scriptId:m}),eg&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Separator,{className:"my-8"}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-x-2",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"collectionName",children:"Collection Name"}),(0,s.jsx)(j.I,{...J("collectionName",{disabled:$,required:eg}),name:"collectionName",noRing:!1,required:eg,className:"flex-col"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsx)(b._,{secondary:!0,htmlFor:"collectionLabel",children:"Collection Label"}),(0,s.jsxs)(y.Ph,{value:ef||"",required:eg,name:"collectionLabel",disabled:$,onValueChange:e=>{el("collectionLabel",(e="none"===e?"":e)||"",{shouldDirty:!0})},children:[(0,s.jsx)(y.i4,{children:(0,s.jsx)(y.ki,{placeholder:"Select Collection Label"})}),(0,s.jsx)(y.Bw,{children:(0,s.jsxs)(y.DI,{children:[(0,s.jsx)(y.Ql,{value:"none",children:"No Collection Label"}),null==Z?void 0:null===(i=Z.getValues())||void 0===i?void 0:null===(l=i.fields)||void 0===l?void 0:l.map(e=>(0,s.jsx)(y.Ql,{value:e.key,children:e.key},e.key))]})})]})]}),(0,s.jsx)(C.Separator,{className:"my-8"})]})]})]}),eG&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Separator,{className:"my-20"}),(0,s.jsx)(em,{form:Z,disabled:$})]}),(eq||ez)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.Separator,{className:"my-20"}),(0,s.jsx)(eb,{form:Z,disabled:$,type:"fluids"===et?"fluid":"drug"})]})]})}},18934:function(e,l,i){"use strict";i.d(l,{U:function(){return t},w:function(){return a}});var s=i(2265),n=i(20920);function t(e){return{getDefaultValues:(0,s.useCallback)(()=>({...e,fieldId:(null==e?void 0:e.fieldId)||(0,n.Z)(),type:(null==e?void 0:e.type)||"",key:(null==e?void 0:e.key)||"",keyId:(null==e?void 0:e.keyId)||"",label:(null==e?void 0:e.label)||"",refKey:(null==e?void 0:e.refKey)||"",refKeyId:(null==e?void 0:e.refKeyId)||"",calculation:(null==e?void 0:e.calculation)||"",condition:(null==e?void 0:e.condition)||"",dataType:(null==e?void 0:e.dataType)||"",defaultValue:(null==e?void 0:e.defaultValue)||"",format:(null==e?void 0:e.format)||"",minValue:(null==e?void 0:e.minValue)||"",maxValue:(null==e?void 0:e.maxValue)||"",minDate:(null==e?void 0:e.minDate)||"",maxDate:(null==e?void 0:e.maxDate)||"",minTime:(null==e?void 0:e.minTime)||"",maxTime:(null==e?void 0:e.maxTime)||"",minDateKey:(null==e?void 0:e.minDateKey)||"",maxDateKey:(null==e?void 0:e.maxDateKey)||"",minTimeKey:(null==e?void 0:e.minTimeKey)||"",maxTimeKey:(null==e?void 0:e.maxTimeKey)||"",minDateKeyId:(null==e?void 0:e.minDateKeyId)||"",maxDateKeyId:(null==e?void 0:e.maxDateKeyId)||"",minTimeKeyId:(null==e?void 0:e.minTimeKeyId)||"",maxTimeKeyId:(null==e?void 0:e.maxTimeKeyId)||"",values:(null==e?void 0:e.values)||"",valuesOptions:(null==e?void 0:e.valuesOptions)||[],confidential:(null==e?void 0:e.confidential)||!1,optional:(null==e?void 0:e.optional)||!1,printable:(null==e?void 0:e.printable)||!1,prePopulate:(null==e?void 0:e.prePopulate)||[],editable:(null==e?void 0:e.editable)||!1,items:(null==e?void 0:e.items)||[]}),[e])}}function a(e){return{getDefaultValues:(0,s.useCallback)(()=>({label:(null==e?void 0:e.label)||"",screen:(null==e?void 0:e.screen)||"",...e}),[e])}}},80929:function(e,l,i){"use strict";i.d(l,{A:function(){return S}});var s=i(57437),n=i(2265),t=i(16463),a=i(12491),r=i(20920),d=i(5192),o=i(95317),c=i(46294),u=i(80852),m=i(86466),x=i(50495),h=i(83102),p=i(93146),y=i(67135),v=i(39661),g=i(44371),f=i(83146),j=i(76230),b=i(74166),N=i(71239),D=i(17647),w=i(42314),k=i(72341);let I=e=>{if(e)return(null==e?void 0:e.key)||(null==e?void 0:e.drug)||(null==e?void 0:e.feed)||(null==e?void 0:e.fluid)||(null==e?void 0:e.name)||(null==e?void 0:e.title)||void 0},C=[{value:"drug",label:"Drug"},{value:"fluid",label:"Fluid"}],T=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"drug";return{itemId:"".concat((null==e?void 0:e.itemId)||(0,r.Z)()),type:"".concat((null==e?void 0:e.type)||l),key:"".concat((null==e?void 0:e.key)||""),keyId:"".concat((null==e?void 0:e.keyId)||""),drug:"".concat((null==e?void 0:e.drug)||""),minGestation:"".concat((null==e?void 0:e.minGestation)===null?"":null==e?void 0:e.minGestation),maxGestation:"".concat((null==e?void 0:e.maxGestation)===null?"":null==e?void 0:e.maxGestation),minWeight:"".concat((null==e?void 0:e.minWeight)===null?"":null==e?void 0:e.minWeight),maxWeight:"".concat((null==e?void 0:e.maxWeight)===null?"":null==e?void 0:e.maxWeight),minAge:"".concat((null==e?void 0:e.minAge)===null?"":null==e?void 0:e.minAge),maxAge:"".concat((null==e?void 0:e.maxAge)===null?"":null==e?void 0:e.maxAge),dosage:"".concat((null==e?void 0:e.dosage)===null?"":null==e?void 0:e.dosage),dosageMultiplier:"".concat((null==e?void 0:e.dosageMultiplier)===null?"":null==e?void 0:e.dosageMultiplier),hourlyFeed:"".concat((null==e?void 0:e.hourlyFeed)===null?"":null==e?void 0:e.hourlyFeed),hourlyFeedDivider:"".concat((null==e?void 0:e.hourlyFeedDivider)===null?"":null==e?void 0:e.hourlyFeedDivider),dayOfLife:"".concat((null==e?void 0:e.dayOfLife)||""),dosageText:"".concat((null==e?void 0:e.dosageText)||""),managementText:"".concat((null==e?void 0:e.managementText)||""),gestationKey:"".concat((null==e?void 0:e.gestationKey)||""),weightKey:"".concat((null==e?void 0:e.weightKey)||""),diagnosisKey:"".concat((null==e?void 0:e.diagnosisKey)||""),gestationKeyId:"".concat((null==e?void 0:e.gestationKeyId)||""),weightKeyId:"".concat((null==e?void 0:e.weightKeyId)||""),diagnosisKeyId:"".concat((null==e?void 0:e.diagnosisKeyId)||""),condition:"".concat((null==e?void 0:e.condition)||""),administrationFrequency:"".concat((null==e?void 0:e.administrationFrequency)||""),drugUnit:"".concat((null==e?void 0:e.drugUnit)||""),routeOfAdministration:"".concat((null==e?void 0:e.routeOfAdministration)||""),ageKey:"".concat((null==e?void 0:e.ageKey)||""),ageKeyId:"".concat((null==e?void 0:e.ageKeyId)||""),validationType:"".concat((null==e?void 0:e.validationType)||"default")}},F=e=>{if(!e)return null;let{isDraft:l,draftCreatedByUserId:i,isDeleted:s,preferences:n,...t}=e;return{...t}};function S(e){let{disabled:l,item:i,floating:r,onChange:S}=e,_=(0,N.v)({isDraft:!!(null==i?void 0:i.isDraft),userId:null==i?void 0:i.draftCreatedByUserId});l=l||_;let M=(0,t.useRouter)(),V=(0,t.useSearchParams)(),A=(0,n.useMemo)(()=>a.Z.parse(V.toString()),[V]),{itemId:K,addItem:R}=A,[L,P]=(0,d.Z)(),[q,z]=(0,d.Z)(),[E,O]=(0,n.useState)(!1),[G,Z]=(0,n.useState)(T(i,R)),{keys:W,loading:U}=(0,g.a)(),{authenticatedUser:Y}=(0,D.b)(),{confirm:B}=(0,j.t)(),Q=(0,n.useRef)(null),$=(0,n.useRef)(null),X=(0,n.useRef)(null);(0,n.useEffect)(()=>{O(!!K||!!R)},[K,R]),(0,n.useEffect)(()=>{Z(T(i,R))},[i,R]),(0,n.useEffect)(()=>{if(!(null==i?void 0:i.itemId)){Q.current=null,$.current=null,X.current=null;return}if(X.current===i.itemId&&Q.current)return;let e=(0,w.$u)({entityId:i.itemId,entityType:"drugsLibraryItem",userId:null==Y?void 0:Y.userId,userName:null==Y?void 0:Y.displayName,entityTitle:I(i)||"Drugs Library Item",resolveEntityTitle:e=>I(e)||void 0}),l=F(i);l&&(e.setSnapshot(l),$.current=l),Q.current=e,X.current=i.itemId},[i,null==Y?void 0:Y.userId,null==Y?void 0:Y.displayName]);let H=(0,n.useCallback)(async()=>{let e={...G,minWeight:G.minWeight?Number(G.minWeight):null,maxWeight:G.maxWeight?Number(G.maxWeight):null,minGestation:G.minGestation?Number(G.minGestation):null,maxGestation:G.maxGestation?Number(G.maxGestation):null,hourlyFeed:G.hourlyFeed?Number(G.hourlyFeed):null,hourlyFeedDivider:G.hourlyFeedDivider?Number(G.hourlyFeedDivider):null,minAge:G.minAge?Number(G.minAge):null,maxAge:G.maxAge?Number(G.maxAge):null,dosage:G.dosage?Number(G.dosage):null,dosageMultiplier:G.dosageMultiplier?Number(G.dosageMultiplier):null,type:G.type},l=F(e),s=e.itemId,n=async()=>{try{if(!i&&l&&s){let i=(await k.pb.getEntityChanges(s,"drugsLibraryItem")).find(e=>"create"===e.action),n=I(e)||"Drugs Library Item",t=I(e)||"New Library Item";(null==i?void 0:i.id)?await k.pb.updateChange(i.id,{fieldName:t,newValue:l,timestamp:Date.now(),userId:null==Y?void 0:Y.userId,userName:null==Y?void 0:Y.displayName,entityTitle:n,fullSnapshot:l}):await k.pb.addChange({entityType:"drugsLibraryItem",entityId:s,entityTitle:n,action:"create",fieldPath:"drugsLibraryItem",fieldName:t,oldValue:null,newValue:l,userId:null==Y?void 0:Y.userId,userName:null==Y?void 0:Y.displayName,fullSnapshot:l})}else Q.current&&$.current&&l&&await Q.current.trackChanges(l,"Drugs library item saved")}catch(e){console.error("Failed to track drugs library changes",e)}await S(e),O(!1)};i&&G.key!==(null==i?void 0:i.key)?B(()=>{n()},{danger:!0,title:"Confirm key change",message:'\n                    <p class="text-xl">Are you sure you want to change key?</p>\n                    <p>All references to the old key ('.concat(i.key,") will also be updated to: ").concat(G.key,"</p>\n                "),positiveLabel:"Yes, keep changes",negativeLabel:"No, do not save"}):await n()},[G,i,S,B,null==Y?void 0:Y.userId,null==Y?void 0:Y.displayName]),J=(0,n.useCallback)(()=>{O(!1),Z(T(void 0,R)),M.push("?".concat(a.Z.stringify({...A,itemId:void 0,addItem:void 0})));let e=(null==P?void 0:P.top)||0;setTimeout(()=>window.scrollTo({top:e}),500)},[A,P,M,R]),{isFormComplete:ee,isDrug:el,isFluid:ei,validateWithCondition:es}=(0,n.useMemo)(()=>{let e="drug"===G.type,l="fluid"===G.type,i="condition"===G.validationType,s=!!(G.type&&G.key&&G.drug&&G.managementText&&G.dosageText&&G.administrationFrequency&&G.drugUnit&&G.routeOfAdministration&&G.dosage&&i?G.condition:G.weightKey&&G.minWeight&&G.maxWeight&&G.gestationKey&&G.minGestation&&G.maxGestation&&G.ageKey&&G.minAge&&G.maxAge&&Number(G.minGestation||"0")<=Number(G.maxGestation||"0")&&Number(G.minWeight||"0")<=Number(G.maxWeight||"0")&&Number(G.minAge||"0")<=Number(G.maxAge||"0")&&(!e||G.diagnosisKey)&&(!l||G.condition&&G.hourlyFeed&&G.hourlyFeedDivider&&Number(G.hourlyFeed||"0")<=Number(G.hourlyFeed||"0")&&Number(G.hourlyFeedDivider||"0")<=Number(G.hourlyFeedDivider||"0")));return{isDrug:e,isFluid:l,isFormComplete:s,validateWithCondition:i}},[G]),en=(0,n.useCallback)(()=>!ee||U||l,[ee,U,l]),et=(0,s.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"type",children:"Type *"}),(0,s.jsxs)(c.Ph,{value:G.type,required:!0,name:"type",disabled:l,onValueChange:e=>{let l=T((null==i?void 0:i.type)===e?i:void 0,R);B(()=>Z(i=>({...i,type:e,hourlyFeed:l.hourlyFeed,hourlyFeedDivider:l.hourlyFeedDivider,condition:l.condition,diagnosisKey:l.diagnosisKey,drugUnit:l.drugUnit})),{danger:!0,title:"Confirm type change",message:'\n                                <p class="text-xl">Are you sure you want to change type?</p>\n                                <ol style="list-style:auto;margin:10px;">\n                                    <li>Some fields will be cleared as they do not apply on all types!</li>\n                                    <li>All references to this '.concat(G.type," will be removed.</li>\n                                </ol>\n                            "),positiveLabel:"Yes, change type",negativeLabel:"No, keep the current type"})},children:[(0,s.jsx)(c.i4,{children:(0,s.jsx)(c.ki,{placeholder:"Select type"})}),(0,s.jsx)(c.Bw,{children:(0,s.jsx)(c.DI,{children:C.map(e=>(0,s.jsx)(c.Ql,{value:e.value,children:e.label},e.value))})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"key",children:"Key *"}),(0,s.jsx)(h.I,{name:"key",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.key,disabled:l,onChange:e=>Z(l=>({...l,key:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"drug",children:[(0,b.Z)(G.type)," *"]}),(0,s.jsx)(h.I,{name:"drug",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.drug,disabled:l,onChange:e=>Z(l=>({...l,drug:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"condition",children:["Condition ",es?"*":""]}),(0,s.jsx)(p.g,{rows:3,name:"condition",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.condition,disabled:l,onChange:e=>Z(l=>({...l,condition:e.target.value}))}),(0,s.jsxs)("span",{className:"font-bold opacity-50 text-xs",children:["e.g ",f._S]})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsx)(m.X,{name:"validationType",id:"validationType",disabled:l,checked:"condition"===G.validationType,onCheckedChange:e=>Z(e=>({...e,validationType:"condition"===e.validationType?"default":"condition"}))}),(0,s.jsx)(y._,{secondary:!0,htmlFor:"validationType",children:"Validate with conditional expression only"})]}),el&&(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"diagnosisKey",children:["Diagnosis Key ",es?"":"*"]}),(0,s.jsx)(p.g,{rows:3,name:"gestationKey",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.diagnosisKey,disabled:l,onChange:e=>Z(l=>({...l,diagnosisKey:e.target.value}))}),(0,s.jsx)("span",{className:"font-bold opacity-50 text-xs",children:"e.g NSep,Premature,Dehyd"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"gestationKey",children:["Gestation Key ",es?"":"*"]}),(0,s.jsx)(u.L,{modal:!0,value:"".concat(G.gestationKey||""),disabled:l,onChange:e=>{let[l]=e;Z(e=>({...e,gestationKey:l.name,gestationKeyId:null==l?void 0:l.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"minGestation",children:["Min Gestation (weeks) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"minGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.minGestation,type:"number",disabled:l,onChange:e=>{let l=e.target.value,i=G.maxGestation;l||(i=""),Z(e=>({...e,minGestation:l,maxGestation:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"maxGestation",error:Number(G.minGestation||"0")>Number(G.maxGestation||"0"),children:["Max Gestation (weeks) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"maxGestation",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.maxGestation,type:"number",disabled:l||!G.minGestation,min:G.minGestation,error:Number(G.minGestation||"0")>Number(G.maxGestation||"0"),onChange:e=>Z(l=>({...l,maxGestation:e.target.value}))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"weightKey",children:["Weight Key ",es?"":"*"]}),(0,s.jsx)(u.L,{modal:!0,value:"".concat(G.weightKey||""),disabled:l,onChange:e=>{let[l]=e;Z(e=>({...e,weightKey:l.name,weightKeyId:null==l?void 0:l.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"minWeight",children:["Min Weight (grams) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"minWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.minWeight,type:"number",disabled:l,onChange:e=>{let l=e.target.value,i=G.maxWeight;l||(i=""),Z(e=>({...e,minWeight:l,maxWeight:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"maxWeight",error:Number(G.minWeight||"0")>Number(G.maxWeight||"0"),children:["Max Weight (grams) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"maxWeight",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.maxWeight,type:"number",disabled:l||!G.minWeight,min:G.minWeight,error:Number(G.minWeight||"0")>Number(G.maxWeight||"0"),onChange:e=>Z(l=>({...l,maxWeight:e.target.value}))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"ageKey",children:["Day of Life (Age) Key ",es?"":"*"]}),(0,s.jsx)(u.L,{modal:!0,value:"".concat(G.ageKey||""),disabled:l,onChange:e=>{let[l]=e;Z(e=>({...e,ageKey:l.name,ageKeyId:null==l?void 0:l.uniqueKey}))}})]}),(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"minAge",children:["Min Day of Life (Age - hours) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"minAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.minAge,type:"number",disabled:l,onChange:e=>{let l=e.target.value,i=G.maxAge;l||(i=""),Z(e=>({...e,minAge:l,maxAge:i}))}})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"maxAge",error:Number(G.minAge||"0")>Number(G.maxAge||"0"),children:["Max Day of Life (Age - hours) ",es?"":"*"]}),(0,s.jsx)(h.I,{name:"maxAge",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.maxAge,type:"number",disabled:l||!G.minAge,min:G.minAge,error:Number(G.minAge||"0")>Number(G.maxAge||"0"),onChange:e=>Z(l=>({...l,maxAge:e.target.value}))})]})]}),ei&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"hourlyFeed",children:"Hourly feed *"}),(0,s.jsx)(h.I,{name:"hourlyFeed",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.hourlyFeed,type:"number",disabled:l,onChange:e=>Z(l=>({...l,hourlyFeed:e.target.value}))})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"hourlyFeedDivider",children:"Hourly feed divider *"}),(0,s.jsx)(h.I,{name:"hourlyFeedDivider",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.hourlyFeedDivider,type:"number",disabled:l,onChange:e=>Z(l=>({...l,hourlyFeedDivider:e.target.value}))})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(y._,{secondary:!0,htmlFor:"dosage",children:["Dose (e.g. ",ei?"ml/kg/24hrs":"mg/kg",") *"]}),(0,s.jsx)(h.I,{name:"dosage",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.dosage,disabled:l,onChange:e=>Z(l=>({...l,dosage:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"dosageMultiplier",children:"Drug Dose Multiplier *"}),(0,s.jsx)(h.I,{name:"dosageMultiplier",type:"number",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.dosageMultiplier,disabled:l,onChange:e=>Z(l=>({...l,dosageMultiplier:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"drugUnit",children:"Drug Unit *"}),(0,s.jsx)(h.I,{name:"drugUnit",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.drugUnit,disabled:l,onChange:e=>Z(l=>({...l,drugUnit:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"administrationFrequency",children:"Administration Frequency *"}),(0,s.jsx)(h.I,{name:"administrationFrequency",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.administrationFrequency,disabled:l,onChange:e=>Z(l=>({...l,administrationFrequency:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"routeOfAdministration",children:"Route of Administration *"}),(0,s.jsx)(h.I,{name:"routeOfAdministration",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.routeOfAdministration,disabled:l,onChange:e=>Z(l=>({...l,routeOfAdministration:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"managementText",children:"Management text *"}),(0,s.jsx)(h.I,{name:"managementText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.managementText,disabled:l,onChange:e=>Z(l=>({...l,managementText:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(y._,{secondary:!0,htmlFor:"weight",children:"Dosage text *"}),(0,s.jsx)(h.I,{name:"dosageText",className:"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",value:G.dosageText,disabled:l,onChange:e=>Z(l=>({...l,dosageText:e.target.value}))})]})]});return(0,s.jsxs)(s.Fragment,{children:[U&&(0,s.jsx)(v.a,{overlay:!0}),(0,s.jsx)("div",{ref:L,children:!1===r?et:(0,s.jsx)(o.yo,{open:E,onOpenChange:e=>{e||J()},children:(0,s.jsxs)(o.ue,{hideCloseButton:!0,side:"right",className:"p-0 m-0 flex flex-col w-full max-w-full sm:max-w-[80%] md:max-w-[80%] lg:max-w-[50%]",children:[(0,s.jsxs)(o.Tu,{className:"flex flex-row items-center py-2 px-4 border-b border-b-border text-left sm:text-left",children:[(0,s.jsxs)(o.bC,{children:[R?"Add":"",K?"Edit":""," ",(null==i?void 0:i.type)||R]}),(0,s.jsx)(o.Ei,{className:"hidden"})]}),(0,s.jsx)("div",{ref:q,className:"flex-1 py-2 px-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"px-4",children:et})}),(0,s.jsxs)("div",{className:"border-t border-t-border px-4 py-2 flex gap-x-2",children:[(0,s.jsx)("span",{className:"text-danger text-xs my-auto",children:"* Required"}),(0,s.jsx)("div",{className:"ml-auto"}),(0,s.jsx)(o.sw,{asChild:!0,children:(0,s.jsx)(x.z,{variant:"ghost",onClick:()=>{},children:"Cancel"})}),(0,s.jsx)(x.z,{onClick:()=>H(),disabled:en(),children:"Save"})]})]})})})]})}},34303:function(e,l,i){"use strict";i.d(l,{x:function(){return d}});var s=i(57437),n=i(2265),t=i(19212),a=i.n(t),r=i(83102);function d(e){let{type:l="date",value:i,disabled:t,min:d,max:o,onChange:c}=e,[{dateString:u},m]=(0,n.useState)({date:null,dateString:"",time:null});return(0,n.useEffect)(()=>{let e=null;if("time"===l){let l=a()().format("YYYY-MM-DD");e=i?new Date("".concat(l," ").concat(i)):null,e=a()(e).isValid()?e:null}else{if(e=i?new Date(i):null,(e=a()(e).isValid()?e:null)&&d){let l=a()(e).format("YYYY-MM-DD"),i=a()(d).format("YYYY-MM-DD");e=new Date(l).getTime()>=new Date(i).getTime()?e:null}if(e&&o){let l=a()(e).format("YYYY-MM-DD"),i=a()(o).format("YYYY-MM-DD");e=new Date(l).getTime()<=new Date(i).getTime()?e:null}}let s=e?a()(e).format("HH:mm:ss"):null;m({date:e,time:s,dateString:e?a()(e).format("YYYY-MM-DD"):""}),c({date:e,time:s})},[i,d,o,l]),(0,s.jsx)(r.I,{value:u,type:"time"===l?"time":"datetime"===l?"datetime-local":"date",min:d?a()(d).format("YYYY-MM-DD"):void 0,max:o?a()(o).format("YYYY-MM-DD"):void 0,disabled:t,onChange:e=>{let i=e.target.value?new Date(e.target.value):null;"time"===l&&(i=e.target.value?new Date:null);let s=i?a()(i).format("HH:mm:ss"):null;m({date:i,dateString:e.target.value,time:s})}})}i(67135);var o=i(37440);function c(e,l){let{max:i,min:s=0,loop:n=!1}=l,t=parseInt(e,10);return isNaN(t)?"00":(n?(t>i&&(t=s),t<s&&(t=i)):(t>i&&(t=i),t<s&&(t=s)),t.toString().padStart(2,"0"))}function u(e){return/^(0[0-9]|1[0-9]|2[0-3])$/.test(e)?e:c(e,{max:23})}function m(e){return/^(0[1-9]|1[0-2])$/.test(e)?e:c(e,{min:1,max:12})}function x(e){return/^[0-5][0-9]$/.test(e)?e:c(e,{max:59})}function h(e,l){let{min:i,max:s,step:n}=l,t=parseInt(e,10);return isNaN(t)?"00":c(String(t+=n),{min:i,max:s,loop:!0})}function p(e,l,i,s){switch(i){case"minutes":return function(e,l){let i=x(l);return e.setMinutes(parseInt(i,10)),e}(e,l);case"seconds":return function(e,l){let i=x(l);return e.setSeconds(parseInt(i,10)),e}(e,l);case"hours":return function(e,l){let i=u(l);return e.setHours(parseInt(i,10)),e}(e,l);case"12hours":if(!s)return e;return function(e,l,i){let s=function(e,l){if("PM"===l){if(e<=11)return e+12}else if("AM"===l&&12===e)return 0;return e}(parseInt(m(l),10),i);return e.setHours(s),e}(e,l,s);default:return e}}n.forwardRef((e,l)=>{let{className:i,type:t="tel",value:a,id:d,name:c,date:y=new Date(new Date().setHours(0,0,0,0)),picker:v,period:g,setDate:f,onChange:j,onKeyDown:b,onLeftFocus:N,onRightFocus:D,...w}=e,[k,I]=n.useState(!1),[C,T]=n.useState("0");n.useEffect(()=>{if(k){let e=setTimeout(()=>{I(!1)},2e3);return()=>clearTimeout(e)}},[k]);let F=n.useMemo(()=>(function(e,l){switch(l){case"minutes":return x(String(e.getMinutes()));case"seconds":return x(String(e.getSeconds()));case"hours":return u(String(e.getHours()));case"12hours":var i;return m(String(0===(i=e.getHours())||12===i?"12":i>=22?"".concat(i-12):i%12>9?"".concat(i):"0".concat(i%12)));default:return"00"}})(y,v),[y,v]),S=e=>"12hours"===v&&k&&"1"===F.slice(1,2)&&"0"===C?"0"+e:k?F.slice(1,2)+e:"0"+e,_=e=>{if("Tab"!==e.key){if(e.preventDefault(),"ArrowRight"===e.key&&(null==D||D()),"ArrowLeft"===e.key&&(null==N||N()),["ArrowUp","ArrowDown"].includes(e.key)){let l=function(e,l,i){switch(i){case"minutes":case"seconds":return h(e,{min:0,max:59,step:l});case"hours":return h(e,{min:0,max:23,step:l});case"12hours":return h(e,{min:1,max:12,step:l});default:return"00"}}(F,"ArrowUp"===e.key?1:-1,v);k&&I(!1),f(p(new Date(y),l,v,g))}if(e.key>="0"&&e.key<="9"){"12hours"===v&&T(e.key);let l=S(e.key);k&&(null==D||D()),I(e=>!e),f(p(new Date(y),l,v,g))}}};return(0,s.jsx)(r.I,{ref:l,id:d||v,name:c||v,noRing:!0,className:(0,o.cn)("w-[48px] text-center font-mono text-base tabular-nums caret-transparent focus:bg-primary/20 [&::-webkit-inner-spin-button]:appearance-none",i),value:a||F,onChange:e=>{e.preventDefault(),null==j||j(e)},type:t,inputMode:"decimal",onKeyDown:e=>{null==b||b(e),_(e)},...w})}).displayName="TimePickerInput"},74421:function(e,l,i){"use strict";i.d(l,{r:function(){return r}});var s=i(57437),n=i(2265),t=i(9646),a=i(37440);let r=n.forwardRef((e,l)=>{let{className:i,...n}=e;return(0,s.jsx)(t.fC,{className:(0,a.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...n,ref:l,children:(0,s.jsx)(t.bU,{className:(0,a.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});r.displayName=t.fC.displayName},74166:function(e,l){"use strict";l.Z=e=>"".concat(e||"").charAt(0).toUpperCase()+"".concat(e||"").slice(1)},78591:function(e,l,i){"use strict";function s(e){let l=[],i=(e||"").split("\n").map(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim()}).map(e=>{let l=e.split(",");return{value:l[0],label:l[1]}}),s=i.map(e=>e.value),n=i.map(e=>e.label),t=i.filter(e=>!e.value||!e.label),a=s.filter((e,l)=>s.indexOf(e)!==l);return(n.filter((e,l)=>n.indexOf(e)!==l).length||a.length)&&l.push("Values contain duplicate data"),t.length&&l.push("Incorrect values format"),l}i.d(l,{s:function(){return s}})}}]);