"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8577],{50773:function(e,a,t){t.d(a,{Alert:function(){return i}});var l=t(98656),n=t(99376),r=t(2265);function i(e){let a=(0,n.useRouter)(),{alert:t}=(0,l.s)();return(0,r.useEffect)(()=>{let{redirectTo:l,onClose:n,...r}=e;t({...r,variant:r.variant||"error",buttonLabel:r.buttonLabel||"Ok",onClose:()=>{null==n||n(),l&&a.replace(l)}})},[t,a,e]),null}},30278:function(e,a,t){t.d(a,{Uv:function(){return r},VO:function(){return n},d4:function(){return l},fR:function(){return s}});let l=[{value:"allSearches",label:"Found in all searches"},{value:"admissionSearches",label:"Found in admission searches"},{value:"twinSearches",label:"Found in twin searches"}],n=[{label:"Days & hours",value:"days_hours"},{label:"Years & Months",value:"years_months"}],r=[{name:"date",label:"Date"},{name:"datetime",label:"Date + Time"},{name:"dropdown",label:"Dropdown"},{name:"multi_select",label:"Multiple choice list"},{name:"number",label:"Number"},{name:"text",label:"Text"},{name:"time",label:"Time"},{name:"period",label:"Time period"}],i={calculation:null,condition:"",confidential:!1,dataType:null,defaultValue:null,format:null,type:null,key:null,refKey:null,label:null,minValue:null,maxValue:null,optional:!1,minDate:null,maxDate:null,minTime:null,maxTime:null,minDateKey:"",maxDateKey:"",minTimeKey:"",maxTimeKey:"",values:"",editable:!1},s={admission:[{...i,type:"dropdown",key:"BabyTransfered",values:"Y,Yes\nN,No",label:"Has the baby been transfered from another facility"},{...i,type:"text",key:"patientNUID",label:"Search patient's NUID",condition:"$BabyTransfered = 'Y'"},{...i,type:"dropdown",key:"BabyTwin",values:"Y,Yes\nN,No",label:"Does the baby have a twin?"},{...i,type:"text",key:"BabyTwinNUID",label:"Search twin's NUID",condition:"$BabyTwin = 'Y'"}],other:[{...i,type:"text",key:"patientNUID",values:"Y,Yes\nN,No",label:"Search patient's NUID"}]}},32405:function(e,a,t){t.d(a,{$7:function(){return o},F4:function(){return b},PU:function(){return i},Tf:function(){return c},UQ:function(){return v},_S:function(){return s},m1:function(){return d},ph:function(){return m},uh:function(){return u},y0:function(){return y}});var l=t(30278),n=t(61281),r=t(10820);let i={headerFormat:"",headerFields:[],footerFields:[],sections:[]},s="Example: ($key = true and $key2 = false) or $key3 = 'HD'",o={fontSize:{},fontWeight:{},fontStyle:{},textColor:{},backgroundColor:{},highlight:{}},u=[{value:"screens",label:"Screens"},{value:"diagnoses",label:"Diagnoses"},{value:"print",label:"Print"}],d=[{label:"Admission",value:"admission"},{label:"Discharge",value:"discharge"},{label:"Neolab",value:"neolab"},{label:"Daily Record",value:"drecord"},{label:"DFF Calculator",value:"dff_calculator"}],c=[{value:"checklist",label:"Checklist"},{value:"form",label:"Form"},{value:"management",label:"Management"},{value:"multi_select",label:"Multiple choice list"},{value:"single_select",label:"Single choice list"},{value:"progress",label:"Progress"},{value:"timer",label:"Timer"},{value:"yesno",label:"Yes/No"},{value:"drugs",label:"Drugs"},{value:"fluids",label:"Fluids"},{value:"zw_edliz_summary_table",label:"EDLIZ summary table (ZW)"},{value:"mwi_edliz_summary_table",label:"EDLIZ summary table (MWI)"},{value:"diagnosis",label:"Diagnosis"}],m=[{value:"risk",label:"Risk factor"},{value:"sign",label:"Sign/Symptom"}];({...c.reduce((e,a)=>{let t=a.value,l=a.value,n=[l,"".concat(l,"_option")];return"single_select"===t&&(n=[...n,"dropdown","dropdown_option"]),{...e,[l]:n}},{}),...l.Uv.reduce((e,a)=>{let t=a.name,l=a.name,n=[l,"".concat(l,"_option")];return"dropdown"===t&&(n=[...n,"single_select","single_select_option"]),{...e,[l]:n}},{})});let y=[{value:"checklist",label:"checklist",hasChildren:!0},{value:"multi_select",label:"multi_select",hasChildren:!0},{value:"single_select",label:"single_select",hasChildren:!0},{value:"yesno",label:"yesno",hasChildren:!1},{value:"zw_edliz_summary_table",label:"zw_edliz_summary_table",hasChildren:!0},{value:"mwi_edliz_summary_table",label:"mwi_edliz_summary_table",hasChildren:!0},{value:"diagnosis",label:"diagnosis",hasChildren:!0},{value:"diagnosis_symptom_sign",label:"diagnosis_symptom_sign",hasChildren:!1},{value:"diagnosis_symptom_risk",label:"diagnosis_symptom_risk",hasChildren:!1},{value:"date",label:"date",hasChildren:!1},{value:"datetime",label:"datetime",hasChildren:!1},{value:"dropdown",label:"dropdown",hasChildren:!0},{value:"number",label:"number",hasChildren:!1},{value:"text",label:"text",hasChildren:!1},{value:"timer",label:"timer",hasChildren:!1},{value:"period",label:"period",hasChildren:!1},{value:"option",label:"option",hasChildren:!1}],b=[{value:"label.asc",label:"Label (asc)",Icon:n.Z},{value:"label.desc",label:"Label (desc)",Icon:r.Z},{value:"key.asc",label:"Key (asc)",Icon:n.Z},{value:"key.desc",label:"Key (desc)",Icon:r.Z},{value:"type.asc",label:"Type (asc)",Icon:n.Z},{value:"type.desc",label:"Type (desc)",Icon:r.Z},{value:"refId.asc",label:"Ref ID (asc)",Icon:n.Z},{value:"refId.desc",label:"Ref ID (desc)",Icon:r.Z},{value:"createdAt.asc",label:"Creation date (asc)",Icon:n.Z},{value:"createdAt.desc",label:"Creation date (desc)",Icon:r.Z},{value:"updatedAt.asc",label:"Update date (asc)",Icon:n.Z},{value:"updatedAt.desc",label:"Update date (desc)",Icon:r.Z}],v=[{label:"Published",value:"published"},{label:"Drafts",value:"drafts"}]},68577:function(e,a,t){t.d(a,{DataKeysCtxProvider:function(){return p},M:function(){return h}});var l=t(57437),n=t(2265),r=t(83464),i=t(12840),s=t(99376),o=t(98656),u=t(50773),d=t(32405),c=t(22381),m=t(67132),y=t(16548);let b=e=>(null==e?void 0:e.name)||(null==e?void 0:e.label)||(null==e?void 0:e.uniqueKey)||"Data key",v=e=>e?{uuid:e.uuid||"",uniqueKey:e.uniqueKey||"",name:e.name||"",refId:e.refId||"",dataType:e.dataType||"",label:e.label||"",options:Array.isArray(e.options)?e.options:[],metadata:e.metadata||{},version:"number"==typeof e.version?e.version:Number(e.version||0)||0}:null,f=(0,n.createContext)(null),h=()=>{let e=(0,n.useContext)(f);if(!e)throw Error("useChart must be used within a <DataKeysCtxProvider />");return e};function p(e){let{children:a,prefetchDataKeys:t=!0}=e,h=(0,n.useRef)(!1),p=(0,s.useRouter)(),{alert:k}=(0,o.s)(),{authenticatedUser:D}=(0,m.b)(),[w,_]=(0,i.v1)("uuid",{clearOnDefault:!0,shallow:!0,history:"push",defaultValue:""}),[C,S]=(0,n.useState)([]),[I,T]=(0,n.useState)(d.F4[0].value),[x,K]=(0,n.useState)(""),[N,A]=(0,n.useState)(""),[E,Z]=(0,n.useState)(1),[F]=(0,n.useState)(100),[L,U]=(0,n.useState)(!1),[z,M]=(0,n.useState)([]),[Y,q]=(0,n.useState)(),P=(0,n.useCallback)(async e=>{U(!0);try{var a,t,l;let n=new URLSearchParams;(null==e?void 0:null===(a=e.names)||void 0===a?void 0:a.length)&&n.set("names",JSON.stringify(e.names)),(null==e?void 0:null===(t=e.uniqueKeys)||void 0===t?void 0:t.length)&&n.set("uniqueKeys",JSON.stringify(e.uniqueKeys)),(null==e?void 0:null===(l=e.dataKeysIds)||void 0===l?void 0:l.length)&&n.set("dataKeysIds",JSON.stringify(e.dataKeysIds));let i=await r.Z.get("/api/data-keys?".concat(n.toString())),s=g(i.data.data,I);M(s),q(i.data.errors),Z(1)}catch(e){M([]),q([e.message])}finally{U(!1)}},[I]),R=(0,n.useMemo)(()=>{let e=[...z];if(x&&(e="published"===x?e.filter(e=>!(null==e?void 0:e.isDraft)):"draft"===x?e.filter(e=>!!(null==e?void 0:e.isDraft)):e.filter(e=>(null==e?void 0:e.dataType)===x)),N){let{normalizedValue:a,isExactMatch:t}=(0,y.l)(N);a&&(e=e.filter(e=>[e.name||"",e.label||""].map(e=>e.toLowerCase()).some(e=>t?e===a:e.includes(a))))}return e},[z,x,N]),{dataKeys:O,pagination:$}=(0,n.useMemo)(()=>{if(!R.length)return{dataKeys:[],pagination:void 0};let e=function(e,a,t){let l=e.length,n=(a-1)*t;return{data:e.slice(n,n+t),pagination:{page:a,limit:t,total:l,totalPages:Math.ceil(l/t)}}}(R,E,F);return{dataKeys:e.data,pagination:e.pagination}},[R,E,F]);(0,n.useEffect)(()=>{!h.current&&(h.current=!0,t&&P())},[t,P]),(0,n.useEffect)(()=>{Z(1),S([])},[x,N]),(0,n.useEffect)(()=>{h.current&&z.length>0&&(M(g([...z],I)),Z(1),S([]))},[I]);let[V,j]=(0,n.useState)(!1),B=(0,n.useCallback)(async(e,a)=>{try{var t;j(!0);let l=e.map(e=>({...e,version:"string"==typeof e.version?Number(e.version):e.version})),n=(await r.Z.post("/api/data-keys/save",{data:l,broadcastAction:!0})).data;(null===(t=n.errors)||void 0===t?void 0:t.length)?k({title:"Error",message:n.errors.join(", "),variant:"error"}):(await P(),p.refresh(),k({message:"Data key saved!",variant:"success",onClose:()=>null==a?void 0:a()}))}catch(e){k({title:"Error",message:"Failed to save data key: "+e.message,onClose:()=>null==a?void 0:a(e.message)})}finally{j(!1)}},[k,p.refresh,P]),[J,W]=(0,n.useState)(!1),H=(0,n.useCallback)(async e=>{if(!e.length)return;let a=null==D?void 0:D.userId,t=null==D?void 0:D.displayName;for(let l of e){if(!(null==l?void 0:l.uuid))continue;let e=v(l);if(!e)continue;let n=b(l);await (0,c.KL)({entityId:l.uuid,entityType:"dataKey",entityTitle:n,snapshot:e,userId:a,userName:t,description:'Marked "'.concat(n,'" for deletion')})}},[null==D?void 0:D.userId,null==D?void 0:D.displayName]),Q=(0,n.useCallback)(async e=>{let a=z.filter(a=>(null==a?void 0:a.uuid)&&e.includes(a.uuid));try{var t;W(!0);let l=(await r.Z.delete("/api/data-keys?data="+JSON.stringify({dataKeysIds:e,broadcastAction:!0}))).data;if(null===(t=l.errors)||void 0===t?void 0:t.length)throw Error(l.errors[0]);await H(a),S([]),await P(),p.refresh(),k({title:"Success",message:"Data keys deleted successfully!",variant:"success"})}catch(e){k({title:"Error",message:e.message,variant:"error"})}finally{W(!1)}},[p.refresh,k,P,z,H]),[G,X]=(0,n.useState)(!1),ee=(0,n.useCallback)(async e=>{try{var a;X(!0);let t=(await r.Z.post("/api/data-keys/export",e)).data;if(null===(a=t.errors)||void 0===a?void 0:a.length)throw Error(t.errors[0]);await P(),S([]),k({title:"Success",message:"Data exported successfully!",variant:"success"})}catch(e){k({title:"Error",message:e.message,variant:"error"})}finally{X(!1)}},[P,k]),ea=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.F4[0].value;T(e),S([]),Z(1)},[]),et=(0,n.useCallback)((e,a)=>{let t=e.map(e=>z.find(a=>a.uniqueKey===e||a.uuid===e)).filter(e=>e);return(null==a?void 0:a.withNested)&&t.filter(e=>e.options.length).forEach(e=>{let l=et(e.options,a);t=[...t,...l]}),t.filter((e,a)=>t.map(e=>e.uniqueKey).indexOf(e.uniqueKey)===a)},[z]);return(null==Y?void 0:Y.length)?(0,l.jsx)(u.Alert,{title:"Error",message:"Failed to load data keys: "+Y.join(", "),buttonLabel:"Try again",onClose:()=>P()}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(f.Provider,{value:{loadingDataKeys:L,saving:V,exporting:G,deleting:J,dataKeys:O,allDataKeys:z,errors:Y,selected:C,currentDataKeyUuid:w,sort:I,filter:x,searchValue:N,pagination:$,currentPage:E,itemsPerPage:F,setCurrentPage:Z,setSearchValue:A,extractDataKeys:et,deleteDataKeys:Q,saveDataKeys:B,exportDataKeys:ee,setCurrentDataKeyUuid:_,loadDataKeys:P,setSelected:S,setSort:T,onSort:ea,setFilter:K},children:a})})}function g(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.F4[0].value,t=[...e],l=e=>{let{key1:a,key2:t,sortDirection:l}=e;a=(a||"").trim().toLowerCase(),t=(t||"").trim().toLowerCase();let n=0;return"asc"===l?(a<t&&(n=-1),a>t&&(n=1)):(a>t&&(n=-1),a<t&&(n=1)),n};switch(a){case"refId.asc":t=e.sort((e,a)=>l({sortDirection:"asc",key1:(e.refId||"").trim(),key2:(a.refId||"").trim()}));break;case"refId.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:(e.refId||"").trim(),key2:(a.refId||"").trim()}));break;case"key.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:e.name,key2:a.name}));break;case"label.asc":t=e.sort((e,a)=>l({sortDirection:"asc",key1:(e.label||e.name||"").trim(),key2:(a.label||a.name||"").trim()}));break;case"label.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:(e.label||e.name||"").trim(),key2:(a.label||a.name||"").trim()}));break;case"type.asc":t=e.sort((e,a)=>l({sortDirection:"asc",key1:(e.dataType||"").trim(),key2:(a.dataType||"").trim()}));break;case"type.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:(e.dataType||"").trim(),key2:(a.dataType||"").trim()}));break;case"createdAt.asc":t=e.sort((e,a)=>l({sortDirection:"asc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(a.createdAt||"").getTime().toString()}));break;case"createdAt.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(a.createdAt||"").getTime().toString()}));break;case"updatedAt.asc":t=e.sort((e,a)=>l({sortDirection:"asc",key1:new Date(e.updatedAt||"").getTime().toString(),key2:new Date(a.updatedAt||"").getTime().toString()}));break;case"updatedAt.desc":t=e.sort((e,a)=>l({sortDirection:"desc",key1:new Date(e.updatedAt||"").getTime().toString(),key2:new Date(a.updatedAt||"").getTime().toString()}));break;default:t=e.sort((e,a)=>l({sortDirection:"asc",key1:e.name,key2:a.name}))}return t}},16548:function(e,a,t){t.d(a,{l:function(){return i},y:function(){return r}});let l=['"',"'","“","‘"],n=['"',"'","”","’"];function r(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(e){let a="".concat(null!=e?e:"").trim();if(!a)return{normalizedValue:"",isExactMatch:!1};let t=l.includes(a[0]),r=n.includes(a[a.length-1]),i=a.length>1&&t&&r,s=i?a.slice(1,-1):a;return{normalizedValue:i?s.trim():s.trim().toLowerCase(),isExactMatch:i}}}}]);