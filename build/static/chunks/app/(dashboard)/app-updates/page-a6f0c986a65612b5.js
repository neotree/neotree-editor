(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[593],{86174:function(e,t,r){Promise.resolve().then(r.bind(r,84416)),Promise.resolve().then(r.bind(r,89884))},84416:function(e,t,r){"use strict";r.d(t,{AppUpdatesClient:function(){return o}});var s=r(57437),a=r(2265),n=r(99376),l=r(62869),i=r(66070),d=r(12339),c=r(67132);function o(e){var t,r;let{policy:o,policyDrafts:u,apkReleases:m,apkReleaseDrafts:p,otaEvents:f}=e,x=(0,n.useRouter)(),{viewOnly:h,mode:v}=(0,c.b)(),[N,g]=(0,a.useState)("apk"),j=(0,a.useMemo)(()=>u.length?[...u].sort((e,t)=>{let r=new Date(e.updatedAt||e.createdAt||0).getTime();return new Date(t.updatedAt||t.createdAt||0).getTime()-r})[0]:null,[u]),y=(0,a.useMemo)(()=>{let e=new Map;for(let t of p){let r=t.data||{},s=r.apkReleaseId||t.apkReleaseDraftId;s&&e.set(s,{...r,apkReleaseId:s,__draft:!0,__draftId:t.apkReleaseDraftId,__updatedAt:t.updatedAt||t.createdAt})}for(let t of m){let r=t.apkReleaseId;r&&(e.has(r)||e.set(r,{...t,__draft:!1}))}return Array.from(e.values()).sort((e,t)=>{let r=new Date(e.__updatedAt||e.updatedAt||e.createdAt||0).getTime();return new Date(t.__updatedAt||t.updatedAt||t.createdAt||0).getTime()-r})},[p,m]),b=(0,a.useMemo)(()=>[...f].filter(e=>"ota_update_applied"===e.eventType).sort((e,t)=>{let r=new Date(e.createdAt||0).getTime();return new Date(t.createdAt||0).getTime()-r}),[f]),w=(0,a.useCallback)(e=>{let t=e.apkReleaseId||e.apkReleaseDraftId;t&&x.push("/app-updates/new-apk?apkReleaseId=".concat(t))},[x]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Zb,{className:"mb-4",children:(0,s.jsx)(i.aY,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Recommended release flow"}),(0,s.jsxs)("div",{className:"text-sm",children:["1) Upload APK and save a draft ","->"," 2) Mark it available ","->"," 3) Update policy to point to the release"]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:j?"Policy draft updated ".concat((null===(r=j.updatedAt)||void 0===r?void 0:null===(t=r.toString)||void 0===t?void 0:t.call(r))||""):o?"Published policy is live":"No policy yet"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:h?"View mode: edits disabled":"development"===v?"Development mode: drafts enabled":"Mode: ".concat(v)})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.z,{variant:"primary-outline",onClick:()=>x.push("/app-updates/new-apk"),disabled:h,children:"New APK Release"}),(0,s.jsx)(l.z,{onClick:()=>x.push("/app-updates/new-policy"),children:h?"View Policy":"New Policy"})]})]})})}),(0,s.jsxs)(d.mQ,{value:N,onValueChange:g,className:"w-full",children:[(0,s.jsxs)(d.dr,{className:"w-full",children:[(0,s.jsx)(d.SP,{value:"apk",className:"flex-1",children:"APK Updates"}),(0,s.jsx)(d.SP,{value:"ota",className:"flex-1",children:"OTA Updates"})]}),(0,s.jsx)(d.nU,{value:"apk",className:"mt-4",children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,s.jsx)(i.Zb,{children:(0,s.jsxs)(i.aY,{className:"p-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"APK releases"})}),(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left border-b",children:[(0,s.jsx)("th",{className:"py-2 pr-4",children:"Version"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Runtime"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Status"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Available"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Draft"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"File"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Updated"}),(0,s.jsx)("th",{className:"py-2 pr-4"})]})}),(0,s.jsx)("tbody",{children:y.map(e=>{var t,r,a,n;return(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsxs)("td",{className:"py-2 pr-4",children:[e.versionName," (",e.versionCode,")"]}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.runtimeVersion}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.status}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.isAvailable?"Yes":"No"}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.__draft?"Draft":"Published"}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.fileId||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:(null===(r=e.__updatedAt)||void 0===r?void 0:null===(t=r.toString)||void 0===t?void 0:t.call(r))||(null===(n=e.updatedAt)||void 0===n?void 0:null===(a=n.toString)||void 0===a?void 0:a.call(n))||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:(0,s.jsx)(l.z,{variant:"ghost",onClick:()=>w(e),children:h?"View":"Edit"})})]},e.apkReleaseId)})})]}),y.length?null:(0,s.jsx)("div",{className:"text-muted-foreground text-sm",children:"No releases found."})]})]})})})}),(0,s.jsx)(d.nU,{value:"ota",className:"mt-4",children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,s.jsx)(i.Zb,{children:(0,s.jsxs)(i.aY,{className:"p-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"OTA updates applied (device acknowledgements)"})}),(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left border-b",children:[(0,s.jsx)("th",{className:"py-2 pr-4",children:"Device"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"App Version"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Runtime"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"OTA Update ID"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Channel"}),(0,s.jsx)("th",{className:"py-2 pr-4",children:"Received"})]})}),(0,s.jsx)("tbody",{children:b.map(e=>{var t,r;return(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"py-2 pr-4",children:e.deviceId}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.appVersion||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.runtimeVersion||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.otaUpdateId||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:e.otaChannel||""}),(0,s.jsx)("td",{className:"py-2 pr-4",children:(null===(r=e.createdAt)||void 0===r?void 0:null===(t=r.toString)||void 0===t?void 0:t.call(r))||""})]},e.eventId)})})]}),b.length?null:(0,s.jsx)("div",{className:"text-muted-foreground text-sm",children:"No OTA acknowledgements yet."})]})]})})})})]})]})}},19820:function(e,t,r){"use strict";r.d(t,{SocketEventsListener:function(){return l}});var s=r(2265),a=r(99376),n=r(62265);function l(e){let{events:t}=e,r=(0,s.useRef)({eventsTimeouts:{},eventsTimestamps:{}});(0,s.useRef)(new Date().getTime());let l=(0,a.useRouter)();return(0,s.useEffect)(()=>{t.forEach(e=>{let{name:t,action:s,delay:a=100,onEvent:i}=e;n.Z.on(t,function(){for(var e=arguments.length,n=Array(e),d=0;d<e;d++)n[d]=arguments[d];let c=()=>{var e,r;(!s||n[0]===s)&&(null===(e=i.callback)||void 0===e||e.call(i,...n),(null==i?void 0:i.refreshRouter)&&(console.log(t,"refreshing..."),l.refresh()),(null===(r=i.redirect)||void 0===r?void 0:r.to)&&(i.redirect.replace?l.replace(i.redirect.to):l.push(i.redirect.to)))},o=new Date().getTime();a?(clearTimeout(r.current.eventsTimeouts[t]),r.current.eventsTimeouts[t]=setTimeout(()=>{r.current.eventsTimestamps[t]=o,c()},a)):(r.current.eventsTimestamps[t]=new Date().getTime(),c())})})},[t,l]),null}},89884:function(e,t,r){"use strict";r.d(t,{Title:function(){return n}});var s=r(2265),a=r(40257);function n(e){let{children:t}=e;return(0,s.useEffect)(()=>{document.title=[a.env.NEXT_PUBLIC_APP_NAME||"",t||""].filter(e=>e).join(" - ")},[t]),(0,s.useEffect)(()=>()=>{document.title="".concat(a.env.NEXT_PUBLIC_APP_NAME||"")},[]),null}},62869:function(e,t,r){"use strict";r.d(t,{d:function(){return d},z:function(){return c}});var s=r(57437),a=r(2265),n=r(37053),l=r(90535),i=r(94508);let d=(0,l.j)("\n    inline-flex\n    items-center\n    justify-center\n    whitespace-nowrap\n    rounded-md\n    text-sm\n    font-medium\n    transition-colors\n    focus-visible:outline-none\n    disabled:pointer-events-none\n    disabled:opacity-50\n  ",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border border-input bg-background hover:bg-primary/20","primary-outline":"border border-primary text-primary bg-transparent hover:bg-primary/20",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/90",ghost:"hover:bg-primary/20 hover:text-primary",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:l,asChild:c=!1,...o}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,i.cn)(d({variant:a,size:l,className:r})),ref:t,...o})});c.displayName="Button"},66070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var s=r(57437),a=r(2265),n=r(94508);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});l.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},12339:function(e,t,r){"use strict";r.d(t,{SP:function(){return c},dr:function(){return d},mQ:function(){return i},nU:function(){return o}});var s=r(57437),a=r(2265),n=r(20271),l=r(94508);let i=n.fC,d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});d.displayName=n.aV.displayName;let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});c.displayName=n.xz.displayName;let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});o.displayName=n.VY.displayName},67132:function(e,t,r){"use strict";r.d(t,{AppContextProvider:function(){return v},b:function(){return h}});var s=r(57437),a=r(2265),n=r(25922),l=r(99376),i=r(6760),d=r(64131);let c=d.Z.get,o=d.Z.set;d.Z.remove;var u={get:c,set:o};function m(){let e=u.get("mode");return e||(e="view",u.set("mode",e,{expires:31536e7})),e}var p=r(62265),f=r(19820);let x=(0,a.createContext)(null),h=()=>(0,a.useContext)(x);function v(e){let{children:t,...r}=e,d=function(e){(0,l.useRouter)();let{isAdmin:t,isSuperUser:r,sys:s}=e,{setTheme:i}=(0,n.F)();(0,a.useEffect)(()=>{"yes"===s.data.hide_theme_toggle&&i("light")},[s]);let d=(0,a.useCallback)(()=>(t||r?m():"view")||"view",[r,t]),[c,o]=(0,a.useState)(d()),f=!t&&!r||"view"===c,x=(0,a.useCallback)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let s=function(e){return u.set("mode",e,{expires:31536e7}),m()}(...t);return p.Z.emit("mode_changed",d()),o(d()),s},[d]),h=(0,a.useCallback)(()=>{o(d())},[d]);return{...e,mode:c,viewOnly:f,onModeChange:h,getMode:m,setMode:x}}(r),[c,o]=(0,a.useState)(!1);return((0,i.Z)(()=>{o(!0)}),c)?(0,s.jsxs)(x.Provider,{value:d,children:[t,(0,s.jsx)(f.SocketEventsListener,{events:[{name:"mode_changed",onEvent:{callback:d.onModeChange}}]})]}):null}},62265:function(e,t,r){"use strict";var s=r(68680),a=r(40257);let n=(0,s.io)(a.env.NEXT_PUBLIC_APP_URL);t.Z=n},94508:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(61994),a=r(53335);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[6137,2696,3186,3238,9480,7478,2117,1744],function(){return e(e.s=86174)}),_N_E=e.O()}]);