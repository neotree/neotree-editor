(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6948],{76052:function(e,t,a){Promise.resolve().then(a.bind(a,42010)),Promise.resolve().then(a.bind(a,25704))},42010:function(e,t,a){"use strict";a.d(t,{DataKeysTable:function(){return P}});var s=a(57437),r=a(2265),l=a(45188),n=a(92513),i=a(87138),c=a(16463),d=a(12491),o=a(90399),u=a(38472),h=a(17501),x=a(39661),y=a(46910),m=a(76942),f=a(50495),v=a(64344),p=a(78030);/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,p.Z)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),j=(0,p.Z)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);var k=a(46294);let b=[{value:"label.asc",label:"Label (asc)",Icon:g},{value:"label.desc",label:"Label (desc)",Icon:j},{value:"key.asc",label:"Key (asc)",Icon:g},{value:"key.desc",label:"Key (desc)",Icon:j},{value:"type.asc",label:"Type (asc)",Icon:g},{value:"type.desc",label:"Type (desc)",Icon:j},{value:"createdAt.asc",label:"Date (asc)",Icon:g},{value:"createdAt.desc",label:"Date (desc)",Icon:j}],w=b[0].value,N=e=>{let{key1:t,key2:a,sortDirection:s}=e;t=(t||"").trim().toLowerCase(),a=(a||"").trim().toLowerCase();let r=0;return"asc"===s?(t<a&&(r=-1),t>a&&(r=1)):(t>a&&(r=-1),t<a&&(r=1)),r},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,a=[...e];switch(t){case"key.desc":a=e.sort((e,t)=>N({sortDirection:"desc",key1:e.name,key2:t.name}));break;case"label.asc":a=e.sort((e,t)=>N({sortDirection:"asc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"label.desc":a=e.sort((e,t)=>N({sortDirection:"desc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"type.asc":a=e.sort((e,t)=>N({sortDirection:"asc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"type.desc":a=e.sort((e,t)=>N({sortDirection:"desc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"createdAt.asc":a=e.sort((e,t)=>N({sortDirection:"asc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;case"createdAt.desc":a=e.sort((e,t)=>N({sortDirection:"desc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;default:a=e.sort((e,t)=>N({sortDirection:"asc",key1:e.name,key2:t.name}))}return a},D=e=>{var t;return(null===(t=b.find(t=>t.value===e))||void 0===t?void 0:t.value)||w};function E(e){let{dataKeys:t,value:a,onSort:l}=e,[n,i]=(0,r.useState)(D(a)),c=(0,r.useCallback)(e=>{i(e),l(S(t,e),e)},[t,l]);return(0,r.useEffect)(()=>{i(D(a))},[a]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(k.Ph,{value:n,onValueChange:e=>c(e),children:[(0,s.jsx)(k.i4,{children:(0,s.jsx)(k.ki,{placeholder:"Sort"})}),(0,s.jsx)(k.Bw,{children:b.map(e=>(0,s.jsx)(k.Ql,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2 w-[120px]",children:[(0,s.jsx)(e.Icon,{className:"size-4"}),(0,s.jsx)("span",{children:e.label})]})},e.value))})]})})}var K=a(59636),C=a(17647),Z=a(37440),I=a(76230),M=a(53699),T=a(27006),A=a(58184),V=a(39343),z=a(53853),F=a(67135),O=a(86466),_=a(90837);function L(e){var t;let{uuids:a}=e,[l,n]=(0,r.useState)(!1),[i,c]=(0,r.useState)(!1),{alert:d}=(0,M.s)(),{sites:o,loading:h,loadSites:y}=(0,z.k)({loadOnMount:!1,onLoadSitesError:()=>n(!1)}),{formState:{errors:m},reset:v,watch:p,setValue:g,register:j,handleSubmit:b,setError:w}=(0,V.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),N=p("siteId"),S=p("overwriteExisting"),D=i||h,E=!!N&&!D,K=b(async e=>{try{var t;if(e.siteId||w("siteId",{message:"Site is required"}),!E)return;c(!0);let s=(await u.Z.post("/api/data-keys/export",{...e,uuids:a})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));d({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>n(!1)})}catch(e){d({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{c(!1)}});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(_.Vq,{open:l,onOpenChange:e=>{v(),e&&y(),n(e)},children:[(0,s.jsx)(_.hg,{asChild:!0,children:(0,s.jsxs)(f.z,{className:"h-auto w-auto",children:[(0,s.jsx)(A.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:a.length>1?"Export ".concat(a.length):"Export"})]})}),(0,s.jsxs)(_.cZ,{children:[(0,s.jsxs)(_.fK,{children:[(0,s.jsx)(_.$N,{children:"Export"}),(0,s.jsx)(_.Be,{className:"hidden",children:""})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F._,{htmlFor:"siteId",children:"Site *"}),(0,s.jsxs)(k.Ph,{name:"siteId",onValueChange:e=>g("siteId",e,{shouldDirty:!0}),children:[(0,s.jsx)(k.i4,{children:(0,s.jsx)(k.ki,{placeholder:"Select site"})}),(0,s.jsx)(k.Bw,{children:(0,s.jsxs)(k.DI,{children:[(0,s.jsx)(k.n5,{children:"Sites"}),o.map(e=>{let{siteId:t,name:a}=e;return(0,s.jsx)(k.Ql,{value:t,children:a},t)})]})})]}),!!(null===(t=m.siteId)||void 0===t?void 0:t.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:m.siteId.message})]}),(0,s.jsxs)("div",{className:(0,Z.cn)("flex gap-x-2"),children:[(0,s.jsx)(O.X,{name:"overwriteExisting",id:"overwriteExisting",checked:S,onCheckedChange:()=>g("overwriteExisting",!S,{shouldDirty:!0})}),(0,s.jsx)(F._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,s.jsxs)(_.cN,{children:[(0,s.jsx)(_.GG,{asChild:!0,children:(0,s.jsx)(f.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsxs)(f.z,{onClick:K,disabled:!E,children:[(0,s.jsx)(A.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),D&&(0,s.jsx)(x.a,{overlay:!0})]})}function P(e){let t=(0,c.useRouter)(),[a,p]=(0,r.useState)(!1),[g,j]=(0,r.useState)([]),k=(0,c.useSearchParams)(),b=(0,r.useMemo)(()=>d.Z.parse(k.toString()),[k]),N=b.sort||w,[D,A]=(0,r.useState)(!1),{viewOnly:V}=(0,C.b)(),[z,F]=(0,r.useState)({sortValue:N,filter:K.l1,dataKeys:e.dataKeys}),[O,_]=(0,r.useState)(!1),[P,R]=(0,r.useState)(null);(0,r.useEffect)(()=>{j([])},[z]),(0,r.useEffect)(()=>{F(t=>{let a=S(e.dataKeys,t.sortValue);return a=(0,K.yE)(a,t.filter),{...t,dataKeys:a}})},[e.dataKeys]);let{confirm:q}=(0,I.t)(),{alert:W}=(0,M.s)(),B=(0,r.useCallback)(async e=>{try{var a;p(!0);let s=(await u.Z.delete("/api/data-keys?data="+JSON.stringify({dataKeysIds:e.map(e=>e.uuid),broadcastAction:!0}))).data;if(null===(a=s.errors)||void 0===a?void 0:a.length)throw Error(s.errors[0]);let r=e.reduce((e,t)=>[...e,...t.children.map(e=>({...e,parentKeys:e.parentKeys.filter(e=>e!=t.name)}))],[]);r.length&&await u.Z.post("/api/data-keys/save",{data:r,broadcastAction:!0}),j([]),t.refresh(),W({title:"Success",message:"Scripts deleted successfully!",variant:"success"})}catch(e){W({title:"Error",message:e.message,variant:"error"})}finally{p(!1)}},[t.refresh,W,q]),X=e.disabled||V,G={selectedIndexes:g,selectable:!X,sortable:!1,loading:!1,maxRows:void 0,onSelect:j,onSort:()=>{},noDataMessage:(0,s.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,s.jsx)("div",{children:"No data keys saved."})}),getRowOptions(e){let{rowIndex:t}=e,a=z.dataKeys[t];return a?{className:(0,Z.cn)(!V&&a.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Key"},{name:"Label"},{name:"Data type"},{name:"",align:"right",cellClassName:(0,Z.cn)("w-10"),cellRenderer(t){let{rowIndex:a}=t,r=z.dataKeys[a];if(!r)return null;let n=e.dataKeys.filter(e=>e.parentKeys.includes(r.name));return(0,s.jsx)("div",{children:(0,s.jsxs)(y.h_,{children:[(0,s.jsx)(y.$F,{children:(0,s.jsx)(l.Z,{className:"size-4"})}),(0,s.jsxs)(y.AW,{children:[(0,s.jsx)(y.Xi,{asChild:!0,children:(0,s.jsx)(i.default,{href:"/data-keys/key/".concat(r.uuid),children:X?"View":"Edit"})}),(0,s.jsx)(y.Xi,{className:"text-destructive w-full hover:bg-destructive hover:text-destructive-foreground gap-x-2",onClick:()=>setTimeout(()=>{q(()=>B([{...r,children:n}]),{title:"Delete data key",message:"Are you sure you want to delete data key: <b>".concat(r.name,"</b>?"),danger:!0,positiveLabel:"Yes"})},0),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"text-destructive size-4"}),"Delete"]})})]})]})})}}],data:z.dataKeys.map(e=>[(e.name||"").trim(),(e.label||e.name||"").trim(),(e.dataType||"").trim(),""])},H=(0,r.useCallback)(e=>{let t=e.map(e=>e.uuid);return t.filter((e,a)=>t.indexOf(e)===a)},[z.dataKeys]);return(0,s.jsxs)(s.Fragment,{children:[a&&(0,s.jsx)(x.a,{overlay:!0}),!!g.length&&(0,s.jsxs)(h.h,{children:[(0,s.jsx)(L,{uuids:H(z.dataKeys.filter((e,t)=>g.includes(t)))}),(0,s.jsxs)(f.z,{variant:"destructive",className:"h-auto w-auto",onClick:()=>{let t=z.dataKeys.filter((e,t)=>g.includes(t)).map(e=>({...e,children:[]}));t.length&&(t=t.map(a=>{let s=e.dataKeys.filter(e=>e.parentKeys.includes(e.name)).filter(e=>!t.map(e=>e.name).includes(e.name));return{...a,children:s}}),q(()=>B(t),{title:"Delete data key",message:"Are you sure you want to delete selected key".concat(t.length>1?"s":""," (").concat(t.length,")?"),danger:!0,positiveLabel:"Yes"}))},children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:g.length>1?"Delete ".concat(g.length):"Delete"})]})]}),(0,s.jsx)(T.DataKeyForm,{...e,modal:!0,item:P||void 0,open:O||!!P,onOpenChange:()=>{_(!1),R(null)}}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:flex-wrap py-6 px-4 gap-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h1",{className:"text-2xl",children:"Data keys"})}),(0,s.jsxs)("div",{className:"sm:ml-auto flex flex-col sm:flex-row gap-2",children:[(0,s.jsx)(E,{value:N,dataKeys:z.dataKeys,onSort:(e,a)=>{A(!0),F(t=>({...t,dataKeys:e,sortValue:a})),setTimeout(()=>A(!1),0),t.push("/data-keys?"+d.Z.stringify({...b,sort:a}))}}),(0,s.jsx)(K.Ed,{dataKeys:e.dataKeys,onFilter:(e,t)=>{A(!0),F(a=>(e=S(e,a.sortValue),{...a,dataKeys:e,filter:t})),setTimeout(()=>A(!1),0)}}),X?null:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(f.z,{asChild:!0,variant:"ghost",children:(0,s.jsxs)(i.default,{href:"/data-keys/add",children:[(0,s.jsx)(n.Z,{className:"size-4"}),"Add"]})})})]})]}),(0,s.jsx)(v.Z,{}),(0,s.jsx)(m.DataTable,{...G})]})]})}},17501:function(e,t,a){"use strict";a.d(t,{h:function(){return n}});var s=a(57437),r=a(77606),l=a(37440);function n(e){let{children:t,className:a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-16"}),(0,s.jsx)("div",{className:(0,l.cn)("\n                        fixed \n                        left-0 \n                        bottom-0 \n                        h-16 \n                        w-full \n                        border-t \n                        border-t-border \n                        z-[1] \n                        bg-primary-foreground \n                        dark:bg-background \n                        shadow-md \n                        dark:shadow-foreground/10\n                    "),children:(0,s.jsx)(r.V,{children:(0,s.jsx)("div",{className:(0,l.cn)("flex justify-end gap-x-4",a),children:t})})})]})}},77606:function(e,t,a){"use strict";a.d(t,{V:function(){return l}});var s=a(57437),r=a(37440);function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{...a,className:(0,r.cn)("w-full max-w-screen-xl mx-auto p-5",t)})}},64344:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(57437),r=a(2265),l=a(48484),n=a(37440);let i=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:i=!0,...c}=e;return(0,s.jsx)(l.f,{ref:t,decorative:i,orientation:r,className:(0,n.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...c})});i.displayName=l.f.displayName},53853:function(e,t,a){"use strict";a.d(t,{k:function(){return i}});var s=a(2265),r=a(38472),l=a(17647),n=a(53699);function i(e){let{loadOnMount:t=!0,onLoadSitesError:a}={...e},[i,c]=(0,s.useState)(!1),{alert:d}=(0,n.s)(),{getSites:o}=(0,l.b)(),[u,h]=(0,s.useState)([]),x=(0,s.useCallback)(async()=>{try{var e;c(!0);let t=(await r.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));h(t.data||[])}catch(e){d({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==a?void 0:a()})}finally{c(!1)}},[o,d,a]);return(0,s.useEffect)(()=>{t&&!u.length&&x()},[u,t,x]),{loading:i,sites:u,loadSites:x}}},45188:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(78030).Z)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},92513:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(78030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},90399:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(78030).Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]])},58184:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(78030).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},48484:function(e,t,a){"use strict";a.d(t,{f:function(){return d}});var s=a(2265),r=a(25171),l=a(57437),n="horizontal",i=["horizontal","vertical"],c=s.forwardRef((e,t)=>{let{decorative:a,orientation:s=n,...c}=e,d=i.includes(s)?s:n;return(0,l.jsx)(r.WV.div,{"data-orientation":d,...a?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...c,ref:t})});c.displayName="Separator";var d=c}},function(e){e.O(0,[4868,6834,6746,1441,9527,6801,1377,231,7776,8472,1565,323,8482,2860,6942,2424,7478,7023,1744],function(){return e(e.s=76052)}),_N_E=e.O()}]);