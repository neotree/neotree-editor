(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6948],{1476:function(e,a,t){Promise.resolve().then(t.bind(t,58247)),Promise.resolve().then(t.bind(t,25704))},58247:function(e,a,t){"use strict";t.d(a,{DataKeysTable:function(){return O}});var s=t(57437),r=t(2265),l=t(45188),n=t(92513),c=t(87138),i=t(16463),d=t(12491),o=t(90399),u=t(38472),m=t(17501),y=t(39661),h=t(46910),f=t(76942),x=t(50495),g=t(64344),p=t(30139),v=t(28680),k=t(46294);let b=[{value:"label.asc",label:"Label (asc)",Icon:p.Z},{value:"label.desc",label:"Label (desc)",Icon:v.Z},{value:"key.asc",label:"Key (asc)",Icon:p.Z},{value:"key.desc",label:"Key (desc)",Icon:v.Z},{value:"type.asc",label:"Type (asc)",Icon:p.Z},{value:"type.desc",label:"Type (desc)",Icon:v.Z},{value:"createdAt.asc",label:"Date (asc)",Icon:p.Z},{value:"createdAt.desc",label:"Date (desc)",Icon:v.Z}],j=b[0].value,w=e=>{let{key1:a,key2:t,sortDirection:s}=e;a=(a||"").trim().toLowerCase(),t=(t||"").trim().toLowerCase();let r=0;return"asc"===s?(a<t&&(r=-1),a>t&&(r=1)):(a>t&&(r=-1),a<t&&(r=1)),r},N=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j,t=[...e];switch(a){case"key.desc":t=e.sort((e,a)=>w({sortDirection:"desc",key1:e.name,key2:a.name}));break;case"label.asc":t=e.sort((e,a)=>w({sortDirection:"asc",key1:(e.label||e.name||"").trim(),key2:(a.label||a.name||"").trim()}));break;case"label.desc":t=e.sort((e,a)=>w({sortDirection:"desc",key1:(e.label||e.name||"").trim(),key2:(a.label||a.name||"").trim()}));break;case"type.asc":t=e.sort((e,a)=>w({sortDirection:"asc",key1:(e.dataType||"").trim(),key2:(a.dataType||"").trim()}));break;case"type.desc":t=e.sort((e,a)=>w({sortDirection:"desc",key1:(e.dataType||"").trim(),key2:(a.dataType||"").trim()}));break;case"createdAt.asc":t=e.sort((e,a)=>w({sortDirection:"asc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(a.createdAt||"").getTime().toString()}));break;case"createdAt.desc":t=e.sort((e,a)=>w({sortDirection:"desc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(a.createdAt||"").getTime().toString()}));break;default:t=e.sort((e,a)=>w({sortDirection:"asc",key1:e.name,key2:a.name}))}return t},S=e=>{var a;return(null===(a=b.find(a=>a.value===e))||void 0===a?void 0:a.value)||j};function D(e){let{dataKeys:a,value:t,onSort:l}=e,[n,c]=(0,r.useState)(S(t)),i=(0,r.useCallback)(e=>{c(e),l(N(a,e),e)},[a,l]);return(0,r.useEffect)(()=>{c(S(t))},[t]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(k.Ph,{value:n,onValueChange:e=>i(e),children:[(0,s.jsx)(k.i4,{children:(0,s.jsx)(k.ki,{placeholder:"Sort"})}),(0,s.jsx)(k.Bw,{children:b.map(e=>(0,s.jsx)(k.Ql,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2 w-[120px]",children:[(0,s.jsx)(e.Icon,{className:"size-4"}),(0,s.jsx)("span",{children:e.label})]})},e.value))})]})})}var K=t(59636),Z=t(17647),T=t(37440),C=t(76230),A=t(53699),E=t(27006),I=t(65120);function O(e){let a=(0,i.useRouter)(),[t,p]=(0,r.useState)(!1),[v,k]=(0,r.useState)([]),b=(0,i.useSearchParams)(),w=(0,r.useMemo)(()=>d.Z.parse(b.toString()),[b]),S=w.sort||j,[O,z]=(0,r.useState)(!1),{viewOnly:_}=(0,Z.b)(),[F,L]=(0,r.useState)(!!e.locked),[V,R]=(0,r.useState)({sortValue:S,filter:K.l1,dataKeys:e.dataKeys}),[J,P]=(0,r.useState)(!1),[M,X]=(0,r.useState)(null);(0,r.useEffect)(()=>{k([])},[V]),(0,r.useEffect)(()=>{R(a=>{let t=N(e.dataKeys,a.sortValue);return t=(0,K.yE)(t,a.filter),{...a,dataKeys:t}})},[e.dataKeys]);let{confirm:Y}=(0,C.t)(),{alert:B}=(0,A.s)();(0,r.useEffect)(()=>{(async()=>{try{e.locked||await u.Z.post("/api/locks?data="+JSON.stringify({script:null,lockType:"data_key"}))}catch(e){B({title:"",message:e.message})}})()},[B,e.locked]);let Q=(0,r.useCallback)(e=>{L(a=>F!==e?e:a)},[]),W=(0,r.useCallback)(async e=>{try{var t;p(!0);let s=(await u.Z.delete("/api/data-keys?data="+JSON.stringify({dataKeysIds:e.map(e=>e.uuid),broadcastAction:!0}))).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors[0]);let r=e.reduce((e,a)=>[...e,...a.children.map(e=>({...e,parentKeys:e.parentKeys.filter(e=>e!=a.name)}))],[]);r.length&&await u.Z.post("/api/data-keys/save",{data:r,broadcastAction:!0}),k([]),a.refresh(),B({title:"Success",message:"Scripts deleted successfully!",variant:"success"})}catch(e){B({title:"Error",message:e.message,variant:"error"})}finally{p(!1)}},[a.refresh,B,Y]),$=e.disabled||_,q={selectedIndexes:v,selectable:!$,sortable:!1,loading:!1,maxRows:void 0,onSelect:k,onSort:()=>{},noDataMessage:(0,s.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,s.jsx)("div",{children:"No data keys saved."})}),getRowOptions(e){let{rowIndex:a}=e,t=V.dataKeys[a];return t?{className:(0,T.cn)(!_&&t.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Key"},{name:"Label"},{name:"Data type"},{name:"",align:"right",cellClassName:(0,T.cn)("w-10"),cellRenderer(a){let{rowIndex:t}=a,r=V.dataKeys[t];if(!r)return null;let n=e.dataKeys.filter(e=>e.parentKeys.includes(r.name));return(0,s.jsx)("div",{children:(0,s.jsxs)(h.h_,{children:[(0,s.jsx)(h.$F,{children:(0,s.jsx)(l.Z,{className:"size-4"})}),(0,s.jsxs)(h.AW,{children:[(0,s.jsx)(h.Xi,{asChild:!0,children:(0,s.jsx)(c.default,{href:"/data-keys/key/".concat(r.uuid),children:$?"View":"Edit"})}),(0,s.jsx)(h.Xi,{className:"text-destructive w-full hover:bg-destructive hover:text-destructive-foreground gap-x-2",onClick:e=>{Y(()=>W([{...r,children:n}]),{title:"Delete data key",message:"Are you sure you want to delete data key: <b>".concat(r.name,"</b>?"),danger:!0,positiveLabel:"Yes"})},children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"text-destructive size-4"}),"Delete"]})})]})]})})}}],data:V.dataKeys.map(e=>[(e.name||"").trim(),(e.label||e.name||"").trim(),(e.dataType||"").trim(),""])};return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsx)(y.a,{overlay:!0}),!!v.length&&(0,s.jsx)(m.h,{children:(0,s.jsxs)(x.z,{variant:"destructive",className:"h-auto w-auto",onClick:()=>{let a=V.dataKeys.filter((e,a)=>v.includes(a)).map(e=>({...e,children:[]}));a.length&&(a=a.map(t=>{let s=e.dataKeys.filter(e=>e.parentKeys.includes(e.name)).filter(e=>!a.map(e=>e.name).includes(e.name));return{...t,children:s}}),Y(()=>W(a),{title:"Delete data key",message:"Are you sure you want to delete selected key".concat(a.length>1?"s":""," (").concat(a.length,")?"),danger:!0,positiveLabel:"Yes"}))},children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),(0,s.jsx)("span",{children:v.length>1?"Delete ".concat(v.length):"Delete"})]})}),(0,s.jsx)(E.DataKeyForm,{...e,modal:!0,item:M||void 0,open:J||!!M,onOpenChange:()=>{P(!1),X(null)}}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:flex-wrap py-6 px-4 gap-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h1",{className:"text-2xl",children:"Data keys"})}),(0,s.jsx)("div",{className:"sm:ml-auto flex flex-col sm:flex-row gap-2",children:(0,s.jsx)(I.O,{scriptId:"",lockType:"data_key",doneLoading:!0,onStatusChange:e=>Q(e)},"data-key")}),(0,s.jsxs)("div",{className:"sm:ml-auto flex flex-col sm:flex-row gap-2",children:[(0,s.jsx)(D,{value:S,dataKeys:V.dataKeys,onSort:(e,t)=>{z(!0),R(a=>({...a,dataKeys:e,sortValue:t})),setTimeout(()=>z(!1),0),a.push("/data-keys?"+d.Z.stringify({...w,sort:t}))}}),(0,s.jsx)(K.Ed,{dataKeys:e.dataKeys,onFilter:(e,a)=>{z(!0),R(t=>(e=N(e,t.sortValue),{...t,dataKeys:e,filter:a})),setTimeout(()=>z(!1),0)}}),$?null:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(x.z,{asChild:!0,variant:"ghost",children:(0,s.jsxs)(c.default,{href:"/data-keys/add",children:[(0,s.jsx)(n.Z,{className:"size-4"}),"Add"]})})})]})]}),(0,s.jsx)(g.Z,{}),(0,s.jsx)(f.DataTable,{...q})]})]})}},65120:function(e,a,t){"use strict";t.d(a,{O:function(){return i}});var s=t(57437),r=t(74453),l=t(63124),n=t(2265),c=t(38472);function i(e){let{scriptId:a,lockType:t,doneLoading:i,onStatusChange:d}=e,[o,u]=(0,n.useState)(void 0);return((0,n.useEffect)(()=>{let e=!0;return async function(){try{("script"===t&&i||"script"!==t)&&await c.Z.delete("/api/locks?data="+JSON.stringify({lockType:t}));let s=(await c.Z.get("/api/locks?data="+JSON.stringify({script:a||null,lockType:t}))).data;e&&(u(s),setTimeout(()=>null==d?void 0:d(s),0))}catch(e){console.error("Error fetching lock status:",e)}}(),()=>{e=!1}},[a]),void 0===o)?null:(0,s.jsx)("div",{className:"p-1 rounded ".concat(o?"bg-red-100":"bg-green-100"),children:o?(0,s.jsx)(r.Z,{className:"h-4 w-4 text-red-900"}):(0,s.jsx)(l.Z,{className:"h-4 w-4 text-green-900"})})}},17501:function(e,a,t){"use strict";t.d(a,{h:function(){return n}});var s=t(57437),r=t(77606),l=t(37440);function n(e){let{children:a,className:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-16"}),(0,s.jsx)("div",{className:(0,l.cn)("\n                        fixed \n                        left-0 \n                        bottom-0 \n                        h-16 \n                        w-full \n                        border-t \n                        border-t-border \n                        z-[1] \n                        bg-primary-foreground \n                        dark:bg-background \n                        shadow-md \n                        dark:shadow-foreground/10\n                    "),children:(0,s.jsx)(r.V,{children:(0,s.jsx)("div",{className:(0,l.cn)("flex justify-end gap-x-4",t),children:a})})})]})}},77606:function(e,a,t){"use strict";t.d(a,{V:function(){return l}});var s=t(57437),r=t(37440);function l(e){let{className:a,...t}=e;return(0,s.jsx)("div",{...t,className:(0,r.cn)("w-full max-w-screen-xl mx-auto p-5",a)})}},64344:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var s=t(57437),r=t(2265),l=t(48484),n=t(37440);let c=r.forwardRef((e,a)=>{let{className:t,orientation:r="horizontal",decorative:c=!0,...i}=e;return(0,s.jsx)(l.f,{ref:a,decorative:c,orientation:r,className:(0,n.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",t),...i})});c.displayName=l.f.displayName}},function(e){e.O(0,[4868,1086,7468,6044,9527,193,231,7776,625,8472,1565,8482,2860,2671,6942,2424,7478,7023,1744],function(){return e(e.s=1476)}),_N_E=e.O()}]);