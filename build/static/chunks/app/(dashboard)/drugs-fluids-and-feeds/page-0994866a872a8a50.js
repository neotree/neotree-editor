(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3638],{58039:function(e,s,l){Promise.resolve().then(l.bind(l,33755)),Promise.resolve().then(l.bind(l,89884))},33755:function(e,s,l){"use strict";l.d(s,{DrugsLibrary:function(){return K}});var r=l(57437),a=l(2265),t=l(94508),i=l(86180),n=l(69711),d=l(66024),c=l(62869),o=l(6512),u=l(62618),h=l(67132),x=l(82425),m=l(53405),j=l(40875),g=l(27648),f=l(84190);function v(e){let{addDrugLink:s,addFluidLink:l}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(f.h_,{children:[(0,r.jsx)(f.$F,{asChild:!0,children:(0,r.jsxs)(c.z,{variant:"outline",children:[(0,r.jsx)("span",{children:"Add"}),(0,r.jsx)(j.Z,{className:"w-4 h-4 ml-2"})]})}),(0,r.jsxs)(f.AW,{children:[(0,r.jsx)(f.Xi,{asChild:!0,children:(0,r.jsx)(g.default,{href:s,children:"New drug"})}),(0,r.jsx)(f.Xi,{asChild:!0,children:(0,r.jsx)(g.default,{href:l,children:"New fluid"})})]})]})})}var p=l(17689),w=l(83464),y=l(29501),b=l(71706),N=l(26815),C=l(19060),k=l(98656),I=l(26110),S=l(53647);function D(e){var s;let{uuids:l}=e,[i,d]=(0,a.useState)(!1),[o,u]=(0,a.useState)(!1),{alert:h}=(0,k.s)(),{sites:x,loading:m,loadSites:j}=(0,b.k)({loadOnMount:!1,onLoadSitesError:()=>d(!1)}),{formState:{errors:g},reset:f,watch:v,setValue:D,register:E,handleSubmit:F,setError:Z}=(0,y.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),A=v("siteId"),L=v("overwriteExisting"),Q=o||m,_=!!A&&!Q,V=F(async e=>{try{var s;if(e.siteId||Z("siteId",{message:"Site is required"}),!_)return;u(!0);let r=(await w.Z.post("/api/drugs-library/export",{...e,uuids:l})).data;if(null===(s=r.errors)||void 0===s?void 0:s.length)throw Error(r.errors.join(", "));h({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>d(!1)})}catch(e){h({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{u(!1)}});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(I.Vq,{open:i,onOpenChange:e=>{f(),e&&j(),d(e)},children:[(0,r.jsx)(I.hg,{asChild:!0,children:(0,r.jsxs)(c.z,{className:"h-auto w-auto",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{children:l.length>1?"Export ".concat(l.length):"Export"})]})}),(0,r.jsxs)(I.cZ,{children:[(0,r.jsxs)(I.fK,{children:[(0,r.jsx)(I.$N,{children:"Export"}),(0,r.jsx)(I.Be,{className:"hidden",children:""})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(N._,{htmlFor:"siteId",children:"Site *"}),(0,r.jsxs)(S.Ph,{name:"siteId",onValueChange:e=>D("siteId",e,{shouldDirty:!0}),children:[(0,r.jsx)(S.i4,{children:(0,r.jsx)(S.ki,{placeholder:"Select site"})}),(0,r.jsx)(S.Bw,{children:(0,r.jsxs)(S.DI,{children:[(0,r.jsx)(S.n5,{children:"Sites"}),x.map(e=>{let{siteId:s,name:l}=e;return(0,r.jsx)(S.Ql,{value:s,children:l},s)})]})})]}),!!(null===(s=g.siteId)||void 0===s?void 0:s.message)&&(0,r.jsx)("div",{className:"text-xs text-danger mt-1",children:g.siteId.message})]}),(0,r.jsxs)("div",{className:(0,t.cn)("flex gap-x-2"),children:[(0,r.jsx)(C.X,{name:"overwriteExisting",id:"overwriteExisting",checked:L,onCheckedChange:()=>D("overwriteExisting",!L,{shouldDirty:!0})}),(0,r.jsx)(N._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,r.jsxs)(I.cN,{children:[(0,r.jsx)(I.GG,{asChild:!0,children:(0,r.jsx)(c.z,{variant:"ghost",children:"Cancel"})}),(0,r.jsxs)(c.z,{onClick:V,disabled:!_,children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),Q&&(0,r.jsx)(n.a,{overlay:!0})]})}function E(e){let{sortBy:s,typeFilter:l,statusFilter:a,onSortChange:t,onFilterChange:i}=e;return(0,r.jsx)("div",{className:"p-4 flex flex-col gap-y-4",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,r.jsx)("div",{className:"text-2xl",children:"Drugs & Fluids Library"}),(0,r.jsxs)("div",{className:"flex-1 flex flex-wrap items-center justify-end gap-x-4",children:[(0,r.jsx)("div",{children:(0,r.jsxs)(S.Ph,{value:s,onValueChange:t,children:[(0,r.jsx)(S.i4,{className:"w-[140px]",children:(0,r.jsx)(S.ki,{placeholder:"Sort"})}),(0,r.jsxs)(S.Bw,{children:[(0,r.jsx)(S.Ql,{value:"name-asc",children:"Name (A-Z)"}),(0,r.jsx)(S.Ql,{value:"name-desc",children:"Name (Z-A)"}),(0,r.jsx)(S.Ql,{value:"type-asc",children:"Type (A-Z)"}),(0,r.jsx)(S.Ql,{value:"type-desc",children:"Type (Z-A)"}),(0,r.jsx)(S.Ql,{value:"key-asc",children:"Key (A-Z)"}),(0,r.jsx)(S.Ql,{value:"key-desc",children:"Key (Z-A)"})]})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)(S.Ph,{value:l||a||"all",onValueChange:e=>{"all"===e?i("",""):"drug"===e||"fluid"===e?i(e,""):("draft"===e||"published"===e)&&i("",e)},children:[(0,r.jsx)(S.i4,{className:"w-[140px]",children:(0,r.jsx)(S.ki,{placeholder:"All items"})}),(0,r.jsxs)(S.Bw,{children:[(0,r.jsx)(S.Ql,{value:"all",children:"All items"}),(0,r.jsx)(S.U$,{}),(0,r.jsxs)(S.DI,{children:[(0,r.jsx)(S.n5,{children:"Status"}),(0,r.jsx)(S.Ql,{value:"published",children:"Published"}),(0,r.jsx)(S.Ql,{value:"draft",children:"Draft"})]}),(0,r.jsx)(S.U$,{}),(0,r.jsxs)(S.DI,{children:[(0,r.jsx)(S.n5,{children:"Types"}),(0,r.jsx)(S.Ql,{value:"drug",children:"Drugs"}),(0,r.jsx)(S.Ql,{value:"fluid",children:"Fluids"})]})]})]})})]})]})})}var F=l(71533),Z=l(15868),A=l(42208),L=l(78867),Q=l(96362),_=l(27413),V=l(12819),z=l(24959);function T(e){let{item:s,disabled:l,copyDrugs:a,deleteDrugs:t,editLink:n}=e,{confirm:d}=(0,i.t)(),o={isDraft:!!s.isDraft,userId:s.draftCreatedByUserId,dataType:s.type},u=(0,z.v)(o);return l=l||u,(0,r.jsxs)("div",{className:"flex gap-x-2",children:[(0,r.jsx)(V.O,{...o}),(0,r.jsxs)(f.h_,{children:[(0,r.jsx)(f.$F,{asChild:!0,children:(0,r.jsx)(c.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,r.jsx)(F.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(f.AW,{children:[(0,r.jsx)(f.Xi,{asChild:!0,children:(0,r.jsx)(g.default,{href:n("".concat(s.itemId)),children:(0,r.jsx)(r.Fragment,{children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),!l&&(0,r.jsx)(f.Xi,{onClick:()=>setTimeout(()=>{d(()=>a([s.itemId]),{title:"Copy drug",message:"Are you sure you want to copy drug?<br /> <b>".concat(s.drug,"</b>"),positiveLabel:"Yes, copy",negativeLabel:"Cancel"})},0),children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Copy"]})}),(0,r.jsx)(f.Xi,{asChild:!0,children:(0,r.jsxs)(g.default,{target:"_blank",href:"/drugs-fluids-and-feeds/".concat(s.itemId,"/metadata"),children:[(0,r.jsx)(Q.Z,{className:"mr-2 h-4 w-4"}),"View metadata"]})}),!l&&(0,r.jsxs)(f.Xi,{onClick:()=>setTimeout(()=>{d(()=>t([s.itemId]),{title:"Delete drug",message:"Are you sure you want to delete drug?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,r.jsx)(_.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Delete"})]})]})]})]})}var B=l(73578),O=l(66070),P=l(81066),X=l(42033);function $(e){let{search:s,setSearch:l,onSearch:a}=e,t=e=>{l(s=>s.value?{...s,filter:e,results:(0,X.UZ)({searchValue:s.value,filter:e,results:s.unfilteredResults})}:{...s,filter:e})};return(0,r.jsxs)(r.Fragment,{children:[s.searching&&(0,r.jsx)(n.a,{overlay:!0}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:items-center sm:gap-x-2",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(P.M,{placeholder:"Search by key, title, label...",onSearch:a})}),!!s.value&&(0,r.jsx)("div",{className:"w-full sm:w-[200px]",children:(0,r.jsxs)(S.Ph,{value:s.filter,onValueChange:e=>t(e),children:[(0,r.jsx)(S.i4,{children:(0,r.jsx)(S.ki,{placeholder:"All matches"})}),(0,r.jsx)(S.Bw,{children:X.kv.map(e=>(0,r.jsx)(S.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}var M=l(92735);function R(){return(0,r.jsx)(c.z,{asChild:!0,variant:"outline",children:(0,r.jsxs)(g.default,{href:"/drugs-fluids-and-feeds/metadata",target:"_blank",children:[(0,r.jsx)(M.Z,{className:"mr-2 h-4 w-4"}),"Export metadata"]})})}function K(e){let{}=e,{confirm:s}=(0,i.t)(),{viewOnly:l}=(0,h.b)(),[j,g]=(0,a.useState)([]),{filteredDrugs:f,tableData:p,loading:w,addLink:y,selectedItemId:b,editLink:N,saveDrugs:C,deleteDrugs:k,copyDrugs:I,search:S,setSearch:F,onSearch:Z,typeFilter:A,statusFilter:L,sortBy:Q,setTypeFilter:_,setStatusFilter:V,setSortBy:z}=(0,u.a)(),P=(0,a.useMemo)(()=>l,[l]),X=S.results,M=(0,a.useMemo)(()=>{let e=new Map;return X.forEach(s=>{(null==s?void 0:s.itemId)&&e.set(s.itemId,s)}),e},[X]),K=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),U=(0,a.useCallback)(e=>{let s="".concat(null!=e?e:"");if(!S.value)return s;let l=S.value.toLowerCase();if(!s.toLowerCase().includes(l))return s;let a=RegExp("(".concat(K(S.value),")"),"gi");return s.split(a).map((e,s)=>e?e.toLowerCase()===l?(0,r.jsx)("mark",{className:"rounded bg-yellow-200 px-1",children:e},s):(0,r.jsx)("span",{children:e},s):null)},[S.value]);return(0,r.jsxs)(r.Fragment,{children:[w&&(0,r.jsx)(n.a,{overlay:!0}),(0,r.jsx)(m.A,{disabled:P,item:f.filter(e=>e.itemId===b)[0],onChange:C}),!!j.length&&(0,r.jsxs)(x.h,{children:[(0,r.jsx)(D,{uuids:f.filter((e,s)=>j.includes(s)).map(e=>e.itemId)}),(0,r.jsxs)(c.z,{variant:"destructive",onClick:()=>setTimeout(()=>{s(()=>k(f.filter((e,s)=>j.includes(s)).map(e=>e.itemId)),{title:"Delete drugs",message:"Are you sure you want to delete drugs?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),children:["Delete ",j.length<2?"":j.length+" items"]})]}),(0,r.jsx)(E,{sortBy:Q,typeFilter:A,statusFilter:L,onSortChange:z,onFilterChange:(e,s)=>{_(e),V(s)}}),(0,r.jsx)("div",{className:"px-4 pb-4",children:(0,r.jsx)($,{search:S,setSearch:F,onSearch:Z})}),(0,r.jsx)(o.Separator,{}),(0,r.jsx)(d.DataTable,{onSelect:g,selectable:!P,headerActions:(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsx)(R,{}),(0,r.jsx)(v,{addDrugLink:y("drug"),addFluidLink:y("fluid")})]}),rowRenderer:S.value?e=>{let{props:s,cells:l,rowIndex:a}=e,i=f[a],n=i?M.get(i.itemId):void 0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.SC,{...s,children:l}),n&&n.matches.length?(0,r.jsx)(B.SC,{...s,className:(0,t.cn)(s.className,"bg-yellow-50 hover:bg-yellow-50"),children:(0,r.jsx)(B.pj,{colSpan:l.length,className:"border-t p-0",children:(0,r.jsx)(O.Zb,{className:"m-4 border-none bg-white shadow-none",children:(0,r.jsx)("div",{className:"flex flex-col divide-y text-xs",children:n.matches.map((e,s)=>(0,r.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-3 sm:flex-row sm:items-center sm:gap-x-4",children:[(0,r.jsxs)("span",{className:"font-medium text-muted-foreground",children:[e.fieldLabel,e.context?" (".concat(e.context,")"):""]}),(0,r.jsx)("span",{className:"text-foreground sm:ml-auto sm:text-right",children:U(e.fieldValue)})]},"".concat(e.field,"-").concat(s,"-").concat(e.fieldValue)))})})})}):null]})}:void 0,getRowOptions:e=>{let{rowIndex:s}=e,l=f[s];return l?{className:(0,t.cn)(l.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Drug / Fluid"},{name:"Type",tdClassName:"w-[80px]"},{name:"Key"},{name:"Dosage text"},{name:"",align:"right",cellRenderer(e){let{value:s}=e,l=f.filter(e=>e.itemId===s)[0];return l?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T,{item:l,disabled:P,copyDrugs:I,deleteDrugs:k,editLink:N})}):null}}],data:p})]})}},81066:function(e,s,l){"use strict";l.d(s,{M:function(){return i}});var r=l(57437),a=l(2265),t=l(94508);let i=(0,a.forwardRef)((e,s)=>{let{searchButton:l,hideSearchButton:i,onSearch:n,...d}=e,[c,o]=(0,a.useState)("");return(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==n||n(c)},children:(0,r.jsxs)("div",{className:(0,t.cn)("flex w-full"),children:[(0,r.jsx)("div",{className:(0,t.cn)("relative w-full"),children:(0,r.jsx)("input",{ref:s,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var s;let l=e.target.value;o(l),null===(s=d.onChange)||void 0===s||s.call(d,e),l||null==n||n(l)},className:(0,t.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!i&&(0,r.jsx)("button",{type:"submit",className:(0,t.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==l?void 0:l.className),...l,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});i.displayName="SearchInput"},71706:function(e,s,l){"use strict";l.d(s,{k:function(){return n}});var r=l(2265),a=l(83464),t=l(67132),i=l(98656);function n(e){let{loadOnMount:s=!0,onLoadSitesError:l}={...e},[n,d]=(0,r.useState)(!1),{alert:c}=(0,i.s)(),{getSites:o}=(0,t.b)(),[u,h]=(0,r.useState)([]),x=(0,r.useCallback)(async()=>{try{var e;d(!0);let s=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=s.errors)||void 0===e?void 0:e.length)throw Error(s.errors.join(", "));h(s.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==l?void 0:l()})}finally{d(!1)}},[o,c,l]);return(0,r.useEffect)(()=>{s&&!u.length&&x()},[u,s,x]),{loading:n,sites:u,loadSites:x}}}},function(e){e.O(0,[6137,1475,253,5972,3464,7790,2972,1043,1254,9501,7781,5966,6651,3728,20,8026,6024,7404,8577,8793,5216,8961,7478,2117,1744],function(){return e(e.s=58039)}),_N_E=e.O()}]);