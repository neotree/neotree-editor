(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3638],{34165:function(e,s,t){Promise.resolve().then(t.bind(t,93734)),Promise.resolve().then(t.bind(t,25704))},93734:function(e,s,t){"use strict";t.d(s,{DrugsLibrary:function(){return M}});var l=t(57437),r=t(2265),a=t(37440),n=t(76230),i=t(39661),d=t(44380),o=t(50495),c=t(64344),u=t(44371),x=t(17647),h=t(17501),m=t(80929),f=t(42421),g=t(87138),j=t(46910);function p(e){let{addDrugLink:s,addFluidLink:t}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(j.h_,{children:[(0,l.jsx)(j.$F,{asChild:!0,children:(0,l.jsxs)(o.z,{variant:"outline",children:[(0,l.jsx)("span",{children:"Add"}),(0,l.jsx)(f.Z,{className:"w-4 h-4 ml-2"})]})}),(0,l.jsxs)(j.AW,{children:[(0,l.jsx)(j.Xi,{asChild:!0,children:(0,l.jsx)(g.default,{href:s,children:"New drug"})}),(0,l.jsx)(j.Xi,{asChild:!0,children:(0,l.jsx)(g.default,{href:t,children:"New fluid"})})]})]})})}var v=t(58184),b=t(38472),y=t(39343),w=t(53853),N=t(67135),C=t(86466),k=t(53699),S=t(90837),I=t(46294);function D(e){var s;let{uuids:t}=e,[n,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1),{alert:x}=(0,k.s)(),{sites:h,loading:m,loadSites:f}=(0,w.k)({loadOnMount:!1,onLoadSitesError:()=>d(!1)}),{formState:{errors:g},reset:j,watch:p,setValue:D,register:F,handleSubmit:E,setError:Z}=(0,y.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),A=p("siteId"),L=p("overwriteExisting"),V=c||m,Q=!!A&&!V,z=E(async e=>{try{var s;if(e.siteId||Z("siteId",{message:"Site is required"}),!Q)return;u(!0);let l=(await b.Z.post("/api/drugs-library/export",{...e,uuids:t})).data;if(null===(s=l.errors)||void 0===s?void 0:s.length)throw Error(l.errors.join(", "));x({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>d(!1)})}catch(e){x({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{u(!1)}});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(S.Vq,{open:n,onOpenChange:e=>{j(),e&&f(),d(e)},children:[(0,l.jsx)(S.hg,{asChild:!0,children:(0,l.jsxs)(o.z,{className:"h-auto w-auto",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),(0,l.jsx)("span",{children:t.length>1?"Export ".concat(t.length):"Export"})]})}),(0,l.jsxs)(S.cZ,{children:[(0,l.jsxs)(S.fK,{children:[(0,l.jsx)(S.$N,{children:"Export"}),(0,l.jsx)(S.Be,{className:"hidden",children:""})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(N._,{htmlFor:"siteId",children:"Site *"}),(0,l.jsxs)(I.Ph,{name:"siteId",onValueChange:e=>D("siteId",e,{shouldDirty:!0}),children:[(0,l.jsx)(I.i4,{children:(0,l.jsx)(I.ki,{placeholder:"Select site"})}),(0,l.jsx)(I.Bw,{children:(0,l.jsxs)(I.DI,{children:[(0,l.jsx)(I.n5,{children:"Sites"}),h.map(e=>{let{siteId:s,name:t}=e;return(0,l.jsx)(I.Ql,{value:s,children:t},s)})]})})]}),!!(null===(s=g.siteId)||void 0===s?void 0:s.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:g.siteId.message})]}),(0,l.jsxs)("div",{className:(0,a.cn)("flex gap-x-2"),children:[(0,l.jsx)(C.X,{name:"overwriteExisting",id:"overwriteExisting",checked:L,onCheckedChange:()=>D("overwriteExisting",!L,{shouldDirty:!0})}),(0,l.jsx)(N._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,l.jsxs)(S.cN,{children:[(0,l.jsx)(S.GG,{asChild:!0,children:(0,l.jsx)(o.z,{variant:"ghost",children:"Cancel"})}),(0,l.jsxs)(o.z,{onClick:z,disabled:!Q,children:[(0,l.jsx)(v.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),V&&(0,l.jsx)(i.a,{overlay:!0})]})}function F(e){let{sortBy:s,typeFilter:t,statusFilter:r,onSortChange:a,onFilterChange:n}=e;return(0,l.jsx)("div",{className:"p-4 flex flex-col gap-y-4",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,l.jsx)("div",{className:"text-2xl",children:"Drugs & Fluids Library"}),(0,l.jsxs)("div",{className:"flex-1 flex flex-wrap items-center justify-end gap-x-4",children:[(0,l.jsx)("div",{children:(0,l.jsxs)(I.Ph,{value:s,onValueChange:a,children:[(0,l.jsx)(I.i4,{className:"w-[140px]",children:(0,l.jsx)(I.ki,{placeholder:"Sort"})}),(0,l.jsxs)(I.Bw,{children:[(0,l.jsx)(I.Ql,{value:"name-asc",children:"Name (A-Z)"}),(0,l.jsx)(I.Ql,{value:"name-desc",children:"Name (Z-A)"}),(0,l.jsx)(I.Ql,{value:"type-asc",children:"Type (A-Z)"}),(0,l.jsx)(I.Ql,{value:"type-desc",children:"Type (Z-A)"}),(0,l.jsx)(I.Ql,{value:"key-asc",children:"Key (A-Z)"}),(0,l.jsx)(I.Ql,{value:"key-desc",children:"Key (Z-A)"})]})]})}),(0,l.jsx)("div",{children:(0,l.jsxs)(I.Ph,{value:t||r||"all",onValueChange:e=>{"all"===e?n("",""):"drug"===e||"fluid"===e?n(e,""):("draft"===e||"published"===e)&&n("",e)},children:[(0,l.jsx)(I.i4,{className:"w-[140px]",children:(0,l.jsx)(I.ki,{placeholder:"All items"})}),(0,l.jsxs)(I.Bw,{children:[(0,l.jsx)(I.Ql,{value:"all",children:"All items"}),(0,l.jsx)(I.U$,{}),(0,l.jsxs)(I.DI,{children:[(0,l.jsx)(I.n5,{children:"Status"}),(0,l.jsx)(I.Ql,{value:"published",children:"Published"}),(0,l.jsx)(I.Ql,{value:"draft",children:"Draft"})]}),(0,l.jsx)(I.U$,{}),(0,l.jsxs)(I.DI,{children:[(0,l.jsx)(I.n5,{children:"Types"}),(0,l.jsx)(I.Ql,{value:"drug",children:"Drugs"}),(0,l.jsx)(I.Ql,{value:"fluid",children:"Fluids"})]})]})]})})]})]})})}var E=t(45188),Z=t(6649),A=t(75733),L=t(6884),V=t(90399),Q=t(61386),z=t(71239);function R(e){let{item:s,disabled:t,copyDrugs:r,deleteDrugs:a,editLink:i}=e,{confirm:d}=(0,n.t)(),c={isDraft:!!s.isDraft,userId:s.draftCreatedByUserId,dataType:s.type},u=(0,z.v)(c);return t=t||u,(0,l.jsxs)("div",{className:"flex gap-x-2",children:[(0,l.jsx)(Q.O,{...c}),(0,l.jsxs)(j.h_,{children:[(0,l.jsx)(j.$F,{asChild:!0,children:(0,l.jsx)(o.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,l.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,l.jsxs)(j.AW,{children:[(0,l.jsx)(j.Xi,{asChild:!0,children:(0,l.jsx)(g.default,{href:i("".concat(s.itemId)),children:(0,l.jsx)(l.Fragment,{children:t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Z.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),!t&&(0,l.jsx)(j.Xi,{onClick:()=>setTimeout(()=>{d(()=>r([s.itemId]),{title:"Copy drug",message:"Are you sure you want to copy drug?<br /> <b>".concat(s.drug,"</b>"),positiveLabel:"Yes, copy",negativeLabel:"Cancel"})},0),children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Copy"]})}),!t&&(0,l.jsxs)(j.Xi,{onClick:()=>setTimeout(()=>{d(()=>a([s.itemId]),{title:"Delete drug",message:"Are you sure you want to delete drug?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,l.jsx)(V.Z,{className:"mr-2 h-4 w-4"}),(0,l.jsx)("span",{children:"Delete"})]})]})]})]})}var T=t(26975),_=t(36013),B=t(89229),O=t(43088);function P(e){let{search:s,setSearch:t,onSearch:r}=e,a=e=>{t(s=>s.value?{...s,filter:e,results:(0,O.UZ)({searchValue:s.value,filter:e,results:s.unfilteredResults})}:{...s,filter:e})};return(0,l.jsxs)(l.Fragment,{children:[s.searching&&(0,l.jsx)(i.a,{overlay:!0}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:items-center sm:gap-x-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(B.M,{placeholder:"Search by key, title, label...",onSearch:r})}),!!s.value&&(0,l.jsx)("div",{className:"w-full sm:w-[200px]",children:(0,l.jsxs)(I.Ph,{value:s.filter,onValueChange:e=>a(e),children:[(0,l.jsx)(I.i4,{children:(0,l.jsx)(I.ki,{placeholder:"All matches"})}),(0,l.jsx)(I.Bw,{children:O.kv.map(e=>(0,l.jsx)(I.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}function M(e){let{}=e,{confirm:s}=(0,n.t)(),{viewOnly:t}=(0,x.b)(),[f,g]=(0,r.useState)([]),{filteredDrugs:j,tableData:v,loading:b,addLink:y,selectedItemId:w,editLink:N,saveDrugs:C,deleteDrugs:k,copyDrugs:S,search:I,setSearch:E,onSearch:Z,typeFilter:A,statusFilter:L,sortBy:V,setTypeFilter:Q,setStatusFilter:z,setSortBy:B}=(0,u.a)(),O=(0,r.useMemo)(()=>t,[t]),M=I.results,$=(0,r.useMemo)(()=>{let e=new Map;return M.forEach(s=>{(null==s?void 0:s.itemId)&&e.set(s.itemId,s)}),e},[M]),X=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Y=(0,r.useCallback)(e=>{let s="".concat(null!=e?e:"");if(!I.value)return s;let t=I.value.toLowerCase();if(!s.toLowerCase().includes(t))return s;let r=RegExp("(".concat(X(I.value),")"),"gi");return s.split(r).map((e,s)=>e?e.toLowerCase()===t?(0,l.jsx)("mark",{className:"rounded bg-yellow-200 px-1",children:e},s):(0,l.jsx)("span",{children:e},s):null)},[I.value]);return(0,l.jsxs)(l.Fragment,{children:[b&&(0,l.jsx)(i.a,{overlay:!0}),(0,l.jsx)(m.A,{disabled:O,item:j.filter(e=>e.itemId===w)[0],onChange:C}),!!f.length&&(0,l.jsxs)(h.h,{children:[(0,l.jsx)(D,{uuids:j.filter((e,s)=>f.includes(s)).map(e=>e.itemId)}),(0,l.jsxs)(o.z,{variant:"destructive",onClick:()=>setTimeout(()=>{s(()=>k(j.filter((e,s)=>f.includes(s)).map(e=>e.itemId)),{title:"Delete drugs",message:"Are you sure you want to delete drugs?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),children:["Delete ",f.length<2?"":f.length+" items"]})]}),(0,l.jsx)(F,{sortBy:V,typeFilter:A,statusFilter:L,onSortChange:B,onFilterChange:(e,s)=>{Q(e),z(s)}}),(0,l.jsx)("div",{className:"px-4 pb-4",children:(0,l.jsx)(P,{search:I,setSearch:E,onSearch:Z})}),(0,l.jsx)(c.Z,{}),(0,l.jsx)(d.DataTable,{onSelect:g,selectable:!O,headerActions:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(p,{addDrugLink:y("drug"),addFluidLink:y("fluid")})}),rowRenderer:I.value?e=>{let{props:s,cells:t,rowIndex:r}=e,n=j[r],i=n?$.get(n.itemId):void 0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.SC,{...s,children:t}),i&&i.matches.length?(0,l.jsx)(T.SC,{...s,className:(0,a.cn)(s.className,"bg-yellow-50 hover:bg-yellow-50"),children:(0,l.jsx)(T.pj,{colSpan:t.length,className:"border-t p-0",children:(0,l.jsx)(_.Zb,{className:"m-4 border-none bg-white shadow-none",children:(0,l.jsx)("div",{className:"flex flex-col divide-y text-xs",children:i.matches.map((e,s)=>(0,l.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-3 sm:flex-row sm:items-center sm:gap-x-4",children:[(0,l.jsxs)("span",{className:"font-medium text-muted-foreground",children:[e.fieldLabel,e.context?" (".concat(e.context,")"):""]}),(0,l.jsx)("span",{className:"text-foreground sm:ml-auto sm:text-right",children:Y(e.fieldValue)})]},"".concat(e.field,"-").concat(s,"-").concat(e.fieldValue)))})})})}):null]})}:void 0,getRowOptions:e=>{let{rowIndex:s}=e,t=j[s];return t?{className:(0,a.cn)(t.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Drug / Fluid"},{name:"Type",tdClassName:"w-[80px]"},{name:"Key"},{name:"Dosage text"},{name:"",align:"right",cellRenderer(e){let{value:s}=e,t=j.filter(e=>e.itemId===s)[0];return t?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(R,{item:t,disabled:O,copyDrugs:S,deleteDrugs:k,editLink:N})}):null}}],data:v})]})}},89229:function(e,s,t){"use strict";t.d(s,{M:function(){return n}});var l=t(57437),r=t(2265),a=t(37440);let n=(0,r.forwardRef)((e,s)=>{let{searchButton:t,hideSearchButton:n,onSearch:i,...d}=e,[o,c]=(0,r.useState)("");return(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==i||i(o)},children:(0,l.jsxs)("div",{className:(0,a.cn)("flex w-full"),children:[(0,l.jsx)("div",{className:(0,a.cn)("relative w-full"),children:(0,l.jsx)("input",{ref:s,type:"search",placeholder:"Search",value:o,...d,onChange:e=>{var s;let t=e.target.value;c(t),null===(s=d.onChange)||void 0===s||s.call(d,e),t||null==i||i(t)},className:(0,a.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!n&&(0,l.jsx)("button",{type:"submit",className:(0,a.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==t?void 0:t.className),...t,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});n.displayName="SearchInput"},95317:function(e,s,t){"use strict";t.d(s,{Ei:function(){return v},FF:function(){return j},Tu:function(){return g},aM:function(){return c},bC:function(){return p},sw:function(){return u},ue:function(){return f},yo:function(){return o}});var l=t(57437),r=t(2265),a=t(13304),n=t(13027),i=t(74697),d=t(37440);let o=a.fC,c=a.xz,u=a.x8,x=a.h_,h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:s})});h.displayName=a.aV.displayName;let m=(0,n.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),f=r.forwardRef((e,s)=>{let{side:t="right",className:r,children:n,hideCloseButton:o,...c}=e;return(0,l.jsxs)(x,{children:[(0,l.jsx)(h,{}),(0,l.jsxs)(a.VY,{ref:s,className:(0,d.cn)(m({side:t}),r),...c,children:[n,!0!==o&&(0,l.jsxs)(a.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,l.jsx)(i.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=a.VY.displayName;let g=e=>{let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};g.displayName="SheetHeader";let j=e=>{let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};j.displayName="SheetFooter";let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.Dx,{ref:s,className:(0,d.cn)("text-lg font-semibold text-foreground",t),...r})});p.displayName=a.Dx.displayName;let v=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.dk,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...r})});v.displayName=a.dk.displayName},93146:function(e,s,t){"use strict";t.d(s,{g:function(){return n}});var l=t(57437),r=t(2265),a=t(37440);let n=r.forwardRef((e,s)=>{let{className:t,noRing:r,...n}=e;return(0,l.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r&&"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",t),ref:s,...n})});n.displayName="Textarea"},53853:function(e,s,t){"use strict";t.d(s,{k:function(){return i}});var l=t(2265),r=t(38472),a=t(17647),n=t(53699);function i(e){let{loadOnMount:s=!0,onLoadSitesError:t}={...e},[i,d]=(0,l.useState)(!1),{alert:o}=(0,n.s)(),{getSites:c}=(0,a.b)(),[u,x]=(0,l.useState)([]),h=(0,l.useCallback)(async()=>{try{var e;d(!0);let s=(await r.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=s.errors)||void 0===e?void 0:e.length)throw Error(s.errors.join(", "));x(s.data||[])}catch(e){o({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==t?void 0:t()})}finally{d(!1)}},[c,o,t]);return(0,l.useEffect)(()=>{s&&!u.length&&h()},[u,s,h]),{loading:i,sites:u,loadSites:h}}}},function(e){e.O(0,[4868,1086,7468,6044,193,8472,231,638,2254,8872,2860,7202,3134,1133,4380,3920,6323,2529,4371,553,7478,7023,1744],function(){return e(e.s=34165)}),_N_E=e.O()}]);