(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3638],{58039:function(e,s,r){Promise.resolve().then(r.bind(r,67464)),Promise.resolve().then(r.bind(r,25704))},67464:function(e,s,r){"use strict";r.d(s,{DrugsLibrary:function(){return Z}});var l=r(57437),t=r(2265),a=r(87138),i=r(45188),n=r(6649),d=r(75733),c=r(6884),o=r(90399),u=r(37440),h=r(76230),x=r(39661),m=r(46910),g=r(44380),j=r(50495),p=r(44371),v=r(17647),f=r(17501),y=r(80929),b=r(42421);function N(e){let{addDrugLink:s,addFluidLink:r}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(m.h_,{children:[(0,l.jsx)(m.$F,{asChild:!0,children:(0,l.jsxs)(j.z,{variant:"outline",children:[(0,l.jsx)("span",{children:"Add"}),(0,l.jsx)(b.Z,{className:"w-4 h-4 ml-2"})]})}),(0,l.jsxs)(m.AW,{children:[(0,l.jsx)(m.Xi,{asChild:!0,children:(0,l.jsx)(a.default,{href:s,children:"New drug"})}),(0,l.jsx)(m.Xi,{asChild:!0,children:(0,l.jsx)(a.default,{href:r,children:"New fluid"})})]})]})})}var w=r(58184),C=r(38472),S=r(39343),I=r(53853),k=r(67135),E=r(86466),F=r(53699),D=r(90837),L=r(46294);function A(e){var s;let{uuids:r}=e,[a,i]=(0,t.useState)(!1),[n,d]=(0,t.useState)(!1),{alert:c}=(0,F.s)(),{sites:o,loading:h,loadSites:m}=(0,I.k)({loadOnMount:!1,onLoadSitesError:()=>i(!1)}),{formState:{errors:g},reset:p,watch:v,setValue:f,register:y,handleSubmit:b,setError:N}=(0,S.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),A=v("siteId"),Z=v("overwriteExisting"),_=n||h,z=!!A&&!_,O=b(async e=>{try{var s;if(e.siteId||N("siteId",{message:"Site is required"}),!z)return;d(!0);let l=(await C.Z.post("/api/drugs-library/export",{...e,uuids:r})).data;if(null===(s=l.errors)||void 0===s?void 0:s.length)throw Error(l.errors.join(", "));c({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>i(!1)})}catch(e){c({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{d(!1)}});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(D.Vq,{open:a,onOpenChange:e=>{p(),e&&m(),i(e)},children:[(0,l.jsx)(D.hg,{asChild:!0,children:(0,l.jsxs)(j.z,{className:"h-auto w-auto",children:[(0,l.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),(0,l.jsx)("span",{children:r.length>1?"Export ".concat(r.length):"Export"})]})}),(0,l.jsxs)(D.cZ,{children:[(0,l.jsxs)(D.fK,{children:[(0,l.jsx)(D.$N,{children:"Export"}),(0,l.jsx)(D.Be,{className:"hidden",children:""})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(k._,{htmlFor:"siteId",children:"Site *"}),(0,l.jsxs)(L.Ph,{name:"siteId",onValueChange:e=>f("siteId",e,{shouldDirty:!0}),children:[(0,l.jsx)(L.i4,{children:(0,l.jsx)(L.ki,{placeholder:"Select site"})}),(0,l.jsx)(L.Bw,{children:(0,l.jsxs)(L.DI,{children:[(0,l.jsx)(L.n5,{children:"Sites"}),o.map(e=>{let{siteId:s,name:r}=e;return(0,l.jsx)(L.Ql,{value:s,children:r},s)})]})})]}),!!(null===(s=g.siteId)||void 0===s?void 0:s.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:g.siteId.message})]}),(0,l.jsxs)("div",{className:(0,u.cn)("flex gap-x-2"),children:[(0,l.jsx)(E.X,{name:"overwriteExisting",id:"overwriteExisting",checked:Z,onCheckedChange:()=>f("overwriteExisting",!Z,{shouldDirty:!0})}),(0,l.jsx)(k._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,l.jsxs)(D.cN,{children:[(0,l.jsx)(D.GG,{asChild:!0,children:(0,l.jsx)(j.z,{variant:"ghost",children:"Cancel"})}),(0,l.jsxs)(j.z,{onClick:O,disabled:!z,children:[(0,l.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),_&&(0,l.jsx)(x.a,{overlay:!0})]})}function Z(e){let{}=e,{confirm:s}=(0,h.t)(),{viewOnly:r}=(0,v.b)(),[b,w]=(0,t.useState)([]),{filteredDrugs:C,tableData:S,loading:I,searchValue:k,setSearchValue:E,addLink:F,selectedItemId:D,editLink:L,saveDrugs:Z,deleteDrugs:_,copyDrugs:z}=(0,p.a)(),O=(0,t.useMemo)(()=>r,[r]);return(0,l.jsxs)(l.Fragment,{children:[I&&(0,l.jsx)(x.a,{overlay:!0}),(0,l.jsx)(y.A,{disabled:O,item:C.filter(e=>e.itemId===D)[0],onChange:Z}),!!b.length&&(0,l.jsxs)(f.h,{children:[(0,l.jsx)(A,{uuids:C.filter((e,s)=>b.includes(s)).map(e=>e.itemId)}),(0,l.jsxs)(j.z,{variant:"destructive",onClick:()=>setTimeout(()=>{s(()=>_(C.filter((e,s)=>b.includes(s)).map(e=>e.itemId)),{title:"Delete drugs",message:"Are you sure you want to delete drugs?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),children:["Delete ",b.length<2?"":b.length+" items"]})]}),(0,l.jsx)(g.DataTable,{onSelect:w,selectable:!O,title:"Drugs & Fluids Library",search:{inputPlaceholder:"Search",value:k,setValue:e=>E(e)},headerActions:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(N,{addDrugLink:F("drug"),addFluidLink:F("fluid")})}),getRowOptions:e=>{let{rowIndex:s}=e,r=C[s];return r?{className:(0,u.cn)(r.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Drug / Fluid"},{name:"Type",tdClassName:"w-[80px]"},{name:"Key"},{name:"Dosage text"},{name:"",align:"right",cellRenderer(e){let{value:r}=e,t=C.filter(e=>e.itemId===r)[0];return t?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(m.h_,{children:[(0,l.jsx)(m.$F,{asChild:!0,children:(0,l.jsx)(j.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,l.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,l.jsxs)(m.AW,{children:[(0,l.jsx)(m.Xi,{asChild:!0,children:(0,l.jsx)(a.default,{href:L("".concat(r)),children:(0,l.jsx)(l.Fragment,{children:O?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),!O&&(0,l.jsx)(m.Xi,{onClick:()=>setTimeout(()=>{s(()=>z([t.itemId]),{title:"Copy drug",message:"Are you sure you want to copy drug?<br /> <b>".concat(t.drug,"</b>"),positiveLabel:"Yes, copy",negativeLabel:"Cancel"})},0),children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{className:"mr-2 h-4 w-4"})," Copy"]})}),!O&&(0,l.jsxs)(m.Xi,{onClick:()=>setTimeout(()=>{s(()=>_([t.itemId]),{title:"Delete drug",message:"Are you sure you want to delete drug?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,l.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),(0,l.jsx)("span",{children:"Delete"})]})]})]})}):null}}],data:S})]})}},80852:function(e,s,r){"use strict";r.d(s,{L:function(){return n}});var l=r(57437),t=r(2265),a=r(84492),i=r(23920);function n(e){let{value:s,disabled:r,modal:n,multiple:d,placeholder:c,error:o,onChange:u,filterDataKeys:h}=e,{dataKeys:x,extractDataKeys:m}=(0,i.M)(),g=(0,t.useMemo)(()=>x.filter(e=>!h||h(e)).map(e=>({label:e.name,value:e.uniqueKey,caption:e.dataType||"",description:e.label})),[x,h]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(a.V,{multiple:d,modal:n,error:o,placeholder:"".concat(s||"")||c||"Select key",search:{placeholder:"Search data keys"},options:g,onSelect:e=>{let s=m(e.map(e=>e.value)).map(e=>({...e,children:m(e.options)}));null==u||u(s)}})})}},84492:function(e,s,r){"use strict";r.d(s,{V:function(){return h}});var l=r(57437),t=r(2265),a=r(1282),i=r(22468),n=r(50495),d=r(83102),c=r(90837),o=r(37440),u=r(85937);function h(e){let{options:s,selected:r,...t}=e;r=Array.isArray(r)?r:r?[r]:[];let a=s.map(e=>({...e,value:"".concat(e.value)})),i=r.map(e=>"".concat(e));if(!t.multiple){let[e]=Array.isArray(i)?i:[i];e&&a.find(s=>s.value===e)}return(0,l.jsx)(x,{...t,options:a,selected:i})}function x(e){var s;let{modal:r,header:h,placeholder:x,search:m,multiple:g=!1,error:j=!1,disabled:p=!1,selected:v,options:f=[],trigger:y,onTrigger:b,onSelect:N}=e,[w,C]=(0,t.useState)(""),S=(0,u.N)(w),[I,k]=(0,t.useState)([]),E=(0,t.useMemo)(()=>v?Array.isArray(v)?v.map(e=>f.find(s=>(null==s?void 0:s.value)===e)).map(e=>e):f.filter(e=>(null==e?void 0:e.value)===v)||[]:[],[v,f]),F=(0,t.useMemo)(()=>f.map(e=>{let s=E.map(e=>null==e?void 0:e.value).map(e=>"".concat(e||"")).filter(e=>e).includes("".concat(null==e?void 0:e.value));return s=s||I.includes(e.value),{...e,isSelected:s}}).sort((e,s)=>(e.disabled?1:0)-(s.disabled?1:0)).sort((e,s)=>{let r=e.isSelected?1:0;return(s.isSelected?1:0)-r}).filter(e=>JSON.stringify([e.value||"",e.label||"",e.description||""]).toLowerCase().match(S.toLowerCase())),[f,S,E,I]);return(0,t.useEffect)(()=>()=>C(""),[]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(c.Vq,{modal:r,onOpenChange:()=>{C(""),k([])},children:[(0,l.jsx)(c.hg,{asChild:!0,children:y||(0,l.jsxs)(n.z,{disabled:p,variant:"outline",className:(0,o.cn)("justify-between w-full",j&&"border border-destructive hover:bg-destructive/10"),onClick:b,children:[(0,l.jsx)("span",{className:E.length?"":"opacity-50",children:(null===(s=E[0])||void 0===s?void 0:s.label)||x||""}),(0,l.jsx)(a.Z,{className:"size-4 opacity-50"})]})}),(0,l.jsxs)(c.cZ,{hideCloseButton:!0,className:"flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",children:[(0,l.jsxs)(c.fK,{className:"border-b border-b-border px-4 py-4",children:[(0,l.jsx)(c.$N,{className:"hidden",children:""}),(0,l.jsx)(c.Be,{className:"hidden",children:""}),(0,l.jsxs)("div",{className:"flex items-center gap-x-4",children:[m?(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(d.I,{type:"search",placeholder:m.placeholder||"",value:w,onChange:e=>C(e.target.value)})}):null,h]})]}),(0,l.jsx)("div",{className:"flex-1 flex flex-col gap-y-1 overflow-y-auto px-4 py-2 overflow-x-hidden",children:F.map(e=>{let s=g?"button":c.GG;return(0,l.jsx)(t.Fragment,{children:(0,l.jsx)(s,{onClick:()=>{e.disabled||(e.isSelected?g?k(s=>s.filter(s=>s!==e.value)):null==N||N(E.filter(s=>s.value!==e.value)):g?k(s=>[...s,e.value]):null==N||N([e]))},className:(0,o.cn)("flex flex-col gap-y-1 border border-border p-2 rounded-md items-start text-left",e.disabled?"opacity-50 cursor-not-allowed":"transition-colors hover:bg-primary/20",e.isSelected&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[e.isSelected?(0,l.jsx)(i.Z,{className:"size-4 mr-2"}):null,(0,l.jsxs)("div",{children:[e.caption?(0,l.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.caption||""}}):null,(0,l.jsx)("p",{children:e.label}),e.description?(0,l.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.description||""}}):null]})]})})},e.value)})}),(0,l.jsxs)(c.cN,{className:"border-t border-t-border px-4 py-2 items-center w-full gap-x-2",children:[(0,l.jsx)(c.GG,{asChild:!0,children:(0,l.jsx)(n.z,{variant:"ghost",children:"Close"})}),!!I.length&&(0,l.jsx)(c.GG,{asChild:!0,children:(0,l.jsx)(n.z,{onClick:()=>{null==N||N(I.map(e=>F.find(s=>s.value===e)).filter(e=>e))},children:"Save"})})]})]})]})})}},53853:function(e,s,r){"use strict";r.d(s,{k:function(){return n}});var l=r(2265),t=r(38472),a=r(17647),i=r(53699);function n(e){let{loadOnMount:s=!0,onLoadSitesError:r}={...e},[n,d]=(0,l.useState)(!1),{alert:c}=(0,i.s)(),{getSites:o}=(0,a.b)(),[u,h]=(0,l.useState)([]),x=(0,l.useCallback)(async()=>{try{var e;d(!0);let s=(await t.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=s.errors)||void 0===e?void 0:e.length)throw Error(s.errors.join(", "));h(s.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==r?void 0:r()})}finally{d(!1)}},[o,c,r]);return(0,l.useEffect)(()=>{s&&!u.length&&x()},[u,s,x]),{loading:n,sites:u,loadSites:x}}}},function(e){e.O(0,[4868,1086,7468,6044,193,8472,231,638,2254,2860,8872,7202,3250,2840,4380,3920,1043,929,7478,7023,1744],function(){return e(e.s=58039)}),_N_E=e.O()}]);