(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3638],{44119:function(e,t,s){Promise.resolve().then(s.bind(s,26251)),Promise.resolve().then(s.bind(s,25704))},26251:function(e,t,s){"use strict";s.d(t,{DrugsLibrary:function(){return A}});var r=s(57437),a=s(2265),i=s(37440),n=s(76230),l=s(39661),d=s(44380),o=s(50495),c=s(44371),u=s(17647),x=s(17501),h=s(80929),m=s(42421),f=s(87138),g=s(46910);function j(e){let{addDrugLink:t,addFluidLink:s}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(g.h_,{children:[(0,r.jsx)(g.$F,{asChild:!0,children:(0,r.jsxs)(o.z,{variant:"outline",children:[(0,r.jsx)("span",{children:"Add"}),(0,r.jsx)(m.Z,{className:"w-4 h-4 ml-2"})]})}),(0,r.jsxs)(g.AW,{children:[(0,r.jsx)(g.Xi,{asChild:!0,children:(0,r.jsx)(f.default,{href:t,children:"New drug"})}),(0,r.jsx)(g.Xi,{asChild:!0,children:(0,r.jsx)(f.default,{href:s,children:"New fluid"})})]})]})})}var p=s(58184),v=s(38472),b=s(39343),y=s(53853),w=s(67135),N=s(86466),C=s(53699),k=s(90837),D=s(46294);function I(e){var t;let{uuids:s}=e,[n,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),{alert:x}=(0,C.s)(),{sites:h,loading:m,loadSites:f}=(0,y.k)({loadOnMount:!1,onLoadSitesError:()=>d(!1)}),{formState:{errors:g},reset:j,watch:I,setValue:E,register:F,handleSubmit:S,setError:L}=(0,b.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),Z=I("siteId"),_=I("overwriteExisting"),z=c||m,V=!!Z&&!z,A=S(async e=>{try{var t;if(e.siteId||L("siteId",{message:"Site is required"}),!V)return;u(!0);let r=(await v.Z.post("/api/drugs-library/export",{...e,uuids:s})).data;if(null===(t=r.errors)||void 0===t?void 0:t.length)throw Error(r.errors.join(", "));x({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>d(!1)})}catch(e){x({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{u(!1)}});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(k.Vq,{open:n,onOpenChange:e=>{j(),e&&f(),d(e)},children:[(0,r.jsx)(k.hg,{asChild:!0,children:(0,r.jsxs)(o.z,{className:"h-auto w-auto",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{children:s.length>1?"Export ".concat(s.length):"Export"})]})}),(0,r.jsxs)(k.cZ,{children:[(0,r.jsxs)(k.fK,{children:[(0,r.jsx)(k.$N,{children:"Export"}),(0,r.jsx)(k.Be,{className:"hidden",children:""})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(w._,{htmlFor:"siteId",children:"Site *"}),(0,r.jsxs)(D.Ph,{name:"siteId",onValueChange:e=>E("siteId",e,{shouldDirty:!0}),children:[(0,r.jsx)(D.i4,{children:(0,r.jsx)(D.ki,{placeholder:"Select site"})}),(0,r.jsx)(D.Bw,{children:(0,r.jsxs)(D.DI,{children:[(0,r.jsx)(D.n5,{children:"Sites"}),h.map(e=>{let{siteId:t,name:s}=e;return(0,r.jsx)(D.Ql,{value:t,children:s},t)})]})})]}),!!(null===(t=g.siteId)||void 0===t?void 0:t.message)&&(0,r.jsx)("div",{className:"text-xs text-danger mt-1",children:g.siteId.message})]}),(0,r.jsxs)("div",{className:(0,i.cn)("flex gap-x-2"),children:[(0,r.jsx)(N.X,{name:"overwriteExisting",id:"overwriteExisting",checked:_,onCheckedChange:()=>E("overwriteExisting",!_,{shouldDirty:!0})}),(0,r.jsx)(w._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,r.jsxs)(k.cN,{children:[(0,r.jsx)(k.GG,{asChild:!0,children:(0,r.jsx)(o.z,{variant:"ghost",children:"Cancel"})}),(0,r.jsxs)(o.z,{onClick:A,disabled:!V,children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),z&&(0,r.jsx)(l.a,{overlay:!0})]})}var E=s(45188),F=s(6649),S=s(75733),L=s(6884),Z=s(90399),_=s(61386),z=s(71239);function V(e){let{item:t,disabled:s,copyDrugs:a,deleteDrugs:i,editLink:l}=e,{confirm:d}=(0,n.t)(),c={isDraft:!!t.isDraft,userId:t.draftCreatedByUserId,dataType:t.type},u=(0,z.v)(c);return s=s||u,(0,r.jsxs)("div",{className:"flex gap-x-2",children:[(0,r.jsx)(_.O,{...c}),(0,r.jsxs)(g.h_,{children:[(0,r.jsx)(g.$F,{asChild:!0,children:(0,r.jsx)(o.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,r.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(g.AW,{children:[(0,r.jsx)(g.Xi,{asChild:!0,children:(0,r.jsx)(f.default,{href:l("".concat(t.itemId)),children:(0,r.jsx)(r.Fragment,{children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),!s&&(0,r.jsx)(g.Xi,{onClick:()=>setTimeout(()=>{d(()=>a([t.itemId]),{title:"Copy drug",message:"Are you sure you want to copy drug?<br /> <b>".concat(t.drug,"</b>"),positiveLabel:"Yes, copy",negativeLabel:"Cancel"})},0),children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Copy"]})}),!s&&(0,r.jsxs)(g.Xi,{onClick:()=>setTimeout(()=>{d(()=>i([t.itemId]),{title:"Delete drug",message:"Are you sure you want to delete drug?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,r.jsx)(Z.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Delete"})]})]})]})]})}function A(e){let{}=e,{confirm:t}=(0,n.t)(),{viewOnly:s}=(0,u.b)(),[m,f]=(0,a.useState)([]),{filteredDrugs:g,tableData:p,loading:v,addLink:b,selectedItemId:y,editLink:w,saveDrugs:N,deleteDrugs:C,copyDrugs:k}=(0,c.a)(),D=(0,a.useMemo)(()=>s,[s]);return(0,r.jsxs)(r.Fragment,{children:[v&&(0,r.jsx)(l.a,{overlay:!0}),(0,r.jsx)(h.A,{disabled:D,item:g.filter(e=>e.itemId===y)[0],onChange:N}),!!m.length&&(0,r.jsxs)(x.h,{children:[(0,r.jsx)(I,{uuids:g.filter((e,t)=>m.includes(t)).map(e=>e.itemId)}),(0,r.jsxs)(o.z,{variant:"destructive",onClick:()=>setTimeout(()=>{t(()=>C(g.filter((e,t)=>m.includes(t)).map(e=>e.itemId)),{title:"Delete drugs",message:"Are you sure you want to delete drugs?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),children:["Delete ",m.length<2?"":m.length+" items"]})]}),(0,r.jsx)(d.DataTable,{onSelect:f,selectable:!D,title:"Drugs & Fluids Library",search:{inputPlaceholder:"Search"},headerActions:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(j,{addDrugLink:b("drug"),addFluidLink:b("fluid")})}),getRowOptions:e=>{let{rowIndex:t}=e,s=g[t];return s?{className:(0,i.cn)(s.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Drug / Fluid"},{name:"Type",tdClassName:"w-[80px]"},{name:"Key"},{name:"Dosage text"},{name:"",align:"right",cellRenderer(e){let{value:t}=e,s=g.filter(e=>e.itemId===t)[0];return s?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(V,{item:s,disabled:D,copyDrugs:k,deleteDrugs:C,editLink:w})}):null}}],data:p})]})}},95317:function(e,t,s){"use strict";s.d(t,{Ei:function(){return v},FF:function(){return j},Tu:function(){return g},aM:function(){return c},bC:function(){return p},sw:function(){return u},ue:function(){return f},yo:function(){return o}});var r=s(57437),a=s(2265),i=s(13304),n=s(13027),l=s(74697),d=s(37440);let o=i.fC,c=i.xz,u=i.x8,x=i.h_,h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(i.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t})});h.displayName=i.aV.displayName;let m=(0,n.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),f=a.forwardRef((e,t)=>{let{side:s="right",className:a,children:n,hideCloseButton:o,...c}=e;return(0,r.jsxs)(x,{children:[(0,r.jsx)(h,{}),(0,r.jsxs)(i.VY,{ref:t,className:(0,d.cn)(m({side:s}),a),...c,children:[n,!0!==o&&(0,r.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=i.VY.displayName;let g=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};g.displayName="SheetHeader";let j=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};j.displayName="SheetFooter";let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(i.Dx,{ref:t,className:(0,d.cn)("text-lg font-semibold text-foreground",s),...a})});p.displayName=i.Dx.displayName;let v=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(i.dk,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",s),...a})});v.displayName=i.dk.displayName},93146:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var r=s(57437),a=s(2265),i=s(37440);let n=a.forwardRef((e,t)=>{let{className:s,noRing:a,...n}=e;return(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a&&"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",s),ref:t,...n})});n.displayName="Textarea"},53853:function(e,t,s){"use strict";s.d(t,{k:function(){return l}});var r=s(2265),a=s(38472),i=s(17647),n=s(53699);function l(e){let{loadOnMount:t=!0,onLoadSitesError:s}={...e},[l,d]=(0,r.useState)(!1),{alert:o}=(0,n.s)(),{getSites:c}=(0,i.b)(),[u,x]=(0,r.useState)([]),h=(0,r.useCallback)(async()=>{try{var e;d(!0);let t=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));x(t.data||[])}catch(e){o({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==s?void 0:s()})}finally{d(!1)}},[c,o,s]);return(0,r.useEffect)(()=>{t&&!u.length&&h()},[u,t,h]),{loading:l,sites:u,loadSites:h}}}},function(e){e.O(0,[4868,1086,7468,6044,193,8472,231,638,2254,8872,2860,7202,3134,4913,4380,3920,6323,2529,929,7478,7023,1744],function(){return e(e.s=44119)}),_N_E=e.O()}]);