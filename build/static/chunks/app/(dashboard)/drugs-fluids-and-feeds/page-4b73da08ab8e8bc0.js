(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3638],{44119:function(e,s,r){Promise.resolve().then(r.bind(r,67464)),Promise.resolve().then(r.bind(r,25704))},67464:function(e,s,r){"use strict";r.d(s,{DrugsLibrary:function(){return L}});var t=r(57437),i=r(2265),n=r(87138),a=r(45188),l=r(6649),d=r(75733),c=r(6884),o=r(90399),h=r(37440),u=r(76230),x=r(39661),g=r(46910),m=r(94638),j=r(50495),f=r(44371),v=r(17647),p=r(17501),w=r(80929),y=r(42421);function b(e){let{addDrugLink:s,addFluidLink:r}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(g.h_,{children:[(0,t.jsx)(g.$F,{asChild:!0,children:(0,t.jsxs)(j.z,{variant:"outline",children:[(0,t.jsx)("span",{children:"Add"}),(0,t.jsx)(y.Z,{className:"w-4 h-4 ml-2"})]})}),(0,t.jsxs)(g.AW,{children:[(0,t.jsx)(g.Xi,{asChild:!0,children:(0,t.jsx)(n.default,{href:s,children:"New drug"})}),(0,t.jsx)(g.Xi,{asChild:!0,children:(0,t.jsx)(n.default,{href:r,children:"New fluid"})})]})]})})}var C=r(58184),N=r(38472),E=r(39343),I=r(53853),F=r(67135),k=r(86466),S=r(53699),D=r(90837),Z=r(46294);function _(e){var s;let{uuids:r}=e,[n,a]=(0,i.useState)(!1),[l,d]=(0,i.useState)(!1),{alert:c}=(0,S.s)(),{sites:o,loading:u,loadSites:g}=(0,I.k)({loadOnMount:!1,onLoadSitesError:()=>a(!1)}),{formState:{errors:m},reset:f,watch:v,setValue:p,register:w,handleSubmit:y,setError:b}=(0,E.cI)({defaultValues:{siteId:"",overwriteExisting:!1}}),_=v("siteId"),L=v("overwriteExisting"),A=l||u,O=!!_&&!A,z=y(async e=>{try{var s;if(e.siteId||b("siteId",{message:"Site is required"}),!O)return;d(!0);let t=(await N.Z.post("/api/drugs-library/export",{...e,uuids:r})).data;if(null===(s=t.errors)||void 0===s?void 0:s.length)throw Error(t.errors.join(", "));c({variant:"success",title:"Success",message:"Data exported successfully!",onClose:()=>a(!1)})}catch(e){c({variant:"error",title:"Error",message:"Failed to export: "+e.message})}finally{d(!1)}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(D.Vq,{open:n,onOpenChange:e=>{f(),e&&g(),a(e)},children:[(0,t.jsx)(D.hg,{asChild:!0,children:(0,t.jsxs)(j.z,{className:"h-auto w-auto",children:[(0,t.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),(0,t.jsx)("span",{children:r.length>1?"Export ".concat(r.length):"Export"})]})}),(0,t.jsxs)(D.cZ,{children:[(0,t.jsxs)(D.fK,{children:[(0,t.jsx)(D.$N,{children:"Export"}),(0,t.jsx)(D.Be,{className:"hidden",children:""})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(F._,{htmlFor:"siteId",children:"Site *"}),(0,t.jsxs)(Z.Ph,{name:"siteId",onValueChange:e=>p("siteId",e,{shouldDirty:!0}),children:[(0,t.jsx)(Z.i4,{children:(0,t.jsx)(Z.ki,{placeholder:"Select site"})}),(0,t.jsx)(Z.Bw,{children:(0,t.jsxs)(Z.DI,{children:[(0,t.jsx)(Z.n5,{children:"Sites"}),o.map(e=>{let{siteId:s,name:r}=e;return(0,t.jsx)(Z.Ql,{value:s,children:r},s)})]})})]}),!!(null===(s=m.siteId)||void 0===s?void 0:s.message)&&(0,t.jsx)("div",{className:"text-xs text-danger mt-1",children:m.siteId.message})]}),(0,t.jsxs)("div",{className:(0,h.cn)("flex gap-x-2"),children:[(0,t.jsx)(k.X,{name:"overwriteExisting",id:"overwriteExisting",checked:L,onCheckedChange:()=>p("overwriteExisting",!L,{shouldDirty:!0})}),(0,t.jsx)(F._,{secondary:!0,htmlFor:"overwriteExisting",children:"Overwrite existing"})]})]}),(0,t.jsxs)(D.cN,{children:[(0,t.jsx)(D.GG,{asChild:!0,children:(0,t.jsx)(j.z,{variant:"ghost",children:"Cancel"})}),(0,t.jsxs)(j.z,{onClick:z,disabled:!O,children:[(0,t.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),A&&(0,t.jsx)(x.a,{overlay:!0})]})}function L(e){let{}=e,{confirm:s}=(0,u.t)(),{viewOnly:r}=(0,v.b)(),[y,C]=(0,i.useState)([]),{drugs:N,loading:E,addLink:I,selectedItemId:F,editLink:k,saveDrugs:S,deleteDrugs:D,copyDrugs:Z}=(0,f.a)(),L=(0,i.useMemo)(()=>r,[r]);return(0,t.jsxs)(t.Fragment,{children:[E&&(0,t.jsx)(x.a,{overlay:!0}),(0,t.jsx)(w.A,{disabled:L,item:N.filter(e=>e.itemId===F)[0],onChange:S}),!!y.length&&(0,t.jsx)(p.h,{children:(0,t.jsx)(_,{uuids:N.filter((e,s)=>y.includes(s)).map(e=>e.itemId)})}),(0,t.jsx)(m.DataTable,{onSelect:C,selectable:!L,title:"Drugs & Fluids Library",headerActions:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(b,{addDrugLink:I("drug"),addFluidLink:I("fluid")})}),getRowOptions:e=>{let{rowIndex:s}=e,r=N[s];return r?{className:(0,h.cn)(r.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},columns:[{name:"Drug / Fluid"},{name:"Type",tdClassName:"w-[80px]"},{name:"Key"},{name:"Dosage text"},{name:"",align:"right",cellRenderer(e){let{value:r}=e,i=N.filter(e=>e.itemId===r)[0];return i?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(g.h_,{children:[(0,t.jsx)(g.$F,{asChild:!0,children:(0,t.jsx)(j.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,t.jsx)(a.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(g.AW,{children:[(0,t.jsx)(g.Xi,{asChild:!0,children:(0,t.jsx)(n.default,{href:k("".concat(r)),children:(0,t.jsx)(t.Fragment,{children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),!L&&(0,t.jsx)(g.Xi,{onClick:()=>setTimeout(()=>{s(()=>Z([i.itemId]),{title:"Copy drug",message:"Are you sure you want to copy drug?<br /> <b>".concat(i.drug,"</b>"),positiveLabel:"Yes, copy",negativeLabel:"Cancel"})},0),children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{className:"mr-2 h-4 w-4"})," Copy"]})}),!L&&(0,t.jsxs)(g.Xi,{onClick:()=>setTimeout(()=>{s(()=>D([i.itemId]),{title:"Delete drug",message:"Are you sure you want to delete drug?",positiveLabel:"Yes, delete",negativeLabel:"Cancel",danger:!0})},0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Delete"})]})]})]})}):null}}],data:N.map(e=>[e.drug||"",e.type||"",e.key||"",e.dosageText||"",e.itemId])})]})}},53853:function(e,s,r){"use strict";r.d(s,{k:function(){return l}});var t=r(2265),i=r(38472),n=r(17647),a=r(53699);function l(e){let{loadOnMount:s=!0,onLoadSitesError:r}={...e},[l,d]=(0,t.useState)(!1),{alert:c}=(0,a.s)(),{getSites:o}=(0,n.b)(),[h,u]=(0,t.useState)([]),x=(0,t.useCallback)(async()=>{try{var e;d(!0);let s=(await i.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=s.errors)||void 0===e?void 0:e.length)throw Error(s.errors.join(", "));u(s.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==r?void 0:r()})}finally{d(!1)}},[o,c,r]);return(0,t.useEffect)(()=>{s&&!h.length&&x()},[h,s,x]),{loading:l,sites:h,loadSites:x}}}},function(e){e.O(0,[4868,1086,7468,6044,193,8472,638,231,2254,8872,2860,3250,3069,4638,1943,929,7478,7023,1744],function(){return e(e.s=44119)}),_N_E=e.O()}]);