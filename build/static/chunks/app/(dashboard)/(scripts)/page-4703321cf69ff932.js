(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2433],{43884:function(e,t,s){Promise.resolve().then(s.bind(s,60109)),Promise.resolve().then(s.bind(s,25704))},60109:function(e,t,s){"use strict";s.d(t,{ScriptsTable:function(){return H}});var a=s(57437),n=s(23787),r=s(6649),i=s(87138),l=s(36013),c=s(26975),d=s(44380),o=s(15701),u=s(39661),p=s(37440),h=s(17647),f=s(90399),m=s(58184),x=s(50495),g=s(17501);function y(e){let{selected:t,setScriptsIdsToExport:s,onDelete:n}=e;return t.length?(0,a.jsx)(a.Fragment,{children:!!t.length&&(0,a.jsxs)(g.h,{children:[(0,a.jsxs)(x.z,{variant:"destructive",className:"h-auto w-auto",onClick:()=>n(),children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:t.length>1?"Delete ".concat(t.length):"Delete"})]}),(0,a.jsxs)(x.z,{className:"h-auto w-auto",onClick:()=>s(),children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:t.length>1?"Export ".concat(t.length):"Export"})]})]})}):null}var j=s(45188),v=s(75733),w=s(45573),N=s(6884),b=s(46910),C=s(2265),I=s(82449),S=s(27776),k=s(20920);function Z(e){let[t,s]=(0,I.Z)(),[a,n]=(0,C.useState)(),r=(0,C.useCallback)(e=>(n((0,k.Z)()),s(e)),[s]);return(0,C.useEffect)(()=>{a&&(n(void 0),t.error?S.Am.error("Unable to copy value: ".concat(t.error.message)):t.value&&S.Am.success("Copied"+((null==e?void 0:e.showValueOnToast)?": ".concat(t.value):""),{position:"bottom-center"}))},[a,t,e]),[t,r]}function T(e){let{value:t,showValueOnToast:s=!1,...n}=e,[r,i]=Z({showValueOnToast:s});return(0,a.jsx)("div",{...n,onClick:function(){for(var e,s=arguments.length,a=Array(s),r=0;r<s;r++)a[r]=arguments[r];i("".concat(t)),null===(e=n.onClick)||void 0===e||e.call(n,...a)}})}var E=s(61386),D=s(71239);function R(e){let{item:t,disabled:s,setScriptsIdsToExport:l,onDelete:c,onDuplicate:d}=e,[o,u]=Z({showValueOnToast:!0}),p={isDraft:t.isDraft||!!t.hasChangedItems,userId:t.draftCreatedByUserId||t.itemsChangedByUserId,dataType:"script"},h=(0,D.v)(p);return(s=s||h,t)?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsx)(E.O,{...p}),(0,a.jsxs)(b.h_,{children:[(0,a.jsx)(b.$F,{asChild:!0,children:(0,a.jsx)(x.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(b.AW,{children:[(0,a.jsx)(b.Xi,{asChild:!0,children:(0,a.jsx)(i.default,{href:"/script/".concat(t.scriptId),children:(0,a.jsx)(a.Fragment,{children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),(0,a.jsxs)(b.Xi,{onClick:()=>setTimeout(()=>d(),0),children:[(0,a.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),(0,a.jsx)(b.Xi,{asChild:!0,children:(0,a.jsxs)(T,{showValueOnToast:!0,value:t.scriptId,children:[(0,a.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),"Copy ID"]})}),(0,a.jsx)(b.Xi,{asChild:!0,children:(0,a.jsxs)(i.default,{target:"_blank",href:"/scripts/".concat(t.scriptId,"/metadata"),children:[(0,a.jsx)(n.Z,{className:"mr-2 h-4 w-4"}),"View metadata"]})}),(0,a.jsx)(b.Xi,{asChild:!0,children:(0,a.jsxs)(i.default,{target:"_blank",href:"/script/".concat(t.scriptId,"/data-keys"),children:[(0,a.jsx)(n.Z,{className:"mr-2 h-4 w-4"}),"View data keys"]})}),!s&&(0,a.jsxs)(b.Xi,{onClick:()=>setTimeout(()=>c(),0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Delete"})]})]})]})]})}):null}var A=s(16463),_=s(39343),z=s(38472),V=s(90837),F=s(46294),O=s(53699),P=s(67135),M=s(74709);function q(e){var t;let{open:s,scriptsIdsToExport:n,setScriptsIdsToExport:r,onOpenChange:i}=e,{getSites:l}=(0,h.b)(),{copyScripts:c}=(0,o.h)(),{alert:d}=(0,O.s)(),p=(0,A.useRouter)(),[f,m]=(0,C.useState)(!1),[g,y]=(0,C.useState)({data:[]}),{formState:{errors:j},setValue:v,reset:w,handleSubmit:N}=(0,_.cI)({defaultValues:{siteId:""}}),b=(0,C.useMemo)(()=>f,[f]),I=(0,C.useCallback)(async()=>{try{var e;let t=(await z.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));y(t)}catch(e){d({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>i(!1)})}finally{m(!1)}},[l,d,i]),S=N(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");m(!0);let s=(await z.Z.post("/api/scripts/copy",{toRemoteSiteId:e.siteId,scriptsIds:n,broadcastAction:!0})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));p.refresh(),d({variant:"success",title:"Success",message:"Script exported successfully!",onClose:()=>{w({siteId:""}),i(!1)}})}catch(e){d({variant:"error",title:"Error",message:"Failed to export script: "+e.message})}finally{m(!1)}});return(0,C.useEffect)(()=>{s&&I()},[s,I]),(0,a.jsxs)(a.Fragment,{children:[f&&(0,a.jsx)(u.a,{overlay:!0}),(0,a.jsx)(M.u,{open:s,onOpenChange:()=>{i(!1),s||r([])},title:"Export script",actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)(V.GG,{asChild:!0,children:(0,a.jsx)(x.z,{variant:"ghost",disabled:b,onClick:()=>i(!1),children:"Cancel"})}),(0,a.jsx)(x.z,{onClick:()=>S(),disabled:b,children:"Export"})]}),children:(0,a.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"siteId",children:"Site *"}),(0,a.jsxs)(F.Ph,{name:"siteId",disabled:b,onValueChange:e=>v("siteId",e,{shouldDirty:!0}),children:[(0,a.jsx)(F.i4,{children:(0,a.jsx)(F.ki,{placeholder:"Select site"})}),(0,a.jsx)(F.Bw,{children:(0,a.jsxs)(F.DI,{children:[(0,a.jsx)(F.n5,{children:"Sites"}),g.data.map(e=>{let{siteId:t,name:s}=e;return(0,a.jsx)(F.Ql,{value:t,children:s},t)})]})})]}),!!(null===(t=j.siteId)||void 0===t?void 0:t.message)&&(0,a.jsx)("div",{className:"text-xs text-danger mt-1",children:j.siteId.message})]})})})]})}var B=s(92513),U=s(88519);function X(e){let{disabled:t}=e,[s,n]=(0,C.useState)(!1),r=(0,A.useRouter)();return t?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(U.d,{open:s,onOpenChange:n}),(0,a.jsx)("div",{className:" fixed bottom-5 right-10 z-[1] ",children:(0,a.jsxs)(b.h_,{children:[(0,a.jsx)(b.$F,{asChild:!0,children:(0,a.jsx)(x.z,{size:"icon",className:"rounded-full w-12 h-12",children:(0,a.jsx)(B.Z,{className:"h-6 w-6"})})}),(0,a.jsxs)(b.AW,{children:[(0,a.jsx)(b.Xi,{onClick:()=>r.push("/new-script"),children:"New script"}),(0,a.jsx)(b.Xi,{onClick:()=>setTimeout(()=>n(!0),0),children:"Import script"})]})]})})]})}var $=s(12599),G=s(76230),Y=s(72341);let J={value:"",filter:"all",searching:!1,results:[],unfilteredResults:[]};var K=s(64344),L=s(17750);function H(e){let{selected:t,loading:s,scriptsIdsToExport:f,disabled:m,search:x,scriptsArr:g,setSearch:j,onSearch:v,setSelected:w,setScriptsIdsToExport:N,onDelete:b,onSort:I,onDuplicate:S}=function(e){let{scripts:t}=e,[s,a]=(0,C.useState)(t),[n,r]=(0,C.useState)([]),[i,l]=(0,C.useState)(!1),[c,d]=(0,C.useState)([]),[u,p]=(0,C.useState)(J),f=(0,C.useCallback)(()=>p(J),[]);(0,C.useEffect)(()=>{a(t)},[t]);let m=(0,A.useRouter)(),{viewOnly:x}=(0,h.b)(),{confirm:g}=(0,G.t)(),{alert:y}=(0,O.s)(),{deleteScripts:j,saveScripts:v,copyScripts:w}=(0,o.h)(),N=(0,C.useCallback)(async e=>{g(async()=>{var t;let n={...s};a(t=>({...t,data:t.data.filter(t=>!e.includes(t.scriptId))})),r([]),l(!0);let i=(await z.Z.delete("/api/scripts?data="+JSON.stringify({scriptsIds:e,broadcastAction:!0}))).data;(null===(t=i.errors)||void 0===t?void 0:t.length)?y({title:"Error",message:i.errors.join(", "),variant:"error",onClose:()=>a(n)}):(r([]),m.refresh(),y({title:"Success",message:"Scripts deleted successfully!",variant:"success"})),l(!1)},{danger:!0,title:"Delete scripts",message:"Are you sure you want to delete scripts?",positiveLabel:"Yes, delete"})},[j,g,y,m,s]),b=(0,C.useCallback)(async(e,t,n)=>{let r=[],i=(0,$.q)([...s.data],e,t).map((e,t)=>{let a=s.data[t].position;return a!==e.position&&r.push({scriptId:e.scriptId,position:a}),{...e,position:a}});for(let e of(a(e=>({...e,data:i})),r)){let t=s.data.find(t=>t.scriptId===e.scriptId);t&&await Y.pb.addChange({entityId:e.scriptId,entityType:"script",entityTitle:t.title||t.printTitle||"Untitled Script",action:"update",fieldPath:"position",fieldName:"position",oldValue:t.position,newValue:e.position,description:"Position changed from ".concat(t.position," to ").concat(e.position)})}await z.Z.post("/api/scripts/save",{data:r,broadcastAction:!0}),m.refresh()},[v,s,m]),I=(0,C.useCallback)(async e=>{let t=(e=e.filter(e=>e)).map(e=>{var t;return(null===(t=s.data.filter(t=>t.scriptId===e)[0])||void 0===t?void 0:t.title)||""});g(async()=>{try{var t;if(!e.length)throw Error("No scripts selected");l(!0);let s=(await z.Z.post("/api/scripts/copy",{scriptsIds:e,broadcastAction:!0})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));m.refresh(),y({variant:"success",title:"Success",message:"Scripts duplicated successfully!"})}catch(e){y({variant:"error",title:"Error",message:"Failed to duplicate scripts: "+e.message})}finally{l(!1)}},{title:"Duplicate script",message:"<p>Are you sure you want to duplicate: ".concat(t.map(e=>"<div><b>".concat(e,"</b></div>")).join("")),positiveLabel:"Yes, duplicate"})},[g,w,y,m,s]),S=(0,C.useMemo)(()=>x,[x]),k=(0,C.useMemo)(()=>s.data.filter(e=>c.includes(e.scriptId)),[c,s]),Z=(0,C.useCallback)(async e=>{try{if(f(),e){p(e=>({...e,searching:!0}));let{data:t}=await z.Z.get("/api/scripts/search?searchValue=".concat(e));p(s=>({value:e,filter:s.filter,searching:!1,results:t.data,unfilteredResults:t.data}))}}catch(e){f()}},[f]),T=(0,C.useMemo)(()=>s.data.filter(e=>!u.value||u.results.map(e=>e.scriptId).includes(e.scriptId)),[s.data,u]);return{scripts:s,selected:n,loading:i,scriptsIdsToExport:c,disabled:S,scriptsToExport:k,search:u,scriptsArr:T,setSearch:p,clearSearch:f,onSearch:Z,setScripts:a,setSelected:r,setLoading:l,setScriptsIdsToExport:d,onDelete:N,onSort:b,onDuplicate:I}}(e),{sys:k,viewOnly:Z}=(0,h.b)(),{hospitals:T}=(0,o.h)();return(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(u.a,{overlay:!0}),!!f.length&&(0,a.jsx)(q,{open:!0,scriptsIdsToExport:f,onOpenChange:()=>N([]),setScriptsIdsToExport:N}),(0,a.jsx)(X,{disabled:m}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,a.jsx)("div",{className:"pt-4 px-4 text-2xl",children:"Scripts"}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsx)(L.f,{onSearch:v,search:x,setSearch:j})}),(0,a.jsx)(d.DataTable,{selectedIndexes:t,onSelect:w,selectable:!m,sortable:!m&&!x.value,loading:s,maxRows:25,onSort:I,getRowOptions:e=>{let{rowIndex:t}=e,s=g[t];return s?{className:(0,p.cn)(!Z&&(s.isDraft||s.hasChangedItems)&&"bg-danger/20 hover:bg-danger/30")}:{}},rowRenderer:x.value?e=>{let{props:t,cells:s,rowIndex:r}=e,o=g[r],u=x.results.find(e=>(null==e?void 0:e.scriptId)===(null==o?void 0:o.scriptId)),h=u?[...u.screens.map(e=>{let t="/script/".concat(u.scriptId,"/screen/").concat(e.screenId);return{id:e.screenId,title:e.title,type:"screen",link:t,fields:e.fields.map((s,a)=>{let n=!!e.matches.find(e=>e.fieldIndex===a);return{id:a,title:s.label,type:s.type,link:"".concat(t,"?").concat(s.type,"=").concat(a),isMatch:n}}).filter(e=>e.isMatch)}}),...u.diagnoses.map(e=>{let t="/script/".concat(u.scriptId,"/diagnosis/").concat(e.diagnosisId);return{id:e.diagnosisId,title:e.title,type:"diagnosis",link:t,fields:e.fields.map((s,a)=>{let n=!!e.matches.find(e=>e.fieldIndex===a);return{id:a,title:s.label,type:s.type,link:"".concat(t,"?"),isMatch:n}}).filter(e=>e.isMatch)}})]:[];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.SC,{...t,children:s}),!!h.length&&(0,a.jsx)(c.SC,{...t,className:(0,p.cn)(t.className,"bg-yellow-50 hover:bg-yellow-50 p-0"),children:(0,a.jsx)(c.pj,{colSpan:s.length,className:"p-0",children:(0,a.jsx)("div",{className:"flex flex-col gap-y-2",children:h.map((e,t)=>(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2 p-2 px-4",children:[(0,a.jsx)("div",{children:e.title}),(0,a.jsx)("div",{className:"ml-auto flex gap-x-2",children:(0,a.jsxs)(i.default,{href:e.link,target:"_blank",className:"flex items-center gap-x-1",children:[e.type,(0,a.jsx)(n.Z,{className:"h-3 w-3"})]})})]}),e.fields.length?(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(l.Zb,{children:(0,a.jsx)(d.DataTable,{columns:[{name:"Label",thClassName:"hidden"},{name:"",align:"right",cellClassName:"w-20 text-right",thClassName:"hidden",cellRenderer(t){let{rowIndex:s}=t,r=e.fields[s];return r?(0,a.jsxs)(i.default,{href:r.link,target:"_blank",className:"flex items-center gap-x-1",children:[r.type,(0,a.jsx)(n.Z,{className:"h-3 w-3"})]}):null}}],data:e.fields.map(e=>[e.title,""])})})}):null,t<h.length-1&&(0,a.jsx)(K.Separator,{})]},e.id))})})})]})}:void 0,noDataMessage:(0,a.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,a.jsx)("div",{children:x.value?"No matches for '".concat(x.value,"'"):"No scripts saved."})}),columns:[{name:"Position",cellRenderer(e){let{rowIndex:t}=e;return t+1}},{name:"Title"},{name:"Description"},{name:"Hospital",cellRenderer(e){var t;let{rowIndex:s}=e,a=g[s];return a?(null===(t=T.data.filter(e=>e.hospitalId===a.hospitalId)[0])||void 0===t?void 0:t.name)||"":null}},{name:"Version",align:"right",cellClassName:(0,p.cn)("w-[100px]","yes"===k.data.hide_data_table_version&&"hidden"),cellRenderer(e){let t=g[e.rowIndex];if(!t)return null;let s=t.isDraft?Math.max(0,t.version-1):t.version;return(0,a.jsxs)("div",{className:"inline-flex w-full justify-end items-center gap-x-[2px]",children:[(0,a.jsx)("div",{className:(0,p.cn)("w-2 h-2 rounded-full",s?"bg-green-400":"bg-gray-300")}),(0,a.jsx)("span",{children:s||t.version}),t.isDraft&&(0,a.jsx)(r.Z,{className:"h-4 w-4 text-muted-foreground"})]})}},{name:"Action",align:"right",cellClassName:"w-10",cellRenderer(e){let{rowIndex:t}=e,s=g[t];return s?(0,a.jsx)(R,{item:s,disabled:m,setScriptsIdsToExport:()=>N([s.scriptId]),onDelete:()=>b([s.scriptId]),onDuplicate:()=>S([s.scriptId])}):null}}],data:g.map(e=>[e.position,e.title||"",e.description||"",e.hospitalName||"",e.version,""])})]}),(0,a.jsx)(y,{selected:t,onDelete:()=>b(t.map(e=>g[e].scriptId).filter(e=>e)),setScriptsIdsToExport:()=>N(t.map(e=>g[e].scriptId).filter(e=>e))})]})}},74709:function(e,t,s){"use strict";s.d(t,{u:function(){return c}});var a=s(57437),n=s(2265),r=s(90837),i=s(37440);let l=(0,s(39099).Ue)((e,t)=>({modals:{},open(t){e(e=>({modals:{...e.modals,[t]:!0}}))},toggle(s){let a=t().modals;e(e=>({modals:{...e.modals,[s]:!a[s]}}))},close(t){e(e=>({modals:{...e.modals,[t]:!1}}))},isOpen:e=>!!t().modals[e],set(t){e(e=>({modals:{...e.modals,...t}}))}}));function c(e){let{id:t,children:s,title:c,description:d,actions:o,trigger:u,contentProps:p,footerProps:h,...f}=e,{close:m,isOpen:x,set:g}=l();return(0,n.useEffect)(()=>{t&&g({[t]:!1})},[t]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(r.Vq,{...f,open:(t?x(t):void 0)||f.open,onOpenChange:e=>{var s;t&&g({[t]:e}),null==f||null===(s=f.onOpenChange)||void 0===s||s.call(f,e)},children:[u,(0,a.jsxs)(r.cZ,{hideCloseButton:!0,className:(0,i.cn)("flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",null==p?void 0:p.className),...p,children:[(0,a.jsxs)(r.fK,{className:(0,i.cn)(c||d?"":"hidden","border-b border-b-border px-4 py-4"),children:[(0,a.jsx)(r.$N,{className:(0,i.cn)(c?"":"hidden"),children:c}),(0,a.jsx)(r.Be,{className:(0,i.cn)(d?"":"hidden"),children:d})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-y-auto px-4 py-2",children:s}),(0,a.jsx)(r.cN,{className:(0,i.cn)("border-t border-t-border px-4 py-2 items-center w-full",o?"":"hidden",null==h?void 0:h.className),...h,children:o})]})]})})}},90837:function(e,t,s){"use strict";s.d(t,{$N:function(){return x},Be:function(){return g},GG:function(){return u},Vq:function(){return c},cN:function(){return m},cZ:function(){return h},fK:function(){return f},hg:function(){return d}});var a=s(57437),n=s(2265),r=s(13304),i=s(74697),l=s(37440);let c=r.fC,d=r.xz,o=r.h_,u=r.x8,p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n})});p.displayName=r.aV.displayName;let h=n.forwardRef((e,t)=>{let{className:s,children:n,hideCloseButton:c,...d}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(p,{}),(0,a.jsxs)(r.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[n,!0!==c&&(0,a.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});h.displayName=r.VY.displayName;let f=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};f.displayName="DialogHeader";let m=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};m.displayName="DialogFooter";let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});x.displayName=r.Dx.displayName;let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})});g.displayName=r.dk.displayName},83102:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(57437),n=s(2265),r=s(37440);let i=n.forwardRef((e,t)=>{let{className:s,type:n,noRing:i,error:l,...c}=e;return(0,a.jsx)("input",{type:n,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i&&"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",l&&"border-danger",l&&!i&&"focus-visible:ring-danger",s),ref:t,...c})});i.displayName="Input"},46294:function(e,t,s){"use strict";s.d(t,{Bw:function(){return x},DI:function(){return u},Ph:function(){return o},Ql:function(){return y},U$:function(){return j},i4:function(){return h},ki:function(){return p},n5:function(){return g}});var a=s(57437),n=s(2265),r=s(17549),i=s(42421),l=s(14392),c=s(22468),d=s(37440);let o=r.fC,u=r.ZA,p=r.B4,h=n.forwardRef((e,t)=>{let{className:s,children:n,error:l,...c}=e;return(0,a.jsxs)(r.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l&&"border-danger",s),...c,children:[n,(0,a.jsx)(r.JO,{asChild:!0,children:(0,a.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=r.xz.displayName;let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})});f.displayName=r.u_.displayName;let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...n,children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=r.$G.displayName;let x=n.forwardRef((e,t)=>{let{className:s,children:n,position:i="popper",...l}=e;return(0,a.jsx)(r.h_,{children:(0,a.jsxs)(r.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...l,children:[(0,a.jsx)(f,{}),(0,a.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,a.jsx)(m,{})]})})});x.displayName=r.VY.displayName;let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...n})});g.displayName=r.__.displayName;let y=n.forwardRef((e,t)=>{let{className:s,children:n,...i}=e;return(0,a.jsxs)(r.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.wU,{children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(r.eT,{children:n})]})});y.displayName=r.ck.displayName;let j=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...n})});j.displayName=r.Z0.displayName},64344:function(e,t,s){"use strict";s.d(t,{Separator:function(){return l}});var a=s(57437),n=s(2265),r=s(48484),i=s(37440);let l=n.forwardRef((e,t)=>{let{className:s,orientation:n="horizontal",decorative:l=!0,...c}=e;return(0,a.jsx)(r.f,{ref:t,decorative:l,orientation:n,className:(0,i.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",s),...c})});l.displayName=r.f.displayName},15701:function(e,t,s){"use strict";s.d(t,{ScriptsContextProvider:function(){return u},h:function(){return o}});var a=s(57437),n=s(2265),r=s(16463),i=s(12491),l=s(38472),c=s(23733);let d=(0,n.createContext)(null),o=()=>(0,n.useContext)(d);function u(e){let{children:t,...s}=e,o=function(e){let{}=e,t=(0,r.useRouter)(),{scriptId:s}=(0,r.useParams)(),{parsed:a}=(0,c.l)(),[d,o]=(0,n.useState)(!1),[u,p]=(0,n.useState)({data:[]}),[h,f]=(0,n.useState)(!1),[m,x]=(0,n.useState)([]),g=(0,n.useCallback)(()=>{t.push("/")},[t]),y=(0,n.useCallback)(()=>{t.push("/script/".concat(s,"?").concat(i.Z.stringify({...a,section:"screens"})))},[t,a,s]),j=(0,n.useCallback)(()=>{t.push("/script/".concat(s,"?").concat(i.Z.stringify({...a,section:"diagnoses"})))},[t,a,s]),v=(0,n.useCallback)(async()=>{try{var e,t;o(!0);let a=await l.Z.get("/api/screens/list?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[s]}));if(null===(t=a.data)||void 0===t?void 0:null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(a.data.errors.join(", "));p(a.data)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{o(!1)}},[s,open,alert]);return{screens:u,screensLoading:d,keys:m,keysLoading:h,loadKeys:(0,n.useCallback)(async()=>{try{var e;f(!0);let{data:t}=await l.Z.get("/api/scripts/keys?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[s]}));if(null==t?void 0:null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));let a=t.data.reduce((e,t)=>[...e,...t.dataKeys],[]);x(a)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{f(!1)}},[s,open,alert]),loadScreens:v,onCancelDiagnosisForm:j,onCancelScreenForm:y,onCancelScriptForm:g}}(s);return(0,a.jsx)(d.Provider,{value:{...s,...o},children:t})}},23733:function(e,t,s){"use strict";s.d(t,{l:function(){return i}});var a=s(16463),n=s(12491),r=s(2265);function i(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),s=(0,r.useMemo)(()=>t.toString(),[t]),i=(0,r.useMemo)(()=>n.Z.parse(t.toString()),[t]),l=(0,r.useCallback)(e=>n.Z.stringify({...i,...e}),[i]),c=(0,r.useCallback)(t=>{e.push("?".concat(l(t)))},[l,e]);return{parsed:i,stringified:s,replace:(0,r.useCallback)(t=>{e.replace("?".concat(l(t)))},[l,e]),push:c,toSearchParams:l}}},72341:function(e,t,s){"use strict";s.d(t,{pb:function(){return i}});var a=s(14635);class n extends a.ZP{constructor(){super("NeotreeChangeLogDB"),this.version(1).stores({pendingChanges:"++id, entityId, entityType, timestamp, userId, [entityId+fieldPath]",changeSessions:"++id, sessionId, entityId, entityType, startedAt, lastModifiedAt"})}}let r=new n,i={async addChange(e){let t=Date.now(),s="string"==typeof e.entityTitle&&e.entityTitle.trim().length?e.entityTitle.trim():"".concat(e.entityType," ").concat(e.entityId);return await r.pendingChanges.add({...e,entityTitle:s,timestamp:t})},async updateChange(e,t){let s={...t};return t.entityTitle&&"string"==typeof t.entityTitle&&(s.entityTitle=t.entityTitle.trim().length>0?t.entityTitle.trim():void 0),await r.pendingChanges.update(e,s)},deleteChange:async e=>await r.pendingChanges.delete(e),async getEntityChanges(e,t){let s=r.pendingChanges.where("entityId").equals(e);return t?await s.and(e=>e.entityType===t).toArray():await s.toArray()},async getAllChangesByEntity(){let e=await r.pendingChanges.toArray(),t={};return e.forEach(e=>{let s="".concat(e.entityType,":").concat(e.entityId);t[s]||(t[s]={title:"string"==typeof e.entityTitle&&e.entityTitle.trim().length?e.entityTitle.trim():"".concat(e.entityType," ").concat(e.entityId),changes:[]}),t[s].changes.push(e)}),t},getChangeCount:async e=>e?await r.pendingChanges.where("entityId").equals(e).count():await r.pendingChanges.count(),clearEntityChanges:async(e,t)=>t?await r.pendingChanges.where("entityId").equals(e).and(e=>e.entityType===t).delete():await r.pendingChanges.where("entityId").equals(e).delete(),clearAllChanges:async()=>await r.pendingChanges.clear(),getChangesByUser:async e=>await r.pendingChanges.where("userId").equals(e).toArray(),async getRecentChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return await r.pendingChanges.orderBy("timestamp").reverse().limit(e).toArray()},async startSession(e,t,s,a){let n={sessionId:"".concat(t,"-").concat(e,"-").concat(Date.now()),entityId:e,entityType:t,entityTitle:s,startedAt:Date.now(),lastModifiedAt:Date.now(),changeCount:0,userId:a};return await r.changeSessions.add(n)},async updateSession(e){let t=await r.changeSessions.where("sessionId").equals(e).first();t&&await r.changeSessions.update(t.id,{lastModifiedAt:Date.now(),changeCount:(t.changeCount||0)+1})},endSession:async e=>await r.changeSessions.where("sessionId").equals(e).delete(),getActiveSession:async e=>await r.changeSessions.where("entityId").equals(e).first()}}},function(e){e.O(0,[4868,1086,7468,6044,8472,193,231,638,2254,4264,8872,346,7776,7747,4380,6323,2284,7478,7023,1744],function(){return e(e.s=43884)}),_N_E=e.O()}]);