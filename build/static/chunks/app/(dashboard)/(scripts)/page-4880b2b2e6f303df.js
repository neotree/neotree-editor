(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2433],{43884:function(e,t,s){Promise.resolve().then(s.bind(s,14333)),Promise.resolve().then(s.bind(s,89884))},14333:function(e,t,s){"use strict";s.d(t,{ScriptsTable:function(){return W}});var a=s(57437),r=s(96362),i=s(15868),l=s(27648),n=s(66070),c=s(73578),d=s(66024),o=s(79976),u=s(69711),p=s(94508),h=s(67132),m=s(27413),x=s(17689),f=s(62869),g=s(82425);function v(e){let{selected:t,setScriptsIdsToExport:s,onDelete:r}=e;return t.length?(0,a.jsx)(a.Fragment,{children:!!t.length&&(0,a.jsxs)(g.h,{children:[(0,a.jsxs)(f.z,{variant:"destructive",className:"h-auto w-auto",onClick:()=>r(),children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:t.length>1?"Delete ".concat(t.length):"Delete"})]}),(0,a.jsxs)(f.z,{className:"h-auto w-auto",onClick:()=>s(),children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:t.length>1?"Export ".concat(t.length):"Export"})]})]})}):null}var j=s(71533),y=s(42208),b=s(41827),w=s(78867),N=s(84190),I=s(2265),C=s(32397),S=s(14438),k=s(49360);function E(e){let[t,s]=(0,C.Z)(),[a,r]=(0,I.useState)(),i=(0,I.useCallback)(e=>(r((0,k.Z)()),s(e)),[s]);return(0,I.useEffect)(()=>{a&&(r(void 0),t.error?S.Am.error("Unable to copy value: ".concat(t.error.message)):t.value&&S.Am.success("Copied"+((null==e?void 0:e.showValueOnToast)?": ".concat(t.value):""),{position:"bottom-center"}))},[a,t,e]),[t,i]}function Z(e){let{value:t,showValueOnToast:s=!1,...r}=e,[i,l]=E({showValueOnToast:s});return(0,a.jsx)("div",{...r,onClick:function(){for(var e,s=arguments.length,a=Array(s),i=0;i<s;i++)a[i]=arguments[i];l("".concat(t)),null===(e=r.onClick)||void 0===e||e.call(r,...a)}})}var D=s(12819),T=s(24959);function F(e){let{item:t,disabled:s,setScriptsIdsToExport:n,onDelete:c,onDuplicate:d}=e,[o,u]=E({showValueOnToast:!0}),p={isDraft:t.isDraft||!!t.hasChangedItems,userId:t.draftCreatedByUserId||t.itemsChangedByUserId,dataType:"script"},h=(0,T.v)(p);return(s=s||h,t)?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsx)(D.O,{...p}),(0,a.jsxs)(N.h_,{children:[(0,a.jsx)(N.$F,{asChild:!0,children:(0,a.jsx)(f.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(N.AW,{children:[(0,a.jsx)(N.Xi,{asChild:!0,children:(0,a.jsx)(l.default,{href:"/script/".concat(t.scriptId),children:(0,a.jsx)(a.Fragment,{children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),(0,a.jsxs)(N.Xi,{onClick:()=>setTimeout(()=>d(),0),children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),(0,a.jsx)(N.Xi,{asChild:!0,children:(0,a.jsxs)(Z,{showValueOnToast:!0,value:t.scriptId,children:[(0,a.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Copy ID"]})}),(0,a.jsx)(N.Xi,{asChild:!0,children:(0,a.jsxs)(l.default,{target:"_blank",href:"/scripts/".concat(t.scriptId,"/metadata"),children:[(0,a.jsx)(r.Z,{className:"mr-2 h-4 w-4"}),"View metadata"]})}),(0,a.jsx)(N.Xi,{asChild:!0,children:(0,a.jsxs)(l.default,{target:"_blank",href:"/script/".concat(t.scriptId,"/data-keys"),children:[(0,a.jsx)(r.Z,{className:"mr-2 h-4 w-4"}),"View data keys"]})}),!s&&(0,a.jsxs)(N.Xi,{onClick:()=>setTimeout(()=>c(),0),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Delete"})]})]})]})]})}):null}var O=s(99376),R=s(29501),V=s(83464),_=s(26110),P=s(53647),z=s(98656),A=s(26815),M=s(9699);function U(e){var t;let{open:s,scriptsIdsToExport:r,setScriptsIdsToExport:i,onOpenChange:l}=e,{getSites:n}=(0,h.b)(),{copyScripts:c}=(0,o.h)(),{alert:d}=(0,z.s)(),p=(0,O.useRouter)(),[m,x]=(0,I.useState)(!1),[g,v]=(0,I.useState)({data:[]}),{formState:{errors:j},setValue:y,reset:b,handleSubmit:w}=(0,R.cI)({defaultValues:{siteId:""}}),N=(0,I.useMemo)(()=>m,[m]),C=(0,I.useCallback)(async()=>{try{var e;let t=(await V.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));v(t)}catch(e){d({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>l(!1)})}finally{x(!1)}},[n,d,l]),S=w(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");x(!0);let s=(await V.Z.post("/api/scripts/copy",{toRemoteSiteId:e.siteId,scriptsIds:r,broadcastAction:!0})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));p.refresh(),d({variant:"success",title:"Success",message:"Script exported successfully!",onClose:()=>{b({siteId:""}),l(!1)}})}catch(e){d({variant:"error",title:"Error",message:"Failed to export script: "+e.message})}finally{x(!1)}});return(0,I.useEffect)(()=>{s&&C()},[s,C]),(0,a.jsxs)(a.Fragment,{children:[m&&(0,a.jsx)(u.a,{overlay:!0}),(0,a.jsx)(M.u,{open:s,onOpenChange:()=>{l(!1),s||i([])},title:"Export script",actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)(_.GG,{asChild:!0,children:(0,a.jsx)(f.z,{variant:"ghost",disabled:N,onClick:()=>l(!1),children:"Cancel"})}),(0,a.jsx)(f.z,{onClick:()=>S(),disabled:N,children:"Export"})]}),children:(0,a.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(A._,{htmlFor:"siteId",children:"Site *"}),(0,a.jsxs)(P.Ph,{name:"siteId",disabled:N,onValueChange:e=>y("siteId",e,{shouldDirty:!0}),children:[(0,a.jsx)(P.i4,{children:(0,a.jsx)(P.ki,{placeholder:"Select site"})}),(0,a.jsx)(P.Bw,{children:(0,a.jsxs)(P.DI,{children:[(0,a.jsx)(P.n5,{children:"Sites"}),g.data.map(e=>{let{siteId:t,name:s}=e;return(0,a.jsx)(P.Ql,{value:t,children:s},t)})]})})]}),!!(null===(t=j.siteId)||void 0===t?void 0:t.message)&&(0,a.jsx)("div",{className:"text-xs text-danger mt-1",children:j.siteId.message})]})})})]})}var X=s(99397),J=s(53850);function B(e){let{disabled:t}=e,[s,r]=(0,I.useState)(!1),i=(0,O.useRouter)();return t?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J.d,{open:s,onOpenChange:r}),(0,a.jsx)("div",{className:" fixed bottom-5 right-10 z-[1] ",children:(0,a.jsxs)(N.h_,{children:[(0,a.jsx)(N.$F,{asChild:!0,children:(0,a.jsx)(f.z,{size:"icon",className:"rounded-full w-12 h-12",children:(0,a.jsx)(X.Z,{className:"h-6 w-6"})})}),(0,a.jsxs)(N.AW,{children:[(0,a.jsx)(N.Xi,{onClick:()=>i.push("/new-script"),children:"New script"}),(0,a.jsx)(N.Xi,{onClick:()=>setTimeout(()=>r(!0),0),children:"Import script"})]})]})})]})}var L=s(20657),Y=s(86180),K=s(73526),q=s(22381);let $={value:"",filter:"all",searching:!1,results:[],unfilteredResults:[]};var G=s(6512),H=s(38789);function W(e){let{selected:t,loading:s,scriptsIdsToExport:m,disabled:x,search:f,scriptsArr:g,setSearch:j,onSearch:y,setSelected:b,setScriptsIdsToExport:w,onDelete:N,onSort:C,onDuplicate:S}=function(e){let{scripts:t}=e,[s,a]=(0,I.useState)(t),[r,i]=(0,I.useState)([]),[l,n]=(0,I.useState)(!1),[c,d]=(0,I.useState)([]),[u,p]=(0,I.useState)($),m=(0,I.useCallback)(()=>p($),[]);(0,I.useEffect)(()=>{a(t)},[t]);let x=(0,O.useRouter)(),{viewOnly:f,authenticatedUser:g}=(0,h.b)(),{confirm:v}=(0,Y.t)(),{alert:j}=(0,z.s)(),{deleteScripts:y,saveScripts:b,copyScripts:w}=(0,o.h)(),N=(0,I.useCallback)(async e=>{v(async()=>{var t;let r={...s},l=s.data.filter(t=>t.scriptId&&e.includes(t.scriptId));a(t=>({...t,data:t.data.filter(t=>!e.includes(t.scriptId))})),i([]),n(!0);let c=(await V.Z.delete("/api/scripts?data="+JSON.stringify({scriptsIds:e,broadcastAction:!0}))).data;(null===(t=c.errors)||void 0===t?void 0:t.length)?j({title:"Error",message:c.errors.join(", "),variant:"error",onClose:()=>a(r)}):(await Promise.all(l.map(async e=>{(null==e?void 0:e.scriptId)&&await (0,q.KL)({entityId:e.scriptId,entityType:"script",entityTitle:e.title||e.printTitle||"Untitled Script",snapshot:e,userId:null==g?void 0:g.userId,userName:null==g?void 0:g.displayName,description:'Marked "'.concat(e.title||e.printTitle||"Untitled Script",'" for deletion')})})),i([]),x.refresh(),j({title:"Success",message:"Scripts deleted successfully!",variant:"success"})),n(!1)},{danger:!0,title:"Delete scripts",message:"Are you sure you want to delete scripts?",positiveLabel:"Yes, delete"})},[y,v,j,x,s,null==g?void 0:g.userId,null==g?void 0:g.displayName]),C=(0,I.useCallback)(async(e,t,r)=>{let i=new Map(s.data.map(e=>[e.scriptId,e.position])),l=(0,L.q)([...s.data],e,t).map((e,t)=>({...e,position:t+1})),n=[];l.forEach(e=>{let t=i.get(e.scriptId);void 0!==t&&t!==e.position&&n.push({scriptId:e.scriptId,position:e.position})}),a(e=>({...e,data:l}));try{await Promise.all(l.map(async e=>{var t;let s=i.get(e.scriptId);if(void 0===s)return;let a=(await K.pb.getEntityChanges(e.scriptId,"script")).find(e=>"position"===e.fieldPath),r=null!==(t=null==a?void 0:a.oldValue)&&void 0!==t?t:s;if(void 0===r)return;if(e.position===r){(null==a?void 0:a.id)&&await K.pb.deleteChange(a.id);return}let l="Position changed from ".concat(r," to ").concat(e.position);(null==a?void 0:a.id)?await K.pb.updateChange(a.id,{newValue:e.position,description:l,fullSnapshot:{...e}}):await K.pb.addChange({entityId:e.scriptId,entityType:"script",entityTitle:e.title||e.printTitle||"Untitled Script",action:"update",fieldPath:"position",fieldName:"position",oldValue:r,newValue:e.position,description:l,userId:null==g?void 0:g.userId,userName:null==g?void 0:g.displayName,fullSnapshot:{...e}})})),n.length&&await V.Z.post("/api/scripts/save",{data:n,broadcastAction:!0}),x.refresh()}catch(e){a(s),await Promise.all(l.map(async e=>{var t;let s=(await K.pb.getEntityChanges(e.scriptId,"script")).find(e=>"position"===e.fieldPath),a=null!==(t=null==s?void 0:s.oldValue)&&void 0!==t?t:i.get(e.scriptId);(null==s?void 0:s.id)&&(void 0===a||a===e.position?await K.pb.deleteChange(s.id):await K.pb.updateChange(s.id,{newValue:a,description:"Position rolled back to ".concat(a)}))}))}},[b,s,x,null==g?void 0:g.userId,null==g?void 0:g.displayName]),S=(0,I.useCallback)(async e=>{let t=(e=e.filter(e=>e)).map(e=>{var t;return(null===(t=s.data.filter(t=>t.scriptId===e)[0])||void 0===t?void 0:t.title)||""});v(async()=>{try{var t;if(!e.length)throw Error("No scripts selected");n(!0);let s=(await V.Z.post("/api/scripts/copy",{scriptsIds:e,broadcastAction:!0})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));x.refresh(),j({variant:"success",title:"Success",message:"Scripts duplicated successfully!"})}catch(e){j({variant:"error",title:"Error",message:"Failed to duplicate scripts: "+e.message})}finally{n(!1)}},{title:"Duplicate script",message:"<p>Are you sure you want to duplicate: ".concat(t.map(e=>"<div><b>".concat(e,"</b></div>")).join("")),positiveLabel:"Yes, duplicate"})},[v,w,j,x,s]),k=(0,I.useMemo)(()=>f,[f]),E=(0,I.useMemo)(()=>s.data.filter(e=>c.includes(e.scriptId)),[c,s]),Z=(0,I.useCallback)(async e=>{try{if(m(),e){p(e=>({...e,searching:!0}));let{data:t}=await V.Z.get("/api/scripts/search",{params:{searchValue:e}});p(s=>({value:e,filter:s.filter,searching:!1,results:t.data,unfilteredResults:t.data}))}}catch(e){m()}},[m]),D=(0,I.useMemo)(()=>s.data.filter(e=>!u.value||u.results.map(e=>e.scriptId).includes(e.scriptId)),[s.data,u]);return{scripts:s,selected:r,loading:l,scriptsIdsToExport:c,disabled:k,scriptsToExport:E,search:u,scriptsArr:D,setSearch:p,clearSearch:m,onSearch:Z,setScripts:a,setSelected:i,setLoading:n,setScriptsIdsToExport:d,onDelete:N,onSort:C,onDuplicate:S}}(e),{sys:k,viewOnly:E}=(0,h.b)(),{hospitals:Z}=(0,o.h)();return(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(u.a,{overlay:!0}),!!m.length&&(0,a.jsx)(U,{open:!0,scriptsIdsToExport:m,onOpenChange:()=>w([]),setScriptsIdsToExport:w}),(0,a.jsx)(B,{disabled:x}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,a.jsx)("div",{className:"pt-4 px-4 text-2xl",children:"Scripts"}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsx)(H.f,{onSearch:y,search:f,setSearch:j})}),(0,a.jsx)(d.DataTable,{selectedIndexes:t,onSelect:b,selectable:!x,sortable:!x&&!f.value,loading:s,maxRows:25,onSort:C,getRowOptions:e=>{let{rowIndex:t}=e,s=g[t];return s?{className:(0,p.cn)(!E&&(s.isDraft||s.hasChangedItems)&&"bg-danger/20 hover:bg-danger/30")}:{}},rowRenderer:f.value?e=>{let{props:t,cells:s,rowIndex:i}=e,o=g[i],u=f.results.find(e=>(null==e?void 0:e.scriptId)===(null==o?void 0:o.scriptId)),h=u?[...u.screens.map(e=>{let t="/script/".concat(u.scriptId,"/screen/").concat(e.screenId);return{id:e.screenId,title:e.title,type:"screen",link:t,fields:e.fields.map((s,a)=>{let r=!!e.matches.find(e=>e.fieldIndex===a);return{id:a,title:s.label,type:s.type,link:"".concat(t,"?").concat(s.type,"=").concat(a),isMatch:r}}).filter(e=>e.isMatch)}}),...u.diagnoses.map(e=>{let t="/script/".concat(u.scriptId,"/diagnosis/").concat(e.diagnosisId);return{id:e.diagnosisId,title:e.title,type:"diagnosis",link:t,fields:e.fields.map((s,a)=>{let r=!!e.matches.find(e=>e.fieldIndex===a);return{id:a,title:s.label,type:s.type,link:"".concat(t,"?"),isMatch:r}}).filter(e=>e.isMatch)}})]:[];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.SC,{...t,children:s}),!!h.length&&(0,a.jsx)(c.SC,{...t,className:(0,p.cn)(t.className,"bg-yellow-50 hover:bg-yellow-50 p-0"),children:(0,a.jsx)(c.pj,{colSpan:s.length,className:"p-0",children:(0,a.jsx)("div",{className:"flex flex-col gap-y-2",children:h.map((e,t)=>(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2 p-2 px-4",children:[(0,a.jsx)("div",{children:e.title}),(0,a.jsx)("div",{className:"ml-auto flex gap-x-2",children:(0,a.jsxs)(l.default,{href:e.link,target:"_blank",className:"flex items-center gap-x-1",children:[e.type,(0,a.jsx)(r.Z,{className:"h-3 w-3"})]})})]}),e.fields.length?(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(n.Zb,{children:(0,a.jsx)(d.DataTable,{columns:[{name:"Label",thClassName:"hidden"},{name:"",align:"right",cellClassName:"w-20 text-right",thClassName:"hidden",cellRenderer(t){let{rowIndex:s}=t,i=e.fields[s];return i?(0,a.jsxs)(l.default,{href:i.link,target:"_blank",className:"flex items-center gap-x-1",children:[i.type,(0,a.jsx)(r.Z,{className:"h-3 w-3"})]}):null}}],data:e.fields.map(e=>[e.title,""])})})}):null,t<h.length-1&&(0,a.jsx)(G.Separator,{})]},e.id))})})})]})}:void 0,noDataMessage:(0,a.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,a.jsx)("div",{children:f.value?"No matches for '".concat(f.value,"'"):"No scripts saved."})}),columns:[{name:"Position",cellRenderer(e){let{rowIndex:t}=e;return t+1}},{name:"Title"},{name:"Description"},{name:"Hospital",cellRenderer(e){var t;let{rowIndex:s}=e,a=g[s];return a?(null===(t=Z.data.filter(e=>e.hospitalId===a.hospitalId)[0])||void 0===t?void 0:t.name)||"":null}},{name:"Version",align:"right",cellClassName:(0,p.cn)("w-[100px]","yes"===k.data.hide_data_table_version&&"hidden"),cellRenderer(e){let t=g[e.rowIndex];if(!t)return null;let s=t.isDraft?Math.max(0,t.version-1):t.version;return(0,a.jsxs)("div",{className:"inline-flex w-full justify-end items-center gap-x-[2px]",children:[(0,a.jsx)("div",{className:(0,p.cn)("w-2 h-2 rounded-full",s?"bg-green-400":"bg-gray-300")}),(0,a.jsx)("span",{children:s||t.version}),t.isDraft&&(0,a.jsx)(i.Z,{className:"h-4 w-4 text-muted-foreground"})]})}},{name:"Action",align:"right",cellClassName:"w-10",cellRenderer(e){let{rowIndex:t}=e,s=g[t];return s?(0,a.jsx)(F,{item:s,disabled:x,setScriptsIdsToExport:()=>w([s.scriptId]),onDelete:()=>N([s.scriptId]),onDuplicate:()=>S([s.scriptId])}):null}}],data:g.map(e=>[e.position,e.title||"",e.description||"",e.hospitalName||"",e.version,""])})]}),(0,a.jsx)(v,{selected:t,onDelete:()=>N(t.map(e=>g[e].scriptId).filter(e=>e)),setScriptsIdsToExport:()=>w(t.map(e=>g[e].scriptId).filter(e=>e))})]})}},82425:function(e,t,s){"use strict";s.d(t,{h:function(){return l}});var a=s(57437),r=s(25994),i=s(94508);function l(e){let{children:t,className:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-16"}),(0,a.jsx)("div",{className:(0,i.cn)("\n                        fixed \n                        left-0 \n                        bottom-0 \n                        h-16 \n                        w-full \n                        border-t \n                        border-t-border \n                        z-[1] \n                        bg-primary-foreground \n                        dark:bg-background \n                        shadow-md \n                        dark:shadow-foreground/10\n                    "),children:(0,a.jsx)(r.V,{children:(0,a.jsx)("div",{className:(0,i.cn)("flex justify-end gap-x-4",s),children:t})})})]})}},25994:function(e,t,s){"use strict";s.d(t,{V:function(){return i}});var a=s(57437),r=s(94508);function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{...s,className:(0,r.cn)("w-full max-w-screen-xl mx-auto p-5",t)})}},60657:function(e,t,s){"use strict";s.d(t,{_:function(){return l}});var a=s(57437),r=s(66070),i=s(94508);function l(e){let{color:t,children:s,errors:l=[]}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(r.Zb,{className:(0,i.cn)("bg-destructive/20 border-destructive text-destructive","warning"===t&&"bg-yellow-200/20 border-yellow-400 text-yellow-600"),children:(0,a.jsxs)(r.aY,{className:"flex flex-col gap-y-4 px-4 py-2",children:[s,!!l.length&&(0,a.jsx)("div",{children:l.map((e,t)=>(0,a.jsx)("p",{children:e},"".concat(t)))})]})})})}},12819:function(e,t,s){"use strict";s.d(t,{O:function(){return p}});var a=s(57437),r=s(2265),i=s(66337),l=s(57054),n=s(24959),c=s(94508),d=s(69711),o=s(83464),u=s(60657);let p=(0,r.forwardRef)((e,t)=>{let{isDraft:s,userId:p,dataType:h,card:m}=e,x=(0,n.v)({isDraft:s,userId:p});(0,r.useImperativeHandle)(t,()=>({isLocked:x}),[x]);let{loading:f,error:g,user:v,getUser:j}=function(e){let{userId:t,loadOnMount:s=!1}=e,a=(0,r.useRef)(!1),[i,l]=(0,r.useState)(!1),[n,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(""),p=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;try{if(u(""),!i&&t){l(!0);let t=(await o.Z.get("/api/users/".concat(e))).data;c(t)}}catch(e){u(e.message)}finally{l(!1)}},[i,t]);return(0,r.useEffect)(()=>{s&&!a.current&&(a.current=!0,p())},[s,p]),{loading:i,user:n,error:d,getUser:p}}({userId:p,loadOnMount:!!m}),y=(0,r.useCallback)(async e=>{e&&!f&&!v&&p&&j()},[p,v,f]);return m&&x&&!f?(0,a.jsx)(u._,{children:(0,a.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),v?(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:v.displayName})," is working on this ",h||""]}):null]})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(l.J2,{onOpenChange:y,children:[(0,a.jsx)(l.xo,{asChild:!0,children:(0,a.jsx)("button",{disabled:!x,children:(0,a.jsx)(i.Z,{className:(0,c.cn)("w-4 h-4 text-destructive/80",!x&&"opacity-0")})})}),(0,a.jsx)(l.yk,{className:"p-0 text-sm max-w-[200px]",children:f?(0,a.jsx)("div",{className:"p-2 flex justify-center",children:(0,a.jsx)(d.a,{padding:0})}):g||!v?(0,a.jsx)("div",{className:"p-2 text-destructive bg-destructive/20",children:g||"Failed to load user!"}):(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsx)("strong",{children:v.displayName})," is working on this ",h||""]})})]})})});p.displayName="LockStatus"},9699:function(e,t,s){"use strict";s.d(t,{u:function(){return c}});var a=s(57437),r=s(2265),i=s(26110),l=s(94508);let n=(0,s(59625).Ue)((e,t)=>({modals:{},open(t){e(e=>({modals:{...e.modals,[t]:!0}}))},toggle(s){let a=t().modals;e(e=>({modals:{...e.modals,[s]:!a[s]}}))},close(t){e(e=>({modals:{...e.modals,[t]:!1}}))},isOpen:e=>!!t().modals[e],set(t){e(e=>({modals:{...e.modals,...t}}))}}));function c(e){let{id:t,children:s,title:c,description:d,actions:o,trigger:u,contentProps:p,footerProps:h,...m}=e,{close:x,isOpen:f,set:g}=n();return(0,r.useEffect)(()=>{t&&g({[t]:!1})},[t]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(i.Vq,{...m,open:(t?f(t):void 0)||m.open,onOpenChange:e=>{var s;t&&g({[t]:e}),null==m||null===(s=m.onOpenChange)||void 0===s||s.call(m,e)},children:[u,(0,a.jsxs)(i.cZ,{hideCloseButton:!0,className:(0,l.cn)("flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",null==p?void 0:p.className),...p,children:[(0,a.jsxs)(i.fK,{className:(0,l.cn)(c||d?"":"hidden","border-b border-b-border px-4 py-4"),children:[(0,a.jsx)(i.$N,{className:(0,l.cn)(c?"":"hidden"),children:c}),(0,a.jsx)(i.Be,{className:(0,l.cn)(d?"":"hidden"),children:d})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-y-auto px-4 py-2",children:s}),(0,a.jsx)(i.cN,{className:(0,l.cn)("border-t border-t-border px-4 py-2 items-center w-full",o?"":"hidden",null==h?void 0:h.className),...h,children:o})]})]})})}},57054:function(e,t,s){"use strict";s.d(t,{J2:function(){return n},xo:function(){return c},yk:function(){return d}});var a=s(57437),r=s(2265),i=s(51777),l=s(94508);let n=i.fC,c=i.xz,d=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:n=4,...c}=e;return(0,a.jsx)(i.h_,{children:(0,a.jsx)(i.VY,{ref:t,align:r,sideOffset:n,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...c})})});d.displayName=i.VY.displayName},6512:function(e,t,s){"use strict";s.d(t,{Separator:function(){return n}});var a=s(57437),r=s(2265),i=s(90759),l=s(94508);let n=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:n=!0,...c}=e;return(0,a.jsx)(i.f,{ref:t,decorative:n,orientation:r,className:(0,l.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...c})});n.displayName=i.f.displayName},79976:function(e,t,s){"use strict";s.d(t,{ScriptsContextProvider:function(){return u},h:function(){return o}});var a=s(57437),r=s(2265),i=s(99376),l=s(78062),n=s(83464),c=s(72648);let d=(0,r.createContext)(null),o=()=>(0,r.useContext)(d);function u(e){let{children:t,...s}=e,o=function(e){let{}=e,t=(0,i.useRouter)(),{scriptId:s}=(0,i.useParams)(),{parsed:a}=(0,c.l)(),[d,o]=(0,r.useState)(!1),[u,p]=(0,r.useState)({data:[]}),[h,m]=(0,r.useState)(!1),[x,f]=(0,r.useState)([]),g=(0,r.useCallback)(()=>{t.push("/")},[t]),v=(0,r.useCallback)(()=>{t.push("/script/".concat(s,"?").concat(l.Z.stringify({...a,section:"screens"})))},[t,a,s]),j=(0,r.useCallback)(()=>{t.push("/script/".concat(s,"?").concat(l.Z.stringify({...a,section:"diagnoses"})))},[t,a,s]),y=(0,r.useCallback)(async()=>{try{var e,t;o(!0);let a=await n.Z.get("/api/screens/list?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[s]}));if(null===(t=a.data)||void 0===t?void 0:null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(a.data.errors.join(", "));p(a.data)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{o(!1)}},[s,open,alert]);return{screens:u,screensLoading:d,keys:x,keysLoading:h,loadKeys:(0,r.useCallback)(async()=>{try{var e;m(!0);let{data:t}=await n.Z.get("/api/scripts/keys?data="+JSON.stringify({returnDraftsIfExist:!0,scriptsIds:[s]}));if(null==t?void 0:null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));let a=t.data.reduce((e,t)=>[...e,...t.dataKeys],[]);f(a)}catch(e){alert({title:"",message:"Error: "+e.message,variant:"error"})}finally{m(!1)}},[s,open,alert]),loadScreens:y,onCancelDiagnosisForm:j,onCancelScreenForm:v,onCancelScriptForm:g}}(s);return(0,a.jsx)(d.Provider,{value:{...s,...o},children:t})}},72648:function(e,t,s){"use strict";s.d(t,{l:function(){return l}});var a=s(99376),r=s(78062),i=s(2265);function l(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),s=(0,i.useMemo)(()=>t.toString(),[t]),l=(0,i.useMemo)(()=>r.Z.parse(t.toString()),[t]),n=(0,i.useCallback)(e=>r.Z.stringify({...l,...e}),[l]),c=(0,i.useCallback)(t=>{e.push("?".concat(n(t)))},[n,e]);return{parsed:l,stringified:s,replace:(0,i.useCallback)(t=>{e.replace("?".concat(n(t)))},[n,e]),push:c,toSearchParams:n}}},8272:function(e,t){"use strict";t.Z=e=>"".concat(e||"").charAt(0).toUpperCase()+"".concat(e||"").slice(1)}},function(e){e.O(0,[6137,2696,3186,9327,5972,3464,7790,2972,1043,3238,604,9501,5966,6651,20,4438,5811,1935,6024,7404,5330,7478,2117,1744],function(){return e(e.s=43884)}),_N_E=e.O()}]);