(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2433],{35158:function(e,s,t){Promise.resolve().then(t.bind(t,60109)),Promise.resolve().then(t.bind(t,25704))},60109:function(e,s,t){"use strict";t.d(s,{ScriptsTable:function(){return P}});var r=t(57437),a=t(6649),n=t(75944),l=t(15701),i=t(39661),c=t(37440),o=t(53453),d=t(90399),u=t(58184),h=t(50495),x=t(17501);function p(e){let{selected:s,setScriptsIdsToExport:t,onDelete:a}=e;return s.length?(0,r.jsx)(r.Fragment,{children:!!s.length&&(0,r.jsxs)(x.h,{children:[(0,r.jsxs)(h.z,{variant:"destructive",className:"h-auto w-auto",onClick:()=>a(),children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{children:s.length>1?"Delete ".concat(s.length):"Delete"})]}),(0,r.jsxs)(h.z,{className:"h-auto w-auto",onClick:()=>t(),children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{children:s.length>1?"Export ".concat(s.length):"Export"})]})]})}):null}var m=t(87138),j=t(45188),f=t(75733),v=t(45573),g=t(6884),w=t(46910),b=t(2265),N=t(82449),y=t(27776),C=t(20920);function I(e){let[s,t]=(0,N.Z)(),[r,a]=(0,b.useState)(),n=(0,b.useCallback)(e=>(a((0,C.Z)()),t(e)),[t]);return(0,b.useEffect)(()=>{r&&(a(void 0),s.error?y.Am.error("Unable to copy value: ".concat(s.error.message)):s.value&&y.Am.success("Copied"+((null==e?void 0:e.showValueOnToast)?": ".concat(s.value):""),{position:"bottom-center"}))},[r,s,e]),[s,n]}function S(e){let{value:s,showValueOnToast:t=!1,...a}=e,[n,l]=I({showValueOnToast:t});return(0,r.jsx)("div",{...a,onClick:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];l("".concat(s)),null===(e=a.onClick)||void 0===e||e.call(a,...r)}})}function E(e){let{item:s,disabled:t,setScriptsIdsToExport:n,onDelete:l,onDuplicate:i}=e,[c,o]=I({showValueOnToast:!0});return s?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(w.h_,{children:[(0,r.jsx)(w.$F,{asChild:!0,children:(0,r.jsx)(h.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,r.jsx)(j.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(w.AW,{children:[(0,r.jsx)(w.Xi,{asChild:!0,children:(0,r.jsx)(m.default,{href:"/script/".concat(s.scriptId),children:(0,r.jsx)(r.Fragment,{children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{className:"mr-2 h-4 w-4"})," View"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{className:"mr-2 h-4 w-4"})," Edit"]})})})}),(0,r.jsxs)(w.Xi,{onClick:()=>i(),children:[(0,r.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),(0,r.jsxs)(w.Xi,{onClick:()=>n(),children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Export"]}),(0,r.jsx)(w.Xi,{asChild:!0,children:(0,r.jsxs)(S,{showValueOnToast:!0,value:s.scriptId,children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Copy ID"]})}),!t&&(0,r.jsxs)(w.Xi,{onClick:()=>l(),className:"text-danger focus:bg-danger focus:text-danger-foreground",children:[(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Delete"})]})]})]})}):null}var k=t(16463),D=t(39343),F=t(90837),Z=t(46294),A=t(53699),_=t(67135),R=t(9704);function z(e){var s;let{open:t,scriptsIdsToExport:a,setScriptsIdsToExport:n,onOpenChange:c}=e,{getSites:d}=(0,o.b)(),{copyScripts:u}=(0,l.h)(),{alert:x}=(0,A.s)(),p=(0,k.useRouter)(),[m,j]=(0,b.useState)(!1),[f,v]=(0,b.useState)({data:[]}),{formState:{errors:g},setValue:w,reset:N,handleSubmit:y}=(0,D.cI)({defaultValues:{siteId:""}}),C=(0,b.useMemo)(()=>m,[m]),I=(0,b.useCallback)(async()=>{try{var e;let s=await d({types:["webeditor"]});if(null===(e=s.errors)||void 0===e?void 0:e.length)throw Error(s.errors.join(", "));v(s)}catch(e){x({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>c(!1)})}finally{j(!1)}},[d,x,c]),S=y(async e=>{try{var s;if(!e.siteId)throw Error("Please select a site!");j(!0);let t=await u({toRemoteSiteId:e.siteId,scriptsIds:a,broadcastAction:!0});if(null===(s=t.errors)||void 0===s?void 0:s.length)throw Error(t.errors.join(", "));p.refresh(),x({variant:"success",title:"Success",message:"Script exported successfully!",onClose:()=>{N({siteId:""}),c(!1)}})}catch(e){x({variant:"error",title:"Error",message:"Failed to export script: "+e.message})}finally{j(!1)}});return(0,b.useEffect)(()=>{t&&I()},[t,I]),(0,r.jsxs)(r.Fragment,{children:[m&&(0,r.jsx)(i.a,{overlay:!0}),(0,r.jsx)(R.u,{open:t,onOpenChange:()=>{c(!1),t||n([])},title:"Export script",actions:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsx)(F.GG,{asChild:!0,children:(0,r.jsx)(h.z,{variant:"ghost",disabled:C,onClick:()=>c(!1),children:"Cancel"})}),(0,r.jsx)(h.z,{onClick:()=>S(),disabled:C,children:"Export"})]}),children:(0,r.jsx)("div",{className:"flex flex-col gap-y-5",children:(0,r.jsxs)("div",{children:[(0,r.jsx)(_._,{htmlFor:"siteId",children:"Site *"}),(0,r.jsxs)(Z.Ph,{name:"siteId",disabled:C,onValueChange:e=>w("siteId",e,{shouldDirty:!0}),children:[(0,r.jsx)(Z.i4,{children:(0,r.jsx)(Z.ki,{placeholder:"Select site"})}),(0,r.jsx)(Z.Bw,{children:(0,r.jsxs)(Z.DI,{children:[(0,r.jsx)(Z.n5,{children:"Sites"}),f.data.map(e=>{let{siteId:s,name:t}=e;return(0,r.jsx)(Z.Ql,{value:s,children:t},s)})]})})]}),!!(null===(s=g.siteId)||void 0===s?void 0:s.message)&&(0,r.jsx)("div",{className:"text-xs text-danger mt-1",children:g.siteId.message})]})})})]})}var T=t(92513),O=t(88519);function V(e){let{disabled:s}=e,[t,a]=(0,b.useState)(!1),n=(0,k.useRouter)();return s?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.d,{open:t,onOpenChange:a}),(0,r.jsx)("div",{className:" fixed bottom-5 right-10 z-[1] ",children:(0,r.jsxs)(w.h_,{children:[(0,r.jsx)(w.$F,{asChild:!0,children:(0,r.jsx)(h.z,{size:"icon",className:"rounded-full w-12 h-12",children:(0,r.jsx)(T.Z,{className:"h-6 w-6"})})}),(0,r.jsxs)(w.AW,{children:[(0,r.jsx)(w.Xi,{onClick:()=>n.push("/new-script"),children:"New script"}),(0,r.jsx)(w.Xi,{onClick:()=>a(!0),children:"Import script"})]})]})})]})}var X=t(76230);function P(e){let{scripts:s,selected:t,loading:d,scriptsIdsToExport:u,disabled:h,setSelected:x,setScriptsIdsToExport:m,onDelete:j,onSort:f,onDuplicate:v}=function(e){let{scripts:s}=e,[t,r]=(0,b.useState)(s),[a,n]=(0,b.useState)([]),[i,c]=(0,b.useState)(!1),[d,u]=(0,b.useState)([]);(0,b.useEffect)(()=>{r(s)},[s]);let h=(0,k.useRouter)(),{viewOnly:x}=(0,o.b)(),{confirm:p}=(0,X.t)(),{alert:m}=(0,A.s)(),{deleteScripts:j,saveScripts:f,copyScripts:v}=(0,l.h)(),g=(0,b.useCallback)(async e=>{p(async()=>{var s;let a={...t};r(s=>({...s,data:s.data.filter(s=>!e.includes(s.scriptId))})),n([]),c(!0);let l=await j({scriptsIds:e,broadcastAction:!0});(null===(s=l.errors)||void 0===s?void 0:s.length)?m({title:"Error",message:l.errors.join(", "),variant:"error",onClose:()=>r(a)}):(n([]),h.refresh(),m({title:"Success",message:"Scripts deleted successfully!",variant:"success"})),c(!1)},{danger:!0,title:"Delete scripts",message:"Are you sure you want to delete scripts?",positiveLabel:"Yes, delete"})},[j,p,m,h,t]),w=(0,b.useCallback)(async(e,s,a)=>{let n=[],l=a.map(e=>{let{oldIndex:s,newIndex:r}=e,a=t.data[s],l=a.position;return s!==r&&(l=r+1,n.push({scriptId:a.scriptId,position:l})),{...a,position:l}}).sort((e,s)=>e.position-s.position);r(e=>({...e,data:l})),await f({data:n,broadcastAction:!0}),h.refresh()},[f,t,h]),N=(0,b.useCallback)(async e=>{let s=(e=e.filter(e=>e)).map(e=>{var s;return(null===(s=t.data.filter(s=>s.scriptId===e)[0])||void 0===s?void 0:s.title)||""});p(async()=>{try{var s;if(!e.length)throw Error("No scripts selected");c(!0);let t=await v({scriptsIds:e,broadcastAction:!0});if(null===(s=t.errors)||void 0===s?void 0:s.length)throw Error(t.errors.join(", "));h.refresh(),m({variant:"success",title:"Success",message:"Scripts duplicated successfully!"})}catch(e){m({variant:"error",title:"Error",message:"Failed to duplicate scripts: "+e.message})}finally{c(!1)}},{title:"Duplicate script",message:"<p>Are you sure you want to duplicate: ".concat(s.map(e=>"<div><b>".concat(e,"</b></div>")).join("")),positiveLabel:"Yes, duplicate"})},[p,v,m,h,t]),y=(0,b.useMemo)(()=>x,[x]),C=(0,b.useMemo)(()=>t.data.filter(e=>d.includes(e.scriptId)),[d,t]);return{scripts:t,selected:a,loading:i,scriptsIdsToExport:d,disabled:y,scriptsToExport:C,setScripts:r,setSelected:n,setLoading:c,setScriptsIdsToExport:u,onDelete:g,onSort:w,onDuplicate:N}}(e),{sys:g,viewOnly:w}=(0,o.b)(),{hospitals:N}=(0,l.h)();return(0,r.jsxs)(r.Fragment,{children:[d&&(0,r.jsx)(i.a,{overlay:!0}),!!u.length&&(0,r.jsx)(z,{open:!0,scriptsIdsToExport:u,onOpenChange:()=>m([]),setScriptsIdsToExport:m}),(0,r.jsx)(V,{disabled:h}),(0,r.jsx)("div",{className:"",children:(0,r.jsx)(n.DataTable,{selectedIndexes:t,onSelect:x,title:"Scripts",selectable:!h,sortable:!h,loading:d,maxRows:25,onSort:f,getRowOptions:e=>{let{rowIndex:t}=e,r=s.data[t];return r?{className:(0,c.cn)(!w&&r.isDraft&&"bg-danger/20 hover:bg-danger/30")}:{}},search:{inputPlaceholder:"Search scripts"},noDataMessage:(0,r.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,r.jsx)("div",{children:"No scripts saved."})}),columns:[{name:"Position",cellRenderer(e){let{rowIndex:s}=e;return s+1}},{name:"Title"},{name:"Description"},{name:"Hospital",cellRenderer(e){var t;let{rowIndex:r}=e,a=s.data[r];return a?(null===(t=N.data.filter(e=>e.hospitalId===a.hospitalId)[0])||void 0===t?void 0:t.name)||"":null}},{name:"Version",align:"right",cellClassName:(0,c.cn)("w-[100px]","yes"===g.data.hide_data_table_version&&"hidden"),cellRenderer(e){let t=s.data[e.rowIndex];if(!t)return null;let n=t.isDraft?Math.max(0,t.version-1):t.version;return(0,r.jsxs)("div",{className:"inline-flex w-full justify-end items-center gap-x-[2px]",children:[(0,r.jsx)("div",{className:(0,c.cn)("w-2 h-2 rounded-full",n?"bg-green-400":"bg-gray-300")}),(0,r.jsx)("span",{children:n||t.version}),t.isDraft&&(0,r.jsx)(a.Z,{className:"h-4 w-4 text-muted-foreground"})]})}},{name:"Action",align:"right",cellClassName:"w-10",cellRenderer(e){let{rowIndex:t}=e,a=s.data[t];return a?(0,r.jsx)(E,{item:a,disabled:h,setScriptsIdsToExport:()=>m([a.scriptId]),onDelete:()=>j([a.scriptId]),onDuplicate:()=>v([a.scriptId])}):null}}],data:s.data.map(e=>[e.position,e.title||"",e.description||"",e.hospitalName||"",e.version,""])})}),(0,r.jsx)(p,{selected:t,onDelete:()=>j(t.map(e=>s.data[e].scriptId).filter(e=>e)),setScriptsIdsToExport:()=>m(t.map(e=>s.data[e].scriptId).filter(e=>e))})]})}},17501:function(e,s,t){"use strict";t.d(s,{h:function(){return l}});var r=t(57437),a=t(77606),n=t(37440);function l(e){let{children:s,className:t}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-16"}),(0,r.jsx)("div",{className:(0,n.cn)("\n                        fixed \n                        left-0 \n                        bottom-0 \n                        h-16 \n                        w-full \n                        border-t \n                        border-t-border \n                        z-[1] \n                        bg-primary-foreground \n                        dark:bg-background \n                        shadow-md \n                        dark:shadow-foreground/10\n                    "),children:(0,r.jsx)(a.V,{children:(0,r.jsx)("div",{className:(0,n.cn)("flex justify-end gap-x-4",t),children:s})})})]})}},77606:function(e,s,t){"use strict";t.d(s,{V:function(){return n}});var r=t(57437),a=t(37440);function n(e){let{className:s,...t}=e;return(0,r.jsx)("div",{...t,className:(0,a.cn)("w-full max-w-screen-xl mx-auto p-5",s)})}}},function(e){e.O(0,[4868,5360,8429,2592,9343,7946,1072,231,4549,1344,3312,5944,3954,7478,7023,1744],function(){return e(e.s=35158)}),_N_E=e.O()}]);