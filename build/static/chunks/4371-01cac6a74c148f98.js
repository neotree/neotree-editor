"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4371],{44371:function(e,t,a){a.d(t,{R:function(){return f},a:function(){return m}});var r=a(2265),s=a(16463),l=a(12491),i=a(38472),n=a(39099),o=a(53699),d=a(7752),u=a(43088);let c={value:"",filter:"all",searching:!1,results:[],unfilteredResults:[]},g={initialised:!1,loading:!1,keys:[],drugs:[],typeFilter:"",statusFilter:"",sortBy:"name-asc"},y=(0,n.Ue)(e=>g);function f(){y.setState(g)}function m(){let e=y(),{drugs:t,typeFilter:a,statusFilter:n,sortBy:f}=e,m=(0,s.useRouter)(),v=(0,s.useSearchParams)(),k=(0,r.useMemo)(()=>l.Z.parse(v.toString()),[v]),{itemId:p}=k,h=(0,r.useMemo)(()=>{var e;return null===(e=t.filter(e=>e.itemId===p||e.key===p)[0])||void 0===e?void 0:e.itemId},[p,t]),{alert:b}=(0,o.s)(),[w,C]=(0,r.useState)(c),S=(0,r.useCallback)(()=>C(c),[]),I=(0,r.useCallback)(()=>{let e=[],r=w.value?new Set(w.results.map(e=>e.itemId)):void 0,s=t.map(e=>[e.drug||"",e.type||"",e.key||"",e.dosageText||"",e.itemId]),l=[...s=s.filter((s,l)=>{let i=t[l];if(!i)return!1;let o=!0;return r&&(o=r.has(i.itemId)),o&&a&&"all"!==a&&(o=(i.type||"").toLowerCase()===a.toLowerCase()),o&&n&&"all"!==n&&("draft"===n?o=!0===i.isDraft:"published"===n&&(o=!i.isDraft)),o&&e.push(t[l]),o})],i=[...e],o=l.map((e,t)=>({row:e,drug:i[t]}));switch(f){case"name-asc":o.sort((e,t)=>(e.drug.drug||"").localeCompare(t.drug.drug||""));break;case"name-desc":o.sort((e,t)=>(t.drug.drug||"").localeCompare(e.drug.drug||""));break;case"type-asc":o.sort((e,t)=>(e.drug.type||"").localeCompare(t.drug.type||""));break;case"type-desc":o.sort((e,t)=>(t.drug.type||"").localeCompare(e.drug.type||""));break;case"key-asc":o.sort((e,t)=>(e.drug.key||"").localeCompare(t.drug.key||""));break;case"key-desc":o.sort((e,t)=>(t.drug.key||"").localeCompare(e.drug.key||""))}return{tableData:o.map(e=>e.row),filteredDrugs:o.map(e=>e.drug)}},[t,w,a,n,f]),_=(0,r.useCallback)(async e=>{try{var t;S();let a="".concat(e||"").trim();if(!a)return;C(e=>({...e,value:a,searching:!0}));let{data:r}=await i.Z.get("/api/drugs-library/search?searchValue=".concat(encodeURIComponent(a)));if(null===(t=r.errors)||void 0===t?void 0:t.length)throw Error(r.errors.join(", "));C(e=>{let t=r.data||[];return{value:a,filter:e.filter,searching:!1,results:(0,u.UZ)({searchValue:a,filter:e.filter,results:t}),unfilteredResults:t}})}catch(e){S()}},[S]),{tableData:E,filteredDrugs:T}=(0,r.useMemo)(()=>I(),[I]),D=(0,r.useCallback)(async()=>{try{var e,t;y.setState({loading:!0});let a=await i.Z.get("/api/drugs-library?data="+JSON.stringify({returnDraftsIfExist:!0}));if(null===(e=a.data.errors)||void 0===e?void 0:e.length)throw Error(null===(t=a.data.errors)||void 0===t?void 0:t.join(", "));y.setState({drugs:a.data.data})}catch(e){b({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[b]);!function(e){let{events:t}=e,a=(0,r.useMemo)(()=>t,[t]),l=(0,r.useRef)({eventsTimeouts:{},eventsTimestamps:{}});(0,r.useRef)(new Date().getTime());let i=(0,s.useRouter)();(0,r.useEffect)(()=>{a.forEach(e=>{let{name:t,action:a,delay:r=100,onEvent:s}=e;d.Z.on(t,function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let d=()=>{var e,r;(!a||n[0]===a)&&(null===(e=s.callback)||void 0===e||e.call(s,...n),(null==s?void 0:s.refreshRouter)&&(console.log(t,"refreshing..."),i.refresh()),(null===(r=s.redirect)||void 0===r?void 0:r.to)&&(s.redirect.replace?i.replace(s.redirect.to):i.push(s.redirect.to)))},u=new Date().getTime();r?(clearTimeout(l.current.eventsTimeouts[t]),l.current.eventsTimeouts[t]=setTimeout(()=>{l.current.eventsTimestamps[t]=u,d()},r)):(l.current.eventsTimestamps[t]=new Date().getTime(),d())})})},[a,i])}({events:[{name:"data_changed",onEvent:{callback:async()=>{await D(),m.refresh()}}}]});let Z=(0,r.useCallback)(async e=>{try{var t,a;y.setState(t=>({loading:!0,drugs:t.drugs.filter(t=>!e.includes(t.itemId))}));let r=await i.Z.delete("/api/drugs-library?data="+JSON.stringify({itemsIds:e}));if(null===(t=r.data.errors)||void 0===t?void 0:t.length)throw Error(null===(a=r.data.errors)||void 0===a?void 0:a.join(", "));m.refresh(),b({title:"",message:"Drug deleted successfully!",variant:"success"})}catch(e){b({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[b,m.refresh]),K=(0,r.useCallback)(async e=>{try{var a,r;y.setState({loading:!0});let s=[],l=[],n=t;y.setState(t=>(n=!h&&e?[...t.drugs,e]:t.drugs.map(t=>t.itemId!==(null==e?void 0:e.itemId)?t:(e&&(t.key!==e.key&&l.push({old:t.key,new:e.key}),t.type!==e.type&&s.push(t.key)),{...t,...e})),{loading:!0,drugs:n}));let o={data:e?[e]:n,broadcastAction:!0},d=await i.Z.post("/api/drugs-library/save",o);if(null===(a=d.data.errors)||void 0===a?void 0:a.length)throw Error(null===(r=d.data.errors)||void 0===r?void 0:r.join(", "));await D(),m.refresh(),b({title:"",message:"Drug".concat(e?"":"s"," saved successfully!"),variant:"success"})}catch(e){b({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[t,h,m.refresh]),R=(0,r.useCallback)(async e=>{try{var t,a;y.setState({loading:!0});let r={data:e.map(e=>({itemId:e})),broadcastAction:!0},s=await i.Z.post("/api/drugs-library/copy",r);if(null===(t=s.data.errors)||void 0===t?void 0:t.length)throw Error(null===(a=s.data.errors)||void 0===a?void 0:a.join(", "));await D(),m.refresh(),b({title:"",message:"Drug".concat(e.length<2?"":"s"," copied successfully!"),variant:"success"})}catch(e){b({title:"Error",message:e.message,variant:"error"})}finally{y.setState({loading:!1})}},[m.refresh]);(0,r.useEffect)(()=>{y.getState().initialised||(D(),y.setState({initialised:!0}))},[D]),(0,r.useCallback)(()=>{y.setState(g)},[]);let L=(0,r.useCallback)(e=>{y.setState({typeFilter:e})},[]),x=(0,r.useCallback)(e=>{y.setState({statusFilter:e})},[]),j=(0,r.useCallback)(e=>{y.setState({sortBy:e})},[]);return{...e,search:w,filteredDrugs:T,tableData:E,selectedItemId:h,addLink:e=>"?".concat(l.Z.stringify({...k,addItem:e})),editLink:e=>"?".concat(l.Z.stringify({...k,itemId:e})),getDrugs:D,deleteDrugs:Z,saveDrugs:K,copyDrugs:R,setSearch:C,clearSearch:S,onSearch:_,setTypeFilter:L,setStatusFilter:x,setSortBy:j}}},43088:function(e,t,a){a.d(t,{UZ:function(){return l},kv:function(){return r}});let r=[{value:"all",label:"All matches"},{value:"data_key",label:"Data keys only"},{value:"key_id",label:"Key IDs only"},{value:"label",label:"Label text only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],s={key:"data_key",gestationKey:"data_key",weightKey:"data_key",diagnosisKey:"data_key",ageKey:"data_key",preferenceKey:"data_key",keyId:"key_id",gestationKeyId:"key_id",weightKeyId:"key_id",diagnosisKeyId:"key_id",ageKeyId:"key_id",title:"title",dosageText:"label",managementText:"label",administrationFrequency:"label",routeOfAdministration:"label",type:"label",preferenceValue:"label",condition:"condition"};function l(e){let{searchValue:t,filter:a,results:r}=e;return"all"===a?r:r.map(e=>{let r=e.matches.filter(e=>!a||!!(s[e.field]===a&&"".concat(e.fieldValue).toLowerCase().includes("".concat(t).toLowerCase())));return{...e,matches:r}}).filter(e=>e.matches.length)}}}]);