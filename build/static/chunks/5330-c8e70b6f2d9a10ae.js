"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5330],{53850:function(e,t,a){a.d(t,{d:function(){return w}});var l=a(57437),i=a(2265),s=a(99376),n=a(29501),r=a(83464),d=a(53647),c=a(26110),o=a(19060),u=a(98656),f=a(79976),m=a(62869),p=a(69711),h=a(26815),x=a(9699),g=a(95186),y=a(94508),v=a(71706),b=a(60657);let j=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function w(e){var t,a;let{open:w,overWriteScriptWithId:I,onOpenChange:N,onImportSuccess:_}=e,k=(0,s.useRouter)(),V=(0,s.useParams)();I=I||V.scriptId;let{copyScripts:C}=(0,f.h)(),{alert:D}=(0,u.s)(),[S,R]=(0,i.useState)(!1),{sites:E,loading:z}=(0,v.k)({onLoadSitesError:()=>N(!1)}),L=z||S,{formState:{errors:T},reset:F,watch:P,setValue:Z,register:O,handleSubmit:M}=(0,n.cI)({defaultValues:j(I)}),A=P("confirmed"),B=P("overwriteDataKeys"),G=P("overwriteDrugsLibraryItems"),K=M(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(I&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");R(!0);let a=(await r.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:I,broadcastAction:!0})).data;if(null===(t=a.errors)||void 0===t?void 0:t.length)throw Error(a.errors.join(", "));k.refresh(),D({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==_||_(),F(j(I)),N(!1)}})}catch(e){D({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{R(!1)}});return(0,l.jsxs)(l.Fragment,{children:[L&&(0,l.jsx)(p.a,{overlay:!0}),(0,l.jsx)(x.u,{open:w,onOpenChange:()=>{N(!1),F(j(I))},title:"Import script",actions:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(c.GG,{asChild:!0,children:(0,l.jsx)(m.z,{variant:"ghost",disabled:L,onClick:()=>N(!1),children:"Cancel"})}),(0,l.jsx)(m.z,{onClick:()=>K(),disabled:L,children:"Import"})]}),children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,l.jsx)(b._,{children:(0,l.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,l.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(h._,{htmlFor:"siteId",children:"Site *"}),(0,l.jsxs)(d.Ph,{name:"siteId",disabled:L,onValueChange:e=>Z("siteId",e,{shouldDirty:!0}),children:[(0,l.jsx)(d.i4,{children:(0,l.jsx)(d.ki,{placeholder:"Select site"})}),(0,l.jsx)(d.Bw,{children:(0,l.jsxs)(d.DI,{children:[(0,l.jsx)(d.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:a}=e;return(0,l.jsx)(d.Ql,{value:t,children:a},t)})]})})]}),!!(null===(t=T.siteId)||void 0===t?void 0:t.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:T.siteId.message})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(h._,{htmlFor:"scriptId",children:"Script ID *"}),(0,l.jsx)(g.I,{...O("scriptId",{disabled:L,required:!0}),name:"scriptId"}),!!(null===(a=T.scriptId)||void 0===a?void 0:a.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:T.scriptId.message})]}),(0,l.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,l.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:L,checked:B,onCheckedChange:()=>Z("overwriteDataKeys",!B,{shouldDirty:!0})}),(0,l.jsx)(h._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,l.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,l.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:L,checked:G,onCheckedChange:()=>Z("overwriteDrugsLibraryItems",!G,{shouldDirty:!0})}),(0,l.jsx)(h._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,l.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!I&&"hidden"),children:[(0,l.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:L,checked:A,onCheckedChange:()=>Z("confirmed",!A,{shouldDirty:!0})}),(0,l.jsx)(h._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},38789:function(e,t,a){a.d(t,{f:function(){return S}});var l=a(57437),i=a(69711),s=a(81066),n=a(53647),r=a(97930),d=a(2265),c=a(32489),o=a(83464),u=a(94508),f=a(16850),m=a(95186),p=a(26815),h=a(66070),x=a(62869),g=a(19060),y=a(9699),v=a(8272),b=a(81103),j=a(26110),w=a(98656),I=a(86180),N=a(67132),_=a(60657);function k(e){return RegExp.escape(e)}function V(e){let{scriptsSearchResults:t=[]}=e,a=[];return t.sort((e,t)=>e.position-t.position).forEach(e=>{a.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:"",exclude:!1}))}),e.diagnoses.forEach(t=>{a.push({type:"diagnosis",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.diagnosisId,matches:t.matches.map(e=>({...e,newValue:"",exclude:!1}))})}),e.screens.forEach(t=>{a.push({type:"screen",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.screenId,matches:t.matches.map(e=>({...e,newValue:"",exclude:!1}))})})}),a.map(e=>({...e,matches:e.matches.filter(e=>!["key","id","field_key","field_id","item_id","item_key","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let C=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function D(e){let{searchValue:t="",scriptsSearchResults:a=[]}=e,[s,r]=(0,d.useState)(!1),[D,S]=(0,d.useState)(C[0].value),[R,E]=(0,d.useState)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\"(.*?)\"/,"$1")}(t)),[z,L]=(0,d.useState)([]),[T,F]=(0,d.useState)(!1),[P,Z]=(0,d.useState)(""),O=(0,f.N)(P),M=(0,d.useRef)(O),A=(0,d.useRef)(T),{confirm:B}=(0,I.t)(),{alert:G}=(0,w.s)(),{isAdmin:K,isSuperUser:$,viewOnly:Y}=(0,N.b)();(0,d.useEffect)(()=>{(M.current!==O||A.current!==T)&&(M.current=O,A.current=T,L(e=>e.map(e=>({...e,matches:e.matches.map(e=>({...e,newValue:O?e.fieldValue.replace(new RegExp(k(R),T?"g":"gi"),O):"",exclude:!"".concat(e.fieldValue).match(new RegExp(k(R),T?"g":"gi"))}))}))))},[R,O,z,T]);let H=(0,d.useCallback)(()=>{S(C[0].value),E(R),L(V(e)),Z(""),M.current="",F(!1)},[e]),W=!z.length||!P,X=(0,d.useCallback)(t=>{M.current="",S(t),L(V(e).filter(e=>{switch(t){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[D,e,T]),U=(0,d.useCallback)(async()=>{try{r(!0);let e=z.map(e=>({...e,matches:e.matches.filter(e=>!e.exclude)})).filter(e=>e.matches.length),t=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:e.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,t)=>({...e,[t.field]:t.newValue}),{})})),screens:e.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,t)=>{let a=e._fields||[],l=e._items||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else if(t.field.includes("field_item_")){let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field.substring(11)]:t.newValue}}}else if(t.field.includes("field_")){let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field.substring(6)]:t.newValue}}}else{let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field.substring(5)]:t.newValue}}}return{...e,_fields:a,_items:l}},{})}})),diagnoses:e.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,t)=>{let a=e._fields||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else{let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field]:t.newValue}}}return{...e,_fields:a}},{})}}))})).data;t.errors?G({title:"Error",message:t.errors.join(", "),variant:"error"}):G({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){G({title:"Error",message:e.message,variant:"error"})}finally{r(!1)}},[z]);return Y||!($||K)?null:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(y.u,{onOpenChange:()=>{H()},title:(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),(0,l.jsx)(m.I,{disabled:!0,name:"searchValue",value:R,onChange:e=>E(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),(0,l.jsx)(m.I,{name:"replaceWith",value:P,onChange:e=>Z(e.target.value)})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),(0,l.jsx)("div",{className:"w-[120px]",children:(0,l.jsxs)(n.Ph,{value:D,onValueChange:X,children:[(0,l.jsx)(n.i4,{children:(0,l.jsx)(n.ki,{placeholder:"All matches"})}),(0,l.jsx)(n.Bw,{children:C.map(e=>(0,l.jsx)(n.Ql,{value:e.value,children:e.label},e.value))})]})})]}),(0,l.jsxs)("div",{className:"flex gap-x-2 items-center",children:[(0,l.jsx)(g.X,{id:"caseSensitive",name:"caseSensitive",checked:T,onCheckedChange:()=>{F(!T)}}),(0,l.jsx)(p._,{htmlFor:"caseSensitive",children:"Case sensitive"})]})]})]}),trigger:(0,l.jsx)(j.hg,{asChild:!0,children:(0,l.jsx)(x.z,{children:"Replace"})}),actions:(0,l.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[(0,l.jsx)(j.GG,{asChild:!0,children:(0,l.jsx)(x.z,{variant:"ghost",children:"Cancel"})}),(0,l.jsx)(x.z,{disabled:W,onClick:()=>B(U,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-6",children:[(0,l.jsx)(_._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!z.length&&(0,l.jsx)("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),z.map((e,t)=>e.matches.filter(e=>!e.exclude).length?(0,l.jsxs)("div",{className:"flex flex-col gap-y-2",children:[s&&(0,l.jsx)(i.a,{overlay:!0,transparent:!0}),(0,l.jsxs)("div",{className:"text-sm",children:[e.parent?(0,l.jsxs)("div",{children:[(0,l.jsxs)("b",{children:[(0,v.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,l.jsxs)("div",{children:[(0,l.jsxs)("b",{children:[(0,v.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((a,i)=>{let s=e.id+"_match".concat(i);return a.exclude?null:(0,l.jsx)(h.Zb,{children:(0,l.jsxs)(h.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,l.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[a.field,"number"==typeof a.fieldIndex&&(0,l.jsxs)(l.Fragment,{children:["\xa0(",(0,l.jsx)("b",{children:"position"})," = ",a.fieldIndex+1,")"]})]})}),(0,l.jsx)("code",{className:(0,u.cn)("block",a.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:a.fieldValue.replace(new RegExp("(".concat(k(R),")"),T?"g":"gi"),"<mark>$1</mark>")}}),a.newValue&&(0,l.jsx)("code",{className:(0,u.cn)("block",P&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:a.newValue.replaceAll(O,"<mark>".concat(O,"</mark>"))}})]}),(0,l.jsx)("div",{children:(0,l.jsx)(b.pn,{delayDuration:0,children:(0,l.jsxs)(b.u,{children:[(0,l.jsx)(b.aJ,{children:(0,l.jsx)(x.z,{variant:"ghost",onClick:()=>L(e=>e.map((e,a)=>a!==t?e:{...e,matches:e.matches.filter((e,t)=>i!==t)}).filter(e=>e.matches.length)),children:(0,l.jsx)(c.Z,{className:"size-4"})})}),(0,l.jsx)(b._v,{children:"Remove"})]})})})]})},s)})]},e.id):null)]})})})}function S(e){var t;let{search:a,setSearch:d,onSearch:c}=e;return(0,l.jsxs)(l.Fragment,{children:[a.searching&&(0,l.jsx)(i.a,{overlay:!0}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(s.M,{placeholder:"Search",onSearch:c})}),!!a.value&&(0,l.jsx)("div",{className:"w-[120px]",children:(0,l.jsxs)(n.Ph,{value:a.filter,onValueChange:e=>d(t=>({...t,filter:e,results:(0,r._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,l.jsx)(n.i4,{children:(0,l.jsx)(n.ki,{placeholder:"All matches"})}),(0,l.jsx)(n.Bw,{children:r.Hc.map(e=>(0,l.jsx)(n.Ql,{value:e.value,children:e.label},e.value))})]})}),!!(null===(t=a.results)||void 0===t?void 0:t.length)&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(D,{searchValue:a.value,scriptsSearchResults:a.results})})]})]})}},69711:function(e,t,a){a.d(t,{a:function(){return s}});var l=a(57437),i=a(15001);function s(e){let{overlay:t,transparent:a,padding:s="50px 0"}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",...t?{height:"100%",position:"fixed",top:0,left:0,bottom:0,zIndex:999,backgroundColor:a?"transparent":"rgba(255,255,255,.6)"}:{padding:s}},children:(0,l.jsx)(i.Z,{style:{height:24,width:24},className:"animate-spin"})})})}},81066:function(e,t,a){a.d(t,{M:function(){return n}});var l=a(57437),i=a(2265),s=a(94508);let n=(0,i.forwardRef)((e,t)=>{let{searchButton:a,hideSearchButton:n,onSearch:r,...d}=e,[c,o]=(0,i.useState)("");return(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==r||r(c)},children:(0,l.jsxs)("div",{className:(0,s.cn)("flex w-full"),children:[(0,l.jsx)("div",{className:(0,s.cn)("relative w-full"),children:(0,l.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var t;let a=e.target.value;o(a),null===(t=d.onChange)||void 0===t||t.call(d,e),a||null==r||r(a)},className:(0,s.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!n&&(0,l.jsx)("button",{type:"submit",className:(0,s.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==a?void 0:a.className),...a,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});n.displayName="SearchInput"},89884:function(e,t,a){a.d(t,{Title:function(){return s}});var l=a(2265),i=a(40257);function s(e){let{children:t}=e;return(0,l.useEffect)(()=>{document.title=[i.env.NEXT_PUBLIC_APP_NAME||"",t||""].filter(e=>e).join(" - ")},[t]),(0,l.useEffect)(()=>()=>{document.title="".concat(i.env.NEXT_PUBLIC_APP_NAME||"")},[]),null}},66070:function(e,t,a){a.d(t,{Ol:function(){return r},SZ:function(){return c},Zb:function(){return n},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var l=a(57437),i=a(2265),s=a(94508);let n=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...i})});n.displayName="Card";let r=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",a),...i})});r.displayName="CardHeader";let d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",a),...i})});d.displayName="CardTitle";let c=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...i})});c.displayName="CardDescription";let o=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",a),...i})});o.displayName="CardContent";let u=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",a),...i})});u.displayName="CardFooter"},26110:function(e,t,a){a.d(t,{$N:function(){return x},Be:function(){return g},GG:function(){return u},Vq:function(){return d},cN:function(){return h},cZ:function(){return m},fK:function(){return p},hg:function(){return c}});var l=a(57437),i=a(2265),s=a(70001),n=a(32489),r=a(94508);let d=s.fC,c=s.xz,o=s.h_,u=s.x8,f=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.aV,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...i})});f.displayName=s.aV.displayName;let m=i.forwardRef((e,t)=>{let{className:a,children:i,hideCloseButton:d,...c}=e;return(0,l.jsxs)(o,{children:[(0,l.jsx)(f,{}),(0,l.jsxs)(s.VY,{ref:t,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[i,!0!==d&&(0,l.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(n.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=s.VY.displayName;let p=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let x=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.Dx,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",a),...i})});x.displayName=s.Dx.displayName;let g=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.dk,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...i})});g.displayName=s.dk.displayName},95186:function(e,t,a){a.d(t,{I:function(){return n}});var l=a(57437),i=a(2265),s=a(94508);let n=i.forwardRef((e,t)=>{let{className:a,type:i,noRing:n,error:r,...d}=e;return(0,l.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n&&"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",r&&"border-danger",r&&!n&&"focus-visible:ring-danger",a),ref:t,...d})});n.displayName="Input"},26815:function(e,t,a){a.d(t,{_:function(){return c}});var l=a(57437),i=a(2265),s=a(370),n=a(90535),r=a(94508);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef((e,t)=>{let{className:a,secondary:i,error:n,...c}=e;return(0,l.jsx)(s.f,{ref:t,className:(0,r.cn)(d(),i&&"text-xs",n?"text-danger":"",a),...c})});c.displayName=s.f.displayName},53647:function(e,t,a){a.d(t,{Bw:function(){return x},DI:function(){return u},Ph:function(){return o},Ql:function(){return y},U$:function(){return v},i4:function(){return m},ki:function(){return f},n5:function(){return g}});var l=a(57437),i=a(2265),s=a(74797),n=a(40875),r=a(22135),d=a(30401),c=a(94508);let o=s.fC,u=s.ZA,f=s.B4,m=i.forwardRef((e,t)=>{let{className:a,children:i,error:r,...d}=e;return(0,l.jsxs)(s.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r&&"border-danger",a),...d,children:[i,(0,l.jsx)(s.JO,{asChild:!0,children:(0,l.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=s.xz.displayName;let p=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...i,children:(0,l.jsx)(r.Z,{className:"h-4 w-4"})})});p.displayName=s.u_.displayName;let h=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...i,children:(0,l.jsx)(n.Z,{className:"h-4 w-4"})})});h.displayName=s.$G.displayName;let x=i.forwardRef((e,t)=>{let{className:a,children:i,position:n="popper",...r}=e;return(0,l.jsx)(s.h_,{children:(0,l.jsxs)(s.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...r,children:[(0,l.jsx)(p,{}),(0,l.jsx)(s.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),(0,l.jsx)(h,{})]})})});x.displayName=s.VY.displayName;let g=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...i})});g.displayName=s.__.displayName;let y=i.forwardRef((e,t)=>{let{className:a,children:i,...n}=e;return(0,l.jsxs)(s.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,l.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(s.wU,{children:(0,l.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,l.jsx)(s.eT,{children:i})]})});y.displayName=s.ck.displayName;let v=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,l.jsx)(s.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...i})});v.displayName=s.Z0.displayName},81103:function(e,t,a){a.d(t,{_v:function(){return o},aJ:function(){return c},pn:function(){return r},u:function(){return d}});var l=a(57437),i=a(2265),s=a(91668),n=a(94508);let r=s.zt,d=s.fC,c=s.xz,o=i.forwardRef((e,t)=>{let{className:a,sideOffset:i=4,...r}=e;return(0,l.jsx)(s.VY,{ref:t,sideOffset:i,className:(0,n.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});o.displayName=s.VY.displayName},86180:function(e,t,a){a.d(t,{t:function(){return s}});var l=a(59625);let i={danger:!1,title:"Confirm",message:"Are you sure?",positiveLabel:"Ok",negativeLabel:"Cancel"},s=(0,l.Ue)(e=>({isOpen:!1,...i,confirm:(t,a)=>e({isOpen:!0,...i,...a,onConfirm:t}),close:()=>e({isOpen:!1,onConfirm:void 0,...i})}))},24959:function(e,t,a){a.d(t,{v:function(){return i}});var l=a(67132);function i(e){let{isDraft:t,userId:a}=e,{authenticatedUser:i}=(0,l.b)();return!!(t&&a&&a!==(null==i?void 0:i.userId))}},71706:function(e,t,a){a.d(t,{k:function(){return r}});var l=a(2265),i=a(83464),s=a(67132),n=a(98656);function r(e){let{loadOnMount:t=!0,onLoadSitesError:a}={...e},[r,d]=(0,l.useState)(!1),{alert:c}=(0,n.s)(),{getSites:o}=(0,s.b)(),[u,f]=(0,l.useState)([]),m=(0,l.useCallback)(async()=>{try{var e;d(!0);let t=(await i.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));f(t.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==a?void 0:a()})}finally{d(!1)}},[o,c,a]);return(0,l.useEffect)(()=>{t&&!u.length&&m()},[u,t,m]),{loading:r,sites:u,loadSites:m}}},97930:function(e,t,a){a.d(t,{GB:function(){return i},Hc:function(){return s},_n:function(){return r}});var l=a(16548);function i(e){let{searchValue:t,scripts:a,screens:i,diagnoses:s}=e,{normalizedValue:n,isExactMatch:r}=(0,l.l)(t);if(!n)return[];let d=(0,l.y)(n),c=new RegExp(r?"^".concat(d,"$"):d,r?"":"i"),o="manual entry enter value manually custom value other specify",u={};return a.forEach(e=>{let t=[];"".concat(e.title||"").match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").match(c)&&t.push({field:"printTitle",fieldValue:e.printTitle}),t.length&&(u[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:t})}),i.forEach(e=>{let t=[];"".concat(e.title||"").match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").match(c)&&t.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").match(c)&&t.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").match(c)&&t.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").match(c)&&t.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").match(c)&&t.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").match(c)&&t.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,a)=>{"".concat(e.key||"").match(c)&&t.push({field:"field_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.label||"").match(c)&&t.push({field:"field_label",fieldIndex:a,fieldValue:e.label}),"".concat(e.condition||"").match(c)&&t.push({field:"field_condition",fieldIndex:a,fieldValue:e.condition}),(e.items||[]).map((e,l)=>{"".concat(e.value||"").match(c)&&t.push({field:"field_item_key",fieldIndex:a,fieldItemIndex:l,fieldValue:e.value}),"".concat(e.label||"").match(c)&&t.push({field:"field_item_label",fieldIndex:a,fieldItemIndex:l,fieldValue:e.label}),e.enterValueManually&&o.match(c)&&t.push({field:"field_item_manual_entry",fieldIndex:a,fieldItemIndex:l,fieldValue:"Enter value manually"}),"".concat(e.enterValueManuallyLabel||"").match(c)&&t.push({field:"field_item_manual_label",fieldIndex:a,fieldItemIndex:l,fieldValue:"".concat(e.enterValueManuallyLabel||"")})})}),(e.items||[]).map((e,a)=>{"".concat(e.id||"").match(c)&&t.push({field:"item_id",fieldIndex:a,fieldValue:e.id}),"".concat(e.key||"").match(c)&&t.push({field:"item_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.label||"").match(c)&&t.push({field:"item_label",fieldIndex:a,fieldValue:e.label}),e.enterValueManually&&o.match(c)&&t.push({field:"item_manual_entry",fieldIndex:a,fieldValue:"Enter value manually"}),"".concat(e.enterValueManuallyLabel||"").match(c)&&t.push({field:"item_manual_label",fieldIndex:a,fieldValue:"".concat(e.enterValueManuallyLabel||"")})}),(e.drugs||[]).map((e,a)=>{"".concat(e.key||"").match(c)&&t.push({field:"drug",fieldIndex:a,fieldValue:e.key})}),(e.fluids||[]).map((e,a)=>{"".concat(e.key||"").match(c)&&t.push({field:"fluid",fieldIndex:a,fieldValue:e.key})}),(e.feeds||[]).map((e,a)=>{"".concat(e.key||"").match(c)&&t.push({field:"feed",fieldIndex:a,fieldValue:e.key})}),t.length&&(u[e.scriptId]=u[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},u[e.scriptId].title=u[e.scriptId].title||e.scriptTitle,u[e.scriptId].screens.push({title:e.title,matches:t,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),s.forEach(e=>{let t=[];"".concat(e.name||"").match(c)&&t.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").match(c)&&t.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,a)=>{"".concat(e.key||"").match(c)&&t.push({field:"diagnosis_symptom_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.name||"").match(c)&&t.push({field:"diagnosis_symptom_name",fieldIndex:a,fieldValue:e.name}),"".concat(e.expression||"").match(c)&&t.push({field:"diagnosis_symptom_expression",fieldIndex:a,fieldValue:e.expression})}),t.length&&(u[e.scriptId]=u[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},u[e.scriptId].title=u[e.scriptId].title||e.scriptTitle,u[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:t,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(u)}let s=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"},{value:"manual_entry",label:"Manual entry only"}],n={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition",field_item_manual_entry:"manual_entry",item_manual_entry:"manual_entry",field_item_manual_label:"manual_entry",item_manual_label:"manual_entry"};function r(e){let{searchValue:t,filter:a,results:l}=e;if("all"===a)return l;let i=e=>n[e.field]===a;return l.map(e=>a?{...e,matches:e.matches.filter(e=>i(e)),screens:e.screens.filter(e=>e.matches.find(e=>i(e))).map(e=>({...e,matches:e.matches.filter(e=>i(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>i(e))).map(e=>({...e,matches:e.matches.filter(e=>i(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},16548:function(e,t,a){a.d(t,{l:function(){return n},y:function(){return s}});let l=['"',"'","“","‘"],i=['"',"'","”","’"];function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function n(e){let t="".concat(null!=e?e:"").trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let a=l.includes(t[0]),s=i.includes(t[t.length-1]),n=t.length>1&&a&&s,r=n?t.slice(1,-1):t;return{normalizedValue:n?r.trim():r.trim().toLowerCase(),isExactMatch:n}}}}]);