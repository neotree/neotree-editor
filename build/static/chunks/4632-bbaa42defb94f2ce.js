(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4632],{83898:function(e,s,n){Promise.resolve().then(n.bind(n,45427)),Promise.resolve().then(n.bind(n,95229)),Promise.resolve().then(n.bind(n,25704)),Promise.resolve().then(n.t.bind(n,231,23))},45427:function(e,s,n){"use strict";n.d(s,{DiagnosisForm:function(){return A}});var i=n(57437),l=n(2265),t=n(16463),r=n(39343),a=n(50495),o=n(83102),d=n(93146),c=n(67135),m=n(64344),x=n(39661),u=n(37440),h=n(87861),p=n(80852),v=n(20920),j=n(38472),g=n(15701),y=n(53699),f=n(17647),b=n(83146),k=n(20021),N=n(12599),D=n(92513),w=n(45188),C=n(6649),F=n(90399),I=n(94638),_=n(90837),S=n(46910),R=n(76230),V=n(17501);function M(e){let{disabled:s,selected:n,onDelete:l,onCopy:t}=e;return(0,i.jsx)(i.Fragment,{children:!!n.length&&(0,i.jsx)(V.h,{children:(0,i.jsxs)(a.z,{variant:"destructive",className:"h-auto w-auto",disabled:s,onClick:()=>l(),children:[(0,i.jsx)(F.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:n.length>1?"Delete ".concat(n.length," symptoms"):"Delete symptom"})]})})})}var z=n(74709),O=n(85070),T=n(86466),Z=n(21453),E=n(84760);function P(e){let{children:s,symptom:n,form:t,disabled:d,...m}=e,{data:x,index:h}={...n},[j,g]=(0,l.useState)(!1),y=(0,l.useCallback)(()=>({...x,symptomId:(null==x?void 0:x.symptomId)||(0,v.Z)(),expression:(null==x?void 0:x.expression)||"",name:(null==x?void 0:x.name)||"",key:(null==x?void 0:x.key)||"",keyId:(null==x?void 0:x.keyId)||"",weight:(null==x?void 0:x.weight)||null,type:(null==x?void 0:x.type)||b.ph[0].value,position:(null==x?void 0:x.position)||1,printable:!!(null==x?void 0:x.printable)}),[x]),{control:f,reset:k,watch:N,register:D,handleSubmit:w,setValue:C}=(0,r.cI)({defaultValues:y()}),F=N("type"),I=N("name"),S=N("printable"),R=(0,l.useMemo)(()=>!!d,[d]),V=w(e=>{!(0,Z.x)(h)&&x?t.setValue("symptoms",t.getValues("symptoms").map((s,n)=>({...s,...n===h?e:null}))):t.setValue("symptoms",[...t.getValues("symptoms"),e],{shouldDirty:!0}),g(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(z.u,{open:j,title:x?"Add symptom":"Edit symptom",trigger:"function"==typeof s?s({extraProps:m}):s,onOpenChange:e=>{g(e),k(y())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,u.cn)("text-danger text-xs",R&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(_.GG,{asChild:!0,children:(0,i.jsx)(a.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(a.z,{disabled:R,onClick:()=>V(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(E.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(O.E,{disabled:R,defaultValue:F,onValueChange:e=>C("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:b.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(O.m,{value:e.value,id:e.value}),(0,i.jsx)(c._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(E.D,{children:"Properties"}),(0,i.jsx)("div",{children:(0,i.jsx)(r.Qr,{control:f,name:"key",render:e=>{let{field:{value:s,onChange:n}}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!R&&!s,children:"Key *"}),(0,i.jsx)(p.L,{value:"".concat(s||""),disabled:!1,onChange:e=>{let[s]=e;n(s.name),C("name",null==s?void 0:s.label,{shouldDirty:!0}),C("keyId",null==s?void 0:s.uniqueKey,{shouldDirty:!0})}})]})}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{error:!R&&!I,htmlFor:"name",children:"Name *"}),(0,i.jsx)(o.I,{...D("name",{disabled:R,required:!0}),name:"name",error:!R&&!I})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(o.I,{...D("weight",{disabled:R}),name:"weight",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(o.I,{...D("expression",{disabled:R}),name:"expression"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:b._S})]})]}),(0,i.jsx)(E.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(T.X,{id:"printable",disabled:R,checked:S,onCheckedChange:()=>C("printable",!S,{shouldDirty:!0})}),(0,i.jsx)(c._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function q(e){let{form:s,disabled:n}=e,t=(0,l.useRef)(null),[r,o]=(0,l.useState)([]),{confirm:d}=(0,R.t)(),c=s.watch("symptoms"),m=(0,l.useCallback)((e,n)=>{let i=(0,N.q)([...c],e,n);s.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[s,c]),x=(0,l.useCallback)(e=>{let n=c.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");d(()=>{let n=c.filter((s,n)=>!e.includes(n));s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),o([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),danger:!0,positiveLabel:"Delete"})},[s,c,d]),h=(0,l.useCallback)(e=>{let n=c.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");d(()=>{let n=[...c,...c.filter((s,n)=>e.includes(n)).map((e,s)=>({...e,position:c.length+1+s}))];s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),o([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),positiveLabel:"Duplicate"})},[s,c,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{ref:t}),(0,i.jsx)(I.DataTable,{title:"Symptoms",sortable:!n,selectable:!n,onSort:m,selectedIndexes:r,onSelect:o,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(P,{form:s,disabled:n,children:!n&&(0,i.jsx)(_.hg,{asChild:!0,children:(0,i.jsxs)(a.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(D.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:l}=e,r=c[l];return(0,i.jsxs)(S.h_,{children:[(0,i.jsx)(S.$F,{asChild:!0,children:(0,i.jsx)(a.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(w.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S.AW,{children:[(0,i.jsx)(S.Xi,{asChild:!0,children:(0,i.jsx)(P,{disabled:n,form:s,symptom:{data:r,index:l},children:e=>{let{extraProps:s}=e;return(0,i.jsxs)(_.hg,{...s,className:(0,u.cn)(null==s?void 0:s.className,"w-full"),children:[(0,i.jsx)(C.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:n?"View":"Edit"})]})}})}),(0,i.jsxs)(S.Xi,{onClick:()=>{var e,s;null===(s=t.current)||void 0===s||null===(e=s.click)||void 0===e||e.call(s),setTimeout(()=>x([l]),0)},className:(0,u.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:n,children:[(0,i.jsx)(F.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:c.map(e=>[e.type,e.name,""])}),!n&&(0,i.jsx)(M,{disabled:n,selected:r,onDelete:()=>x(r),onCopy:()=>h(r)})]})}function A(e){let s=(0,t.useRouter)(),n=function(e){let{formData:s,scriptId:n}=e,i=(0,t.useRouter)(),[a,o]=(0,l.useState)(!1),{saveDiagnoses:d}=(0,g.h)(),{alert:c}=(0,y.s)(),{viewOnly:m}=(0,f.b)(),x=(0,l.useMemo)(()=>"/script/".concat(n,"?section=diagnoses"),[n]),u=(0,l.useCallback)(()=>({version:(null==s?void 0:s.version)||1,scriptId:(null==s?void 0:s.scriptId)||n,diagnosisId:(null==s?void 0:s.diagnosisId)||(0,v.Z)(),name:(null==s?void 0:s.name)||"",description:(null==s?void 0:s.description)||"",key:(null==s?void 0:s.key)||"",keyId:(null==s?void 0:s.keyId)||"",expression:(null==s?void 0:s.expression)||"",expressionMeaning:(null==s?void 0:s.expressionMeaning)||"",severityOrder:(null==s?void 0:s.severityOrder)||null,symptoms:(null==s?void 0:s.symptoms)||[],text1:(null==s?void 0:s.text1)||"",text2:(null==s?void 0:s.text2)||"",text3:(null==s?void 0:s.text3)||"",image1:(null==s?void 0:s.image1)||null,image2:(null==s?void 0:s.image2)||null,image3:(null==s?void 0:s.image3)||null,preferences:(null==s?void 0:s.preferences)||b.$7}),[s,n]),h=(0,r.cI)({defaultValues:u()}),{formState:{dirtyFields:p},handleSubmit:k}=h,N=(0,l.useMemo)(()=>!!Object.keys(p).length,[p]),D=k(async e=>{try{var s;o(!0);let n={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!n.scriptId)throw Error("Diagnosis is missing script reference!");let l=(await j.Z.post("/api/diagnoses/save",{data:[n],broadcastAction:!0})).data;if(null===(s=l.errors)||void 0===s?void 0:s.length)throw Error(l.errors.join(", "));i.refresh(),c({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>i.push(x)})}catch(e){c({variant:"error",message:"Failed to save draft: "+e.message})}finally{o(!1)}}),w=(0,l.useMemo)(()=>a||m,[a,m]);return{...h,formIsDirty:N,saving:a,scriptPageHref:x,disabled:w,save:D,getDefaultValues:u}}(e),{control:N,saving:D,scriptPageHref:w,disabled:C,register:F,watch:I,setValue:_,save:S}=n,R=I("name"),V=I("key"),M=I("image1"),z=I("image2"),O=I("image3"),T=I("preferences"),Z=(0,l.useCallback)(()=>{s.push(w)},[s,w]);return(0,i.jsxs)(i.Fragment,{children:[D&&(0,i.jsx)(x.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!C&&!V,children:"Key *"}),(0,i.jsx)(r.Qr,{control:N,name:"key",render:e=>{let{field:{value:s,onChange:n}}=e;return(0,i.jsx)(p.L,{value:"".concat(s||""),disabled:!1,onChange:e=>{let[s]=e;n(s.name),_("name",null==s?void 0:s.label,{shouldDirty:!0}),_("keyId",null==s?void 0:s.uniqueKey,{shouldDirty:!0})}})}})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(o.I,{...F("severityOrder",{disabled:C}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(c._,{htmlFor:"name",error:!C&&!R,children:"Name *"}),(0,i.jsx)(o.I,{...F("name",{disabled:C,required:!0}),name:"name",noRing:!1,error:!C&&!R})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(o.I,{...F("description",{disabled:C}),name:"description",noRing:!1}),(0,i.jsx)(h.w,{id:"description",title:"Description",disabled:C,data:T,onSave:e=>_("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(o.I,{...F("expression",{disabled:C}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(o.I,{...F("expressionMeaning",{disabled:C}),name:"expressionMeaning",noRing:!1})]}),[["text1",M],["text2",z],["text3",O]].map((e,s)=>{let[n,t]=e,r="image".concat(s+1);return(0,i.jsx)(l.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(c._,{htmlFor:"imageTextFields.".concat(s,".text"),children:["Text ",s+1]}),(0,i.jsx)(d.g,{...F(n,{disabled:C}),name:"text".concat(s+1),noRing:!1,rows:5}),(0,i.jsx)(h.w,{id:n,title:"Text ".concat(s+1),disabled:C,data:T,onSave:e=>_("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(k.M,{disabled:C,image:t,onChange:e=>_(r,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(s))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,u.cn)("text-danger text-xs",C&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(a.z,{variant:"ghost",onClick:()=>Z(),children:"Cancel"}),(0,i.jsx)(a.z,{disabled:C,onClick:()=>S(),children:"Save Draft"})]}),(0,i.jsx)(m.Z,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)(q,{disabled:C,form:n})})]})}},48484:function(e,s,n){"use strict";n.d(s,{f:function(){return d}});var i=n(2265),l=n(25171),t=n(57437),r="horizontal",a=["horizontal","vertical"],o=i.forwardRef((e,s)=>{let{decorative:n,orientation:i=r,...o}=e,d=a.includes(i)?i:r;return(0,t.jsx)(l.WV.div,{"data-orientation":d,...n?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...o,ref:s})});o.displayName="Separator";var d=o}}]);