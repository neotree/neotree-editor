"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2465],{53850:function(e,t,l){l.d(t,{d:function(){return b}});var i=l(57437),s=l(2265),a=l(99376),r=l(29501),n=l(83464),d=l(53647),c=l(26110),o=l(19060),u=l(98656),h=l(79976),f=l(62869),m=l(69711),p=l(26815),x=l(9699),v=l(95186),g=l(94508),y=l(71706),j=l(60657);let w=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b(e){var t,l;let{open:b,overWriteScriptWithId:I,onOpenChange:k,onImportSuccess:_}=e,C=(0,a.useRouter)(),V=(0,a.useParams)();I=I||V.scriptId;let{copyScripts:N}=(0,h.h)(),{alert:L}=(0,u.s)(),[S,D]=(0,s.useState)(!1),{sites:E,loading:F}=(0,y.k)({onLoadSitesError:()=>k(!1)}),T=F||S,{formState:{errors:z},reset:P,watch:R,setValue:O,register:A,handleSubmit:K}=(0,r.cI)({defaultValues:w(I)}),Z=R("confirmed"),B=R("overwriteDataKeys"),M=R("overwriteDrugsLibraryItems"),G=K(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(I&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");D(!0);let l=(await n.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:I,broadcastAction:!0})).data;if(null===(t=l.errors)||void 0===t?void 0:t.length)throw Error(l.errors.join(", "));C.refresh(),L({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==_||_(),P(w(I)),k(!1)}})}catch(e){L({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{D(!1)}});return(0,i.jsxs)(i.Fragment,{children:[T&&(0,i.jsx)(m.a,{overlay:!0}),(0,i.jsx)(x.u,{open:b,onOpenChange:()=>{k(!1),P(w(I))},title:"Import script",actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(c.GG,{asChild:!0,children:(0,i.jsx)(f.z,{variant:"ghost",disabled:T,onClick:()=>k(!1),children:"Cancel"})}),(0,i.jsx)(f.z,{onClick:()=>G(),disabled:T,children:"Import"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(j._,{children:(0,i.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,i.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,i.jsxs)(d.Ph,{name:"siteId",disabled:T,onValueChange:e=>O("siteId",e,{shouldDirty:!0}),children:[(0,i.jsx)(d.i4,{children:(0,i.jsx)(d.ki,{placeholder:"Select site"})}),(0,i.jsx)(d.Bw,{children:(0,i.jsxs)(d.DI,{children:[(0,i.jsx)(d.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:l}=e;return(0,i.jsx)(d.Ql,{value:t,children:l},t)})]})})]}),!!(null===(t=z.siteId)||void 0===t?void 0:t.message)&&(0,i.jsx)("div",{className:"text-xs text-danger mt-1",children:z.siteId.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,i.jsx)(v.I,{...A("scriptId",{disabled:T,required:!0}),name:"scriptId"}),!!(null===(l=z.scriptId)||void 0===l?void 0:l.message)&&(0,i.jsx)("div",{className:"text-xs text-danger mt-1",children:z.scriptId.message})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,i.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:T,checked:B,onCheckedChange:()=>O("overwriteDataKeys",!B,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2"),children:[(0,i.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:T,checked:M,onCheckedChange:()=>O("overwriteDrugsLibraryItems",!M,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,i.jsxs)("div",{className:(0,g.cn)("flex gap-x-2",!I&&"hidden"),children:[(0,i.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:T,checked:Z,onCheckedChange:()=>O("confirmed",!Z,{shouldDirty:!0})}),(0,i.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},38789:function(e,t,l){l.d(t,{f:function(){return N}});var i=l(57437),s=l(69711),a=l(81066),r=l(53647),n=l(97930),d=l(2265),c=l(32489),o=l(83464),u=l(94508),h=l(16850),f=l(95186),m=l(26815),p=l(66070),x=l(62869),v=l(9699),g=l(8272),y=l(81103),j=l(26110),w=l(98656),b=l(86180),I=l(67132),k=l(60657);function _(e){let{scriptsSearchResults:t=[]}=e,l=[];return t.sort((e,t)=>e.position-t.position).forEach(e=>{l.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:""}))}),e.diagnoses.forEach(t=>{l.push({type:"diagnosis",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.diagnosisId,matches:t.matches.map(e=>({...e,newValue:""}))})}),e.screens.forEach(t=>{l.push({type:"screen",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.screenId,matches:t.matches.map(e=>({...e,newValue:""}))})})}),l.map(e=>({...e,matches:e.matches.filter(e=>!["key","field_key","field_id","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let C=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function V(e){let{searchValue:t="",scriptsSearchResults:l=[]}=e,[a,n]=(0,d.useState)(!1),[V,N]=(0,d.useState)(C[0].value),[L,S]=(0,d.useState)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\"(.*?)\"/,"$1")}(t)),[D,E]=(0,d.useState)([]),[F,T]=(0,d.useState)(""),z=(0,h.N)(F),P=(0,d.useRef)(z),{confirm:R}=(0,b.t)(),{alert:O}=(0,w.s)(),{isAdmin:A,isSuperUser:K,viewOnly:Z}=(0,I.b)();(0,d.useEffect)(()=>{P.current!==z&&(P.current=z,E(e=>e.map(e=>({...e,matches:e.matches.map(e=>({...e,newValue:z?e.fieldValue.replaceAll(L,z):""}))}))))},[L,z,D]);let B=(0,d.useCallback)(()=>{N(C[0].value),S(L),E(_(e)),T(""),P.current=""},[e]),M=!D.length||!F,G=(0,d.useCallback)(t=>{P.current="",N(t),E(_(e).filter(e=>{switch(t){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[V,e]),W=(0,d.useCallback)(async()=>{try{n(!0);let e=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:D.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,t)=>({...e,[t.field]:t.newValue}),{})})),screens:D.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,t)=>{let l=e._fields||[],i=e._items||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else if(t.field.includes("field_item_")){let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field.substring(11)]:t.newValue}}}else if(t.field.includes("field_")){let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field.substring(6)]:t.newValue}}}else{let e=i.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=i.length),i[e]={index:t.fieldIndex,data:{...i[e],[t.field.substring(5)]:t.newValue}}}return{...e,_fields:l,_items:i}},{})}})),diagnoses:D.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,t)=>{let l=e._fields||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else{let e=l.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=l.length),l[e]={index:t.fieldIndex,data:{...l[e],[t.field]:t.newValue}}}return{...e,_fields:l}},{})}}))})).data;e.errors?O({title:"Error",message:e.errors.join(", "),variant:"error"}):O({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){O({title:"Error",message:e.message,variant:"error"})}finally{n(!1)}},[D]);return Z||!(K||A)?null:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(v.u,{onOpenChange:()=>{B()},title:(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),(0,i.jsx)(f.I,{disabled:!0,name:"searchValue",value:L,onChange:e=>S(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),(0,i.jsx)(f.I,{name:"replaceWith",value:F,onChange:e=>T(e.target.value)})]})]}),(0,i.jsx)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:(0,i.jsxs)("div",{children:[(0,i.jsx)(m._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),(0,i.jsx)("div",{className:"w-[120px]",children:(0,i.jsxs)(r.Ph,{value:V,onValueChange:G,children:[(0,i.jsx)(r.i4,{children:(0,i.jsx)(r.ki,{placeholder:"All matches"})}),(0,i.jsx)(r.Bw,{children:C.map(e=>(0,i.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})})]})})]}),trigger:(0,i.jsx)(j.hg,{asChild:!0,children:(0,i.jsx)(x.z,{children:"Replace"})}),actions:(0,i.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[(0,i.jsx)(j.GG,{asChild:!0,children:(0,i.jsx)(x.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(x.z,{disabled:M,onClick:()=>R(W,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-6",children:[(0,i.jsx)(k._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!D.length&&(0,i.jsx)("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),D.map((e,t)=>(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[a&&(0,i.jsx)(s.a,{overlay:!0,transparent:!0}),(0,i.jsxs)("div",{className:"text-sm",children:[e.parent?(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,g.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,i.jsxs)("div",{children:[(0,i.jsxs)("b",{children:[(0,g.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((l,s)=>{let a=e.id+"_match".concat(s);return(0,i.jsx)(p.Zb,{children:(0,i.jsxs)(p.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,i.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[l.field,"number"==typeof l.fieldIndex&&(0,i.jsxs)(i.Fragment,{children:["\xa0(",(0,i.jsx)("b",{children:"position"})," = ",l.fieldIndex+1,")"]})]})}),(0,i.jsx)("code",{className:(0,u.cn)("block",l.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:l.fieldValue.replaceAll(L,"<mark>".concat(L,"</mark>"))}}),l.newValue&&(0,i.jsx)("code",{className:(0,u.cn)("block",F&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:l.newValue.replaceAll(z,"<mark>".concat(z,"</mark>"))}})]}),(0,i.jsx)("div",{children:(0,i.jsx)(y.pn,{delayDuration:0,children:(0,i.jsxs)(y.u,{children:[(0,i.jsx)(y.aJ,{children:(0,i.jsx)(x.z,{variant:"ghost",onClick:()=>E(e=>e.map((e,l)=>l!==t?e:{...e,matches:e.matches.filter((e,t)=>s!==t)}).filter(e=>e.matches.length)),children:(0,i.jsx)(c.Z,{className:"size-4"})})}),(0,i.jsx)(y._v,{children:"Remove"})]})})})]})},a)})]},e.id))]})})})}function N(e){var t;let{search:l,setSearch:d,onSearch:c}=e;return(0,i.jsxs)(i.Fragment,{children:[l.searching&&(0,i.jsx)(s.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(a.M,{placeholder:"Search",onSearch:c})}),!!l.value&&(0,i.jsx)("div",{className:"w-[120px]",children:(0,i.jsxs)(r.Ph,{value:l.filter,onValueChange:e=>d(t=>({...t,filter:e,results:(0,n._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,i.jsx)(r.i4,{children:(0,i.jsx)(r.ki,{placeholder:"All matches"})}),(0,i.jsx)(r.Bw,{children:n.Hc.map(e=>(0,i.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!(null===(t=l.results)||void 0===t?void 0:t.length)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(V,{searchValue:l.value,scriptsSearchResults:l.results})})]})]})}},81066:function(e,t,l){l.d(t,{M:function(){return r}});var i=l(57437),s=l(2265),a=l(94508);let r=(0,s.forwardRef)((e,t)=>{let{searchButton:l,hideSearchButton:r,onSearch:n,...d}=e,[c,o]=(0,s.useState)("");return(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==n||n(c)},children:(0,i.jsxs)("div",{className:(0,a.cn)("flex w-full"),children:[(0,i.jsx)("div",{className:(0,a.cn)("relative w-full"),children:(0,i.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var t;let l=e.target.value;o(l),null===(t=d.onChange)||void 0===t||t.call(d,e),l||null==n||n(l)},className:(0,a.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!r&&(0,i.jsx)("button",{type:"submit",className:(0,a.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==l?void 0:l.className),...l,children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},81103:function(e,t,l){l.d(t,{_v:function(){return o},aJ:function(){return c},pn:function(){return n},u:function(){return d}});var i=l(57437),s=l(2265),a=l(91668),r=l(94508);let n=a.zt,d=a.fC,c=a.xz,o=s.forwardRef((e,t)=>{let{className:l,sideOffset:s=4,...n}=e;return(0,i.jsx)(a.VY,{ref:t,sideOffset:s,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l),...n})});o.displayName=a.VY.displayName},71706:function(e,t,l){l.d(t,{k:function(){return n}});var i=l(2265),s=l(83464),a=l(67132),r=l(98656);function n(e){let{loadOnMount:t=!0,onLoadSitesError:l}={...e},[n,d]=(0,i.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,a.b)(),[u,h]=(0,i.useState)([]),f=(0,i.useCallback)(async()=>{try{var e;d(!0);let t=(await s.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));h(t.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==l?void 0:l()})}finally{d(!1)}},[o,c,l]);return(0,i.useEffect)(()=>{t&&!u.length&&f()},[u,t,f]),{loading:n,sites:u,loadSites:f}}},97930:function(e,t,l){l.d(t,{GB:function(){return s},Hc:function(){return a},_n:function(){return n}});var i=l(16548);function s(e){let{searchValue:t,scripts:l,screens:s,diagnoses:a}=e,{normalizedValue:r,isExactMatch:n}=(0,i.l)(t);if(!r)return[];let d=(0,i.y)(r),c=new RegExp(n?"^".concat(d,"$"):d),o={};return l.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(c)&&t.push({field:"printTitle",fieldValue:e.printTitle}),t.length&&(o[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:t})}),s.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(c)&&t.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(c)&&t.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(c)&&t.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(c)&&t.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"field_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_label",fieldIndex:l,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"field_condition",fieldIndex:l,fieldValue:e.condition}),(e.items||[]).map((e,i)=>{"".concat(e.value||"").toLowerCase().match(c)&&t.push({field:"field_item_key",fieldIndex:l,fieldItemIndex:i,fieldValue:e.value}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_item_label",fieldIndex:l,fieldItemIndex:i,fieldValue:e.label})})}),(e.items||[]).map((e,l)=>{"".concat(e.id||"").toLowerCase().match(c)&&t.push({field:"item_id",fieldIndex:l,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"item_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"item_label",fieldIndex:l,fieldValue:e.label})}),(e.drugs||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"drug",fieldIndex:l,fieldValue:e.key})}),(e.fluids||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"fluid",fieldIndex:l,fieldValue:e.key})}),(e.feeds||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"feed",fieldIndex:l,fieldValue:e.key})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].screens.push({title:e.title,matches:t,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),a.forEach(e=>{let t=[];"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_name",fieldIndex:l,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_expression",fieldIndex:l,fieldValue:e.expression})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:t,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(o)}let a=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function n(e){let{searchValue:t,filter:l,results:i}=e;if("all"===l)return i;let s=e=>r[e.field]===l;return i.map(e=>l?{...e,matches:e.matches.filter(e=>s(e)),screens:e.screens.filter(e=>e.matches.find(e=>s(e))).map(e=>({...e,matches:e.matches.filter(e=>s(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>s(e))).map(e=>({...e,matches:e.matches.filter(e=>s(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},16548:function(e,t,l){l.d(t,{l:function(){return r},y:function(){return a}});let i=['"',"“"],s=['"',"”"];function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function r(e){let t="".concat(null!=e?e:"").trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let l=i.includes(t[0]),a=s.includes(t[t.length-1]),r=t.length>1&&l&&a;return{normalizedValue:(r?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:r}}}}]);