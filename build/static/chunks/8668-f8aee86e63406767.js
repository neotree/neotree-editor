"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8668],{74149:function(e,t,i){i.d(t,{d:function(){return j}});var s=i(57437),a=i(2265),l=i(16463),r=i(39343),n=i(38472),d=i(46294),o=i(90837),c=i(86466),f=i(53699),u=i(15701),h=i(50495),m=i(39661),p=i(67135),x=i(74709),v=i(83102),y=i(37440),w=i(53853),g=i(36013);function b(e){let{children:t,errors:i=[]}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(g.Zb,{className:"bg-destructive/20 border-destructive text-destructive",children:(0,s.jsxs)(g.aY,{className:"flex flex-col gap-y-4 px-4 py-2",children:[t,!!i.length&&(0,s.jsx)("div",{children:i.map((e,t)=>(0,s.jsx)("p",{children:e},"".concat(t)))})]})})})}let I=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function j(e){var t,i;let{open:g,overWriteScriptWithId:j,onOpenChange:C,onImportSuccess:k}=e,L=(0,l.useRouter)(),_=(0,l.useParams)();j=j||_.scriptId;let{copyScripts:N}=(0,u.h)(),{alert:D}=(0,f.s)(),[V,S]=(0,a.useState)(!1),{sites:E,loading:T}=(0,w.k)({onLoadSitesError:()=>C(!1)}),F=T||V,{formState:{errors:R},reset:O,watch:P,setValue:K,register:Z,handleSubmit:A}=(0,r.cI)({defaultValues:I(j)}),B=P("confirmed"),W=P("overwriteDataKeys"),z=P("overwriteDrugsLibraryItems"),G=A(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(j&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");S(!0);let i=(await n.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:j,broadcastAction:!0})).data;if(null===(t=i.errors)||void 0===t?void 0:t.length)throw Error(i.errors.join(", "));L.refresh(),D({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==k||k(),O(I(j)),C(!1)}})}catch(e){D({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{S(!1)}});return(0,s.jsxs)(s.Fragment,{children:[F&&(0,s.jsx)(m.a,{overlay:!0}),(0,s.jsx)(x.u,{open:g,onOpenChange:()=>{C(!1),O(I(j))},title:"Import script",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(o.GG,{asChild:!0,children:(0,s.jsx)(h.z,{variant:"ghost",disabled:F,onClick:()=>C(!1),children:"Cancel"})}),(0,s.jsx)(h.z,{onClick:()=>G(),disabled:F,children:"Import"})]}),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsx)(b,{children:(0,s.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,s.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,s.jsxs)(d.Ph,{name:"siteId",disabled:F,onValueChange:e=>K("siteId",e,{shouldDirty:!0}),children:[(0,s.jsx)(d.i4,{children:(0,s.jsx)(d.ki,{placeholder:"Select site"})}),(0,s.jsx)(d.Bw,{children:(0,s.jsxs)(d.DI,{children:[(0,s.jsx)(d.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:i}=e;return(0,s.jsx)(d.Ql,{value:t,children:i},t)})]})})]}),!!(null===(t=R.siteId)||void 0===t?void 0:t.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:R.siteId.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,s.jsx)(v.I,{...Z("scriptId",{disabled:F,required:!0}),name:"scriptId"}),!!(null===(i=R.scriptId)||void 0===i?void 0:i.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:R.scriptId.message})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(c.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:F,checked:W,onCheckedChange:()=>K("overwriteDataKeys",!W,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(c.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:F,checked:z,onCheckedChange:()=>K("overwriteDrugsLibraryItems",!z,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!j&&"hidden"),children:[(0,s.jsx)(c.X,{name:"confirmed",id:"confirmed",disabled:F,checked:B,onCheckedChange:()=>K("confirmed",!B,{shouldDirty:!0})}),(0,s.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},9769:function(e,t,i){i.d(t,{f:function(){return c}});var s=i(57437),a=i(39661),l=i(2265),r=i(37440);let n=(0,l.forwardRef)((e,t)=>{let{searchButton:i,hideSearchButton:a,onSearch:n,...d}=e,[o,c]=(0,l.useState)("");return(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==n||n(o)},children:(0,s.jsxs)("div",{className:(0,r.cn)("flex w-full"),children:[(0,s.jsx)("div",{className:(0,r.cn)("relative w-full"),children:(0,s.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:o,...d,onChange:e=>{var t;let i=e.target.value;c(i),null===(t=d.onChange)||void 0===t||t.call(d,e),i||null==n||n(i)},className:(0,r.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!a&&(0,s.jsx)("button",{type:"submit",className:(0,r.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==i?void 0:i.className),...i,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});n.displayName="SearchInput";var d=i(46294),o=i(44709);function c(e){let{search:t,setSearch:i,onSearch:l}=e;return(0,s.jsxs)(s.Fragment,{children:[t.searching&&(0,s.jsx)(a.a,{overlay:!0}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(n,{placeholder:"Search",onSearch:l})}),!!t.value&&(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(d.Ph,{value:t.filter,onValueChange:e=>i(t=>({...t,filter:e,results:(0,o._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,s.jsx)(d.i4,{children:(0,s.jsx)(d.ki,{placeholder:"All matches"})}),(0,s.jsx)(d.Bw,{children:o.Hc.map(e=>(0,s.jsx)(d.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}},36013:function(e,t,i){i.d(t,{Ol:function(){return n},SZ:function(){return o},Zb:function(){return r},aY:function(){return c},eW:function(){return f},ll:function(){return d}});var s=i(57437),a=i(2265),l=i(37440);let r=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",i),...a})});r.displayName="Card";let n=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",i),...a})});n.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",i),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",i),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",i),...a})});c.displayName="CardContent";let f=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",i),...a})});f.displayName="CardFooter"},53699:function(e,t,i){i.d(t,{s:function(){return l}});var s=i(39099);let a={title:"",message:"",buttonLabel:"Ok",variant:"info",onClose:void 0},l=(0,s.Ue)(e=>({isOpen:!1,...a,alert:t=>e({isOpen:!0,...a,...t}),close:()=>e({isOpen:!1,onClose:void 0,...a})}))},53853:function(e,t,i){i.d(t,{k:function(){return n}});var s=i(2265),a=i(38472),l=i(17647),r=i(53699);function n(e){let{loadOnMount:t=!0,onLoadSitesError:i}={...e},[n,d]=(0,s.useState)(!1),{alert:o}=(0,r.s)(),{getSites:c}=(0,l.b)(),[f,u]=(0,s.useState)([]),h=(0,s.useCallback)(async()=>{try{var e;d(!0);let t=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));u(t.data||[])}catch(e){o({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==i?void 0:i()})}finally{d(!1)}},[c,o,i]);return(0,s.useEffect)(()=>{t&&!f.length&&h()},[f,t,h]),{loading:n,sites:f,loadSites:h}}},44709:function(e,t,i){function s(e){let{searchValue:t,scripts:i,screens:s,diagnoses:a}=e;t="".concat(t||"").trim().toLowerCase();let l={};return i.forEach(e=>{let i=[];"".concat(e.title||"").toLowerCase().match(t)&&i.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(t)&&i.push({field:"printTitle",fieldValue:e.printTitle}),i.length&&(l[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:i})}),s.forEach(e=>{let i=[];"".concat(e.title||"").toLowerCase().match(t)&&i.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(t)&&i.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(t)&&i.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(t)&&i.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(t)&&i.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(t)&&i.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"field_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"field_label",fieldIndex:s,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(t)&&i.push({field:"field_condition",fieldIndex:s,fieldValue:e.condition})}),(e.items||[]).map((e,s)=>{"".concat(e.id||"").toLowerCase().match(t)&&i.push({field:"item_id",fieldIndex:s,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"item_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"item_label",fieldIndex:s,fieldValue:e.label})}),(e.drugs||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"drug",fieldIndex:s,fieldValue:e.key})}),(e.fluids||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"fluid",fieldIndex:s,fieldValue:e.key})}),(e.feeds||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"feed",fieldIndex:s,fieldValue:e.key})}),i.length&&(l[e.scriptId]=l[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},l[e.scriptId].screens.push({title:e.title,matches:i,screenId:e.screenId,isDraft:e.isDraft,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),a.forEach(e=>{let i=[];"".concat(e.name||"").toLowerCase().match(t)&&i.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(t)&&i.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,s)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_key",fieldIndex:s,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_name",fieldIndex:s,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_expression",fieldIndex:s,fieldValue:e.expression})}),i.length&&(l[e.scriptId]=l[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},l[e.scriptId].diagnoses.push({title:e.name||"",matches:i,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(l)}i.d(t,{GB:function(){return s},Hc:function(){return a},_n:function(){return r}});let a=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],l={key:"data_key",field_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function r(e){let{searchValue:t,filter:i,results:s}=e;if("all"===i)return s;let a=e=>!!(l[e.field]===i&&"".concat(e.fieldValue||"").toLowerCase().includes("".concat(t||"").toLowerCase()));return s.map(e=>i?{...e,matches:e.matches.filter(e=>a(e)),screens:e.screens.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}}]);