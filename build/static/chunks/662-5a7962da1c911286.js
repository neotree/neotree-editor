(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{60662:function(e,t,l){Promise.resolve().then(l.bind(l,27006)),Promise.resolve().then(l.bind(l,25704))},27006:function(e,t,l){"use strict";l.d(t,{DataKeyForm:function(){return S}});var n=l(57437),r=l(2265),a=l(39343),i=l(92513),s=l(45188),d=l(90399),u=l(12599),o=l(16463),c=l(87138),m=l(20920),f=l(23920),v=l(46294),h=l(46910),p=l(50495),x=l(67135),y=l(83102),j=l(76230),b=l(44380),g=l(83146),N=l(39661),w=l(84492),C=l(36013),k=l(71239),T=l(17647),I=l(42314),_=l(72341);let K=e=>{var t,l,n,r,a,i,s,d;if(!e)return null;let u="string"==typeof e.version?Number(e.version):null!==(t=e.version)&&void 0!==t?t:null;return{uuid:null!==(l=e.uuid)&&void 0!==l?l:"",uniqueKey:null!==(n=e.uniqueKey)&&void 0!==n?n:"",name:null!==(r=e.name)&&void 0!==r?r:"",refId:null!==(a=e.refId)&&void 0!==a?a:"",dataType:null!==(i=e.dataType)&&void 0!==i?i:"",label:null!==(s=e.label)&&void 0!==s?s:"",options:Array.isArray(e.options)?e.options:[],metadata:null!==(d=e.metadata)&&void 0!==d?d:{},version:u}};function S(e){let{loadingDataKeys:t}=(0,f.M)();return t?(0,n.jsx)(N.a,{overlay:!0}):(0,n.jsx)(Z,{...e})}function Z(e){let{disabled:t}=e,{dataKeyId:l}=(0,o.useParams)(),{allDataKeys:S,loadingDataKeys:Z,saving:D,saveDataKeys:A}=(0,f.M)(),{confirm:E}=(0,j.t)(),{authenticatedUser:M}=(0,T.b)(),q=(0,r.useMemo)(()=>S.find(e=>e.uuid===l||e.uniqueKey===l),[S,l]),R=(0,k.v)({isDraft:!!(null==q?void 0:q.isDraft),userId:null==q?void 0:q.draftCreatedByUserId});t=t||R;let{control:P,register:F,handleSubmit:L,watch:V,setValue:z}=(0,a.cI)({defaultValues:{...q,name:(null==q?void 0:q.name)||"",refId:(null==q?void 0:q.refId)||"",dataType:(null==q?void 0:q.dataType)||"",label:(null==q?void 0:q.label)||"",options:(null==q?void 0:q.options)||[],metadata:(null==q?void 0:q.metadata)||{},version:(null==q?void 0:q.version)||1}}),O=(0,r.useRef)(null),B=(0,r.useRef)(null),G=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!(null==q?void 0:q.uuid)){O.current=null,B.current=null,G.current=null;return}if(G.current===q.uuid&&O.current)return;let e=(0,I.$)({entityId:q.uuid,entityType:"dataKey",userId:null==M?void 0:M.userId,userName:null==M?void 0:M.displayName,entityTitle:(null==q?void 0:q.name)||(null==q?void 0:q.uniqueKey)||"Data Key",resolveEntityTitle:e=>(null==e?void 0:e.name)||(null==e?void 0:e.uniqueKey)}),t=K(q);t&&(e.setSnapshot(t),B.current=t),O.current=e,G.current=q.uuid},[q,null==M?void 0:M.userId,null==M?void 0:M.displayName]);let U=V("dataType"),H=V("options"),X=g.y0.find(e=>e.value===U),Q=L(async e=>{var t,l;let n=(null==e?void 0:e.uuid)||(null==q?void 0:q.uuid)||(0,m.Z)(),r=null!==(l=null!==(t=null==e?void 0:e.uniqueKey)&&void 0!==t?t:null==q?void 0:q.uniqueKey)&&void 0!==l?l:null,a={...e,uuid:n,uniqueKey:r,version:"string"==typeof e.version?Number(e.version):e.version};z("uuid",n),r&&z("uniqueKey",r);let i=K(a),s=a.name||a.uniqueKey||"Data Key";if(!q&&i){let e=(await _.pb.getEntityChanges(n,"dataKey")).find(e=>"create"===e.action);(null==e?void 0:e.id)?await _.pb.updateChange(e.id,{fieldName:a.name||"New Data Key",newValue:i,timestamp:Date.now(),userId:null==M?void 0:M.userId,userName:null==M?void 0:M.displayName,entityTitle:s,fullSnapshot:i}):await _.pb.addChange({entityType:"dataKey",entityId:n,entityTitle:s,action:"create",fieldPath:"dataKey",fieldName:a.name||"New Data Key",oldValue:null,newValue:i,userId:null==M?void 0:M.userId,userName:null==M?void 0:M.displayName,fullSnapshot:i})}else O.current&&B.current&&i&&await O.current.trackChanges(i,"Data key saved");await A([{...a}],e=>{e||(window.location.href="/data-keys")})}),W=t||D,$=(0,r.useMemo)(()=>H.map(e=>S.find(t=>t.uniqueKey===e)).filter(e=>e),[S,H]),Y=Z||D;return(0,n.jsxs)(n.Fragment,{children:[Y&&(0,n.jsx)(N.a,{overlay:!0}),(0,n.jsx)(C.Zb,{children:(0,n.jsxs)(C.aY,{children:[(0,n.jsxs)(C.Ol,{children:[(0,n.jsxs)(C.ll,{children:[q?"Edit":"New"," data key"]}),(0,n.jsx)(C.SZ,{className:"hidden",children:""})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col py-2 px-0 gap-y-4 overflow-y-auto",children:[(0,n.jsx)(a.Qr,{control:P,name:"dataType",disabled:W,rules:{required:!0},render:e=>{let{field:{value:t,onChange:l}}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(x._,{htmlFor:"name",children:"Data type *"}),(0,n.jsxs)(v.Ph,{value:t,name:"name",disabled:W,onValueChange:e=>{l(e);let t=g.y0.find(t=>t.value===e);z("options",(null==t?void 0:t.hasChildren)&&(null==q?void 0:q.options)||[])},children:[(0,n.jsx)(v.i4,{children:(0,n.jsx)(v.ki,{placeholder:"Select type"})}),(0,n.jsx)(v.Bw,{children:(0,n.jsx)(v.DI,{children:g.y0.map(e=>(0,n.jsx)(v.Ql,{value:e.value,children:e.label},e.value))})})]})]})})}}),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(x._,{htmlFor:"name",children:"Key *"}),(0,n.jsx)(y.I,{disabled:W,...F("name",{disabled:W,required:!0})})]}),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(x._,{htmlFor:"label",children:"Label *"}),(0,n.jsx)(y.I,{disabled:W,...F("label",{disabled:W,required:!0})})]}),(0,n.jsxs)("div",{className:"px-4 hidden",children:[(0,n.jsx)(x._,{htmlFor:"refId",children:"Ref ID"}),(0,n.jsx)(y.I,{disabled:W,...F("refId",{disabled:W,required:!1})})]}),(0,n.jsx)(a.Qr,{control:P,name:"options",disabled:W,render:e=>{let{field:{value:l,onChange:r}}=e;return(null==X?void 0:X.hasChildren)?(0,n.jsx)("div",{className:"mt-4 pt-4 border-t border-t-border",children:(0,n.jsx)(b.DataTable,{sortable:!t,onSort:(e,t)=>{r((0,u.q)([...l],e,t))},search:{},title:"Options",headerActions:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(w.V,{multiple:!0,search:{placeholder:"Search data keys"},options:S.filter(e=>!H.includes(e.uniqueKey)).map(e=>({label:e.name,value:e.uniqueKey,caption:e.dataType||"",description:e.label})),trigger:(0,n.jsxs)(p.z,{variant:"ghost",className:"w-auto h-auto",children:[(0,n.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Add"]}),onSelect:e=>{r([...l,...e.map(e=>e.value)])}})}),noDataMessage:(0,n.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,n.jsx)("div",{children:"Data keys has no options"})}),columns:[{name:"Key"},{name:"Label"},{name:"Data type"},{name:"",align:"right",cellClassName:"w-20",cellRenderer(e){let{rowIndex:r}=e;return!l[r]||t?null:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(h.h_,{children:[(0,n.jsx)(h.$F,{children:(0,n.jsx)(s.Z,{className:"h-4 w-4"})}),(0,n.jsx)(h.AW,{children:(0,n.jsxs)(h.Xi,{className:"text-destructive",onClick:()=>setTimeout(()=>E(()=>z("options",H.filter((e,t)=>t!==r)),{title:"Delete",message:"Are you sure you want to delete data key option?",danger:!0}),0),children:[(0,n.jsx)(d.Z,{className:"h-4 w-4 mr-2"})," Delete"]})})]})})}}],data:$.map(e=>[e.name||"",e.label||"",e.dataType||"",""])})}):(0,n.jsx)(n.Fragment,{})}})]}),(0,n.jsx)("br",{}),(0,n.jsxs)(C.eW,{className:"gap-x-2",children:[(0,n.jsx)("div",{className:"ml-auto"}),(0,n.jsx)(p.z,{asChild:!0,variant:"ghost",children:(0,n.jsx)(c.default,{href:"/data-keys",children:"Cancel"})}),!t&&(0,n.jsx)(p.z,{onClick:()=>Q(),disabled:W,children:"Save"})]})]})})]})}},39661:function(e,t,l){"use strict";l.d(t,{a:function(){return a}});var n=l(57437),r=l(89627);function a(e){let{overlay:t,transparent:l,padding:a="50px 0"}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",...t?{height:"100%",position:"fixed",top:0,left:0,bottom:0,zIndex:999,backgroundColor:l?"transparent":"rgba(255,255,255,.6)"}:{padding:a}},children:(0,n.jsx)(r.Z,{style:{height:24,width:24},className:"animate-spin"})})})}},84492:function(e,t,l){"use strict";l.d(t,{V:function(){return m}});var n=l(57437),r=l(2265),a=l(1282),i=l(22468),s=l(50495),d=l(83102),u=l(90837),o=l(37440),c=l(85937);function m(e){let{options:t,selected:l,...r}=e;l=Array.isArray(l)?l:l?[l]:[];let a=t.map(e=>({...e,value:"".concat(e.value)})),i=l.map(e=>"".concat(e));if(!r.multiple){let[e]=Array.isArray(i)?i:[i];e&&a.find(t=>t.value===e)}return(0,n.jsx)(f,{...r,options:a,selected:i})}function f(e){var t;let{modal:l,header:m,placeholder:f,search:v,multiple:h=!1,error:p=!1,disabled:x=!1,selected:y,options:j=[],trigger:b,onTrigger:g,onSelect:N}=e,[w,C]=(0,r.useState)(""),k=(0,c.N)(w),[T,I]=(0,r.useState)([]),_=(0,r.useMemo)(()=>y?Array.isArray(y)?y.map(e=>j.find(t=>(null==t?void 0:t.value)===e)).map(e=>e):j.filter(e=>(null==e?void 0:e.value)===y)||[]:[],[y,j]),K=(0,r.useMemo)(()=>j.map(e=>{let t=_.map(e=>null==e?void 0:e.value).map(e=>"".concat(e||"")).filter(e=>e).includes("".concat(null==e?void 0:e.value));return t=t||T.includes(e.value),{...e,isSelected:t}}).sort((e,t)=>(e.disabled?1:0)-(t.disabled?1:0)).sort((e,t)=>{let l=e.isSelected?1:0;return(t.isSelected?1:0)-l}).filter(e=>JSON.stringify([e.value||"",e.label||"",e.description||""]).toLowerCase().match(k.toLowerCase())),[j,k,_,T]);return(0,r.useEffect)(()=>()=>C(""),[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(u.Vq,{modal:l,onOpenChange:()=>{C(""),I([])},children:[(0,n.jsx)(u.hg,{asChild:!0,children:b||(0,n.jsxs)(s.z,{disabled:x,variant:"outline",className:(0,o.cn)("justify-between w-full",p&&"border border-destructive hover:bg-destructive/10"),onClick:g,children:[(0,n.jsx)("span",{className:_.length?"":"opacity-50",children:(null===(t=_[0])||void 0===t?void 0:t.label)||f||""}),(0,n.jsx)(a.Z,{className:"size-4 opacity-50"})]})}),(0,n.jsxs)(u.cZ,{hideCloseButton:!0,className:"flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",children:[(0,n.jsxs)(u.fK,{className:"border-b border-b-border px-4 py-4",children:[(0,n.jsx)(u.$N,{className:"hidden",children:""}),(0,n.jsx)(u.Be,{className:"hidden",children:""}),(0,n.jsxs)("div",{className:"flex items-center gap-x-4",children:[v?(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(d.I,{type:"search",placeholder:v.placeholder||"",value:w,onChange:e=>C(e.target.value)})}):null,m]})]}),(0,n.jsx)("div",{className:"flex-1 flex flex-col gap-y-1 overflow-y-auto px-4 py-2 overflow-x-hidden",children:K.map(e=>{let t=h?"button":u.GG;return(0,n.jsx)(r.Fragment,{children:(0,n.jsx)(t,{onClick:()=>{e.disabled||(e.isSelected?h?I(t=>t.filter(t=>t!==e.value)):null==N||N(_.filter(t=>t.value!==e.value)):h?I(t=>[...t,e.value]):null==N||N([e]))},className:(0,o.cn)("flex flex-col gap-y-1 border border-border p-2 rounded-md items-start text-left",e.disabled?"opacity-50 cursor-not-allowed":"transition-colors hover:bg-primary/20",e.isSelected&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[e.isSelected?(0,n.jsx)(i.Z,{className:"size-4 mr-2"}):null,(0,n.jsxs)("div",{children:[e.caption?(0,n.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.caption||""}}):null,(0,n.jsx)("p",{children:e.label}),e.description?(0,n.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.description||""}}):null]})]})})},e.value)})}),(0,n.jsxs)(u.cN,{className:"border-t border-t-border px-4 py-2 items-center w-full gap-x-2",children:[(0,n.jsx)(u.GG,{asChild:!0,children:(0,n.jsx)(s.z,{variant:"ghost",children:"Close"})}),!!T.length&&(0,n.jsx)(u.GG,{asChild:!0,children:(0,n.jsx)(s.z,{onClick:()=>{null==N||N(T.map(e=>K.find(t=>t.value===e)).filter(e=>e))},children:"Save"})})]})]})]})})}},58502:function(e,t,l){"use strict";l.d(t,{SocketEventsListener:function(){return i}});var n=l(2265),r=l(16463),a=l(7752);function i(e){let{events:t}=e,l=(0,n.useRef)({eventsTimeouts:{},eventsTimestamps:{}});(0,n.useRef)(new Date().getTime());let i=(0,r.useRouter)();return(0,n.useEffect)(()=>{t.forEach(e=>{let{name:t,action:n,delay:r=100,onEvent:s}=e;a.Z.on(t,function(){for(var e=arguments.length,a=Array(e),d=0;d<e;d++)a[d]=arguments[d];let u=()=>{var e,l;(!n||a[0]===n)&&(null===(e=s.callback)||void 0===e||e.call(s,...a),(null==s?void 0:s.refreshRouter)&&(console.log(t,"refreshing..."),i.refresh()),(null===(l=s.redirect)||void 0===l?void 0:l.to)&&(s.redirect.replace?i.replace(s.redirect.to):i.push(s.redirect.to)))},o=new Date().getTime();r?(clearTimeout(l.current.eventsTimeouts[t]),l.current.eventsTimeouts[t]=setTimeout(()=>{l.current.eventsTimestamps[t]=o,u()},r)):(l.current.eventsTimestamps[t]=new Date().getTime(),u())})})},[t,i]),null}},25704:function(e,t,l){"use strict";l.d(t,{Title:function(){return a}});var n=l(2265),r=l(20357);function a(e){let{children:t}=e;return(0,n.useEffect)(()=>{document.title=[r.env.NEXT_PUBLIC_APP_NAME||"",t||""].filter(e=>e).join(" - ")},[t]),(0,n.useEffect)(()=>()=>{document.title="".concat(r.env.NEXT_PUBLIC_APP_NAME||"")},[]),null}},36013:function(e,t,l){"use strict";l.d(t,{Ol:function(){return s},SZ:function(){return u},Zb:function(){return i},aY:function(){return o},eW:function(){return c},ll:function(){return d}});var n=l(57437),r=l(2265),a=l(37440);let i=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",l),...r})});i.displayName="Card";let s=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",l),...r})});s.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",l),...r})});d.displayName="CardTitle";let u=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",l),...r})});u.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",l),...r})});o.displayName="CardContent";let c=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",l),...r})});c.displayName="CardFooter"},67135:function(e,t,l){"use strict";l.d(t,{_:function(){return u}});var n=l(57437),r=l(2265),a=l(38364),i=l(13027),s=l(37440);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=r.forwardRef((e,t)=>{let{className:l,secondary:r,error:i,...u}=e;return(0,n.jsx)(a.f,{ref:t,className:(0,s.cn)(d(),r&&"text-xs",i?"text-danger":"",l),...u})});u.displayName=a.f.displayName},17647:function(e,t,l){"use strict";l.d(t,{AppContextProvider:function(){return x},b:function(){return p}});var n=l(57437),r=l(2265),a=l(79512),i=l(16463),s=l(23314),d=l(44785);let u=d.Z.get,o=d.Z.set;d.Z.remove;var c={get:u,set:o};function m(){let e=c.get("mode");return e||(e="view",c.set("mode",e,{expires:31536e7})),e}var f=l(7752),v=l(58502);let h=(0,r.createContext)(null),p=()=>(0,r.useContext)(h);function x(e){let{children:t,...l}=e,d=function(e){(0,i.useRouter)();let{isAdmin:t,isSuperUser:l,sys:n}=e,{setTheme:s}=(0,a.F)();(0,r.useEffect)(()=>{"yes"===n.data.hide_theme_toggle&&s("light")},[n]);let d=(0,r.useCallback)(()=>(t||l?m():"view")||"view",[l,t]),[u,o]=(0,r.useState)(d()),v=!t&&!l||"view"===u,h=(0,r.useCallback)(function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];let n=function(e){return c.set("mode",e,{expires:31536e7}),m()}(...t);return f.Z.emit("mode_changed",d()),o(d()),n},[d]),p=(0,r.useCallback)(()=>{o(d())},[d]);return{...e,mode:u,viewOnly:v,onModeChange:p,getMode:m,setMode:h}}(l),[u,o]=(0,r.useState)(!1);return((0,s.Z)(()=>{o(!0)}),u)?(0,n.jsxs)(h.Provider,{value:d,children:[t,(0,n.jsx)(v.SocketEventsListener,{events:[{name:"mode_changed",onEvent:{callback:d.onModeChange}}]})]}):null}},76230:function(e,t,l){"use strict";l.d(t,{t:function(){return a}});var n=l(39099);let r={danger:!1,title:"Confirm",message:"Are you sure?",positiveLabel:"Ok",negativeLabel:"Cancel"},a=(0,n.Ue)(e=>({isOpen:!1,...r,confirm:(t,l)=>e({isOpen:!0,...r,...l,onConfirm:t}),close:()=>e({isOpen:!1,onConfirm:void 0,...r})}))},71239:function(e,t,l){"use strict";l.d(t,{v:function(){return r}});var n=l(17647);function r(e){let{isDraft:t,userId:l}=e,{authenticatedUser:r}=(0,n.b)();return!!(t&&l&&l!==(null==r?void 0:r.userId))}},7752:function(e,t,l){"use strict";var n=l(45040),r=l(20357);let a=(0,n.io)(r.env.NEXT_PUBLIC_APP_URL);t.Z=a},45188:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,l(78030).Z)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},92513:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,l(78030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},90399:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.399.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,l(78030).Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]])},87138:function(e,t,l){"use strict";l.d(t,{default:function(){return r.a}});var n=l(231),r=l.n(n)}}]);