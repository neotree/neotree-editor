"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6184],{95229:function(e,t,a){a.d(t,{Alert:function(){return i}});var r=a(53699),s=a(16463),l=a(2265);function i(e){let t=(0,s.useRouter)(),{alert:a}=(0,r.s)();return(0,l.useEffect)(()=>{let{redirectTo:r,onClose:s,...l}=e;a({...l,variant:l.variant||"error",buttonLabel:l.buttonLabel||"Ok",onClose:()=>{null==s||s(),r&&t.replace(r)}})},[a,t,e]),null}},27475:function(e,t,a){a.d(t,{V:function(){return u}});var r=a(57437),s=a(2265),l=a(1282),i=a(22468),n=a(50495),o=a(83102),c=a(90837),d=a(37440);function u(e){let{options:t,selected:a,...s}=e;a=Array.isArray(a)?a:a?[a]:[];let l=t.map(e=>({...e,value:"".concat(e.value)})),i=a.map(e=>"".concat(e));if(!s.multiple){let[e]=Array.isArray(i)?i:[i];e&&l.find(t=>t.value===e)}return(0,r.jsx)(m,{...s,options:l,selected:i})}function m(e){var t;let{modal:a,header:u,placeholder:m,search:v,multiple:y=!1,error:f=!1,disabled:h=!1,selected:p,options:x=[],trigger:b,onTrigger:g,onSelect:k}=e,[j,C]=(0,s.useState)(""),w=function(e,t){let[a,r]=(0,s.useState)(e);return(0,s.useEffect)(()=>{let t=setTimeout(()=>r(e),500);return()=>{clearTimeout(t)}},[e,void 0]),a}(j),[S,N]=(0,s.useState)([]),D=(0,s.useMemo)(()=>p?Array.isArray(p)?p.map(e=>x.find(t=>(null==t?void 0:t.value)===e)).map(e=>e):x.filter(e=>(null==e?void 0:e.value)===p)||[]:[],[p,x]),A=(0,s.useMemo)(()=>x.map(e=>{let t=D.map(e=>null==e?void 0:e.value).map(e=>"".concat(e||"")).filter(e=>e).includes("".concat(null==e?void 0:e.value));return t=t||S.includes(e.value),{...e,isSelected:t}}).sort((e,t)=>(e.disabled?1:0)-(t.disabled?1:0)).sort((e,t)=>{let a=e.isSelected?1:0;return(t.isSelected?1:0)-a}).filter(e=>JSON.stringify([e.value||"",e.label||"",e.description||""]).toLowerCase().match(w.toLowerCase())),[x,w,D,S]);return(0,s.useEffect)(()=>()=>C(""),[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(c.Vq,{modal:a,onOpenChange:()=>{C(""),N([])},children:[(0,r.jsx)(c.hg,{asChild:!0,children:b||(0,r.jsxs)(n.z,{disabled:h,variant:"outline",className:(0,d.cn)("justify-between w-full",f&&"border border-destructive hover:bg-destructive/10"),onClick:g,children:[(0,r.jsx)("span",{className:D.length?"":"opacity-50",children:(null===(t=D[0])||void 0===t?void 0:t.label)||m||""}),(0,r.jsx)(l.Z,{className:"size-4 opacity-50"})]})}),(0,r.jsxs)(c.cZ,{hideCloseButton:!0,className:"flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",children:[(0,r.jsxs)(c.fK,{className:"border-b border-b-border px-4 py-4",children:[(0,r.jsx)(c.$N,{className:"hidden",children:""}),(0,r.jsx)(c.Be,{className:"hidden",children:""}),(0,r.jsxs)("div",{className:"flex items-center gap-x-4",children:[v?(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(o.I,{type:"search",placeholder:v.placeholder||"",value:j,onChange:e=>C(e.target.value)})}):null,u]})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col gap-y-1 overflow-y-auto px-4 py-2 overflow-x-hidden",children:A.map(e=>{let t=y?"button":c.GG;return(0,r.jsx)(s.Fragment,{children:(0,r.jsx)(t,{onClick:()=>{e.disabled||(e.isSelected?y?N(t=>t.filter(t=>t!==e.value)):null==k||k(D.filter(t=>t.value!==e.value)):y?N(t=>[...t,e.value]):null==k||k([e]))},className:(0,d.cn)("flex flex-col gap-y-1 border border-border p-2 rounded-md items-start text-left",e.disabled?"opacity-50 cursor-not-allowed":"transition-colors hover:bg-primary/20",e.isSelected&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[e.isSelected?(0,r.jsx)(i.Z,{className:"size-4 mr-2"}):null,(0,r.jsxs)("div",{children:[e.caption?(0,r.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.caption||""}}):null,(0,r.jsx)("p",{children:e.label}),e.description?(0,r.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.description||""}}):null]})]})})},e.value)})}),(0,r.jsxs)(c.cN,{className:"border-t border-t-border px-4 py-2 items-center w-full gap-x-2",children:[(0,r.jsx)(c.GG,{asChild:!0,children:(0,r.jsx)(n.z,{variant:"ghost",children:"Close"})}),!!S.length&&(0,r.jsx)(c.GG,{asChild:!0,children:(0,r.jsx)(n.z,{onClick:()=>{null==k||k(S.map(e=>A.find(t=>t.value===e)).filter(e=>e))},children:"Save"})})]})]})]})})}},23920:function(e,t,a){a.d(t,{DataKeysCtxProvider:function(){return v},M:function(){return m}});var r=a(57437),s=a(2265),l=a(38472),i=a(73741),n=a(16463),o=a(53699),c=a(95229),d=a(83146);let u=(0,s.createContext)(null),m=()=>{let e=(0,s.useContext)(u);if(!e)throw Error("useChart must be used within a <DataKeysCtxProvider />");return e};function v(e){var t,a;let{children:m,prefetchDataKeys:v=!0}=e,f=(0,s.useRef)(!1),h=(0,n.useRouter)(),{alert:p}=(0,o.s)(),[x,b]=(0,i.v1)("uuid",{clearOnDefault:!0,shallow:!0,history:"push",defaultValue:""}),[g,k]=(0,s.useState)([]),[j,C]=(0,s.useState)(d.F4[0].value),[w,S]=(0,s.useState)(""),[N,D]=(0,s.useState)(!1),[A,E]=(0,s.useState)({data:[]}),[T,I]=(0,s.useState)(!1),L=(0,s.useCallback)(async()=>{D(!0),l.Z.get("/api/data-keys").then(e=>{e.data.data=y(e.data.data,j),E(e.data)}).catch(e=>{E({data:[],errors:[e.message]})}).finally(()=>D(!1))},[j]);(0,s.useEffect)(()=>{!f.current&&(f.current=!0,v&&L())},[v,L]);let[F,K]=(0,s.useState)(!1),_=(0,s.useCallback)(async(e,t)=>{try{var a;K(!0);let r=(await l.Z.post("/api/data-keys/save",{data:e,broadcastAction:!0})).data;(null===(a=r.errors)||void 0===a?void 0:a.length)?p({title:"Error",message:r.errors.join(", "),variant:"error"}):(await L(),h.refresh(),p({message:"Data key saved!",variant:"success",onClose:()=>null==t?void 0:t()}))}catch(e){p({title:"Error",message:"Failed to save data key: "+e.message,onClose:()=>null==t?void 0:t(e.message)})}finally{K(!1)}},[p,h.refresh,L]),[Z,G]=(0,s.useState)(!1),O=(0,s.useCallback)(async e=>{try{var t;G(!0);let a=(await l.Z.delete("/api/data-keys?data="+JSON.stringify({dataKeysIds:e,broadcastAction:!0}))).data;if(null===(t=a.errors)||void 0===t?void 0:t.length)throw Error(a.errors[0]);k([]),await L(),h.refresh(),p({title:"Success",message:"Data keys deleted successfully!",variant:"success"})}catch(e){p({title:"Error",message:e.message,variant:"error"})}finally{G(!1)}},[h.refresh,p,L]),[z,M]=(0,s.useState)(!1),q=(0,s.useCallback)(async e=>{try{var t;M(!0);let a=(await l.Z.post("/api/data-keys/export",e)).data;if(null===(t=a.errors)||void 0===t?void 0:t.length)throw Error(a.errors[0]);await L(),k([]),p({title:"Success",message:"Data exported successfully!",variant:"success"})}catch(e){p({title:"Error",message:e.message,variant:"error"})}finally{M(!1)}},[A.data,L,p]),P=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.F4[0].value;C(e),k([]),E(t=>({...t,data:y(t.data,e)}))},[]),R=(0,s.useCallback)((e,t)=>{let a=e.map(e=>A.data.find(t=>t.uniqueKey===e||t.uuid===e)).filter(e=>e);return(null==t?void 0:t.withNested)&&a.filter(e=>e.options.length).forEach(e=>{let r=R(e.options,t);a=[...a,...r]}),a.filter((e,t)=>a.map(e=>e.uniqueKey).indexOf(e.uniqueKey)===t)},[A]);return(null==A?void 0:null===(t=A.errors)||void 0===t?void 0:t.length)?(0,r.jsx)(c.Alert,{title:"Error",message:"Failed to load data keys: "+(null==A?void 0:null===(a=A.errors)||void 0===a?void 0:a.join(", ")),buttonLabel:"Try again",onClose:()=>L()}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(u.Provider,{value:{loadingDataKeys:N,saving:F,exporting:z,deleting:Z,dataKeys:A.data,errors:A.errors,selected:g,currentDataKeyUuid:x,sort:j,filter:w,extractDataKeys:R,deleteDataKeys:O,saveDataKeys:_,exportDataKeys:q,setCurrentDataKeyUuid:b,loadDataKeys:L,setSelected:k,setSort:C,onSort:P,setFilter:S},children:m})})}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.F4[0].value,a=[...e],r=e=>{let{key1:t,key2:a,sortDirection:r}=e;t=(t||"").trim().toLowerCase(),a=(a||"").trim().toLowerCase();let s=0;return"asc"===r?(t<a&&(s=-1),t>a&&(s=1)):(t>a&&(s=-1),t<a&&(s=1)),s};switch(t){case"refId.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.refId||"").trim(),key2:(t.refId||"").trim()}));break;case"refId.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.refId||"").trim(),key2:(t.refId||"").trim()}));break;case"key.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:e.name,key2:t.name}));break;case"label.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"label.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.label||e.name||"").trim(),key2:(t.label||t.name||"").trim()}));break;case"type.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"type.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:(e.dataType||"").trim(),key2:(t.dataType||"").trim()}));break;case"createdAt.asc":a=e.sort((e,t)=>r({sortDirection:"asc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;case"createdAt.desc":a=e.sort((e,t)=>r({sortDirection:"desc",key1:new Date(e.createdAt||"").getTime().toString(),key2:new Date(t.createdAt||"").getTime().toString()}));break;default:a=e.sort((e,t)=>r({sortDirection:"asc",key1:e.name,key2:t.name}))}return a}}}]);