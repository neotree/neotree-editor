(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3898],{83898:function(e,s,t){Promise.resolve().then(t.bind(t,45427)),Promise.resolve().then(t.bind(t,95229)),Promise.resolve().then(t.bind(t,25704)),Promise.resolve().then(t.t.bind(t,231,23))},45427:function(e,s,t){"use strict";t.d(s,{DiagnosisForm:function(){return A}});var i=t(57437),n=t(2265),l=t(16463),r=t(50495),a=t(83102),o=t(93146),d=t(67135),c=t(64344),u=t(39661),m=t(37440),h=t(87861),x=t(39343),p=t(20920),g=t(38472),f=t(15701),v=t(53699),j=t(17647),y=t(83146),b=t(20021),w=t(12599),N=t(92513),D=t(45188),F=t(6649),k=t(90399),I=t(76942),C=t(90837),S=t(46910),z=t(76230),M=t(17501);function R(e){let{disabled:s,selected:t,onDelete:n,onCopy:l}=e;return(0,i.jsx)(i.Fragment,{children:!!t.length&&(0,i.jsx)(M.h,{children:(0,i.jsxs)(r.z,{variant:"destructive",className:"h-auto w-auto",disabled:s,onClick:()=>n(),children:[(0,i.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:t.length>1?"Delete ".concat(t.length," symptoms"):"Delete symptom"})]})})})}var _=t(74709),E=t(85070),O=t(86466),Z=t(21453),V=t(84760);function T(e){let{children:s,symptom:t,form:l,disabled:o,...c}=e,{data:u,index:h}={...t},[g,f]=(0,n.useState)(!1),v=(0,n.useCallback)(()=>({symptomId:(null==u?void 0:u.symptomId)||(0,p.Z)(),expression:(null==u?void 0:u.expression)||"",name:(null==u?void 0:u.name)||"",weight:(null==u?void 0:u.weight)||null,type:(null==u?void 0:u.type)||y.ph[0].value,position:(null==u?void 0:u.position)||1,printable:(null==u?void 0:u.printable)||!0,...u}),[u]),{reset:j,watch:b,register:w,handleSubmit:N,setValue:D}=(0,x.cI)({defaultValues:v()}),F=b("type"),k=b("name"),I=b("printable"),S=(0,n.useMemo)(()=>!!o,[o]),z=N(e=>{!(0,Z.x)(h)&&u?l.setValue("symptoms",l.getValues("symptoms").map((s,t)=>({...s,...t===h?e:null}))):l.setValue("symptoms",[...l.getValues("symptoms"),e],{shouldDirty:!0}),f(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(_.u,{open:g,title:u?"Add symptom":"Edit symptom",trigger:"function"==typeof s?s({extraProps:c}):s,onOpenChange:e=>{f(e),j(v())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,m.cn)("text-danger text-xs",S&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(C.GG,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(r.z,{disabled:S,onClick:()=>z(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(V.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(E.E,{disabled:S,defaultValue:F,onValueChange:e=>D("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:y.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(E.m,{value:e.value,id:e.value}),(0,i.jsx)(d._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(V.D,{children:"Properties"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{error:!S&&!k,htmlFor:"name",children:"Name *"}),(0,i.jsx)(a.I,{...w("name",{disabled:S,required:!0}),name:"name",error:!S&&!k})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(a.I,{...w("weight",{disabled:S}),name:"weight",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(a.I,{...w("expression",{disabled:S}),name:"expression"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:y._S})]})]}),(0,i.jsx)(V.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(O.X,{id:"printable",disabled:S,checked:I,onCheckedChange:()=>D("printable",!I,{shouldDirty:!0})}),(0,i.jsx)(d._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function P(e){let{form:s,disabled:t}=e,l=(0,n.useRef)(null),[a,o]=(0,n.useState)([]),{confirm:d}=(0,z.t)(),c=s.watch("symptoms"),u=(0,n.useCallback)((e,t)=>{let i=(0,w.q)([...c],e,t);s.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[s,c]),h=(0,n.useCallback)(e=>{let t=c.filter((s,t)=>e.includes(t)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");d(()=>{let t=c.filter((s,t)=>!e.includes(t));s.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),o([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(t),danger:!0,positiveLabel:"Delete"})},[s,c,d]),x=(0,n.useCallback)(e=>{let t=c.filter((s,t)=>e.includes(t)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");d(()=>{let t=[...c,...c.filter((s,t)=>e.includes(t)).map((e,s)=>({...e,position:c.length+1+s}))];s.setValue("symptoms",t.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),o([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(t),positiveLabel:"Duplicate"})},[s,c,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{ref:l}),(0,i.jsx)(I.DataTable,{title:"Symptoms",sortable:!t,selectable:!t,onSort:u,selectedIndexes:a,onSelect:o,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(T,{form:s,disabled:t,children:!t&&(0,i.jsx)(C.hg,{asChild:!0,children:(0,i.jsxs)(r.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(N.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:n}=e,a=c[n];return(0,i.jsxs)(S.h_,{children:[(0,i.jsx)(S.$F,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(D.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(S.AW,{children:[(0,i.jsx)(S.Xi,{asChild:!0,children:(0,i.jsx)(T,{disabled:t,form:s,symptom:{data:a,index:n},children:e=>{let{extraProps:s}=e;return(0,i.jsxs)(C.hg,{...s,className:(0,m.cn)(null==s?void 0:s.className,"w-full"),children:[(0,i.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:t?"View":"Edit"})]})}})}),(0,i.jsxs)(S.Xi,{onClick:()=>{var e,s;null===(s=l.current)||void 0===s||null===(e=s.click)||void 0===e||e.call(s),setTimeout(()=>h([n]),0)},className:(0,m.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:t,children:[(0,i.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:c.map(e=>[e.type,e.name,""])}),!t&&(0,i.jsx)(R,{disabled:t,selected:a,onDelete:()=>h(a),onCopy:()=>x(a)})]})}function A(e){let s=(0,l.useRouter)(),t=function(e){let{formData:s,scriptId:t}=e,i=(0,l.useRouter)(),[r,a]=(0,n.useState)(!1),{saveDiagnoses:o}=(0,f.h)(),{alert:d}=(0,v.s)(),{viewOnly:c}=(0,j.b)(),u=(0,n.useMemo)(()=>"/script/".concat(t,"?section=diagnoses"),[t]),m=(0,n.useCallback)(()=>({version:(null==s?void 0:s.version)||1,scriptId:(null==s?void 0:s.scriptId)||t,diagnosisId:(null==s?void 0:s.diagnosisId)||(0,p.Z)(),name:(null==s?void 0:s.name)||"",description:(null==s?void 0:s.description)||"",key:(null==s?void 0:s.key)||"",expression:(null==s?void 0:s.expression)||"",expressionMeaning:(null==s?void 0:s.expressionMeaning)||"",severityOrder:(null==s?void 0:s.severityOrder)||null,symptoms:(null==s?void 0:s.symptoms)||[],text1:(null==s?void 0:s.text1)||"",text2:(null==s?void 0:s.text2)||"",text3:(null==s?void 0:s.text3)||"",image1:(null==s?void 0:s.image1)||null,image2:(null==s?void 0:s.image2)||null,image3:(null==s?void 0:s.image3)||null,preferences:(null==s?void 0:s.preferences)||y.$7}),[s,t]),h=(0,x.cI)({defaultValues:m()}),{formState:{dirtyFields:b},handleSubmit:w}=h,N=(0,n.useMemo)(()=>!!Object.keys(b).length,[b]),D=w(async e=>{try{var s;a(!0);let t={...e,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!t.scriptId)throw Error("Diagnosis is missing script reference!");let n=(await g.Z.post("/api/diagnoses/save",{data:[t],broadcastAction:!0})).data;if(null===(s=n.errors)||void 0===s?void 0:s.length)throw Error(n.errors.join(", "));i.refresh(),d({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>i.push(u)})}catch(e){d({variant:"error",message:"Failed to save draft: "+e.message})}finally{a(!1)}}),F=(0,n.useMemo)(()=>r||c,[r,c]);return{...h,formIsDirty:N,saving:r,scriptPageHref:u,disabled:F,save:D,getDefaultValues:m}}(e),{formIsDirty:w,saving:N,scriptPageHref:D,disabled:F,register:k,watch:I,setValue:C,save:S}=t,z=I("name"),M=I("key"),R=I("image1"),_=I("image2"),E=I("image3"),O=I("preferences"),Z=(0,n.useCallback)(()=>{s.push(D)},[s,D]);return(0,i.jsxs)(i.Fragment,{children:[N&&(0,i.jsx)(u.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"name",error:!F&&!z,children:"Name *"}),(0,i.jsx)(a.I,{...k("name",{disabled:F,required:!0}),name:"name",noRing:!1,error:!F&&!z})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(a.I,{...k("severityOrder",{disabled:F}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(d._,{htmlFor:"key",error:!F&&!M,children:"Key *"}),(0,i.jsx)(a.I,{...k("key",{disabled:F,required:!0}),name:"key",noRing:!1,error:!F&&!M})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(a.I,{...k("description",{disabled:F}),name:"description",noRing:!1}),(0,i.jsx)(h.w,{id:"description",title:"Description",disabled:F,data:O,onSave:e=>C("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(a.I,{...k("expression",{disabled:F}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(d._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(a.I,{...k("expressionMeaning",{disabled:F}),name:"expressionMeaning",noRing:!1})]}),[["text1",R],["text2",_],["text3",E]].map((e,s)=>{let[t,l]=e,r="image".concat(s+1);return(0,i.jsx)(n.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(d._,{htmlFor:"imageTextFields.".concat(s,".text"),children:["Text ",s+1]}),(0,i.jsx)(o.g,{...k(t,{disabled:F}),name:"text".concat(s+1),noRing:!1,rows:5}),(0,i.jsx)(h.w,{id:t,title:"Text ".concat(s+1),disabled:F,data:O,onSave:e=>C("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(b.M,{disabled:F,image:l,onChange:e=>C(r,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(s))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,m.cn)("text-danger text-xs",F&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(r.z,{variant:"ghost",onClick:()=>Z(),children:"Cancel"}),(0,i.jsx)(r.z,{disabled:F,onClick:()=>S(),children:"Save Draft"})]}),(0,i.jsx)(c.Z,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)(P,{disabled:F,form:t})})]})}},20021:function(e,s,t){"use strict";t.d(s,{M:function(){return m}});var i=t(57437),n=t(92513),l=t(90399),r=t(5192),a=t(12491),o=t(50495),d=t(76230),c=t(77605),u=t(21475);function m(e){let{image:s,disabled:t,onChange:m}=e,h=(0,u.Y)(),[x,{width:p}]=(0,r.Z)(),{confirm:g}=(0,d.t)(),f="".concat((null==s?void 0:s.data)||"").split("?").filter((e,s)=>s).join(""),{width:v,height:j}=a.Z.parse(f);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{ref:x,className:"flex flex-col gap-y-2 min-w-60 max-w-60",children:[(0,i.jsx)("div",{className:"w-full flex flex-col items-center justify-center min-h-28",children:(0,i.jsx)(c.E,{alt:"",width:Number(v||"0"),height:Number(j||"0"),containerWidth:p,src:(null==s?void 0:s.data)||"/images/placeholder.png"})}),(0,i.jsxs)("div",{className:"flex items-center justify-center gap-x-4",children:[(0,i.jsx)(o.z,{size:"icon",className:"w-8 h-8 rounded-full",disabled:t,onClick:()=>h.openModal({onSelectFiles(e){let[s]=e;m({data:s.url,fileId:s.fileId,filename:s.filename,size:s.size,contentType:s.contentType})}}),children:(0,i.jsx)(n.Z,{className:"h-4 w-4"})}),!!s&&(0,i.jsx)(o.z,{variant:"destructive",size:"icon",className:"w-8 h-8 rounded-full",disabled:t,onClick:()=>g(()=>m(null),{title:"Delete image",message:"Are you sure you want to delete this image?",danger:!0}),children:(0,i.jsx)(l.Z,{className:"h-4 w-4"})})]})]})})}},95229:function(e,s,t){"use strict";t.d(s,{Alert:function(){return r}});var i=t(53699),n=t(16463),l=t(2265);function r(e){let s=(0,n.useRouter)(),{alert:t}=(0,i.s)();return(0,l.useEffect)(()=>{let{redirectTo:i,onClose:n,...l}=e;t({...l,variant:l.variant||"error",buttonLabel:l.buttonLabel||"Ok",onClose:()=>{null==n||n(),i&&s.replace(i)}})},[t,s,e]),null}},77605:function(e,s,t){"use strict";t.d(s,{E:function(){return l}});var i=t(57437),n=t(48625);function l(e){let{width:s=0,height:t=0,containerWidth:l,...r}=e;r.sizes;let a={width:"100%",height:"auto"};if(t&&s&&l){let e=(0,n.a)({imageWidth:s,imageHeight:t,containerWidth:l});a.width=e.imageWidth,a.height=e.imageHeight}return(0,i.jsx)("img",{...r,src:r.src,style:{...a,...r.style}})}},64344:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var i=t(57437),n=t(2265),l=t(48484),r=t(37440);let a=n.forwardRef((e,s)=>{let{className:t,orientation:n="horizontal",decorative:a=!0,...o}=e;return(0,i.jsx)(l.f,{ref:s,decorative:a,orientation:n,className:(0,r.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",t),...o})});a.displayName=l.f.displayName},21475:function(e,s,t){"use strict";t.d(s,{Y:function(){return l}});var i=t(39099),n=t(38472);let l=(0,i.Ue)((e,s)=>{let t=async t=>{try{let{reset:i,...l}={...t};i&&(l.page=1),e({loading:!0,unhandledErrors:[]});let{data:r,errors:a,totalPages:o,totalRows:d,page:c}=(await n.Z.get("/api/files?data=".concat(JSON.stringify({...l,limit:l.limit||s().limit,page:l.page||s().page})))).data;if(null==a?void 0:a.length)e({unhandledErrors:a});else{let t=i?r:[...s().files,...r];t=t.filter((e,s)=>s===t.map(e=>e.fileId).indexOf(e.fileId)),l.siteId&&l.siteId!==s().siteId&&(t=r),e({files:t,totalPages:o,totalRows:d,page:c,siteId:l.siteId||s().siteId,lastFilesQueryDate:r.length?new Date:null})}}catch(s){e({unhandledErrors:[s.message]})}finally{e({loading:!1})}};return{isModalOpen:!1,loading:!1,siteId:"",files:[],unhandledErrors:[],lastFilesQueryDate:null,page:1,limit:15,totalPages:1,totalRows:0,onSelectFiles:null,selectMultiple:!1,getFiles:t,openModal(i){e({onSelectFiles:(null==i?void 0:i.onSelectFiles)||null,isModalOpen:!0}),s().lastFilesQueryDate||t()},closeModal:()=>e({isModalOpen:!1})}})},48625:function(e,s,t){"use strict";async function i(e){return new Promise((s,t)=>{let i=new Image;i.onload=function(){s({width:i.width,height:i.height})},i.onerror=function(e,s,i,n,l){t(l||Error("Failed to load image"))},i.src=e})}function n(e){let{imageWidth:s,imageHeight:t,containerWidth:i}=e;return s>i&&(t=i/s*t,s=i),{imageWidth:s,imageHeight:t}}t.d(s,{a:function(){return n},p:function(){return i}})},48484:function(e,s,t){"use strict";t.d(s,{f:function(){return d}});var i=t(2265),n=t(25171),l=t(57437),r="horizontal",a=["horizontal","vertical"],o=i.forwardRef((e,s)=>{let{decorative:t,orientation:i=r,...o}=e,d=a.includes(i)?i:r;return(0,l.jsx)(n.WV.div,{"data-orientation":d,...t?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...o,ref:s})});o.displayName="Separator";var d=o}}]);