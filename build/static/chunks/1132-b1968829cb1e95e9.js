(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1132],{51132:function(e,s,n){Promise.resolve().then(n.bind(n,45427)),Promise.resolve().then(n.bind(n,95229)),Promise.resolve().then(n.bind(n,25704)),Promise.resolve().then(n.t.bind(n,231,23))},45427:function(e,s,n){"use strict";n.d(s,{DiagnosisForm:function(){return G}});var i=n(57437),l=n(2265),t=n(16463),a=n(39343),r=n(50495),d=n(83102),o=n(93146),c=n(67135),u=n(64344),m=n(39661),x=n(37440),h=n(87861),p=n(80852),v=n(20920),g=n(38472),y=n(15701),j=n(53699),f=n(17647),b=n(83146),D=n(71239),I=n(72341),k=n(42314),N=n(20021),C=n(12599),w=n(92513),F=n(45188),_=n(6649),S=n(90399),T=n(44380),R=n(90837),V=n(46910),M=n(76230),O=n(17501);function E(e){let{disabled:s,selected:n,onDelete:l,onCopy:t}=e;return(0,i.jsx)(i.Fragment,{children:!!n.length&&(0,i.jsx)(O.h,{children:(0,i.jsxs)(r.z,{variant:"destructive",className:"h-auto w-auto",disabled:s,onClick:()=>l(),children:[(0,i.jsx)(S.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:n.length>1?"Delete ".concat(n.length," symptoms"):"Delete symptom"})]})})})}var U=n(74709),P=n(85070),z=n(86466),Z=n(21453),q=n(84760);function A(e){let{children:s,symptom:n,form:t,disabled:o,...u}=e,{data:m,index:h}={...n},[g,y]=(0,l.useState)(!1),j=(0,l.useCallback)(()=>({...m,symptomId:(null==m?void 0:m.symptomId)||(0,v.Z)(),expression:(null==m?void 0:m.expression)||"",name:(null==m?void 0:m.name)||"",key:(null==m?void 0:m.key)||"",keyId:(null==m?void 0:m.keyId)||"",weight:(null==m?void 0:m.weight)||null,type:(null==m?void 0:m.type)||b.ph[0].value,position:(null==m?void 0:m.position)||1,printable:!!(null==m?void 0:m.printable)}),[m]),{control:f,reset:D,watch:I,register:k,handleSubmit:N,setValue:C}=(0,a.cI)({defaultValues:j()}),w=I("type"),F=I("name"),_=I("printable"),S=(0,l.useMemo)(()=>!!o,[o]),T=N(e=>{!(0,Z.x)(h)&&m?t.setValue("symptoms",t.getValues("symptoms").map((s,n)=>({...s,...n===h?e:null}))):t.setValue("symptoms",[...t.getValues("symptoms"),e],{shouldDirty:!0}),y(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(U.u,{open:g,title:m?"Add symptom":"Edit symptom",trigger:"function"==typeof s?s({extraProps:u}):s,onOpenChange:e=>{y(e),D(j())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",S&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(R.GG,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(r.z,{disabled:S,onClick:()=>T(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(q.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(P.E,{disabled:S,defaultValue:w,onValueChange:e=>C("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:b.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(P.m,{value:e.value,id:e.value}),(0,i.jsx)(c._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(q.D,{children:"Properties"}),(0,i.jsx)("div",{children:(0,i.jsx)(a.Qr,{control:f,name:"key",render:e=>{let{field:{value:s,onChange:n}}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!S&&!s,children:"Key *"}),(0,i.jsx)(p.L,{value:"".concat(s||""),disabled:!1,onChange:e=>{let[s]=e;n(s.name),C("name",null==s?void 0:s.label,{shouldDirty:!0}),C("keyId",null==s?void 0:s.uniqueKey,{shouldDirty:!0})}})]})}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{error:!S&&!F,htmlFor:"name",children:"Name *"}),(0,i.jsx)(d.I,{...k("name",{disabled:S,required:!0}),name:"name",error:!S&&!F})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(d.I,{...k("weight",{disabled:S}),name:"weight",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(d.I,{...k("expression",{disabled:S}),name:"expression"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:b._S})]})]}),(0,i.jsx)(q.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(z.X,{id:"printable",disabled:S,checked:_,onCheckedChange:()=>C("printable",!_,{shouldDirty:!0})}),(0,i.jsx)(c._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function $(e){let{form:s,disabled:n}=e,t=(0,l.useRef)(null),[a,d]=(0,l.useState)([]),{confirm:o}=(0,M.t)(),c=s.watch("symptoms"),u=(0,l.useCallback)((e,n)=>{let i=(0,C.q)([...c],e,n);s.setValue("symptoms",i.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0})},[s,c]),m=(0,l.useCallback)(e=>{let n=c.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");o(()=>{let n=c.filter((s,n)=>!e.includes(n));s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),d([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),danger:!0,positiveLabel:"Delete"})},[s,c,o]),h=(0,l.useCallback)(e=>{let n=c.filter((s,n)=>e.includes(n)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");o(()=>{let n=[...c,...c.filter((s,n)=>e.includes(n)).map((e,s)=>({...e,position:c.length+1+s}))];s.setValue("symptoms",n.map((e,s)=>({...e,position:s+1})),{shouldDirty:!0}),d([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),positiveLabel:"Duplicate"})},[s,c,o]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{ref:t}),(0,i.jsx)(T.DataTable,{title:"Symptoms",sortable:!n,selectable:!n,onSort:u,selectedIndexes:a,onSelect:d,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(A,{form:s,disabled:n,children:!n&&(0,i.jsx)(R.hg,{asChild:!0,children:(0,i.jsxs)(r.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:l}=e,a=c[l];return(0,i.jsxs)(V.h_,{children:[(0,i.jsx)(V.$F,{asChild:!0,children:(0,i.jsx)(r.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(F.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(V.AW,{children:[(0,i.jsx)(V.Xi,{asChild:!0,children:(0,i.jsx)(A,{disabled:n,form:s,symptom:{data:a,index:l},children:e=>{let{extraProps:s}=e;return(0,i.jsxs)(R.hg,{...s,className:(0,x.cn)(null==s?void 0:s.className,"w-full"),children:[(0,i.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:n?"View":"Edit"})]})}})}),(0,i.jsxs)(V.Xi,{onClick:()=>{var e,s;null===(s=t.current)||void 0===s||null===(e=s.click)||void 0===e||e.call(s),setTimeout(()=>m([l]),0)},className:(0,x.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:n,children:[(0,i.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:c.map(e=>[e.type,e.name,""])}),!n&&(0,i.jsx)(E,{disabled:n,selected:a,onDelete:()=>m(a),onCopy:()=>h(a)})]})}var B=n(61386);function G(e){var s,n;let C=(0,t.useRouter)(),w=function(e){let{formData:s,scriptId:n,script:i}=e,r=(0,t.useRouter)(),[d,o]=(0,l.useState)(!1),{saveDiagnoses:c}=(0,y.h)(),{alert:u}=(0,j.s)(),{viewOnly:m,authenticatedUser:x}=(0,f.b)(),h=(0,l.useMemo)(()=>"/script/".concat(n,"?section=diagnoses"),[n]),p=!(null==s?void 0:s.diagnosisId),N=(0,l.useCallback)(()=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():(0,v.Z)(),[]),C=(0,l.useRef)((null==s?void 0:s.diagnosisId)?(0,k.$)({entityId:s.diagnosisId,entityType:"diagnosis",userId:null==x?void 0:x.userId,userName:null==x?void 0:x.displayName,entityTitle:(null==s?void 0:s.name)||(null==s?void 0:s.key)||"Diagnosis",resolveEntityTitle:e=>(null==e?void 0:e.name)||(null==e?void 0:e.key)||(null==e?void 0:e.description)}):null),w=(0,l.useRef)(null),F=(0,l.useCallback)(()=>({version:(null==s?void 0:s.version)||1,scriptId:(null==s?void 0:s.scriptId)||n,diagnosisId:(null==s?void 0:s.diagnosisId)||N(),name:(null==s?void 0:s.name)||"",description:(null==s?void 0:s.description)||"",key:(null==s?void 0:s.key)||"",keyId:(null==s?void 0:s.keyId)||"",expression:(null==s?void 0:s.expression)||"",expressionMeaning:(null==s?void 0:s.expressionMeaning)||"",severityOrder:(null==s?void 0:s.severityOrder)||null,symptoms:(null==s?void 0:s.symptoms)||[],text1:(null==s?void 0:s.text1)||"",text2:(null==s?void 0:s.text2)||"",text3:(null==s?void 0:s.text3)||"",image1:(null==s?void 0:s.image1)||null,image2:(null==s?void 0:s.image2)||null,image3:(null==s?void 0:s.image3)||null,preferences:(null==s?void 0:s.preferences)||b.$7}),[s,n,N]),_=(0,a.cI)({defaultValues:F()});(0,l.useEffect)(()=>{C.current&&s&&!w.current&&(w.current=s,C.current.setSnapshot(s))},[s]);let{formState:{dirtyFields:S},handleSubmit:T}=_,R=(0,l.useMemo)(()=>!!Object.keys(S).length,[S]),V=T(async e=>{try{var s;o(!0);let n=e.diagnosisId||N(),i={...e,diagnosisId:n,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!i.scriptId)throw Error("Diagnosis is missing script reference!");let l=(await g.Z.post("/api/diagnoses/save",{data:[i],broadcastAction:!0})).data;if(null===(s=l.errors)||void 0===s?void 0:s.length)throw Error(l.errors.join(", "));p?(console.log("[v0] Tracking new diagnosis creation:",n),await I.pb.addChange({entityType:"diagnosis",entityId:n,entityTitle:i.name||i.key||"Untitled Diagnosis",action:"create",fieldPath:"diagnosis",fieldName:"New Diagnosis",oldValue:null,newValue:i.name||"Untitled Diagnosis",userId:null==x?void 0:x.userId,userName:null==x?void 0:x.displayName,fullSnapshot:i})):C.current&&w.current&&(console.log("Tracking diagnosis changes on save draft"),await C.current.trackChanges(i,"Diagnosis draft saved")),r.refresh(),u({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>r.push(h)})}catch(e){u({variant:"error",message:"Failed to save draft: "+e.message})}finally{o(!1)}}),M=(0,D.v)({isDraft:!!(null==s?void 0:s.isDraft),userId:null==s?void 0:s.draftCreatedByUserId}),O=(null==i?void 0:i.draftCreatedByUserId)||(null==i?void 0:i.itemsChangedByUserId),E=(0,D.v)({isDraft:!!(null==i?void 0:i.isDraft)||!!(null==i?void 0:i.hasChangedItems),userId:O}),U=(0,l.useMemo)(()=>d||m||M||E,[d,m,M,E]);return{..._,formIsDirty:R,saving:d,scriptPageHref:h,disabled:U,isLocked:M,isScriptLocked:E,scriptLockedByUserId:O,save:V,getDefaultValues:F}}(e),{isLocked:F,control:_,saving:S,scriptPageHref:T,disabled:R,isScriptLocked:V,scriptLockedByUserId:M,register:O,watch:E,setValue:U,save:P}=w,z=E("name"),Z=E("key"),q=E("image1"),A=E("image2"),G=E("image3"),K=E("preferences"),L=(0,l.useCallback)(()=>{C.push(T)},[C,T]);return(0,i.jsxs)(i.Fragment,{children:[S&&(0,i.jsx)(m.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(F||V)&&(0,i.jsx)("div",{children:(0,i.jsx)(B.O,{card:!0,isDraft:!!(null===(s=e.formData)||void 0===s?void 0:s.isDraft)||V,userId:(null===(n=e.formData)||void 0===n?void 0:n.draftCreatedByUserId)||M,dataType:"diagnosis"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!R&&!Z,children:"Key *"}),(0,i.jsx)(a.Qr,{control:_,name:"key",render:e=>{let{field:{value:s,onChange:n}}=e;return(0,i.jsx)(p.L,{value:"".concat(s||""),disabled:!1,onChange:e=>{let[s]=e;n(s.name),U("name",null==s?void 0:s.label,{shouldDirty:!0}),U("keyId",null==s?void 0:s.uniqueKey,{shouldDirty:!0})}})}})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(d.I,{...O("severityOrder",{disabled:R}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(c._,{htmlFor:"name",error:!R&&!z,children:"Name *"}),(0,i.jsx)(d.I,{...O("name",{disabled:R,required:!0}),name:"name",noRing:!1,error:!R&&!z})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(d.I,{...O("description",{disabled:R}),name:"description",noRing:!1}),(0,i.jsx)(h.w,{id:"description",title:"Description",disabled:R,data:K,onSave:e=>U("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(d.I,{...O("expression",{disabled:R}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(d.I,{...O("expressionMeaning",{disabled:R}),name:"expressionMeaning",noRing:!1})]}),[["text1",q],["text2",A],["text3",G]].map((e,s)=>{let[n,t]=e,a="image".concat(s+1);return(0,i.jsx)(l.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(c._,{htmlFor:"imageTextFields.".concat(s,".text"),children:["Text ",s+1]}),(0,i.jsx)(o.g,{...O(n,{disabled:R}),name:"text".concat(s+1),noRing:!1,rows:5}),(0,i.jsx)(h.w,{id:n,title:"Text ".concat(s+1),disabled:R,data:K,onSave:e=>U("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(N.M,{disabled:R,image:t,onChange:e=>U(a,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(s))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,x.cn)("text-danger text-xs",R&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(r.z,{variant:"ghost",onClick:()=>L(),children:"Cancel"}),(0,i.jsx)(r.z,{disabled:R,onClick:()=>P(),children:"Save Draft"})]}),(0,i.jsx)(u.Separator,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)($,{disabled:R,form:w})})]})}}}]);