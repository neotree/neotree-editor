(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3848],{46822:function(e,a,l){Promise.resolve().then(l.bind(l,60578)),Promise.resolve().then(l.bind(l,89884))},60578:function(e,a,l){"use strict";l.d(a,{DataKeyForm:function(){return T}});var n=l(57437),t=l(2265),i=l(29501),r=l(99397),d=l(71533),s=l(27413),u=l(20657),o=l(99376),c=l(27648),m=l(49360),y=l(68577),h=l(53647),p=l(84190),v=l(62869),f=l(26815),x=l(95186),j=l(86180),b=l(66024),g=l(32405),N=l(69711),w=l(51383),I=l(66070),k=l(24959),D=l(67132),K=l(22381),q=l(73526);let C=e=>{var a,l,n,t,i,r,d,s;if(!e)return null;let u="string"==typeof e.version?Number(e.version):null!==(a=e.version)&&void 0!==a?a:null;return{uuid:null!==(l=e.uuid)&&void 0!==l?l:"",uniqueKey:null!==(n=e.uniqueKey)&&void 0!==n?n:"",name:null!==(t=e.name)&&void 0!==t?t:"",refId:null!==(i=e.refId)&&void 0!==i?i:"",dataType:null!==(r=e.dataType)&&void 0!==r?r:"",label:null!==(d=e.label)&&void 0!==d?d:"",options:Array.isArray(e.options)?e.options:[],metadata:null!==(s=e.metadata)&&void 0!==s?s:{},version:u}};function T(e){let{loadingDataKeys:a}=(0,y.M)();return a?(0,n.jsx)(N.a,{overlay:!0}):(0,n.jsx)(U,{...e})}function U(e){let{disabled:a}=e,{dataKeyId:l}=(0,o.useParams)(),{allDataKeys:T,loadingDataKeys:U,saving:F,saveDataKeys:M}=(0,y.M)(),{confirm:S}=(0,j.t)(),{authenticatedUser:Z}=(0,D.b)(),V=(0,t.useMemo)(()=>T.find(e=>e.uuid===l||e.uniqueKey===l),[T,l]),_=(0,k.v)({isDraft:!!(null==V?void 0:V.isDraft),userId:null==V?void 0:V.draftCreatedByUserId});a=a||_;let{control:R,register:A,handleSubmit:E,watch:P,setValue:z}=(0,i.cI)({defaultValues:{...V,name:(null==V?void 0:V.name)||"",refId:(null==V?void 0:V.refId)||"",dataType:(null==V?void 0:V.dataType)||"",label:(null==V?void 0:V.label)||"",options:(null==V?void 0:V.options)||[],metadata:(null==V?void 0:V.metadata)||{},version:(null==V?void 0:V.version)||1}}),L=(0,t.useRef)(null),Q=(0,t.useRef)(null),B=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(!(null==V?void 0:V.uuid)){L.current=null,Q.current=null,B.current=null;return}if(B.current===V.uuid&&L.current)return;let e=(0,K.$u)({entityId:V.uuid,entityType:"dataKey",userId:null==Z?void 0:Z.userId,userName:null==Z?void 0:Z.displayName,entityTitle:(null==V?void 0:V.name)||(null==V?void 0:V.uniqueKey)||"Data Key",resolveEntityTitle:e=>(null==e?void 0:e.name)||(null==e?void 0:e.uniqueKey)}),a=C(V);a&&(e.setSnapshot(a),Q.current=a),L.current=e,B.current=V.uuid},[V,null==Z?void 0:Z.userId,null==Z?void 0:Z.displayName]);let O=P("dataType"),W=P("options"),$=g.y0.find(e=>e.value===O),X=E(async e=>{var a,l;let n=(null==e?void 0:e.uuid)||(null==V?void 0:V.uuid)||(0,m.Z)(),t=null!==(l=null!==(a=null==e?void 0:e.uniqueKey)&&void 0!==a?a:null==V?void 0:V.uniqueKey)&&void 0!==l?l:null,i={...e,uuid:n,uniqueKey:t,version:"string"==typeof e.version?Number(e.version):e.version};z("uuid",n),t&&z("uniqueKey",t);let r=C(i),d=i.name||i.uniqueKey||"Data Key";if(!V&&r){let e=(await q.pb.getEntityChanges(n,"dataKey")).find(e=>"create"===e.action);(null==e?void 0:e.id)?await q.pb.updateChange(e.id,{fieldName:i.name||"New Data Key",newValue:r,timestamp:Date.now(),userId:null==Z?void 0:Z.userId,userName:null==Z?void 0:Z.displayName,entityTitle:d,fullSnapshot:r}):await q.pb.addChange({entityType:"dataKey",entityId:n,entityTitle:d,action:"create",fieldPath:"dataKey",fieldName:i.name||"New Data Key",oldValue:null,newValue:r,userId:null==Z?void 0:Z.userId,userName:null==Z?void 0:Z.displayName,fullSnapshot:r})}else L.current&&Q.current&&r&&await L.current.trackChanges(r,"Data key saved");await M([{...i}],e=>{e||(window.location.href="/data-keys")})}),Y=a||F,G=(0,t.useMemo)(()=>W.map(e=>T.find(a=>a.uniqueKey===e)).filter(e=>e),[T,W]),H=U||F;return(0,n.jsxs)(n.Fragment,{children:[H&&(0,n.jsx)(N.a,{overlay:!0}),(0,n.jsx)(I.Zb,{children:(0,n.jsxs)(I.aY,{children:[(0,n.jsxs)(I.Ol,{children:[(0,n.jsxs)(I.ll,{children:[V?"Edit":"New"," data key"]}),(0,n.jsx)(I.SZ,{className:"hidden",children:""})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col py-2 px-0 gap-y-4 overflow-y-auto",children:[(0,n.jsx)(i.Qr,{control:R,name:"dataType",disabled:Y,rules:{required:!0},render:e=>{let{field:{value:a,onChange:l}}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(f._,{htmlFor:"name",children:"Data type *"}),(0,n.jsxs)(h.Ph,{value:a,name:"name",disabled:Y,onValueChange:e=>{l(e);let a=g.y0.find(a=>a.value===e);z("options",(null==a?void 0:a.hasChildren)&&(null==V?void 0:V.options)||[])},children:[(0,n.jsx)(h.i4,{children:(0,n.jsx)(h.ki,{placeholder:"Select type"})}),(0,n.jsx)(h.Bw,{children:(0,n.jsx)(h.DI,{children:g.y0.map(e=>(0,n.jsx)(h.Ql,{value:e.value,children:e.label},e.value))})})]})]})})}}),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(f._,{htmlFor:"name",children:"Key *"}),(0,n.jsx)(x.I,{disabled:Y,...A("name",{disabled:Y,required:!0})})]}),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsx)(f._,{htmlFor:"label",children:"Label *"}),(0,n.jsx)(x.I,{disabled:Y,...A("label",{disabled:Y,required:!0})})]}),(0,n.jsxs)("div",{className:"px-4 hidden",children:[(0,n.jsx)(f._,{htmlFor:"refId",children:"Ref ID"}),(0,n.jsx)(x.I,{disabled:Y,...A("refId",{disabled:Y,required:!1})})]}),(0,n.jsx)(i.Qr,{control:R,name:"options",disabled:Y,render:e=>{let{field:{value:l,onChange:t}}=e;return(null==$?void 0:$.hasChildren)?(0,n.jsx)("div",{className:"mt-4 pt-4 border-t border-t-border",children:(0,n.jsx)(b.DataTable,{sortable:!a,onSort:(e,a)=>{t((0,u.q)([...l],e,a))},search:{},title:"Options",headerActions:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(w.V,{multiple:!0,search:{placeholder:"Search data keys"},options:T.filter(e=>!W.includes(e.uniqueKey)).map(e=>({label:e.name,value:e.uniqueKey,caption:e.dataType||"",description:e.label})),trigger:(0,n.jsxs)(v.z,{variant:"ghost",className:"w-auto h-auto",children:[(0,n.jsx)(r.Z,{className:"w-4 h-4 mr-2"}),"Add"]}),onSelect:e=>{t([...l,...e.map(e=>e.value)])}})}),noDataMessage:(0,n.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:(0,n.jsx)("div",{children:"Data keys has no options"})}),columns:[{name:"Key"},{name:"Label"},{name:"Data type"},{name:"",align:"right",cellClassName:"w-20",cellRenderer(e){let{rowIndex:t}=e;return!l[t]||a?null:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(p.h_,{children:[(0,n.jsx)(p.$F,{children:(0,n.jsx)(d.Z,{className:"h-4 w-4"})}),(0,n.jsx)(p.AW,{children:(0,n.jsxs)(p.Xi,{className:"text-destructive",onClick:()=>setTimeout(()=>S(()=>z("options",W.filter((e,a)=>a!==t)),{title:"Delete",message:"Are you sure you want to delete data key option?",danger:!0}),0),children:[(0,n.jsx)(s.Z,{className:"h-4 w-4 mr-2"})," Delete"]})})]})})}}],data:G.map(e=>[e.name||"",e.label||"",e.dataType||"",""])})}):(0,n.jsx)(n.Fragment,{})}})]}),(0,n.jsx)("br",{}),(0,n.jsxs)(I.eW,{className:"gap-x-2",children:[(0,n.jsx)("div",{className:"ml-auto"}),(0,n.jsx)(v.z,{asChild:!0,variant:"ghost",children:(0,n.jsx)(c.default,{href:"/data-keys",children:"Cancel"})}),!a&&(0,n.jsx)(v.z,{onClick:()=>X(),disabled:Y,children:"Save"})]})]})})]})}},15001:function(e,a,l){"use strict";l.d(a,{Z:function(){return n}});let n=(0,l(79205).Z)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},99397:function(e,a,l){"use strict";l.d(a,{Z:function(){return n}});let n=(0,l(79205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},27648:function(e,a,l){"use strict";l.d(a,{default:function(){return t.a}});var n=l(72972),t=l.n(n)},49360:function(e,a,l){"use strict";l.d(a,{Z:function(){return s}});for(var n,t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},i=new Uint8Array(16),r=[],d=0;d<256;++d)r.push((d+256).toString(16).slice(1));var s=function(e,a,l){if(t.randomUUID&&!a&&!e)return t.randomUUID();var d=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)})();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,a){l=l||0;for(var s=0;s<16;++s)a[l+s]=d[s];return a}return function(e,a=0){return(r[e[a+0]]+r[e[a+1]]+r[e[a+2]]+r[e[a+3]]+"-"+r[e[a+4]]+r[e[a+5]]+"-"+r[e[a+6]]+r[e[a+7]]+"-"+r[e[a+8]]+r[e[a+9]]+"-"+r[e[a+10]]+r[e[a+11]]+r[e[a+12]]+r[e[a+13]]+r[e[a+14]]+r[e[a+15]]).toLowerCase()}(d)}}}]);