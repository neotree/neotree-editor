"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5412],{87973:function(e,n,t){t.d(n,{M:function(){return z}});var l=t(57437),a=t(2265),i=t(92513),s=t(90399),r=t(5192),c=t(12491),d=t(38472),o=t(50495),h=t(76230),u=t(20920),f=t(58184),m=t(99827),g=t(9704),p=t(37440),x=t(39661),j=t(53699);async function v(e){return new Promise((n,t)=>{let l=new Image;l.onload=function(){n({width:l.width,height:l.height})},l.onerror=function(e,n,l,a,i){t(i||Error("Failed to load image"))},l.src=e})}var w=t(66648);function y(e){let{width:n=0,height:t=0,containerWidth:a,...i}=e,s=i.sizes||"100vw",r={width:"100%",height:"auto"};if(t&&n&&a){s=void 0;let e=function(e){let{imageWidth:n,imageHeight:t,containerWidth:l}=e;return n>l&&(t=l/n*t,n=l),{imageWidth:n,imageHeight:t}}({imageWidth:n,imageHeight:t,containerWidth:a});r.width=e.imageWidth,r.height=e.imageHeight}return(0,l.jsx)(w.default,{...i,width:n,height:t,sizes:s,style:{...r,...i.style}})}function b(e){let{type:n,children:t,inputProps:i,fileDetails:s,onUpload:c,...d}=e,[h,{width:w}]=(0,r.Z)(),[b,N]=(0,a.useState)(!1),[k,C]=(0,a.useState)([]),[z,Z]=(0,a.useState)(!1),{alert:U}=(0,j.s)(),L=(0,a.useCallback)(async()=>{let e=(null==i?void 0:i.multiple)?k:[k[0]];try{for(let{file:n,metadata:t,fileId:l}of(Z(!0),e)){let e=new FormData;e.append("file",n),e.append("fileId",l||(0,u.Z)()),e.append("filename",n.name),e.append("contentType",n.type),e.append("size","".concat(n.size)),e.append("metadata",JSON.stringify({...t})),s&&Object.keys(s).forEach(n=>{let t=s[n];e.append(n,JSON.stringify(t))}),await c(e)}N(!1),C([]),U({title:"Success",message:"File".concat(e.length>1?"s":""," uploaded successfully!"),variant:"success"})}catch(n){U({title:"Error",message:"Failed to upload file".concat(e.length>1?"s":"",": ").concat(n.message),variant:"error"})}finally{Z(!1)}},[c,U,k,null==i?void 0:i.multiple,s]),E=(0,a.useCallback)(async e=>{try{var n;let t=[];if(null===(n=e.target.files)||void 0===n?void 0:n.length)for(let n=0;n<e.target.files.length;n++)t.push(e.target.files[n]);let l=[];for(let e of t){let n,t;let a=URL.createObjectURL(e),i={};if("".concat(e.type).includes("image"))try{let e=await v(a);i={...i,...e},n=a}catch(e){}l.push({fileId:(0,u.Z)(),file:e,url:a,imageURL:n,videoURL:t,metadata:i})}C(l)}catch(e){U({title:"Error",message:e.message})}},[U]);return(0,l.jsxs)(l.Fragment,{children:[z&&(0,l.jsx)(x.a,{overlay:!0}),(0,l.jsx)(g.u,{open:b,onOpenChange:e=>{N(e),C([])},title:"Upload file",trigger:t,...d,actions:(0,l.jsxs)(l.Fragment,{children:[!k.length&&(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(o.z,{variant:"ghost",onClick:()=>N(!1),children:"Cancel"}),!!k.length&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(o.z,{variant:"destructive",onClick:()=>C([]),children:"Clear"}),(0,l.jsxs)(o.z,{disabled:!k.length,onClick:()=>L(),className:(0,p.cn)(!k.length&&"hidden"),children:[(0,l.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),(0,l.jsx)("span",{children:"Upload"})]})]})]}),children:(0,l.jsxs)("div",{ref:h,children:[1===k.length&&k.map(e=>{let n=(0,l.jsx)(m.Z,{className:"w-20 h-20 text-muted-foreground"});return e.imageURL&&(n=(0,l.jsx)(y,{alt:"",width:e.metadata.width||0,height:e.metadata.height||0,containerWidth:w,src:e.imageURL||"/images/placeholder.png"})),(0,l.jsxs)("div",{className:(0,p.cn)("\n                                        flex\n                                        flex-col\n                                        gap-y-2\n                                        w-full\n                                        items-center\n                                        justify-center\n                                        text-xs\n                                    ",!(e.imageURL||e.videoURL)&&""),children:[n,(0,l.jsx)("span",{children:e.file.name})]},e.fileId)}),!k.length&&(0,l.jsxs)("div",{className:(0,p.cn)("\n                                    relative\n                                    w-full\n                                    h-36\n                                    bg-primary/20\n                                    flex\n                                    flex-col\n                                    items-center\n                                    justify-center\n                                    text-primary\n                                    uppercase\n                                    font-bold\n                                    rounded-md\n                                    transition-colors\n                                    hover:bg-primary/30\n                                ",!!k.length&&"hidden"),children:[(0,l.jsx)("div",{children:(null==i?void 0:i.placeholder)||"Choose file"}),(0,l.jsx)("input",{...i,type:"file",accept:n,value:"",className:(0,p.cn)("\n                                        absolute\n                                        left-0\n                                        top-0\n                                        w-full\n                                        h-full\n                                        opacity-0\n                                    "),onChange:E})]})]})})]})}var N=t(90837),k=t(15701),C=t(20357);function z(e){let{image:n,disabled:t,onChange:u}=e,[f,{width:m}]=(0,r.Z)(),{confirm:g}=(0,h.t)(),{uploadFile:p}=(0,k.h)(),x=(0,a.useCallback)(async e=>{let{file:n,errors:t}=(await d.Z.post("/api/files/upload",e)).data;if(null==t?void 0:t.length)throw Error(t.join(", "));if(n){let e=c.Z.stringify({...n.metadata});e=e?"?".concat(e):"",u({data:[C.env.NEXT_PUBLIC_APP_URL,"/files/".concat(n.fileId).concat(e)].join(""),fileId:n.fileId,filename:n.filename,size:n.size,contentType:n.contentType})}},[p,u]),j="".concat((null==n?void 0:n.data)||"").split("?").filter((e,n)=>n).join(""),{width:v,height:w}=c.Z.parse(j);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{ref:f,className:"flex flex-col gap-y-2 min-w-60 max-w-60",children:[(0,l.jsx)("div",{className:"w-full flex flex-col items-center justify-center min-h-28",children:(0,l.jsx)(y,{alt:"",width:Number(v||"0"),height:Number(w||"0"),containerWidth:m,src:(null==n?void 0:n.data)||"/images/placeholder.png"})}),(0,l.jsxs)("div",{className:"flex items-center justify-center gap-x-4",children:[(0,l.jsx)(b,{type:"image/*",onUpload:x,children:(0,l.jsx)(N.hg,{asChild:!0,children:(0,l.jsx)(o.z,{size:"icon",className:"w-8 h-8 rounded-full",disabled:t,children:(0,l.jsx)(i.Z,{className:"h-4 w-4"})})})}),!!n&&(0,l.jsx)(o.z,{variant:"destructive",size:"icon",className:"w-8 h-8 rounded-full",disabled:t,onClick:()=>g(()=>u(null),{title:"Delete image",message:"Are you sure you want to delete this image?",danger:!0}),children:(0,l.jsx)(s.Z,{className:"h-4 w-4"})})]})]})})}},17501:function(e,n,t){t.d(n,{h:function(){return s}});var l=t(57437),a=t(77606),i=t(37440);function s(e){let{children:n,className:t}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"h-16"}),(0,l.jsx)("div",{className:(0,i.cn)("\n                        fixed \n                        left-0 \n                        bottom-0 \n                        h-16 \n                        w-full \n                        border-t \n                        border-t-border \n                        z-[1] \n                        bg-primary-foreground \n                        dark:bg-background \n                        shadow-md \n                        dark:shadow-foreground/10\n                    "),children:(0,l.jsx)(a.V,{children:(0,l.jsx)("div",{className:(0,i.cn)("flex justify-end gap-x-4",t),children:n})})})]})}},95229:function(e,n,t){t.d(n,{Alert:function(){return s}});var l=t(53699),a=t(16463),i=t(2265);function s(e){let n=(0,a.useRouter)(),{alert:t}=(0,l.s)();return(0,i.useEffect)(()=>{let{redirectTo:l,onClose:a,...i}=e;t({...i,variant:i.variant||"error",buttonLabel:i.buttonLabel||"Ok",onClose:()=>{null==a||a(),l&&n.replace(l)}})},[t,n,e]),null}},77606:function(e,n,t){t.d(n,{V:function(){return i}});var l=t(57437),a=t(37440);function i(e){let{className:n,...t}=e;return(0,l.jsx)("div",{...t,className:(0,a.cn)("w-full max-w-screen-xl mx-auto p-5",n)})}},64344:function(e,n,t){t.d(n,{Z:function(){return r}});var l=t(57437),a=t(2265),i=t(48484),s=t(37440);let r=a.forwardRef((e,n)=>{let{className:t,orientation:a="horizontal",decorative:r=!0,...c}=e;return(0,l.jsx)(i.f,{ref:n,decorative:r,orientation:a,className:(0,s.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...c})});r.displayName=i.f.displayName}}]);