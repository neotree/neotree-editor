"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5330],{53850:function(e,t,a){a.d(t,{d:function(){return w}});var s=a(57437),l=a(2265),i=a(99376),r=a(29501),n=a(83464),d=a(53647),c=a(26110),o=a(19060),u=a(98656),f=a(79976),m=a(62869),p=a(69711),h=a(26815),x=a(9699),g=a(95186),y=a(94508),v=a(71706),b=a(60657);let j=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function w(e){var t,a;let{open:w,overWriteScriptWithId:N,onOpenChange:I,onImportSuccess:k}=e,_=(0,i.useRouter)(),C=(0,i.useParams)();N=N||C.scriptId;let{copyScripts:V}=(0,f.h)(),{alert:L}=(0,u.s)(),[D,S]=(0,l.useState)(!1),{sites:R,loading:E}=(0,v.k)({onLoadSitesError:()=>I(!1)}),z=E||D,{formState:{errors:T},reset:F,watch:P,setValue:Z,register:O,handleSubmit:A}=(0,r.cI)({defaultValues:j(N)}),B=P("confirmed"),G=P("overwriteDataKeys"),K=P("overwriteDrugsLibraryItems"),$=A(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(N&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");S(!0);let a=(await n.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:N,broadcastAction:!0})).data;if(null===(t=a.errors)||void 0===t?void 0:t.length)throw Error(a.errors.join(", "));_.refresh(),L({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==k||k(),F(j(N)),I(!1)}})}catch(e){L({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{S(!1)}});return(0,s.jsxs)(s.Fragment,{children:[z&&(0,s.jsx)(p.a,{overlay:!0}),(0,s.jsx)(x.u,{open:w,onOpenChange:()=>{I(!1),F(j(N))},title:"Import script",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(c.GG,{asChild:!0,children:(0,s.jsx)(m.z,{variant:"ghost",disabled:z,onClick:()=>I(!1),children:"Cancel"})}),(0,s.jsx)(m.z,{onClick:()=>$(),disabled:z,children:"Import"})]}),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,s.jsx)(b._,{children:(0,s.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,s.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h._,{htmlFor:"siteId",children:"Site *"}),(0,s.jsxs)(d.Ph,{name:"siteId",disabled:z,onValueChange:e=>Z("siteId",e,{shouldDirty:!0}),children:[(0,s.jsx)(d.i4,{children:(0,s.jsx)(d.ki,{placeholder:"Select site"})}),(0,s.jsx)(d.Bw,{children:(0,s.jsxs)(d.DI,{children:[(0,s.jsx)(d.n5,{children:"Sites"}),R.map(e=>{let{siteId:t,name:a}=e;return(0,s.jsx)(d.Ql,{value:t,children:a},t)})]})})]}),!!(null===(t=T.siteId)||void 0===t?void 0:t.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:T.siteId.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h._,{htmlFor:"scriptId",children:"Script ID *"}),(0,s.jsx)(g.I,{...O("scriptId",{disabled:z,required:!0}),name:"scriptId"}),!!(null===(a=T.scriptId)||void 0===a?void 0:a.message)&&(0,s.jsx)("div",{className:"text-xs text-danger mt-1",children:T.scriptId.message})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:z,checked:G,onCheckedChange:()=>Z("overwriteDataKeys",!G,{shouldDirty:!0})}),(0,s.jsx)(h._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2"),children:[(0,s.jsx)(o.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:z,checked:K,onCheckedChange:()=>Z("overwriteDrugsLibraryItems",!K,{shouldDirty:!0})}),(0,s.jsx)(h._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,s.jsxs)("div",{className:(0,y.cn)("flex gap-x-2",!N&&"hidden"),children:[(0,s.jsx)(o.X,{name:"confirmed",id:"confirmed",disabled:z,checked:B,onCheckedChange:()=>Z("confirmed",!B,{shouldDirty:!0})}),(0,s.jsx)(h._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},38789:function(e,t,a){a.d(t,{f:function(){return D}});var s=a(57437),l=a(69711),i=a(81066),r=a(53647),n=a(97930),d=a(2265),c=a(32489),o=a(83464),u=a(94508),f=a(16850),m=a(95186),p=a(26815),h=a(66070),x=a(62869),g=a(19060),y=a(9699),v=a(8272),b=a(81103),j=a(26110),w=a(98656),N=a(86180),I=a(67132),k=a(60657);function _(e){return RegExp.escape(e)}function C(e){let{scriptsSearchResults:t=[]}=e,a=[];return t.sort((e,t)=>e.position-t.position).forEach(e=>{a.push({type:"script",title:e.title,id:e.scriptId,matches:e.matches.map(e=>({...e,newValue:"",exclude:!1}))}),e.diagnoses.forEach(t=>{a.push({type:"diagnosis",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.diagnosisId,matches:t.matches.map(e=>({...e,newValue:"",exclude:!1}))})}),e.screens.forEach(t=>{a.push({type:"screen",title:t.title,parent:{id:e.scriptId,title:e.title,type:"script"},id:t.screenId,matches:t.matches.map(e=>({...e,newValue:"",exclude:!1}))})})}),a.map(e=>({...e,matches:e.matches.filter(e=>!["key","id","field_key","field_id","item_id","item_key","field_item_key","field_item_id"].includes(e.field))})).filter(e=>!!e.matches.length)}let V=[{label:"All matches",value:"all"},{label:"Scripts only",value:"scripts"},{label:"Screens only",value:"screens"},{label:"Diagnoses only",value:"diagnoses"}];function L(e){let{searchValue:t="",scriptsSearchResults:a=[]}=e,[i,n]=(0,d.useState)(!1),[L,D]=(0,d.useState)(V[0].value),[S,R]=(0,d.useState)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\"(.*?)\"/,"$1")}(t)),[E,z]=(0,d.useState)([]),[T,F]=(0,d.useState)(!1),[P,Z]=(0,d.useState)(""),O=(0,f.N)(P),A=(0,d.useRef)(O),B=(0,d.useRef)(T),{confirm:G}=(0,N.t)(),{alert:K}=(0,w.s)(),{isAdmin:$,isSuperUser:M,viewOnly:Y}=(0,I.b)();(0,d.useEffect)(()=>{(A.current!==O||B.current!==T)&&(A.current=O,B.current=T,z(e=>e.map(e=>({...e,matches:e.matches.map(e=>({...e,newValue:O?e.fieldValue.replace(new RegExp(_(S),T?"g":"gi"),O):"",exclude:!"".concat(e.fieldValue).match(new RegExp(_(S),T?"g":"gi"))}))}))))},[S,O,E,T]);let H=(0,d.useCallback)(()=>{D(V[0].value),R(S),z(C(e)),Z(""),A.current="",F(!1)},[e]),W=!E.length||!P,X=(0,d.useCallback)(t=>{A.current="",D(t),z(C(e).filter(e=>{switch(t){case"scripts":return"script"===e.type;case"screens":return"screen"===e.type;case"diagnoses":return"diagnosis"===e.type;default:return!0}}))},[L,e,T]),U=(0,d.useCallback)(async()=>{try{n(!0);let e=E.map(e=>({...e,matches:e.matches.filter(e=>!e.exclude)})).filter(e=>e.matches.length),t=(await o.Z.post("/api/save",{broadcastAction:!0,scripts:e.filter(e=>"script"===e.type).map(e=>({scriptId:e.id,data:e.matches.reduce((e,t)=>({...e,[t.field]:t.newValue}),{})})),screens:e.filter(e=>"screen"===e.type).map(e=>({screenId:e.id,data:{...e.matches.reduce((e,t)=>{let a=e._fields||[],s=e._items||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else if(t.field.includes("field_item_")){let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field.substring(11)]:t.newValue}}}else if(t.field.includes("field_")){let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field.substring(6)]:t.newValue}}}else{let e=s.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=s.length),s[e]={index:t.fieldIndex,data:{...s[e],[t.field.substring(5)]:t.newValue}}}return{...e,_fields:a,_items:s}},{})}})),diagnoses:e.filter(e=>"diagnosis"===e.type).map(e=>({diagnosisId:e.id,data:{...e.matches.reduce((e,t)=>{let a=e._fields||[];if(void 0===t.fieldIndex)e[t.field]=t.newValue;else{let e=a.map(e=>e.index).indexOf(t.fieldIndex);-1===e&&(e=a.length),a[e]={index:t.fieldIndex,data:{...a[e],[t.field]:t.newValue}}}return{...e,_fields:a}},{})}}))})).data;t.errors?K({title:"Error",message:t.errors.join(", "),variant:"error"}):K({title:"Success",message:"Changes saved successfully!",variant:"success",onClose:()=>window.location.reload()})}catch(e){K({title:"Error",message:e.message,variant:"error"})}finally{n(!1)}},[E]);return Y||!(M||$)?null:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(y.u,{onOpenChange:()=>{H()},title:(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"searchValue",children:"Search value"}),(0,s.jsx)(m.I,{disabled:!0,name:"searchValue",value:S,onChange:e=>R(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"replaceWith",children:"Replace with"}),(0,s.jsx)(m.I,{name:"replaceWith",value:P,onChange:e=>Z(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 sm:flex-row sm:[&>*]:flex-1 sm:gap-x-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(p._,{className:"mb-2 block text-left",htmlFor:"filter",children:"Filter"}),(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(r.Ph,{value:L,onValueChange:X,children:[(0,s.jsx)(r.i4,{children:(0,s.jsx)(r.ki,{placeholder:"All matches"})}),(0,s.jsx)(r.Bw,{children:V.map(e=>(0,s.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})})]}),(0,s.jsxs)("div",{className:"flex gap-x-2 items-center",children:[(0,s.jsx)(g.X,{id:"caseSensitive",name:"caseSensitive",checked:T,onCheckedChange:()=>{F(!T)}}),(0,s.jsx)(p._,{htmlFor:"caseSensitive",children:"Case sensitive"})]})]})]}),trigger:(0,s.jsx)(j.hg,{asChild:!0,children:(0,s.jsx)(x.z,{children:"Replace"})}),actions:(0,s.jsxs)("div",{className:"flex gap-x-4 ml-auto",children:[(0,s.jsx)(j.GG,{asChild:!0,children:(0,s.jsx)(x.z,{variant:"ghost",children:"Cancel"})}),(0,s.jsx)(x.z,{disabled:W,onClick:()=>G(U,{title:"Save changes",danger:!0}),children:"Save"})]}),contentProps:{className:"flex flex-col max-h-[100%] gap-y-4 p-0 m-0 max-w-full sm:max-w-screen-2xl"},children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-6",children:[(0,s.jsx)(k._,{color:"warning",children:"NB: Data key matches are not replaceable and will not be displayed"}),!E.length&&(0,s.jsx)("div",{className:"text-sm opacity-60 text-center",children:"No matches"}),E.map((e,t)=>e.matches.filter(e=>!e.exclude).length?(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[i&&(0,s.jsx)(l.a,{overlay:!0,transparent:!0}),(0,s.jsxs)("div",{className:"text-sm",children:[e.parent?(0,s.jsxs)("div",{children:[(0,s.jsxs)("b",{children:[(0,v.Z)(e.parent.type),":\xa0"]}),e.parent.title]}):null,(0,s.jsxs)("div",{children:[(0,s.jsxs)("b",{children:[(0,v.Z)(e.type),":\xa0"]}),e.title]})]}),e.matches.map((a,l)=>{let i=e.id+"_match".concat(l);return a.exclude?null:(0,s.jsx)(h.Zb,{children:(0,s.jsxs)(h.aY,{className:"px-4 py-4 flex items-center gap-x-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-y-2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("code",{className:"inline-block text-xs bg-primary/10 p-1 rounded-sm",children:[a.field,"number"==typeof a.fieldIndex&&(0,s.jsxs)(s.Fragment,{children:["\xa0(",(0,s.jsx)("b",{children:"position"})," = ",a.fieldIndex+1,")"]})]})}),(0,s.jsx)("code",{className:(0,u.cn)("block",a.newValue&&"bg-red-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:a.fieldValue.replace(new RegExp("(".concat(_(S),")"),T?"g":"gi"),"<mark>$1</mark>")}}),a.newValue&&(0,s.jsx)("code",{className:(0,u.cn)("block",P&&"bg-green-400/20 p-1 rounded-sm"),dangerouslySetInnerHTML:{__html:a.newValue.replaceAll(O,"<mark>".concat(O,"</mark>"))}})]}),(0,s.jsx)("div",{children:(0,s.jsx)(b.pn,{delayDuration:0,children:(0,s.jsxs)(b.u,{children:[(0,s.jsx)(b.aJ,{children:(0,s.jsx)(x.z,{variant:"ghost",onClick:()=>z(e=>e.map((e,a)=>a!==t?e:{...e,matches:e.matches.filter((e,t)=>l!==t)}).filter(e=>e.matches.length)),children:(0,s.jsx)(c.Z,{className:"size-4"})})}),(0,s.jsx)(b._v,{children:"Remove"})]})})})]})},i)})]},e.id):null)]})})})}function D(e){var t;let{search:a,setSearch:d,onSearch:c}=e;return(0,s.jsxs)(s.Fragment,{children:[a.searching&&(0,s.jsx)(l.a,{overlay:!0}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(i.M,{placeholder:"Search",onSearch:c})}),!!a.value&&(0,s.jsx)("div",{className:"w-[120px]",children:(0,s.jsxs)(r.Ph,{value:a.filter,onValueChange:e=>d(t=>({...t,filter:e,results:(0,n._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,s.jsx)(r.i4,{children:(0,s.jsx)(r.ki,{placeholder:"All matches"})}),(0,s.jsx)(r.Bw,{children:n.Hc.map(e=>(0,s.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})}),!!(null===(t=a.results)||void 0===t?void 0:t.length)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(L,{searchValue:a.value,scriptsSearchResults:a.results})})]})]})}},69711:function(e,t,a){a.d(t,{a:function(){return i}});var s=a(57437),l=a(15001);function i(e){let{overlay:t,transparent:a,padding:i="50px 0"}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",...t?{height:"100%",position:"fixed",top:0,left:0,bottom:0,zIndex:999,backgroundColor:a?"transparent":"rgba(255,255,255,.6)"}:{padding:i}},children:(0,s.jsx)(l.Z,{style:{height:24,width:24},className:"animate-spin"})})})}},81066:function(e,t,a){a.d(t,{M:function(){return r}});var s=a(57437),l=a(2265),i=a(94508);let r=(0,l.forwardRef)((e,t)=>{let{searchButton:a,hideSearchButton:r,onSearch:n,...d}=e,[c,o]=(0,l.useState)("");return(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==n||n(c)},children:(0,s.jsxs)("div",{className:(0,i.cn)("flex w-full"),children:[(0,s.jsx)("div",{className:(0,i.cn)("relative w-full"),children:(0,s.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:c,...d,onChange:e=>{var t;let a=e.target.value;o(a),null===(t=d.onChange)||void 0===t||t.call(d,e),a||null==n||n(a)},className:(0,i.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",d.className)})}),!r&&(0,s.jsx)("button",{type:"submit",className:(0,i.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==a?void 0:a.className),...a,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},89884:function(e,t,a){a.d(t,{Title:function(){return i}});var s=a(2265),l=a(40257);function i(e){let{children:t}=e;return(0,s.useEffect)(()=>{document.title=[l.env.NEXT_PUBLIC_APP_NAME||"",t||""].filter(e=>e).join(" - ")},[t]),(0,s.useEffect)(()=>()=>{document.title="".concat(l.env.NEXT_PUBLIC_APP_NAME||"")},[]),null}},66070:function(e,t,a){a.d(t,{Ol:function(){return n},SZ:function(){return c},Zb:function(){return r},aY:function(){return o},eW:function(){return u},ll:function(){return d}});var s=a(57437),l=a(2265),i=a(94508);let r=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...l})});r.displayName="Card";let n=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",a),...l})});n.displayName="CardHeader";let d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",a),...l})});d.displayName="CardTitle";let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...l})});c.displayName="CardDescription";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",a),...l})});o.displayName="CardContent";let u=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",a),...l})});u.displayName="CardFooter"},26110:function(e,t,a){a.d(t,{$N:function(){return x},Be:function(){return g},GG:function(){return u},Vq:function(){return d},cN:function(){return h},cZ:function(){return m},fK:function(){return p},hg:function(){return c}});var s=a(57437),l=a(2265),i=a(70001),r=a(32489),n=a(94508);let d=i.fC,c=i.xz,o=i.h_,u=i.x8,f=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.aV,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l})});f.displayName=i.aV.displayName;let m=l.forwardRef((e,t)=>{let{className:a,children:l,hideCloseButton:d,...c}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(f,{}),(0,s.jsxs)(i.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[l,!0!==d&&(0,s.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(r.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=i.VY.displayName;let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let x=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",a),...l})});x.displayName=i.Dx.displayName;let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...l})});g.displayName=i.dk.displayName},95186:function(e,t,a){a.d(t,{I:function(){return r}});var s=a(57437),l=a(2265),i=a(94508);let r=l.forwardRef((e,t)=>{let{className:a,type:l,noRing:r,error:n,...d}=e;return(0,s.jsx)("input",{type:l,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r&&"focus-visible:ring-0 focus-visible:ring-transparent focus-visible:ring-offset-0",n&&"border-danger",n&&!r&&"focus-visible:ring-danger",a),ref:t,...d})});r.displayName="Input"},26815:function(e,t,a){a.d(t,{_:function(){return c}});var s=a(57437),l=a(2265),i=a(370),r=a(90535),n=a(94508);let d=(0,r.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=l.forwardRef((e,t)=>{let{className:a,secondary:l,error:r,...c}=e;return(0,s.jsx)(i.f,{ref:t,className:(0,n.cn)(d(),l&&"text-xs",r?"text-danger":"",a),...c})});c.displayName=i.f.displayName},53647:function(e,t,a){a.d(t,{Bw:function(){return x},DI:function(){return u},Ph:function(){return o},Ql:function(){return y},U$:function(){return v},i4:function(){return m},ki:function(){return f},n5:function(){return g}});var s=a(57437),l=a(2265),i=a(74797),r=a(40875),n=a(22135),d=a(30401),c=a(94508);let o=i.fC,u=i.ZA,f=i.B4,m=l.forwardRef((e,t)=>{let{className:a,children:l,error:n,...d}=e;return(0,s.jsxs)(i.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n&&"border-danger",a),...d,children:[l,(0,s.jsx)(i.JO,{asChild:!0,children:(0,s.jsx)(r.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.xz.displayName;let p=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})});p.displayName=i.u_.displayName;let h=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(r.Z,{className:"h-4 w-4"})})});h.displayName=i.$G.displayName;let x=l.forwardRef((e,t)=>{let{className:a,children:l,position:r="popper",...n}=e;return(0,s.jsx)(i.h_,{children:(0,s.jsxs)(i.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...n,children:[(0,s.jsx)(p,{}),(0,s.jsx)(i.l_,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,s.jsx)(h,{})]})})});x.displayName=i.VY.displayName;let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})});g.displayName=i.__.displayName;let y=l.forwardRef((e,t)=>{let{className:a,children:l,...r}=e;return(0,s.jsxs)(i.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...r,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.wU,{children:(0,s.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(i.eT,{children:l})]})});y.displayName=i.ck.displayName;let v=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(i.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...l})});v.displayName=i.Z0.displayName},81103:function(e,t,a){a.d(t,{_v:function(){return o},aJ:function(){return c},pn:function(){return n},u:function(){return d}});var s=a(57437),l=a(2265),i=a(91668),r=a(94508);let n=i.zt,d=i.fC,c=i.xz,o=l.forwardRef((e,t)=>{let{className:a,sideOffset:l=4,...n}=e;return(0,s.jsx)(i.VY,{ref:t,sideOffset:l,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})});o.displayName=i.VY.displayName},86180:function(e,t,a){a.d(t,{t:function(){return i}});var s=a(59625);let l={danger:!1,title:"Confirm",message:"Are you sure?",positiveLabel:"Ok",negativeLabel:"Cancel"},i=(0,s.Ue)(e=>({isOpen:!1,...l,confirm:(t,a)=>e({isOpen:!0,...l,...a,onConfirm:t}),close:()=>e({isOpen:!1,onConfirm:void 0,...l})}))},24959:function(e,t,a){a.d(t,{v:function(){return l}});var s=a(67132);function l(e){let{isDraft:t,userId:a}=e,{authenticatedUser:l}=(0,s.b)();return!!(t&&a&&a!==(null==l?void 0:l.userId))}},71706:function(e,t,a){a.d(t,{k:function(){return n}});var s=a(2265),l=a(83464),i=a(67132),r=a(98656);function n(e){let{loadOnMount:t=!0,onLoadSitesError:a}={...e},[n,d]=(0,s.useState)(!1),{alert:c}=(0,r.s)(),{getSites:o}=(0,i.b)(),[u,f]=(0,s.useState)([]),m=(0,s.useCallback)(async()=>{try{var e;d(!0);let t=(await l.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));f(t.data||[])}catch(e){c({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==a?void 0:a()})}finally{d(!1)}},[o,c,a]);return(0,s.useEffect)(()=>{t&&!u.length&&m()},[u,t,m]),{loading:n,sites:u,loadSites:m}}},97930:function(e,t,a){a.d(t,{GB:function(){return l},Hc:function(){return i},_n:function(){return n}});var s=a(16548);function l(e){let{searchValue:t,scripts:a,screens:l,diagnoses:i}=e,{normalizedValue:r,isExactMatch:n}=(0,s.l)(t);if(!r)return[];let d=(0,s.y)(r),c=new RegExp(n?"^".concat(d,"$"):d),o={};return a.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(c)&&t.push({field:"printTitle",fieldValue:e.printTitle}),t.length&&(o[e.scriptId]={title:e.title,scriptId:e.scriptId,position:e.position,diagnoses:[],screens:[],matches:t})}),l.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(c)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(c)&&t.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(c)&&t.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(c)&&t.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(c)&&t.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,a)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"field_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_label",fieldIndex:a,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(c)&&t.push({field:"field_condition",fieldIndex:a,fieldValue:e.condition}),(e.items||[]).map((e,s)=>{"".concat(e.value||"").toLowerCase().match(c)&&t.push({field:"field_item_key",fieldIndex:a,fieldItemIndex:s,fieldValue:e.value}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"field_item_label",fieldIndex:a,fieldItemIndex:s,fieldValue:e.label})})}),(e.items||[]).map((e,a)=>{"".concat(e.id||"").toLowerCase().match(c)&&t.push({field:"item_id",fieldIndex:a,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"item_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(c)&&t.push({field:"item_label",fieldIndex:a,fieldValue:e.label})}),(e.drugs||[]).map((e,a)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"drug",fieldIndex:a,fieldValue:e.key})}),(e.fluids||[]).map((e,a)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"fluid",fieldIndex:a,fieldValue:e.key})}),(e.feeds||[]).map((e,a)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"feed",fieldIndex:a,fieldValue:e.key})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].screens.push({title:e.title,matches:t,screenId:e.screenId,isDraft:e.isDraft,position:e.position,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),i.forEach(e=>{let t=[];"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,a)=>{"".concat(e.key||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_key",fieldIndex:a,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_name",fieldIndex:a,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(c)&&t.push({field:"diagnosis_symptom_expression",fieldIndex:a,fieldValue:e.expression})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,position:e.scriptPosition,diagnoses:[],screens:[],matches:[]},o[e.scriptId].title=o[e.scriptId].title||e.scriptTitle,o[e.scriptId].diagnoses.push({title:e.name||"",position:e.position,matches:t,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(o)}let i=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function n(e){let{searchValue:t,filter:a,results:s}=e;if("all"===a)return s;let l=e=>r[e.field]===a;return s.map(e=>a?{...e,matches:e.matches.filter(e=>l(e)),screens:e.screens.filter(e=>e.matches.find(e=>l(e))).map(e=>({...e,matches:e.matches.filter(e=>l(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>l(e))).map(e=>({...e,matches:e.matches.filter(e=>l(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},16548:function(e,t,a){a.d(t,{l:function(){return r},y:function(){return i}});let s=['"',"“"],l=['"',"”"];function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function r(e){let t="".concat(null!=e?e:"").trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let a=s.includes(t[0]),i=l.includes(t[t.length-1]),r=t.length>1&&a&&i;return{normalizedValue:(r?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:r}}}}]);