"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2284],{88519:function(e,t,i){i.d(t,{d:function(){return b}});var l=i(57437),s=i(2265),a=i(16463),r=i(39343),d=i(38472),n=i(46294),o=i(90837),c=i(86466),f=i(53699),u=i(15701),h=i(50495),m=i(39661),p=i(67135),x=i(74709),y=i(83102),v=i(37440),w=i(53853),g=i(91337);let I=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b(e){var t,i;let{open:b,overWriteScriptWithId:j,onOpenChange:k,onImportSuccess:C}=e,_=(0,a.useRouter)(),L=(0,a.useParams)();j=j||L.scriptId;let{copyScripts:V}=(0,u.h)(),{alert:D}=(0,f.s)(),[N,S]=(0,s.useState)(!1),{sites:E,loading:T}=(0,w.k)({onLoadSitesError:()=>k(!1)}),F=T||N,{formState:{errors:P},reset:O,watch:K,setValue:R,register:A,handleSubmit:B}=(0,r.cI)({defaultValues:I(j)}),z=K("confirmed"),G=K("overwriteDataKeys"),W=K("overwriteDrugsLibraryItems"),X=B(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(j&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");S(!0);let i=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:j,broadcastAction:!0})).data;if(null===(t=i.errors)||void 0===t?void 0:t.length)throw Error(i.errors.join(", "));_.refresh(),D({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==C||C(),O(I(j)),k(!1)}})}catch(e){D({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{S(!1)}});return(0,l.jsxs)(l.Fragment,{children:[F&&(0,l.jsx)(m.a,{overlay:!0}),(0,l.jsx)(x.u,{open:b,onOpenChange:()=>{k(!1),O(I(j))},title:"Import script",actions:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(o.GG,{asChild:!0,children:(0,l.jsx)(h.z,{variant:"ghost",disabled:F,onClick:()=>k(!1),children:"Cancel"})}),(0,l.jsx)(h.z,{onClick:()=>X(),disabled:F,children:"Import"})]}),children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,l.jsx)(g._,{children:(0,l.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,l.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,l.jsxs)(n.Ph,{name:"siteId",disabled:F,onValueChange:e=>R("siteId",e,{shouldDirty:!0}),children:[(0,l.jsx)(n.i4,{children:(0,l.jsx)(n.ki,{placeholder:"Select site"})}),(0,l.jsx)(n.Bw,{children:(0,l.jsxs)(n.DI,{children:[(0,l.jsx)(n.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:i}=e;return(0,l.jsx)(n.Ql,{value:t,children:i},t)})]})})]}),!!(null===(t=P.siteId)||void 0===t?void 0:t.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:P.siteId.message})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,l.jsx)(y.I,{...A("scriptId",{disabled:F,required:!0}),name:"scriptId"}),!!(null===(i=P.scriptId)||void 0===i?void 0:i.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:P.scriptId.message})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2"),children:[(0,l.jsx)(c.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:F,checked:G,onCheckedChange:()=>R("overwriteDataKeys",!G,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2"),children:[(0,l.jsx)(c.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:F,checked:W,onCheckedChange:()=>R("overwriteDrugsLibraryItems",!W,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2",!j&&"hidden"),children:[(0,l.jsx)(c.X,{name:"confirmed",id:"confirmed",disabled:F,checked:z,onCheckedChange:()=>R("confirmed",!z,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},17750:function(e,t,i){i.d(t,{f:function(){return n}});var l=i(57437),s=i(39661),a=i(89229),r=i(46294),d=i(44709);function n(e){let{search:t,setSearch:i,onSearch:n}=e;return(0,l.jsxs)(l.Fragment,{children:[t.searching&&(0,l.jsx)(s.a,{overlay:!0}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(a.M,{placeholder:"Search",onSearch:n})}),!!t.value&&(0,l.jsx)("div",{className:"w-[120px]",children:(0,l.jsxs)(r.Ph,{value:t.filter,onValueChange:e=>i(t=>({...t,filter:e,results:(0,d._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,l.jsx)(r.i4,{children:(0,l.jsx)(r.ki,{placeholder:"All matches"})}),(0,l.jsx)(r.Bw,{children:d.Hc.map(e=>(0,l.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}},89229:function(e,t,i){i.d(t,{M:function(){return r}});var l=i(57437),s=i(2265),a=i(37440);let r=(0,s.forwardRef)((e,t)=>{let{searchButton:i,hideSearchButton:r,onSearch:d,...n}=e,[o,c]=(0,s.useState)("");return(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==d||d(o)},children:(0,l.jsxs)("div",{className:(0,a.cn)("flex w-full"),children:[(0,l.jsx)("div",{className:(0,a.cn)("relative w-full"),children:(0,l.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:o,...n,onChange:e=>{var t;let i=e.target.value;c(i),null===(t=n.onChange)||void 0===t||t.call(n,e),i||null==d||d(i)},className:(0,a.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",n.className)})}),!r&&(0,l.jsx)("button",{type:"submit",className:(0,a.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==i?void 0:i.className),...i,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},53699:function(e,t,i){i.d(t,{s:function(){return a}});var l=i(39099);let s={title:"",message:"",buttonLabel:"Ok",variant:"info",onClose:void 0},a=(0,l.Ue)(e=>({isOpen:!1,...s,alert:t=>e({isOpen:!0,...s,...t}),close:()=>e({isOpen:!1,onClose:void 0,...s})}))},53853:function(e,t,i){i.d(t,{k:function(){return d}});var l=i(2265),s=i(38472),a=i(17647),r=i(53699);function d(e){let{loadOnMount:t=!0,onLoadSitesError:i}={...e},[d,n]=(0,l.useState)(!1),{alert:o}=(0,r.s)(),{getSites:c}=(0,a.b)(),[f,u]=(0,l.useState)([]),h=(0,l.useCallback)(async()=>{try{var e;n(!0);let t=(await s.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));u(t.data||[])}catch(e){o({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==i?void 0:i()})}finally{n(!1)}},[c,o,i]);return(0,l.useEffect)(()=>{t&&!f.length&&h()},[f,t,h]),{loading:d,sites:f,loadSites:h}}},44709:function(e,t,i){function l(e){let{searchValue:t,scripts:i,screens:l,diagnoses:s}=e;t="".concat(t||"").trim().toLowerCase();let a={};return i.forEach(e=>{let i=[];"".concat(e.title||"").toLowerCase().match(t)&&i.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(t)&&i.push({field:"printTitle",fieldValue:e.printTitle}),i.length&&(a[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:i})}),l.forEach(e=>{let i=[];"".concat(e.title||"").toLowerCase().match(t)&&i.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(t)&&i.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(t)&&i.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(t)&&i.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(t)&&i.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(t)&&i.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"field_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"field_label",fieldIndex:l,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(t)&&i.push({field:"field_condition",fieldIndex:l,fieldValue:e.condition}),(e.items||[]).map((e,s)=>{"".concat(e.value||"").toLowerCase().match(t)&&i.push({field:"field_item_key",fieldIndex:l,fieldItemIndex:s,fieldValue:e.value}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"field_item_label",fieldIndex:l,fieldItemIndex:s,fieldValue:e.label})})}),(e.items||[]).map((e,l)=>{"".concat(e.id||"").toLowerCase().match(t)&&i.push({field:"item_id",fieldIndex:l,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"item_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(t)&&i.push({field:"item_label",fieldIndex:l,fieldValue:e.label})}),(e.drugs||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"drug",fieldIndex:l,fieldValue:e.key})}),(e.fluids||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"fluid",fieldIndex:l,fieldValue:e.key})}),(e.feeds||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"feed",fieldIndex:l,fieldValue:e.key})}),i.length&&(a[e.scriptId]=a[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},a[e.scriptId].screens.push({title:e.title,matches:i,screenId:e.screenId,isDraft:e.isDraft,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),s.forEach(e=>{let i=[];"".concat(e.name||"").toLowerCase().match(t)&&i.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(t)&&i.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,l)=>{"".concat(e.key||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_key",fieldIndex:l,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_name",fieldIndex:l,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(t)&&i.push({field:"diagnosis_symptom_expression",fieldIndex:l,fieldValue:e.expression})}),i.length&&(a[e.scriptId]=a[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},a[e.scriptId].diagnoses.push({title:e.name||"",matches:i,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(a)}i.d(t,{GB:function(){return l},Hc:function(){return s},_n:function(){return r}});let s=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],a={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function r(e){let{searchValue:t,filter:i,results:l}=e;if("all"===i)return l;let s=e=>a[e.field]===i;return l.map(e=>i?{...e,matches:e.matches.filter(e=>s(e)),screens:e.screens.filter(e=>e.matches.find(e=>s(e))).map(e=>({...e,matches:e.matches.filter(e=>s(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>s(e))).map(e=>({...e,matches:e.matches.filter(e=>s(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}}}]);