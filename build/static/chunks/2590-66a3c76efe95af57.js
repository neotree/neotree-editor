(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2590],{32782:function(e,t,n){Promise.resolve().then(n.bind(n,78528)),Promise.resolve().then(n.bind(n,50773)),Promise.resolve().then(n.bind(n,89884)),Promise.resolve().then(n.t.bind(n,72972,23))},78528:function(e,t,n){"use strict";n.d(t,{DiagnosisForm:function(){return W}});var i=n(57437),s=n(2265),l=n(99376),r=n(29501),a=n(62869),o=n(95186),d=n(76818),c=n(26815),u=n(6512),m=n(69711),h=n(94508),p=n(78968),x=n(94658),f=n(49360),v=n(83464),y=n(79976),g=n(98656),j=n(67132),b=n(32405),w=n(24959),N=n(73526),k=n(22381),I=n(72839),C=n(20657),D=n(99397),S=n(71533),F=n(15868),R=n(27413),M=n(66024),E=n(26110),z=n(84190),T=n(86180),V=n(82425);function _(e){let{disabled:t,selected:n,onDelete:s,onCopy:l}=e;return(0,i.jsx)(i.Fragment,{children:!!n.length&&(0,i.jsx)(V.h,{children:(0,i.jsxs)(a.z,{variant:"destructive",className:"h-auto w-auto",disabled:t,onClick:()=>s(),children:[(0,i.jsx)(R.Z,{className:"h-4 w-4 mr-1"}),(0,i.jsx)("span",{children:n.length>1?"Delete ".concat(n.length," symptoms"):"Delete symptom"})]})})})}var O=n(9699),P=n(74991),Z=n(19060),A=n(94790),L=n(45617);function G(e){let{children:t,symptom:n,form:l,disabled:d,...u}=e,{data:m,index:p}={...n},[v,y]=(0,s.useState)(!1),g=(0,s.useCallback)(()=>({...m,symptomId:(null==m?void 0:m.symptomId)||(0,f.Z)(),expression:(null==m?void 0:m.expression)||"",name:(null==m?void 0:m.name)||"",key:(null==m?void 0:m.key)||"",keyId:(null==m?void 0:m.keyId)||"",weight:(null==m?void 0:m.weight)||null,type:(null==m?void 0:m.type)||b.ph[0].value,position:(null==m?void 0:m.position)||1,printable:!!(null==m?void 0:m.printable)}),[m]),{control:j,reset:w,watch:N,register:k,handleSubmit:I,setValue:C}=(0,r.cI)({defaultValues:g()}),D=N("type"),S=N("name"),F=N("printable"),R=(0,s.useMemo)(()=>!!d,[d]),M=I(e=>{!(0,A.x)(p)&&m?l.setValue("symptoms",l.getValues("symptoms").map((t,n)=>({...t,...n===p?e:null}))):l.setValue("symptoms",[...l.getValues("symptoms"),e],{shouldDirty:!0}),y(!1)});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(O.u,{open:v,title:m?"Add symptom":"Edit symptom",trigger:"function"==typeof t?t({extraProps:u}):t,onOpenChange:e=>{y(e),w(g())},actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:(0,h.cn)("text-danger text-xs",R&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(E.GG,{asChild:!0,children:(0,i.jsx)(a.z,{variant:"ghost",children:"Cancel"})}),(0,i.jsx)(a.z,{disabled:R,onClick:()=>M(),children:"Save"})]}),children:(0,i.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,i.jsx)(L.D,{children:"Type"}),(0,i.jsx)("div",{children:(0,i.jsx)(P.E,{disabled:R,defaultValue:D,onValueChange:e=>C("type",e,{shouldDirty:!0}),className:"flex flex-col gap-y-4",children:b.ph.map(e=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(P.m,{value:e.value,id:e.value}),(0,i.jsx)(c._,{secondary:!0,htmlFor:e.value,children:e.label})]},e.value))})}),(0,i.jsx)(L.D,{children:"Properties"}),(0,i.jsx)("div",{children:(0,i.jsx)(r.Qr,{control:j,name:"key",render:e=>{let{field:{value:t,onChange:n}}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!R&&!t,children:"Key *"}),(0,i.jsx)(x.L,{value:"".concat(t||""),disabled:!1,onChange:e=>{let[t]=e;n(t.name),C("name",null==t?void 0:t.label,{shouldDirty:!0}),C("keyId",null==t?void 0:t.uniqueKey,{shouldDirty:!0})}})]})}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{error:!R&&!S,htmlFor:"name",children:"Name *"}),(0,i.jsx)(o.I,{...k("name",{disabled:R,required:!0}),name:"name",error:!R&&!S})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"weight",children:"Weight "}),(0,i.jsx)(o.I,{...k("weight",{disabled:R}),name:"weight",type:"number"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Must be in the range: 0.0 - 1.0 (",(0,i.jsx)("b",{children:"default 1.0"}),")"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Sign/Risk expression "}),(0,i.jsx)(o.I,{...k("expression",{disabled:R}),name:"expression"}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Example: ",(0,i.jsx)("b",{children:b._S})]})]}),(0,i.jsx)(L.D,{children:"Print"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,i.jsx)(Z.X,{id:"printable",disabled:R,checked:F,onCheckedChange:()=>C("printable",!F,{shouldDirty:!0})}),(0,i.jsx)(c._,{htmlFor:"printable",children:"Print"})]}),(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"If not checked, data will not be display on the session summary and the printout."})]})]})})})}function q(e){let{form:t,disabled:n}=e,l=(0,s.useRef)(null),[r,o]=(0,s.useState)([]),{confirm:d}=(0,T.t)(),c=t.watch("symptoms"),u=(0,s.useCallback)((e,n)=>{let i=(0,C.q)([...c],e,n);t.setValue("symptoms",i.map((e,t)=>({...e,position:t+1})),{shouldDirty:!0})},[t,c]),m=(0,s.useCallback)(e=>{let n=c.filter((t,n)=>e.includes(n)).map(e=>'<div class="font-bold text-danger">'.concat(e.name,"</div>")).join("");d(()=>{let n=c.filter((t,n)=>!e.includes(n));t.setValue("symptoms",n.map((e,t)=>({...e,position:t+1})),{shouldDirty:!0}),o([])},{title:"Delete",message:"<p>Are you sure you want to delete ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),danger:!0,positiveLabel:"Delete"})},[t,c,d]),p=(0,s.useCallback)(e=>{let n=c.filter((t,n)=>e.includes(n)).map(e=>'<div class="font-bold">'.concat(e.name,"</div>")).join("");d(()=>{let n=[...c,...c.filter((t,n)=>e.includes(n)).map((e,t)=>({...e,position:c.length+1+t}))];t.setValue("symptoms",n.map((e,t)=>({...e,position:t+1})),{shouldDirty:!0}),o([])},{title:"Duplicate",message:"<p>Are you sure you want to duplicate ".concat(e.length>1?"".concat(e.length," symptoms: "):"symptom: ","</p> ").concat(n),positiveLabel:"Duplicate"})},[t,c,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{ref:l}),(0,i.jsx)(M.DataTable,{title:"Symptoms",sortable:!n,selectable:!n,onSort:u,selectedIndexes:r,onSelect:o,search:{inputPlaceholder:"Search symptoms"},headerActions:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(G,{form:t,disabled:n,children:!n&&(0,i.jsx)(E.hg,{asChild:!0,children:(0,i.jsxs)(a.z,{className:"text-primary border-primary",variant:"outline",children:[(0,i.jsx)(D.Z,{className:"h-4 w-4 mr-1"}),"New symptom"]})})})}),columns:[{name:"Type"},{name:"Name"},{name:"Action",align:"right",cellRenderer(e){let{rowIndex:s}=e,r=c[s];return(0,i.jsxs)(z.h_,{children:[(0,i.jsx)(z.$F,{asChild:!0,children:(0,i.jsx)(a.z,{variant:"ghost",size:"icon",className:"p-0 h-auto w-auto transition-colors rounded-full hover:text-primary hover:bg-transparent",children:(0,i.jsx)(S.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)(z.AW,{children:[(0,i.jsx)(z.Xi,{asChild:!0,children:(0,i.jsx)(G,{disabled:n,form:t,symptom:{data:r,index:s},children:e=>{let{extraProps:t}=e;return(0,i.jsxs)(E.hg,{...t,className:(0,h.cn)(null==t?void 0:t.className,"w-full"),children:[(0,i.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),(0,i.jsx)("span",{children:n?"View":"Edit"})]})}})}),(0,i.jsxs)(z.Xi,{onClick:()=>{var e,t;null===(t=l.current)||void 0===t||null===(e=t.click)||void 0===e||e.call(t),setTimeout(()=>m([s]),0)},className:(0,h.cn)("text-danger focus:bg-danger focus:text-danger-foreground"),disabled:n,children:[(0,i.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]})}}],data:c.map(e=>[e.type,e.name,""])}),!n&&(0,i.jsx)(_,{disabled:n,selected:r,onDelete:()=>m(r),onCopy:()=>p(r)})]})}var U=n(12819);function W(e){var t,n;let C=(0,l.useRouter)(),D=function(e){let{formData:t,scriptId:n,script:i}=e,a=(0,l.useRouter)(),[o,d]=(0,s.useState)(!1),{saveDiagnoses:c}=(0,y.h)(),{alert:u}=(0,g.s)(),{viewOnly:m,authenticatedUser:h}=(0,j.b)(),p=(0,s.useMemo)(()=>"/script/".concat(n,"?section=diagnoses"),[n]),x=!(null==t?void 0:t.diagnosisId),I=(0,s.useCallback)(()=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():(0,f.Z)(),[]),C=(0,s.useRef)((null==t?void 0:t.diagnosisId)?(0,k.$u)({entityId:t.diagnosisId,entityType:"diagnosis",userId:null==h?void 0:h.userId,userName:null==h?void 0:h.displayName,entityTitle:(null==t?void 0:t.name)||(null==t?void 0:t.key)||"Diagnosis",resolveEntityTitle:e=>(null==e?void 0:e.name)||(null==e?void 0:e.key)||(null==e?void 0:e.description)}):null),D=(0,s.useRef)(null),S=(0,s.useCallback)(()=>({version:(null==t?void 0:t.version)||1,scriptId:(null==t?void 0:t.scriptId)||n,diagnosisId:(null==t?void 0:t.diagnosisId)||I(),name:(null==t?void 0:t.name)||"",description:(null==t?void 0:t.description)||"",key:(null==t?void 0:t.key)||"",keyId:(null==t?void 0:t.keyId)||"",expression:(null==t?void 0:t.expression)||"",expressionMeaning:(null==t?void 0:t.expressionMeaning)||"",severityOrder:(null==t?void 0:t.severityOrder)||null,symptoms:(null==t?void 0:t.symptoms)||[],text1:(null==t?void 0:t.text1)||"",text2:(null==t?void 0:t.text2)||"",text3:(null==t?void 0:t.text3)||"",image1:(null==t?void 0:t.image1)||null,image2:(null==t?void 0:t.image2)||null,image3:(null==t?void 0:t.image3)||null,preferences:(null==t?void 0:t.preferences)||b.$7}),[t,n,I]),F=(0,r.cI)({defaultValues:S()});(0,s.useEffect)(()=>{C.current&&t&&!D.current&&(D.current=t,C.current.setSnapshot(t))},[t]);let{formState:{dirtyFields:R},handleSubmit:M}=F,E=(0,s.useMemo)(()=>!!Object.keys(R).length,[R]),z=M(async e=>{try{var t;d(!0);let n=e.diagnosisId||I(),i={...e,diagnosisId:n,severityOrder:e.severityOrder?Number(e.severityOrder):null};if(!i.scriptId)throw Error("Diagnosis is missing script reference!");let s=(await v.Z.post("/api/diagnoses/save",{data:[i],broadcastAction:!0})).data;if(null===(t=s.errors)||void 0===t?void 0:t.length)throw Error(s.errors.join(", "));x?await N.pb.addChange({entityType:"diagnosis",entityId:n,entityTitle:i.name||i.key||"Untitled Diagnosis",action:"create",fieldPath:"diagnosis",fieldName:"New Diagnosis",oldValue:null,newValue:i.name||"Untitled Diagnosis",userId:null==h?void 0:h.userId,userName:null==h?void 0:h.displayName,fullSnapshot:i}):C.current&&D.current&&await C.current.trackChanges(i,"Diagnosis draft saved"),a.refresh(),u({variant:"success",message:"Diagnosis draft was saved successfully!",onClose:()=>a.push(p)})}catch(e){u({variant:"error",message:"Failed to save draft: "+e.message})}finally{d(!1)}}),T=(0,w.v)({isDraft:!!(null==t?void 0:t.isDraft),userId:null==t?void 0:t.draftCreatedByUserId}),V=(null==i?void 0:i.draftCreatedByUserId)||(null==i?void 0:i.itemsChangedByUserId),_=(0,w.v)({isDraft:!!(null==i?void 0:i.isDraft)||!!(null==i?void 0:i.hasChangedItems),userId:V}),O=(0,s.useMemo)(()=>o||m||T||_,[o,m,T,_]);return{...F,formIsDirty:E,saving:o,scriptPageHref:p,disabled:O,isLocked:T,isScriptLocked:_,scriptLockedByUserId:V,save:z,getDefaultValues:S}}(e),{isLocked:S,control:F,saving:R,scriptPageHref:M,disabled:E,isScriptLocked:z,scriptLockedByUserId:T,register:V,watch:_,setValue:O,save:P}=D,Z=_("name"),A=_("key"),L=_("image1"),G=_("image2"),W=_("image3"),$=_("preferences"),B=(0,s.useCallback)(()=>{C.push(M)},[C,M]);return(0,i.jsxs)(i.Fragment,{children:[R&&(0,i.jsx)(m.a,{overlay:!0}),(0,i.jsxs)("div",{className:"flex flex-col gap-y-5 [&>*]:px-4",children:[(S||z)&&(0,i.jsx)("div",{children:(0,i.jsx)(U.O,{card:!0,isDraft:!!(null===(t=e.formData)||void 0===t?void 0:t.isDraft)||z,userId:(null===(n=e.formData)||void 0===n?void 0:n.draftCreatedByUserId)||T,dataType:"diagnosis"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"key",error:!E&&!A,children:"Key *"}),(0,i.jsx)(r.Qr,{control:F,name:"key",render:e=>{let{field:{value:t,onChange:n}}=e;return(0,i.jsx)(x.L,{value:"".concat(t||""),disabled:!1,onChange:e=>{let[t]=e;n(t.name),O("name",null==t?void 0:t.label,{shouldDirty:!0}),O("keyId",null==t?void 0:t.uniqueKey,{shouldDirty:!0})}})}})]}),(0,i.jsxs)("div",{className:"flex gap-x-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"severityOrder",children:"Severity order"}),(0,i.jsx)(o.I,{...V("severityOrder",{disabled:E}),name:"severityOrder",noRing:!1,type:"number"})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(c._,{htmlFor:"name",error:!E&&!Z,children:"Name *"}),(0,i.jsx)(o.I,{...V("name",{disabled:E,required:!0}),name:"name",noRing:!1,error:!E&&!Z})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"description",children:"Description"}),(0,i.jsx)(o.I,{...V("description",{disabled:E}),name:"description",noRing:!1}),(0,i.jsx)(p.w,{id:"description",title:"Description",disabled:E,data:$,onSave:e=>O("preferences",e,{shouldDirty:!0})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expression",children:"Diagnosis expression (e.g. $Temp > 37 or $Gestation < 20)"}),(0,i.jsx)(o.I,{...V("expression",{disabled:E}),name:"expression",noRing:!1})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(c._,{htmlFor:"expressionMeaning",children:"Diagnosis expression (e.g. Temperature greater than 37 or Gestation period less than 20 weeks)"}),(0,i.jsx)(o.I,{...V("expressionMeaning",{disabled:E}),name:"expressionMeaning",noRing:!1})]}),[["text1",L],["text2",G],["text3",W]].map((e,t)=>{let[n,l]=e,r="image".concat(t+1);return(0,i.jsx)(s.Fragment,{children:(0,i.jsxs)("div",{className:"flex gap-x-4",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)(c._,{htmlFor:"imageTextFields.".concat(t,".text"),children:["Text ",t+1]}),(0,i.jsx)(d.g,{...V(n,{disabled:E}),name:"text".concat(t+1),noRing:!1,rows:5}),(0,i.jsx)(p.w,{id:n,title:"Text ".concat(t+1),disabled:E,data:$,onSave:e=>O("preferences",e,{shouldDirty:!0})})]}),(0,i.jsx)(I.M,{disabled:E,image:l,onChange:e=>O(r,e,{shouldDirty:!0})})]})},"imageTextFields.".concat(t))})]}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-x-2 py-6 px-4",children:[(0,i.jsx)("span",{className:(0,h.cn)("text-danger text-xs",E&&"hidden"),children:"* Required"}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)(a.z,{variant:"ghost",onClick:()=>B(),children:"Cancel"}),(0,i.jsx)(a.z,{disabled:E,onClick:()=>P(),children:"Save Draft"})]}),(0,i.jsx)(u.Separator,{className:"my-20"}),(0,i.jsx)("div",{children:(0,i.jsx)(q,{disabled:E,form:D})})]})}},72839:function(e,t,n){"use strict";n.d(t,{M:function(){return m}});var i=n(57437),s=n(99397),l=n(27413),r=n(55122),a=n(78062),o=n(62869),d=n(86180),c=n(42004),u=n(70465);function m(e){let{image:t,disabled:n,onChange:m}=e,h=(0,u.Y)(),[p,{width:x}]=(0,r.Z)(),{confirm:f}=(0,d.t)(),v="".concat((null==t?void 0:t.data)||"").split("?").filter((e,t)=>t).join(""),{width:y,height:g}=a.Z.parse(v);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{ref:p,className:"flex flex-col gap-y-2 min-w-60 max-w-60",children:[(0,i.jsx)("div",{className:"w-full flex flex-col items-center justify-center min-h-28",children:(0,i.jsx)(c.E,{alt:"",width:Number(y||"0"),height:Number(g||"0"),containerWidth:x,src:(null==t?void 0:t.data)||"/images/placeholder.png"})}),(0,i.jsxs)("div",{className:"flex items-center justify-center gap-x-4",children:[(0,i.jsx)(o.z,{size:"icon",className:"w-8 h-8 rounded-full",disabled:n,onClick:()=>h.openModal({onSelectFiles(e){let[t]=e;m({data:t.url,fileId:t.fileId,filename:t.filename,size:t.size,contentType:t.contentType})}}),children:(0,i.jsx)(s.Z,{className:"h-4 w-4"})}),!!t&&(0,i.jsx)(o.z,{variant:"destructive",size:"icon",className:"w-8 h-8 rounded-full",disabled:n,onClick:()=>f(()=>m(null),{title:"Delete image",message:"Are you sure you want to delete this image?",danger:!0}),children:(0,i.jsx)(l.Z,{className:"h-4 w-4"})})]})]})})}},42004:function(e,t,n){"use strict";n.d(t,{E:function(){return l}});var i=n(57437),s=n(16107);function l(e){let{width:t=0,height:n=0,containerWidth:l,...r}=e;r.sizes;let a={width:"100%",height:"auto"};if(n&&t&&l){let e=(0,s.a)({imageWidth:t,imageHeight:n,containerWidth:l});a.width=e.imageWidth,a.height=e.imageHeight}return(0,i.jsx)("img",{...r,src:r.src,style:{...a,...r.style}})}},94658:function(e,t,n){"use strict";n.d(t,{L:function(){return a}});var i=n(57437),s=n(2265),l=n(51383),r=n(68577);function a(e){let{value:t,type:n,disabled:a,modal:o,multiple:d,placeholder:c,error:u,onChange:m,filterDataKeys:h}=e,{allDataKeys:p,extractDataKeys:x}=(0,r.M)(),f=(0,s.useMemo)(()=>{let e=p;return n&&""!==n.trim()&&(e=e.filter(e=>e.dataType===n)),h&&(e=e.filter(h)),e.map(e=>({label:e.name,value:e.uniqueKey,caption:e.dataType||"",description:e.label}))},[p,n,h]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(l.V,{multiple:d,modal:o,error:u,placeholder:"".concat(t||"")||c||"Select key",search:{placeholder:"Search data keys"},options:f,onSelect:e=>{let t=x(e.map(e=>e.value)).map(e=>({...e,children:x(e.options)}));null==m||m(t)}})})}},51383:function(e,t,n){"use strict";n.d(t,{V:function(){return m}});var i=n(57437),s=n(2265),l=n(24156),r=n(30401),a=n(62869),o=n(95186),d=n(26110),c=n(94508),u=n(16850);function m(e){let{options:t,selected:n,...s}=e;n=Array.isArray(n)?n:n?[n]:[];let l=t.map(e=>({...e,value:"".concat(e.value)})),r=n.map(e=>"".concat(e));if(!s.multiple){let[e]=Array.isArray(r)?r:[r];e&&l.find(t=>t.value===e)}return(0,i.jsx)(h,{...s,options:l,selected:r})}function h(e){var t;let{modal:n,header:m,placeholder:h,search:p,multiple:x=!1,error:f=!1,disabled:v=!1,selected:y,options:g=[],trigger:j,onTrigger:b,onSelect:w}=e,[N,k]=(0,s.useState)(""),I=(0,u.N)(N),[C,D]=(0,s.useState)([]),S=(0,s.useMemo)(()=>y?Array.isArray(y)?y.map(e=>g.find(t=>(null==t?void 0:t.value)===e)).map(e=>e):g.filter(e=>(null==e?void 0:e.value)===y)||[]:[],[y,g]),F=(0,s.useMemo)(()=>g.map(e=>{let t=S.map(e=>null==e?void 0:e.value).map(e=>"".concat(e||"")).filter(e=>e).includes("".concat(null==e?void 0:e.value));return x&&(t=C.includes(e.value)),{...e,isSelected:t}}).sort((e,t)=>(e.disabled?1:0)-(t.disabled?1:0)).sort((e,t)=>{let n=e.isSelected?1:0;return(t.isSelected?1:0)-n}).filter(e=>{let t=I.toLowerCase();return!t||JSON.stringify([e.value||"",e.label||"",e.description||""]).toLowerCase().includes(t)}),[g,I,S,C]);(0,s.useEffect)(()=>()=>k(""),[]),(0,s.useEffect)(()=>{x&&D(S.map(e=>e.value))},[x,S]);let R=(0,s.useMemo)(()=>{if(!x)return!1;let e=S.map(e=>"".concat(e.value)).sort(),t=C.map(e=>"".concat(e)).sort();return e.length!==t.length||e.some((e,n)=>e!==t[n])},[x,S,C]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(d.Vq,{modal:n,onOpenChange:()=>{k(""),x?D(S.map(e=>e.value)):D([])},children:[(0,i.jsx)(d.hg,{asChild:!0,children:j||(0,i.jsxs)(a.z,{disabled:v,variant:"outline",className:(0,c.cn)("justify-between w-full",f&&"border border-destructive hover:bg-destructive/10"),onClick:b,children:[(0,i.jsx)("span",{className:S.length?"":"opacity-50",children:(null===(t=S[0])||void 0===t?void 0:t.label)||h||""}),(0,i.jsx)(l.Z,{className:"size-4 opacity-50"})]})}),(0,i.jsxs)(d.cZ,{hideCloseButton:!0,className:"flex flex-col max-h-[90%] gap-y-4 p-0 m-0 sm:max-w-xl",children:[(0,i.jsxs)(d.fK,{className:"border-b border-b-border px-4 py-4",children:[(0,i.jsx)(d.$N,{className:"hidden",children:""}),(0,i.jsx)(d.Be,{className:"hidden",children:""}),(0,i.jsxs)("div",{className:"flex items-center gap-x-4",children:[p?(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(o.I,{type:"search",placeholder:p.placeholder||"",value:N,onChange:e=>k(e.target.value)})}):null,m]})]}),(0,i.jsx)("div",{className:"flex-1 flex flex-col gap-y-1 overflow-y-auto px-4 py-2 overflow-x-hidden",children:F.map(e=>{let t=x?"button":d.GG;return(0,i.jsx)(s.Fragment,{children:(0,i.jsx)(t,{onClick:()=>{e.disabled||(e.isSelected?x?D(t=>t.filter(t=>t!==e.value)):null==w||w(S.filter(t=>t.value!==e.value)):x?D(t=>[...t,e.value]):null==w||w([e]))},className:(0,c.cn)("flex flex-col gap-y-1 border border-border p-2 rounded-md items-start text-left",e.disabled?"opacity-50 cursor-not-allowed":"transition-colors hover:bg-primary/20",e.isSelected&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),children:(0,i.jsxs)("div",{className:"flex items-center",children:[e.isSelected?(0,i.jsx)(r.Z,{className:"size-4 mr-2"}):null,(0,i.jsxs)("div",{children:[e.caption?(0,i.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.caption||""}}):null,(0,i.jsx)("p",{children:e.label}),e.description?(0,i.jsx)("div",{className:"text-xs opacity-60",dangerouslySetInnerHTML:{__html:e.description||""}}):null]})]})})},e.value)})}),(0,i.jsxs)(d.cN,{className:"border-t border-t-border px-4 py-2 items-center w-full gap-x-2",children:[(0,i.jsx)(d.GG,{asChild:!0,children:(0,i.jsx)(a.z,{variant:"ghost",children:"Close"})}),R&&(0,i.jsx)(d.GG,{asChild:!0,children:(0,i.jsx)(a.z,{onClick:()=>{null==w||w(C.map(e=>F.find(t=>t.value===e)).filter(e=>e))},children:"Save"})})]})]})]})})}},6512:function(e,t,n){"use strict";n.d(t,{Separator:function(){return a}});var i=n(57437),s=n(2265),l=n(90759),r=n(94508);let a=s.forwardRef((e,t)=>{let{className:n,orientation:s="horizontal",decorative:a=!0,...o}=e;return(0,i.jsx)(l.f,{ref:t,decorative:a,orientation:s,className:(0,r.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",n),...o})});a.displayName=l.f.displayName},70465:function(e,t,n){"use strict";n.d(t,{Y:function(){return l}});var i=n(59625),s=n(83464);let l=(0,i.Ue)((e,t)=>{let n=async n=>{try{let{reset:i,...l}={...n};i&&(l.page=1),e({loading:!0,unhandledErrors:[]});let{data:r,errors:a,totalPages:o,totalRows:d,page:c}=(await s.Z.get("/api/files?data=".concat(JSON.stringify({...l,limit:l.limit||t().limit,page:l.page||t().page})))).data;if(null==a?void 0:a.length)e({unhandledErrors:a});else{let n=i?r:[...t().files,...r];n=n.filter((e,t)=>t===n.map(e=>e.fileId).indexOf(e.fileId)),l.siteId&&l.siteId!==t().siteId&&(n=r),e({files:n,totalPages:o,totalRows:d,page:c,siteId:l.siteId||t().siteId,lastFilesQueryDate:r.length?new Date:null})}}catch(t){e({unhandledErrors:[t.message]})}finally{e({loading:!1})}};return{isModalOpen:!1,loading:!1,siteId:"",files:[],unhandledErrors:[],lastFilesQueryDate:null,page:1,limit:15,totalPages:1,totalRows:0,onSelectFiles:null,selectMultiple:!1,getFiles:n,openModal(i){e({onSelectFiles:(null==i?void 0:i.onSelectFiles)||null,isModalOpen:!0}),t().lastFilesQueryDate||n()},closeModal:()=>e({isModalOpen:!1})}})},16107:function(e,t,n){"use strict";async function i(e){return new Promise((t,n)=>{let i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.onerror=function(e,t,i,s,l){n(l||Error("Failed to load image"))},i.src=e})}function s(e){let{imageWidth:t,imageHeight:n,containerWidth:i}=e;return t>i&&(n=i/t*n,t=i),{imageWidth:t,imageHeight:n}}n.d(t,{a:function(){return s},p:function(){return i}})},99397:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});let i=(0,n(79205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},55122:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(2265),s=function(){},l="undefined"!=typeof window,r=l?i.useLayoutEffect:i.useEffect,a={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0},o=l&&void 0!==window.ResizeObserver?function(){var e=(0,i.useState)(null),t=e[0],n=e[1],s=(0,i.useState)(a),l=s[0],o=s[1],d=(0,i.useMemo)(function(){return new window.ResizeObserver(function(e){if(e[0]){var t=e[0].contentRect;o({x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,left:t.left,bottom:t.bottom,right:t.right})}})},[]);return r(function(){if(t)return d.observe(t),function(){d.disconnect()}},[t]),[n,l]}:function(){return[s,a]}},42325:function(e,t,n){"use strict";n.d(t,{ck:function(){return P},fC:function(){return O},z$:function(){return Z}});var i=n(2265),s=n(6741),l=n(98575),r=n(73966),a=n(82912),o=n(1353),d=n(80886),c=n(29114),u=n(90420),m=n(6718),h=n(71599),p=n(57437),x="Radio",[f,v]=(0,r.b)(x),[y,g]=f(x),j=i.forwardRef((e,t)=>{let{__scopeRadio:n,name:r,checked:o=!1,required:d,disabled:c,value:u="on",onCheck:m,form:h,...x}=e,[f,v]=i.useState(null),g=(0,l.e)(t,e=>v(e)),j=i.useRef(!1),b=!f||h||!!f.closest("form");return(0,p.jsxs)(y,{scope:n,checked:o,disabled:c,children:[(0,p.jsx)(a.WV.button,{type:"button",role:"radio","aria-checked":o,"data-state":k(o),"data-disabled":c?"":void 0,disabled:c,value:u,...x,ref:g,onClick:(0,s.Mj)(e.onClick,e=>{o||null==m||m(),b&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),b&&(0,p.jsx)(N,{control:f,bubbles:!j.current,name:r,value:u,checked:o,required:d,disabled:c,form:h,style:{transform:"translateX(-100%)"}})]})});j.displayName=x;var b="RadioIndicator",w=i.forwardRef((e,t)=>{let{__scopeRadio:n,forceMount:i,...s}=e,l=g(b,n);return(0,p.jsx)(h.z,{present:i||l.checked,children:(0,p.jsx)(a.WV.span,{"data-state":k(l.checked),"data-disabled":l.disabled?"":void 0,...s,ref:t})})});w.displayName=b;var N=i.forwardRef((e,t)=>{let{__scopeRadio:n,control:s,checked:r,bubbles:o=!0,...d}=e,c=i.useRef(null),h=(0,l.e)(c,t),x=(0,m.D)(r),f=(0,u.t)(s);return i.useEffect(()=>{let e=c.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(x!==r&&t){let n=new Event("click",{bubbles:o});t.call(e,r),e.dispatchEvent(n)}},[x,r,o]),(0,p.jsx)(a.WV.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...d,tabIndex:-1,ref:h,style:{...d.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function k(e){return e?"checked":"unchecked"}N.displayName="RadioBubbleInput";var I=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C="RadioGroup",[D,S]=(0,r.b)(C,[o.Pc,v]),F=(0,o.Pc)(),R=v(),[M,E]=D(C),z=i.forwardRef((e,t)=>{let{__scopeRadioGroup:n,name:i,defaultValue:s,value:l,required:r=!1,disabled:u=!1,orientation:m,dir:h,loop:x=!0,onValueChange:f,...v}=e,y=F(n),g=(0,c.gm)(h),[j,b]=(0,d.T)({prop:l,defaultProp:null!=s?s:null,onChange:f,caller:C});return(0,p.jsx)(M,{scope:n,name:i,required:r,disabled:u,value:j,onValueChange:b,children:(0,p.jsx)(o.fC,{asChild:!0,...y,orientation:m,dir:g,loop:x,children:(0,p.jsx)(a.WV.div,{role:"radiogroup","aria-required":r,"aria-orientation":m,"data-disabled":u?"":void 0,dir:g,...v,ref:t})})})});z.displayName=C;var T="RadioGroupItem",V=i.forwardRef((e,t)=>{let{__scopeRadioGroup:n,disabled:r,...a}=e,d=E(T,n),c=d.disabled||r,u=F(n),m=R(n),h=i.useRef(null),x=(0,l.e)(t,h),f=d.value===a.value,v=i.useRef(!1);return i.useEffect(()=>{let e=e=>{I.includes(e.key)&&(v.current=!0)},t=()=>v.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),(0,p.jsx)(o.ck,{asChild:!0,...u,focusable:!c,active:f,children:(0,p.jsx)(j,{disabled:c,required:d.required,checked:f,...m,...a,name:d.name,ref:x,onCheck:()=>d.onValueChange(a.value),onKeyDown:(0,s.Mj)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,s.Mj)(a.onFocus,()=>{var e;v.current&&(null===(e=h.current)||void 0===e||e.click())})})})});V.displayName=T;var _=i.forwardRef((e,t)=>{let{__scopeRadioGroup:n,...i}=e,s=R(n);return(0,p.jsx)(w,{...s,...i,ref:t})});_.displayName="RadioGroupIndicator";var O=z,P=V,Z=_},90759:function(e,t,n){"use strict";n.d(t,{f:function(){return c}});var i=n(2265);n(54887);var s=n(37053),l=n(57437),r=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let n=(0,s.Z8)(`Primitive.${t}`),r=i.forwardRef((e,i)=>{let{asChild:s,...r}=e,a=s?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(a,{...r,ref:i})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),a="horizontal",o=["horizontal","vertical"],d=i.forwardRef((e,t)=>{let{decorative:n,orientation:i=a,...s}=e,d=o.includes(i)?i:a;return(0,l.jsx)(r.div,{"data-orientation":d,...n?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...s,ref:t})});d.displayName="Separator";var c=d}}]);