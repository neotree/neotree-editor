"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2284],{88519:function(e,t,i){i.d(t,{d:function(){return b}});var l=i(57437),a=i(2265),s=i(16463),r=i(39343),d=i(38472),n=i(46294),o=i(90837),c=i(86466),u=i(53699),f=i(15701),h=i(50495),m=i(39661),p=i(67135),x=i(74709),y=i(83102),v=i(37440),w=i(53853),g=i(91337);let I=e=>({siteId:"",scriptId:"",confirmed:!e,overwriteDataKeys:!0,overwriteDrugsLibraryItems:!0});function b(e){var t,i;let{open:b,overWriteScriptWithId:j,onOpenChange:k,onImportSuccess:C}=e,_=(0,s.useRouter)(),L=(0,s.useParams)();j=j||L.scriptId;let{copyScripts:V}=(0,f.h)(),{alert:D}=(0,u.s)(),[N,S]=(0,a.useState)(!1),{sites:E,loading:T}=(0,w.k)({onLoadSitesError:()=>k(!1)}),F=T||N,{formState:{errors:P},reset:K,watch:R,setValue:z,register:O,handleSubmit:A}=(0,r.cI)({defaultValues:I(j)}),B=R("confirmed"),M=R("overwriteDataKeys"),G=R("overwriteDrugsLibraryItems"),W=A(async e=>{try{var t;if(!e.siteId)throw Error("Please select a site!");if(!e.scriptId)throw Error("Please provide a script ID!");if(j&&!e.confirmed)throw Error("Please confirm that you want to overwrite this script!");S(!0);let i=(await d.Z.post("/api/scripts/copy",{fromRemoteSiteId:e.siteId,overwriteDrugsLibraryItems:e.overwriteDrugsLibraryItems,overwriteDataKeys:e.overwriteDataKeys,scriptsIds:[e.scriptId],overWriteScriptWithId:j,broadcastAction:!0})).data;if(null===(t=i.errors)||void 0===t?void 0:t.length)throw Error(i.errors.join(", "));_.refresh(),D({variant:"success",title:"Success",message:"Script imported successfully!",onClose:()=>{null==C||C(),K(I(j)),k(!1)}})}catch(e){D({variant:"error",title:"Error",message:"Failed to import script: "+e.message})}finally{S(!1)}});return(0,l.jsxs)(l.Fragment,{children:[F&&(0,l.jsx)(m.a,{overlay:!0}),(0,l.jsx)(x.u,{open:b,onOpenChange:()=>{k(!1),K(I(j))},title:"Import script",actions:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-xs text-danger",children:"* Required"}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(o.GG,{asChild:!0,children:(0,l.jsx)(h.z,{variant:"ghost",disabled:F,onClick:()=>k(!1),children:"Cancel"})}),(0,l.jsx)(h.z,{onClick:()=>W(),disabled:F,children:"Import"})]}),children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[(0,l.jsx)(g._,{children:(0,l.jsxs)("div",{className:"p-2 text-sm",children:["New data keys, drugs, feeds & fluids ",(0,l.jsx)("b",{children:"will be appended"})," to the library"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{htmlFor:"siteId",children:"Site *"}),(0,l.jsxs)(n.Ph,{name:"siteId",disabled:F,onValueChange:e=>z("siteId",e,{shouldDirty:!0}),children:[(0,l.jsx)(n.i4,{children:(0,l.jsx)(n.ki,{placeholder:"Select site"})}),(0,l.jsx)(n.Bw,{children:(0,l.jsxs)(n.DI,{children:[(0,l.jsx)(n.n5,{children:"Sites"}),E.map(e=>{let{siteId:t,name:i}=e;return(0,l.jsx)(n.Ql,{value:t,children:i},t)})]})})]}),!!(null===(t=P.siteId)||void 0===t?void 0:t.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:P.siteId.message})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(p._,{htmlFor:"scriptId",children:"Script ID *"}),(0,l.jsx)(y.I,{...O("scriptId",{disabled:F,required:!0}),name:"scriptId"}),!!(null===(i=P.scriptId)||void 0===i?void 0:i.message)&&(0,l.jsx)("div",{className:"text-xs text-danger mt-1",children:P.scriptId.message})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2"),children:[(0,l.jsx)(c.X,{name:"overwriteDataKeys",id:"overwriteDataKeys",disabled:F,checked:M,onCheckedChange:()=>z("overwriteDataKeys",!M,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"overwriteDataKeys",children:"Overwrite datakeys"})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2"),children:[(0,l.jsx)(c.X,{name:"overwriteDrugsLibraryItems",id:"overwriteDrugsLibraryItems",disabled:F,checked:G,onCheckedChange:()=>z("overwriteDrugsLibraryItems",!G,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"overwriteDrugsLibraryItems",children:"Overwrite drugs, fluids & feeds"})]}),(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-x-2",!j&&"hidden"),children:[(0,l.jsx)(c.X,{name:"confirmed",id:"confirmed",disabled:F,checked:B,onCheckedChange:()=>z("confirmed",!B,{shouldDirty:!0})}),(0,l.jsx)(p._,{secondary:!0,htmlFor:"confirmed",children:"Confirm that you want to overwrite this script"})]})]})})]})}},17750:function(e,t,i){i.d(t,{f:function(){return n}});var l=i(57437),a=i(39661),s=i(89229),r=i(46294),d=i(44709);function n(e){let{search:t,setSearch:i,onSearch:n}=e;return(0,l.jsxs)(l.Fragment,{children:[t.searching&&(0,l.jsx)(a.a,{overlay:!0}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(s.M,{placeholder:"Search",onSearch:n})}),!!t.value&&(0,l.jsx)("div",{className:"w-[120px]",children:(0,l.jsxs)(r.Ph,{value:t.filter,onValueChange:e=>i(t=>({...t,filter:e,results:(0,d._n)({results:t.unfilteredResults,filter:e,searchValue:t.value})})),children:[(0,l.jsx)(r.i4,{children:(0,l.jsx)(r.ki,{placeholder:"All matches"})}),(0,l.jsx)(r.Bw,{children:d.Hc.map(e=>(0,l.jsx)(r.Ql,{value:e.value,children:e.label},e.value))})]})})]})]})}},89229:function(e,t,i){i.d(t,{M:function(){return r}});var l=i(57437),a=i(2265),s=i(37440);let r=(0,a.forwardRef)((e,t)=>{let{searchButton:i,hideSearchButton:r,onSearch:d,...n}=e,[o,c]=(0,a.useState)("");return(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),null==d||d(o)},children:(0,l.jsxs)("div",{className:(0,s.cn)("flex w-full"),children:[(0,l.jsx)("div",{className:(0,s.cn)("relative w-full"),children:(0,l.jsx)("input",{ref:t,type:"search",placeholder:"Search",value:o,...n,onChange:e=>{var t;let i=e.target.value;c(i),null===(t=n.onChange)||void 0===t||t.call(n,e),i||null==d||d(i)},className:(0,s.cn)("w-full pl-4 py-2 rounded-l-full border focus:outline-none focus:border-secondary bg-transparent",n.className)})}),!r&&(0,l.jsx)("button",{type:"submit",className:(0,s.cn)("px-5 py-2.5 transition-colors bg-transparent border border-l-0 rounded-r-full hover:bg-secondary/10 disabled:opacity-50 disabled:cursor-not-allowed",null==i?void 0:i.className),...i,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})})});r.displayName="SearchInput"},53853:function(e,t,i){i.d(t,{k:function(){return d}});var l=i(2265),a=i(38472),s=i(17647),r=i(53699);function d(e){let{loadOnMount:t=!0,onLoadSitesError:i}={...e},[d,n]=(0,l.useState)(!1),{alert:o}=(0,r.s)(),{getSites:c}=(0,s.b)(),[u,f]=(0,l.useState)([]),h=(0,l.useCallback)(async()=>{try{var e;n(!0);let t=(await a.Z.get("/api/sites?data="+JSON.stringify({types:["webeditor"]}))).data;if(null===(e=t.errors)||void 0===e?void 0:e.length)throw Error(t.errors.join(", "));f(t.data||[])}catch(e){o({title:"Error",message:"Failed to load sites: "+e.message,variant:"error",onClose:()=>null==i?void 0:i()})}finally{n(!1)}},[c,o,i]);return(0,l.useEffect)(()=>{t&&!u.length&&h()},[u,t,h]),{loading:d,sites:u,loadSites:h}}},44709:function(e,t,i){i.d(t,{GB:function(){return a},Hc:function(){return s},_n:function(){return d}});var l=i(22937);function a(e){let{searchValue:t,scripts:i,screens:a,diagnoses:s}=e,{normalizedValue:r,isExactMatch:d}=(0,l.l)(t);if(!r)return[];let n=new RegExp(d?"^".concat(r,"$"):r),o={};return i.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(n)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.printTitle||"").toLowerCase().match(n)&&t.push({field:"printTitle",fieldValue:e.printTitle}),t.length&&(o[e.scriptId]={title:e.title,scriptId:e.scriptId,diagnoses:[],screens:[],matches:t})}),a.forEach(e=>{let t=[];"".concat(e.title||"").toLowerCase().match(n)&&t.push({field:"title",fieldValue:e.title}),"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.refId||"").toLowerCase().match(n)&&t.push({field:"refId",fieldValue:"".concat(e.refId||"")}),"".concat(e.label||"").toLowerCase().match(n)&&t.push({field:"label",fieldValue:e.label}),"".concat(e.sectionTitle||"").toLowerCase().match(n)&&t.push({field:"sectionTitle",fieldValue:e.sectionTitle}),"".concat(e.previewTitle||"").toLowerCase().match(n)&&t.push({field:"previewTitle",fieldValue:e.previewTitle}),"".concat(e.previewPrintTitle||"").toLowerCase().match(n)&&t.push({field:"previewPrintTitle",fieldValue:e.previewPrintTitle}),"".concat(e.condition||"").toLowerCase().match(n)&&t.push({field:"condition",fieldValue:e.condition}),(e.fields||[]).map((e,i)=>{"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"field_key",fieldIndex:i,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(n)&&t.push({field:"field_label",fieldIndex:i,fieldValue:e.label}),"".concat(e.condition||"").toLowerCase().match(n)&&t.push({field:"field_condition",fieldIndex:i,fieldValue:e.condition}),(e.items||[]).map((e,l)=>{"".concat(e.value||"").toLowerCase().match(n)&&t.push({field:"field_item_key",fieldIndex:i,fieldItemIndex:l,fieldValue:e.value}),"".concat(e.label||"").toLowerCase().match(n)&&t.push({field:"field_item_label",fieldIndex:i,fieldItemIndex:l,fieldValue:e.label})})}),(e.items||[]).map((e,i)=>{"".concat(e.id||"").toLowerCase().match(n)&&t.push({field:"item_id",fieldIndex:i,fieldValue:e.id}),"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"item_key",fieldIndex:i,fieldValue:e.key}),"".concat(e.label||"").toLowerCase().match(n)&&t.push({field:"item_label",fieldIndex:i,fieldValue:e.label})}),(e.drugs||[]).map((e,i)=>{"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"drug",fieldIndex:i,fieldValue:e.key})}),(e.fluids||[]).map((e,i)=>{"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"fluid",fieldIndex:i,fieldValue:e.key})}),(e.feeds||[]).map((e,i)=>{"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"feed",fieldIndex:i,fieldValue:e.key})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},o[e.scriptId].screens.push({title:e.title,matches:t,screenId:e.screenId,isDraft:e.isDraft,fields:[...e.items.map(e=>({label:e.label,type:"item"})),...e.fields.map(e=>({label:e.label,type:"field"}))]}))}),s.forEach(e=>{let t=[];"".concat(e.name||"").toLowerCase().match(n)&&t.push({field:"name",fieldValue:e.name}),"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"key",fieldValue:e.key}),"".concat(e.expression||"").toLowerCase().match(n)&&t.push({field:"expression",fieldValue:e.expression}),(e.symptoms||[]).map((e,i)=>{"".concat(e.key||"").toLowerCase().match(n)&&t.push({field:"diagnosis_symptom_key",fieldIndex:i,fieldValue:e.key}),"".concat(e.name||"").toLowerCase().match(n)&&t.push({field:"diagnosis_symptom_name",fieldIndex:i,fieldValue:e.name}),"".concat(e.expression||"").toLowerCase().match(n)&&t.push({field:"diagnosis_symptom_expression",fieldIndex:i,fieldValue:e.expression})}),t.length&&(o[e.scriptId]=o[e.scriptId]||{title:"",scriptId:e.scriptId,diagnoses:[],screens:[],matches:[]},o[e.scriptId].diagnoses.push({title:e.name||"",matches:t,diagnosisId:e.diagnosisId,isDraft:e.isDraft,fields:[...e.symptoms.map(e=>({label:e.name,type:"diagnosis_symptom"}))]}))}),Object.values(o)}let s=[{value:"all",label:"All matches"},{value:"ref_id",label:"Ref ID only"},{value:"data_key",label:"Data keys only"},{value:"label",label:"Label only"},{value:"title",label:"Title only"},{value:"condition",label:"Conditional expression only"}],r={key:"data_key",field_key:"data_key",field_item_key:"data_key",field_id:"data_key",item_id:"data_key",item_key:"data_key",refId:"ref_id",title:"title",label:"label",field_label:"label",field_item_label:"label",item_label:"label",condition:"condition",field_condition:"condition",item_condition:"condition"};function d(e){let{searchValue:t,filter:i,results:l}=e;if("all"===i)return l;let a=e=>r[e.field]===i;return l.map(e=>i?{...e,matches:e.matches.filter(e=>a(e)),screens:e.screens.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))})),diagnoses:e.diagnoses.filter(e=>e.matches.find(e=>a(e))).map(e=>({...e,matches:e.matches.filter(e=>a(e))}))}:e).filter(e=>e.matches.length||e.screens.length||e.diagnoses.length)}},22937:function(e,t,i){i.d(t,{l:function(){return s}});let l=['"',"“"],a=['"',"”"];function s(e){let t="".concat(null!=e?e:"").trim();if(!t)return{normalizedValue:"",isExactMatch:!1};let i=l.includes(t[0]),s=a.includes(t[t.length-1]),r=t.length>1&&i&&s;return{normalizedValue:(r?t.slice(1,-1):t).trim().toLowerCase(),isExactMatch:r}}}}]);